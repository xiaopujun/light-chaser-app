(this["webpackJsonplight-chaser"]=this["webpackJsonplight-chaser"]||[]).push([[0],{264:function(a,e,t){"use strict";t.r(e);var i=t(13),n=t(14),r=t(16),o=t(17),l=t(0),d=(t(475),t(217)),c=t(332),s=t(476),u=t(220),p=t(105),h=t(72),g=t(2),v=function(a){Object(r.a)(t,a);var e=Object(o.a)(t);function t(a){var n,r,o,l,p,g,v;Object(i.a)(this,t),(v=e.call(this,a)).schema={},v.dataConfig={},v.state={renderCount:0},v.dataSourcesChange=function(a){v.props.controller.update({data:{dataSource:a}},{reRender:!1}),v.setState({dataSource:a})},v.validate=function(){var a,e,t;return null!==(a=v.dataConfig.apiData)&&void 0!==a&&a.url?null!==(e=v.dataConfig.apiData)&&void 0!==e&&e.method?null!==(t=v.dataConfig.apiData)&&void 0!==t&&t.header?!!v.dataConfig.apiData.params||(s.b.error("\u8bf7\u6c42\u53c2\u6570\u4e0d\u7b26\u5408json\u683c\u5f0f"),!1):(s.b.error("\u8bf7\u6c42\u5934\u4e0d\u7b26\u5408json\u683c\u5f0f"),!1):(s.b.error("\u8bf7\u6c42\u65b9\u5f0f\u4e0d\u80fd\u4e3a\u7a7a"),!1):(s.b.error("\u63a5\u53e3\u5730\u5740\u4e0d\u80fd\u4e3a\u7a7a"),!1)},v.testApi=function(){var a,e;if(v.validate()){var t=v.dataConfig.apiData,i=t.params,n=t.header;n=n&&"string"===typeof n?u.a.stringToJsObj(null===(a=v.dataConfig.apiData)||void 0===a?void 0:a.header):n,i=i&&"string"===typeof i?u.a.stringToJsObj(null===(e=v.dataConfig.apiData)||void 0===e?void 0:e.params):i;var r=v.dataConfig.apiData,o=r.url,l=r.method;Object(c.a)(o,l,n,i).then((function(a){v.schema.children[2].children[5].children[0].value=JSON.stringify(a,null,2),v.setState({renderCount:v.state.renderCount+1})})).catch((function(){v.schema.children[2].children[5].children[0].value=JSON.stringify({msg:"\u8bf7\u6c42\u9519\u8bef"},null,2),console.log(v.schema),v.setState({renderCount:v.state.renderCount+1})}))}},v.onFieldChange=function(a){var e=a.schemaKeyPath,t=a.data,i=a.reRender,n=a.id,r=a.dataFragment;if(v.dataConfig=u.a.merge(v.dataConfig,r),"doStaticSave"===n){var o=v.schema.children[1].children[0].value.replace(/'/g,'"').replace(/\s/g,""),l=JSON.parse(o);v.props.controller.update({data:{staticData:{data:l}}},{reRender:!0,operateType:d.OperateType.DATA})}if("doTest"===n&&v.testApi(),"doSave"===n){if(!v.validate())return;var c=v.props.controller,s=v.dataConfig.apiData,p=s.params,g=s.header;p&&"string"===typeof p&&(v.dataConfig.apiData.params=u.a.stringToJsObj(p)),g&&"string"===typeof g&&(v.dataConfig.apiData.header=u.a.stringToJsObj(g)),c.update({data:{apiData:v.dataConfig.apiData}},{reRender:!0,operateType:d.OperateType.DATA})}h.a.updateSchema(v.schema,e,t),i&&v.setState({renderCount:v.state.renderCount+1})};var f=a.controller.getConfig().data;return v.dataConfig=f,v.state={renderCount:0},v.schema={type:"grid",config:{gridGap:"10px"},children:[{key:"dataSource",label:"\u6570\u636e\u6e90",type:"select",reRender:!0,value:(null===f||void 0===f?void 0:f.dataSource)||"static",config:{options:[{value:"static",label:"\u9759\u6001\u6570\u636e"},{value:"api",label:"\u63a5\u53e3(API)"}]}},{key:"staticData",rules:"{dataSource} === 'static'",children:[{key:"data",type:"code-editor",config:{height:500},value:JSON.stringify(null===f||void 0===f||null===(n=f.staticData)||void 0===n?void 0:n.data,null,2)||""},{id:"doStaticSave",type:"button",config:{children:"\u4fdd\u5b58\u5e76\u5237\u65b0\u6570\u636e",style:{width:"100%"}}}]},{key:"apiData",rules:"{dataSource} === 'api'",children:[{key:"url",type:"input",label:"\u63a5\u53e3\u5730\u5740",value:(null===f||void 0===f||null===(r=f.apiData)||void 0===r?void 0:r.url)||""},{key:"method",label:"\u8bf7\u6c42\u65b9\u5f0f",type:"select",value:(null===f||void 0===f||null===(o=f.apiData)||void 0===o?void 0:o.method)||"get",config:{options:[{value:"get",label:"GET"},{value:"post",label:"POST"}]}},{key:"flashFrequency",label:"\u5237\u65b0\u9891\u7387",type:"input",config:{prefix:"\u6bcf",type:"number",suffix:"\u79d2",min:5},value:(null===f||void 0===f||null===(l=f.apiData)||void 0===l?void 0:l.flashFrequency)||5},{type:"item-panel",label:"\u8bf7\u6c42\u5934",tip:"\u8bf7\u6c42\u5934\u4fe1\u606f\uff0cjson\u683c\u5f0f",children:[{key:"header",type:"code-editor",config:{height:100},value:JSON.stringify(null===f||void 0===f||null===(p=f.apiData)||void 0===p?void 0:p.header,null,2)||""}]},{type:"item-panel",tip:"\u8bf7\u6c42\u53c2\u6570\uff0cjson\u683c\u5f0f",label:"\u8bf7\u6c42\u53c2\u6570",children:[{key:"params",type:"code-editor",config:{height:100},value:JSON.stringify(null===f||void 0===f||null===(g=f.apiData)||void 0===g?void 0:g.params,null,2)||""}]},{type:"item-panel",label:"\u54cd\u5e94\u7ed3\u679c",children:[{type:"code-editor",reRender:!0,config:{readonly:!0,height:160},value:""}]},{type:"grid",config:{columns:2},children:[{id:"doTest",type:"button",config:{children:"\u6d4b\u8bd5\u63a5\u53e3",style:{width:"100%"}}},{id:"doSave",type:"button",config:{children:"\u4fdd\u5b58",style:{width:"100%"}}}]}]}]},v}return Object(n.a)(t,[{key:"render",value:function(){return Object(g.jsx)(p.a,{schema:this.schema,onFieldChange:this.onFieldChange})}}]),t}(l.Component);e.default=v},475:function(a,e,t){}}]);