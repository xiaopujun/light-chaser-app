var x=Object.defineProperty;var C=(h,o,e)=>o in h?x(h,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[o]=e;var d=(h,o,e)=>(C(h,typeof o!="symbol"?o+"":o,e),e);import{r as R,j as n}from"./index-OsS9UfkW.js";import{L as y,i as k,e as r,c as g,r as L,l as p,j as q}from"./LayerManager-yWnDoBOm.js";import{L as w}from"./LCGUI-GANd_WR1.js";import b from"./BaseInfoStore-VzdD0w4k.js";import{A as I,a as j,b as S,c as z,d as T,e as M}from"./AlignVerticalCenterTwo-VMNHMjLd.js";import{I as A}from"./Info-a_timmp6.js";import"./mobxreact.esm-rNVktGB7.js";import"./ObjectUtil-nMvTrJhh.js";import"./index-K2O65-hP.js";import"./index-APrWN4Qi.js";import"./LocalOperator-BbYzoZ36.js";import"./GlobalMessage-FQtvcjbG.js";import"./MainRouter-Z3gK7D7G.js";import"./useZIndex-g2cfol2D.js";import"./FetchUtil-Ivd_z0Im.js";class P extends R.Component{constructor(e){super(e);d(this,"init",()=>{var s;const{activeElem:e}=L,{layerConfigs:t}=p,i=t[e.id];if(i)if(i.type==="group"){const a=y.findAllChildLayer([i.id]).filter(c=>t[c].type!=="group"),l=this.calculateGroupRect(a);this.state={...i,...l}}else{const a=(s=k.definitionMap[i.type])==null?void 0:s.getBaseInfo();this.state={...i,version:a==null?void 0:a.version}}});d(this,"calculateGroupRect",e=>{const{layerConfigs:t}=p;let i=1/0,s=1/0,a=-1/0,l=-1/0;return e.forEach(c=>{const{x:m=0,y:u=0,width:f=0,height:v=0}=t[c];i=Math.min(i,m),s=Math.min(s,u),a=Math.max(a,m+f),l=Math.max(l,u+v)}),{x:i,y:s,width:a-i,height:l-s}});d(this,"changeName",e=>{const{controller:t}=this.props;t.update({base:{name:e}},{reRender:!1});const{updateLayer:i}=p;i&&i([{id:this.state.id,name:e}]);const{layerInstances:s}=q,a=s[this.state.id];a&&a.setState({name:e})});d(this,"handleMap",{name:this.changeName,width:e=>{var t;return(t=r.movableRef)==null?void 0:t.request("resizable",{offsetWidth:e,direction:[1,1]},!0)},height:e=>{var t;return(t=r.movableRef)==null?void 0:t.request("resizable",{offsetHeight:e,direction:[1,1]},!0)},posX:e=>{var t;return(t=r.movableRef)==null?void 0:t.request("draggable",{x:e},!0)},posY:e=>{var t;return(t=r.movableRef)==null?void 0:t.request("draggable",{y:e},!0)},align:e=>this.handleMap[e](),left:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{x:0},!0)},horizontally:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{x:g.canvasConfig.width/2-this.state.width/2},!0)},right:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{x:g.canvasConfig.width-this.state.width},!0)},top:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{y:0},!0)},vertically:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{y:g.canvasConfig.height/2-this.state.height/2},!0)},bottom:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{y:g.canvasConfig.height-this.state.height},!0)}});d(this,"onFieldChange",e=>{const{id:t,data:i}=e,{targetIds:s,setTargetIds:a}=r;if(!s.includes(this.state.id)){const{type:c}=this.state;if(c==="group"){const{layerConfigs:m}=p,u=y.findAllChildLayer([this.state.id]).filter(f=>m[f].type!=="group");a(u)}else a([this.state.id])}const l=setTimeout(()=>{this.handleMap[t](i),clearTimeout(l)},1)});d(this,"buildSchema",()=>{const{name:e,width:t,height:i,x:s,y:a}=this.state;return{type:"grid",config:{columns:2},children:[{id:"name",key:"name",label:"名称",type:"input",value:e,config:{containerStyle:{gridColumn:"1/3"}}},{type:"grid",label:"尺寸",config:{columns:2,containerStyle:{gridColumn:"1/3"}},children:[{id:"width",key:"width",type:"number-input",label:"宽度",value:t,reRender:!0},{id:"height",key:"height",type:"number-input",label:"高度",value:i,reRender:!0}]},{type:"grid",label:"位置",config:{columns:2,containerStyle:{gridColumn:"1/3"}},children:[{id:"posX",key:"posX",type:"number-input",label:"X轴",reRender:!0,value:s},{id:"posY",key:"posY",type:"number-input",label:"Y轴",reRender:!0,value:a}]},{id:"align",label:"对齐",type:"group-button",config:{containerStyle:{gridColumn:"1/3"},items:[{value:"left",content:n.jsx(I,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"horizontally",content:n.jsx(j,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"right",content:n.jsx(S,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"top",content:n.jsx(z,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"vertically",content:n.jsx(T,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"bottom",content:n.jsx(M,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})}]}}]}});this.init()}componentDidMount(){const{setBaseConfigRef:e}=b;e&&e(this)}componentWillUnmount(){const{setBaseConfigRef:e}=b;e&&e(null)}render(){const{type:e,version:t}=this.state,i=this.buildSchema();return n.jsxs("div",{className:"base-info-config",children:[n.jsx("div",{className:"version-info",children:n.jsxs("span",{children:[n.jsx(A,{})," ",e," | ",t?`版本: ${t}`:"无版本信息"]})}),n.jsx(w,{schema:i,onFieldChange:this.onFieldChange})]})}}export{P as default};
