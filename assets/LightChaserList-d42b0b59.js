var w=Object.defineProperty;var D=(c,i,s)=>i in c?w(c,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[i]=s;var l=(c,i,s)=>(D(c,typeof i!="symbol"?i+"":i,s),s);import{r as N,j as e,D as f,G as y,I as m,S as I,B as p,E as x,d as S,a as v,b as k,U as u,m as L,P as b}from"./index-deca68b0.js";class P extends N.Component{constructor(){super(...arguments);l(this,"projectInfo",{name:"",description:"",width:500,height:300});l(this,"onOk",s=>{s.preventDefault();const{onOk:t}=this.props;t&&t(this.projectInfo)});l(this,"onCancel",()=>{console.log("关闭");const{onCancel:s}=this.props;s&&s()})}render(){const{visible:s=!1}=this.props;return e.jsx(f,{title:"新建大屏",visible:s,className:"add-new-screen-dialog",onClose:this.onCancel,children:e.jsxs("form",{onSubmit:this.onOk,children:[e.jsx("div",{className:"lc-add-new-screen",children:e.jsxs(y,{gridGap:"15px",columns:2,children:[e.jsx(m,{label:"名称",required:!0,maxLength:20,onChange:t=>this.projectInfo.name=t}),e.jsx(m,{label:"描述",maxLength:20,onChange:t=>this.projectInfo.description=t}),e.jsx(m,{label:"宽度",type:"number",min:300,required:!0,onChange:t=>this.projectInfo.width=t}),e.jsx(m,{label:"高度",type:"number",min:300,required:!0,onChange:t=>this.projectInfo.height=t}),e.jsx(I,{label:"存储",options:[{value:"1",label:"本地存储"}],defaultValue:"1"})]})}),e.jsxs("div",{className:"add-new-screen-explain",children:[e.jsx("p",{children:"说明："}),e.jsx("p",{children:"1、名称不超过20字，描述不超过60字"}),e.jsx("p",{children:"2、宽度必须≥500，高度必须≥300"})]}),e.jsxs("div",{className:"add-new-screen-footer",children:[e.jsx(p,{type:"submit",children:"保存"}),e.jsx(p,{onClick:this.onCancel,children:"取消"})]})]})})}}const O="/light-chaser-app/assets/list-bottom-e885eb79.svg",T="/light-chaser-app/assets/template-market-4ee17aa3.svg",B="/light-chaser-app/assets/datasource-25bd5cdf.svg",U="/light-chaser-app/assets/list-del-da838707.svg",A="/light-chaser-app/assets/list-display-4253bff9.svg",E="/light-chaser-app/assets/list-edit-ef857085.svg",$="/light-chaser-app/assets/list-clone-e7d88f3c.svg";class G extends N.Component{constructor(){super(...arguments);l(this,"state",{showAddDialog:!1,showDelDialog:!1,showCloneDialog:!1,addNewData:{},data:[],imageIdToUrl:{}});l(this,"toBeDelId","");l(this,"toBeCloneId","");l(this,"loadProjectList",()=>{x.getInstance().scannerProjectOperators();const{projectConfig:{saveType:s=v.LOCAL}}=S;x.getInstance().operatorMap[s].getProjectSimpleInfoList().then(t=>{if(t&&t.length>0){this.setState({data:t});let n=[];t.forEach(d=>{let h=d.screenshot;h&&h!==""&&n.push(h)});const o=n.map(d=>k.getImageFromLocalWithKey(d));let r={};Promise.all(o).then(d=>{d.forEach(h=>{const a=Object.keys(h)[0];r[a]=h[a]}),this.setState({imageIdToUrl:r})})}})});l(this,"toggleNewProVisible",()=>{const{addNewScreen:s}=this.state;this.setState({addNewScreen:!s})});l(this,"onOk",s=>{let t=u.buildUrlParams({...s,action:"create"});this.setState({addNewScreen:!1}),window.open(`/light-chaser-app/#/designer?${t}`,"_blank")});l(this,"onCancel",()=>this.setState({addNewScreen:!1}));l(this,"operateHandler",s=>{const{type:t,savetype:n}=s.target.dataset;if(!t)return;let o=s.currentTarget.id;switch(t){case"edit":let r=u.buildUrlParams({id:o,action:"edit"});window.open(`/light-chaser-app/#/designer?${r}`,"_blank");break;case"show":window.open(`/light-chaser-app/#/view?id=${o}&saveType=${n}&action=view`,"_blank");break;case"del":this.toBeDelId=o,this.setState({showDelDialog:!0});break;case"clone":this.toBeCloneId=o,this.setState({showCloneDialog:!0});break}});l(this,"confirmDel",()=>{x.getInstance().operatorMap[v.LOCAL].deleteProject(this.toBeDelId);let{data:s}=this.state;s=s.filter(t=>t.id!==this.toBeDelId),this.setState({data:s,showDelDialog:!1})});l(this,"cancelDel",()=>{this.setState({showDelDialog:!1})});l(this,"confirmClone",s=>{const t=x.getInstance().operatorMap[v.LOCAL];t.copyProject(this.toBeCloneId,s).then(n=>{t.getProjectSimpleInfoList().then(o=>{this.setState({data:o,showCloneDialog:!1}),L.success("克隆成功")})})});l(this,"cancelClone",()=>{this.setState({showCloneDialog:!1})})}componentDidMount(){this.loadProjectList()}render(){const{addNewScreen:s,data:t,imageIdToUrl:n,showDelDialog:o,showCloneDialog:r}=this.state;let d=(window.innerWidth-230-5*20)/5,h=d*(9/16);return e.jsxs("div",{className:"lc-console",children:[e.jsx("div",{className:"console-head",children:e.jsx("div",{className:"console-head-title",children:"LIGHT CHASER 控制台"})}),e.jsxs("div",{className:"console-body",children:[e.jsxs("div",{className:"console-list",children:[e.jsxs("div",{className:"console-list-item",children:[e.jsx("div",{className:"item-icon",children:e.jsx("img",{src:O,alt:"项目列表"})}),e.jsx("div",{className:"item-text",children:"项目列表"})]}),e.jsxs("div",{className:"console-list-item",children:[e.jsx("div",{className:"item-icon",children:e.jsx("img",{src:B,alt:"数据源管理"})}),e.jsx("div",{className:"item-text",children:"数据源管理"})]}),e.jsxs("div",{className:"console-list-item",children:[e.jsx("div",{className:"item-icon",children:e.jsx("img",{src:T,alt:"模板市场"})}),e.jsx("div",{className:"item-text",children:"模板市场"})]})]}),e.jsx("div",{className:"console-content",children:e.jsx("div",{className:"content-body",children:e.jsxs("div",{className:"project-list",children:[e.jsx("div",{style:{width:d,height:h,margin:"0 20px 20px 0"},children:e.jsx(p,{onClick:this.toggleNewProVisible,style:{width:d,height:h,fontSize:20},children:"+ 新建项目"})}),t&&t.map(a=>{let C=n[a==null?void 0:a.screenshot],j,g;return a.state===b.DRAFT?(j="草稿",g="#FFB800"):a.state===b.PUBLISH&&(j="已发布",g="#00CC66"),e.jsxs("div",{style:{width:d,height:h,backgroundImage:C&&`url(${C})`},onClick:this.operateHandler,id:a.id+"",className:"project-item",children:[e.jsxs("div",{className:"pro-list-content",style:{zIndex:1},children:[e.jsx("div",{className:"pro-content-title",children:a==null?void 0:a.name}),e.jsxs("div",{className:"pro-content-operates",children:[e.jsx("div",{className:"operate-item","data-type":"edit",children:e.jsx("img",{src:E,alt:"编辑"})}),e.jsx("div",{className:"operate-item","data-type":"show","data-savetype":a.saveType,children:e.jsx("img",{src:A,alt:"展示"})}),e.jsx("div",{className:"operate-item","data-type":"del",children:e.jsx("img",{src:U,alt:"删除"})}),e.jsx("div",{className:"operate-item","data-type":"clone",children:e.jsx("img",{src:$,alt:"克隆"})})]})]}),e.jsxs("div",{className:"pro-content-footer",children:[e.jsx("div",{className:"state-point",style:{backgroundColor:g}}),e.jsx("div",{className:"state-text",style:{color:g},children:j})]})]},a.id+"")})]})})})]}),e.jsx(P,{onOk:this.onOk,onCancel:this.onCancel,visible:s}),e.jsx(H,{visible:o,onOk:this.confirmDel,onCancel:this.cancelDel}),e.jsx(M,{onOk:a=>this.confirmClone(a),onCancel:this.cancelClone,visible:r})]})}}const H=c=>{const{onOk:i,onCancel:s,visible:t}=c;return e.jsxs(f,{title:"删除确认",visible:t,onClose:s,children:[e.jsx("div",{style:{color:"#aeaeae",padding:10},children:"确定要删除该项目吗？"}),e.jsxs("div",{className:"del-pro-confirm",style:{display:"flex",justifyContent:"flex-end",borderTop:"2px solid #272b34",paddingTop:5},children:[e.jsx(p,{onClick:i,children:"确认"}),e.jsx(p,{onClick:s,children:"取消"})]})]})},M=c=>{const{onOk:i,onCancel:s,visible:t}=c;let n="";const o=r=>{console.log(n),r.preventDefault(),i(n)};return e.jsx(f,{title:"克隆项目",visible:t,onClose:s,children:e.jsxs("form",{onSubmit:o,children:[e.jsx(m,{label:"项目名称",required:!0,defaultValue:n,onChange:r=>n=r}),e.jsxs("div",{className:"del-pro-confirm",style:{display:"flex",justifyContent:"flex-end",borderTop:"2px solid #272b34",paddingTop:10},children:[e.jsx(p,{type:"submit",children:"确认"}),e.jsx(p,{onClick:s,children:"取消"})]})]})})};export{G as default};
