var Nt=Object.defineProperty;var Tt=(i,l,e)=>l in i?Nt(i,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[l]=e;var a=(i,l,e)=>(Tt(i,typeof l!="symbol"?l+"":l,e),e);import{r as d,A as G,_ as L,j as s,c as Ht,e as Bt,f as ce,o as Ke,g as Ue,h as b,i as Pt,k as V,O as _t,l as ie,L as Y,n as Ye,d as y,D as At,p as We,q as ae,s as m,E as Vt,t as Gt,I as qe,u as Q,R as le,v as Ee,w as $t,x as Kt,y as Ut,z as De,C as Wt,M as Ft,F as me,H as Qe,J as Je,K as Ze,N as Xt,Q as et,T as tt,V as nt,W as st,X as rt,Y as ot,Z as de,$ as Yt,a0 as qt,a1 as Qt,a2 as Jt,a3 as Zt,a4 as en,a5 as tn,a6 as nn,a7 as sn,a8 as rn,a9 as on,aa as an,ab as ln,ac as cn,ad as dn,ae as hn,af as un,ag as gn,ah as pn,ai as fn,aj as mn,ak as vn,al as yn,am as xn,an as Cn,ao as bn}from"./index-deca68b0.js";import{l as Re}from"./LayerBuilder-8423829e.js";var Ln={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 168H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM518.3 355a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V848c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V509.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 355z"}}]},name:"vertical-align-top",theme:"outlined"};const kn=Ln;var it=function(l,e){return d.createElement(G,L(L({},l),{},{ref:e,icon:kn}))};it.displayName="VerticalAlignTopOutlined";const jn=d.forwardRef(it);var wn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2Q889.47 375.11 816.7 305l-50.88 50.88C807.31 395.53 843.45 447.4 874.7 512 791.5 684.2 673.4 766 512 766q-72.67 0-133.87-22.38L323 798.75Q408 838 512 838q288.3 0 430.2-300.3a60.29 60.29 0 000-51.5zm-63.57-320.64L836 122.88a8 8 0 00-11.32 0L715.31 232.2Q624.86 186 512 186q-288.3 0-430.2 300.3a60.3 60.3 0 000 51.5q56.69 119.4 136.5 191.41L112.48 835a8 8 0 000 11.31L155.17 889a8 8 0 0011.31 0l712.15-712.12a8 8 0 000-11.32zM149.3 512C232.6 339.8 350.7 258 512 258c54.54 0 104.13 9.36 149.12 28.39l-70.3 70.3a176 176 0 00-238.13 238.13l-83.42 83.42C223.1 637.49 183.3 582.28 149.3 512zm246.7 0a112.11 112.11 0 01146.2-106.69L401.31 546.2A112 112 0 01396 512z"}},{tag:"path",attrs:{d:"M508 624c-3.46 0-6.87-.16-10.25-.47l-52.82 52.82a176.09 176.09 0 00227.42-227.42l-52.82 52.82c.31 3.38.47 6.79.47 10.25a111.94 111.94 0 01-112 112z"}}]},name:"eye-invisible",theme:"outlined"};const Dn=wn;var at=function(l,e){return d.createElement(G,L(L({},l),{},{ref:e,icon:Dn}))};at.displayName="EyeInvisibleOutlined";const Rn=d.forwardRef(at);var Sn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 64H296c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h496v688c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V96c0-17.7-14.3-32-32-32zM704 192H192c-17.7 0-32 14.3-32 32v530.7c0 8.5 3.4 16.6 9.4 22.6l173.3 173.3c2.2 2.2 4.7 4 7.4 5.5v1.9h4.2c3.5 1.3 7.2 2 11 2H704c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32zM350 856.2L263.9 770H350v86.2zM664 888H414V746c0-22.1-17.9-40-40-40H232V264h432v624z"}}]},name:"copy",theme:"outlined"};const En=Sn;var lt=function(l,e){return d.createElement(G,L(L({},l),{},{ref:e,icon:En}))};lt.displayName="CopyOutlined";const zn=d.forwardRef(lt);var In={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M912 820.1V203.9c28-9.9 48-36.6 48-67.9 0-39.8-32.2-72-72-72-31.3 0-58 20-67.9 48H203.9C194 84 167.3 64 136 64c-39.8 0-72 32.2-72 72 0 31.3 20 58 48 67.9v616.2C84 830 64 856.7 64 888c0 39.8 32.2 72 72 72 31.3 0 58-20 67.9-48h616.2c9.9 28 36.6 48 67.9 48 39.8 0 72-32.2 72-72 0-31.3-20-58-48-67.9zM888 112c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zM136 912c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm0-752c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm704 680H184V184h656v656zm48 72c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24z"}},{tag:"path",attrs:{d:"M288 474h448c8.8 0 16-7.2 16-16V282c0-8.8-7.2-16-16-16H288c-8.8 0-16 7.2-16 16v176c0 8.8 7.2 16 16 16zm56-136h336v64H344v-64zm-56 420h448c8.8 0 16-7.2 16-16V566c0-8.8-7.2-16-16-16H288c-8.8 0-16 7.2-16 16v176c0 8.8 7.2 16 16 16zm56-136h336v64H344v-64z"}}]},name:"group",theme:"outlined"};const On=In;var ct=function(l,e){return d.createElement(G,L(L({},l),{},{ref:e,icon:On}))};ct.displayName="GroupOutlined";const Mn=d.forwardRef(ct);var Nn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"};const Tn=Nn;var dt=function(l,e){return d.createElement(G,L(L({},l),{},{ref:e,icon:Tn}))};dt.displayName="LockOutlined";const Fe=d.forwardRef(dt);var Hn={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M736 550H288c-8.8 0-16 7.2-16 16v176c0 8.8 7.2 16 16 16h448c8.8 0 16-7.2 16-16V566c0-8.8-7.2-16-16-16zm-56 136H344v-64h336v64zm208 130c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm0 96c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zM736 266H288c-8.8 0-16 7.2-16 16v176c0 8.8 7.2 16 16 16h448c8.8 0 16-7.2 16-16V282c0-8.8-7.2-16-16-16zm-56 136H344v-64h336v64zm208-194c39.8 0 72-32.2 72-72s-32.2-72-72-72-72 32.2-72 72 32.2 72 72 72zm0-96c13.3 0 24 10.7 24 24s-10.7 24-24 24-24-10.7-24-24 10.7-24 24-24zM136 64c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm0 96c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24zm0 656c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm0 96c-13.3 0-24-10.7-24-24s10.7-24 24-24 24 10.7 24 24-10.7 24-24 24z"}}]},name:"ungroup",theme:"outlined"};const Bn=Hn;var ht=function(l,e){return d.createElement(G,L(L({},l),{},{ref:e,icon:Bn}))};ht.displayName="UngroupOutlined";const Pn=d.forwardRef(ht);var _n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M859.9 780H164.1c-4.5 0-8.1 3.6-8.1 8v60c0 4.4 3.6 8 8.1 8h695.8c4.5 0 8.1-3.6 8.1-8v-60c0-4.4-3.6-8-8.1-8zM505.7 669a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V176c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8z"}}]},name:"vertical-align-bottom",theme:"outlined"};const An=_n;var ut=function(l,e){return d.createElement(G,L(L({},l),{},{ref:e,icon:An}))};ut.displayName="VerticalAlignBottomOutlined";const Vn=d.forwardRef(ut);class Gn extends d.Component{render(){return s.jsx("div",{className:"structure-header",children:this.props.children})}}class $n extends d.Component{render(){return s.jsx("div",{className:"structure-body",children:this.props.children})}}class Kn extends d.Component{render(){return s.jsx("div",{className:"structure-body-left",children:this.props.children})}}class Un extends d.Component{render(){return s.jsx("div",{id:"structureContent",className:"structure-body-content",children:this.props.children})}}class Wn extends d.Component{render(){return s.jsx("div",{className:"structure-body-right",children:this.props.children})}}class Fn extends d.Component{render(){return s.jsx("div",{className:"lc-designer-structure",children:this.props.children})}}class Xn extends d.Component{render(){return s.jsx("div",{className:"structure-foot",children:this.props.children})}}var j=(i=>(i.ALL="all",i.BASE="base",i.ORNAMENTAL="ornamental",i.BAR="bar",i.COLUMN="column",i.LINE="line",i.AREA="area",i.PIE="pie",i.PROGRESS="progress",i.SCATTER="scatter",i.RADAR="radar",i.ROSE="rose",i.WORD_CLOUD="word_cloud",i.HISTOGRAM="histogram",i.SUNBURST="sunburst",i.TREEMAP="treemap",i))(j||{});const Yn="/light-chaser-app/assets/icon-all-f9f00824.svg",qn="/light-chaser-app/assets/icon-bar-f92f84a7.svg",Qn="/light-chaser-app/assets/icon-column-e9b14410.svg",Jn="/light-chaser-app/assets/icon-area-402a8724.svg",Zn="/light-chaser-app/assets/icon-pie-2e2d1ba2.svg",es="/light-chaser-app/assets/icon-scatter-52100b79.svg",ts="/light-chaser-app/assets/icon-line-c6de27ac.svg",ns="/light-chaser-app/assets/icon-loading-f6e3585b.svg",ss="/light-chaser-app/assets/icon-flowers-c5648457.svg",rs="/light-chaser-app/assets/icon-optimize-5a4981d5.svg",os="/light-chaser-app/assets/icon-points-2e2b718b.svg",is=()=>[{icon:Yn,name:"全部",classify:j.ALL},{icon:os,name:"基础",classify:j.BASE},{icon:rs,name:"装饰",classify:j.ORNAMENTAL},{icon:qn,name:"条形图",classify:j.BAR},{icon:Qn,name:"柱状图",classify:j.COLUMN},{icon:ts,name:"折线图",classify:j.LINE},{icon:Jn,name:"面积图",classify:j.AREA},{icon:Zn,name:"饼图",classify:j.PIE},{icon:ns,name:"进度图",classify:j.PROGRESS},{icon:es,name:"散点图",classify:j.SCATTER},{icon:ss,name:"玫瑰图",classify:j.ROSE}];class as{constructor(){a(this,"classifies",[]);a(this,"classifyKey","all");a(this,"doInit",()=>{this.classifies=is()});a(this,"doClear",()=>{this.classifies=[]});a(this,"setClassifyKey",l=>{this.classifyKey=l});Ht(this)}}const ve=new as;class ls{constructor(){a(this,"compInfoArr",[]);a(this,"compKey","");a(this,"visible",!1);a(this,"doInit",()=>{const l=[],{definitionMap:e}=ce.getLoader();e&&Object.keys(e).forEach(t=>{let n=e[t].getBaseInfo();n.compKey!=="group"&&l.push(n)}),this.compInfoArr=l});a(this,"setVisible",l=>this.visible=l);a(this,"setCompKey",l=>this.compKey=l);Bt(this,{compKey:Ke,visible:Ke,setVisible:Ue,setCompKey:Ue})}}const q=new ls;class cs extends d.Component{constructor(e){super(e);a(this,"changeClassifyKey",e=>{const{setClassifyKey:t}=ve,{setVisible:n,visible:o}=q;t(e.currentTarget.id),o||n&&n(!0)});a(this,"buildClassifyList",()=>{const{classifies:e}=ve;let t=[];for(let n=0;n<e.length;n++){const{icon:o,name:r,classify:c}=e[n];t.push(s.jsxs("div",{className:"sort-item",id:c,onClick:this.changeClassifyKey,children:[s.jsx("div",{className:"sort-item-icon",children:s.jsx("img",{style:{width:20},src:o,alt:"all"})}),s.jsx("span",{className:"sort-item-content",children:r})]},n+""))}return t});const{doInit:t}=ve;t&&t()}render(){const e=this.buildClassifyList();return s.jsx("div",{className:"lc-charts-sort",style:{overflowY:"scroll"},children:e})}}const ds=b(cs);class hs extends d.Component{render(){return s.jsx(ds,{})}}const us=b(hs);class gs extends d.Component{constructor(){super(...arguments);a(this,"menuChange",e=>{const{setActiveMenu:t,setContentVisible:n}=V;t&&t(e.currentTarget.id),n&&n(!0)});a(this,"buildMenuList",()=>{const{menus:e}=V;return e.length===0?s.jsxs("div",{style:{writingMode:"vertical-rl",color:"#ced2d8",letterSpacing:"8px",padding:7,fontSize:12},children:[s.jsx(Pt,{style:{fontSize:15,position:"relative",left:2,marginBottom:7}}),"双击组件激活..."]}):e.map(t=>{const n=t.icon;return s.jsxs("div",{className:"menu-item",id:t.key,onClick:this.menuChange,children:[s.jsx("div",{className:"item-icon",children:s.jsx(n,{})}),s.jsx("div",{className:"item-content",children:t.name})]},t.key)})})}render(){return s.jsx("div",{className:"lc-config-menu",children:s.jsx("div",{className:"menu-list",children:this.buildMenuList()})})}}const ps=b(gs);class fs extends d.Component{constructor(){super(...arguments);a(this,"createProxy",e=>new Proxy(e,{get(t,n){const o=t[n];return typeof o=="function"&&o.name==="update"?new Proxy(o,{apply(r,c,u){const g=u[0],f=_t.getOriginValue(c.config,u[0]);return ie.doStyleUpd(g,f),r.apply(c,u)}}):o}}));a(this,"buildConfigContent",()=>{const{compInstances:e}=y;let{activeMenu:t,activeElem:n}=V,o=ce.getLoader().definitionMap[n.type+""];if(!o)return;const c=o.getMenuToConfigContentMap()[t],u=this.createProxy(e[n.id+""]);return s.jsx(d.Suspense,{fallback:s.jsx(Y,{}),children:s.jsx(c,{controller:u})})});a(this,"onClose",()=>{const{setContentVisible:e}=V;e&&e(!1)})}render(){const{activeMenu:e,menus:t}=V;let n="";for(let o=0;o<t.length;o++)if(t[o].key===e){n=t[o].name;break}return s.jsxs("div",{className:"lc-config-panel",children:[s.jsxs("div",{className:"lc-panel-top",children:[s.jsx("div",{className:"panel-title",children:s.jsx("span",{children:n})}),s.jsx("div",{className:"panel-operate",onClick:this.onClose,children:s.jsx(Ye,{})})]}),s.jsx("div",{className:"lc-panel-content",children:this.buildConfigContent()})]})}}const ms=b(fs);class vs extends d.Component{render(){const{visible:l}=V;return s.jsxs(s.Fragment,{children:[s.jsx(ps,{}),l&&s.jsx(ms,{})]})}}const ys=b(vs);class xs extends d.Component{constructor(){super(...arguments);a(this,"hotkeys",[{name:"保存项目",key:"ctrl + s"},{name:"复制组件",key:"ctrl + v"},{name:"锁定组件",key:"ctrl + l"},{name:"解锁组件",key:"ctrl + shift + l"},{name:"隐藏组件",key:"ctrl + h"},{name:"开/关辅助边框",key:"ctrl + k"},{name:"元素置顶",key:"ctrl + up-arrow(方向上键)"},{name:"元素置底",key:"ctrl + down-arrow(方向下键)"},{name:"删除组件",key:"delete"},{name:"缩放画布",key:"alt + wheel(鼠标滑轮)"},{name:"拖拽画布",key:"长按鼠标右键"},{name:"组件上移",key:"方向上键"},{name:"组件下移",key:"方向下键"},{name:"组件左移",key:"方向左键"},{name:"组件右移",key:"方向右键"},{name:"组件上扩大",key:"ctrl + shift + 方向上键"},{name:"组件下扩大",key:"ctrl + shift + 方向下键"},{name:"组件左扩大",key:"ctrl + shift + 方向左键"},{name:"组件右扩大",key:"ctrl + shift + 方向右键"},{name:"组件上缩小",key:"ctrl + alt + 方向上键"},{name:"组件下缩小",key:"ctrl + alt + 方向下键"},{name:"组件左缩小",key:"ctrl + alt + 方向左键"},{name:"组件右缩小",key:"ctrl + alt + 方向右键"},{name:"撤销",key:"ctrl + z"},{name:"重做",key:"ctrl + shift + z"},{name:"打开/关闭项目设置",key:"ctrl + 1"},{name:"打开/关闭画布设置",key:"ctrl + 2"},{name:"打开/关闭全局主题设置",key:"ctrl + 3"},{name:"打开/关闭图层",key:"ctrl + 4"},{name:"打开/关闭快捷键说明",key:"ctrl + 5"},{name:"编组",key:"ctrl + g"},{name:"解除编组",key:"ctrl + shift + g"}])}render(){return s.jsx("div",{className:"lc-hotkey-des",style:{color:"white"},children:this.hotkeys.map((e,t)=>s.jsxs("div",{className:"hotkey-des-item",children:[s.jsx("div",{className:"hotkey-content",children:s.jsx("code",{children:e.key})}),s.jsx("div",{className:"hotkey-des",children:e.name})]},t))})}}const Cs="/light-chaser-app/assets/keyboard-icon-11886aee.svg",bs="/light-chaser-app/assets/layers-icon-a0d92a74.svg";class Ls extends d.Component{constructor(){super(...arguments);a(this,"toggleHotKeyDes",()=>{const{hotKeyVisible:e,setHotKeyVisible:t}=We;t(!e)});a(this,"toggleLayerList",()=>{const{setVisible:e,visible:t}=ae;e&&e(!t)})}render(){const{layerConfigs:e,projectConfig:{name:t,state:n}}=y,{hotKeyVisible:o}=We,{scale:r}=m;let c="";switch(n){case"0":c="草稿";break;case"1":c="发布";break;case"2":c="封存";break}return s.jsxs("div",{className:"lc-designer-footer",children:[s.jsxs("div",{className:"footer-left",children:[s.jsxs("div",{className:"footer-item",onClick:this.toggleHotKeyDes,children:[s.jsx("img",{width:16,alt:"快捷键",src:Cs})," ",s.jsx("span",{style:{position:"relative",top:2},children:"快捷键"})]}),s.jsxs("div",{className:"footer-item",onClick:this.toggleLayerList,children:[s.jsx("img",{width:16,alt:"图层",src:bs})," ",s.jsx("span",{style:{position:"relative",top:2},children:"图层"})]})]}),s.jsxs("div",{className:"footer-right",children:[s.jsxs("div",{className:"right-info-item",children:["缩放 : ",(r*100).toFixed(0),"%"]}),s.jsxs("div",{className:"right-info-item",children:["图层 : ",Object.keys(e).length]}),s.jsxs("div",{className:"right-info-item",children:["项目 : ",t]}),s.jsxs("div",{className:"right-info-item",children:["状态 : ",c]})]}),s.jsx(At,{title:"快捷键说明",visible:o,width:500,onClose:this.toggleHotKeyDes,children:s.jsx(xs,{})})]})}}const ks=b(Ls);class js{constructor(){a(this,"target",null);a(this,"dragTarget",null);a(this,"position",{x:0,y:0})}registerDragger(){this.onDragStart(this.target),this.onDragEnd(this.target)}}class ws extends js{constructor(e,t,n){super();a(this,"position",{x:0,y:0});a(this,"onDragEnd",()=>{this.dragTarget.addEventListener("pointerup",e=>{e.button===0&&(this.dragTarget.releasePointerCapture(e.pointerId),this.dragTarget.removeEventListener("pointermove",this.onDragMove))})});a(this,"onDragMove",e=>{this.position.x+=e.movementX,this.position.y+=e.movementY,this.target.style.transform="translate("+this.position.x+"px, "+this.position.y+"px)"});a(this,"onDragStart",()=>{this.dragTarget.addEventListener("pointerdown",e=>{e.button===0&&(this.dragTarget.setPointerCapture(e.pointerId),this.dragTarget.addEventListener("pointermove",this.onDragMove))})});this.target=e,this.dragTarget=t,this.registerDragger(),n&&(this.position=n)}}class gt extends d.Component{constructor(){super(...arguments);a(this,"panelRef",null);a(this,"dragTargetRef",null);a(this,"onClose",()=>{const{onClose:e}=this.props;e&&e()})}componentDidMount(){const{initPosition:e={x:0,y:0}}=this.props;this.dragTargetRef&&this.panelRef&&new ws(this.panelRef,this.dragTargetRef,e)}render(){const{initPosition:e={x:0,y:0},title:t,className:n,width:o}=this.props;return s.jsxs("div",{className:`float-panel ${n}`,style:{transform:`translate(${e.x}px, ${e.y}px)`,width:o},ref:r=>this.panelRef=r,children:[s.jsxs("div",{className:"panel-title",children:[s.jsx("div",{className:"title-left",children:t}),s.jsx("div",{ref:r=>this.dragTargetRef=r,className:"title-drag-target",style:{width:"50%",height:"100%"}}),s.jsx("div",{className:"title-right",onClick:this.onClose,children:s.jsx("span",{children:s.jsx(Ye,{})})})]}),this.props.children]})}}class Ds extends d.Component{constructor(e){super(e);a(this,"dragStart",e=>{if(e.target.classList.contains("droppable-element")){const t=e.target;e.dataTransfer.setData("type",t.getAttribute("data-type"))}});a(this,"dragover",e=>{e.preventDefault()});a(this,"drop",e=>{e.preventDefault();const t=e.dataTransfer.getData("type");if(!t)return;const{scale:n,dsContentRef:o}=m,r=o==null?void 0:o.getBoundingClientRect(),c=(e.clientX-((r==null?void 0:r.x)||0))/n,u=(e.clientY-((r==null?void 0:r.y)||0))/n;this.addItem(t,[c,u])});a(this,"addItem",(e,t)=>{const{addItem:n}=y;let{maxLevel:o,setMaxLevel:r,setAddRecordCompId:c}=m;const{definitionMap:u}=Vt.getInstance(),{compName:g,width:f=320,height:p=200}=u[e].getBaseInfo();let v={name:g,type:e,x:t[0],y:t[1],id:Gt.generateId(),lock:!1,hide:!1,order:++o,width:f,height:p};c(v.id),r&&r(o),n&&n(v)});a(this,"getChartDom",()=>{let e=[],{classifyKey:t}=ve,{compInfoArr:n,compKey:o}=q;t!=="all"&&(n=n.filter(r=>r.typeKey===t)),o!==""&&(n=n.filter(r=>r.compName.indexOf(o)>=0));for(let r=0;r<n.length;r++){let c=n[r];const{compName:u,compKey:g}=c;let p=ce.getLoader().definitionMap[g].getChartImg();e.push(s.jsx("div",{className:"list-item droppable-element",draggable:!0,onDoubleClick:()=>this.addItem(g),"data-type":g,"data-name":u,children:s.jsxs("div",{style:{pointerEvents:"none"},children:[s.jsxs("div",{className:"item-header",ref:"drag-target",children:[s.jsx("div",{className:"item-name",children:u}),s.jsx("div",{className:"item-type",children:"Antd"})]}),s.jsx("div",{className:"item-content",children:s.jsx("img",{src:p,alt:"组件预览图"})})]})},r+""))}return e});a(this,"onClose",()=>{const{setVisible:e}=q;e&&e(!1)});a(this,"searchChart",e=>{const{setCompKey:t}=q;t&&t(e)});const{doInit:t}=q;t&&t()}componentDidMount(){const e=document.getElementById("designer-ds-content"),t=document.getElementById("component-drag-container");t&&t.addEventListener("dragstart",this.dragStart),e&&e.addEventListener("dragover",this.dragover),e&&e.addEventListener("drop",this.drop)}componentWillUnmount(){const e=document.getElementById("designer-ds-content"),t=document.getElementById("component-drag-container");t&&t.removeEventListener("dragstart",this.dragStart),e&&e.removeEventListener("dragover",this.dragover),e&&e.removeEventListener("drop",this.drop)}render(){return s.jsxs(gt,{className:"comp-list",title:"组件列表",onClose:this.onClose,initPosition:{x:60,y:-window.innerHeight+50},width:190,children:[s.jsx("div",{className:"list-search",children:s.jsx(qe,{placeholder:"搜索图层",onChange:this.searchChart})}),s.jsx("div",{className:"list-items",id:"component-drag-container",children:this.getChartDom()})]})}}const Rs=b(Ds);class Ss extends d.Component{constructor(){super(...arguments);a(this,"floatPanelRef",null);a(this,"layerItemsContainerRef",null);a(this,"cancelSelected",e=>{var n;if(!this.floatPanelRef)return;const{panelRef:t}=this.floatPanelRef;if(t&&t.contains(e.target)&&!((n=this.layerItemsContainerRef)!=null&&n.contains(e.target))){const{setTargetIds:o,targetIds:r}=m;r.length>0&&o([])}});a(this,"onClose",()=>{const{setVisible:e}=ae;e&&e(!1)});a(this,"searchLayer",e=>{const{setContent:t}=ae;t&&t(e)});a(this,"buildLayerList",()=>{const{layerConfigs:e}=y,{searchContent:t}=ae;if(!t||t==="")return Re.buildLayerList(e);let n={};return t===":hide"?Object.values(e).forEach(r=>{r.hide&&r.type!=="group"&&(n[r.id]=r)}):t===":lock"?Object.values(e).forEach(r=>{r.lock&&r.type!=="group"&&(n[r.id]=r)}):Object.values(e).forEach(r=>{var c;(c=r.name)!=null&&c.includes(t)&&r.type!=="group"&&(n[r.id]=r)}),Q.findPathGroupLayer(Object.keys(n)).forEach(r=>{n[r]=e[r]}),Re.buildLayerList(n)})}componentDidMount(){var e,t;(t=(e=this.floatPanelRef)==null?void 0:e.panelRef)==null||t.addEventListener("click",this.cancelSelected)}componentWillUnmount(){var e,t;(t=(e=this.floatPanelRef)==null?void 0:e.panelRef)==null||t.removeEventListener("click",this.cancelSelected)}render(){return s.jsxs(gt,{ref:e=>this.floatPanelRef=e,title:"图层",onClose:this.onClose,initPosition:{x:250,y:-window.innerHeight+50},className:"layer-list",children:[s.jsx("div",{className:"list-search",children:s.jsx(qe,{placeholder:"搜索图层",onChange:this.searchLayer})}),s.jsx("div",{className:"layer-items",children:s.jsx("div",{ref:e=>this.layerItemsContainerRef=e,children:this.buildLayerList()})})]})}}const Es=b(Ss);class zs extends d.Component{render(){const{visible:l}=q,{visible:e}=ae;return s.jsxs(s.Fragment,{children:[l&&s.jsx(Rs,{}),e&&s.jsx(Es,{})]})}}const Is=b(zs);const Os=le.lazy(()=>Ee(()=>import("./index-deca68b0.js").then(i=>i.aK),["assets/index-deca68b0.js","assets/index-18cf7e8b.css"])),Ms=le.lazy(()=>Ee(()=>import("./index-deca68b0.js").then(i=>i.aJ),["assets/index-deca68b0.js","assets/index-18cf7e8b.css"])),Ns=le.lazy(()=>Ee(()=>import("./index-deca68b0.js").then(i=>i.aL),["assets/index-deca68b0.js","assets/index-18cf7e8b.css"]));class Ts extends d.Component{constructor(){super(...arguments);a(this,"buildHeaderList",()=>{let e=[];const{headerItemInstances:t}=ce.getLoader();for(let n=0;n<t.length;n++){const{icon:o,name:r,onClick:c}=t[n];e.push(s.jsx("div",{className:"right-item",onClick:c,children:s.jsxs("span",{className:"item-span",children:[s.jsx(o,{})," ",r]})},n+""))}return e})}render(){const{canvasVisible:e,projectVisible:t,themeVisible:n,bluePrintVisible:o}=Kt,r=this.buildHeaderList();return s.jsxs("div",{className:"designer-header",children:[s.jsx("div",{className:"header-left",children:s.jsx("div",{className:"header-title",children:"LIGHT CHASER"})}),s.jsx("div",{className:"header-right",children:r}),e&&s.jsx(d.Suspense,{fallback:s.jsx(Y,{}),children:s.jsx(Ms,{})}),t&&s.jsx(d.Suspense,{fallback:s.jsx(Y,{}),children:s.jsx(Os,{})}),n&&s.jsx(d.Suspense,{fallback:s.jsx(Y,{}),children:s.jsx(Ns,{})}),o&&s.jsx(d.Suspense,{fallback:s.jsx(Y,{}),children:s.jsx($t,{})})]})}}const Hs=b(Ts);var Se=function(i,l){return Se=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Se(i,l)};function Bs(i,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");Se(i,l);function e(){this.constructor=i}i.prototype=l===null?Object.create(l):(e.prototype=l.prototype,new e)}var Ps=function(i){Bs(l,i);function l(){var t=i!==null&&i.apply(this,arguments)||this;return t.state={scrollPos:0},t.width=0,t.height=0,t._zoom=0,t._rulerScale=0,t._observer=null,t._checkResize=function(){t.resize()},t}var e=l.prototype;return e.render=function(){var t=this.props;return this._zoom=t.zoom,d.createElement("canvas",{ref:Ut(this,"canvasElement"),style:this.props.style})},e.componentDidMount=function(){var t=this.props;this.state.scrollPos=t.defaultScrollPos||0;var n=this.canvasElement,o=n.getContext("2d",{alpha:!1});this.canvasContext=o,t.useResizeObserver?(this._observer=new ResizeObserver(this._checkResize),this._observer.observe(n,{box:"border-box"})):this.resize()},e.componentDidUpdate=function(){this.resize()},e.componentWillUnmount=function(){var t;this.state.scrollPos=0,(t=this._observer)===null||t===void 0||t.disconnect()},e.getScrollPos=function(){return this.state.scrollPos},e.scroll=function(t,n){this.draw(t,n)},e.resize=function(t){var n=this.canvasElement,o=this.props,r=o.width,c=o.height,u=o.scrollPos,g=this._getRulerScale();this.width=r||n.offsetWidth,this.height=c||n.offsetHeight,n.width=this.width*g,n.height=this.height*g,this.draw(u,t)},e.draw=function(t,n){t===void 0&&(t=this.state.scrollPos),n===void 0&&(n=this._zoom),this._zoom=n;var o=this.props,r=o,c=r.unit,u=r.type,g=r.backgroundColor,f=r.lineColor,p=r.textColor,v=r.textBackgroundColor,C=r.direction,M=r.negativeRuler,R=M===void 0?!0:M,he=r.segment,$=he===void 0?10:he,N=r.textFormat,K=r.range,x=K===void 0?[-1/0,1/0]:K,J=r.rangeBackgroundColor,T=r.selectedRanges,ze=r.selectedBackgroundColor,Ie=r.lineWidth,yt=Ie===void 0?1:Ie,xt=r.selectedRangesText,Oe=r.selectedRangesTextColor,Ct=Oe===void 0?"#44aaff":Oe,Me=r.selectedRangesTextOffset,bt=Me===void 0?[0,0]:Me,U=this._getRulerScale(),Z=this.width,ee=this.height,Lt=this.state;Lt.scrollPos=t;var h=this.canvasContext,w=u==="horizontal",Ne=R!==!1,kt=o.font||"10px sans-serif",ye=o.textAlign||"left",jt=o.textOffset||[0,0],xe=w?ee:Z,Ce=De("".concat(o.mainLineSize||"100%"),xe),wt=De("".concat(o.longLineSize||10),xe),Dt=De("".concat(o.shortLineSize||7),xe),S=o.lineOffset||[0,0];switch(g==="transparent"?h.clearRect(0,0,Z*U,ee*U):(h.rect(0,0,Z*U,ee*U),h.fillStyle=g,h.fill()),h.save(),h.scale(U,U),h.strokeStyle=f,h.lineWidth=yt,h.font=kt,h.fillStyle=p,h.textAlign=ye,C){case"start":h.textBaseline="top";break;case"center":h.textBaseline="middle";break;case"end":h.textBaseline="bottom";break}h.translate(.5,0),h.beginPath();for(var be=w?Z:ee,ue=n*c,Le=Math.floor(t*n/ue),Rt=Math.ceil((t*n+be)/ue),Te=Rt-Le,He=Math.max(["left","center","right"].indexOf(ye)-1,-1),E=w?ee:Z,te=[],H=0;H<=Te;++H){var W=(H+Le)*c,ke="".concat(W);N&&(ke=N(W));var St=h.measureText(ke).width;te.push({color:p,offset:jt,backgroundColor:v,value:W,text:ke,textSize:St})}if(ze!=="transparent"&&(T!=null&&T.length)&&T.forEach(function(D){var B=Math.max(D[0],x[0],R?-1/0:0),z=Math.min(D[1],x[1]),se=(B-t)*n,re=(z-B)*n;xt&&D.forEach(function(P){var I="".concat(P);N&&(I=N(P));var _=h.measureText(I).width,O=P*n,fe=O+_;Wt(te,function(X,oe){var A=X.value,Ot=X.textSize,$e=A*n,Mt=$e+Ot;$e<=fe&&O<=Mt&&te.splice(oe,1)}),te.push({value:P,color:Ct,offset:bt,text:I,textSize:_})}),!(re<=0)&&(h.save(),h.fillStyle=ze,w?h.fillRect(se,0,re,E):h.fillRect(0,se,E,re),h.restore())}),J!=="transparent"&&x[0]!==-1/0&&x[1]!==1/0){var Be=(x[0]-t)*n,Pe=(x[1]-x[0])*n;h.save(),h.fillStyle=J,w?h.fillRect(Be,0,Pe,E):h.fillRect(0,Be,E,Pe),h.restore()}for(var H=0;H<=Te;++H){var W=H+Le;if(!(!Ne&&W<0))for(var _e=W*c,Et=(_e-t)*n,F=0;F<$;++F){var ge=Et+F/$*ue,Ae=_e+F/$*c;if(!(ge<0||ge>=be||Ae<x[0]||Ae>x[1])){var pe=F===0?Ce:F%2===0?wt:Dt,ne=0;switch(C){case"start":ne=0;break;case"center":ne=E/2-pe/2;break;case"end":ne=E-pe;break}var Ve=w?[ge+S[0],ne+S[1]]:[ne+S[0],ge+S[1]],je=Ve[0],we=Ve[1],Ge=w?[je,we+pe]:[je+pe,we],zt=Ge[0],It=Ge[1];h.moveTo(je+S[0],we+S[1]),h.lineTo(zt+S[0],It+S[1])}}}h.stroke(),te.forEach(function(D){var B=D.value,z=D.offset,se=D.backgroundColor,re=D.color,P=D.text,I=D.textSize;if(!(!Ne&&B<0)){var _=(B-t)*n;if(!(_<-ue||_>=be+c*n||B<x[0]||B>x[1])){var O=0;switch(C){case"start":O=17;break;case"center":O=E/2;break;case"end":O=E-17;break}var fe=w?[_+He*-3,O]:[O,_+He*3],X=fe[0],oe=fe[1];if(se){var A=0;switch(ye){case"left":A=0;break;case"center":A=-I/2;break;case"right":A=-I;break}h.save(),h.fillStyle=se,w?h.fillRect(X+z[0]+A,0,I,Ce):(h.translate(0,oe+z[1]),h.rotate(-Math.PI/2),h.fillRect(A,0,I,Ce)),h.restore()}h.save(),h.fillStyle=re,w?h.fillText(P,X+z[0],oe+z[1]):(h.translate(X+z[0],oe+z[1]),h.rotate(-Math.PI/2),h.fillText(P,0,0)),h.restore()}}}),h.restore()},e._getRulerScale=function(){var t=this.props.defaultPixelScale||2;if(!this._rulerScale){var n=window.devicePixelRatio>1;if(!n&&window.matchMedia){var o=window.matchMedia("only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen  and (min-device-pixel-ratio: 1.3), only screen and (min-resolution: 1.3dppx)");n=o&&o.matches}this._rulerScale=n?3:t}return this._rulerScale},l.defaultProps={type:"horizontal",zoom:1,width:0,height:0,unit:50,negativeRuler:!0,mainLineSize:"100%",longLineSize:10,shortLineSize:7,segment:10,direction:"end",style:{width:"100%",height:"100%"},backgroundColor:"#333333",font:"10px sans-serif",textColor:"#ffffff",textBackgroundColor:"transparent",lineColor:"#777777",range:[-1/0,1/0],rangeBackgroundColor:"transparent",lineWidth:1,selectedBackgroundColor:"#555555",defaultScrollPos:0},l}(d.PureComponent);const Xe=Ps;class _s extends d.PureComponent{constructor(){super(...arguments);a(this,"state",{render:0});a(this,"rulerX",null);a(this,"rulerY",null);a(this,"unit",50);a(this,"scrollPos",{x:0,y:0});a(this,"baseOffset",20);a(this,"ruleWheel",e=>{const{dsContentRef:t}=m,{x:n,y:o}=t==null?void 0:t.getBoundingClientRect();this.scrollPos.x=-(n-80)/e,this.scrollPos.y=-(o-70)/e,this.unit=Math.floor(50/e),this.setState({render:this.state.render+1})});a(this,"ruleDrag",()=>{const{dsContentRef:e,scale:t}=m,{x:n,y:o}=e==null?void 0:e.getBoundingClientRect();this.scrollPos.x=-(n-80)/t,this.scrollPos.y=-(o-70)/t,this.rulerX&&this.rulerX.scroll(this.scrollPos.x),this.rulerY&&this.rulerY.scroll(this.scrollPos.y)})}componentDidMount(){const{setRuleRef:e}=m;e(this)}render(){const{scale:e}=m;return s.jsxs("div",{className:"lc-ruler",style:{position:"relative"},children:[s.jsx("div",{style:{position:"absolute",width:20,height:20,color:"#838383",textAlign:"center",fontSize:12,top:-1},children:"px"}),s.jsx("div",{className:"lc-ruler-horizontal",style:{height:this.baseOffset,width:`calc(100% - ${this.baseOffset}px)`,position:"relative",left:this.baseOffset},children:s.jsx(Xe,{ref:t=>this.rulerX=t,scrollPos:this.scrollPos.x,zoom:e,lineColor:"#444b4d",textColor:"#a6a6a6",segment:2,negativeRuler:!0,textOffset:[0,10],backgroundColor:"#1f1f1f",unit:this.unit})}),s.jsx("div",{className:"lc-ruler-vertical",style:{width:this.baseOffset,height:window.innerHeight-this.baseOffset-90,position:"relative",overflow:"hidden"},children:s.jsx(Xe,{ref:t=>this.rulerY=t,type:"vertical",scrollPos:this.scrollPos.y,lineColor:"#444b4d",textColor:"#a6a6a6",zoom:e,segment:2,negativeRuler:!0,textOffset:[10,0],backgroundColor:"#1f1f1f",unit:this.unit})}),s.jsx("div",{className:"lc-ruler-content",style:{position:"absolute",overflow:"hidden",top:this.baseOffset,left:this.baseOffset},children:this.props.children})]})}}class As extends d.Component{render(){return s.jsx("div",{style:{outline:"none"},className:"lc-event-container",children:this.props.children})}}class Vs extends d.Component{constructor(e){super(e);a(this,"movableRef",d.createRef());a(this,"onDragStart",e=>{const{target:t,inputEvent:n}=e,{layerConfigs:o}=y,{lock:r}=o[t.id];if(r)return!1;n&&n.shiftKey&&this.setState({throttleDragRotate:90})});a(this,"onDrag",e=>{const{target:t,beforeTranslate:n}=e;t.style.transform=`translate(${n[0]}px, ${n[1]}px)`});a(this,"onDragEnd",e=>{const{updateLayer:t}=y;let{backoff:n,setBackoff:o}=m;const{lastEvent:r,target:c}=e;if(r){const{beforeTranslate:g}=r,f=[{id:c.id,width:c.offsetWidth,height:c.offsetHeight,type:c.dataset.type,x:g[0],y:g[1]}];n?(t(f,!1),o(!1)):ie.doDrag(f);const{updateBaseConfig:p}=me;p(f[0])}const{throttleDragRotate:u}=this.state;u!==0&&this.setState({throttleDragRotate:0})});a(this,"onDragGroupStart",e=>{const{inputEvent:t}=e;t&&t.shiftKey&&this.setState({throttleDragRotate:90})});a(this,"onDragGroup",e=>{const{targets:t}=e,{layerConfigs:n}=y;if(n[t[0].id].lock)return!1;e.events.forEach(r=>r.target.style.transform=r.transform)});a(this,"onDragGroupEnd",e=>{var N;const{targets:t}=e,{updateLayer:n,layerConfigs:o}=y;if(o[t[0].id].lock)return!1;let{backoff:c,setBackoff:u,setGroupCoordinate:g,groupCoordinate:f,targetIds:p}=m,v=[];e.events.forEach(K=>{const{target:x,lastEvent:J}=K;if(J){const{beforeTranslate:T}=J;v.push({id:x.id,width:x.offsetWidth,height:x.offsetHeight,type:x.dataset.type,x:T[0],y:T[1]})}});const C=((N=e==null?void 0:e.lastEvent)==null?void 0:N.beforeTranslate)||[0,0],M=f.minX+C[0],R=f.minY+C[1];g({minX:M,minY:R}),v.length>0&&(c?(n(v,!1),u(!1)):ie.doDrag(v));const{throttleDragRotate:he}=this.state;he!==0&&this.setState({throttleDragRotate:0});const $=Q.findTopGroupLayer(p,!0);if($.length===1){const{updateBaseConfig:K}=me;K({id:$[0],x:Math.round(M),y:Math.round(R)})}});a(this,"onResizeStart",e=>{const{target:t}=e,{layerConfigs:n}=y,{lock:o}=n[t.id];if(o)return!1});a(this,"onResize",e=>{const{target:t,width:n,height:o,drag:r}=e;t.style.width=`${n}px`,t.style.height=`${o}px`,t.style.transform=`translate(${r.beforeTranslate[0]}px, ${r.beforeTranslate[1]}px)`});a(this,"onResizeEnd",e=>{const{updateLayer:t}=y;let{backoff:n,setBackoff:o}=m;const{target:r,lastEvent:c}=e;if(c){const{width:u,height:g,drag:{translate:f},direction:p}=c,v=[{id:r.id,width:u,height:g,type:r.dataset.type,x:f[0],y:f[1]}];n?(t(v,!1),o(!1)):ie.doResize(v,p);const{updateBaseConfig:C}=me;C(v[0])}});a(this,"onResizeGroupStart",e=>{const{targets:t}=e,{layerConfigs:n}=y;if(n[t[0].id].lock)return!1});a(this,"onResizeGroup",e=>{e.events.forEach(t=>{t.target.style.width=`${t.width}px`,t.target.style.height=`${t.height}px`,t.target.style.transform=t.drag.transform})});a(this,"onResizeGroupEnd",e=>{const{updateLayer:t}=y;let{backoff:n,setBackoff:o,targetIds:r}=m,c=[];if(e.events.forEach(f=>{const{target:p,lastEvent:v}=f;if(v){const{drag:{translate:C}}=v;c.push({id:p.id,width:p.offsetWidth,height:p.offsetHeight,type:p.dataset.type,x:C[0],y:C[1]})}}),!e.lastEvent)return;const{dist:u,direction:g}=e.lastEvent;if(c.length>0){n?(t(c,!1),o(!1)):ie.doResize(c,g);const{setGroupCoordinate:f,groupCoordinate:p}=m;g[0]===-1||g[1]===-1?f({minX:p.minX-u[0],minY:p.minY-u[1],groupWidth:p.groupWidth+u[0],groupHeight:p.groupHeight+u[1]}):f({groupWidth:p.groupWidth+u[0],groupHeight:p.groupHeight+u[1]});const v=Q.findTopGroupLayer(r,!0);if(v.length===1){const{updateBaseConfig:C}=me;C({id:v[0],x:Math.round(p.minX),y:Math.round(p.minY),width:Math.round(p.groupWidth),height:Math.round(p.groupHeight)})}}});this.state={throttleDragRotate:0}}componentDidMount(){const{setMovableRef:e}=m;e(this.movableRef)}render(){const{throttleDragRotate:e}=this.state,{selectorRef:t,targets:n}=m,{canvasConfig:{rasterize:o,dragStep:r,resizeStep:c}}=y,u=document.getElementsByClassName("lc-comp-item");return s.jsxs(s.Fragment,{children:[this.props.children,s.jsx(Ft,{ref:this.movableRef,target:n,draggable:!0,resizable:!0,keepRatio:!1,throttleDragRotate:e,maxSnapElementGuidelineDistance:300,snappable:!0,snapGap:!1,snapThreshold:5,isDisplaySnapDigit:!0,snapDirections:{top:!0,right:!0,bottom:!0,left:!0,center:!0,middle:!0},elementSnapDirections:{top:!0,right:!0,bottom:!0,left:!0,center:!0,middle:!0},ables:[$s],dimensionViewable:!0,verticalGuidelines:["0","50%","100%"],horizontalGuidelines:["0","50%","100%"],isDisplayInnerSnapDigit:!0,elementGuidelines:Array.from(u),throttleDrag:o?r:1,throttleResize:o?c:1,onClickGroup:g=>{var f;return(f=t.current)==null?void 0:f.clickTarget(g.inputEvent,g.inputTarget)},onDrag:this.onDrag,onDragStart:this.onDragStart,onDragEnd:this.onDragEnd,onDragGroupStart:this.onDragGroupStart,onDragGroup:this.onDragGroup,onDragGroupEnd:this.onDragGroupEnd,onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeEnd:this.onResizeEnd,onResizeGroupStart:this.onResizeGroupStart,onResizeGroup:this.onResizeGroup,onResizeGroupEnd:this.onResizeGroupEnd})]})}}const Gs=b(Vs),$s={name:"dimensionViewable",props:{dimensionViewable:Boolean},events:{},render(i){const l=i.getRect();return s.jsx("div",{className:"moveable-dimension",style:{left:"-125px",top:"-60px",color:"#cacacaff",fontSize:"14px",position:"absolute",boxSizing:"content-box",borderRadius:"5px",padding:"5px",pointerEvents:"none"},children:s.jsxs("div",{children:[s.jsxs("p",{children:["位置: ",Math.round(l.left)," x ",Math.round(l.top)]}),s.jsxs("p",{children:["尺寸: ",Math.round(l.offsetWidth)," x ",Math.round(l.offsetHeight)]})]})},"dimension-viewer")}};class Ks extends d.Component{constructor(){super(...arguments);a(this,"menuList",[{name:"复制",icon:zn,onClick:Qe},{name:"置顶",icon:jn,onClick:Je},{name:"置底",icon:Vn,onClick:Ze},{name:"删除",icon:Xt,onClick:et},{name:"隐藏",icon:Rn,onClick:tt}]);a(this,"calculateMenus",()=>{var c;const e=[...this.menuList],{targetIds:t}=m;if(t.length===0)return e;const{layerConfigs:n}=y;!!((c=n[t[0]])!=null&&c.lock)?e.push({name:"解锁",icon:Fe,onClick:nt}):e.push({name:"锁定",icon:Fe,onClick:st}),t.length>1&&!Q.hasSameGroup(t)&&e.push({name:"编组",icon:Mn,onClick:rt});let r=Q.findTopGroupLayer(t,!0);return r=r.filter(u=>n[u].type==="group"),r.length>0&&e.push({name:"解组",icon:Pn,onClick:ot}),e});a(this,"buildMenuList",()=>{const e=[],t=this.calculateMenus();for(let n=0;n<t.length;n++){let o=t[n],r=o.icon;e.push(s.jsxs("div",{className:"menu-item",onClick:o.onClick,children:[s.jsx("label",{children:s.jsx(r,{})}),s.jsx("span",{children:o.name})]},n+""))}return e})}render(){const{visible:e,position:t=[0,0]}=de;return s.jsx(s.Fragment,{children:e&&s.jsx("div",{className:"context-menu",style:{position:"fixed",top:t[1],left:t[0]},children:this.buildMenuList()})})}}const Us=b(Ks);var k=(i=>(i[i.SINGLE=0]="SINGLE",i[i.COILED=1]="COILED",i))(k||{});const Ws=["control + s","alt","control + l","control + shift + l","control + h","control + k","control + 1","control + 2","control + 3","control + 4","control + 5","control + g","control + shift + g"];class Fs extends d.Component{constructor(e){super(e);a(this,"handlerMapping",{});a(this,"currHotKey",[]);a(this,"existHandlerKey","");a(this,"specialDomCache",{});a(this,"getSpecialDomCache",e=>{const t=this.specialDomCache[e];if(t)return t;{const n=document.querySelector(e);return n?(this.specialDomCache[e]=n,n):null}});a(this,"doHandler",(e,t)=>{const{handler:n,triggerType:o=0,range:r}=this.handlerMapping[t]||{};if(n&&(o===0&&this.existHandlerKey!==t||o===1)){const{pointerTarget:c}=m;if(r){const u=this.getSpecialDomCache(r);if(!u||!u.contains(c))return}Array.isArray(n)?n.forEach(u=>u(e)):n(e),this.existHandlerKey=t}});a(this,"keyDown",e=>{const t=e.key.toLowerCase();this.currHotKey.some(o=>o===t)||this.currHotKey.push(t);let n=this.currHotKey.join(" + ");Ws.some(o=>o===n)&&e.preventDefault(),this.doHandler(e,n)});a(this,"keyUp",e=>{const t=e.key.toLowerCase();this.currHotKey.some(n=>n===t)&&(this.currHotKey=this.currHotKey.filter(n=>n!==t),this.existHandlerKey="")});a(this,"onBlur",()=>{this.currHotKey=[],this.existHandlerKey=""});this.handlerMapping=e.handlerMapping}componentDidMount(){document.addEventListener("keydown",this.keyDown),document.addEventListener("keyup",this.keyUp),window.onblur=this.onBlur}componentWillUnmount(){document.removeEventListener("keydown",this.keyDown),document.removeEventListener("keyup",this.keyUp),window.onblur=null}render(){return null}}const Xs={"control + a":{handler:Yt,range:".lc-ruler-content"},"control + v":{handler:Qe,range:".lc-ruler-content"},"control + l":{handler:st},"control + shift + l":{handler:nt},"control + h":{handler:tt},"control + arrowup":{handler:Je},"control + arrowdown":{handler:Ze},"control + s":{handler:qt},delete:{handler:[Qt,Jt,et]},"control + z":{handler:Zt,range:".lc-ruler-content"},"control + shift + z":{handler:en,range:".lc-ruler-content"},"control + k":{handler:tn},"control + 1":{handler:nn},"control + 2":{handler:sn},"control + 3":{handler:rn},"control + 4":{handler:on},"control + 5":{handler:an},arrowup:{handler:ln,triggerType:k.COILED,range:".lc-ruler-content"},arrowdown:{handler:cn,triggerType:k.COILED,range:".lc-ruler-content"},arrowleft:{handler:dn,triggerType:k.COILED,range:".lc-ruler-content"},arrowright:{handler:hn,triggerType:k.COILED,range:".lc-ruler-content"},"control + shift + arrowup":{handler:un,triggerType:k.COILED,range:".lc-ruler-content"},"control + shift + arrowdown":{handler:gn,triggerType:k.COILED,range:".lc-ruler-content"},"control + shift + arrowleft":{handler:pn,triggerType:k.COILED,range:".lc-ruler-content"},"control + shift + arrowright":{handler:fn,triggerType:k.COILED,range:".lc-ruler-content"},"control + alt + arrowup":{handler:mn,triggerType:k.COILED,range:".lc-ruler-content"},"control + alt + arrowdown":{handler:vn,triggerType:k.COILED,range:".lc-ruler-content"},"control + alt + arrowleft":{handler:yn,triggerType:k.COILED,range:".lc-ruler-content"},"control + alt + arrowright":{handler:xn,triggerType:k.COILED,range:".lc-ruler-content"},"control + g":{handler:rt},"control + shift + g":{handler:ot}},Ys=b(i=>{const{children:l,onDoubleClick:e}=i,t=le.useRef(null),n=le.useRef(null),{canvasConfig:o}=y;return d.useEffect(()=>{const r=t.current,c=n.current;if(r&&c){const{setDsContentRef:u}=m;u(c);const g=new Cn({container:r,content:c,posOffset:{x:80,y:70},scaleCallback:f=>{const{scale:p,ratio:v}=f,{setScale:C,setRatio:M,rulerRef:R}=m;C(p),M(v),R==null||R.ruleWheel(p)},dragCallback:()=>{const{rulerRef:f}=m;f==null||f.ruleDrag()}});return()=>{g.destroy()}}},[]),s.jsx("div",{className:"designer-ds-container",ref:t,style:{overflow:"hidden",height:window.innerHeight-90,width:window.innerWidth-95,backgroundColor:"#434343",position:"relative"},children:s.jsx("div",{className:"designer-ds-content lc-drag-scale-provider",id:"designer-ds-content",ref:n,onDoubleClick:e,style:{width:o==null?void 0:o.width,height:o==null?void 0:o.height,background:"#1c1c1c",position:"absolute"},children:l})})});class qs extends d.PureComponent{constructor(){super(...arguments);a(this,"updateActive",e=>{const{targetIds:t}=m,{layerConfigs:n}=y;if(t.length===0)return;const o=Q.findTopGroupLayer(t,!0);if(o.length!==1)return;const r=o[0],c=n[r],{activeElem:u,activeConfig:g}=V;r!==u.id&&g(r,c.type)})}render(){const{layerConfigs:e}=y;return s.jsxs(s.Fragment,{children:[s.jsx(As,{children:s.jsx(bn,{children:s.jsx(_s,{children:s.jsx(Ys,{onDoubleClick:this.updateActive,children:s.jsx(Gs,{children:Re.buildCanvasComponents(e)})})})})}),s.jsx(Us,{}),s.jsx(Fs,{handlerMapping:Xs})]})}}const Qs=b(qs);class Js extends d.Component{componentDidMount(){ce.getLoader().load(),Zs()}componentWillUnmount(){er()}render(){const{loaded:l}=y;return l?s.jsxs(Fn,{children:[s.jsx(Gn,{children:s.jsx(Hs,{})}),s.jsxs($n,{children:[s.jsx(Kn,{children:s.jsx(us,{})}),s.jsx(Un,{children:s.jsx(Qs,{})}),s.jsx(Wn,{children:s.jsx(ys,{})})]}),s.jsx(Xn,{children:s.jsx(ks,{})}),s.jsx(Is,{})]}):s.jsx(Y,{})}}const rr=b(Js);function Zs(){document.addEventListener("click",pt),document.addEventListener("contextmenu",ft),document.addEventListener("pointerdown",mt),document.addEventListener("pointerup",vt)}function er(){document.removeEventListener("click",pt),document.removeEventListener("contextmenu",ft),document.removeEventListener("pointerdown",mt),document.removeEventListener("pointerup",vt)}const pt=i=>{const{visible:l,updateVisible:e}=de;l&&i.button===0&&setTimeout(()=>{e(!1)})},ft=i=>{i.preventDefault();const{mouseDownTime:l,mouseUpTime:e,setPosition:t,updateVisible:n}=de,{targetIds:o}=m;let r=["lc-comp-item","moveable-area","layer-item","layer-name","group-header","group-left","group-icon","group-name"];o&&o.length>0&&r.some(c=>i.target.classList.contains(c))&&e-l<200?(n&&n(!0),t([i.clientX,i.clientY])):n&&n(!1)},mt=()=>{const{setMouseDownTime:i}=de;i(Date.now())},vt=i=>{const{setMouseUpTime:l}=de;l(Date.now());const{setPointerTarget:e}=m;e(i.target)};export{rr as default};
