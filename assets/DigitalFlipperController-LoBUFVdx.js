import{A as x,B as F}from"./FontGlobal-OJzIEJBO.js";import{C as b}from"./LayerManager-9_OZ_v7l.js";import{O as S}from"./FetchUtil-FMEOVjjY.js";import{R as N,r as y,j as O}from"./index-CIZzpp4t.js";import"./mobxreact.esm-QmaNsbsC.js";import"./PreviewOpen-ZH2J-uf_.js";import"./index-PQsxm07c.js";import"./index-Ky8VuNT2.js";import"./GlobalMessage-b_IUatJJ.js";import"./MainRouter-LJqlNU58.js";import"./useZIndex-C48Dwtsu.js";var w=function(){return w=Object.assign||function(a){for(var n,e=1,i=arguments.length;e<i;e++)for(var t in n=arguments[e])Object.prototype.hasOwnProperty.call(n,t)&&(a[t]=n[t]);return a},w.apply(this,arguments)},M=function(){function a(n,e,i){var t=this;this.endVal=e,this.options=i,this.version="2.8.0",this.defaults={startVal:0,decimalPlaces:0,duration:2,useEasing:!0,useGrouping:!0,useIndianSeparators:!1,smartEasingThreshold:999,smartEasingAmount:333,separator:",",decimal:".",prefix:"",suffix:"",enableScrollSpy:!1,scrollSpyDelay:200,scrollSpyOnce:!1},this.finalEndVal=null,this.useEasing=!0,this.countDown=!1,this.error="",this.startVal=0,this.paused=!0,this.once=!1,this.count=function(r){t.startTime||(t.startTime=r);var o=r-t.startTime;t.remaining=t.duration-o,t.useEasing?t.countDown?t.frameVal=t.startVal-t.easingFn(o,0,t.startVal-t.endVal,t.duration):t.frameVal=t.easingFn(o,t.startVal,t.endVal-t.startVal,t.duration):t.frameVal=t.startVal+(t.endVal-t.startVal)*(o/t.duration);var c=t.countDown?t.frameVal<t.endVal:t.frameVal>t.endVal;t.frameVal=c?t.endVal:t.frameVal,t.frameVal=Number(t.frameVal.toFixed(t.options.decimalPlaces)),t.printValue(t.frameVal),o<t.duration?t.rAF=requestAnimationFrame(t.count):t.finalEndVal!==null?t.update(t.finalEndVal):t.options.onCompleteCallback&&t.options.onCompleteCallback()},this.formatNumber=function(r){var o,c,h,l,d=r<0?"-":"";o=Math.abs(r).toFixed(t.options.decimalPlaces);var g=(o+="").split(".");if(c=g[0],h=g.length>1?t.options.decimal+g[1]:"",t.options.useGrouping){l="";for(var p=3,m=0,f=0,v=c.length;f<v;++f)t.options.useIndianSeparators&&f===4&&(p=2,m=1),f!==0&&m%p==0&&(l=t.options.separator+l),m++,l=c[v-f-1]+l;c=l}return t.options.numerals&&t.options.numerals.length&&(c=c.replace(/[0-9]/g,function(s){return t.options.numerals[+s]}),h=h.replace(/[0-9]/g,function(s){return t.options.numerals[+s]})),d+t.options.prefix+c+h+t.options.suffix},this.easeOutExpo=function(r,o,c,h){return c*(1-Math.pow(2,-10*r/h))*1024/1023+o},this.options=w(w({},this.defaults),i),this.formattingFn=this.options.formattingFn?this.options.formattingFn:this.formatNumber,this.easingFn=this.options.easingFn?this.options.easingFn:this.easeOutExpo,this.startVal=this.validateValue(this.options.startVal),this.frameVal=this.startVal,this.endVal=this.validateValue(e),this.options.decimalPlaces=Math.max(this.options.decimalPlaces),this.resetDuration(),this.options.separator=String(this.options.separator),this.useEasing=this.options.useEasing,this.options.separator===""&&(this.options.useGrouping=!1),this.el=typeof n=="string"?document.getElementById(n):n,this.el?this.printValue(this.startVal):this.error="[CountUp] target is null or undefined",typeof window<"u"&&this.options.enableScrollSpy&&(this.error?console.error(this.error,n):(window.onScrollFns=window.onScrollFns||[],window.onScrollFns.push(function(){return t.handleScroll(t)}),window.onscroll=function(){window.onScrollFns.forEach(function(r){return r()})},this.handleScroll(this)))}return a.prototype.handleScroll=function(n){if(n&&window&&!n.once){var e=window.innerHeight+window.scrollY,i=n.el.getBoundingClientRect(),t=i.top+window.pageYOffset,r=i.top+i.height+window.pageYOffset;r<e&&r>window.scrollY&&n.paused?(n.paused=!1,setTimeout(function(){return n.start()},n.options.scrollSpyDelay),n.options.scrollSpyOnce&&(n.once=!0)):(window.scrollY>r||t>e)&&!n.paused&&n.reset()}},a.prototype.determineDirectionAndSmartEasing=function(){var n=this.finalEndVal?this.finalEndVal:this.endVal;this.countDown=this.startVal>n;var e=n-this.startVal;if(Math.abs(e)>this.options.smartEasingThreshold&&this.options.useEasing){this.finalEndVal=n;var i=this.countDown?1:-1;this.endVal=n+i*this.options.smartEasingAmount,this.duration=this.duration/2}else this.endVal=n,this.finalEndVal=null;this.finalEndVal!==null?this.useEasing=!1:this.useEasing=this.options.useEasing},a.prototype.start=function(n){this.error||(this.options.onStartCallback&&this.options.onStartCallback(),n&&(this.options.onCompleteCallback=n),this.duration>0?(this.determineDirectionAndSmartEasing(),this.paused=!1,this.rAF=requestAnimationFrame(this.count)):this.printValue(this.endVal))},a.prototype.pauseResume=function(){this.paused?(this.startTime=null,this.duration=this.remaining,this.startVal=this.frameVal,this.determineDirectionAndSmartEasing(),this.rAF=requestAnimationFrame(this.count)):cancelAnimationFrame(this.rAF),this.paused=!this.paused},a.prototype.reset=function(){cancelAnimationFrame(this.rAF),this.paused=!0,this.resetDuration(),this.startVal=this.validateValue(this.options.startVal),this.frameVal=this.startVal,this.printValue(this.startVal)},a.prototype.update=function(n){cancelAnimationFrame(this.rAF),this.startTime=null,this.endVal=this.validateValue(n),this.endVal!==this.frameVal&&(this.startVal=this.frameVal,this.finalEndVal==null&&this.resetDuration(),this.finalEndVal=null,this.determineDirectionAndSmartEasing(),this.rAF=requestAnimationFrame(this.count))},a.prototype.printValue=function(n){var e;if(this.el){var i=this.formattingFn(n);!((e=this.options.plugin)===null||e===void 0)&&e.render?this.options.plugin.render(this.el,i):this.el.tagName==="INPUT"?this.el.value=i:this.el.tagName==="text"||this.el.tagName==="tspan"?this.el.textContent=i:this.el.innerHTML=i}},a.prototype.ensureNumber=function(n){return typeof n=="number"&&!isNaN(n)},a.prototype.validateValue=function(n){var e=Number(n);return this.ensureNumber(e)?e:(this.error="[CountUp] invalid start or end value: ".concat(n),null)},a.prototype.resetDuration=function(){this.startTime=null,this.duration=1e3*Number(this.options.duration),this.remaining=this.duration},a}(),C=function(){return(C=Object.assign||function(a){for(var n,e=1,i=arguments.length;e<i;e++)for(var t in n=arguments[e])Object.prototype.hasOwnProperty.call(n,t)&&(a[t]=n[t]);return a}).apply(this,arguments)},A=window.requestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},R=function(){function a(n){this.version="1.0",this.defaults={duration:.8,lastDigitDelay:.25},this.cell_digits=null,this.options=C(C({},this.defaults),n),this.cell_digits=null}return a.prototype.render=function(n,e){for(var i,t=this.options,r=!1,o=(this.cell_digits||(r=!0,document.querySelector("style[odometer]")||((i=document.createElement("style")).setAttribute("odometer","odometer"),i.innerHTML=".odometer-numbers{display:inline-flex;line-height:100%;overflow-y:hidden}.odometer-numbers>span{display:flex;flex-direction:column;justify-content:start;align-items:center;height:1em;will-change:transform;transform:translateY(0)}",document.head.appendChild(i)),n.innerHTML='<div class="odometer-numbers"></div>',this.cell_digits=[]),'<span style="color:transparent">0</span>'),c="transform ".concat(t.duration,"s ease-out"),h=this.cell_digits.length;h<e.length;h++){var l=document.createElement("span");l.style.transition=c,l.innerHTML=r?"":o,n.firstChild&&n.firstChild.appendChild(l),this.cell_digits.push({container:l,current:void 0,position:r?1:0,new:!0})}function d(s,V){s.position--,s.container.appendChild(V),s.lastTimeAdd=+new Date,s.new?(s.new=!1,A(function(){s.container.style.transform="translateY(".concat(s.position,"em)")})):s.container.style.transform="translateY(".concat(s.position,"em)")}function g(){p=h<e.length?e.charAt(h):null;var s,V,E,T,u=v.cell_digits[h];u.current!=p&&(u.current=p,(m=document.createElement("span")).innerHTML=p===null?o:p,u.container.children.length<4?d(u,m):(V=m,(s=u).nextToAdd&&(d(s,s.nextToAdd),clearTimeout(s.lastTimer),s.nextToAdd=null),E=+new Date,T=1e3*t.lastDigitDelay-(E-s.lastTimeAdd),t.lastDigitDelay<=0||E-s.lastTimeAdd>=1.05*T?(d(s,V),s.nextToAdd=null):(s.nextToAdd=V,s.lastTimer=setTimeout(function(){d(s,s.nextToAdd),s.nextToAdd=null},1e3*t.duration))),clearTimeout(u.timerClean),u.timerClean=setTimeout(function(){u.timerClean=null,u.container.children.length<3||(u.container.style.transition="none",A(function(){for(u.position=-1;1<u.container.children.length;)u.container.removeChild(u.container.firstChild);var D=document.createElement("span");D.innerHTML=o,u.container.insertBefore(D,u.container.firstChild),u.container.style.transform="translateY(".concat(u.position,"em)"),A(function(){u.container.style.transition=c})}))},1e3*((t.duration||.8)+(t.duration||.25))+2500))}for(var p,m,f=Math.max(e.length,this.cell_digits.length),v=this,h=0;h<f;h++)g()},a}();const _=N.forwardRef((a,n)=>{const[e,i]=y.useState({...a}),t=y.useRef({}),r=y.useRef(null);let o;y.useEffect(()=>{var l,d;o=new M(r.current,(l=e.data)==null?void 0:l.staticData,{plugin:((d=e.style)==null?void 0:d.type)==="slide"?new R({duration:1,lastDigitDelay:0}):void 0,duration:1}),o.error?console.error(o.error):o.start()},[]),y.useImperativeHandle(n,()=>({updateConfig:l=>i({...l}),changeData:l=>o.update(l),setEventHandler:l=>t.current=l}));const c=()=>{"click"in t.current&&t.current.click()},{style:h}=e;return O.jsx("div",{ref:r,style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",...h},onClick:c})});class z extends x{async create(n,e){this.config=e,this.container=n,this.instance=await b.createAndRender(n,_,e)}destroy(){this.instance=null,this.config=null}getConfig(){return this.config}changeData(n){var i,t,r;this.config.data.staticData=n,(i=this.instance)==null||i.changeData(n);const e=(r=(t=this.config)==null?void 0:t.base)==null?void 0:r.id;F.triggerComponentEvent(e,"dataChange",n)}update(n,e){var i;this.config=S.merge(this.config,n),e=e||{reRender:!0},e.reRender&&((i=this.instance)==null||i.updateConfig(this.config))}updateTheme(n){}registerEvent(){var e,i,t;const n=(i=(e=this.config)==null?void 0:e.base)==null?void 0:i.id;(t=this.instance)==null||t.setEventHandler({click:()=>F.triggerComponentEvent(n,"click",this.config)})}}export{z as DigitalFlipperController};
