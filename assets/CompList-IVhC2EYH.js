var u=Object.defineProperty;var x=(c,s,t)=>s in c?u(c,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[s]=t;var m=(c,s,t)=>(x(c,typeof s!="symbol"?s+"":s,t),t);import{r as I,j as o}from"./index-4oef3wIY.js";import{o as y}from"./Dialog-tRlQLIuG.js";import{aV as D,j as v,D as j,a as C,e as h,aW as N}from"./LayerManager-O-NHhupi.js";import{I as b}from"./Button-9bpKl4Q-.js";import{k as g}from"./DesignerPage-B4g1DFhg.js";import{D as A}from"./DragAddProvider-_IIQLnDx.js";import"./MainRouter-axq8us8m.js";import"./AntdIcon-ARdFAb9m.js";import"./useZIndex-LzRx996R.js";import"./KeyCode-BWhh4Nhe.js";import"./Overflow-OJAGrMgl.js";import"./GlobalMessage-UTf4T39H.js";import"./FetchUtil-Ivd_z0Im.js";import"./Accordion-KOuhEsi2.js";import"./Switch-OSE5hFL5.js";import"./UIContainer-tcDsE0Wl.js";import"./Radio--M2EB03n.js";import"./ColorPicker-Scvcrhm4.js";import"./CardPanel-Y3EXopJj.js";import"./Grid-UCr4_kvw.js";import"./LayerBuilder-a8E85J3y.js";import"./EyeFilled-4KLsYfpx.js";import"./MonacoEditor--AqMib26.js";import"./PlusOutlined-U8cw8DE4.js";import"./useForceUpdate-65h3fuxG.js";import"./PlusOutlined-VdblB-UP.js";import"./NumberInput-4TNyGGVt.js";import"./Select-Iz7567QR.js";import"./AlertOutlined-gRnvjEw1.js";class L extends I.Component{constructor(t){super(t);m(this,"dragAddProvider",null);m(this,"dragStart",t=>{var e;if(t.target.classList.contains("droppable-element")){const a=t.target;(e=t.dataTransfer)==null||e.setData("type",a.getAttribute("data-type"))}});m(this,"dragover",t=>{t.preventDefault()});m(this,"drop",t=>{var d;t.preventDefault();const e=(d=t.dataTransfer)==null?void 0:d.getData("type");if(!e)return;const{scale:a,dsContentRef:n}=h,i=n==null?void 0:n.getBoundingClientRect(),r=(t.clientX-((i==null?void 0:i.x)||0))/a,p=(t.clientY-((i==null?void 0:i.y)||0))/a;this.addItem(e,[r,p])});m(this,"addItem",(t,e=[0,0])=>{let{setAddRecordCompId:a}=h;const{definitionMap:n}=N,{compName:i,width:r=320,height:p=200}=n[t].getBaseInfo(),d={name:i,type:t,x:Math.round(e[0]),y:Math.round(e[1]),id:D.generateId(),lock:!1,hide:!1,width:r,height:p};a(d.id),v.doAdd(d)});m(this,"getChartDom",()=>{const t=[];let{compInfoArr:e,search:a,categories:n,subCategories:i}=g;n!=="all"&&(e=e.filter(r=>r.categorize===n)),i!=="all"&&(e=e.filter(r=>r.subCategorize===i)),a!==""&&(e=e.filter(r=>r.compName.indexOf(a)>=0));for(let r=0;r<e.length;r++){const p=e[r],{compName:d,compKey:l}=p,f=j.getLoader(C.EDIT).definitionMap[l].getChartImg();t.push(o.jsx("div",{className:"list-item droppable-element",draggable:!0,onDoubleClick:()=>this.addItem(l),"data-type":l,children:o.jsxs("div",{style:{pointerEvents:"none"},children:[o.jsxs("div",{className:"item-header",ref:"drag-target",children:[o.jsx("div",{className:"item-name",children:d}),o.jsx("div",{className:"item-type",children:"Antd"})]}),o.jsx("div",{className:"item-content",children:o.jsx("img",{src:f,alt:d})})]})},r+""))}return t});m(this,"searchChart",t=>{const{setSearch:e}=g;e&&e(t)});const{doInit:e}=g;e&&e()}componentDidMount(){this.dragAddProvider=new A(document.getElementById("component-drag-container"),document.getElementById("designer-ds-content"),this.dragStart,this.dragover,this.drop)}componentWillUnmount(){var t;(t=this.dragAddProvider)==null||t.destroy()}render(){return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"list-search",children:o.jsx(b,{placeholder:"搜索组件",onChange:this.searchChart})}),o.jsx("div",{className:"list-items",id:"component-drag-container",children:this.getChartDom()})]})}}const at=y(L);export{at as default};
