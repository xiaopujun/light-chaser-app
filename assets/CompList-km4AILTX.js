var u=Object.defineProperty;var x=(c,s,t)=>s in c?u(c,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):c[s]=t;var m=(c,s,t)=>(x(c,typeof s!="symbol"?s+"":s,t),t);import{r as I,j as o}from"./index-HCNf1S-V.js";import{o as y}from"./Dialog-SklbesEj.js";import{aV as D,j as v,D as j,a as C,e as h,aW as N}from"./LayerManager-zhrKdHEt.js";import{I as b}from"./Button-JU0EM1ll.js";import{k as g}from"./DesignerPage-CtruaCsh.js";import{D as A}from"./DragAddProvider-_IIQLnDx.js";import"./MainRouter-vXEG6WuJ.js";import"./AntdIcon-ZsdTX9-8.js";import"./useZIndex-xI4tNDcU.js";import"./Overflow-oCu9IEgM.js";import"./GlobalMessage-WoHhAzE1.js";import"./FetchUtil-Ivd_z0Im.js";import"./Accordion-bNaHuwjf.js";import"./Switch-ltkI4ep5.js";import"./Radio-fGyZ8eIZ.js";import"./ColorPicker-S1Y4dxEi.js";import"./CardPanel-KPlWi45L.js";import"./Grid-2ISsVXHm.js";import"./LayerBuilder-uR0poa-Q.js";import"./EyeFilled-8Ru1C7bi.js";import"./MonacoEditor-OepeGIU2.js";import"./PlusOutlined-RaBHomsL.js";import"./useForceUpdate-w-_kjmEd.js";import"./PlusOutlined-VdblB-UP.js";import"./NumberInput-H4OQmJuz.js";import"./Select-zy2IdqAC.js";import"./AlertOutlined-hnW5KvW2.js";class L extends I.Component{constructor(t){super(t);m(this,"dragAddProvider",null);m(this,"dragStart",t=>{var e;if(t.target.classList.contains("droppable-element")){const i=t.target;(e=t.dataTransfer)==null||e.setData("type",i.getAttribute("data-type"))}});m(this,"dragover",t=>{t.preventDefault()});m(this,"drop",t=>{var d;t.preventDefault();const e=(d=t.dataTransfer)==null?void 0:d.getData("type");if(!e)return;const{scale:i,dsContentRef:n}=h,a=n==null?void 0:n.getBoundingClientRect(),r=(t.clientX-((a==null?void 0:a.x)||0))/i,p=(t.clientY-((a==null?void 0:a.y)||0))/i;this.addItem(e,[r,p])});m(this,"addItem",(t,e=[0,0])=>{let{setAddRecordCompId:i}=h;const{definitionMap:n}=N,{compName:a,width:r=320,height:p=200}=n[t].getBaseInfo(),d={name:a,type:t,x:Math.round(e[0]),y:Math.round(e[1]),id:D.generateId(),lock:!1,hide:!1,width:r,height:p};i(d.id),v.doAdd(d)});m(this,"getChartDom",()=>{const t=[];let{compInfoArr:e,search:i,categories:n,subCategories:a}=g;n!=="all"&&(e=e.filter(r=>r.categorize===n)),a!=="all"&&(e=e.filter(r=>r.subCategorize===a)),i!==""&&(e=e.filter(r=>r.compName.indexOf(i)>=0));for(let r=0;r<e.length;r++){const p=e[r],{compName:d,compKey:l}=p,f=j.getLoader(C.EDIT).definitionMap[l].getChartImg();t.push(o.jsx("div",{className:"list-item droppable-element",draggable:!0,onDoubleClick:()=>this.addItem(l),"data-type":l,children:o.jsxs("div",{style:{pointerEvents:"none"},children:[o.jsxs("div",{className:"item-header",ref:"drag-target",children:[o.jsx("div",{className:"item-name",children:d}),o.jsx("div",{className:"item-type",children:"Antd"})]}),o.jsx("div",{className:"item-content",children:o.jsx("img",{src:f,alt:d})})]})},r+""))}return t});m(this,"searchChart",t=>{const{setSearch:e}=g;e&&e(t)});const{doInit:e}=g;e&&e()}componentDidMount(){this.dragAddProvider=new A(document.getElementById("component-drag-container"),document.getElementById("designer-ds-content"),this.dragStart,this.dragover,this.drop)}componentWillUnmount(){var t;(t=this.dragAddProvider)==null||t.destroy()}render(){return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"list-search",children:o.jsx(b,{placeholder:"搜索组件",onChange:this.searchChart})}),o.jsx("div",{className:"list-items",id:"component-drag-container",children:this.getChartDom()})]})}}const ot=y(L);export{ot as default};
