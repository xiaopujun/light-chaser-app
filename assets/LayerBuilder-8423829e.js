var u=Object.defineProperty;var f=(a,s,e)=>s in a?u(a,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[s]=e;var d=(a,s,e)=>(f(a,typeof s!="symbol"?s+"":s,e),e);import{ap as m,j as r,aq as x,ar as g,as as y,at as j,au as L,R as h,U as C,l as b,r as v,L as k,av as E,aw as D,f as I,d as N,ax as w,ay as R,s as F,q as S}from"./index-deca68b0.js";class U extends m{render(){const{name:s="",inputMode:e,lock:t=!1,hide:n=!1,selected:i=!1}=this.state||{};return r.jsxs("div",{className:`layer-item ${i?"layer-selected":n?"layer-hide":t?"layer-lock":""}`,onClick:this.onSelected,onDoubleClick:this.openInput,children:[r.jsx("div",{className:"layer-name",children:e?r.jsx("input",{type:"text",defaultValue:s,autoFocus:!0,onChange:this.changeLayerName,onKeyDown:o=>{o.code==="Enter"&&this.closeInput()},onBlur:this.closeInput}):s}),r.jsxs("div",{className:"layer-operators",children:[r.jsx("div",{className:"layer-operator",onClick:this.openInput,children:r.jsx(x,{})}),r.jsx("div",{className:"layer-operator",onClick:this.toggleHide,children:n?r.jsx(g,{}):r.jsx(y,{})}),r.jsx("div",{className:"layer-operator",onClick:this.toggleLock,children:t?r.jsx(j,{}):r.jsx(L,{})})]})]})}}var p;class A extends h.PureComponent{constructor(){super(...arguments);d(this,"ref",null);d(this,"mode",((p=C.parseUrlParams())==null?void 0:p.action)||"edit")}componentDidMount(){const{layer:e}=this.props;b.doAdd(this.ref,e)}render(){const{layer:e}=this.props,{auxiliaryBorder:t}=E;return r.jsx(v.Suspense,{fallback:r.jsx(k,{}),children:r.jsx("div",{id:e.id,"data-type":e.type,"data-lock":e.lock,"data-hide":e.hide,style:{width:e.width,height:e.height,transform:`translate(${e.x}px, ${e.y}px)`,position:"absolute",display:e.hide?"none":"block",border:t?"1px solid #65eafc":"none"},className:"lc-comp-item",children:r.jsx("div",{ref:n=>this.ref=n,style:{width:"100%",height:"100%",pointerEvents:`${this.mode==="view"?"auto":"none"}`,position:"relative"}})},e.id+"")})}}class B extends D{constructor(s,e,t){super(),this.container=s,this.config=e,this.instance=t}async create(s,e){return this}getConfig(){return this.config}update(s,e){}}class O extends h.PureComponent{constructor(){super(...arguments);d(this,"groupLayerRef",null)}componentDidMount(){const{layer:e}=this.props,{elemConfigs:t,compInstances:n}=N;let i=I.getLoader().definitionMap.group,o;e.id in t?o=t[e.id]:e.id in n?o=n[e.id].getConfig():(o=i.getInitConfig(),o.base.id=e.id),n[e.id]=new B(this.groupLayerRef,o,this)}render(){return r.jsx("div",{className:"component-group",ref:e=>this.groupLayerRef=e,style:{position:"absolute"},children:this.props.children})}}class P{constructor(){d(this,"parser",(s,e=1)=>{s=w.cloneDeep(s);let t;e===1?t=Object.values(s).sort((i,o)=>o.order-i.order):t=Object.values(s).sort((i,o)=>i.order-o.order);const n=[];for(const i of t)if(!(i!=null&&i.pid))n.push(i);else{const o=s[i.pid];o&&(o.children=o.children||[],o.children.push(i))}return n});d(this,"buildLayerList",s=>{const e=[];return this.parser(s,1).forEach(t=>{e.push(this.buildLayer(t))}),e});d(this,"buildLayer",s=>{const{type:e,children:t}=s,{targetIds:n}=F,{layerInstances:i}=S;let o={key:s.id,name:s.name,lock:s.lock,hide:s.hide,compId:s.id,type:s.type,selected:n.includes(s.id)};if(e==="group"){const l=[];return t==null||t.forEach(c=>{l.push(this.buildLayer(c))}),r.jsx(R,{...o,ref:c=>i[s.id]=c,children:l})}else return r.jsx(U,{...o,ref:l=>i[s.id]=l})});d(this,"buildCanvasComponents",s=>{const e=[];return this.parser(s,0).forEach(t=>{e.push(this.buildComponents(t))}),e});d(this,"buildComponents",s=>{const{type:e,children:t}=s;if(e==="group"){const n=[];return t==null||t.forEach(i=>{n.push(this.buildComponents(i))}),r.jsx(O,{layer:s,children:n},s.id)}else return r.jsx(A,{layer:s},s.id)})}}const q=new P;export{q as l};
