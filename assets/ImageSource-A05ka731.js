import{r as p,j as a}from"./index-qpgUsgf4.js";import{aV as M,j as A,U as x,o as y,e as I,l as C,aW as S}from"./LayerManager-SijuLkyZ.js";import{D as B}from"./DragAddProvider-_IIQLnDx.js";import{P as E,M as R}from"./DesignerPage-Tcw87H0t.js";import{Q as O}from"./UIContainer-NqFQXah1.js";import"./Dialog-fCvBoQ8s.js";import"./MainRouter-hTbgP2_-.js";import"./AntdIcon-ivfCf0x2.js";import"./useZIndex-06b_ptW1.js";import"./KeyCode-YcuPRYAO.js";import"./Overflow-oAlFaljK.js";import"./GlobalMessage--_KJnNPS.js";import"./FetchUtil-Ivd_z0Im.js";import"./Accordion-Fkd2Gg_g.js";import"./Switch-hw7ERO3O.js";import"./Radio-7Z4qZSfI.js";import"./ColorPicker-yP6MOfjy.js";import"./CardPanel-ZSj37rdp.js";import"./Button-QtVDhbOy.js";import"./Grid-F1N_QB8k.js";import"./LayerBuilder-7iRn_Aha.js";import"./EyeFilled-dC2C_wYn.js";import"./MonacoEditor-nc_PY9ES.js";import"./PlusOutlined-bZDk4_TR.js";import"./useForceUpdate-d-uDBTk3.js";import"./PlusOutlined-VdblB-UP.js";import"./NumberInput-ID5k26Sn.js";import"./Select-USaBC3o5.js";import"./AlertOutlined-g-zb-Nsw.js";function le(){const[j,v]=p.useState([]),g=p.useRef(null),D=e=>{var t,r;if(e.target.classList.contains("droppable-element")){const i=e.target;(t=e.dataTransfer)==null||t.setData("imageUrl",i.getAttribute("data-url")),(r=e.dataTransfer)==null||r.setData("imageHash",i.getAttribute("data-hash"))}},b=e=>{e.preventDefault()},N=e=>{var n,d;e.preventDefault();const t=(n=e.dataTransfer)==null?void 0:n.getData("imageUrl"),r=(d=e.dataTransfer)==null?void 0:d.getData("imageHash");if(!t)return;const{scale:i,dsContentRef:o}=I,s=o==null?void 0:o.getBoundingClientRect(),l=(e.clientX-((s==null?void 0:s.x)||0))/i,m=(e.clientY-((s==null?void 0:s.y)||0))/i;T("BaseImage",[l,m],t,r)},T=(e,t=[0,0],r,i)=>{const{elemConfigs:o}=C;let{setAddRecordCompId:s}=I;const{definitionMap:l}=S,m=l[e],{compName:n,width:d=320,height:L=200}=m.getBaseInfo(),h=M.generateId(),f={name:n,type:e,x:Math.round(t[0]),y:Math.round(t[1]),id:h,lock:!1,hide:!1,width:d,height:L};s(f.id),A.doAdd(f);const c=m.getInitConfig();c.style.type="local",c.style.localUrl=r,c.style.hash=i,o[h]=c},u=()=>{const{saveType:e,id:t}=x.parseUrlParams();y[e].getImageSourceList(t).then(r=>{v(r)})};p.useEffect(()=>(u(),g.current=new B(document.getElementById("image-source-list"),document.getElementById("designer-ds-content"),D,b,N),()=>{var e;return(e=g.current)==null?void 0:e.destroy()}),[]);const U=e=>{const{saveType:t}=x.parseUrlParams();y[t].delImageSource(e).then(r=>{r&&u()})};return a.jsx("div",{className:"image-source",children:a.jsx("div",{className:"image-source-list",id:"image-source-list",children:j.map((e,t)=>a.jsxs("div",{className:"image-source-item droppable-element",draggable:!0,"data-url":e.url,"data-hash":e.hash,children:[a.jsxs("div",{className:"image-source-item-header",children:[a.jsx("div",{className:"isi-title",children:e.name||"无名称信息"}),a.jsx("div",{className:"isi-operate",children:a.jsx(E,{title:"确认删除吗?",icon:a.jsx(O,{style:{color:"red"}}),description:"可能会导致已经使用的图片组件失效!",onConfirm:()=>U(e.id),okText:"是",cancelText:"否",children:a.jsx(R,{})})})]}),a.jsx("div",{className:"image-source-item-body",children:a.jsx("div",{className:"item-bg-image",style:{backgroundImage:`url(${e.url})`}})})]},t))})})}export{le as default};
