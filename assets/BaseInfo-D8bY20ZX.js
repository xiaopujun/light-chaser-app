var x=Object.defineProperty;var R=(d,n,e)=>n in d?x(d,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[n]=e;var h=(d,n,e)=>R(d,typeof n!="symbol"?n+"":n,e);import{r as k,j as r}from"./index-CRmipDYU.js";import{aH as y,b as C,e as o,c as u,aX as q,aY as w,aZ as L,a_ as I,a$ as j,b0 as z,aL as T,r as M,l as g,aP as b,j as A}from"./ViewDesignerLoader-2ZaNa5mi.js";import{I as S}from"./Info-DO9d8Fe8.js";import"./mobxreact.esm-Dn-2uaKK.js";import"./MainRouter-YUPEgR3T.js";import"./ContextIsolator-urbVMzjK.js";import"./asyncToGenerator-BFUSLXIu.js";import"./Compact-DviqQn_7.js";import"./pickAttrs-CXqQwhCc.js";import"./useZIndex-BpUNPx7g.js";import"./button--wGDZYGC.js";import"./render-UMYzhqKr.js";import"./NumberInput-DwA_3ebS.js";import"./zoom-dHXOCKV3.js";import"./index-Di7-uBEQ.js";import"./index-C0HpoK0x.js";import"./GlobalMessage-CFWlAJYU.js";import"./FetchUtil-BuJzlMo4.js";import"./index-FhfevFry.js";import"./index-BoLfqrWA.js";import"./Data-DU404C66.js";import"./collapse-BbEVqHco.js";class ae extends k.Component{constructor(e){super(e);h(this,"init",()=>{var s;const{activeElem:e}=M,{layerConfigs:t}=g,i=t[e.id];if(i)if(i.type==="group"){const a=y.findAllChildLayer([i.id]).filter(c=>t[c].type!=="group"),l=this.calculateGroupRect(a);this.state={...i,...l}}else{const a=(s=C.definitionMap[i.type])==null?void 0:s.getBaseInfo();this.state={...i,version:a==null?void 0:a.version}}});h(this,"calculateGroupRect",e=>{const{layerConfigs:t}=g;let i=1/0,s=1/0,a=-1/0,l=-1/0;return e.forEach(c=>{const{x:m=0,y:p=0,width:f=0,height:v=0}=t[c];i=Math.min(i,m),s=Math.min(s,p),a=Math.max(a,m+f),l=Math.max(l,p+v)}),{x:i,y:s,width:a-i,height:l-s}});h(this,"changeName",e=>{const{controller:t}=this.props;t.update({base:{name:e}},{reRender:!1});const{updateLayer:i}=g;i&&i([{id:this.state.id,name:e}]);const{layerInstances:s}=A,a=s[this.state.id];a&&a.setState({name:e})});h(this,"handleMap",{name:this.changeName,width:e=>{var t;return(t=o.movableRef)==null?void 0:t.request("resizable",{offsetWidth:e,direction:[1,1]},!0)},height:e=>{var t;return(t=o.movableRef)==null?void 0:t.request("resizable",{offsetHeight:e,direction:[1,1]},!0)},posX:e=>{var t;return(t=o.movableRef)==null?void 0:t.request("draggable",{x:e},!0)},posY:e=>{var t;return(t=o.movableRef)==null?void 0:t.request("draggable",{y:e},!0)},align:e=>this.handleMap[e](),left:()=>{var e;return(e=o.movableRef)==null?void 0:e.request("draggable",{x:0},!0)},horizontally:()=>{var e;return(e=o.movableRef)==null?void 0:e.request("draggable",{x:u.canvasConfig.width/2-this.state.width/2},!0)},right:()=>{var e;return(e=o.movableRef)==null?void 0:e.request("draggable",{x:u.canvasConfig.width-this.state.width},!0)},top:()=>{var e;return(e=o.movableRef)==null?void 0:e.request("draggable",{y:0},!0)},vertically:()=>{var e;return(e=o.movableRef)==null?void 0:e.request("draggable",{y:u.canvasConfig.height/2-this.state.height/2},!0)},bottom:()=>{var e;return(e=o.movableRef)==null?void 0:e.request("draggable",{y:u.canvasConfig.height-this.state.height},!0)}});h(this,"onFieldChange",e=>{const{id:t,data:i}=e,{targetIds:s,setTargetIds:a}=o;if(!s.includes(this.state.id)){const{type:c}=this.state;if(c==="group"){const{layerConfigs:m}=g,p=y.findAllChildLayer([this.state.id]).filter(f=>m[f].type!=="group");a(p)}else a([this.state.id])}const l=setTimeout(()=>{this.handleMap[t](i),clearTimeout(l)},1)});h(this,"buildSchema",()=>{const{name:e,width:t,height:i,x:s,y:a}=this.state;return{type:"grid",children:[{id:"name",key:"name",label:"名称",type:"input",value:e},{id:"width",key:"width",type:"number-input",label:"宽度",value:t,reRender:!0},{id:"height",key:"height",type:"number-input",label:"高度",value:i,reRender:!0},{id:"posX",key:"posX",type:"number-input",label:"X轴",reRender:!0,value:s},{id:"posY",key:"posY",type:"number-input",label:"Y轴",reRender:!0,value:a},{id:"align",label:"对齐",type:"group-button",config:{items:[{value:"left",content:r.jsx(q,{theme:"filled",size:"14",strokeWidth:2,strokeLinecap:"square"})},{value:"horizontally",content:r.jsx(w,{theme:"filled",size:"14",strokeWidth:2,strokeLinecap:"square"})},{value:"right",content:r.jsx(L,{theme:"filled",size:"14",strokeWidth:2,strokeLinecap:"square"})},{value:"top",content:r.jsx(I,{theme:"filled",size:"14",strokeWidth:2,strokeLinecap:"square"})},{value:"vertically",content:r.jsx(j,{theme:"filled",size:"14",strokeWidth:2,strokeLinecap:"square"})},{value:"bottom",content:r.jsx(z,{theme:"filled",size:"14",strokeWidth:2,strokeLinecap:"square"})}]}}]}});this.init()}componentDidMount(){const{setBaseConfigRef:e}=b;e&&e(this)}componentWillUnmount(){const{setBaseConfigRef:e}=b;e&&e(null)}render(){const{type:e,version:t}=this.state,i=this.buildSchema();return r.jsxs("div",{className:"base-info-config",children:[r.jsx("div",{className:"version-info",children:r.jsxs("span",{children:[r.jsx(S,{})," ",e," | ",t?`版本: ${t}`:"无版本信息"]})}),r.jsx(T,{schema:i,onFieldChange:this.onFieldChange})]})}}export{ae as default};
