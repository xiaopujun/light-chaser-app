var D=Object.defineProperty;var y=(d,n,s)=>n in d?D(d,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):d[n]=s;var l=(d,n,s)=>(y(d,typeof n!="symbol"?n+"":n,s),s);import{r as w,j as e,D as f,G as I,I as m,S,B as p,E as x,d as k,a as v,b,U as u,m as L,P as N}from"./index-c6beea45.js";class O extends w.Component{constructor(){super(...arguments);l(this,"projectInfo",{name:"",description:"",width:500,height:300});l(this,"onOk",s=>{s.preventDefault();const{onOk:t}=this.props;t&&t(this.projectInfo)});l(this,"onCancel",()=>{console.log("关闭");const{onCancel:s}=this.props;s&&s()})}render(){const{visible:s=!1}=this.props;return e.jsx(f,{title:"新建大屏",visible:s,className:"add-new-screen-dialog",onClose:this.onCancel,children:e.jsxs("form",{onSubmit:this.onOk,children:[e.jsx("div",{className:"lc-add-new-screen",children:e.jsxs(I,{gridGap:"15px",columns:2,children:[e.jsx(m,{label:"名称",required:!0,maxLength:20,onChange:t=>this.projectInfo.name=t}),e.jsx(m,{label:"描述",maxLength:20,onChange:t=>this.projectInfo.description=t}),e.jsx(m,{label:"宽度",type:"number",min:300,required:!0,onChange:t=>this.projectInfo.width=t}),e.jsx(m,{label:"高度",type:"number",min:300,required:!0,onChange:t=>this.projectInfo.height=t}),e.jsx(S,{label:"存储",options:[{value:"1",label:"本地存储"}],defaultValue:"1"})]})}),e.jsxs("div",{className:"add-new-screen-explain",children:[e.jsx("p",{children:"说明："}),e.jsx("p",{children:"1、名称不超过20字，描述不超过60字"}),e.jsx("p",{children:"2、宽度必须≥500，高度必须≥300"})]}),e.jsxs("div",{className:"add-new-screen-footer",children:[e.jsx(p,{type:"submit",children:"保存"}),e.jsx(p,{onClick:this.onCancel,children:"取消"})]})]})})}}const P="/light-chaser-app/assets/list-bottom-e885eb79.svg",T="/light-chaser-app/assets/template-market-4ee17aa3.svg",U="/light-chaser-app/assets/datasource-25bd5cdf.svg",B="/light-chaser-app/assets/list-del-da838707.svg",A="/light-chaser-app/assets/list-display-4253bff9.svg",E="/light-chaser-app/assets/list-edit-ef857085.svg",$="/light-chaser-app/assets/list-clone-e7d88f3c.svg";class G extends w.Component{constructor(){super(...arguments);l(this,"state",{showAddDialog:!1,showDelDialog:!1,showCloneDialog:!1,addNewData:{},data:[],imageIdToUrl:{}});l(this,"toBeDelId","");l(this,"toBeCloneId","");l(this,"loadProjectList",()=>{x.getInstance().scannerProjectOperators();const{projectConfig:{saveType:s=v.LOCAL}}=k;x.getInstance().abstractOperatorMap[s].getProjectSimpleInfoList().then(t=>{if(t&&t.length>0){this.setState({data:t});let o=[];t.forEach(i=>{let h=i.screenshot;h&&h!==""&&o.push(h)});const r=o.map(i=>b.getImageFromLocalWithKey(i));let c={};Promise.all(r).then(i=>{i.forEach(h=>{const a=Object.keys(h)[0];c[a]=h[a]}),this.setState({imageIdToUrl:c})})}})});l(this,"toggleNewProVisible",()=>{const{addNewScreen:s}=this.state;this.setState({addNewScreen:!s})});l(this,"onOk",s=>{let t=u.buildUrlParams({...s,action:"create"});this.setState({addNewScreen:!1}),window.open(`/light-chaser-app/#/designer?${t}`,"_blank")});l(this,"onCancel",()=>this.setState({addNewScreen:!1}));l(this,"operateHandler",s=>{const{type:t,savetype:o}=s.target.dataset;if(!t)return;let r=s.currentTarget.id;switch(t){case"edit":let c=u.buildUrlParams({id:r,action:"edit"});window.open(`/light-chaser-app/#/designer?${c}`,"_blank");break;case"show":window.open(`/light-chaser-app/#/view?id=${r}&saveType=${o}&action=view`,"_blank");break;case"del":this.toBeDelId=r,this.setState({showDelDialog:!0});break;case"clone":this.toBeCloneId=r,this.setState({showCloneDialog:!0});break}});l(this,"confirmDel",()=>{x.getInstance().abstractOperatorMap[v.LOCAL].deleteProject(this.toBeDelId);let{data:s}=this.state;s=s.filter(t=>t.id!==this.toBeDelId),this.setState({data:s,showDelDialog:!1})});l(this,"cancelDel",()=>{this.setState({showDelDialog:!1})});l(this,"confirmClone",s=>{const t=x.getInstance().abstractOperatorMap[v.LOCAL];t.copyProject(this.toBeCloneId,s).then(o=>{t.getProjectSimpleInfoList().then(r=>{const c=r.filter(i=>i.id===o);b.getImageFromLocalWithKey(c[0].screenshot).then(i=>{L.success("克隆成功"),this.setState({data:[...this.state.data,...c],imageIdToUrl:{...this.state.imageIdToUrl,...i},showCloneDialog:!1})})})})});l(this,"cancelClone",()=>{this.setState({showCloneDialog:!1})})}componentDidMount(){this.loadProjectList()}render(){const{addNewScreen:s,data:t,imageIdToUrl:o,showDelDialog:r,showCloneDialog:c}=this.state;let i=(window.innerWidth-230-5*20)/5,h=i*(9/16);return e.jsxs("div",{className:"lc-console",children:[e.jsx("div",{className:"console-head",children:e.jsx("div",{className:"console-head-title",children:"LC 控制台"})}),e.jsxs("div",{className:"console-body",children:[e.jsxs("div",{className:"console-list",children:[e.jsxs("div",{className:"console-list-item",children:[e.jsx("div",{className:"item-icon",children:e.jsx("img",{src:P,alt:"项目列表"})}),e.jsx("div",{className:"item-text",children:"项目列表"})]}),e.jsxs("div",{className:"console-list-item",children:[e.jsx("div",{className:"item-icon",children:e.jsx("img",{src:U,alt:"数据源管理"})}),e.jsx("div",{className:"item-text",children:"数据源管理"})]}),e.jsxs("div",{className:"console-list-item",children:[e.jsx("div",{className:"item-icon",children:e.jsx("img",{src:T,alt:"模板市场"})}),e.jsx("div",{className:"item-text",children:"模板市场"})]})]}),e.jsx("div",{className:"console-content",children:e.jsx("div",{className:"content-body",children:e.jsxs("div",{className:"project-list",children:[e.jsx("div",{style:{width:i,height:h,margin:"0 20px 20px 0"},children:e.jsx(p,{onClick:this.toggleNewProVisible,style:{width:i,height:h,fontSize:20},children:"+ 新建项目"})}),t&&t.map(a=>{let C=o[a==null?void 0:a.screenshot],j,g;return a.state===N.DRAFT?(j="草稿",g="#FFB800"):a.state===N.PUBLISH&&(j="已发布",g="#00CC66"),e.jsxs("div",{style:{width:i,height:h,backgroundImage:C&&`url(${C})`},onClick:this.operateHandler,id:a.id+"",className:"project-item",children:[e.jsxs("div",{className:"pro-list-content",style:{zIndex:1},children:[e.jsx("div",{className:"pro-content-title",children:a==null?void 0:a.name}),e.jsxs("div",{className:"pro-content-operates",children:[e.jsx("div",{className:"operate-item","data-type":"edit",children:e.jsx("img",{src:E,alt:"编辑"})}),e.jsx("div",{className:"operate-item","data-type":"show","data-savetype":a.saveType,children:e.jsx("img",{src:A,alt:"展示"})}),e.jsx("div",{className:"operate-item","data-type":"del",children:e.jsx("img",{src:B,alt:"删除"})}),e.jsx("div",{className:"operate-item","data-type":"clone",children:e.jsx("img",{src:$,alt:"克隆"})})]})]}),e.jsxs("div",{className:"pro-content-footer",children:[e.jsx("div",{className:"state-point",style:{backgroundColor:g}}),e.jsx("div",{className:"state-text",style:{color:g},children:j})]})]},a.id+"")})]})})})]}),e.jsx(O,{onOk:this.onOk,onCancel:this.onCancel,visible:s}),e.jsx(F,{visible:r,onOk:this.confirmDel,onCancel:this.cancelDel}),e.jsx(M,{onOk:a=>this.confirmClone(a),onCancel:this.cancelClone,visible:c})]})}}const F=d=>{const{onOk:n,onCancel:s,visible:t}=d;return e.jsxs(f,{title:"删除确认",visible:t,onClose:s,children:[e.jsx("div",{style:{color:"#aeaeae",padding:10},children:"确定要删除该项目吗？"}),e.jsxs("div",{className:"del-pro-confirm",style:{display:"flex",justifyContent:"flex-end",borderTop:"2px solid #272b34",paddingTop:5},children:[e.jsx(p,{onClick:n,children:"确认"}),e.jsx(p,{onClick:s,children:"取消"})]})]})},M=d=>{const{onOk:n,onCancel:s,visible:t}=d;let o="";const r=c=>{console.log(o),c.preventDefault(),n(o)};return e.jsx(f,{title:"克隆项目",visible:t,onClose:s,children:e.jsxs("form",{onSubmit:r,children:[e.jsx(m,{label:"项目名称",required:!0,defaultValue:o,onChange:c=>o=c}),e.jsxs("div",{className:"del-pro-confirm",style:{display:"flex",justifyContent:"flex-end",borderTop:"2px solid #272b34",paddingTop:10},children:[e.jsx(p,{type:"submit",children:"确认"}),e.jsx(p,{onClick:s,children:"取消"})]})]})})};export{G as default};
