import{r as v,j as P}from"./index-uVTr4DkP.js";import{P as Xe,I as oe,aU as Fe,e as F,a as Ce}from"./LayerManager-4wFtoUMN.js";import"./LCGUI-Ssa8gIoP.js";import"./UIContainer-QclyxjV1.js";import"./index-M4LYRhyC.js";import"./MainRouter-g_j_Is0t.js";import"./useZIndex-GVasLPt8.js";import"./FetchUtil-Ivd_z0Im.js";import"./LocalOperator-7SvlDKB4.js";import"./GlobalMessage-JdhJioSt.js";import"./Data-UXmzX42n.js";import"./Accordion-NfD7KWQm.js";import"./Switch-QMPoZeAy.js";import"./Right-qoStPUum.js";import"./Radio-sQVTRydY.js";import"./index-kdYyXKyi.js";var ae=function(l,a){return ae=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,t){o.__proto__=t}||function(o,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(o[r]=t[r])},ae(l,a)};function Ye(l,a){if(typeof a!="function"&&a!==null)throw new TypeError("Class extends value "+String(a)+" is not a constructor or null");ae(l,a);function o(){this.constructor=l}l.prototype=a===null?Object.create(a):(o.prototype=a.prototype,new o)}var $e=function(l){Ye(a,l);function a(){var t=l!==null&&l.apply(this,arguments)||this;return t.state={scrollPos:0},t.width=0,t.height=0,t._zoom=0,t._rulerScale=0,t._observer=null,t._checkResize=function(){t.resize()},t}var o=a.prototype;return o.render=function(){var t=this.props;return this._zoom=t.zoom,v.createElement("canvas",{ref:Xe(this,"canvasElement"),style:this.props.style})},o.componentDidMount=function(){var t=this.props;this.state.scrollPos=t.defaultScrollPos||0;var r=this.canvasElement,n=r.getContext("2d",{alpha:!1});this.canvasContext=n,t.useResizeObserver?(this._observer=new ResizeObserver(this._checkResize),this._observer.observe(r,{box:"border-box"})):this.resize()},o.componentDidUpdate=function(){this.resize()},o.componentWillUnmount=function(){var t;this.state.scrollPos=0,(t=this._observer)===null||t===void 0||t.disconnect()},o.getScrollPos=function(){return this.state.scrollPos},o.scroll=function(t,r){this.draw(t,r)},o.resize=function(t){var r=this.canvasElement,n=this.props,i=n.width,h=n.height,L=n.scrollPos,g=this._getRulerScale();this.width=i||r.offsetWidth,this.height=h||r.offsetHeight,r.width=this.width*g,r.height=this.height*g,this.draw(L,t)},o.draw=function(t,r){t===void 0&&(t=this.state.scrollPos),r===void 0&&(r=this._zoom),this._zoom=r;var n=this.props,i=n,h=i.unit,L=i.type,g=i.backgroundColor,s=i.lineColor,d=i.textColor,p=i.textBackgroundColor,w=i.direction,B=i.negativeRuler,O=B===void 0?!0:B,se=i.segment,Q=se===void 0?10:se,Y=i.textFormat,le=i.range,c=le===void 0?[-1/0,1/0]:le,ce=i.rangeBackgroundColor,$=i.selectedRanges,fe=i.selectedBackgroundColor,ue=i.lineWidth,_e=ue===void 0?1:ue,ke=i.selectedRangesText,ve=i.selectedRangesTextColor,Pe=ve===void 0?"#44aaff":ve,he=i.selectedRangesTextOffset,Be=he===void 0?[0,0]:he,T=this._getRulerScale(),W=this.width,j=this.height,Oe=this.state;Oe.scrollPos=t;var e=this.canvasContext,f=L==="horizontal",de=O!==!1,Te=n.font||"10px sans-serif",V=n.textAlign||"left",Ee=n.textOffset||[0,0],q=f?j:W,Z=oe("".concat(n.mainLineSize||"100%"),q),Me=oe("".concat(n.longLineSize||10),q),Ie=oe("".concat(n.shortLineSize||7),q),x=n.lineOffset||[0,0];switch(g==="transparent"?e.clearRect(0,0,W*T,j*T):(e.rect(0,0,W*T,j*T),e.fillStyle=g,e.fill()),e.save(),e.scale(T,T),e.strokeStyle=s,e.lineWidth=_e,e.font=Te,e.fillStyle=d,e.textAlign=V,w){case"start":e.textBaseline="top";break;case"center":e.textBaseline="middle";break;case"end":e.textBaseline="bottom";break}e.translate(.5,0),e.beginPath();for(var ee=f?W:j,H=r*h,te=Math.floor(t*r/H),Le=Math.ceil((t*r+ee)/H),pe=Le-te,ge=Math.max(["left","center","right"].indexOf(V)-1,-1),m=f?j:W,A=[],z=0;z<=pe;++z){var E=(z+te)*h,re="".concat(E);Y&&(re=Y(E));var We=e.measureText(re).width;A.push({color:d,offset:Ee,backgroundColor:p,value:E,text:re,textSize:We})}if(fe!=="transparent"&&($!=null&&$.length)&&$.forEach(function(u){var C=Math.max(u[0],c[0],O?-1/0:0),y=Math.min(u[1],c[1]),U=(C-t)*r,D=(y-C)*r;ke&&u.forEach(function(b){var R="".concat(b);Y&&(R=Y(b));var _=e.measureText(R).width,S=b*r,K=S+_;Fe(A,function(I,X){var k=I.value,Ue=I.textSize,ze=k*r,De=ze+Ue;ze<=K&&S<=De&&A.splice(X,1)}),A.push({value:b,color:Pe,offset:Be,text:R,textSize:_})}),!(D<=0)&&(e.save(),e.fillStyle=fe,f?e.fillRect(U,0,D,m):e.fillRect(0,U,m,D),e.restore())}),ce!=="transparent"&&c[0]!==-1/0&&c[1]!==1/0){var xe=(c[0]-t)*r,me=(c[1]-c[0])*r;e.save(),e.fillStyle=ce,f?e.fillRect(xe,0,me,m):e.fillRect(0,xe,m,me),e.restore()}for(var z=0;z<=pe;++z){var E=z+te;if(!(!de&&E<0))for(var ye=E*h,je=(ye-t)*r,M=0;M<Q;++M){var G=je+M/Q*H,Re=ye+M/Q*h;if(!(G<0||G>=ee||Re<c[0]||Re>c[1])){var J=M===0?Z:M%2===0?Me:Ie,N=0;switch(w){case"start":N=0;break;case"center":N=m/2-J/2;break;case"end":N=m-J;break}var Se=f?[G+x[0],N+x[1]]:[N+x[0],G+x[1]],ie=Se[0],ne=Se[1],we=f?[ie,ne+J]:[ie+J,ne],Ae=we[0],Ne=we[1];e.moveTo(ie+x[0],ne+x[1]),e.lineTo(Ae+x[0],Ne+x[1])}}}e.stroke(),A.forEach(function(u){var C=u.value,y=u.offset,U=u.backgroundColor,D=u.color,b=u.text,R=u.textSize;if(!(!de&&C<0)){var _=(C-t)*r;if(!(_<-H||_>=ee+h*r||C<c[0]||C>c[1])){var S=0;switch(w){case"start":S=17;break;case"center":S=m/2;break;case"end":S=m-17;break}var K=f?[_+ge*-3,S]:[S,_+ge*3],I=K[0],X=K[1];if(U){var k=0;switch(V){case"left":k=0;break;case"center":k=-R/2;break;case"right":k=-R;break}e.save(),e.fillStyle=U,f?e.fillRect(I+y[0]+k,0,R,Z):(e.translate(0,X+y[1]),e.rotate(-Math.PI/2),e.fillRect(k,0,R,Z)),e.restore()}e.save(),e.fillStyle=D,f?e.fillText(b,I+y[0],X+y[1]):(e.translate(I+y[0],X+y[1]),e.rotate(-Math.PI/2),e.fillText(b,0,0)),e.restore()}}}),e.restore()},o._getRulerScale=function(){var t=this.props.defaultPixelScale||2;if(!this._rulerScale){var r=window.devicePixelRatio>1;if(!r&&window.matchMedia){var n=window.matchMedia("only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen  and (min-device-pixel-ratio: 1.3), only screen and (min-resolution: 1.3dppx)");r=n&&n.matches}this._rulerScale=r?3:t}return this._rulerScale},a.defaultProps={type:"horizontal",zoom:1,width:0,height:0,unit:50,negativeRuler:!0,mainLineSize:"100%",longLineSize:10,shortLineSize:7,segment:10,direction:"end",style:{width:"100%",height:"100%"},backgroundColor:"#333333",font:"10px sans-serif",textColor:"#ffffff",textBackgroundColor:"transparent",lineColor:"#777777",range:[-1/0,1/0],rangeBackgroundColor:"transparent",lineWidth:1,selectedBackgroundColor:"#555555",defaultScrollPos:0},a}(v.PureComponent);const be=$e,lt=v.memo(l=>{const[,a]=v.useState(0),o=v.useRef(null),t=v.useRef(null),r=v.useRef(50),n=v.useRef({x:0,y:0}),i=v.useRef(20),h=()=>{const{scale:s}=F,{dsContentRef:d}=F,{designerLeftRef:p}=Ce,{x:w,y:B}=d==null?void 0:d.getBoundingClientRect(),{width:O}=p==null?void 0:p.getBoundingClientRect();n.current.x=-(w-O-20)/s,n.current.y=-(B-70)/s,r.current=Math.floor(50/s),a(Date.now())},L=()=>{const{dsContentRef:s,scale:d}=F,{designerLeftRef:p}=Ce,{x:w,y:B}=s==null?void 0:s.getBoundingClientRect(),{width:O}=p==null?void 0:p.getBoundingClientRect();n.current.x=-(w-O-20)/d,n.current.y=-(B-70)/d,o.current&&o.current.scroll(n.current.x),t.current&&t.current.scroll(n.current.y)};v.useEffect(()=>{const{setRuleRef:s}=F;return s({ruleWheel:h,ruleDrag:L}),()=>{s(null)}},[]);const{scale:g}=F;return P.jsxs("div",{className:"lc-ruler",style:{position:"relative"},children:[P.jsx("div",{style:{position:"absolute",width:20,height:20,color:"#838383",textAlign:"center",fontSize:12,top:-1},children:"px"}),P.jsx("div",{className:"lc-ruler-horizontal",style:{height:i.current,width:`calc(100% - ${i.current}px)`,position:"relative",left:i.current},children:P.jsx(be,{ref:o,scrollPos:n.current.x,zoom:g,lineColor:"#444b4d",textColor:"#a6a6a6",segment:2,negativeRuler:!0,textOffset:[0,10],backgroundColor:"#1f1f1f",unit:r.current})}),P.jsx("div",{className:"lc-ruler-vertical",style:{width:i.current,height:window.innerHeight-i.current-90,position:"relative",overflow:"hidden"},children:P.jsx(be,{ref:t,type:"vertical",scrollPos:n.current.y,lineColor:"#444b4d",textColor:"#a6a6a6",zoom:g,segment:2,negativeRuler:!0,textOffset:[10,0],backgroundColor:"#1f1f1f",unit:r.current})}),P.jsx("div",{className:"lc-ruler-content",style:{position:"absolute",overflow:"hidden",top:i.current,left:i.current},children:l.children})]})});export{lt as default};
