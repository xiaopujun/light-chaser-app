var Qt=Object.defineProperty;var Xt=(I,d,h)=>d in I?Qt(I,d,{enumerable:!0,configurable:!0,writable:!0,value:h}):I[d]=h;var Ve=(I,d,h)=>(Xt(I,typeof d!="symbol"?d+"":d,h),h);import{e as se,g as kt,_ as Zt}from"./index-uVTr4DkP.js";import{l as je,O as qt}from"./UIContainer-QclyxjV1.js";import{g as He}from"./GlobalMessage-JdhJioSt.js";class ce{static parseUrlParams(){const d=new URLSearchParams(window.location.hash.split("?")[1]),h={};for(const[g,y]of d)h[g]=y;return h}}var er=(I=>(I.LOCAL="0",I.SERVER="1",I))(er||{}),Ke=(I=>(I.EDIT="0",I.VIEW="1",I))(Ke||{}),tr=(I=>(I.DRAFT="0",I.PUBLISH="1",I.SEALED="2",I))(tr||{});class Ge{constructor(){Ve(this,"cachePool",new Map)}addCache(d,h){this.cachePool.set(d,h)}getCache(d){return this.cachePool.get(d)||null}removeCache(d){this.cachePool.delete(d)}clearCache(){this.cachePool.clear()}isExistCache(d){return this.cachePool.has(d)}getCachePool(){return this.cachePool}}class rr extends Ge{getAllImageCache(){return Array.from(this.getCachePool().values())||[]}}const ee=new rr;function fe(I){throw new Error('Could not dynamically require "'+I+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Qe={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(I,d){(function(h){I.exports=h()})(function(){return function h(g,y,b){function p(C,T){if(!y[C]){if(!g[C]){var l=typeof fe=="function"&&fe;if(!T&&l)return l(C,!0);if(_)return _(C,!0);var w=new Error("Cannot find module '"+C+"'");throw w.code="MODULE_NOT_FOUND",w}var B=y[C]={exports:{}};g[C][0].call(B.exports,function(U){var j=g[C][1][U];return p(j||U)},B,B.exports,h,g,y,b)}return y[C].exports}for(var _=typeof fe=="function"&&fe,R=0;R<b.length;R++)p(b[R]);return p}({1:[function(h,g,y){(function(b){var p=b.MutationObserver||b.WebKitMutationObserver,_;if(p){var R=0,C=new p(U),T=b.document.createTextNode("");C.observe(T,{characterData:!0}),_=function(){T.data=R=++R%2}}else if(!b.setImmediate&&typeof b.MessageChannel<"u"){var l=new b.MessageChannel;l.port1.onmessage=U,_=function(){l.port2.postMessage(0)}}else"document"in b&&"onreadystatechange"in b.document.createElement("script")?_=function(){var F=b.document.createElement("script");F.onreadystatechange=function(){U(),F.onreadystatechange=null,F.parentNode.removeChild(F),F=null},b.document.documentElement.appendChild(F)}:_=function(){setTimeout(U,0)};var w,B=[];function U(){w=!0;for(var F,J,M=B.length;M;){for(J=B,B=[],F=-1;++F<M;)J[F]();M=B.length}w=!1}g.exports=j;function j(F){B.push(F)===1&&!w&&_()}}).call(this,typeof se<"u"?se:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(h,g,y){var b=h(1);function p(){}var _={},R=["REJECTED"],C=["FULFILLED"],T=["PENDING"];g.exports=l;function l(v){if(typeof v!="function")throw new TypeError("resolver must be a function");this.state=T,this.queue=[],this.outcome=void 0,v!==p&&j(this,v)}l.prototype.catch=function(v){return this.then(null,v)},l.prototype.then=function(v,A){if(typeof v!="function"&&this.state===C||typeof A!="function"&&this.state===R)return this;var S=new this.constructor(p);if(this.state!==T){var N=this.state===C?v:A;B(S,N,this.outcome)}else this.queue.push(new w(S,v,A));return S};function w(v,A,S){this.promise=v,typeof A=="function"&&(this.onFulfilled=A,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}w.prototype.callFulfilled=function(v){_.resolve(this.promise,v)},w.prototype.otherCallFulfilled=function(v){B(this.promise,this.onFulfilled,v)},w.prototype.callRejected=function(v){_.reject(this.promise,v)},w.prototype.otherCallRejected=function(v){B(this.promise,this.onRejected,v)};function B(v,A,S){b(function(){var N;try{N=A(S)}catch(Y){return _.reject(v,Y)}N===v?_.reject(v,new TypeError("Cannot resolve promise with itself")):_.resolve(v,N)})}_.resolve=function(v,A){var S=F(U,A);if(S.status==="error")return _.reject(v,S.value);var N=S.value;if(N)j(v,N);else{v.state=C,v.outcome=A;for(var Y=-1,W=v.queue.length;++Y<W;)v.queue[Y].callFulfilled(A)}return v},_.reject=function(v,A){v.state=R,v.outcome=A;for(var S=-1,N=v.queue.length;++S<N;)v.queue[S].callRejected(A);return v};function U(v){var A=v&&v.then;if(v&&(typeof v=="object"||typeof v=="function")&&typeof A=="function")return function(){A.apply(v,arguments)}}function j(v,A){var S=!1;function N($){S||(S=!0,_.reject(v,$))}function Y($){S||(S=!0,_.resolve(v,$))}function W(){A(Y,N)}var z=F(W);z.status==="error"&&N(z.value)}function F(v,A){var S={};try{S.value=v(A),S.status="success"}catch(N){S.status="error",S.value=N}return S}l.resolve=J;function J(v){return v instanceof this?v:_.resolve(new this(p),v)}l.reject=M;function M(v){var A=new this(p);return _.reject(A,v)}l.all=ue;function ue(v){var A=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=v.length,N=!1;if(!S)return this.resolve([]);for(var Y=new Array(S),W=0,z=-1,$=new this(p);++z<S;)K(v[z],z);return $;function K(te,ae){A.resolve(te).then(le,function(Z){N||(N=!0,_.reject($,Z))});function le(Z){Y[ae]=Z,++W===S&&!N&&(N=!0,_.resolve($,Y))}}}l.race=k;function k(v){var A=this;if(Object.prototype.toString.call(v)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=v.length,N=!1;if(!S)return this.resolve([]);for(var Y=-1,W=new this(p);++Y<S;)z(v[Y]);return W;function z($){A.resolve($).then(function(K){N||(N=!0,_.resolve(W,K))},function(K){N||(N=!0,_.reject(W,K))})}}},{1:1}],3:[function(h,g,y){(function(b){typeof b.Promise!="function"&&(b.Promise=h(2))}).call(this,typeof se<"u"?se:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(h,g,y){var b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function p(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var R=_();function C(){try{if(!R||!R.open)return!1;var e=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),r=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!e||r)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function T(e,r){e=e||[],r=r||{};try{return new Blob(e,r)}catch(n){if(n.name!=="TypeError")throw n;for(var t=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,a=new t,o=0;o<e.length;o+=1)a.append(e[o]);return a.getBlob(r.type)}}typeof Promise>"u"&&h(3);var l=Promise;function w(e,r){r&&e.then(function(t){r(null,t)},function(t){r(t)})}function B(e,r,t){typeof r=="function"&&e.then(r),typeof t=="function"&&e.catch(t)}function U(e){return typeof e!="string"&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function j(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var F="local-forage-detect-blob-support",J=void 0,M={},ue=Object.prototype.toString,k="readonly",v="readwrite";function A(e){for(var r=e.length,t=new ArrayBuffer(r),a=new Uint8Array(t),o=0;o<r;o++)a[o]=e.charCodeAt(o);return t}function S(e){return new l(function(r){var t=e.transaction(F,v),a=T([""]);t.objectStore(F).put(a,"key"),t.onabort=function(o){o.preventDefault(),o.stopPropagation(),r(!1)},t.oncomplete=function(){var o=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);r(n||!o||parseInt(o[1],10)>=43)}}).catch(function(){return!1})}function N(e){return typeof J=="boolean"?l.resolve(J):S(e).then(function(r){return J=r,J})}function Y(e){var r=M[e.name],t={};t.promise=new l(function(a,o){t.resolve=a,t.reject=o}),r.deferredOperations.push(t),r.dbReady?r.dbReady=r.dbReady.then(function(){return t.promise}):r.dbReady=t.promise}function W(e){var r=M[e.name],t=r.deferredOperations.pop();if(t)return t.resolve(),t.promise}function z(e,r){var t=M[e.name],a=t.deferredOperations.pop();if(a)return a.reject(r),a.promise}function $(e,r){return new l(function(t,a){if(M[e.name]=M[e.name]||Ee(),e.db)if(r)Y(e),e.db.close();else return t(e.db);var o=[e.name];r&&o.push(e.version);var n=R.open.apply(R,o);r&&(n.onupgradeneeded=function(i){var s=n.result;try{s.createObjectStore(e.storeName),i.oldVersion<=1&&s.createObjectStore(F)}catch(c){if(c.name==="ConstraintError")console.warn('The database "'+e.name+'" has been upgraded from version '+i.oldVersion+" to version "+i.newVersion+', but the storage "'+e.storeName+'" already exists.');else throw c}}),n.onerror=function(i){i.preventDefault(),a(n.error)},n.onsuccess=function(){var i=n.result;i.onversionchange=function(s){s.target.close()},t(i),W(e)}})}function K(e){return $(e,!1)}function te(e){return $(e,!0)}function ae(e,r){if(!e.db)return!0;var t=!e.db.objectStoreNames.contains(e.storeName),a=e.version<e.db.version,o=e.version>e.db.version;if(a&&(e.version!==r&&console.warn('The database "'+e.name+`" can't be downgraded from version `+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||t){if(t){var n=e.db.version+1;n>e.version&&(e.version=n)}return!0}return!1}function le(e){return new l(function(r,t){var a=new FileReader;a.onerror=t,a.onloadend=function(o){var n=btoa(o.target.result||"");r({__local_forage_encoded_blob:!0,data:n,type:e.type})},a.readAsBinaryString(e)})}function Z(e){var r=A(atob(e.data));return T([r],{type:e.type})}function Ie(e){return e&&e.__local_forage_encoded_blob}function Xe(e){var r=this,t=r._initReady().then(function(){var a=M[r._dbInfo.name];if(a&&a.dbReady)return a.dbReady});return B(t,e,e),t}function ke(e){Y(e);for(var r=M[e.name],t=r.forages,a=0;a<t.length;a++){var o=t[a];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,K(e).then(function(n){return e.db=n,ae(e)?te(e):n}).then(function(n){e.db=r.db=n;for(var i=0;i<t.length;i++)t[i]._dbInfo.db=n}).catch(function(n){throw z(e,n),n})}function G(e,r,t,a){a===void 0&&(a=1);try{var o=e.db.transaction(e.storeName,r);t(null,o)}catch(n){if(a>0&&(!e.db||n.name==="InvalidStateError"||n.name==="NotFoundError"))return l.resolve().then(function(){if(!e.db||n.name==="NotFoundError"&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),te(e)}).then(function(){return ke(e).then(function(){G(e,r,t,a-1)})}).catch(t);t(n)}}function Ee(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function Ze(e){var r=this,t={db:null};if(e)for(var a in e)t[a]=e[a];var o=M[t.name];o||(o=Ee(),M[t.name]=o),o.forages.push(r),r._initReady||(r._initReady=r.ready,r.ready=Xe);var n=[];function i(){return l.resolve()}for(var s=0;s<o.forages.length;s++){var c=o.forages[s];c!==r&&n.push(c._initReady().catch(i))}var f=o.forages.slice(0);return l.all(n).then(function(){return t.db=o.db,K(t)}).then(function(u){return t.db=u,ae(t,r._defaultConfig.version)?te(t):u}).then(function(u){t.db=o.db=u,r._dbInfo=t;for(var m=0;m<f.length;m++){var E=f[m];E!==r&&(E._dbInfo.db=t.db,E._dbInfo.version=t.version)}})}function qe(e,r){var t=this;e=U(e);var a=new l(function(o,n){t.ready().then(function(){G(t._dbInfo,k,function(i,s){if(i)return n(i);try{var c=s.objectStore(t._dbInfo.storeName),f=c.get(e);f.onsuccess=function(){var u=f.result;u===void 0&&(u=null),Ie(u)&&(u=Z(u)),o(u)},f.onerror=function(){n(f.error)}}catch(u){n(u)}})}).catch(n)});return w(a,r),a}function et(e,r){var t=this,a=new l(function(o,n){t.ready().then(function(){G(t._dbInfo,k,function(i,s){if(i)return n(i);try{var c=s.objectStore(t._dbInfo.storeName),f=c.openCursor(),u=1;f.onsuccess=function(){var m=f.result;if(m){var E=m.value;Ie(E)&&(E=Z(E));var D=e(E,m.key,u++);D!==void 0?o(D):m.continue()}else o()},f.onerror=function(){n(f.error)}}catch(m){n(m)}})}).catch(n)});return w(a,r),a}function tt(e,r,t){var a=this;e=U(e);var o=new l(function(n,i){var s;a.ready().then(function(){return s=a._dbInfo,ue.call(r)==="[object Blob]"?N(s.db).then(function(c){return c?r:le(r)}):r}).then(function(c){G(a._dbInfo,v,function(f,u){if(f)return i(f);try{var m=u.objectStore(a._dbInfo.storeName);c===null&&(c=void 0);var E=m.put(c,e);u.oncomplete=function(){c===void 0&&(c=null),n(c)},u.onabort=u.onerror=function(){var D=E.error?E.error:E.transaction.error;i(D)}}catch(D){i(D)}})}).catch(i)});return w(o,t),o}function rt(e,r){var t=this;e=U(e);var a=new l(function(o,n){t.ready().then(function(){G(t._dbInfo,v,function(i,s){if(i)return n(i);try{var c=s.objectStore(t._dbInfo.storeName),f=c.delete(e);s.oncomplete=function(){o()},s.onerror=function(){n(f.error)},s.onabort=function(){var u=f.error?f.error:f.transaction.error;n(u)}}catch(u){n(u)}})}).catch(n)});return w(a,r),a}function nt(e){var r=this,t=new l(function(a,o){r.ready().then(function(){G(r._dbInfo,v,function(n,i){if(n)return o(n);try{var s=i.objectStore(r._dbInfo.storeName),c=s.clear();i.oncomplete=function(){a()},i.onabort=i.onerror=function(){var f=c.error?c.error:c.transaction.error;o(f)}}catch(f){o(f)}})}).catch(o)});return w(t,e),t}function at(e){var r=this,t=new l(function(a,o){r.ready().then(function(){G(r._dbInfo,k,function(n,i){if(n)return o(n);try{var s=i.objectStore(r._dbInfo.storeName),c=s.count();c.onsuccess=function(){a(c.result)},c.onerror=function(){o(c.error)}}catch(f){o(f)}})}).catch(o)});return w(t,e),t}function ot(e,r){var t=this,a=new l(function(o,n){if(e<0){o(null);return}t.ready().then(function(){G(t._dbInfo,k,function(i,s){if(i)return n(i);try{var c=s.objectStore(t._dbInfo.storeName),f=!1,u=c.openKeyCursor();u.onsuccess=function(){var m=u.result;if(!m){o(null);return}e===0||f?o(m.key):(f=!0,m.advance(e))},u.onerror=function(){n(u.error)}}catch(m){n(m)}})}).catch(n)});return w(a,r),a}function it(e){var r=this,t=new l(function(a,o){r.ready().then(function(){G(r._dbInfo,k,function(n,i){if(n)return o(n);try{var s=i.objectStore(r._dbInfo.storeName),c=s.openKeyCursor(),f=[];c.onsuccess=function(){var u=c.result;if(!u){a(f);return}f.push(u.key),u.continue()},c.onerror=function(){o(c.error)}}catch(u){o(u)}})}).catch(o)});return w(t,e),t}function st(e,r){r=j.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var a=this,o;if(!e.name)o=l.reject("Invalid arguments");else{var n=e.name===t.name&&a._dbInfo.db,i=n?l.resolve(a._dbInfo.db):K(e).then(function(s){var c=M[e.name],f=c.forages;c.db=s;for(var u=0;u<f.length;u++)f[u]._dbInfo.db=s;return s});e.storeName?o=i.then(function(s){if(s.objectStoreNames.contains(e.storeName)){var c=s.version+1;Y(e);var f=M[e.name],u=f.forages;s.close();for(var m=0;m<u.length;m++){var E=u[m];E._dbInfo.db=null,E._dbInfo.version=c}var D=new l(function(x,O){var L=R.open(e.name,c);L.onerror=function(V){var ne=L.result;ne.close(),O(V)},L.onupgradeneeded=function(){var V=L.result;V.deleteObjectStore(e.storeName)},L.onsuccess=function(){var V=L.result;V.close(),x(V)}});return D.then(function(x){f.db=x;for(var O=0;O<u.length;O++){var L=u[O];L._dbInfo.db=x,W(L._dbInfo)}}).catch(function(x){throw(z(e,x)||l.resolve()).catch(function(){}),x})}}):o=i.then(function(s){Y(e);var c=M[e.name],f=c.forages;s.close();for(var u=0;u<f.length;u++){var m=f[u];m._dbInfo.db=null}var E=new l(function(D,x){var O=R.deleteDatabase(e.name);O.onerror=function(){var L=O.result;L&&L.close(),x(O.error)},O.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},O.onsuccess=function(){var L=O.result;L&&L.close(),D(L)}});return E.then(function(D){c.db=D;for(var x=0;x<f.length;x++){var O=f[x];W(O._dbInfo)}}).catch(function(D){throw(z(e,D)||l.resolve()).catch(function(){}),D})})}return w(o,r),o}var ct={_driver:"asyncStorage",_initStorage:Ze,_support:C(),iterate:et,getItem:qe,setItem:tt,removeItem:rt,clear:nt,length:at,key:ot,keys:it,dropInstance:st};function ft(){return typeof openDatabase=="function"}var Q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ut="~~local_forage_type~",Se=/^~~local_forage_type~([^~]+)~/,oe="__lfsc__:",de=oe.length,ve="arbf",he="blob",Re="si08",Ae="ui08",De="uic8",Te="si16",xe="si32",Ce="ur16",Pe="ui32",Ne="fl32",Le="fl64",Be=de+ve.length,Oe=Object.prototype.toString;function Ue(e){var r=e.length*.75,t=e.length,a,o=0,n,i,s,c;e[e.length-1]==="="&&(r--,e[e.length-2]==="="&&r--);var f=new ArrayBuffer(r),u=new Uint8Array(f);for(a=0;a<t;a+=4)n=Q.indexOf(e[a]),i=Q.indexOf(e[a+1]),s=Q.indexOf(e[a+2]),c=Q.indexOf(e[a+3]),u[o++]=n<<2|i>>4,u[o++]=(i&15)<<4|s>>2,u[o++]=(s&3)<<6|c&63;return f}function me(e){var r=new Uint8Array(e),t="",a;for(a=0;a<r.length;a+=3)t+=Q[r[a]>>2],t+=Q[(r[a]&3)<<4|r[a+1]>>4],t+=Q[(r[a+1]&15)<<2|r[a+2]>>6],t+=Q[r[a+2]&63];return r.length%3===2?t=t.substring(0,t.length-1)+"=":r.length%3===1&&(t=t.substring(0,t.length-2)+"=="),t}function lt(e,r){var t="";if(e&&(t=Oe.call(e)),e&&(t==="[object ArrayBuffer]"||e.buffer&&Oe.call(e.buffer)==="[object ArrayBuffer]")){var a,o=oe;e instanceof ArrayBuffer?(a=e,o+=ve):(a=e.buffer,t==="[object Int8Array]"?o+=Re:t==="[object Uint8Array]"?o+=Ae:t==="[object Uint8ClampedArray]"?o+=De:t==="[object Int16Array]"?o+=Te:t==="[object Uint16Array]"?o+=Ce:t==="[object Int32Array]"?o+=xe:t==="[object Uint32Array]"?o+=Pe:t==="[object Float32Array]"?o+=Ne:t==="[object Float64Array]"?o+=Le:r(new Error("Failed to get type for BinaryArray"))),r(o+me(a))}else if(t==="[object Blob]"){var n=new FileReader;n.onload=function(){var i=ut+e.type+"~"+me(this.result);r(oe+he+i)},n.readAsArrayBuffer(e)}else try{r(JSON.stringify(e))}catch(i){console.error("Couldn't convert value into a JSON string: ",e),r(null,i)}}function dt(e){if(e.substring(0,de)!==oe)return JSON.parse(e);var r=e.substring(Be),t=e.substring(de,Be),a;if(t===he&&Se.test(r)){var o=r.match(Se);a=o[1],r=r.substring(o[0].length)}var n=Ue(r);switch(t){case ve:return n;case he:return T([n],{type:a});case Re:return new Int8Array(n);case Ae:return new Uint8Array(n);case De:return new Uint8ClampedArray(n);case Te:return new Int16Array(n);case Ce:return new Uint16Array(n);case xe:return new Int32Array(n);case Pe:return new Uint32Array(n);case Ne:return new Float32Array(n);case Le:return new Float64Array(n);default:throw new Error("Unkown type: "+t)}}var ge={serialize:lt,deserialize:dt,stringToBuffer:Ue,bufferToString:me};function Fe(e,r,t,a){e.executeSql("CREATE TABLE IF NOT EXISTS "+r.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],t,a)}function vt(e){var r=this,t={db:null};if(e)for(var a in e)t[a]=typeof e[a]!="string"?e[a].toString():e[a];var o=new l(function(n,i){try{t.db=openDatabase(t.name,String(t.version),t.description,t.size)}catch(s){return i(s)}t.db.transaction(function(s){Fe(s,t,function(){r._dbInfo=t,n()},function(c,f){i(f)})},i)});return t.serializer=ge,o}function X(e,r,t,a,o,n){e.executeSql(t,a,o,function(i,s){s.code===s.SYNTAX_ERR?i.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[r.storeName],function(c,f){f.rows.length?n(c,s):Fe(c,r,function(){c.executeSql(t,a,o,n)},n)},n):n(i,s)},n)}function ht(e,r){var t=this;e=U(e);var a=new l(function(o,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){X(s,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(c,f){var u=f.rows.length?f.rows.item(0).value:null;u&&(u=i.serializer.deserialize(u)),o(u)},function(c,f){n(f)})})}).catch(n)});return w(a,r),a}function mt(e,r){var t=this,a=new l(function(o,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){X(s,i,"SELECT * FROM "+i.storeName,[],function(c,f){for(var u=f.rows,m=u.length,E=0;E<m;E++){var D=u.item(E),x=D.value;if(x&&(x=i.serializer.deserialize(x)),x=e(x,D.key,E+1),x!==void 0){o(x);return}}o()},function(c,f){n(f)})})}).catch(n)});return w(a,r),a}function Me(e,r,t,a){var o=this;e=U(e);var n=new l(function(i,s){o.ready().then(function(){r===void 0&&(r=null);var c=r,f=o._dbInfo;f.serializer.serialize(r,function(u,m){m?s(m):f.db.transaction(function(E){X(E,f,"INSERT OR REPLACE INTO "+f.storeName+" (key, value) VALUES (?, ?)",[e,u],function(){i(c)},function(D,x){s(x)})},function(E){if(E.code===E.QUOTA_ERR){if(a>0){i(Me.apply(o,[e,c,t,a-1]));return}s(E)}})})}).catch(s)});return w(n,t),n}function gt(e,r,t){return Me.apply(this,[e,r,t,1])}function yt(e,r){var t=this;e=U(e);var a=new l(function(o,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){X(s,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){o()},function(c,f){n(f)})})}).catch(n)});return w(a,r),a}function pt(e){var r=this,t=new l(function(a,o){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(i){X(i,n,"DELETE FROM "+n.storeName,[],function(){a()},function(s,c){o(c)})})}).catch(o)});return w(t,e),t}function bt(e){var r=this,t=new l(function(a,o){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(i){X(i,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(s,c){var f=c.rows.item(0).c;a(f)},function(s,c){o(c)})})}).catch(o)});return w(t,e),t}function _t(e,r){var t=this,a=new l(function(o,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){X(s,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(c,f){var u=f.rows.length?f.rows.item(0).key:null;o(u)},function(c,f){n(f)})})}).catch(n)});return w(a,r),a}function wt(e){var r=this,t=new l(function(a,o){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(i){X(i,n,"SELECT key FROM "+n.storeName,[],function(s,c){for(var f=[],u=0;u<c.rows.length;u++)f.push(c.rows.item(u).key);a(f)},function(s,c){o(c)})})}).catch(o)});return w(t,e),t}function It(e){return new l(function(r,t){e.transaction(function(a){a.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(o,n){for(var i=[],s=0;s<n.rows.length;s++)i.push(n.rows.item(s).name);r({db:e,storeNames:i})},function(o,n){t(n)})},function(a){t(a)})})}function Et(e,r){r=j.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var a=this,o;return e.name?o=new l(function(n){var i;e.name===t.name?i=a._dbInfo.db:i=openDatabase(e.name,"","",0),e.storeName?n({db:i,storeNames:[e.storeName]}):n(It(i))}).then(function(n){return new l(function(i,s){n.db.transaction(function(c){function f(D){return new l(function(x,O){c.executeSql("DROP TABLE IF EXISTS "+D,[],function(){x()},function(L,V){O(V)})})}for(var u=[],m=0,E=n.storeNames.length;m<E;m++)u.push(f(n.storeNames[m]));l.all(u).then(function(){i()}).catch(function(D){s(D)})},function(c){s(c)})})}):o=l.reject("Invalid arguments"),w(o,r),o}var St={_driver:"webSQLStorage",_initStorage:vt,_support:ft(),iterate:mt,getItem:ht,setItem:gt,removeItem:yt,clear:pt,length:bt,key:_t,keys:wt,dropInstance:Et};function Rt(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function Ye(e,r){var t=e.name+"/";return e.storeName!==r.storeName&&(t+=e.storeName+"/"),t}function At(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch{return!0}}function Dt(){return!At()||localStorage.length>0}function Tt(e){var r=this,t={};if(e)for(var a in e)t[a]=e[a];return t.keyPrefix=Ye(e,r._defaultConfig),Dt()?(r._dbInfo=t,t.serializer=ge,l.resolve()):l.reject()}function xt(e){var r=this,t=r.ready().then(function(){for(var a=r._dbInfo.keyPrefix,o=localStorage.length-1;o>=0;o--){var n=localStorage.key(o);n.indexOf(a)===0&&localStorage.removeItem(n)}});return w(t,e),t}function Ct(e,r){var t=this;e=U(e);var a=t.ready().then(function(){var o=t._dbInfo,n=localStorage.getItem(o.keyPrefix+e);return n&&(n=o.serializer.deserialize(n)),n});return w(a,r),a}function Pt(e,r){var t=this,a=t.ready().then(function(){for(var o=t._dbInfo,n=o.keyPrefix,i=n.length,s=localStorage.length,c=1,f=0;f<s;f++){var u=localStorage.key(f);if(u.indexOf(n)===0){var m=localStorage.getItem(u);if(m&&(m=o.serializer.deserialize(m)),m=e(m,u.substring(i),c++),m!==void 0)return m}}});return w(a,r),a}function Nt(e,r){var t=this,a=t.ready().then(function(){var o=t._dbInfo,n;try{n=localStorage.key(e)}catch{n=null}return n&&(n=n.substring(o.keyPrefix.length)),n});return w(a,r),a}function Lt(e){var r=this,t=r.ready().then(function(){for(var a=r._dbInfo,o=localStorage.length,n=[],i=0;i<o;i++){var s=localStorage.key(i);s.indexOf(a.keyPrefix)===0&&n.push(s.substring(a.keyPrefix.length))}return n});return w(t,e),t}function Bt(e){var r=this,t=r.keys().then(function(a){return a.length});return w(t,e),t}function Ot(e,r){var t=this;e=U(e);var a=t.ready().then(function(){var o=t._dbInfo;localStorage.removeItem(o.keyPrefix+e)});return w(a,r),a}function Ut(e,r,t){var a=this;e=U(e);var o=a.ready().then(function(){r===void 0&&(r=null);var n=r;return new l(function(i,s){var c=a._dbInfo;c.serializer.serialize(r,function(f,u){if(u)s(u);else try{localStorage.setItem(c.keyPrefix+e,f),i(n)}catch(m){(m.name==="QuotaExceededError"||m.name==="NS_ERROR_DOM_QUOTA_REACHED")&&s(m),s(m)}})})});return w(o,t),o}function Ft(e,r){if(r=j.apply(this,arguments),e=typeof e!="function"&&e||{},!e.name){var t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}var a=this,o;return e.name?o=new l(function(n){e.storeName?n(Ye(e,a._defaultConfig)):n(e.name+"/")}).then(function(n){for(var i=localStorage.length-1;i>=0;i--){var s=localStorage.key(i);s.indexOf(n)===0&&localStorage.removeItem(s)}}):o=l.reject("Invalid arguments"),w(o,r),o}var Mt={_driver:"localStorageWrapper",_initStorage:Tt,_support:Rt(),iterate:Pt,getItem:Ct,setItem:Ut,removeItem:Ot,clear:xt,length:Bt,key:Nt,keys:Lt,dropInstance:Ft},Yt=function(r,t){return r===t||typeof r=="number"&&typeof t=="number"&&isNaN(r)&&isNaN(t)},Wt=function(r,t){for(var a=r.length,o=0;o<a;){if(Yt(r[o],t))return!0;o++}return!1},We=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},re={},ze={},q={INDEXEDDB:ct,WEBSQL:St,LOCALSTORAGE:Mt},zt=[q.INDEXEDDB._driver,q.WEBSQL._driver,q.LOCALSTORAGE._driver],ie=["dropInstance"],ye=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ie),$t={description:"",driver:zt.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Vt(e,r){e[r]=function(){var t=arguments;return e.ready().then(function(){return e[r].apply(e,t)})}}function pe(){for(var e=1;e<arguments.length;e++){var r=arguments[e];if(r)for(var t in r)r.hasOwnProperty(t)&&(We(r[t])?arguments[0][t]=r[t].slice():arguments[0][t]=r[t])}return arguments[0]}var jt=function(){function e(r){p(this,e);for(var t in q)if(q.hasOwnProperty(t)){var a=q[t],o=a._driver;this[t]=o,re[o]||this.defineDriver(a)}this._defaultConfig=pe({},$t),this._config=pe({},this._defaultConfig,r),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(t){if((typeof t>"u"?"undefined":b(t))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var a in t){if(a==="storeName"&&(t[a]=t[a].replace(/\W/g,"_")),a==="version"&&typeof t[a]!="number")return new Error("Database version must be a number.");this._config[a]=t[a]}return"driver"in t&&t.driver?this.setDriver(this._config.driver):!0}else return typeof t=="string"?this._config[t]:this._config},e.prototype.defineDriver=function(t,a,o){var n=new l(function(i,s){try{var c=t._driver,f=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver){s(f);return}for(var u=ye.concat("_initStorage"),m=0,E=u.length;m<E;m++){var D=u[m],x=!Wt(ie,D);if((x||t[D])&&typeof t[D]!="function"){s(f);return}}var O=function(){for(var ne=function(Kt){return function(){var Gt=new Error("Method "+Kt+" is not implemented by the current driver"),$e=l.reject(Gt);return w($e,arguments[arguments.length-1]),$e}},be=0,Jt=ie.length;be<Jt;be++){var _e=ie[be];t[_e]||(t[_e]=ne(_e))}};O();var L=function(ne){re[c]&&console.info("Redefining LocalForage driver: "+c),re[c]=t,ze[c]=ne,i()};"_support"in t?t._support&&typeof t._support=="function"?t._support().then(L,s):L(!!t._support):L(!0)}catch(V){s(V)}});return B(n,a,o),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(t,a,o){var n=re[t]?l.resolve(re[t]):l.reject(new Error("Driver not found."));return B(n,a,o),n},e.prototype.getSerializer=function(t){var a=l.resolve(ge);return B(a,t),a},e.prototype.ready=function(t){var a=this,o=a._driverSet.then(function(){return a._ready===null&&(a._ready=a._initDriver()),a._ready});return B(o,t,t),o},e.prototype.setDriver=function(t,a,o){var n=this;We(t)||(t=[t]);var i=this._getSupportedDrivers(t);function s(){n._config.driver=n.driver()}function c(m){return n._extend(m),s(),n._ready=n._initStorage(n._config),n._ready}function f(m){return function(){var E=0;function D(){for(;E<m.length;){var x=m[E];return E++,n._dbInfo=null,n._ready=null,n.getDriver(x).then(c).catch(D)}s();var O=new Error("No available storage method found.");return n._driverSet=l.reject(O),n._driverSet}return D()}}var u=this._driverSet!==null?this._driverSet.catch(function(){return l.resolve()}):l.resolve();return this._driverSet=u.then(function(){var m=i[0];return n._dbInfo=null,n._ready=null,n.getDriver(m).then(function(E){n._driver=E._driver,s(),n._wrapLibraryMethodsWithReady(),n._initDriver=f(i)})}).catch(function(){s();var m=new Error("No available storage method found.");return n._driverSet=l.reject(m),n._driverSet}),B(this._driverSet,a,o),this._driverSet},e.prototype.supports=function(t){return!!ze[t]},e.prototype._extend=function(t){pe(this,t)},e.prototype._getSupportedDrivers=function(t){for(var a=[],o=0,n=t.length;o<n;o++){var i=t[o];this.supports(i)&&a.push(i)}return a},e.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,a=ye.length;t<a;t++)Vt(this,ye[t])},e.prototype.createInstance=function(t){return new e(t)},e}(),Ht=new jt;g.exports=Ht},{3:3}]},{},[4])(4)})})(Qe);var nr=Qe.exports;const P=kt(nr);class ar{}let or=I=>crypto.getRandomValues(new Uint8Array(I)),ir=(I,d,h)=>{let g=(2<<Math.log(I.length-1)/Math.LN2)-1,y=-~(1.6*g*d/I.length);return(b=d)=>{let p="";for(;;){let _=h(y),R=y;for(;R--;)if(p+=I[_[R]&g]||"",p.length===b)return p}}},sr=(I,d=21)=>ir(I,d,or);class Je{static generateId(){return sr("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",10)()}}class cr{static async getFileHash(d){const h=await d.arrayBuffer(),g=await crypto.subtle.digest("SHA-256",h);return Array.from(new Uint8Array(g)).map(y=>y.toString(16).padStart(2,"0")).join("").substring(0,16)}static async blobToBase64(d){return new Promise(async(h,g)=>{try{const b=await(await fetch(d)).blob(),p=new FileReader;p.onloadend=()=>{h(p.result)},p.onerror=()=>{g("Failed to convert Blob to Base64")},p.readAsDataURL(b)}catch{return h(!1)}})}static async base64ToBlob(d){return new Promise(async(h,g)=>{try{const y=await fetch(d);if(y.ok){const b=await y.blob();h(URL.createObjectURL(b))}else h(!1)}catch{h(!1)}})}}class fr extends Ge{getAllCoverCache(){return Array.from(this.getCachePool().values())||[]}clearCoverCache(){this.getAllCoverCache().forEach(d=>{URL.revokeObjectURL(d)})}}const ur=new fr,H="light_chaser_project_list",we="image_source_",lr="cover_",dr=async I=>(await Zt(()=>import("./LayerManager-4wFtoUMN.js").then(h=>h.aZ),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]))).default;class pr extends ar{async createProject(d){d.id=Je.generateId();const h=d.dataJson,g=await P.getItem(H)||[];return d.dataJson=void 0,g.push(d),await P.setItem(H,g),await P.setItem(d.id,h),Promise.resolve(d.id)}async updateProject(d){var p,_;d=je.cloneDeep(d);const h=d.dataJson;delete d.dataJson;const g=await P.getItem(H)||[],y=g.findIndex(R=>R.id===d.id);if(y===-1){(p=He.messageApi)==null||p.error("项目不存在");return}const b=g[y];d=qt.merge(b,d),g[y]=d,await P.setItem(H,g),h&&await P.setItem(d.id,h),(_=He.messageApi)==null||_.success("保存成功")}async deleteProject(d){const h=await P.getItem(H)||[],g=h.findIndex(b=>b.id===d);if(g===-1)return!1;const y=h[g];return y.cover&&await P.removeItem(y.cover),h.splice(g,1),await P.setItem(H,h),await P.removeItem(d),!0}async getProjectData(d){var b;const h=await P.getItem(d);if(!h)return null;const g=await P.getItem(we+d)||[];for(const p of g){const _=await P.getItem(p);if(_){const{blob:R,name:C}=_,T=URL.createObjectURL(R);ee.addCache(p,{url:T,name:C,hash:p,id:p})}}const y=JSON.parse(h);if(y&&y.layerManager){const{elemConfigs:p}=y.layerManager;if(p){const _=((b=ce.parseUrlParams())==null?void 0:b.mode)||Ke.EDIT;dr().then(async R=>{const{convertMap:C}=R.getLoader(_);for(const T of Object.values(p)){const{type:l}=T==null?void 0:T.base;l&&C[l]&&await C[l].convertBack(T)}})}}return y}async getProjectInfoPageList(d){const{current:h,size:g,searchValue:y}=d;let b=await P.getItem(H)||[];y&&(b=b.filter(T=>{var l;return(l=T.name)==null?void 0:l.includes(y)}));for(const T of b){const{cover:l}=T;if(l){const w=await P.getItem(l);w?(T.cover=URL.createObjectURL(w),ur.addCache(T.id,T.cover)):T.cover=void 0}}const p=(h-1)*g,_=p+g,R=b.length,C=b.slice(p,_);return{total:R,records:C,current:h,size:g}}async copyProject(d,h){const g=await P.getItem(H)||[],y=g.findIndex(R=>R.id===d);if(y===-1)return"";const b=g[y],p=je.cloneDeep(b);p.id=Je.generateId(),p.name=h||p.name,p.createTime=new Date().getTime()+"",p.updateTime=new Date().getTime()+"",g.push(p),await P.setItem(H,g);const _=await P.getItem(d);return _&&await P.setItem(p.id,_),p.id}async uploadImage(d){return new Promise(h=>{let g=null;cr.getFileHash(d).then(y=>{var b;if(ee.isExistCache(y))g=(b=ee.getCache(y))==null?void 0:b.url,h(g&&g!==""?{url:g,hash:y}:!1);else{const p=new FileReader;p.onload=async _=>{const R=new Blob([_.target.result],{type:d.type});P.setItem(y,{name:d.name,blob:R});const{id:C}=ce.parseUrlParams(),T=we+C,l=await P.getItem(T)||[];l.push(y),P.setItem(T,l),g=URL.createObjectURL(R),ee.addCache(y,{url:g,name:d.name,hash:y,id:y}),h({url:g,hash:y})},p.readAsArrayBuffer(d)}})})}async getImageSourceList(d){return new Promise(h=>{h(ee.getAllImageCache())})}async delImageSource(d){await P.removeItem(d);const{id:h}=ce.parseUrlParams(),g=we+h,y=await P.getItem(g)||[],b=y.findIndex(p=>p===d);if(b!==-1)y.splice(b,1),await P.setItem(g,y);else return!1;return ee.removeCache(d),!0}async uploadCover(d){const h=new FileReader,{id:g}=ce.parseUrlParams(),y=lr+g;h.onload=async R=>{const C=new Blob([R.target.result],{type:d.type});await P.setItem(y,C)},h.readAsArrayBuffer(d);const b=await P.getItem(H)||[],p=b.findIndex(R=>R.id===g);if(p===-1)return!1;const _=b[p];return _.cover=y,await P.setItem(H,b),!0}}export{ar as A,Ke as D,cr as F,Je as I,H as L,tr as P,er as S,ce as U,pr as a,ur as b,ee as i,P as l};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/LayerManager-4wFtoUMN.js","assets/LCGUI-Ssa8gIoP.js","assets/index-uVTr4DkP.js","assets/index-IyM4ICh1.css","assets/UIContainer-QclyxjV1.js","assets/index-M4LYRhyC.js","assets/MainRouter-g_j_Is0t.js","assets/useZIndex-GVasLPt8.js","assets/UIContainer-2wM5o6qv.css","assets/FetchUtil-Ivd_z0Im.js","assets/Data-UXmzX42n.js","assets/Accordion-NfD7KWQm.js","assets/Switch-QMPoZeAy.js","assets/Switch-mqJvRLec.css","assets/Right-qoStPUum.js","assets/Accordion-SU6xlX8W.css","assets/Radio-sQVTRydY.js","assets/Radio-scZDuxp-.css","assets/GlobalMessage-JdhJioSt.js","assets/index-kdYyXKyi.js","assets/LayerManager-jW1_BfPE.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}