var u=Object.defineProperty;var x=(c,s,e)=>s in c?u(c,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[s]=e;var m=(c,s,e)=>(x(c,typeof s!="symbol"?s+"":s,e),e);import{r as I,j as o}from"./index-3GqucBfC.js";import{o as y,bh as D,n as v,D as j,a as C,e as h,bi as b}from"./LayerManager-Id64Dr7s.js";import{I as N}from"./Button-BktP6eFA.js";import{k as g}from"./DesignerPage-GLP8CQSv.js";import{D as A}from"./DragAddProvider-_IIQLnDx.js";import"./AntdIcon-OHmKKYpl.js";import"./MainRouter-5S0GgxtQ.js";import"./AntdIcon-BYoPKEuB.js";import"./Compact-PqrPY0tm.js";import"./useZIndex-9IcJXe4E.js";import"./button-bA6D7oLy.js";import"./omit-snSLv_vL.js";import"./render-IWbIHfGq.js";import"./Overflow-blYa_Cc8.js";import"./GlobalMessage-uqw5jbrt.js";import"./LayerBuilder-VxvHNdV4.js";import"./PlusOutlined-8k7LlG5P.js";import"./PlusOutlined-VdblB-UP.js";import"./NumberInput-M4LWcmYS.js";import"./Select-xkl2cP13.js";class L extends I.Component{constructor(e){super(e);m(this,"dragAddProvider",null);m(this,"dragStart",e=>{var t;if(e.target.classList.contains("droppable-element")){const i=e.target;(t=e.dataTransfer)==null||t.setData("type",i.getAttribute("data-type"))}});m(this,"dragover",e=>{e.preventDefault()});m(this,"drop",e=>{var d;e.preventDefault();const t=(d=e.dataTransfer)==null?void 0:d.getData("type");if(!t)return;const{scale:i,dsContentRef:n}=h,a=n==null?void 0:n.getBoundingClientRect(),r=(e.clientX-((a==null?void 0:a.x)||0))/i,l=(e.clientY-((a==null?void 0:a.y)||0))/i;this.addItem(t,[r,l])});m(this,"addItem",(e,t=[0,0])=>{let{setAddRecordCompId:i}=h;const{definitionMap:n}=b,{compName:a,width:r=320,height:l=200}=n[e].getBaseInfo(),d={name:a,type:e,x:Math.round(t[0]),y:Math.round(t[1]),id:D.generateId(),lock:!1,hide:!1,width:r,height:l};i(d.id),v.doAdd(d)});m(this,"getChartDom",()=>{const e=[];let{compInfoArr:t,search:i,categories:n,subCategories:a}=g;n!=="all"&&(t=t.filter(r=>r.categorize===n)),a!=="all"&&(t=t.filter(r=>r.subCategorize===a)),i!==""&&(t=t.filter(r=>r.compName.indexOf(i)>=0));for(let r=0;r<t.length;r++){const l=t[r],{compName:d,compKey:p}=l,f=j.getLoader(C.EDIT).definitionMap[p].getChartImg();e.push(o.jsx("div",{className:"list-item droppable-element",draggable:!0,onDoubleClick:()=>this.addItem(p),"data-type":p,children:o.jsxs("div",{style:{pointerEvents:"none"},children:[o.jsxs("div",{className:"item-header",ref:"drag-target",children:[o.jsx("div",{className:"item-name",children:d}),o.jsx("div",{className:"item-type",children:"Antd"})]}),o.jsx("div",{className:"item-content",children:o.jsx("img",{src:f,alt:d})})]})},r+""))}return e});m(this,"searchChart",e=>{const{setSearch:t}=g;t&&t(e)});const{doInit:t}=g;t&&t()}componentDidMount(){this.dragAddProvider=new A(document.getElementById("component-drag-container"),document.getElementById("designer-ds-content"),this.dragStart,this.dragover,this.drop)}componentWillUnmount(){var e;(e=this.dragAddProvider)==null||e.destroy()}render(){return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"list-search",children:o.jsx(N,{placeholder:"搜索组件",onChange:this.searchChart})}),o.jsx("div",{className:"list-items",id:"component-drag-container",children:this.getChartDom()})]})}}const Q=y(L);export{Q as default};
