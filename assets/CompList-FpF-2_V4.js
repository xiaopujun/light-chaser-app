var I=Object.defineProperty;var x=(p,m,t)=>m in p?I(p,m,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[m]=t;var d=(p,m,t)=>(x(p,typeof m!="symbol"?m+"":m,t),t);import{r as v,j as a}from"./index-Duc4ZoM_.js";import{o as y}from"./mobxreact.esm-AXuQb6fD.js";import{i as C,b as h,e as f}from"./ViewDesignerLoader-8rMP9FZs.js";import j from"./Input-Fu5_43az.js";import{I as D}from"./LocalOperator-t4oOcFvM.js";import{k as g}from"./DesignerPage-hOKeX8hE.js";import{D as b}from"./DragAddProvider-_IIQLnDx.js";import"./index-AfMii643.js";import"./FetchUtil-5ZwtxN_0.js";import"./Data-_fslVRGK.js";import"./index--SWnmJ5Q.js";import"./GlobalMessage-I0KrOayq.js";import"./MainRouter-l7Z1Z1jr.js";import"./render-8hUH_M6B.js";import"./AntdIcon-jwWmiLqW.js";import"./InfoCircleFilled-JfnNzh3b.js";import"./useZIndex-c7eQO3Zz.js";import"./UIContainer-fqZbFePv.js";import"./index-KGsAQAl1.js";import"./zoom-1qZDylxx.js";import"./Compact-BtIEhQqw.js";import"./Help-Q6DYu7mz.js";import"./FontGlobal-IF-0qGeT.js";import"./PreviewOpen-xNkBcbY-.js";import"./System-wlPeHLhg.js";import"./Dialog-vSMHMWDI.js";import"./Grid-qWvRWUZo.js";import"./MonacoEditor-AmRPsGTx.js";import"./Button-Tm3IfQtm.js";import"./Plus-WQxU0q_G.js";import"./pickAttrs-UI4Ho79H.js";import"./collapse-aS6vX33V.js";import"./fade-CRG4MrDV.js";import"./useForceUpdate-rXHM3SwU.js";import"./button-cD7Pe9UH.js";import"./omit-zfc2TTl_.js";import"./EyeOutlined-R3RbAP4C.js";import"./index-foMHq-FM.js";import"./ActionButton-AsinbvHa.js";import"./Info-kImE1q_J.js";import"./NumberInput-WrPaUvHm.js";import"./Select-wGR39UQA.js";import"./Radio-kbTZ0tv0.js";import"./ThemeEditor-2NmMzzG7.js";import"./ColorPicker-pyjWXEAx.js";import"./PurePanel-ruJ4o-iR.js";import"./index-tOmn1sxg.js";import"./Overflow-2V5ntg0K.js";import"./CardPanel-GnLi4EHp.js";class N extends v.Component{constructor(t){super(t);d(this,"dragAddProvider",null);d(this,"dragStart",t=>{var e;if(t.target.classList.contains("droppable-element")){const o=t.target;(e=t.dataTransfer)==null||e.setData("type",o.getAttribute("data-type"))}});d(this,"dragover",t=>{t.preventDefault()});d(this,"drop",t=>{var s;t.preventDefault();const e=(s=t.dataTransfer)==null?void 0:s.getData("type");if(!e)return;const{scale:o,dsContentRef:n}=f,i=n==null?void 0:n.getBoundingClientRect(),r=(t.clientX-((i==null?void 0:i.x)||0))/o,c=(t.clientY-((i==null?void 0:i.y)||0))/o;this.addItem(e,[r,c])});d(this,"addItem",(t,e=[0,0])=>{let{setAddRecordCompId:o}=f;const{definitionMap:n}=h,{compName:i,width:r=320,height:c=200}=n[t].getBaseInfo(),s={name:i,type:t,x:Math.round(e[0]),y:Math.round(e[1]),id:D.generateId(),lock:!1,hide:!1,width:r,height:c};o(s.id),C.doAdd(s)});d(this,"getChartDom",()=>{const t=[];let{compInfoArr:e,search:o,categories:n,subCategories:i}=g;n!=="all"&&(e=e.filter(r=>r.categorize===n)),i!=="all"&&(e=e.filter(r=>r.subCategorize===i)),o!==""&&(e=e.filter(r=>r.compName.indexOf(o)>=0));for(let r=0;r<e.length;r++){const c=e[r],{compName:s,compKey:l}=c,u=h.definitionMap[l].getChartImg();t.push(a.jsx("div",{className:"list-item droppable-element",draggable:!0,onDoubleClick:()=>this.addItem(l),"data-type":l,children:a.jsxs("div",{style:{pointerEvents:"none"},children:[a.jsx("div",{className:"item-header",ref:"drag-target",children:a.jsx("div",{className:"item-name",children:s})}),a.jsx("div",{className:"item-content",children:a.jsx("img",{src:u,alt:s})})]})},r+""))}return t});d(this,"searchChart",t=>{const{setSearch:e}=g;e&&e(t)});const{doInit:e}=g;e&&e()}componentDidMount(){let t=0;const e=setInterval(()=>{const o=document.getElementById("component-drag-container"),n=document.getElementById("designer-ds-content");o&&n&&(clearInterval(e),this.dragAddProvider=new b(document.getElementById("component-drag-container"),document.getElementById("designer-ds-content"),this.dragStart,this.dragover,this.drop)),++t>100&&(clearInterval(e),console.warn("组件列表与画布拖拽关联失败，无法通过拖拽添加组件。"))},100)}componentWillUnmount(){var t;(t=this.dragAddProvider)==null||t.destroy()}render(){return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"list-search",children:a.jsx(j,{placeholder:"搜索组件",onChange:this.searchChart})}),a.jsx("div",{className:"list-items",id:"component-drag-container",children:this.getChartDom()})]})}}const Dt=y(N);export{Dt as default};
