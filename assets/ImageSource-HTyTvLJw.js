import{r as c,j as r}from"./index-Duc4ZoM_.js";import{I as L,U as x}from"./LocalOperator-t4oOcFvM.js";import{o as y}from"./index--SWnmJ5Q.js";import{i as A,e as I,l as R,b as S}from"./ViewDesignerLoader-8rMP9FZs.js";import{D as B}from"./DragAddProvider-_IIQLnDx.js";import{P as E}from"./DesignerPage-hOKeX8hE.js";import{H as M}from"./Help-Q6DYu7mz.js";import{C as H}from"./Dialog-vSMHMWDI.js";import"./GlobalMessage-I0KrOayq.js";import"./MainRouter-l7Z1Z1jr.js";import"./render-8hUH_M6B.js";import"./AntdIcon-jwWmiLqW.js";import"./InfoCircleFilled-JfnNzh3b.js";import"./useZIndex-c7eQO3Zz.js";import"./FetchUtil-5ZwtxN_0.js";import"./mobxreact.esm-AXuQb6fD.js";import"./index-AfMii643.js";import"./Data-_fslVRGK.js";import"./FontGlobal-IF-0qGeT.js";import"./PreviewOpen-xNkBcbY-.js";import"./System-wlPeHLhg.js";import"./index-KGsAQAl1.js";import"./zoom-1qZDylxx.js";import"./Compact-BtIEhQqw.js";import"./Grid-qWvRWUZo.js";import"./UIContainer-fqZbFePv.js";import"./Input-Fu5_43az.js";import"./MonacoEditor-AmRPsGTx.js";import"./Button-Tm3IfQtm.js";import"./Plus-WQxU0q_G.js";import"./pickAttrs-UI4Ho79H.js";import"./collapse-aS6vX33V.js";import"./fade-CRG4MrDV.js";import"./useForceUpdate-rXHM3SwU.js";import"./button-cD7Pe9UH.js";import"./omit-zfc2TTl_.js";import"./EyeOutlined-R3RbAP4C.js";import"./index-foMHq-FM.js";import"./ActionButton-AsinbvHa.js";import"./Info-kImE1q_J.js";import"./NumberInput-WrPaUvHm.js";import"./Select-wGR39UQA.js";import"./Radio-kbTZ0tv0.js";import"./ThemeEditor-2NmMzzG7.js";import"./ColorPicker-pyjWXEAx.js";import"./PurePanel-ruJ4o-iR.js";import"./index-tOmn1sxg.js";import"./Overflow-2V5ntg0K.js";import"./CardPanel-GnLi4EHp.js";function St(){const[j,v]=c.useState([]),g=c.useRef(null),b=t=>{var e,a;if(t.target.classList.contains("droppable-element")){const o=t.target;(e=t.dataTransfer)==null||e.setData("imageUrl",o.getAttribute("data-url")),(a=t.dataTransfer)==null||a.setData("imageHash",o.getAttribute("data-hash"))}},D=t=>{t.preventDefault()},N=t=>{var n,p;t.preventDefault();const e=(n=t.dataTransfer)==null?void 0:n.getData("imageUrl"),a=(p=t.dataTransfer)==null?void 0:p.getData("imageHash");if(!e)return;const{scale:o,dsContentRef:s}=I,i=s==null?void 0:s.getBoundingClientRect(),l=(t.clientX-((i==null?void 0:i.x)||0))/o,m=(t.clientY-((i==null?void 0:i.y)||0))/o;T("BaseImage",[l,m],e,a)},T=(t,e=[0,0],a,o)=>{const{elemConfigs:s}=R;let{setAddRecordCompId:i}=I;const{definitionMap:l}=S,m=l[t],{compName:n,width:p=320,height:C=200}=m.getBaseInfo(),f=L.generateId(),h={name:n,type:t,x:Math.round(e[0]),y:Math.round(e[1]),id:f,lock:!1,hide:!1,width:p,height:C};i(h.id),A.doAdd(h);const d=m.getInitConfig();d.style.type="local",d.style.localUrl=a,d.style.hash=o,s[f]=d},u=()=>{const{saveType:t,id:e}=x.parseUrlParams();y[t].getImageSourceList(e).then(a=>{v(a)})};c.useEffect(()=>(u(),g.current=new B(document.getElementById("image-source-list"),document.getElementById("designer-ds-content"),b,D,N),()=>{var t;return(t=g.current)==null?void 0:t.destroy()}),[]);const U=t=>{const{saveType:e}=x.parseUrlParams();y[e].delImageSource(t).then(a=>{a&&u()})};return r.jsx("div",{className:"image-source",children:r.jsx("div",{className:"image-source-list",id:"image-source-list",children:j.map((t,e)=>r.jsxs("div",{className:"image-source-item droppable-element",draggable:!0,"data-url":t.url,"data-hash":t.hash,children:[r.jsxs("div",{className:"image-source-item-header",children:[r.jsx("div",{className:"isi-title",children:t.name||"无名称信息"}),r.jsx("div",{className:"isi-operate",children:r.jsx(E,{title:"确认删除吗?",icon:r.jsx(M,{style:{color:"red",position:"relative",top:3,marginRight:2}}),description:"可能会导致已经使用的图片组件失效!",onConfirm:()=>U(t.id),okText:"是",cancelText:"否",children:r.jsx(H,{})})})]}),r.jsx("div",{className:"image-source-item-body",children:r.jsx("div",{className:"item-bg-image",style:{backgroundImage:`url(${t.url})`}})})]},e))})})}export{St as default};
