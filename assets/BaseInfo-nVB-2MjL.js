var x=Object.defineProperty;var C=(d,o,e)=>o in d?x(d,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[o]=e;var h=(d,o,e)=>(C(d,typeof o!="symbol"?o+"":o,e),e);import{r as R,j as n}from"./index-Duc4ZoM_.js";import{aD as y,b as k,e as r,c as g,aP as q,aQ as w,aR as I,aS as L,aT as j,aU as S,aN as T,r as z,l as p,aI as b,j as M}from"./ViewDesignerLoader-8rMP9FZs.js";import{I as A}from"./Info-kImE1q_J.js";import"./mobxreact.esm-AXuQb6fD.js";import"./LocalOperator-t4oOcFvM.js";import"./GlobalMessage-I0KrOayq.js";import"./MainRouter-l7Z1Z1jr.js";import"./render-8hUH_M6B.js";import"./AntdIcon-jwWmiLqW.js";import"./InfoCircleFilled-JfnNzh3b.js";import"./useZIndex-c7eQO3Zz.js";import"./index-AfMii643.js";import"./FetchUtil-5ZwtxN_0.js";import"./Data-_fslVRGK.js";import"./index--SWnmJ5Q.js";class J extends R.Component{constructor(e){super(e);h(this,"init",()=>{var s;const{activeElem:e}=z,{layerConfigs:t}=p,i=t[e.id];if(i)if(i.type==="group"){const a=y.findAllChildLayer([i.id]).filter(c=>t[c].type!=="group"),l=this.calculateGroupRect(a);this.state={...i,...l}}else{const a=(s=k.definitionMap[i.type])==null?void 0:s.getBaseInfo();this.state={...i,version:a==null?void 0:a.version}}});h(this,"calculateGroupRect",e=>{const{layerConfigs:t}=p;let i=1/0,s=1/0,a=-1/0,l=-1/0;return e.forEach(c=>{const{x:u=0,y:m=0,width:f=0,height:v=0}=t[c];i=Math.min(i,u),s=Math.min(s,m),a=Math.max(a,u+f),l=Math.max(l,m+v)}),{x:i,y:s,width:a-i,height:l-s}});h(this,"changeName",e=>{const{controller:t}=this.props;t.update({base:{name:e}},{reRender:!1});const{updateLayer:i}=p;i&&i([{id:this.state.id,name:e}]);const{layerInstances:s}=M,a=s[this.state.id];a&&a.setState({name:e})});h(this,"handleMap",{name:this.changeName,width:e=>{var t;return(t=r.movableRef)==null?void 0:t.request("resizable",{offsetWidth:e,direction:[1,1]},!0)},height:e=>{var t;return(t=r.movableRef)==null?void 0:t.request("resizable",{offsetHeight:e,direction:[1,1]},!0)},posX:e=>{var t;return(t=r.movableRef)==null?void 0:t.request("draggable",{x:e},!0)},posY:e=>{var t;return(t=r.movableRef)==null?void 0:t.request("draggable",{y:e},!0)},align:e=>this.handleMap[e](),left:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{x:0},!0)},horizontally:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{x:g.canvasConfig.width/2-this.state.width/2},!0)},right:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{x:g.canvasConfig.width-this.state.width},!0)},top:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{y:0},!0)},vertically:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{y:g.canvasConfig.height/2-this.state.height/2},!0)},bottom:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{y:g.canvasConfig.height-this.state.height},!0)}});h(this,"onFieldChange",e=>{const{id:t,data:i}=e,{targetIds:s,setTargetIds:a}=r;if(!s.includes(this.state.id)){const{type:c}=this.state;if(c==="group"){const{layerConfigs:u}=p,m=y.findAllChildLayer([this.state.id]).filter(f=>u[f].type!=="group");a(m)}else a([this.state.id])}const l=setTimeout(()=>{this.handleMap[t](i),clearTimeout(l)},1)});h(this,"buildSchema",()=>{const{name:e,width:t,height:i,x:s,y:a}=this.state;return{type:"grid",config:{columns:2},children:[{id:"name",key:"name",label:"名称",type:"input",value:e,config:{containerStyle:{gridColumn:"1/3"}}},{type:"grid",label:"尺寸",config:{columns:2,containerStyle:{gridColumn:"1/3"}},children:[{id:"width",key:"width",type:"number-input",label:"宽度",value:t,reRender:!0},{id:"height",key:"height",type:"number-input",label:"高度",value:i,reRender:!0}]},{type:"grid",label:"位置",config:{columns:2,containerStyle:{gridColumn:"1/3"}},children:[{id:"posX",key:"posX",type:"number-input",label:"X轴",reRender:!0,value:s},{id:"posY",key:"posY",type:"number-input",label:"Y轴",reRender:!0,value:a}]},{id:"align",label:"对齐",type:"group-button",config:{containerStyle:{gridColumn:"1/3"},items:[{value:"left",content:n.jsx(q,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"horizontally",content:n.jsx(w,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"right",content:n.jsx(I,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"top",content:n.jsx(L,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"vertically",content:n.jsx(j,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"bottom",content:n.jsx(S,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})}]}}]}});this.init()}componentDidMount(){const{setBaseConfigRef:e}=b;e&&e(this)}componentWillUnmount(){const{setBaseConfigRef:e}=b;e&&e(null)}render(){const{type:e,version:t}=this.state,i=this.buildSchema();return n.jsxs("div",{className:"base-info-config",children:[n.jsx("div",{className:"version-info",children:n.jsxs("span",{children:[n.jsx(A,{})," ",e," | ",t?`版本: ${t}`:"无版本信息"]})}),n.jsx(T,{schema:i,onFieldChange:this.onFieldChange})]})}}export{J as default};
