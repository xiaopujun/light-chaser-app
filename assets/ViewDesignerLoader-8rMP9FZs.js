var wt=Object.defineProperty;var Mt=(a,r,e)=>r in a?wt(a,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[r]=e;var U=(a,r,e)=>(Mt(a,typeof r!="symbol"?r+"":r,e),e);import{d as debounce$2,m as makeObservable,a as observable,b as action,r as runInAction,t as toJS,o as observer}from"./mobxreact.esm-AXuQb6fD.js";import{l as lodashExports,O as ObjectUtil,i as imageSourceCache,I as IdGenerate,U as URLUtil,D as DesignerMode}from"./LocalOperator-t4oOcFvM.js";import{b as React,g as getDefaultExportFromCjs$1,r as reactExports,f as createRoot,j as jsxRuntimeExports,_ as __vitePreload,d as commonjsGlobal,L as Loading}from"./index-Duc4ZoM_.js";import{i as index$3,I as IconWrapper}from"./index-AfMii643.js";import{F as FetchUtil}from"./FetchUtil-5ZwtxN_0.js";import{D as Data}from"./Data-_fslVRGK.js";import{o as operatorMap}from"./index--SWnmJ5Q.js";import{globalMessage}from"./GlobalMessage-I0KrOayq.js";import{m as _objectSpread2$1,H as _inherits,I as _createSuper,J as _classCallCheck,h as _defineProperty$1,K as _assertThisInitialized,L as _createClass,g as _extends$1,c as classNames,_ as _objectWithoutProperties,o as _typeof,r as resetComponent,j as unit,C as ConfigContext}from"./MainRouter-l7Z1Z1jr.js";import{g as genStyleHooks,m as merge}from"./AntdIcon-jwWmiLqW.js";const Shape$1=Object.freeze(Object.defineProperty({__proto__:null,get Base(){return ShapeBase$1},get Circle(){return Circle$2},get Ellipse(){return Ellipse$1},get Image(){return ImageShape},get Line(){return Line$3},get Marker(){return Marker$1},get Path(){return Path$2},get Polygon(){return Polygon$2},get Polyline(){return PolyLine},get Rect(){return Rect$2},get Text(){return Text$1}},Symbol.toStringTag,{value:"Module"})),Shape=Object.freeze(Object.defineProperty({__proto__:null,get Base(){return ShapeBase},get Circle(){return Circle$1},get Dom(){return Dom},get Ellipse(){return Ellipse},get Image(){return Image$1},get Line(){return Line$2},get Marker(){return Marker},get Path(){return Path$1},get Polygon(){return Polygon$1},get Polyline(){return Polyline},get Rect(){return Rect$1},get Text(){return Text}},Symbol.toStringTag,{value:"Module"}));var initialState={animating:!1,autoplaying:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,dragging:!1,edgeDragged:!1,initialized:!1,lazyLoadedList:[],listHeight:null,listWidth:null,scrolling:!1,slideCount:null,slideHeight:null,slideWidth:null,swipeLeft:null,swiped:!1,swiping:!1,touchObject:{startX:0,startY:0,curX:0,curY:0},trackStyle:{},trackWidth:0,targetSlide:0};function clamp$1(a,r,e){return Math.max(r,Math.min(a,e))}var safePreventDefault=function(r){var e=["onTouchStart","onTouchMove","onWheel"];e.includes(r._reactName)||r.preventDefault()},getOnDemandLazySlides=function(r){for(var e=[],n=lazyStartIndex(r),o=lazyEndIndex(r),s=n;s<o;s++)r.lazyLoadedList.indexOf(s)<0&&e.push(s);return e},lazyStartIndex=function(r){return r.currentSlide-lazySlidesOnLeft(r)},lazyEndIndex=function(r){return r.currentSlide+lazySlidesOnRight(r)},lazySlidesOnLeft=function(r){return r.centerMode?Math.floor(r.slidesToShow/2)+(parseInt(r.centerPadding)>0?1:0):0},lazySlidesOnRight=function(r){return r.centerMode?Math.floor((r.slidesToShow-1)/2)+1+(parseInt(r.centerPadding)>0?1:0):r.slidesToShow},getWidth=function(r){return r&&r.offsetWidth||0},getHeight$2=function(r){return r&&r.offsetHeight||0},getSwipeDirection=function(r){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n,o,s,l;return n=r.startX-r.curX,o=r.startY-r.curY,s=Math.atan2(o,n),l=Math.round(s*180/Math.PI),l<0&&(l=360-Math.abs(l)),l<=45&&l>=0||l<=360&&l>=315?"left":l>=135&&l<=225?"right":e===!0?l>=35&&l<=135?"up":"down":"vertical"},canGoNext=function(r){var e=!0;return r.infinite||(r.centerMode&&r.currentSlide>=r.slideCount-1||r.slideCount<=r.slidesToShow||r.currentSlide>=r.slideCount-r.slidesToShow)&&(e=!1),e},extractObject=function(r,e){var n={};return e.forEach(function(o){return n[o]=r[o]}),n},initializedState=function(r){var e=React.Children.count(r.children),n=r.listRef,o=Math.ceil(getWidth(n)),s=r.trackRef&&r.trackRef.node,l=Math.ceil(getWidth(s)),c;if(r.vertical)c=o;else{var u=r.centerMode&&parseInt(r.centerPadding)*2;typeof r.centerPadding=="string"&&r.centerPadding.slice(-1)==="%"&&(u*=o/100),c=Math.ceil((o-u)/r.slidesToShow)}var f=n&&getHeight$2(n.querySelector('[data-index="0"]')),d=f*r.slidesToShow,g=r.currentSlide===void 0?r.initialSlide:r.currentSlide;r.rtl&&r.currentSlide===void 0&&(g=e-1-r.initialSlide);var p=r.lazyLoadedList||[],v=getOnDemandLazySlides(_objectSpread2$1(_objectSpread2$1({},r),{},{currentSlide:g,lazyLoadedList:p}));p=p.concat(v);var m={slideCount:e,slideWidth:c,listWidth:o,trackWidth:l,currentSlide:g,slideHeight:f,listHeight:d,lazyLoadedList:p};return r.autoplaying===null&&r.autoplay&&(m.autoplaying="playing"),m},slideHandler=function(r){var e=r.waitForAnimate,n=r.animating,o=r.fade,s=r.infinite,l=r.index,c=r.slideCount,u=r.lazyLoad,f=r.currentSlide,d=r.centerMode,g=r.slidesToScroll,p=r.slidesToShow,v=r.useCSS,m=r.lazyLoadedList;if(e&&n)return{};var y=l,x,_,E,S={},A={},T=s?l:clamp$1(l,0,c-1);if(o){if(!s&&(l<0||l>=c))return{};l<0?y=l+c:l>=c&&(y=l-c),u&&m.indexOf(y)<0&&(m=m.concat(y)),S={animating:!0,currentSlide:y,lazyLoadedList:m,targetSlide:y},A={animating:!1,targetSlide:y}}else x=y,y<0?(x=y+c,s?c%g!==0&&(x=c-c%g):x=0):!canGoNext(r)&&y>f?y=x=f:d&&y>=c?(y=s?c:c-1,x=s?0:c-1):y>=c&&(x=y-c,s?c%g!==0&&(x=0):x=c-p),!s&&y+p>=c&&(x=c-p),_=getTrackLeft(_objectSpread2$1(_objectSpread2$1({},r),{},{slideIndex:y})),E=getTrackLeft(_objectSpread2$1(_objectSpread2$1({},r),{},{slideIndex:x})),s||(_===E&&(y=x),_=E),u&&(m=m.concat(getOnDemandLazySlides(_objectSpread2$1(_objectSpread2$1({},r),{},{currentSlide:y})))),v?(S={animating:!0,currentSlide:x,trackStyle:getTrackAnimateCSS(_objectSpread2$1(_objectSpread2$1({},r),{},{left:_})),lazyLoadedList:m,targetSlide:T},A={animating:!1,currentSlide:x,trackStyle:getTrackCSS(_objectSpread2$1(_objectSpread2$1({},r),{},{left:E})),swipeLeft:null,targetSlide:T}):S={currentSlide:x,trackStyle:getTrackCSS(_objectSpread2$1(_objectSpread2$1({},r),{},{left:E})),lazyLoadedList:m,targetSlide:T};return{state:S,nextState:A}},changeSlide=function(r,e){var n,o,s,l,c,u=r.slidesToScroll,f=r.slidesToShow,d=r.slideCount,g=r.currentSlide,p=r.targetSlide,v=r.lazyLoad,m=r.infinite;if(l=d%u!==0,n=l?0:(d-g)%u,e.message==="previous")s=n===0?u:f-n,c=g-s,v&&!m&&(o=g-s,c=o===-1?d-1:o),m||(c=p-u);else if(e.message==="next")s=n===0?u:n,c=g+s,v&&!m&&(c=(g+u)%d+n),m||(c=p+u);else if(e.message==="dots")c=e.index*e.slidesToScroll;else if(e.message==="children"){if(c=e.index,m){var y=siblingDirection(_objectSpread2$1(_objectSpread2$1({},r),{},{targetSlide:c}));c>e.currentSlide&&y==="left"?c=c-d:c<e.currentSlide&&y==="right"&&(c=c+d)}}else e.message==="index"&&(c=Number(e.index));return c},keyHandler=function(r,e,n){return r.target.tagName.match("TEXTAREA|INPUT|SELECT")||!e?"":r.keyCode===37?n?"next":"previous":r.keyCode===39?n?"previous":"next":""},swipeStart=function(r,e,n){return r.target.tagName==="IMG"&&safePreventDefault(r),!e||!n&&r.type.indexOf("mouse")!==-1?"":{dragging:!0,touchObject:{startX:r.touches?r.touches[0].pageX:r.clientX,startY:r.touches?r.touches[0].pageY:r.clientY,curX:r.touches?r.touches[0].pageX:r.clientX,curY:r.touches?r.touches[0].pageY:r.clientY}}},swipeMove=function(r,e){var n=e.scrolling,o=e.animating,s=e.vertical,l=e.swipeToSlide,c=e.verticalSwiping,u=e.rtl,f=e.currentSlide,d=e.edgeFriction,g=e.edgeDragged,p=e.onEdge,v=e.swiped,m=e.swiping,y=e.slideCount,x=e.slidesToScroll,_=e.infinite,E=e.touchObject,S=e.swipeEvent,A=e.listHeight,T=e.listWidth;if(!n){if(o)return safePreventDefault(r);s&&l&&c&&safePreventDefault(r);var b,C={},L=getTrackLeft(e);E.curX=r.touches?r.touches[0].pageX:r.clientX,E.curY=r.touches?r.touches[0].pageY:r.clientY,E.swipeLength=Math.round(Math.sqrt(Math.pow(E.curX-E.startX,2)));var R=Math.round(Math.sqrt(Math.pow(E.curY-E.startY,2)));if(!c&&!m&&R>10)return{scrolling:!0};c&&(E.swipeLength=R);var I=(u?-1:1)*(E.curX>E.startX?1:-1);c&&(I=E.curY>E.startY?1:-1);var w=Math.ceil(y/x),M=getSwipeDirection(e.touchObject,c),D=E.swipeLength;return _||(f===0&&(M==="right"||M==="down")||f+1>=w&&(M==="left"||M==="up")||!canGoNext(e)&&(M==="left"||M==="up"))&&(D=E.swipeLength*d,g===!1&&p&&(p(M),C.edgeDragged=!0)),!v&&S&&(S(M),C.swiped=!0),s?b=L+D*(A/T)*I:u?b=L-D*I:b=L+D*I,c&&(b=L+D*I),C=_objectSpread2$1(_objectSpread2$1({},C),{},{touchObject:E,swipeLeft:b,trackStyle:getTrackCSS(_objectSpread2$1(_objectSpread2$1({},e),{},{left:b}))}),Math.abs(E.curX-E.startX)<Math.abs(E.curY-E.startY)*.8||E.swipeLength>10&&(C.swiping=!0,safePreventDefault(r)),C}},swipeEnd=function(r,e){var n=e.dragging,o=e.swipe,s=e.touchObject,l=e.listWidth,c=e.touchThreshold,u=e.verticalSwiping,f=e.listHeight,d=e.swipeToSlide,g=e.scrolling,p=e.onSwipe,v=e.targetSlide,m=e.currentSlide,y=e.infinite;if(!n)return o&&safePreventDefault(r),{};var x=u?f/c:l/c,_=getSwipeDirection(s,u),E={dragging:!1,edgeDragged:!1,scrolling:!1,swiping:!1,swiped:!1,swipeLeft:null,touchObject:{}};if(g||!s.swipeLength)return E;if(s.swipeLength>x){safePreventDefault(r),p&&p(_);var S,A,T=y?m:v;switch(_){case"left":case"up":A=T+getSlideCount(e),S=d?checkNavigable(e,A):A,E.currentDirection=0;break;case"right":case"down":A=T-getSlideCount(e),S=d?checkNavigable(e,A):A,E.currentDirection=1;break;default:S=T}E.triggerSlideHandler=S}else{var b=getTrackLeft(e);E.trackStyle=getTrackAnimateCSS(_objectSpread2$1(_objectSpread2$1({},e),{},{left:b}))}return E},getNavigableIndexes=function(r){for(var e=r.infinite?r.slideCount*2:r.slideCount,n=r.infinite?r.slidesToShow*-1:0,o=r.infinite?r.slidesToShow*-1:0,s=[];n<e;)s.push(n),n=o+r.slidesToScroll,o+=Math.min(r.slidesToScroll,r.slidesToShow);return s},checkNavigable=function(r,e){var n=getNavigableIndexes(r),o=0;if(e>n[n.length-1])e=n[n.length-1];else for(var s in n){if(e<n[s]){e=o;break}o=n[s]}return e},getSlideCount=function(r){var e=r.centerMode?r.slideWidth*Math.floor(r.slidesToShow/2):0;if(r.swipeToSlide){var n,o=r.listRef,s=o.querySelectorAll&&o.querySelectorAll(".slick-slide")||[];if(Array.from(s).every(function(u){if(r.vertical){if(u.offsetTop+getHeight$2(u)/2>r.swipeLeft*-1)return n=u,!1}else if(u.offsetLeft-e+getWidth(u)/2>r.swipeLeft*-1)return n=u,!1;return!0}),!n)return 0;var l=r.rtl===!0?r.slideCount-r.currentSlide:r.currentSlide,c=Math.abs(n.dataset.index-l)||1;return c}else return r.slidesToScroll},checkSpecKeys=function(r,e){return e.reduce(function(n,o){return n&&r.hasOwnProperty(o)},!0)?null:console.error("Keys Missing:",r)},getTrackCSS=function(r){checkSpecKeys(r,["left","variableWidth","slideCount","slidesToShow","slideWidth"]);var e,n,o=r.slideCount+2*r.slidesToShow;r.vertical?n=o*r.slideHeight:e=getTotalSlides(r)*r.slideWidth;var s={opacity:1,transition:"",WebkitTransition:""};if(r.useTransform){var l=r.vertical?"translate3d(0px, "+r.left+"px, 0px)":"translate3d("+r.left+"px, 0px, 0px)",c=r.vertical?"translate3d(0px, "+r.left+"px, 0px)":"translate3d("+r.left+"px, 0px, 0px)",u=r.vertical?"translateY("+r.left+"px)":"translateX("+r.left+"px)";s=_objectSpread2$1(_objectSpread2$1({},s),{},{WebkitTransform:l,transform:c,msTransform:u})}else r.vertical?s.top=r.left:s.left=r.left;return r.fade&&(s={opacity:1}),e&&(s.width=e),n&&(s.height=n),window&&!window.addEventListener&&window.attachEvent&&(r.vertical?s.marginTop=r.left+"px":s.marginLeft=r.left+"px"),s},getTrackAnimateCSS=function(r){checkSpecKeys(r,["left","variableWidth","slideCount","slidesToShow","slideWidth","speed","cssEase"]);var e=getTrackCSS(r);return r.useTransform?(e.WebkitTransition="-webkit-transform "+r.speed+"ms "+r.cssEase,e.transition="transform "+r.speed+"ms "+r.cssEase):r.vertical?e.transition="top "+r.speed+"ms "+r.cssEase:e.transition="left "+r.speed+"ms "+r.cssEase,e},getTrackLeft=function(r){if(r.unslick)return 0;checkSpecKeys(r,["slideIndex","trackRef","infinite","centerMode","slideCount","slidesToShow","slidesToScroll","slideWidth","listWidth","variableWidth","slideHeight"]);var e=r.slideIndex,n=r.trackRef,o=r.infinite,s=r.centerMode,l=r.slideCount,c=r.slidesToShow,u=r.slidesToScroll,f=r.slideWidth,d=r.listWidth,g=r.variableWidth,p=r.slideHeight,v=r.fade,m=r.vertical,y=0,x,_,E=0;if(v||r.slideCount===1)return 0;var S=0;if(o?(S=-getPreClones(r),l%u!==0&&e+u>l&&(S=-(e>l?c-(e-l):l%u)),s&&(S+=parseInt(c/2))):(l%u!==0&&e+u>l&&(S=c-l%u),s&&(S=parseInt(c/2))),y=S*f,E=S*p,m?x=e*p*-1+E:x=e*f*-1+y,g===!0){var A,T=n&&n.node;if(A=e+getPreClones(r),_=T&&T.childNodes[A],x=_?_.offsetLeft*-1:0,s===!0){A=o?e+getPreClones(r):e,_=T&&T.children[A],x=0;for(var b=0;b<A;b++)x-=T&&T.children[b]&&T.children[b].offsetWidth;x-=parseInt(r.centerPadding),x+=_&&(d-_.offsetWidth)/2}}return x},getPreClones=function(r){return r.unslick||!r.infinite?0:r.variableWidth?r.slideCount:r.slidesToShow+(r.centerMode?1:0)},getPostClones=function(r){return r.unslick||!r.infinite?0:r.slideCount},getTotalSlides=function(r){return r.slideCount===1?1:getPreClones(r)+r.slideCount+getPostClones(r)},siblingDirection=function(r){return r.targetSlide>r.currentSlide?r.targetSlide>r.currentSlide+slidesOnRight(r)?"left":"right":r.targetSlide<r.currentSlide-slidesOnLeft(r)?"right":"left"},slidesOnRight=function(r){var e=r.slidesToShow,n=r.centerMode,o=r.rtl,s=r.centerPadding;if(n){var l=(e-1)/2+1;return parseInt(s)>0&&(l+=1),o&&e%2===0&&(l+=1),l}return o?0:e-1},slidesOnLeft=function(r){var e=r.slidesToShow,n=r.centerMode,o=r.rtl,s=r.centerPadding;if(n){var l=(e-1)/2+1;return parseInt(s)>0&&(l+=1),!o&&e%2===0&&(l+=1),l}return o?e-1:0},canUseDOM=function(){return!!(typeof window<"u"&&window.document&&window.document.createElement)},getSlideClasses=function(r){var e,n,o,s,l;r.rtl?l=r.slideCount-1-r.index:l=r.index,o=l<0||l>=r.slideCount,r.centerMode?(s=Math.floor(r.slidesToShow/2),n=(l-r.currentSlide)%r.slideCount===0,l>r.currentSlide-s-1&&l<=r.currentSlide+s&&(e=!0)):e=r.currentSlide<=l&&l<r.currentSlide+r.slidesToShow;var c;r.targetSlide<0?c=r.targetSlide+r.slideCount:r.targetSlide>=r.slideCount?c=r.targetSlide-r.slideCount:c=r.targetSlide;var u=l===c;return{"slick-slide":!0,"slick-active":e,"slick-center":n,"slick-cloned":o,"slick-current":u}},getSlideStyle=function(r){var e={};return(r.variableWidth===void 0||r.variableWidth===!1)&&(e.width=r.slideWidth),r.fade&&(e.position="relative",r.vertical&&r.slideHeight?e.top=-r.index*parseInt(r.slideHeight):e.left=-r.index*parseInt(r.slideWidth),e.opacity=r.currentSlide===r.index?1:0,r.useCSS&&(e.transition="opacity "+r.speed+"ms "+r.cssEase+", visibility "+r.speed+"ms "+r.cssEase)),e},getKey$1=function(r,e){return r.key+"-"+e},renderSlides=function(r){var e,n=[],o=[],s=[],l=React.Children.count(r.children),c=lazyStartIndex(r),u=lazyEndIndex(r);return React.Children.forEach(r.children,function(f,d){var g,p={message:"children",index:d,slidesToScroll:r.slidesToScroll,currentSlide:r.currentSlide};!r.lazyLoad||r.lazyLoad&&r.lazyLoadedList.indexOf(d)>=0?g=f:g=React.createElement("div",null);var v=getSlideStyle(_objectSpread2$1(_objectSpread2$1({},r),{},{index:d})),m=g.props.className||"",y=getSlideClasses(_objectSpread2$1(_objectSpread2$1({},r),{},{index:d}));if(n.push(React.cloneElement(g,{key:"original"+getKey$1(g,d),"data-index":d,className:classNames(y,m),tabIndex:"-1","aria-hidden":!y["slick-active"],style:_objectSpread2$1(_objectSpread2$1({outline:"none"},g.props.style||{}),v),onClick:function(E){g.props&&g.props.onClick&&g.props.onClick(E),r.focusOnSelect&&r.focusOnSelect(p)}})),r.infinite&&r.fade===!1){var x=l-d;x<=getPreClones(r)&&l!==r.slidesToShow&&(e=-x,e>=c&&(g=f),y=getSlideClasses(_objectSpread2$1(_objectSpread2$1({},r),{},{index:e})),o.push(React.cloneElement(g,{key:"precloned"+getKey$1(g,e),"data-index":e,tabIndex:"-1",className:classNames(y,m),"aria-hidden":!y["slick-active"],style:_objectSpread2$1(_objectSpread2$1({},g.props.style||{}),v),onClick:function(E){g.props&&g.props.onClick&&g.props.onClick(E),r.focusOnSelect&&r.focusOnSelect(p)}}))),l!==r.slidesToShow&&(e=l+d,e<u&&(g=f),y=getSlideClasses(_objectSpread2$1(_objectSpread2$1({},r),{},{index:e})),s.push(React.cloneElement(g,{key:"postcloned"+getKey$1(g,e),"data-index":e,tabIndex:"-1",className:classNames(y,m),"aria-hidden":!y["slick-active"],style:_objectSpread2$1(_objectSpread2$1({},g.props.style||{}),v),onClick:function(E){g.props&&g.props.onClick&&g.props.onClick(E),r.focusOnSelect&&r.focusOnSelect(p)}})))}}),r.rtl?o.concat(n,s).reverse():o.concat(n,s)},Track=function(a){_inherits(e,a);var r=_createSuper(e);function e(){var n;_classCallCheck(this,e);for(var o=arguments.length,s=new Array(o),l=0;l<o;l++)s[l]=arguments[l];return n=r.call.apply(r,[this].concat(s)),_defineProperty$1(_assertThisInitialized(n),"node",null),_defineProperty$1(_assertThisInitialized(n),"handleRef",function(c){n.node=c}),n}return _createClass(e,[{key:"render",value:function(){var o=renderSlides(this.props),s=this.props,l=s.onMouseEnter,c=s.onMouseOver,u=s.onMouseLeave,f={onMouseEnter:l,onMouseOver:c,onMouseLeave:u};return React.createElement("div",_extends$1({ref:this.handleRef,className:"slick-track",style:this.props.trackStyle},f),o)}}]),e}(React.PureComponent),getDotCount=function(r){var e;return r.infinite?e=Math.ceil(r.slideCount/r.slidesToScroll):e=Math.ceil((r.slideCount-r.slidesToShow)/r.slidesToScroll)+1,e},Dots=function(a){_inherits(e,a);var r=_createSuper(e);function e(){return _classCallCheck(this,e),r.apply(this,arguments)}return _createClass(e,[{key:"clickHandler",value:function(o,s){s.preventDefault(),this.props.clickHandler(o)}},{key:"render",value:function(){for(var o=this.props,s=o.onMouseEnter,l=o.onMouseOver,c=o.onMouseLeave,u=o.infinite,f=o.slidesToScroll,d=o.slidesToShow,g=o.slideCount,p=o.currentSlide,v=getDotCount({slideCount:g,slidesToScroll:f,slidesToShow:d,infinite:u}),m={onMouseEnter:s,onMouseOver:l,onMouseLeave:c},y=[],x=0;x<v;x++){var _=(x+1)*f-1,E=u?_:clamp$1(_,0,g-1),S=E-(f-1),A=u?S:clamp$1(S,0,g-1),T=classNames({"slick-active":u?p>=A&&p<=E:p===A}),b={message:"dots",index:x,slidesToScroll:f,currentSlide:p},C=this.clickHandler.bind(this,b);y=y.concat(React.createElement("li",{key:x,className:T},React.cloneElement(this.props.customPaging(x),{onClick:C})))}return React.cloneElement(this.props.appendDots(y),_objectSpread2$1({className:this.props.dotsClass},m))}}]),e}(React.PureComponent),PrevArrow=function(a){_inherits(e,a);var r=_createSuper(e);function e(){return _classCallCheck(this,e),r.apply(this,arguments)}return _createClass(e,[{key:"clickHandler",value:function(o,s){s&&s.preventDefault(),this.props.clickHandler(o,s)}},{key:"render",value:function(){var o={"slick-arrow":!0,"slick-prev":!0},s=this.clickHandler.bind(this,{message:"previous"});!this.props.infinite&&(this.props.currentSlide===0||this.props.slideCount<=this.props.slidesToShow)&&(o["slick-disabled"]=!0,s=null);var l={key:"0","data-role":"none",className:classNames(o),style:{display:"block"},onClick:s},c={currentSlide:this.props.currentSlide,slideCount:this.props.slideCount},u;return this.props.prevArrow?u=React.cloneElement(this.props.prevArrow,_objectSpread2$1(_objectSpread2$1({},l),c)):u=React.createElement("button",_extends$1({key:"0",type:"button"},l)," ","Previous"),u}}]),e}(React.PureComponent),NextArrow=function(a){_inherits(e,a);var r=_createSuper(e);function e(){return _classCallCheck(this,e),r.apply(this,arguments)}return _createClass(e,[{key:"clickHandler",value:function(o,s){s&&s.preventDefault(),this.props.clickHandler(o,s)}},{key:"render",value:function(){var o={"slick-arrow":!0,"slick-next":!0},s=this.clickHandler.bind(this,{message:"next"});canGoNext(this.props)||(o["slick-disabled"]=!0,s=null);var l={key:"1","data-role":"none",className:classNames(o),style:{display:"block"},onClick:s},c={currentSlide:this.props.currentSlide,slideCount:this.props.slideCount},u;return this.props.nextArrow?u=React.cloneElement(this.props.nextArrow,_objectSpread2$1(_objectSpread2$1({},l),c)):u=React.createElement("button",_extends$1({key:"1",type:"button"},l)," ","Next"),u}}]),e}(React.PureComponent),_excluded=["animating"],InnerSlider=function(a){_inherits(e,a);var r=_createSuper(e);function e(n){var o;_classCallCheck(this,e),o=r.call(this,n),_defineProperty$1(_assertThisInitialized(o),"listRefHandler",function(l){return o.list=l}),_defineProperty$1(_assertThisInitialized(o),"trackRefHandler",function(l){return o.track=l}),_defineProperty$1(_assertThisInitialized(o),"adaptHeight",function(){if(o.props.adaptiveHeight&&o.list){var l=o.list.querySelector('[data-index="'.concat(o.state.currentSlide,'"]'));o.list.style.height=getHeight$2(l)+"px"}}),_defineProperty$1(_assertThisInitialized(o),"componentDidMount",function(){if(o.props.onInit&&o.props.onInit(),o.props.lazyLoad){var l=getOnDemandLazySlides(_objectSpread2$1(_objectSpread2$1({},o.props),o.state));l.length>0&&(o.setState(function(u){return{lazyLoadedList:u.lazyLoadedList.concat(l)}}),o.props.onLazyLoad&&o.props.onLazyLoad(l))}var c=_objectSpread2$1({listRef:o.list,trackRef:o.track},o.props);o.updateState(c,!0,function(){o.adaptHeight(),o.props.autoplay&&o.autoPlay("playing")}),o.props.lazyLoad==="progressive"&&(o.lazyLoadTimer=setInterval(o.progressiveLazyLoad,1e3)),o.ro=new index$3(function(){o.state.animating?(o.onWindowResized(!1),o.callbackTimers.push(setTimeout(function(){return o.onWindowResized()},o.props.speed))):o.onWindowResized()}),o.ro.observe(o.list),document.querySelectorAll&&Array.prototype.forEach.call(document.querySelectorAll(".slick-slide"),function(u){u.onfocus=o.props.pauseOnFocus?o.onSlideFocus:null,u.onblur=o.props.pauseOnFocus?o.onSlideBlur:null}),window.addEventListener?window.addEventListener("resize",o.onWindowResized):window.attachEvent("onresize",o.onWindowResized)}),_defineProperty$1(_assertThisInitialized(o),"componentWillUnmount",function(){o.animationEndCallback&&clearTimeout(o.animationEndCallback),o.lazyLoadTimer&&clearInterval(o.lazyLoadTimer),o.callbackTimers.length&&(o.callbackTimers.forEach(function(l){return clearTimeout(l)}),o.callbackTimers=[]),window.addEventListener?window.removeEventListener("resize",o.onWindowResized):window.detachEvent("onresize",o.onWindowResized),o.autoplayTimer&&clearInterval(o.autoplayTimer),o.ro.disconnect()}),_defineProperty$1(_assertThisInitialized(o),"componentDidUpdate",function(l){if(o.checkImagesLoad(),o.props.onReInit&&o.props.onReInit(),o.props.lazyLoad){var c=getOnDemandLazySlides(_objectSpread2$1(_objectSpread2$1({},o.props),o.state));c.length>0&&(o.setState(function(d){return{lazyLoadedList:d.lazyLoadedList.concat(c)}}),o.props.onLazyLoad&&o.props.onLazyLoad(c))}o.adaptHeight();var u=_objectSpread2$1(_objectSpread2$1({listRef:o.list,trackRef:o.track},o.props),o.state),f=o.didPropsChange(l);f&&o.updateState(u,f,function(){o.state.currentSlide>=React.Children.count(o.props.children)&&o.changeSlide({message:"index",index:React.Children.count(o.props.children)-o.props.slidesToShow,currentSlide:o.state.currentSlide}),(l.autoplay!==o.props.autoplay||l.autoplaySpeed!==o.props.autoplaySpeed)&&(!l.autoplay&&o.props.autoplay?o.autoPlay("playing"):o.props.autoplay?o.autoPlay("update"):o.pause("paused"))})}),_defineProperty$1(_assertThisInitialized(o),"onWindowResized",function(l){o.debouncedResize&&o.debouncedResize.cancel(),o.debouncedResize=debounce$2(50,function(){return o.resizeWindow(l)}),o.debouncedResize()}),_defineProperty$1(_assertThisInitialized(o),"resizeWindow",function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0,c=!!(o.track&&o.track.node);if(c){var u=_objectSpread2$1(_objectSpread2$1({listRef:o.list,trackRef:o.track},o.props),o.state);o.updateState(u,l,function(){o.props.autoplay?o.autoPlay("update"):o.pause("paused")}),o.setState({animating:!1}),clearTimeout(o.animationEndCallback),delete o.animationEndCallback}}),_defineProperty$1(_assertThisInitialized(o),"updateState",function(l,c,u){var f=initializedState(l);l=_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},l),f),{},{slideIndex:f.currentSlide});var d=getTrackLeft(l);l=_objectSpread2$1(_objectSpread2$1({},l),{},{left:d});var g=getTrackCSS(l);(c||React.Children.count(o.props.children)!==React.Children.count(l.children))&&(f.trackStyle=g),o.setState(f,u)}),_defineProperty$1(_assertThisInitialized(o),"ssrInit",function(){if(o.props.variableWidth){var l=0,c=0,u=[],f=getPreClones(_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},o.props),o.state),{},{slideCount:o.props.children.length})),d=getPostClones(_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},o.props),o.state),{},{slideCount:o.props.children.length}));o.props.children.forEach(function(C){u.push(C.props.style.width),l+=C.props.style.width});for(var g=0;g<f;g++)c+=u[u.length-1-g],l+=u[u.length-1-g];for(var p=0;p<d;p++)l+=u[p];for(var v=0;v<o.state.currentSlide;v++)c+=u[v];var m={width:l+"px",left:-c+"px"};if(o.props.centerMode){var y="".concat(u[o.state.currentSlide],"px");m.left="calc(".concat(m.left," + (100% - ").concat(y,") / 2 ) ")}return{trackStyle:m}}var x=React.Children.count(o.props.children),_=_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},o.props),o.state),{},{slideCount:x}),E=getPreClones(_)+getPostClones(_)+x,S=100/o.props.slidesToShow*E,A=100/E,T=-A*(getPreClones(_)+o.state.currentSlide)*S/100;o.props.centerMode&&(T+=(100-A*S/100)/2);var b={width:S+"%",left:T+"%"};return{slideWidth:A+"%",trackStyle:b}}),_defineProperty$1(_assertThisInitialized(o),"checkImagesLoad",function(){var l=o.list&&o.list.querySelectorAll&&o.list.querySelectorAll(".slick-slide img")||[],c=l.length,u=0;Array.prototype.forEach.call(l,function(f){var d=function(){return++u&&u>=c&&o.onWindowResized()};if(!f.onclick)f.onclick=function(){return f.parentNode.focus()};else{var g=f.onclick;f.onclick=function(p){g(p),f.parentNode.focus()}}f.onload||(o.props.lazyLoad?f.onload=function(){o.adaptHeight(),o.callbackTimers.push(setTimeout(o.onWindowResized,o.props.speed))}:(f.onload=d,f.onerror=function(){d(),o.props.onLazyLoadError&&o.props.onLazyLoadError()}))})}),_defineProperty$1(_assertThisInitialized(o),"progressiveLazyLoad",function(){for(var l=[],c=_objectSpread2$1(_objectSpread2$1({},o.props),o.state),u=o.state.currentSlide;u<o.state.slideCount+getPostClones(c);u++)if(o.state.lazyLoadedList.indexOf(u)<0){l.push(u);break}for(var f=o.state.currentSlide-1;f>=-getPreClones(c);f--)if(o.state.lazyLoadedList.indexOf(f)<0){l.push(f);break}l.length>0?(o.setState(function(d){return{lazyLoadedList:d.lazyLoadedList.concat(l)}}),o.props.onLazyLoad&&o.props.onLazyLoad(l)):o.lazyLoadTimer&&(clearInterval(o.lazyLoadTimer),delete o.lazyLoadTimer)}),_defineProperty$1(_assertThisInitialized(o),"slideHandler",function(l){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,u=o.props,f=u.asNavFor,d=u.beforeChange,g=u.onLazyLoad,p=u.speed,v=u.afterChange,m=o.state.currentSlide,y=slideHandler(_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({index:l},o.props),o.state),{},{trackRef:o.track,useCSS:o.props.useCSS&&!c})),x=y.state,_=y.nextState;if(x){d&&d(m,x.currentSlide);var E=x.lazyLoadedList.filter(function(S){return o.state.lazyLoadedList.indexOf(S)<0});g&&E.length>0&&g(E),!o.props.waitForAnimate&&o.animationEndCallback&&(clearTimeout(o.animationEndCallback),v&&v(m),delete o.animationEndCallback),o.setState(x,function(){f&&o.asNavForIndex!==l&&(o.asNavForIndex=l,f.innerSlider.slideHandler(l)),_&&(o.animationEndCallback=setTimeout(function(){var S=_.animating,A=_objectWithoutProperties(_,_excluded);o.setState(A,function(){o.callbackTimers.push(setTimeout(function(){return o.setState({animating:S})},10)),v&&v(x.currentSlide),delete o.animationEndCallback})},p))})}}),_defineProperty$1(_assertThisInitialized(o),"changeSlide",function(l){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,u=_objectSpread2$1(_objectSpread2$1({},o.props),o.state),f=changeSlide(u,l);if(!(f!==0&&!f)&&(c===!0?o.slideHandler(f,c):o.slideHandler(f),o.props.autoplay&&o.autoPlay("update"),o.props.focusOnSelect)){var d=o.list.querySelectorAll(".slick-current");d[0]&&d[0].focus()}}),_defineProperty$1(_assertThisInitialized(o),"clickHandler",function(l){o.clickable===!1&&(l.stopPropagation(),l.preventDefault()),o.clickable=!0}),_defineProperty$1(_assertThisInitialized(o),"keyHandler",function(l){var c=keyHandler(l,o.props.accessibility,o.props.rtl);c!==""&&o.changeSlide({message:c})}),_defineProperty$1(_assertThisInitialized(o),"selectHandler",function(l){o.changeSlide(l)}),_defineProperty$1(_assertThisInitialized(o),"disableBodyScroll",function(){var l=function(u){u=u||window.event,u.preventDefault&&u.preventDefault(),u.returnValue=!1};window.ontouchmove=l}),_defineProperty$1(_assertThisInitialized(o),"enableBodyScroll",function(){window.ontouchmove=null}),_defineProperty$1(_assertThisInitialized(o),"swipeStart",function(l){o.props.verticalSwiping&&o.disableBodyScroll();var c=swipeStart(l,o.props.swipe,o.props.draggable);c!==""&&o.setState(c)}),_defineProperty$1(_assertThisInitialized(o),"swipeMove",function(l){var c=swipeMove(l,_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},o.props),o.state),{},{trackRef:o.track,listRef:o.list,slideIndex:o.state.currentSlide}));c&&(c.swiping&&(o.clickable=!1),o.setState(c))}),_defineProperty$1(_assertThisInitialized(o),"swipeEnd",function(l){var c=swipeEnd(l,_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},o.props),o.state),{},{trackRef:o.track,listRef:o.list,slideIndex:o.state.currentSlide}));if(c){var u=c.triggerSlideHandler;delete c.triggerSlideHandler,o.setState(c),u!==void 0&&(o.slideHandler(u),o.props.verticalSwiping&&o.enableBodyScroll())}}),_defineProperty$1(_assertThisInitialized(o),"touchEnd",function(l){o.swipeEnd(l),o.clickable=!0}),_defineProperty$1(_assertThisInitialized(o),"slickPrev",function(){o.callbackTimers.push(setTimeout(function(){return o.changeSlide({message:"previous"})},0))}),_defineProperty$1(_assertThisInitialized(o),"slickNext",function(){o.callbackTimers.push(setTimeout(function(){return o.changeSlide({message:"next"})},0))}),_defineProperty$1(_assertThisInitialized(o),"slickGoTo",function(l){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(l=Number(l),isNaN(l))return"";o.callbackTimers.push(setTimeout(function(){return o.changeSlide({message:"index",index:l,currentSlide:o.state.currentSlide},c)},0))}),_defineProperty$1(_assertThisInitialized(o),"play",function(){var l;if(o.props.rtl)l=o.state.currentSlide-o.props.slidesToScroll;else if(canGoNext(_objectSpread2$1(_objectSpread2$1({},o.props),o.state)))l=o.state.currentSlide+o.props.slidesToScroll;else return!1;o.slideHandler(l)}),_defineProperty$1(_assertThisInitialized(o),"autoPlay",function(l){o.autoplayTimer&&clearInterval(o.autoplayTimer);var c=o.state.autoplaying;if(l==="update"){if(c==="hovered"||c==="focused"||c==="paused")return}else if(l==="leave"){if(c==="paused"||c==="focused")return}else if(l==="blur"&&(c==="paused"||c==="hovered"))return;o.autoplayTimer=setInterval(o.play,o.props.autoplaySpeed+50),o.setState({autoplaying:"playing"})}),_defineProperty$1(_assertThisInitialized(o),"pause",function(l){o.autoplayTimer&&(clearInterval(o.autoplayTimer),o.autoplayTimer=null);var c=o.state.autoplaying;l==="paused"?o.setState({autoplaying:"paused"}):l==="focused"?(c==="hovered"||c==="playing")&&o.setState({autoplaying:"focused"}):c==="playing"&&o.setState({autoplaying:"hovered"})}),_defineProperty$1(_assertThisInitialized(o),"onDotsOver",function(){return o.props.autoplay&&o.pause("hovered")}),_defineProperty$1(_assertThisInitialized(o),"onDotsLeave",function(){return o.props.autoplay&&o.state.autoplaying==="hovered"&&o.autoPlay("leave")}),_defineProperty$1(_assertThisInitialized(o),"onTrackOver",function(){return o.props.autoplay&&o.pause("hovered")}),_defineProperty$1(_assertThisInitialized(o),"onTrackLeave",function(){return o.props.autoplay&&o.state.autoplaying==="hovered"&&o.autoPlay("leave")}),_defineProperty$1(_assertThisInitialized(o),"onSlideFocus",function(){return o.props.autoplay&&o.pause("focused")}),_defineProperty$1(_assertThisInitialized(o),"onSlideBlur",function(){return o.props.autoplay&&o.state.autoplaying==="focused"&&o.autoPlay("blur")}),_defineProperty$1(_assertThisInitialized(o),"render",function(){var l=classNames("slick-slider",o.props.className,{"slick-vertical":o.props.vertical,"slick-initialized":!0}),c=_objectSpread2$1(_objectSpread2$1({},o.props),o.state),u=extractObject(c,["fade","cssEase","speed","infinite","centerMode","focusOnSelect","currentSlide","lazyLoad","lazyLoadedList","rtl","slideWidth","slideHeight","listHeight","vertical","slidesToShow","slidesToScroll","slideCount","trackStyle","variableWidth","unslick","centerPadding","targetSlide","useCSS"]),f=o.props.pauseOnHover;u=_objectSpread2$1(_objectSpread2$1({},u),{},{onMouseEnter:f?o.onTrackOver:null,onMouseLeave:f?o.onTrackLeave:null,onMouseOver:f?o.onTrackOver:null,focusOnSelect:o.props.focusOnSelect&&o.clickable?o.selectHandler:null});var d;if(o.props.dots===!0&&o.state.slideCount>=o.props.slidesToShow){var g=extractObject(c,["dotsClass","slideCount","slidesToShow","currentSlide","slidesToScroll","clickHandler","children","customPaging","infinite","appendDots"]),p=o.props.pauseOnDotsHover;g=_objectSpread2$1(_objectSpread2$1({},g),{},{clickHandler:o.changeSlide,onMouseEnter:p?o.onDotsLeave:null,onMouseOver:p?o.onDotsOver:null,onMouseLeave:p?o.onDotsLeave:null}),d=React.createElement(Dots,g)}var v,m,y=extractObject(c,["infinite","centerMode","currentSlide","slideCount","slidesToShow","prevArrow","nextArrow"]);y.clickHandler=o.changeSlide,o.props.arrows&&(v=React.createElement(PrevArrow,y),m=React.createElement(NextArrow,y));var x=null;o.props.vertical&&(x={height:o.state.listHeight});var _=null;o.props.vertical===!1?o.props.centerMode===!0&&(_={padding:"0px "+o.props.centerPadding}):o.props.centerMode===!0&&(_={padding:o.props.centerPadding+" 0px"});var E=_objectSpread2$1(_objectSpread2$1({},x),_),S=o.props.touchMove,A={className:"slick-list",style:E,onClick:o.clickHandler,onMouseDown:S?o.swipeStart:null,onMouseMove:o.state.dragging&&S?o.swipeMove:null,onMouseUp:S?o.swipeEnd:null,onMouseLeave:o.state.dragging&&S?o.swipeEnd:null,onTouchStart:S?o.swipeStart:null,onTouchMove:o.state.dragging&&S?o.swipeMove:null,onTouchEnd:S?o.touchEnd:null,onTouchCancel:o.state.dragging&&S?o.swipeEnd:null,onKeyDown:o.props.accessibility?o.keyHandler:null},T={className:l,dir:"ltr",style:o.props.style};return o.props.unslick&&(A={className:"slick-list"},T={className:l,style:o.props.style}),React.createElement("div",T,o.props.unslick?"":v,React.createElement("div",_extends$1({ref:o.listRefHandler},A),React.createElement(Track,_extends$1({ref:o.trackRefHandler},u),o.props.children)),o.props.unslick?"":m,o.props.unslick?"":d)}),o.list=null,o.track=null,o.state=_objectSpread2$1(_objectSpread2$1({},initialState),{},{currentSlide:o.props.initialSlide,slideCount:React.Children.count(o.props.children)}),o.callbackTimers=[],o.clickable=!0,o.debouncedResize=null;var s=o.ssrInit();return o.state=_objectSpread2$1(_objectSpread2$1({},o.state),s),o}return _createClass(e,[{key:"didPropsChange",value:function(o){for(var s=!1,l=0,c=Object.keys(this.props);l<c.length;l++){var u=c[l];if(!o.hasOwnProperty(u)){s=!0;break}if(!(_typeof(o[u])==="object"||typeof o[u]=="function")&&o[u]!==this.props[u]){s=!0;break}}return s||React.Children.count(this.props.children)!==React.Children.count(o.children)}}]),e}(React.Component),camel2hyphen$1=function(a){return a.replace(/[A-Z]/g,function(r){return"-"+r.toLowerCase()}).toLowerCase()},camel2hyphen_1=camel2hyphen$1,camel2hyphen=camel2hyphen_1,isDimension=function(a){var r=/[height|width]$/;return r.test(a)},obj2mq=function(a){var r="",e=Object.keys(a);return e.forEach(function(n,o){var s=a[n];n=camel2hyphen(n),isDimension(n)&&typeof s=="number"&&(s=s+"px"),s===!0?r+=n:s===!1?r+="not "+n:r+="("+n+": "+s+")",o<e.length-1&&(r+=" and ")}),r},json2mq=function(a){var r="";return typeof a=="string"?a:a instanceof Array?(a.forEach(function(e,n){r+=obj2mq(e),n<a.length-1&&(r+=", ")}),r):obj2mq(a)},json2mq_1=json2mq;const json2mq$1=getDefaultExportFromCjs$1(json2mq_1);var defaultProps={accessibility:!0,adaptiveHeight:!1,afterChange:null,appendDots:function(r){return React.createElement("ul",{style:{display:"block"}},r)},arrows:!0,autoplay:!1,autoplaySpeed:3e3,beforeChange:null,centerMode:!1,centerPadding:"50px",className:"",cssEase:"ease",customPaging:function(r){return React.createElement("button",null,r+1)},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",edgeFriction:.35,fade:!1,focusOnSelect:!1,infinite:!0,initialSlide:0,lazyLoad:null,nextArrow:null,onEdge:null,onInit:null,onLazyLoadError:null,onReInit:null,pauseOnDotsHover:!1,pauseOnFocus:!1,pauseOnHover:!0,prevArrow:null,responsive:null,rows:1,rtl:!1,slide:"div",slidesPerRow:1,slidesToScroll:1,slidesToShow:1,speed:500,swipe:!0,swipeEvent:null,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,useTransform:!0,variableWidth:!1,vertical:!1,waitForAnimate:!0},Slider$3=function(a){_inherits(e,a);var r=_createSuper(e);function e(n){var o;return _classCallCheck(this,e),o=r.call(this,n),_defineProperty$1(_assertThisInitialized(o),"innerSliderRefHandler",function(s){return o.innerSlider=s}),_defineProperty$1(_assertThisInitialized(o),"slickPrev",function(){return o.innerSlider.slickPrev()}),_defineProperty$1(_assertThisInitialized(o),"slickNext",function(){return o.innerSlider.slickNext()}),_defineProperty$1(_assertThisInitialized(o),"slickGoTo",function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return o.innerSlider.slickGoTo(s,l)}),_defineProperty$1(_assertThisInitialized(o),"slickPause",function(){return o.innerSlider.pause("paused")}),_defineProperty$1(_assertThisInitialized(o),"slickPlay",function(){return o.innerSlider.autoPlay("play")}),o.state={breakpoint:null},o._responsiveMediaHandlers=[],o}return _createClass(e,[{key:"media",value:function(o,s){var l=window.matchMedia(o),c=function(f){var d=f.matches;d&&s()};l.addListener(c),c(l),this._responsiveMediaHandlers.push({mql:l,query:o,listener:c})}},{key:"componentDidMount",value:function(){var o=this;if(this.props.responsive){var s=this.props.responsive.map(function(c){return c.breakpoint});s.sort(function(c,u){return c-u}),s.forEach(function(c,u){var f;u===0?f=json2mq$1({minWidth:0,maxWidth:c}):f=json2mq$1({minWidth:s[u-1]+1,maxWidth:c}),canUseDOM()&&o.media(f,function(){o.setState({breakpoint:c})})});var l=json2mq$1({minWidth:s.slice(-1)[0]});canUseDOM()&&this.media(l,function(){o.setState({breakpoint:null})})}}},{key:"componentWillUnmount",value:function(){this._responsiveMediaHandlers.forEach(function(o){o.mql.removeListener(o.listener)})}},{key:"render",value:function(){var o=this,s,l;this.state.breakpoint?(l=this.props.responsive.filter(function(x){return x.breakpoint===o.state.breakpoint}),s=l[0].settings==="unslick"?"unslick":_objectSpread2$1(_objectSpread2$1(_objectSpread2$1({},defaultProps),this.props),l[0].settings)):s=_objectSpread2$1(_objectSpread2$1({},defaultProps),this.props),s.centerMode&&(s.slidesToScroll>1,s.slidesToScroll=1),s.fade&&(s.slidesToShow>1,s.slidesToScroll>1,s.slidesToShow=1,s.slidesToScroll=1);var c=React.Children.toArray(this.props.children);c=c.filter(function(x){return typeof x=="string"?!!x.trim():!!x}),s.variableWidth&&(s.rows>1||s.slidesPerRow>1)&&(console.warn("variableWidth is not supported in case of rows > 1 or slidesPerRow > 1"),s.variableWidth=!1);for(var u=[],f=null,d=0;d<c.length;d+=s.rows*s.slidesPerRow){for(var g=[],p=d;p<d+s.rows*s.slidesPerRow;p+=s.slidesPerRow){for(var v=[],m=p;m<p+s.slidesPerRow&&(s.variableWidth&&c[m].props.style&&(f=c[m].props.style.width),!(m>=c.length));m+=1)v.push(React.cloneElement(c[m],{key:100*d+10*p+m,tabIndex:-1,style:{width:"".concat(100/s.slidesPerRow,"%"),display:"inline-block"}}));g.push(React.createElement("div",{key:10*d+p},v))}s.variableWidth?u.push(React.createElement("div",{key:d,style:{width:f}},g)):u.push(React.createElement("div",{key:d},g))}if(s==="unslick"){var y="regular slider "+(this.props.className||"");return React.createElement("div",{className:y},c)}else u.length<=s.slidesToShow&&(s.unslick=!0);return React.createElement(InnerSlider,_extends$1({style:this.props.style,ref:this.innerSliderRefHandler},s),u)}}]),e}(React.Component);const genCarouselStyle=a=>{const{componentCls:r,antCls:e,carouselArrowSize:n,carouselDotOffset:o,marginXXS:s}=a,l=a.calc(n).mul(-1.25).equal(),c=s;return{[r]:Object.assign(Object.assign({},resetComponent(a)),{".slick-slider":{position:"relative",display:"block",boxSizing:"border-box",touchAction:"pan-y",WebkitTouchCallout:"none",WebkitTapHighlightColor:"transparent",".slick-track, .slick-list":{transform:"translate3d(0, 0, 0)",touchAction:"pan-y"}},".slick-list":{position:"relative",display:"block",margin:0,padding:0,overflow:"hidden","&:focus":{outline:"none"},"&.dragging":{cursor:"pointer"},".slick-slide":{pointerEvents:"none",[`input${e}-radio-input, input${e}-checkbox-input`]:{visibility:"hidden"},"&.slick-active":{pointerEvents:"auto",[`input${e}-radio-input, input${e}-checkbox-input`]:{visibility:"visible"}},"> div > div":{verticalAlign:"bottom"}}},".slick-track":{position:"relative",top:0,insetInlineStart:0,display:"block","&::before, &::after":{display:"table",content:'""'},"&::after":{clear:"both"}},".slick-slide":{display:"none",float:"left",height:"100%",minHeight:1,img:{display:"block"},"&.dragging img":{pointerEvents:"none"}},".slick-initialized .slick-slide":{display:"block"},".slick-vertical .slick-slide":{display:"block",height:"auto"},".slick-arrow.slick-hidden":{display:"none"},".slick-prev, .slick-next":{position:"absolute",top:"50%",display:"block",width:n,height:n,marginTop:a.calc(n).mul(-1).div(2).equal(),padding:0,color:"transparent",fontSize:0,lineHeight:0,background:"transparent",border:0,outline:"none",cursor:"pointer","&:hover, &:focus":{color:"transparent",background:"transparent",outline:"none","&::before":{opacity:1}},"&.slick-disabled::before":{opacity:.25}},".slick-prev":{insetInlineStart:l,"&::before":{content:'"←"'}},".slick-next":{insetInlineEnd:l,"&::before":{content:'"→"'}},".slick-dots":{position:"absolute",insetInlineEnd:0,bottom:0,insetInlineStart:0,zIndex:15,display:"flex !important",justifyContent:"center",paddingInlineStart:0,margin:0,listStyle:"none","&-bottom":{bottom:o},"&-top":{top:o,bottom:"auto"},li:{position:"relative",display:"inline-block",flex:"0 1 auto",boxSizing:"content-box",width:a.dotWidth,height:a.dotHeight,marginInline:c,padding:0,textAlign:"center",textIndent:-999,verticalAlign:"top",transition:`all ${a.motionDurationSlow}`,button:{position:"relative",display:"block",width:"100%",height:a.dotHeight,padding:0,color:"transparent",fontSize:0,background:a.colorBgContainer,border:0,borderRadius:a.dotHeight,outline:"none",cursor:"pointer",opacity:.3,transition:`all ${a.motionDurationSlow}`,"&: hover, &:focus":{opacity:.75},"&::after":{position:"absolute",inset:a.calc(c).mul(-1).equal(),content:'""'}},"&.slick-active":{width:a.dotActiveWidth,"& button":{background:a.colorBgContainer,opacity:1},"&: hover, &:focus":{opacity:1}}}}})}},genCarouselVerticalStyle=a=>{const{componentCls:r,carouselDotOffset:e,marginXXS:n}=a,o={width:a.dotHeight,height:a.dotWidth};return{[`${r}-vertical`]:{".slick-dots":{top:"50%",bottom:"auto",flexDirection:"column",width:a.dotHeight,height:"auto",margin:0,transform:"translateY(-50%)","&-left":{insetInlineEnd:"auto",insetInlineStart:e},"&-right":{insetInlineEnd:e,insetInlineStart:"auto"},li:Object.assign(Object.assign({},o),{margin:`${unit(n)} 0`,verticalAlign:"baseline",button:o,"&.slick-active":Object.assign(Object.assign({},o),{button:o})})}}}},genCarouselRtlStyle=a=>{const{componentCls:r}=a;return[{[`${r}-rtl`]:{direction:"rtl",".slick-dots":{[`${r}-rtl&`]:{flexDirection:"row-reverse"}}}},{[`${r}-vertical`]:{".slick-dots":{[`${r}-rtl&`]:{flexDirection:"column"}}}}]},prepareComponentToken=()=>({dotWidth:16,dotHeight:3,dotWidthActive:24,dotActiveWidth:24}),useStyle=genStyleHooks("Carousel",a=>{const{controlHeightLG:r,controlHeightSM:e}=a,n=merge(a,{carouselArrowSize:a.calc(r).div(2).equal(),carouselDotOffset:a.calc(e).div(2).equal()});return[genCarouselStyle(n),genCarouselVerticalStyle(n),genCarouselRtlStyle(n)]},prepareComponentToken,{deprecatedTokens:[["dotWidthActive","dotActiveWidth"]]});var __rest$2=function(a,r){var e={};for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&r.indexOf(n)<0&&(e[n]=a[n]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(a);o<n.length;o++)r.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(a,n[o])&&(e[n[o]]=a[n[o]]);return e};const Carousel=reactExports.forwardRef((a,r)=>{const{dots:e=!0,arrows:n=!1,draggable:o=!1,waitForAnimate:s=!1,dotPosition:l="bottom",vertical:c=l==="left"||l==="right",rootClassName:u,className:f,style:d,id:g}=a,p=__rest$2(a,["dots","arrows","draggable","waitForAnimate","dotPosition","vertical","rootClassName","className","style","id"]),{getPrefixCls:v,direction:m,carousel:y}=reactExports.useContext(ConfigContext),x=reactExports.useRef(),_=function(w){let M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;x.current.slickGoTo(w,M)};reactExports.useImperativeHandle(r,()=>({goTo:_,autoPlay:x.current.innerSlider.autoPlay,innerSlider:x.current.innerSlider,prev:x.current.slickPrev,next:x.current.slickNext}),[x.current]);const E=reactExports.useRef(reactExports.Children.count(a.children));reactExports.useEffect(()=>{E.current!==reactExports.Children.count(a.children)&&(_(a.initialSlide||0,!1),E.current=reactExports.Children.count(a.children))},[a.children]);const S=Object.assign({vertical:c,className:classNames(f,y==null?void 0:y.className),style:Object.assign(Object.assign({},y==null?void 0:y.style),d)},p);S.effect==="fade"&&(S.fade=!0);const A=v("carousel",S.prefixCls),T="slick-dots",b=!!e,C=classNames(T,`${T}-${l}`,typeof e=="boolean"?!1:e==null?void 0:e.className),[L,R]=useStyle(A),I=classNames(A,{[`${A}-rtl`]:m==="rtl",[`${A}-vertical`]:S.vertical},R,u);return L(reactExports.createElement("div",{className:I,id:g},reactExports.createElement(Slider$3,Object.assign({ref:x},S,{dots:b,dotsClass:C,arrows:n,draggable:o,verticalSwiping:c,waitForAnimate:s}))))}),Carousel$1=Carousel;class AbstractManager{}class CanvasManager extends AbstractManager{constructor(){super();U(this,"canvasVisible",!1);U(this,"setCanvasVisible",e=>this.canvasVisible=e);U(this,"canvasConfig",{rasterize:!1,dragStep:1,resizeStep:1,width:1920,height:1080,adaptationType:"scale"});U(this,"updateCanvasConfig",e=>this.canvasConfig={...this.canvasConfig,...e});U(this,"getData",()=>toJS(this.canvasConfig));U(this,"destroy",()=>{runInAction(()=>{this.canvasConfig={}})});makeObservable(this,{canvasVisible:observable,canvasConfig:observable,setCanvasVisible:action,updateCanvasConfig:action})}init(e){runInAction(()=>{this.canvasConfig=e?{...this.canvasConfig,...e}:this.canvasConfig})}}const canvasHdStore=new CanvasManager;class LayerManager extends AbstractManager{constructor(){super();U(this,"elemConfigs",{});U(this,"compController",{});U(this,"layerConfigs",{});U(this,"layerHeader");U(this,"layerTail");U(this,"enableEvent",!1);U(this,"enableAdsorption",!0);U(this,"setEnableAdsorption",e=>{this.enableAdsorption=e});U(this,"setEnableEvent",e=>{this.enableEvent=e,this.reRenderLayer()});U(this,"addItem",e=>this.layerConfigs[e.id+""]=e);U(this,"delItem",e=>{for(const n of e){const o=this.compController[n];o&&o.destroy(),delete this.layerConfigs[n],delete this.compController[n]}});U(this,"updateLayer",(e,n=!0)=>{for(const o of e){const s=this.layerConfigs[o.id+""];lodashExports.isEqual(s,o)||(this.layerConfigs[o.id+""]=n?{...ObjectUtil.merge(s,o)}:ObjectUtil.merge(s,o))}});U(this,"reRenderLayer",()=>runInAction(()=>this.layerConfigs={...this.layerConfigs}));U(this,"delLayout",e=>{for(const n of e)this.layerConfigs[n]&&this.layerConfigs[n].type==="group"&&delete this.layerConfigs[n]});U(this,"flashGlobalTheme",e=>{this.compController&&Object.keys(this.compController).forEach(n=>{const o=this.compController[n];o&&o.updateTheme(e)})});makeObservable(this,{layerConfigs:observable.shallow,enableAdsorption:observable,setEnableAdsorption:action,init:action,destroy:action,addItem:action,delItem:action,updateLayer:action,flashGlobalTheme:action,delLayout:action})}getData(){const e={};return Object.keys(this.compController).forEach(n=>{e[n]=this.compController[n].getConfig()}),{elemConfigs:e,layerConfigs:toJS(this.layerConfigs),layerHeader:this.layerHeader,layerTail:this.layerTail}}init(e){this.elemConfigs=e.elemConfigs||this.elemConfigs,this.layerConfigs=e.layerConfigs||this.layerConfigs,this.layerHeader=e.layerHeader||this.layerHeader,this.layerTail=e.layerTail||this.layerTail}destroy(){this.elemConfigs={},this.layerConfigs={},this.layerHeader=void 0,this.layerTail=void 0}}const layerManager=new LayerManager;class ThemeManager extends AbstractManager{constructor(){super();U(this,"themeVisible",!1);U(this,"setThemeVisible",e=>this.themeVisible=e);U(this,"themeConfig",[{id:"0",name:"科技风格(默认主题)",colors:{main:"#00dfff",mainText:"#62edff",subText:"#4ca4b1",background:"#00dfff33",supplementFirst:"#38929f",supplementSecond:"#1790a2"}}]);U(this,"updateThemeConfig",e=>this.themeConfig=e);makeObservable(this,{themeVisible:observable,setThemeVisible:action,themeConfig:observable,updateThemeConfig:action})}destroy(){}getData(){return this.themeConfig}init(e){this.themeConfig=e||this.themeConfig}}const themeHdStore=new ThemeManager;class AbstractController{constructor(){U(this,"instance",null);U(this,"config",null);U(this,"container",null)}destroy(){this.instance=null,this.config=null,this.container=null}}var AnchorPointType=(a=>(a[a.INPUT=0]="INPUT",a[a.OUTPUT=1]="OUTPUT",a))(AnchorPointType||{});class AbstractBPNodeController extends AbstractController{constructor(r){super(),r&&(this.config=r)}}class ComponentUtil{static async createAndRender(r,e,n){if(!r)throw new Error("create react node failed, container is null");return new Promise(o=>{try{createRoot(r).render(reactExports.createElement(e,{ref:s=>o(s),...n}))}catch(s){console.error("create react node failed ",s),o(null)}})}}const AlignBottomTwo=IconWrapper("align-bottom-two",!0,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("rect",{x:"7",y:"16",width:"6",height:"24",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("rect",{x:"21",y:"8",width:"6",height:"32",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("rect",{x:"35",y:"22",width:"6",height:"18",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),AlignHorizontalCenterTwo=IconWrapper("align-horizontal-center-two",!0,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("rect",{x:"7",y:"12",width:"6",height:"24",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("rect",{x:"21",y:"8",width:"6",height:"32",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("rect",{x:"35",y:"15",width:"6",height:"18",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),AlignLeftTwo=IconWrapper("align-left-two",!0,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("rect",{x:"8",y:"7",width:"24",height:"6",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("rect",{x:"8",y:"21",width:"32",height:"6",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("rect",{x:"8",y:"35",width:"18",height:"6",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),AlignRightTwo=IconWrapper("align-right-two",!0,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("rect",{x:"16",y:"7",width:"24",height:"6",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("rect",{x:"8",y:"21",width:"32",height:"6",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("rect",{x:"22",y:"35",width:"18",height:"6",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),AlignTopTwo=IconWrapper("align-top-two",!0,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("rect",{x:"7",y:"8",width:"6",height:"24",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("rect",{x:"21",y:"8",width:"6",height:"32",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("rect",{x:"35",y:"8",width:"6",height:"18",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),AlignVerticalCenterTwo=IconWrapper("align-vertical-center-two",!0,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("rect",{x:"12",y:"7",width:"24",height:"6",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("rect",{x:"8",y:"21",width:"32",height:"6",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("rect",{x:"15",y:"35",width:"18",height:"6",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),AllApplication=IconWrapper("all-application",!1,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("path",{d:"M18 6H8C6.89543 6 6 6.89543 6 8V18C6 19.1046 6.89543 20 8 20H18C19.1046 20 20 19.1046 20 18V8C20 6.89543 19.1046 6 18 6Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M18 28H8C6.89543 28 6 28.8954 6 30V40C6 41.1046 6.89543 42 8 42H18C19.1046 42 20 41.1046 20 40V30C20 28.8954 19.1046 28 18 28Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M40 6H30C28.8954 6 28 6.89543 28 8V18C28 19.1046 28.8954 20 30 20H40C41.1046 20 42 19.1046 42 18V8C42 6.89543 41.1046 6 40 6Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M40 28H30C28.8954 28 28 28.8954 28 30V40C28 41.1046 28.8954 42 30 42H40C41.1046 42 42 41.1046 42 40V30C42 28.8954 41.1046 28 40 28Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}))}),Browser=IconWrapper("browser",!0,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("path",{d:"M42 18V40C42 41.1046 41.1046 42 40 42H8C6.89543 42 6 41.1046 6 40V18",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M6 8C6 6.89543 6.89543 6 8 6H40C41.1046 6 42 6.89543 42 8V18H6V8Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 14C13.1046 14 14 13.1046 14 12C14 10.8954 13.1046 10 12 10C10.8954 10 10 10.8954 10 12C10 13.1046 10.8954 14 12 14Z",fill:a.colors[2]}),React.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M18 14C19.1046 14 20 13.1046 20 12C20 10.8954 19.1046 10 18 10C16.8954 10 16 10.8954 16 12C16 13.1046 16.8954 14 18 14Z",fill:a.colors[2]}),React.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M24 14C25.1046 14 26 13.1046 26 12C26 10.8954 25.1046 10 24 10C22.8954 10 22 10.8954 22 12C22 13.1046 22.8954 14 24 14Z",fill:a.colors[2]}))}),ColorFilter=IconWrapper("color-filter",!1,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("path",{d:"M24 40.9444C26.123 42.8446 28.9266 44 32 44C38.6274 44 44 38.6274 44 32C44 26.4085 40.1757 21.7102 35 20.3781",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M13 20.3781C7.82432 21.7102 4 26.4085 4 32C4 38.6274 9.37258 44 16 44C22.6274 44 28 38.6274 28 32C28 30.4506 27.7063 28.9697 27.1716 27.6101",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M24 28C30.6274 28 36 22.6274 36 16C36 9.37258 30.6274 4 24 4C17.3726 4 12 9.37258 12 16C12 22.6274 17.3726 28 24 28Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}))}),ConnectionPoint=IconWrapper("connection-point",!1,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("path",{d:"M5 24L43 24",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M28 4H20C18.8954 4 18 4.89543 18 6V14C18 15.1046 18.8954 16 20 16H28C29.1046 16 30 15.1046 30 14V6C30 4.89543 29.1046 4 28 4Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M16 32H8C6.89543 32 6 32.8954 6 34V42C6 43.1046 6.89543 44 8 44H16C17.1046 44 18 43.1046 18 42V34C18 32.8954 17.1046 32 16 32Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M40 32H32C30.8954 32 30 32.8954 30 34V42C30 43.1046 30.8954 44 32 44H40C41.1046 44 42 43.1046 42 42V34C42 32.8954 41.1046 32 40 32Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M24 24V16",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M36 32V24",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M12 32V24",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),Cube=IconWrapper("cube",!1,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("path",{d:"M15.5 9L7 14V24V34L15.5 39L24 44L32.5001 39L41 34V24V14L32.5001 9L24 4L15.5 9Z",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M41 14L24 24",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M7 14L24 24",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M24 44V24",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M32 19L32 39",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M41 24L24 34",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M24 34L7 24",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M16 39L16 19",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M32 9L16 19",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M32 19L16 9",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),Deeplink=IconWrapper("deeplink",!0,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("path",{d:"M21 34.9929C21 35.8067 21 36.471 21 36.9857C21 37.8714 21 39.2 21 40.9714C21 41.5395 20.5772 42 20.0556 42H4.94444C4.42284 42 4 41.5395 4 40.9714V7.02857C4 6.46051 4.42284 6 4.94444 6H20.0556C20.5772 6 21 6.46051 21 7.02857C21 8.8 21 10.1286 21 11.0143C21 11.529 21 12.1933 21 13.0071",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap}),React.createElement("path",{d:"M27 13.0071C27 12.1933 27 11.529 27 11.0143C27 10.1286 27 8.8 27 7.02857C27 6.46051 27.4228 6 27.9444 6H43.0556C43.5772 6 44 6.46051 44 7.02857V40.9714C44 41.5395 43.5772 42 43.0556 42H27.9444C27.4228 42 27 41.5395 27 40.9714C27 39.2 27 37.8714 27 36.9857C27 36.471 27 35.8067 27 34.9929",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap}),React.createElement("path",{d:"M12.5 38C13.6046 38 14.5 37.1046 14.5 36C14.5 34.8954 13.6046 34 12.5 34C11.3954 34 10.5 34.8954 10.5 36C10.5 37.1046 11.3954 38 12.5 38Z",fill:a.colors[0]}),React.createElement("path",{d:"M35.5 38C36.6046 38 37.5 37.1046 37.5 36C37.5 34.8954 36.6046 34 35.5 34C34.3954 34 33.5 34.8954 33.5 36C33.5 37.1046 34.3954 38 35.5 38Z",fill:a.colors[0]}),React.createElement("path",{d:"M16 23.5H32",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap}),React.createElement("path",{d:"M27.2231 28.2729L28.8141 26.682L31.9961 23.5L28.8141 20.318L27.2231 18.727",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),Fork=IconWrapper("fork",!1,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("path",{d:"M37 12C39.2091 12 41 10.2091 41 8C41 5.79086 39.2091 4 37 4C34.7909 4 33 5.79086 33 8C33 10.2091 34.7909 12 37 12Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M11 12C13.2091 12 15 10.2091 15 8C15 5.79086 13.2091 4 11 4C8.79086 4 7 5.79086 7 8C7 10.2091 8.79086 12 11 12Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M24 44C26.2091 44 28 42.2091 28 40C28 37.7909 26.2091 36 24 36C21.7909 36 20 37.7909 20 40C20 42.2091 21.7909 44 24 44Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M11 12V15C11 22 24 25 24 32V36V32C24 25 37 22 37 15V12",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),MapDraw=IconWrapper("map-draw",!0,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("path",{d:"M17 12L4 6V36L17 42L31 36L44 42V12L31 6L17 12Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M31 6V36",stroke:a.colors[2],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M17 12V42",stroke:a.colors[2],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M10.5 9L17 12L31 6L37.5 9",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M10.5 39L17 42L31 36L37.5 39",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),Monitor=IconWrapper("monitor",!0,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("rect",{x:"4",y:"10",width:"32",height:"28",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M44 14L36 20.75V27.25L44 34V14Z",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M17 19L23 24L17 29",stroke:a.colors[2],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),Optimize=IconWrapper("optimize",!0,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("path",{d:"M19 7.99991L28 15.9999L38.0323 10.1097L33 20.9999L42 28.9999L30 27.9999L25.5 37.9999L23 26.9999L11.0004 25.9999L21.5082 19.6499L19 7.99991Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M8 42.0205L23 27",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap}))}),Other=IconWrapper("other",!1,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("path",{d:"M22.799 4.20101L4.41421 22.5858C3.63317 23.3668 3.63316 24.6332 4.41421 25.4142L22.799 43.799C23.58 44.58 24.8464 44.58 25.6274 43.799L44.0122 25.4142C44.7932 24.6332 44.7932 23.3668 44.0122 22.5858L25.6274 4.20101C24.8464 3.41996 23.58 3.41996 22.799 4.20101Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M18 24H30",stroke:a.colors[2],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap}),React.createElement("path",{d:"M24 18V30",stroke:a.colors[2],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap}))}),PieThree=IconWrapper("pie-three",!0,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("circle",{cx:"24",cy:"24",r:"20",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M24 4C27.9021 4 31.719 5.14149 34.9805 7.28385C38.2419 9.42621 40.8054 12.4758 42.3551 16.057C43.9048 19.6382 44.3731 23.5946 43.7022 27.4386C43.0313 31.2826 41.2506 34.8464 38.5794 37.6909L24 24V4Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),Platte=IconWrapper("platte",!0,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("path",{d:"M24 44C29.9601 44 26.3359 35.136 30 31C33.1264 27.4709 44 29.0856 44 24C44 12.9543 35.0457 4 24 4C12.9543 4 4 12.9543 4 24C4 35.0457 12.9543 44 24 44Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M28 17C29.6569 17 31 15.6569 31 14C31 12.3431 29.6569 11 28 11C26.3431 11 25 12.3431 25 14C25 15.6569 26.3431 17 28 17Z",fill:a.colors[3],stroke:a.colors[2],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M16 21C17.6569 21 19 19.6569 19 18C19 16.3431 17.6569 15 16 15C14.3431 15 13 16.3431 13 18C13 19.6569 14.3431 21 16 21Z",fill:a.colors[3],stroke:a.colors[2],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M17 34C18.6569 34 20 32.6569 20 31C20 29.3431 18.6569 28 17 28C15.3431 28 14 29.3431 14 31C14 32.6569 15.3431 34 17 34Z",fill:a.colors[3],stroke:a.colors[2],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}))}),Ring=IconWrapper("ring",!1,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("path",{d:"M24.0004 11.619C26.0933 11.619 27.7899 9.91347 27.7899 7.80952C27.7899 5.70558 26.0933 4 24.0004 4C21.9075 4 20.2109 5.70558 20.2109 7.80952C20.2109 9.91347 21.9075 11.619 24.0004 11.619Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M9.78947 40.1906C11.8823 40.1906 13.5789 38.485 13.5789 36.3811C13.5789 34.2771 11.8823 32.5715 9.78947 32.5715C7.69661 32.5715 6 34.2771 6 36.3811C6 38.485 7.69661 40.1906 9.78947 40.1906Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M38.2104 40.1906C40.3032 40.1906 41.9998 38.485 41.9998 36.3811C41.9998 34.2771 40.3032 32.5715 38.2104 32.5715C36.1175 32.5715 34.4209 34.2771 34.4209 36.3811C34.4209 38.485 36.1175 40.1906 38.2104 40.1906Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M33.1426 10.3142C38.444 13.4629 41.9999 19.2664 41.9999 25.9048C41.9999 26.4816 41.9731 27.0522 41.9206 27.6152V27.6152",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M31.014 42.575C28.8585 43.4926 26.4883 44.0001 24.0001 44.0001C21.512 44.0001 19.1418 43.4926 16.9863 42.575",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M6.07936 27.6152C6.02685 27.0522 6 26.4816 6 25.9048C6 19.2664 9.5559 13.4629 14.8573 10.3142",stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),SettingOne=IconWrapper("setting-one",!1,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("path",{d:"M34.0003 41L44 24L34.0003 7H14.0002L4 24L14.0002 41H34.0003Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M24 29C26.7614 29 29 26.7614 29 24C29 21.2386 26.7614 19 24 19C21.2386 19 19 21.2386 19 24C19 26.7614 21.2386 29 24 29Z",fill:a.colors[3],stroke:a.colors[2],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}))}),Text$2=IconWrapper("text",!0,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("rect",{x:"6",y:"6",width:"36",height:"36",rx:"3",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M16 19V16H32V19",stroke:a.colors[2],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M22 34H26",stroke:a.colors[2],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}),React.createElement("path",{d:"M24 18L24 34",stroke:a.colors[2],strokeWidth:a.strokeWidth,strokeLinecap:a.strokeLinecap,strokeLinejoin:a.strokeLinejoin}))}),Theme$1=IconWrapper("theme",!1,function(a){return React.createElement("svg",{width:a.size,height:a.size,viewBox:"0 0 48 48",fill:"none"},React.createElement("path",{d:"M18 6C18 9.31371 20.6863 12 24 12C27.3137 12 30 9.31371 30 6H35.4545L42 15.8182L36.2727 20.7273V42H11.7273V20.7273L6 15.8182L12.5455 6H18Z",fill:a.colors[1],stroke:a.colors[0],strokeWidth:a.strokeWidth,strokeLinejoin:a.strokeLinejoin}))}),nodeIconMap=new Map;nodeIconMap.set("CodeSandboxOutlined",ConnectionPoint);nodeIconMap.set("BranchesOutlined",Fork);nodeIconMap.set("FunctionOutlined",Ring);class BPNode extends React.PureComponent{render(){const{icon:r,name:e,input:n=[],output:o=[],titleBgColor:s="#247057"}=this.props,l=[...o,...n],c=nodeIconMap.get(r)||ConnectionPoint;return jsxRuntimeExports.jsxs("div",{className:"bp-node",children:[jsxRuntimeExports.jsxs("div",{className:"bp-node-header",style:{backgroundColor:s},children:[jsxRuntimeExports.jsxs("div",{className:"bp-node-icon",children:[jsxRuntimeExports.jsx(c,{})," "]}),jsxRuntimeExports.jsx("div",{className:"bp-node-title",children:e})]}),jsxRuntimeExports.jsx("div",{className:"bp-node-body",children:l.map((u,f)=>{const{id:d,name:g,type:p}=u;return jsxRuntimeExports.jsxs("div",{className:`bp-node-ap ${p===AnchorPointType.INPUT?"node-ap-input":"node-ap-output"}`,children:[jsxRuntimeExports.jsx("div",{className:"bp-node-ap-circle",children:jsxRuntimeExports.jsx("span",{id:d,className:`ap-circle ${p===AnchorPointType.INPUT?"ap-circle-input":"ap-circle-output"}`})}),jsxRuntimeExports.jsx("div",{className:"bg-node-ap-label",children:g})]},f)})})]})}}class Base64Util{static toBase64(r){const e=new TextEncoder().encode(r);let n="";return e.forEach(o=>{n+=String.fromCharCode(o)}),btoa(n)}static fromBase64(r){const e=atob(r),n=new Uint8Array(e.length);for(let o=0;o<e.length;o++)n[o]=e.charCodeAt(o);return new TextDecoder().decode(n)}}class AbstractDesignerController extends AbstractController{constructor(){super(...arguments);U(this,"interval",null);U(this,"lastReqState",!0);U(this,"errMsgDom",null);U(this,"doApi",config=>{const{url,method,params,header,frequency=5,filter,autoFlush}=config,request=()=>{FetchUtil.doRequest(url,method,header,params).then(res=>{var r;let{code,data}=res;if(code===200){if(this.lastReqState||(this.lastReqState=!0,(r=this.errMsgDom)==null||r.remove(),this.errMsgDom=null),filter&&filter!==""){const func=eval(`(${filter})`);data=typeof func=="function"?func(data):data}this.changeData(data)}else this.lastReqState=!1,this.errMsgDom||(this.errMsgDom=document.createElement("div"),this.errMsgDom.classList.add("view-error-message"),this.errMsgDom.innerText="数据加载失败...",this.container.appendChild(this.errMsgDom))})};autoFlush?this.interval=setInterval(()=>request(),frequency*1e3):request()});U(this,"doDatabase",config=>{const{sql,targetDb,filter,frequency,autoFlush}=config,request=()=>{!sql||sql===""||FetchUtil.post("/api/db/executor/execute",{id:targetDb,sql:Base64Util.toBase64(sql)}).then(res=>{var r;let{data,code}=res;if(code===200){if(this.lastReqState||(this.lastReqState=!0,(r=this.errMsgDom)==null||r.remove(),this.errMsgDom=null),filter&&filter!==""){const func=eval(`(${filter})`);data=typeof func=="function"?func(data):data}this.changeData(data)}else this.lastReqState=!1,this.errMsgDom||(this.errMsgDom=document.createElement("div"),this.errMsgDom.classList.add("view-error-message"),this.errMsgDom.innerText="数据加载失败...",this.container.appendChild(this.errMsgDom))})};autoFlush?this.interval=setInterval(()=>request(),(frequency||5)*1e3):request()})}changeData(r){}registerEvent(){}loadComponentData(){const{data:r}=this.config;if(!r)return;const{sourceType:e}=r;switch(e){case"static":break;case"api":this.doApi(r==null?void 0:r.apiData);break;case"database":this.doDatabase(r==null?void 0:r.database);break}}updateTheme(r){}updateFilter(r){this.config&&this.config.filter&&(this.config.filter=r),this.container&&(r!=null&&r.enable?this.container.style.filter=`blur(${r.blur}px) brightness(${r.brightness}) contrast(${r.contrast}) opacity(${r.opacity}) saturate(${r.saturate}) hue-rotate(${r.hueRotate}deg)`:this.container.style.filter="none")}}class BPExecutor{constructor(){U(this,"executeCount",0)}static triggerComponentEvent(r,e,n){const o=r+":"+e+":"+AnchorPointType.OUTPUT,s=new BPExecutor;s.execute(o,s,n)}execute(r,e,n){if(e.executeCount>1e3){console.warn("蓝图单条路径执行次数超过1000，请检查是否出现死循环逻辑！");return}if(e.executeCount++,!r||r===""||r.split(":").length!==3)return;const{bpAPMap:s}=bluePrintManager$1,l=s[r];l&&l.forEach(c=>{const[u,f,d]=c.split(":"),{bpNodeControllerInsMap:g}=bluePrintManager$1,p=g[u];p&&p.execute({nodeId:u,apId:f,anchorType:parseInt(d)},e,n)})}}class AntdBaseDesignerController extends AbstractDesignerController{constructor(){super(...arguments);U(this,"interval",null);U(this,"lastReqState",!0);U(this,"reConnect",!1)}changeData(e){var n,o,s;(o=(n=this.config)==null?void 0:n.style)!=null&&o.data&&(this.config.style.data=e),(s=this.instance)==null||s.changeData(e)}registerEvent(){var n,o,s,l,c,u,f;const e=(o=(n=this.config)==null?void 0:n.base)==null?void 0:o.id;(s=this.instance)==null||s.on("plot:click",(...d)=>{BPExecutor.triggerComponentEvent(e,"globalClick",{msg:"这是测试参数"})}),(l=this.instance)==null||l.on("element:click",(...d)=>{BPExecutor.triggerComponentEvent(e,"elementClick",{msg:"这是测试参数"})}),(c=this.instance)==null||c.on("legend-item:click",(...d)=>{BPExecutor.triggerComponentEvent(e,"legendClick",{msg:"这是测试参数"})}),(u=this.instance)==null||u.on("legend-item-name:click",(...d)=>{BPExecutor.triggerComponentEvent(e,"elementNameClick",{msg:"这是测试参数"})}),(f=this.instance)==null||f.on("axis-label:click",(...d)=>{BPExecutor.triggerComponentEvent(e,"axisLabelClick",{msg:"这是测试参数"})})}commonCreate(e,n,o){var s,l;this.config=o,this.container=e,this.instance=new n(e,(s=this.config)==null?void 0:s.style),(l=this.instance)==null||l.render(),this.registerEvent()}commonUpdate(e,n,o){var s,l;this.config=ObjectUtil.merge(this.config,e),o=o||{reRender:!0},o.reRender&&((l=this.instance)==null||l.update((s=this.config)==null?void 0:s.style))}}const __vite_glob_0_0=Object.freeze(Object.defineProperty({__proto__:null,AntdBaseDesignerController},Symbol.toStringTag,{value:"Module"}));class AbstractDefinition{getEventList(){return[{id:"loaded",name:"组件加载完成时"}]}getActionList(){return[{name:"显示",id:"show",handler:r=>{r.container.style.visibility="visible"}},{name:"隐藏",id:"hide",handler:r=>{r.container.style.visibility="hidden"}},{name:"更新组件样式",id:"updateConfig",handler:(r,e)=>{r.update(e)}},{name:"更新组件数据",id:"updateData",handler:(r,e)=>{r.changeData(e)}}]}getCategorize(){return null}getSubCategorize(){return null}}class AntdCommonDefinition extends AbstractDefinition{getEventList(){const r=super.getEventList();return r.push({id:"dataChange",name:"数据变更时"},{id:"globalClick",name:"点击整个组件时"},{id:"elementClick",name:"点击图形元素时"},{id:"legendClick",name:"点击图例时"},{id:"elementNameClick",name:"点击图例名称时"},{id:"axisLabelClick",name:"点击坐标文字时"}),r}getActionList(){return super.getActionList()}}const __vite_glob_0_1=Object.freeze(Object.defineProperty({__proto__:null,AntdCommonDefinition},Symbol.toStringTag,{value:"Module"}));class AntdCommonUtil{static getDataFieldOptions(r){var s;const e=r.getConfig(),n=(s=e==null?void 0:e.data)==null?void 0:s.staticData,o=[];if(n&&n.length>=1){const l=n[0];Object.keys(l).forEach(c=>o.push({label:c,value:c}))}return o}}const __vite_glob_0_2=Object.freeze(Object.defineProperty({__proto__:null,default:AntdCommonUtil},Symbol.toStringTag,{value:"Module"})),getDefaultMenuList=()=>[{icon:SettingOne,name:"基础",key:"base"},{icon:Optimize,name:"样式",key:"style"},{icon:Data,name:"数据",key:"data"},{icon:Deeplink,name:"映射",key:"mapping"},{icon:ColorFilter,name:"滤镜",key:"filter"},{icon:Theme$1,name:"主题",key:"theme"}];var extendStatics$7=function(a,r){return extendStatics$7=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},extendStatics$7(a,r)};function __extends$7(a,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");extendStatics$7(a,r);function e(){this.constructor=a}a.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}var __assign$8=function(){return __assign$8=Object.assign||function(r){for(var e,n=1,o=arguments.length;n<o;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=e[s])}return r},__assign$8.apply(this,arguments)};function __rest$1(a,r){var e={};for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&r.indexOf(n)<0&&(e[n]=a[n]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(a);o<n.length;o++)r.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(a,n[o])&&(e[n[o]]=a[n[o]]);return e}function __awaiter(a,r,e,n){function o(s){return s instanceof e?s:new e(function(l){l(s)})}return new(e||(e=Promise))(function(s,l){function c(d){try{f(n.next(d))}catch(g){l(g)}}function u(d){try{f(n.throw(d))}catch(g){l(g)}}function f(d){d.done?s(d.value):o(d.value).then(c,u)}f((n=n.apply(a,r||[])).next())})}function __generator(a,r){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,l;return l={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function c(f){return function(d){return u([f,d])}}function u(f){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,f[0]&&(e=0)),e;)try{if(n=1,o&&(s=f[0]&2?o.return:f[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,f[1])).done)return s;switch(o=0,s&&(f=[f[0]&2,s.value]),f[0]){case 0:case 1:s=f;break;case 4:return e.label++,{value:f[1],done:!1};case 5:e.label++,o=f[1],f=[0];continue;case 7:f=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(f[0]===6||f[0]===2)){e=0;continue}if(f[0]===3&&(!s||f[1]>s[0]&&f[1]<s[3])){e.label=f[1];break}if(f[0]===6&&e.label<s[1]){e.label=s[1],s=f;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(f);break}s[2]&&e.ops.pop(),e.trys.pop();continue}f=r.call(a,e)}catch(d){f=[6,d],o=0}finally{n=s=0}if(f[0]&5)throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}}function __values(a){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&a[r],n=0;if(e)return e.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&n>=a.length&&(a=void 0),{value:a&&a[n++],done:!a}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(a,r){var e=typeof Symbol=="function"&&a[Symbol.iterator];if(!e)return a;var n=e.call(a),o,s=[],l;try{for(;(r===void 0||r-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(c){l={error:c}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(l)throw l.error}}return s}function __spreadArrays$3(){for(var a=0,r=0,e=arguments.length;r<e;r++)a+=arguments[r].length;for(var n=Array(a),o=0,r=0;r<e;r++)for(var s=arguments[r],l=0,c=s.length;l<c;l++,o++)n[o]=s[l];return n}function __spreadArray$2(a,r,e){if(e||arguments.length===2)for(var n=0,o=r.length,s;n<o;n++)(s||!(n in r))&&(s||(s=Array.prototype.slice.call(r,0,n)),s[n]=r[n]);return a.concat(s||Array.prototype.slice.call(r))}typeof SuppressedError=="function"&&SuppressedError;var isArrayLike=function(a){return a!==null&&typeof a!="function"&&isFinite(a.length)},contains=function(a,r){return isArrayLike(a)?a.indexOf(r)>-1:!1},filter=function(a,r){if(!isArrayLike(a))return a;for(var e=[],n=0;n<a.length;n++){var o=a[n];r(o,n)&&e.push(o)}return e},difference=function(a,r){return r===void 0&&(r=[]),filter(a,function(e){return!contains(r,e)})},toString$3={}.toString,isType$1=function(a,r){return toString$3.call(a)==="[object "+r+"]"};const isFunction$1=function(a){return isType$1(a,"Function")};var isNil=function(a){return a==null};const isArray$4=function(a){return Array.isArray?Array.isArray(a):isType$1(a,"Array")},isObject$1=function(a){var r=typeof a;return a!==null&&r==="object"||r==="function"};function each$1(a,r){if(a){var e;if(isArray$4(a))for(var n=0,o=a.length;n<o&&(e=r(a[n],n),e!==!1);n++);else if(isObject$1(a)){for(var s in a)if(a.hasOwnProperty(s)&&(e=r(a[s],s),e===!1))break}}}var keys=Object.keys?function(a){return Object.keys(a)}:function(a){var r=[];return each$1(a,function(e,n){isFunction$1(a)&&n==="prototype"||r.push(n)}),r};function isMatch(a,r){var e=keys(r),n=e.length;if(isNil(a))return!n;for(var o=0;o<n;o+=1){var s=e[o];if(r[s]!==a[s]||!(s in a))return!1}return!0}var isObjectLike$1=function(a){return typeof a=="object"&&a!==null},isPlainObject$1=function(a){if(!isObjectLike$1(a)||!isType$1(a,"Object"))return!1;if(Object.getPrototypeOf(a)===null)return!0;for(var r=a;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(a)===r};function find$2(a,r){if(!isArray$4(a))return null;var e;if(isFunction$1(r)&&(e=r),isPlainObject$1(r)&&(e=function(o){return isMatch(o,r)}),e){for(var n=0;n<a.length;n+=1)if(e(a[n]))return a[n]}return null}function findIndex$1(a,r,e){e===void 0&&(e=0);for(var n=e;n<a.length;n++)if(r(a[n],n))return n;return-1}var firstValue=function(a,r){for(var e=null,n=0;n<a.length;n++){var o=a[n],s=o[r];if(!isNil(s)){isArray$4(s)?e=s[0]:e=s;break}}return e},flatten=function(a){if(!isArray$4(a))return[];for(var r=[],e=0;e<a.length;e++)r=r.concat(a[e]);return r};const max$2=function(a){if(isArray$4(a))return a.reduce(function(r,e){return Math.max(r,e)},a[0])},min$2=function(a){if(isArray$4(a))return a.reduce(function(r,e){return Math.min(r,e)},a[0])};var getRange=function(a){var r=a.filter(function(l){return!isNaN(l)});if(!r.length)return{min:0,max:0};if(isArray$4(a[0])){for(var e=[],n=0;n<a.length;n++)e=e.concat(a[n]);r=e}var o=max$2(r),s=min$2(r);return{min:s,max:o}},splice=Array.prototype.splice,pullAt=function a(r,e){if(!isArrayLike(r))return[];for(var n=r?e.length:0,o=n-1;n--;){var s=void 0,l=e[n];(n===o||l!==s)&&(s=l,splice.call(r,l,1))}return r},reduce=function(a,r,e){if(!isArray$4(a)&&!isPlainObject$1(a))return a;var n=e;return each$1(a,function(o,s){n=r(n,o,s)}),n},remove=function(a,r){var e=[];if(!isArrayLike(a))return e;for(var n=-1,o=[],s=a.length;++n<s;){var l=a[n];r(l,n,a)&&(e.push(l),o.push(n))}return pullAt(a,o),e};const isString$1=function(a){return isType$1(a,"String")};function sortBy(a,r){var e;if(isFunction$1(r))e=function(o,s){return r(o)-r(s)};else{var n=[];isString$1(r)?n.push(r):isArray$4(r)&&(n=r),e=function(o,s){for(var l=0;l<n.length;l+=1){var c=n[l];if(o[c]>s[c])return 1;if(o[c]<s[c])return-1}return 0}}return a.sort(e),a}function uniq$2(a,r){r===void 0&&(r=new Map);var e=[];if(Array.isArray(a))for(var n=0,o=a.length;n<o;n++){var s=a[n];r.has(s)||(e.push(s),r.set(s,!0))}return e}const valuesOfKey=function(a,r){for(var e=[],n={},o=0;o<a.length;o++){var s=a[o],l=s[r];if(!isNil(l)){isArray$4(l)||(l=[l]);for(var c=0;c<l.length;c++){var u=l[c];n[u]||(e.push(u),n[u]=!0)}}}return e};function head(a){if(isArrayLike(a))return a[0]}function last(a){if(isArrayLike(a)){var r=a;return r[r.length-1]}}var every=function(a,r){for(var e=0;e<a.length;e++)if(!r(a[e],e))return!1;return!0},some=function(a,r){for(var e=0;e<a.length;e++)if(r(a[e],e))return!0;return!1},hasOwnProperty$2=Object.prototype.hasOwnProperty;function groupBy(a,r){if(!r||!isArray$4(a))return{};for(var e={},n=isFunction$1(r)?r:function(c){return c[r]},o,s=0;s<a.length;s++){var l=a[s];o=n(l),hasOwnProperty$2.call(e,o)?e[o].push(l):e[o]=[l]}return e}function groupToMap(a,r){if(!r)return{0:a};if(!isFunction$1(r)){var e=isArray$4(r)?r:r.replace(/\s+/g,"").split("*");r=function(n){for(var o="_",s=0,l=e.length;s<l;s++)o+=n[e[s]]&&n[e[s]].toString();return o}}return groupBy(a,r)}const group$1=function(a,r){if(!r)return[a];var e=groupToMap(a,r),n=[];for(var o in e)n.push(e[o]);return n};var clamp=function(a,r,e){return a<r?r:a>e?e:a},fixedBase=function(a,r){var e=r.toString(),n=e.indexOf(".");if(n===-1)return Math.round(a);var o=e.substr(n+1).length;return o>20&&(o=20),parseFloat(a.toFixed(o))},isNumber$2=function(a){return isType$1(a,"Number")},PRECISION=1e-5;function isNumberEqual$1(a,r,e){return e===void 0&&(e=PRECISION),Math.abs(a-r)<e}const maxBy=function(a,r){if(isArray$4(a)){for(var e,n=-1/0,o=0;o<a.length;o++){var s=a[o],l=isFunction$1(r)?r(s):s[r];l>n&&(e=s,n=l)}return e}},minBy=function(a,r){if(isArray$4(a)){for(var e,n=1/0,o=0;o<a.length;o++){var s=a[o],l=isFunction$1(r)?r(s):s[r];l<n&&(e=s,n=l)}return e}};var mod$1=function(a,r){return(a%r+r)%r},RADIAN=Math.PI/180,toRadian=function(a){return RADIAN*a};const has=function(a,r){return a.hasOwnProperty(r)};var values=Object.values?function(a){return Object.values(a)}:function(a){var r=[];return each$1(a,function(e,n){isFunction$1(a)&&n==="prototype"||r.push(e)}),r};const toString$2=function(a){return isNil(a)?"":a.toString()};var lowerCase=function(a){return toString$2(a).toLowerCase()};function substitute(a,r){return!a||!r?a:a.replace(/\\?\{([^{}]+)\}/g,function(e,n){return e.charAt(0)==="\\"?e.slice(1):r[n]===void 0?"":r[n]})}var upperFirst=function(a){var r=toString$2(a);return r.charAt(0).toUpperCase()+r.substring(1)},toString$1={}.toString,getType=function(a){return toString$1.call(a).replace(/^\[object /,"").replace(/]$/,"")},isBoolean=function(a){return isType$1(a,"Boolean")},isDate=function(a){return isType$1(a,"Date")},isNull=function(a){return a===null},objectProto=Object.prototype,isPrototype=function(a){var r=a&&a.constructor,e=typeof r=="function"&&r.prototype||objectProto;return a===e},isUndefined$1=function(a){return a===void 0},isElement=function(a){return a instanceof Element||a instanceof HTMLDocument};function requestAnimationFrame$2(a){var r=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return setTimeout(e,16)};return r(a)}function cancelAnimationFrame$2(a){var r=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout;r(a)}function _mix(a,r){for(var e in r)r.hasOwnProperty(e)&&e!=="constructor"&&r[e]!==void 0&&(a[e]=r[e])}function mix(a,r,e,n){return r&&_mix(a,r),e&&_mix(a,e),n&&_mix(a,n),a}var clone=function(a){if(typeof a!="object"||a===null)return a;var r;if(isArray$4(a)){r=[];for(var e=0,n=a.length;e<n;e++)typeof a[e]=="object"&&a[e]!=null?r[e]=clone(a[e]):r[e]=a[e]}else{r={};for(var o in a)typeof a[o]=="object"&&a[o]!=null?r[o]=clone(a[o]):r[o]=a[o]}return r};function debounce$1(a,r,e){var n;return function(){var o=this,s=arguments,l=function(){n=null,e||a.apply(o,s)},c=e&&!n;clearTimeout(n),n=setTimeout(l,r),c&&a.apply(o,s)}}const memoize=function(a,r){if(!isFunction$1(a))throw new TypeError("Expected a function");var e=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var s=r?r.apply(this,n):n[0],l=e.cache;if(l.has(s))return l.get(s);var c=a.apply(this,n);return l.set(s,c),c};return e.cache=new Map,e};var MAX_MIX_LEVEL$1=5;function _deepMix(a,r,e,n){e=e||0,n=n||MAX_MIX_LEVEL$1;for(var o in r)if(r.hasOwnProperty(o)){var s=r[o];s!==null&&isPlainObject$1(s)?(isPlainObject$1(a[o])||(a[o]={}),e<n?_deepMix(a[o],s,e+1,n):a[o]=r[o]):isArray$4(s)?(a[o]=[],a[o]=a[o].concat(s)):s!==void 0&&(a[o]=s)}}var deepMix=function(a){for(var r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];for(var n=0;n<r.length;n+=1)_deepMix(a,r[n]);return a},indexOf=function(a,r){if(!isArrayLike(a))return-1;var e=Array.prototype.indexOf;if(e)return e.call(a,r);for(var n=-1,o=0;o<a.length;o++)if(a[o]===r){n=o;break}return n},hasOwnProperty$1=Object.prototype.hasOwnProperty;function isEmpty(a){if(isNil(a))return!0;if(isArrayLike(a))return!a.length;var r=getType(a);if(r==="Map"||r==="Set")return!a.size;if(isPrototype(a))return!Object.keys(a).length;for(var e in a)if(hasOwnProperty$1.call(a,e))return!1;return!0}var isEqual$1=function(a,r){if(a===r)return!0;if(!a||!r||isString$1(a)||isString$1(r))return!1;if(isArrayLike(a)||isArrayLike(r)){if(a.length!==r.length)return!1;for(var e=!0,n=0;n<a.length&&(e=isEqual$1(a[n],r[n]),!!e);n++);return e}if(isObjectLike$1(a)||isObjectLike$1(r)){var o=Object.keys(a),s=Object.keys(r);if(o.length!==s.length)return!1;for(var e=!0,n=0;n<o.length&&(e=isEqual$1(a[o[n]],r[o[n]]),!!e);n++);return e}return!1},map$2=function(a,r){if(!isArrayLike(a))return a;for(var e=[],n=0;n<a.length;n++){var o=a[n];e.push(r(o,n))}return e},identity=function(a){return a};const mapValues=function(a,r){r===void 0&&(r=identity);var e={};return isObject$1(a)&&!isNil(a)&&Object.keys(a).forEach(function(n){e[n]=r(a[n],n)}),e},get=function(a,r,e){for(var n=0,o=isString$1(r)?r.split("."):r;a&&n<o.length;)a=a[o[n++]];return a===void 0||n<o.length?e:a},set=function(a,r,e){var n=a,o=isString$1(r)?r.split("."):r;return o.forEach(function(s,l){l<o.length-1?(isObject$1(n[s])||(n[s]=isNumber$2(o[l+1])?[]:{}),n=n[s]):n[s]=e}),a};var hasOwnProperty=Object.prototype.hasOwnProperty;const pick$1=function(a,r){if(a===null||!isPlainObject$1(a))return{};var e={};return each$1(r,function(n){hasOwnProperty.call(a,n)&&(e[n]=a[n])}),e},omit$1=function(a,r){return reduce(a,function(e,n,o){return r.includes(o)||(e[o]=n),e},{})},throttle$1=function(a,r,e){var n,o,s,l,c=0;e||(e={});var u=function(){c=e.leading===!1?0:Date.now(),n=null,l=a.apply(o,s),n||(o=s=null)},f=function(){var d=Date.now();!c&&e.leading===!1&&(c=d);var g=r-(d-c);return o=this,s=arguments,g<=0||g>r?(n&&(clearTimeout(n),n=null),c=d,l=a.apply(o,s),n||(o=s=null)):!n&&e.trailing!==!1&&(n=setTimeout(u,g)),l};return f.cancel=function(){clearTimeout(n),c=0,n=o=s=null},f},toArray=function(a){return isArrayLike(a)?Array.prototype.slice.call(a):[]};var map$1={};const uniqueId=function(a){return a=a||"g",map$1[a]?map$1[a]+=1:map$1[a]=1,a+map$1[a]},noop$1=function(){};function size(a){return isNil(a)?0:isArrayLike(a)?a.length:Object.keys(a).length}var ctx$2;const measureTextWidth$2=memoize(function(a,r){r===void 0&&(r={});var e=r.fontSize,n=r.fontFamily,o=r.fontWeight,s=r.fontStyle,l=r.fontVariant;return ctx$2||(ctx$2=document.createElement("canvas").getContext("2d")),ctx$2.font=[s,l,o,e+"px",n].join(" "),ctx$2.measureText(isString$1(a)?a:"").width},function(a,r){return r===void 0&&(r={}),__spreadArrays$3([a],values(r)).join("")}),getEllipsisText$1=function(a,r,e,n){n===void 0&&(n="...");var o=16,s=measureTextWidth$2(n,e),l=isString$1(a)?a:toString$2(a),c=r,u=[],f,d;if(measureTextWidth$2(a,e)<=r)return a;for(;f=l.substr(0,o),d=measureTextWidth$2(f,e),!(d+s>c&&d>c);)if(u.push(f),c-=d,l=l.substr(o),!l)return u.join("");for(;f=l.substr(0,1),d=measureTextWidth$2(f,e),!(d+s>c);)if(u.push(f),c-=d,l=l.substr(1),!l)return u.join("");return""+u.join("")+n};var default_1=function(){function a(){this.map={}}return a.prototype.has=function(r){return this.map[r]!==void 0},a.prototype.get=function(r,e){var n=this.map[r];return n===void 0?e:n},a.prototype.set=function(r,e){this.map[r]=e},a.prototype.clear=function(){this.map={}},a.prototype.delete=function(r){delete this.map[r]},a.prototype.size=function(){return Object.keys(this.map).length},a}(),LAYER;(function(a){a.FORE="fore",a.MID="mid",a.BG="bg"})(LAYER||(LAYER={}));var DIRECTION;(function(a){a.TOP="top",a.TOP_LEFT="top-left",a.TOP_RIGHT="top-right",a.RIGHT="right",a.RIGHT_TOP="right-top",a.RIGHT_BOTTOM="right-bottom",a.LEFT="left",a.LEFT_TOP="left-top",a.LEFT_BOTTOM="left-bottom",a.BOTTOM="bottom",a.BOTTOM_LEFT="bottom-left",a.BOTTOM_RIGHT="bottom-right",a.RADIUS="radius",a.CIRCLE="circle",a.NONE="none"})(DIRECTION||(DIRECTION={}));var COMPONENT_TYPE;(function(a){a.AXIS="axis",a.GRID="grid",a.LEGEND="legend",a.TOOLTIP="tooltip",a.ANNOTATION="annotation",a.SLIDER="slider",a.SCROLLBAR="scrollbar",a.OTHER="other"})(COMPONENT_TYPE||(COMPONENT_TYPE={}));var GROUP_Z_INDEX={FORE:3,MID:2,BG:1},VIEW_LIFE_CIRCLE;(function(a){a.BEFORE_RENDER="beforerender",a.AFTER_RENDER="afterrender",a.BEFORE_PAINT="beforepaint",a.AFTER_PAINT="afterpaint",a.BEFORE_CHANGE_DATA="beforechangedata",a.AFTER_CHANGE_DATA="afterchangedata",a.BEFORE_CLEAR="beforeclear",a.AFTER_CLEAR="afterclear",a.BEFORE_DESTROY="beforedestroy",a.BEFORE_CHANGE_SIZE="beforechangesize",a.AFTER_CHANGE_SIZE="afterchangesize"})(VIEW_LIFE_CIRCLE||(VIEW_LIFE_CIRCLE={}));var GEOMETRY_LIFE_CIRCLE;(function(a){a.BEFORE_DRAW_ANIMATE="beforeanimate",a.AFTER_DRAW_ANIMATE="afteranimate",a.BEFORE_RENDER_LABEL="beforerenderlabel",a.AFTER_RENDER_LABEL="afterrenderlabel"})(GEOMETRY_LIFE_CIRCLE||(GEOMETRY_LIFE_CIRCLE={}));var PLOT_EVENTS;(function(a){a.MOUSE_ENTER="plot:mouseenter",a.MOUSE_DOWN="plot:mousedown",a.MOUSE_MOVE="plot:mousemove",a.MOUSE_UP="plot:mouseup",a.MOUSE_LEAVE="plot:mouseleave",a.TOUCH_START="plot:touchstart",a.TOUCH_MOVE="plot:touchmove",a.TOUCH_END="plot:touchend",a.TOUCH_CANCEL="plot:touchcancel",a.CLICK="plot:click",a.DBLCLICK="plot:dblclick",a.CONTEXTMENU="plot:contextmenu",a.LEAVE="plot:leave",a.ENTER="plot:enter"})(PLOT_EVENTS||(PLOT_EVENTS={}));var ELEMENT_STATE;(function(a){a.ACTIVE="active",a.INACTIVE="inactive",a.SELECTED="selected",a.DEFAULT="default"})(ELEMENT_STATE||(ELEMENT_STATE={}));var GROUP_ATTRS=["color","shape","size"],FIELD_ORIGIN="_origin",MIN_CHART_WIDTH=1,MIN_CHART_HEIGHT=1,COMPONENT_MAX_VIEW_PERCENTAGE=.25,ENGINES={};function getEngine(a){var r=ENGINES[a];if(!r)throw new Error("G engine '".concat(a,"' is not exist, please register it at first."));return r}function registerEngine(a,r){ENGINES[a]=r}function addEventListener(a,r,e){if(a){if(typeof a.addEventListener=="function")return a.addEventListener(r,e,!1),{remove:function(){a.removeEventListener(r,e,!1)}};if(typeof a.attachEvent=="function")return a.attachEvent("on"+r,e),{remove:function(){a.detachEvent("on"+r,e)}}}}var TABLE,TABLE_TR,FRAGMENT_REG,CONTAINERS;function initConstants(){TABLE=document.createElement("table"),TABLE_TR=document.createElement("tr"),FRAGMENT_REG=/^\s*<(\w+|!)[^>]*>/,CONTAINERS={tr:document.createElement("tbody"),tbody:TABLE,thead:TABLE,tfoot:TABLE,td:TABLE_TR,th:TABLE_TR,"*":document.createElement("div")}}function createDom$1(a){TABLE||initConstants();var r=FRAGMENT_REG.test(a)&&RegExp.$1;(!r||!(r in CONTAINERS))&&(r="*");var e=CONTAINERS[r];a=typeof a=="string"?a.replace(/(^\s*)|(\s*$)/g,""):a,e.innerHTML=""+a;var n=e.childNodes[0];return n&&e.contains(n)&&e.removeChild(n),n}function getStyle$1(a,r,e){var n;try{n=window.getComputedStyle?window.getComputedStyle(a,null)[r]:a.style[r]}catch{}finally{n=n===void 0?e:n}return n}function getHeight$1(a,r){var e=getStyle$1(a,"height",r);return e==="auto"&&(e=a.offsetHeight),parseFloat(e)}function getOuterHeight(a,r){var e=getHeight$1(a,r),n=parseFloat(getStyle$1(a,"borderTopWidth"))||0,o=parseFloat(getStyle$1(a,"paddingTop"))||0,s=parseFloat(getStyle$1(a,"paddingBottom"))||0,l=parseFloat(getStyle$1(a,"borderBottomWidth"))||0,c=parseFloat(getStyle$1(a,"marginTop"))||0,u=parseFloat(getStyle$1(a,"marginBottom"))||0;return e+n+l+o+s+c+u}function getHeight(a,r){var e=getStyle$1(a,"width",r);return e==="auto"&&(e=a.offsetWidth),parseFloat(e)}function getOuterWidth(a,r){var e=getHeight(a,r),n=parseFloat(getStyle$1(a,"borderLeftWidth"))||0,o=parseFloat(getStyle$1(a,"paddingLeft"))||0,s=parseFloat(getStyle$1(a,"paddingRight"))||0,l=parseFloat(getStyle$1(a,"borderRightWidth"))||0,c=parseFloat(getStyle$1(a,"marginRight"))||0,u=parseFloat(getStyle$1(a,"marginLeft"))||0;return e+n+l+o+s+u+c}function modifyCSS(a,r){if(a)for(var e in r)r.hasOwnProperty(e)&&(a.style[e]=r[e]);return a}function getElementSize(a){var r=getComputedStyle(a);return{width:(a.clientWidth||parseInt(r.width,10))-parseInt(r.paddingLeft,10)-parseInt(r.paddingRight,10),height:(a.clientHeight||parseInt(r.height,10))-parseInt(r.paddingTop,10)-parseInt(r.paddingBottom,10)}}function isNumber$1(a){return typeof a=="number"&&!isNaN(a)}function getChartSize(a,r,e,n){var o=e,s=n;if(r){var l=getElementSize(a);o=l.width?l.width:o,s=l.height?l.height:s}return{width:Math.max(isNumber$1(o)?o:MIN_CHART_WIDTH,MIN_CHART_WIDTH),height:Math.max(isNumber$1(s)?s:MIN_CHART_HEIGHT,MIN_CHART_HEIGHT)}}function removeDom(a){var r=a.parentNode;r&&r.removeChild(a)}var WILDCARD$1="*",EventEmitter$3=function(){function a(){this._events={}}return a.prototype.on=function(r,e,n){return this._events[r]||(this._events[r]=[]),this._events[r].push({callback:e,once:!!n}),this},a.prototype.once=function(r,e){return this.on(r,e,!0)},a.prototype.emit=function(r){for(var e=this,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];var s=this._events[r]||[],l=this._events[WILDCARD$1]||[],c=function(u){for(var f=u.length,d=0;d<f;d++)if(u[d]){var g=u[d],p=g.callback,v=g.once;v&&(u.splice(d,1),u.length===0&&delete e._events[r],f--,d--),p.apply(e,n)}};c(s),c(l)},a.prototype.off=function(r,e){if(!r)this._events={};else if(!e)delete this._events[r];else{for(var n=this._events[r]||[],o=n.length,s=0;s<o;s++)n[s].callback===e&&(n.splice(s,1),o--,s--);n.length===0&&delete this._events[r]}return this},a.prototype.getEvents=function(){return this._events},a}(),Base$1=function(a){__extends$7(r,a);function r(e){var n=a.call(this)||this;n.destroyed=!1;var o=e.visible,s=o===void 0?!0:o;return n.visible=s,n}return r.prototype.show=function(){var e=this.visible;e||this.changeVisible(!0)},r.prototype.hide=function(){var e=this.visible;e&&this.changeVisible(!1)},r.prototype.destroy=function(){this.off(),this.destroyed=!0},r.prototype.changeVisible=function(e){this.visible!==e&&(this.visible=e)},r}(EventEmitter$3),SPACES$2=`	
\v\f\r   ᠎             　\u2028\u2029`,PATH_COMMAND$2=new RegExp("([a-z])["+SPACES$2+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+SPACES$2+"]*,?["+SPACES$2+"]*)+)","ig"),PATH_VALUES$2=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+SPACES$2+"]*,?["+SPACES$2+"]*","ig"),parsePathString$2=function(a){if(!a)return null;if(isArray$4(a))return a;var r={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(a).replace(PATH_COMMAND$2,function(n,o,s){var l=[],c=o.toLowerCase();if(s.replace(PATH_VALUES$2,function(u,f){f&&l.push(+f)}),c==="m"&&l.length>2&&(e.push([o].concat(l.splice(0,2))),c="l",o=o==="m"?"l":"L"),c==="o"&&l.length===1&&e.push([o,l[0]]),c==="r")e.push([o].concat(l));else for(;l.length>=r[c]&&(e.push([o].concat(l.splice(0,r[c]))),!!r[c]););return a}),e},catmullRomToBezier=function(a,r){for(var e=[],n=0,o=a.length;o-2*!r>n;n+=2){var s=[{x:+a[n-2],y:+a[n-1]},{x:+a[n],y:+a[n+1]},{x:+a[n+2],y:+a[n+3]},{x:+a[n+4],y:+a[n+5]}];r?n?o-4===n?s[3]={x:+a[0],y:+a[1]}:o-2===n&&(s[2]={x:+a[0],y:+a[1]},s[3]={x:+a[2],y:+a[3]}):s[0]={x:+a[o-2],y:+a[o-1]}:o-4===n?s[3]=s[2]:n||(s[0]={x:+a[n],y:+a[n+1]}),e.push(["C",(-s[0].x+6*s[1].x+s[2].x)/6,(-s[0].y+6*s[1].y+s[2].y)/6,(s[1].x+6*s[2].x-s[3].x)/6,(s[1].y+6*s[2].y-s[3].y)/6,s[2].x,s[2].y])}return e},ellipsePath=function(a,r,e,n,o){var s=[];if(o===null&&n===null&&(n=e),a=+a,r=+r,e=+e,n=+n,o!==null){var l=Math.PI/180,c=a+e*Math.cos(-n*l),u=a+e*Math.cos(-o*l),f=r+e*Math.sin(-n*l),d=r+e*Math.sin(-o*l);s=[["M",c,f],["A",e,e,0,+(o-n>180),0,u,d]]}else s=[["M",a,r],["m",0,-n],["a",e,n,0,1,1,0,2*n],["a",e,n,0,1,1,0,-2*n],["z"]];return s},pathToAbsolute$1=function(a){if(a=parsePathString$2(a),!a||!a.length)return[["M",0,0]];var r=[],e=0,n=0,o=0,s=0,l=0,c,u;a[0][0]==="M"&&(e=+a[0][1],n=+a[0][2],o=e,s=n,l++,r[0]=["M",e,n]);for(var f=a.length===3&&a[0][0]==="M"&&a[1][0].toUpperCase()==="R"&&a[2][0].toUpperCase()==="Z",d=void 0,g=void 0,p=l,v=a.length;p<v;p++){if(r.push(d=[]),g=a[p],c=g[0],c!==c.toUpperCase())switch(d[0]=c.toUpperCase(),d[0]){case"A":d[1]=g[1],d[2]=g[2],d[3]=g[3],d[4]=g[4],d[5]=g[5],d[6]=+g[6]+e,d[7]=+g[7]+n;break;case"V":d[1]=+g[1]+n;break;case"H":d[1]=+g[1]+e;break;case"R":u=[e,n].concat(g.slice(1));for(var m=2,y=u.length;m<y;m++)u[m]=+u[m]+e,u[++m]=+u[m]+n;r.pop(),r=r.concat(catmullRomToBezier(u,f));break;case"O":r.pop(),u=ellipsePath(e,n,g[1],g[2]),u.push(u[0]),r=r.concat(u);break;case"U":r.pop(),r=r.concat(ellipsePath(e,n,g[1],g[2],g[3])),d=["U"].concat(r[r.length-1].slice(-2));break;case"M":o=+g[1]+e,s=+g[2]+n;break;default:for(var m=1,y=g.length;m<y;m++)d[m]=+g[m]+(m%2?e:n)}else if(c==="R")u=[e,n].concat(g.slice(1)),r.pop(),r=r.concat(catmullRomToBezier(u,f)),d=["R"].concat(g.slice(-2));else if(c==="O")r.pop(),u=ellipsePath(e,n,g[1],g[2]),u.push(u[0]),r=r.concat(u);else if(c==="U")r.pop(),r=r.concat(ellipsePath(e,n,g[1],g[2],g[3])),d=["U"].concat(r[r.length-1].slice(-2));else for(var x=0,_=g.length;x<_;x++)d[x]=g[x];if(c=c.toUpperCase(),c!=="O")switch(d[0]){case"Z":e=+o,n=+s;break;case"H":e=d[1];break;case"V":n=d[1];break;case"M":o=d[d.length-2],s=d[d.length-1];break;default:e=d[d.length-2],n=d[d.length-1]}}return r},l2c=function(a,r,e,n){return[a,r,e,n,e,n]},q2c=function(a,r,e,n,o,s){var l=.3333333333333333,c=2/3;return[l*a+c*e,l*r+c*n,l*o+c*e,l*s+c*n,o,s]},a2c=function(a,r,e,n,o,s,l,c,u,f){e===n&&(e+=1);var d=Math.PI*120/180,g=Math.PI/180*(+o||0),p=[],v,m,y,x,_,E=function(Z,tt,et){var at=Z*Math.cos(et)-tt*Math.sin(et),ot=Z*Math.sin(et)+tt*Math.cos(et);return{x:at,y:ot}};if(f)m=f[0],y=f[1],x=f[2],_=f[3];else{v=E(a,r,-g),a=v.x,r=v.y,v=E(c,u,-g),c=v.x,u=v.y,a===c&&r===u&&(c+=1,u+=1);var S=(a-c)/2,A=(r-u)/2,T=S*S/(e*e)+A*A/(n*n);T>1&&(T=Math.sqrt(T),e=T*e,n=T*n);var b=e*e,C=n*n,L=(s===l?-1:1)*Math.sqrt(Math.abs((b*C-b*A*A-C*S*S)/(b*A*A+C*S*S)));x=L*e*A/n+(a+c)/2,_=L*-n*S/e+(r+u)/2,m=Math.asin(((r-_)/n).toFixed(9)),y=Math.asin(((u-_)/n).toFixed(9)),m=a<x?Math.PI-m:m,y=c<x?Math.PI-y:y,m<0&&(m=Math.PI*2+m),y<0&&(y=Math.PI*2+y),l&&m>y&&(m=m-Math.PI*2),!l&&y>m&&(y=y-Math.PI*2)}var R=y-m;if(Math.abs(R)>d){var I=y,w=c,M=u;y=m+d*(l&&y>m?1:-1),c=x+e*Math.cos(y),u=_+n*Math.sin(y),p=a2c(c,u,e,n,o,0,l,w,M,[y,I,x,_])}R=y-m;var D=Math.cos(m),O=Math.sin(m),F=Math.cos(y),k=Math.sin(y),$=Math.tan(R/4),V=4/3*e*$,N=4/3*n*$,B=[a,r],G=[a+V*O,r-N*D],z=[c+V*k,u-N*F],H=[c,u];if(G[0]=2*B[0]-G[0],G[1]=2*B[1]-G[1],f)return[G,z,H].concat(p);p=[G,z,H].concat(p).join().split(",");for(var W=[],Y=0,K=p.length;Y<K;Y++)W[Y]=Y%2?E(p[Y-1],p[Y],g).y:E(p[Y],p[Y+1],g).x;return W},pathToCurve=function(a,r){var e=pathToAbsolute$1(a),n=r&&pathToAbsolute$1(r),o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},l=[],c=[],u="",f="",d,g=function(S,A,T){var b,C;if(!S)return["C",A.x,A.y,A.x,A.y,A.x,A.y];switch(!(S[0]in{T:1,Q:1})&&(A.qx=A.qy=null),S[0]){case"M":A.X=S[1],A.Y=S[2];break;case"A":S=["C"].concat(a2c.apply(0,[A.x,A.y].concat(S.slice(1))));break;case"S":T==="C"||T==="S"?(b=A.x*2-A.bx,C=A.y*2-A.by):(b=A.x,C=A.y),S=["C",b,C].concat(S.slice(1));break;case"T":T==="Q"||T==="T"?(A.qx=A.x*2-A.qx,A.qy=A.y*2-A.qy):(A.qx=A.x,A.qy=A.y),S=["C"].concat(q2c(A.x,A.y,A.qx,A.qy,S[1],S[2]));break;case"Q":A.qx=S[1],A.qy=S[2],S=["C"].concat(q2c(A.x,A.y,S[1],S[2],S[3],S[4]));break;case"L":S=["C"].concat(l2c(A.x,A.y,S[1],S[2]));break;case"H":S=["C"].concat(l2c(A.x,A.y,S[1],A.y));break;case"V":S=["C"].concat(l2c(A.x,A.y,A.x,S[1]));break;case"Z":S=["C"].concat(l2c(A.x,A.y,A.X,A.Y));break}return S},p=function(S,A){if(S[A].length>7){S[A].shift();for(var T=S[A];T.length;)l[A]="A",n&&(c[A]="A"),S.splice(A++,0,["C"].concat(T.splice(0,6)));S.splice(A,1),d=Math.max(e.length,n&&n.length||0)}},v=function(S,A,T,b,C){S&&A&&S[C][0]==="M"&&A[C][0]!=="M"&&(A.splice(C,0,["M",b.x,b.y]),T.bx=0,T.by=0,T.x=S[C][1],T.y=S[C][2],d=Math.max(e.length,n&&n.length||0))};d=Math.max(e.length,n&&n.length||0);for(var m=0;m<d;m++){e[m]&&(u=e[m][0]),u!=="C"&&(l[m]=u,m&&(f=l[m-1])),e[m]=g(e[m],o,f),l[m]!=="A"&&u==="C"&&(l[m]="C"),p(e,m),n&&(n[m]&&(u=n[m][0]),u!=="C"&&(c[m]=u,m&&(f=c[m-1])),n[m]=g(n[m],s,f),c[m]!=="A"&&u==="C"&&(c[m]="C"),p(n,m)),v(e,n,o,s,m),v(n,e,s,o,m);var y=e[m],x=n&&n[m],_=y.length,E=n&&x.length;o.x=y[_-2],o.y=y[_-1],o.bx=parseFloat(y[_-4])||o.x,o.by=parseFloat(y[_-3])||o.y,s.bx=n&&(parseFloat(x[E-4])||s.x),s.by=n&&(parseFloat(x[E-3])||s.y),s.x=n&&x[E-2],s.y=n&&x[E-1]}return n?[e,n]:e},p2s=/,?([a-z]),?/gi,parsePathArray=function(a){return a.join(",").replace(p2s,"$1")},base3=function(a,r,e,n,o){var s=-3*r+9*e-9*n+3*o,l=a*s+6*r-12*e+6*n;return a*l-3*r+3*e},bezlen=function(a,r,e,n,o,s,l,c,u){u===null&&(u=1),u=u>1?1:u<0?0:u;for(var f=u/2,d=12,g=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],p=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],v=0,m=0;m<d;m++){var y=f*g[m]+f,x=base3(y,a,e,o,l),_=base3(y,r,n,s,c),E=x*x+_*_;v+=p[m]*Math.sqrt(E)}return f*v},curveDim=function(a,r,e,n,o,s,l,c){for(var u=[],f=[[],[]],d,g,p,v,m=0;m<2;++m){if(m===0?(g=6*a-12*e+6*o,d=-3*a+9*e-9*o+3*l,p=3*e-3*a):(g=6*r-12*n+6*s,d=-3*r+9*n-9*s+3*c,p=3*n-3*r),Math.abs(d)<1e-12){if(Math.abs(g)<1e-12)continue;v=-p/g,v>0&&v<1&&u.push(v);continue}var y=g*g-4*p*d,x=Math.sqrt(y);if(!(y<0)){var _=(-g+x)/(2*d);_>0&&_<1&&u.push(_);var E=(-g-x)/(2*d);E>0&&E<1&&u.push(E)}}for(var S=u.length,A=S,T;S--;)v=u[S],T=1-v,f[0][S]=T*T*T*a+3*T*T*v*e+3*T*v*v*o+v*v*v*l,f[1][S]=T*T*T*r+3*T*T*v*n+3*T*v*v*s+v*v*v*c;return f[0][A]=a,f[1][A]=r,f[0][A+1]=l,f[1][A+1]=c,f[0].length=f[1].length=A+2,{min:{x:Math.min.apply(0,f[0]),y:Math.min.apply(0,f[1])},max:{x:Math.max.apply(0,f[0]),y:Math.max.apply(0,f[1])}}},intersect$1=function(a,r,e,n,o,s,l,c){if(!(Math.max(a,e)<Math.min(o,l)||Math.min(a,e)>Math.max(o,l)||Math.max(r,n)<Math.min(s,c)||Math.min(r,n)>Math.max(s,c))){var u=(a*n-r*e)*(o-l)-(a-e)*(o*c-s*l),f=(a*n-r*e)*(s-c)-(r-n)*(o*c-s*l),d=(a-e)*(s-c)-(r-n)*(o-l);if(d){var g=u/d,p=f/d,v=+g.toFixed(2),m=+p.toFixed(2);if(!(v<+Math.min(a,e).toFixed(2)||v>+Math.max(a,e).toFixed(2)||v<+Math.min(o,l).toFixed(2)||v>+Math.max(o,l).toFixed(2)||m<+Math.min(r,n).toFixed(2)||m>+Math.max(r,n).toFixed(2)||m<+Math.min(s,c).toFixed(2)||m>+Math.max(s,c).toFixed(2)))return{x:g,y:p}}}},isPointInsideBBox=function(a,r,e){return r>=a.x&&r<=a.x+a.width&&e>=a.y&&e<=a.y+a.height},rectPath=function(a,r,e,n,o){if(o)return[["M",+a+ +o,r],["l",e-o*2,0],["a",o,o,0,0,1,o,o],["l",0,n-o*2],["a",o,o,0,0,1,-o,o],["l",o*2-e,0],["a",o,o,0,0,1,-o,-o],["l",0,o*2-n],["a",o,o,0,0,1,o,-o],["z"]];var s=[["M",a,r],["l",e,0],["l",0,n],["l",-e,0],["z"]];return s.parsePathArray=parsePathArray,s},box=function(a,r,e,n){return a===null&&(a=r=e=n=0),r===null&&(r=a.y,e=a.width,n=a.height,a=a.x),{x:a,y:r,width:e,w:e,height:n,h:n,x2:a+e,y2:r+n,cx:a+e/2,cy:r+n/2,r1:Math.min(e,n)/2,r2:Math.max(e,n)/2,r0:Math.sqrt(e*e+n*n)/2,path:rectPath(a,r,e,n),vb:[a,r,e,n].join(" ")}},isBBoxIntersect=function(a,r){return a=box(a),r=box(r),isPointInsideBBox(r,a.x,a.y)||isPointInsideBBox(r,a.x2,a.y)||isPointInsideBBox(r,a.x,a.y2)||isPointInsideBBox(r,a.x2,a.y2)||isPointInsideBBox(a,r.x,r.y)||isPointInsideBBox(a,r.x2,r.y)||isPointInsideBBox(a,r.x,r.y2)||isPointInsideBBox(a,r.x2,r.y2)||(a.x<r.x2&&a.x>r.x||r.x<a.x2&&r.x>a.x)&&(a.y<r.y2&&a.y>r.y||r.y<a.y2&&r.y>a.y)},bezierBBox=function(a,r,e,n,o,s,l,c){isArray$4(a)||(a=[a,r,e,n,o,s,l,c]);var u=curveDim.apply(null,a);return box(u.min.x,u.min.y,u.max.x-u.min.x,u.max.y-u.min.y)},findDotsAtSegment=function(a,r,e,n,o,s,l,c,u){var f=1-u,d=Math.pow(f,3),g=Math.pow(f,2),p=u*u,v=p*u,m=d*a+g*3*u*e+f*3*u*u*o+v*l,y=d*r+g*3*u*n+f*3*u*u*s+v*c,x=a+2*u*(e-a)+p*(o-2*e+a),_=r+2*u*(n-r)+p*(s-2*n+r),E=e+2*u*(o-e)+p*(l-2*o+e),S=n+2*u*(s-n)+p*(c-2*s+n),A=f*a+u*e,T=f*r+u*n,b=f*o+u*l,C=f*s+u*c,L=90-Math.atan2(x-E,_-S)*180/Math.PI;return{x:m,y,m:{x,y:_},n:{x:E,y:S},start:{x:A,y:T},end:{x:b,y:C},alpha:L}},interHelper=function(a,r,e){var n=bezierBBox(a),o=bezierBBox(r);if(!isBBoxIntersect(n,o))return e?0:[];for(var s=bezlen.apply(0,a),l=bezlen.apply(0,r),c=~~(s/8),u=~~(l/8),f=[],d=[],g={},p=e?0:[],v=0;v<c+1;v++){var m=findDotsAtSegment.apply(0,a.concat(v/c));f.push({x:m.x,y:m.y,t:v/c})}for(var v=0;v<u+1;v++){var m=findDotsAtSegment.apply(0,r.concat(v/u));d.push({x:m.x,y:m.y,t:v/u})}for(var v=0;v<c;v++)for(var y=0;y<u;y++){var x=f[v],_=f[v+1],E=d[y],S=d[y+1],A=Math.abs(_.x-x.x)<.001?"y":"x",T=Math.abs(S.x-E.x)<.001?"y":"x",b=intersect$1(x.x,x.y,_.x,_.y,E.x,E.y,S.x,S.y);if(b){if(g[b.x.toFixed(4)]===b.y.toFixed(4))continue;g[b.x.toFixed(4)]=b.y.toFixed(4);var C=x.t+Math.abs((b[A]-x[A])/(_[A]-x[A]))*(_.t-x.t),L=E.t+Math.abs((b[T]-E[T])/(S[T]-E[T]))*(S.t-E.t);C>=0&&C<=1&&L>=0&&L<=1&&(e?p+=1:p.push({x:b.x,y:b.y,t1:C,t2:L}))}}return p},interPathHelper=function(a,r,e){a=pathToCurve(a),r=pathToCurve(r);for(var n,o,s,l,c,u,f,d,g,p,v=e?0:[],m=0,y=a.length;m<y;m++){var x=a[m];if(x[0]==="M")n=c=x[1],o=u=x[2];else{x[0]==="C"?(g=[n,o].concat(x.slice(1)),n=g[6],o=g[7]):(g=[n,o,n,o,c,u,c,u],n=c,o=u);for(var _=0,E=r.length;_<E;_++){var S=r[_];if(S[0]==="M")s=f=S[1],l=d=S[2];else{S[0]==="C"?(p=[s,l].concat(S.slice(1)),s=p[6],l=p[7]):(p=[s,l,s,l,f,d,f,d],s=f,l=d);var A=interHelper(g,p,e);if(e)v+=A;else{for(var T=0,b=A.length;T<b;T++)A[T].segment1=m,A[T].segment2=_,A[T].bez1=g,A[T].bez2=p;v=v.concat(A)}}}}}return v},intersection$1=function(a,r){return interPathHelper(a,r)};function decasteljau(a,r){var e=[],n=[];function o(s,l){if(s.length===1)e.push(s[0]),n.push(s[0]);else{for(var c=[],u=0;u<s.length-1;u++)u===0&&e.push(s[0]),u===s.length-2&&n.push(s[u+1]),c[u]=[(1-l)*s[u][0]+l*s[u+1][0],(1-l)*s[u][1]+l*s[u+1][1]];o(c,l)}}return a.length&&o(a,r),{left:e,right:n.reverse()}}function splitCurve(a,r,e){var n=[[a[1],a[2]]];e=e||2;var o=[];r[0]==="A"?(n.push(r[6]),n.push(r[7])):r[0]==="C"?(n.push([r[1],r[2]]),n.push([r[3],r[4]]),n.push([r[5],r[6]])):r[0]==="S"||r[0]==="Q"?(n.push([r[1],r[2]]),n.push([r[3],r[4]])):n.push([r[1],r[2]]);for(var s=n,l=1/e,c=0;c<e-1;c++){var u=l/(1-l*c),f=decasteljau(s,u);o.push(f.left),s=f.right}o.push(s);var d=o.map(function(g){var p=[];return g.length===4&&(p.push("C"),p=p.concat(g[2])),g.length>=3&&(g.length===3&&p.push("Q"),p=p.concat(g[1])),g.length===2&&p.push("L"),p=p.concat(g[g.length-1]),p});return d}var splitSegment=function(a,r,e){if(e===1)return[[].concat(a)];var n=[];if(r[0]==="L"||r[0]==="C"||r[0]==="Q")n=n.concat(splitCurve(a,r,e));else{var o=[].concat(a);o[0]==="M"&&(o[0]="L");for(var s=0;s<=e-1;s++)n.push(o)}return n},fillPath=function(a,r){if(a.length===1)return a;var e=a.length-1,n=r.length-1,o=e/n,s=[];if(a.length===1&&a[0][0]==="M"){for(var l=0;l<n-e;l++)a.push(a[0]);return a}for(var l=0;l<n;l++){var c=Math.floor(o*l);s[c]=(s[c]||0)+1}var u=s.reduce(function(f,d,g){return g===e?f.concat(a[e]):f.concat(splitSegment(a[g],a[g+1],d))},[]);return u.unshift(a[0]),(r[n]==="Z"||r[n]==="z")&&u.push("Z"),u},isEqual=function(a,r){if(a.length!==r.length)return!1;var e=!0;return each$1(a,function(n,o){if(n!==r[o])return e=!1,!1}),e};function getMinDiff(a,r,e){var n=null,o=e;return r<o&&(o=r,n="add"),a<o&&(o=a,n="del"),{type:n,min:o}}var levenshteinDistance=function(a,r){var e=a.length,n=r.length,o,s,l=0;if(e===0||n===0)return null;for(var c=[],u=0;u<=e;u++)c[u]=[],c[u][0]={min:u};for(var f=0;f<=n;f++)c[0][f]={min:f};for(var u=1;u<=e;u++){o=a[u-1];for(var f=1;f<=n;f++){s=r[f-1],isEqual(o,s)?l=0:l=1;var d=c[u-1][f].min+1,g=c[u][f-1].min+1,p=c[u-1][f-1].min+l;c[u][f]=getMinDiff(d,g,p)}}return c},fillPathByDiff=function(a,r){var e=levenshteinDistance(a,r),n=a.length,o=r.length,s=[],l=1,c=1;if(e[n][o].min!==n){for(var u=1;u<=n;u++){var f=e[u][u].min;c=u;for(var d=l;d<=o;d++)e[u][d].min<f&&(f=e[u][d].min,c=d);l=c,e[u][l].type&&s.push({index:u-1,type:e[u][l].type})}for(var u=s.length-1;u>=0;u--)l=s[u].index,s[u].type==="add"?a.splice(l,0,[].concat(a[l])):a.splice(l,1)}n=a.length;var g=o-n;if(n<o)for(var u=0;u<g;u++)a[n-1][0]==="z"||a[n-1][0]==="Z"?a.splice(n-2,0,a[n-2]):a.push(a[n-1]),n+=1;return a};function _splitPoints(a,r,e){for(var n=[].concat(a),o,s=1/(e+1),l=_getSegmentPoints(r)[0],c=1;c<=e;c++)s*=c,o=Math.floor(a.length*s),o===0?n.unshift([l[0]*s+a[o][0]*(1-s),l[1]*s+a[o][1]*(1-s)]):n.splice(o,0,[l[0]*s+a[o][0]*(1-s),l[1]*s+a[o][1]*(1-s)]);return n}function _getSegmentPoints(a){var r=[];switch(a[0]){case"M":r.push([a[1],a[2]]);break;case"L":r.push([a[1],a[2]]);break;case"A":r.push([a[6],a[7]]);break;case"Q":r.push([a[3],a[4]]),r.push([a[1],a[2]]);break;case"T":r.push([a[1],a[2]]);break;case"C":r.push([a[5],a[6]]),r.push([a[1],a[2]]),r.push([a[3],a[4]]);break;case"S":r.push([a[3],a[4]]),r.push([a[1],a[2]]);break;case"H":r.push([a[1],a[1]]);break;case"V":r.push([a[1],a[1]]);break}return r}var formatPath=function(a,r){if(a.length<=1)return a;for(var e,n=0;n<r.length;n++)if(a[n][0]!==r[n][0])switch(e=_getSegmentPoints(a[n]),r[n][0]){case"M":a[n]=["M"].concat(e[0]);break;case"L":a[n]=["L"].concat(e[0]);break;case"A":a[n]=[].concat(r[n]),a[n][6]=e[0][0],a[n][7]=e[0][1];break;case"Q":if(e.length<2)if(n>0)e=_splitPoints(e,a[n-1],1);else{a[n]=r[n];break}a[n]=["Q"].concat(e.reduce(function(o,s){return o.concat(s)},[]));break;case"T":a[n]=["T"].concat(e[0]);break;case"C":if(e.length<3)if(n>0)e=_splitPoints(e,a[n-1],2);else{a[n]=r[n];break}a[n]=["C"].concat(e.reduce(function(o,s){return o.concat(s)},[]));break;case"S":if(e.length<2)if(n>0)e=_splitPoints(e,a[n-1],1);else{a[n]=r[n];break}a[n]=["S"].concat(e.reduce(function(o,s){return o.concat(s)},[]));break;default:a[n]=r[n]}return a};const PathUtil$1=Object.freeze(Object.defineProperty({__proto__:null,catmullRomToBezier,fillPath,fillPathByDiff,formatPath,intersection:intersection$1,parsePathArray,parsePathString:parsePathString$2,pathToAbsolute:pathToAbsolute$1,pathToCurve,rectPath},Symbol.toStringTag,{value:"Module"}));var GraphEvent=function(){function a(r,e){this.bubbles=!0,this.target=null,this.currentTarget=null,this.delegateTarget=null,this.delegateObject=null,this.defaultPrevented=!1,this.propagationStopped=!1,this.shape=null,this.fromShape=null,this.toShape=null,this.propagationPath=[],this.type=r,this.name=r,this.originalEvent=e,this.timeStamp=e.timeStamp}return a.prototype.preventDefault=function(){this.defaultPrevented=!0,this.originalEvent.preventDefault&&this.originalEvent.preventDefault()},a.prototype.stopPropagation=function(){this.propagationStopped=!0},a.prototype.toString=function(){var r=this.type;return"[Event (type="+r+")]"},a.prototype.save=function(){},a.prototype.restore=function(){},a}();function removeFromArray(a,r){var e=a.indexOf(r);e!==-1&&a.splice(e,1)}var isBrowser=typeof window<"u"&&typeof window.document<"u";function isParent(a,r){if(a.isCanvas())return!0;for(var e=r.getParent(),n=!1;e;){if(e===a){n=!0;break}e=e.getParent()}return n}function isAllowCapture(a){return a.cfg.visible&&a.cfg.capture}var Base=function(a){__extends$7(r,a);function r(e){var n=a.call(this)||this;n.destroyed=!1;var o=n.getDefaultCfg();return n.cfg=mix(o,e),n}return r.prototype.getDefaultCfg=function(){return{}},r.prototype.get=function(e){return this.cfg[e]},r.prototype.set=function(e,n){this.cfg[e]=n},r.prototype.destroy=function(){this.cfg={destroyed:!0},this.off(),this.destroyed=!0},r}(EventEmitter$3),__spreadArray$1=function(a,r,e){if(e||arguments.length===2)for(var n=0,o=r.length,s;n<o;n++)(s||!(n in r))&&(s||(s=Array.prototype.slice.call(r,0,n)),s[n]=r[n]);return a.concat(s||Array.prototype.slice.call(r))},BrowserInfo=function(){function a(r,e,n){this.name=r,this.version=e,this.os=n,this.type="browser"}return a}(),NodeInfo=function(){function a(r){this.version=r,this.type="node",this.name="node",this.os=process.platform}return a}(),SearchBotDeviceInfo=function(){function a(r,e,n,o){this.name=r,this.version=e,this.os=n,this.bot=o,this.type="bot-device"}return a}(),BotInfo=function(){function a(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return a}(),ReactNativeInfo=function(){function a(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return a}(),SEARCHBOX_UA_REGEX=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,SEARCHBOT_OS_REGEX=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,REQUIRED_VERSION_PARTS=3,userAgentRules=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",SEARCHBOX_UA_REGEX]],operatingSystemRules=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function detect(a){return a?parseUserAgent(a):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new ReactNativeInfo:typeof navigator<"u"?parseUserAgent(navigator.userAgent):getNodeVersion()}function matchUserAgent(a){return a!==""&&userAgentRules.reduce(function(r,e){var n=e[0],o=e[1];if(r)return r;var s=o.exec(a);return!!s&&[n,s]},!1)}function parseUserAgent(a){var r=matchUserAgent(a);if(!r)return null;var e=r[0],n=r[1];if(e==="searchbot")return new BotInfo;var o=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);o?o.length<REQUIRED_VERSION_PARTS&&(o=__spreadArray$1(__spreadArray$1([],o,!0),createVersionParts(REQUIRED_VERSION_PARTS-o.length),!0)):o=[];var s=o.join("."),l=detectOS(a),c=SEARCHBOT_OS_REGEX.exec(a);return c&&c[1]?new SearchBotDeviceInfo(e,s,l,c[1]):new BrowserInfo(e,s,l)}function detectOS(a){for(var r=0,e=operatingSystemRules.length;r<e;r++){var n=operatingSystemRules[r],o=n[0],s=n[1],l=s.exec(a);if(l)return o}return null}function getNodeVersion(){var a=typeof process<"u"&&process.version;return a?new NodeInfo(process.version.slice(1)):null}function createVersionParts(a){for(var r=[],e=0;e<a;e++)r.push("0");return r}var ARRAY_TYPE=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var a=0,r=arguments.length;r--;)a+=arguments[r]*arguments[r];return Math.sqrt(a)});function invert$2(a,r){var e=r[0],n=r[1],o=r[2],s=r[3],l=r[4],c=r[5],u=r[6],f=r[7],d=r[8],g=d*l-c*f,p=-d*s+c*u,v=f*s-l*u,m=e*g+n*p+o*v;return m?(m=1/m,a[0]=g*m,a[1]=(-d*n+o*f)*m,a[2]=(c*n-o*l)*m,a[3]=p*m,a[4]=(d*e-o*u)*m,a[5]=(-c*e+o*s)*m,a[6]=v*m,a[7]=(-f*e+n*u)*m,a[8]=(l*e-n*s)*m,a):null}function multiply$1(a,r,e){var n=r[0],o=r[1],s=r[2],l=r[3],c=r[4],u=r[5],f=r[6],d=r[7],g=r[8],p=e[0],v=e[1],m=e[2],y=e[3],x=e[4],_=e[5],E=e[6],S=e[7],A=e[8];return a[0]=p*n+v*l+m*f,a[1]=p*o+v*c+m*d,a[2]=p*s+v*u+m*g,a[3]=y*n+x*l+_*f,a[4]=y*o+x*c+_*d,a[5]=y*s+x*u+_*g,a[6]=E*n+S*l+A*f,a[7]=E*o+S*c+A*d,a[8]=E*s+S*u+A*g,a}function fromTranslation$1(a,r){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=r[0],a[7]=r[1],a[8]=1,a}function fromRotation(a,r){var e=Math.sin(r),n=Math.cos(r);return a[0]=n,a[1]=e,a[2]=0,a[3]=-e,a[4]=n,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a}function fromScaling(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=r[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a}function create$1(){var a=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function transformMat3$1(a,r,e){var n=r[0],o=r[1],s=r[2];return a[0]=n*e[0]+o*e[3]+s*e[6],a[1]=n*e[1]+o*e[4]+s*e[7],a[2]=n*e[2]+o*e[5]+s*e[8],a}(function(){var a=create$1();return function(r,e,n,o,s,l){var c,u;for(e||(e=3),n||(n=0),o?u=Math.min(o*e+n,r.length):u=r.length,c=n;c<u;c+=e)a[0]=r[c],a[1]=r[c+1],a[2]=r[c+2],s(a,a,l),r[c]=a[0],r[c+1]=a[1],r[c+2]=a[2];return r}})();function create(){var a=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0),a}function add$1(a,r,e){return a[0]=r[0]+e[0],a[1]=r[1]+e[1],a}function subtract(a,r,e){return a[0]=r[0]-e[0],a[1]=r[1]-e[1],a}function min$1(a,r,e){return a[0]=Math.min(r[0],e[0]),a[1]=Math.min(r[1],e[1]),a}function max$1(a,r,e){return a[0]=Math.max(r[0],e[0]),a[1]=Math.max(r[1],e[1]),a}function scale$3(a,r,e){return a[0]=r[0]*e,a[1]=r[1]*e,a}function distance$6(a,r){var e=r[0]-a[0],n=r[1]-a[1];return Math.hypot(e,n)}function length(a){var r=a[0],e=a[1];return Math.hypot(r,e)}function normalize(a,r){var e=r[0],n=r[1],o=e*e+n*n;return o>0&&(o=1/Math.sqrt(o)),a[0]=r[0]*o,a[1]=r[1]*o,a}function dot$3(a,r){return a[0]*r[0]+a[1]*r[1]}function transformMat3(a,r,e){var n=r[0],o=r[1];return a[0]=e[0]*n+e[3]*o+e[6],a[1]=e[1]*n+e[4]*o+e[7],a}function angle$1(a,r){var e=a[0],n=a[1],o=r[0],s=r[1],l=Math.sqrt(e*e+n*n)*Math.sqrt(o*o+s*s),c=l&&(e*o+n*s)/l;return Math.acos(Math.min(Math.max(c,-1),1))}function exactEquals(a,r){return a[0]===r[0]&&a[1]===r[1]}var sub=subtract;(function(){var a=create();return function(r,e,n,o,s,l){var c,u;for(e||(e=2),n||(n=0),o?u=Math.min(o*e+n,r.length):u=r.length,c=n;c<u;c+=e)a[0]=r[c],a[1]=r[c+1],s(a,a,l),r[c]=a[0],r[c+1]=a[1];return r}})();function leftTranslate(a,r,e){var n=[0,0,0,0,0,0,0,0,0];return fromTranslation$1(n,e),multiply$1(a,n,r)}function leftRotate(a,r,e){var n=[0,0,0,0,0,0,0,0,0];return fromRotation(n,e),multiply$1(a,n,r)}function leftScale(a,r,e){var n=[0,0,0,0,0,0,0,0,0];return fromScaling(n,e),multiply$1(a,n,r)}function leftMultiply(a,r,e){return multiply$1(a,e,r)}function transform$6(a,r){for(var e=a?[].concat(a):[1,0,0,0,1,0,0,0,1],n=0,o=r.length;n<o;n++){var s=r[n];switch(s[0]){case"t":leftTranslate(e,e,[s[1],s[2]]);break;case"s":leftScale(e,e,[s[1],s[2]]);break;case"r":leftRotate(e,e,s[1]);break;case"m":leftMultiply(e,e,s[1]);break}}return e}function direction(a,r){return a[0]*r[1]-r[0]*a[1]}function angleTo(a,r,e){var n=angle$1(a,r),o=direction(a,r)>=0;return e?o?Math.PI*2-n:n:o?n:Math.PI*2-n}function multiplyMatrix(a,r){var e=[],n=a[0],o=a[1],s=a[2],l=a[3],c=a[4],u=a[5],f=a[6],d=a[7],g=a[8],p=r[0],v=r[1],m=r[2],y=r[3],x=r[4],_=r[5],E=r[6],S=r[7],A=r[8];return e[0]=p*n+v*l+m*f,e[1]=p*o+v*c+m*d,e[2]=p*s+v*u+m*g,e[3]=y*n+x*l+_*f,e[4]=y*o+x*c+_*d,e[5]=y*s+x*u+_*g,e[6]=E*n+S*l+A*f,e[7]=E*o+S*c+A*d,e[8]=E*s+S*u+A*g,e}function multiplyVec2$1(a,r){var e=[],n=r[0],o=r[1];return e[0]=a[0]*n+a[3]*o+a[6],e[1]=a[1]*n+a[4]*o+a[7],e}function invert$1(a){var r=[],e=a[0],n=a[1],o=a[2],s=a[3],l=a[4],c=a[5],u=a[6],f=a[7],d=a[8],g=d*l-c*f,p=-d*s+c*u,v=f*s-l*u,m=e*g+n*p+o*v;return m?(m=1/m,r[0]=g*m,r[1]=(-d*n+o*f)*m,r[2]=(c*n-o*l)*m,r[3]=p*m,r[4]=(d*e-o*u)*m,r[5]=(-c*e+o*s)*m,r[6]=v*m,r[7]=(-f*e+n*u)*m,r[8]=(l*e-n*s)*m,r):null}var transform$5=transform$6,MATRIX="matrix",CLONE_CFGS=["zIndex","capture","visible","type"],RESERVED_PORPS=["repeat"],DELEGATION_SPLIT=":",WILDCARD="*";function _cloneArrayAttr(a){for(var r=[],e=0;e<a.length;e++)isArray$4(a[e])?r.push([].concat(a[e])):r.push(a[e]);return r}function getFormatFromAttrs(a,r){var e={},n=r.attrs;for(var o in a)e[o]=n[o];return e}function getFormatToAttrs(a,r){var e={},n=r.attr();return each$1(a,function(o,s){RESERVED_PORPS.indexOf(s)===-1&&!isEqual$1(n[s],o)&&(e[s]=o)}),e}function checkExistedAttrs(a,r){if(r.onFrame)return a;var e=r.startTime,n=r.delay,o=r.duration,s=Object.prototype.hasOwnProperty;return each$1(a,function(l){e+n<l.startTime+l.delay+l.duration&&o>l.delay&&each$1(r.toAttrs,function(c,u){s.call(l.toAttrs,u)&&(delete l.toAttrs[u],delete l.fromAttrs[u])})}),a}var Element$2=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;n.attrs={};var o=n.getDefaultAttrs();return mix(o,e.attrs),n.attrs=o,n.initAttrs(o),n.initAnimate(),n}return r.prototype.getDefaultCfg=function(){return{visible:!0,capture:!0,zIndex:0}},r.prototype.getDefaultAttrs=function(){return{matrix:this.getDefaultMatrix(),opacity:1}},r.prototype.onCanvasChange=function(e){},r.prototype.initAttrs=function(e){},r.prototype.initAnimate=function(){this.set("animable",!0),this.set("animating",!1)},r.prototype.isGroup=function(){return!1},r.prototype.getParent=function(){return this.get("parent")},r.prototype.getCanvas=function(){return this.get("canvas")},r.prototype.attr=function(){for(var e,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];var s=n[0],l=n[1];if(!s)return this.attrs;if(isObject$1(s)){for(var c in s)this.setAttr(c,s[c]);return this.afterAttrsChange(s),this}return n.length===2?(this.setAttr(s,l),this.afterAttrsChange((e={},e[s]=l,e)),this):this.attrs[s]},r.prototype.isClipped=function(e,n){var o=this.getClip();return o&&!o.isHit(e,n)},r.prototype.setAttr=function(e,n){var o=this.attrs[e];o!==n&&(this.attrs[e]=n,this.onAttrChange(e,n,o))},r.prototype.onAttrChange=function(e,n,o){e==="matrix"&&this.set("totalMatrix",null)},r.prototype.afterAttrsChange=function(e){if(this.cfg.isClipShape){var n=this.cfg.applyTo;n&&n.onCanvasChange("clip")}else this.onCanvasChange("attr")},r.prototype.show=function(){return this.set("visible",!0),this.onCanvasChange("show"),this},r.prototype.hide=function(){return this.set("visible",!1),this.onCanvasChange("hide"),this},r.prototype.setZIndex=function(e){this.set("zIndex",e);var n=this.getParent();return n&&n.sort(),this},r.prototype.toFront=function(){var e=this.getParent();if(e){var n=e.getChildren();this.get("el");var o=n.indexOf(this);n.splice(o,1),n.push(this),this.onCanvasChange("zIndex")}},r.prototype.toBack=function(){var e=this.getParent();if(e){var n=e.getChildren();this.get("el");var o=n.indexOf(this);n.splice(o,1),n.unshift(this),this.onCanvasChange("zIndex")}},r.prototype.remove=function(e){e===void 0&&(e=!0);var n=this.getParent();n?(removeFromArray(n.getChildren(),this),n.get("clearing")||this.onCanvasChange("remove")):this.onCanvasChange("remove"),e&&this.destroy()},r.prototype.resetMatrix=function(){this.attr(MATRIX,this.getDefaultMatrix()),this.onCanvasChange("matrix")},r.prototype.getMatrix=function(){return this.attr(MATRIX)},r.prototype.setMatrix=function(e){this.attr(MATRIX,e),this.onCanvasChange("matrix")},r.prototype.getTotalMatrix=function(){var e=this.cfg.totalMatrix;if(!e){var n=this.attr("matrix"),o=this.cfg.parentMatrix;o&&n?e=multiplyMatrix(o,n):e=n||o,this.set("totalMatrix",e)}return e},r.prototype.applyMatrix=function(e){var n=this.attr("matrix"),o=null;e&&n?o=multiplyMatrix(e,n):o=n||e,this.set("totalMatrix",o),this.set("parentMatrix",e)},r.prototype.getDefaultMatrix=function(){return null},r.prototype.applyToMatrix=function(e){var n=this.attr("matrix");return n?multiplyVec2$1(n,e):e},r.prototype.invertFromMatrix=function(e){var n=this.attr("matrix");if(n){var o=invert$1(n);if(o)return multiplyVec2$1(o,e)}return e},r.prototype.setClip=function(e){var n=this.getCanvas(),o=null;if(e){var s=this.getShapeBase(),l=upperFirst(e.type),c=s[l];c&&(o=new c({type:e.type,isClipShape:!0,applyTo:this,attrs:e.attrs,canvas:n}))}return this.set("clipShape",o),this.onCanvasChange("clip"),o},r.prototype.getClip=function(){var e=this.cfg.clipShape;return e||null},r.prototype.clone=function(){var e=this,n=this.attrs,o={};each$1(n,function(c,u){isArray$4(n[u])?o[u]=_cloneArrayAttr(n[u]):o[u]=n[u]});var s=this.constructor,l=new s({attrs:o});return each$1(CLONE_CFGS,function(c){l.set(c,e.get(c))}),l},r.prototype.destroy=function(){var e=this.destroyed;e||(this.attrs={},a.prototype.destroy.call(this))},r.prototype.isAnimatePaused=function(){return this.get("_pause").isPaused},r.prototype.animate=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(!(!this.get("timeline")&&!this.get("canvas"))){this.set("animating",!0);var o=this.get("timeline");o||(o=this.get("canvas").get("timeline"),this.set("timeline",o));var s=this.get("animations")||[];o.timer||o.initTimer();var l=e[0],c=e[1],u=e[2],f=u===void 0?"easeLinear":u,d=e[3],g=d===void 0?noop$1:d,p=e[4],v=p===void 0?0:p,m,y,x,_,E;isFunction$1(l)?(m=l,l={}):isObject$1(l)&&l.onFrame&&(m=l.onFrame,y=l.repeat),isObject$1(c)?(E=c,c=E.duration,f=E.easing||"easeLinear",v=E.delay||0,y=E.repeat||y||!1,g=E.callback||noop$1,x=E.pauseCallback||noop$1,_=E.resumeCallback||noop$1):(isNumber$2(g)&&(v=g,g=null),isFunction$1(f)?(g=f,f="easeLinear"):f=f||"easeLinear");var S=getFormatToAttrs(l,this),A={fromAttrs:getFormatFromAttrs(S,this),toAttrs:S,duration:c,easing:f,repeat:y,callback:g,pauseCallback:x,resumeCallback:_,delay:v,startTime:o.getTime(),id:uniqueId(),onFrame:m,pathFormatted:!1};s.length>0?s=checkExistedAttrs(s,A):o.addAnimator(this),s.push(A),this.set("animations",s),this.set("_pause",{isPaused:!1})}},r.prototype.stopAnimate=function(e){var n=this;e===void 0&&(e=!0);var o=this.get("animations");each$1(o,function(s){e&&(s.onFrame?n.attr(s.onFrame(1)):n.attr(s.toAttrs)),s.callback&&s.callback()}),this.set("animating",!1),this.set("animations",[])},r.prototype.pauseAnimate=function(){var e=this.get("timeline"),n=this.get("animations"),o=e.getTime();return each$1(n,function(s){s._paused=!0,s._pauseTime=o,s.pauseCallback&&s.pauseCallback()}),this.set("_pause",{isPaused:!0,pauseTime:o}),this},r.prototype.resumeAnimate=function(){var e=this.get("timeline"),n=e.getTime(),o=this.get("animations"),s=this.get("_pause").pauseTime;return each$1(o,function(l){l.startTime=l.startTime+(n-s),l._paused=!1,l._pauseTime=null,l.resumeCallback&&l.resumeCallback()}),this.set("_pause",{isPaused:!1}),this.set("animations",o),this},r.prototype.emitDelegation=function(e,n){var o=this,s=n.propagationPath;this.getEvents();var l;e==="mouseenter"?l=n.fromShape:e==="mouseleave"&&(l=n.toShape);for(var c=function(g){var p=s[g],v=p.get("name");if(v){if((p.isGroup()||p.isCanvas&&p.isCanvas())&&l&&isParent(p,l))return"break";isArray$4(v)?each$1(v,function(m){o.emitDelegateEvent(p,m,n)}):u.emitDelegateEvent(p,v,n)}},u=this,f=0;f<s.length;f++){var d=c(f);if(d==="break")break}},r.prototype.emitDelegateEvent=function(e,n,o){var s=this.getEvents(),l=n+DELEGATION_SPLIT+o.type;(s[l]||s[WILDCARD])&&(o.name=l,o.currentTarget=e,o.delegateTarget=this,o.delegateObject=e.get("delegateObject"),this.emit(l,o))},r.prototype.translate=function(e,n){e===void 0&&(e=0),n===void 0&&(n=0);var o=this.getMatrix(),s=transform$5(o,[["t",e,n]]);return this.setMatrix(s),this},r.prototype.move=function(e,n){var o=this.attr("x")||0,s=this.attr("y")||0;return this.translate(e-o,n-s),this},r.prototype.moveTo=function(e,n){return this.move(e,n)},r.prototype.scale=function(e,n){var o=this.getMatrix(),s=transform$5(o,[["s",e,n||e]]);return this.setMatrix(s),this},r.prototype.rotate=function(e){var n=this.getMatrix(),o=transform$5(n,[["r",e]]);return this.setMatrix(o),this},r.prototype.rotateAtStart=function(e){var n=this.attr(),o=n.x,s=n.y,l=this.getMatrix(),c=transform$5(l,[["t",-o,-s],["r",e],["t",o,s]]);return this.setMatrix(c),this},r.prototype.rotateAtPoint=function(e,n,o){var s=this.getMatrix(),l=transform$5(s,[["t",-e,-n],["r",o],["t",e,n]]);return this.setMatrix(l),this},r}(Base),SHAPE_MAP={},INDEX="_INDEX";function setCanvas(a,r){if(a.set("canvas",r),a.isGroup()){var e=a.get("children");e.length&&e.forEach(function(n){setCanvas(n,r)})}}function setTimeline(a,r){if(a.set("timeline",r),a.isGroup()){var e=a.get("children");e.length&&e.forEach(function(n){setTimeline(n,r)})}}function removeChild(a,r,e){e===void 0&&(e=!0),e?r.destroy():(r.set("parent",null),r.set("canvas",null)),removeFromArray(a.getChildren(),r)}function getComparer(a){return function(r,e){var n=a(r,e);return n===0?r[INDEX]-e[INDEX]:n}}var Container=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.isCanvas=function(){return!1},r.prototype.getBBox=function(){var e=1/0,n=-1/0,o=1/0,s=-1/0,l=this.getChildren().filter(function(u){return u.get("visible")&&(!u.isGroup()||u.isGroup()&&u.getChildren().length>0)});l.length>0?each$1(l,function(u){var f=u.getBBox(),d=f.minX,g=f.maxX,p=f.minY,v=f.maxY;d<e&&(e=d),g>n&&(n=g),p<o&&(o=p),v>s&&(s=v)}):(e=0,n=0,o=0,s=0);var c={x:e,y:o,minX:e,minY:o,maxX:n,maxY:s,width:n-e,height:s-o};return c},r.prototype.getCanvasBBox=function(){var e=1/0,n=-1/0,o=1/0,s=-1/0,l=this.getChildren().filter(function(u){return u.get("visible")&&(!u.isGroup()||u.isGroup()&&u.getChildren().length>0)});l.length>0?each$1(l,function(u){var f=u.getCanvasBBox(),d=f.minX,g=f.maxX,p=f.minY,v=f.maxY;d<e&&(e=d),g>n&&(n=g),p<o&&(o=p),v>s&&(s=v)}):(e=0,n=0,o=0,s=0);var c={x:e,y:o,minX:e,minY:o,maxX:n,maxY:s,width:n-e,height:s-o};return c},r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return e.children=[],e},r.prototype.onAttrChange=function(e,n,o){if(a.prototype.onAttrChange.call(this,e,n,o),e==="matrix"){var s=this.getTotalMatrix();this._applyChildrenMarix(s)}},r.prototype.applyMatrix=function(e){var n=this.getTotalMatrix();a.prototype.applyMatrix.call(this,e);var o=this.getTotalMatrix();o!==n&&this._applyChildrenMarix(o)},r.prototype._applyChildrenMarix=function(e){var n=this.getChildren();each$1(n,function(o){o.applyMatrix(e)})},r.prototype.addShape=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=e[0],s=e[1];isObject$1(o)?s=o:s.type=o;var l=SHAPE_MAP[s.type];l||(l=upperFirst(s.type),SHAPE_MAP[s.type]=l);var c=this.getShapeBase(),u=new c[l](s);return this.add(u),u},r.prototype.addGroup=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=e[0],s=e[1],l;if(isFunction$1(o))s?l=new o(s):l=new o({parent:this});else{var c=o||{},u=this.getGroupBase();l=new u(c)}return this.add(l),l},r.prototype.getCanvas=function(){var e;return this.isCanvas()?e=this:e=this.get("canvas"),e},r.prototype.getShape=function(e,n,o){if(!isAllowCapture(this))return null;var s=this.getChildren(),l;if(this.isCanvas())l=this._findShape(s,e,n,o);else{var c=[e,n,1];c=this.invertFromMatrix(c),this.isClipped(c[0],c[1])||(l=this._findShape(s,c[0],c[1],o))}return l},r.prototype._findShape=function(e,n,o,s){for(var l=null,c=e.length-1;c>=0;c--){var u=e[c];if(isAllowCapture(u)&&(u.isGroup()?l=u.getShape(n,o,s):u.isHit(n,o)&&(l=u)),l)break}return l},r.prototype.add=function(e){var n=this.getCanvas(),o=this.getChildren(),s=this.get("timeline"),l=e.getParent();l&&removeChild(l,e,!1),e.set("parent",this),n&&setCanvas(e,n),s&&setTimeline(e,s),o.push(e),e.onCanvasChange("add"),this._applyElementMatrix(e)},r.prototype._applyElementMatrix=function(e){var n=this.getTotalMatrix();n&&e.applyMatrix(n)},r.prototype.getChildren=function(){return this.get("children")},r.prototype.sort=function(){var e=this.getChildren();each$1(e,function(n,o){return n[INDEX]=o,n}),e.sort(getComparer(function(n,o){return n.get("zIndex")-o.get("zIndex")})),this.onCanvasChange("sort")},r.prototype.clear=function(){if(this.set("clearing",!0),!this.destroyed){for(var e=this.getChildren(),n=e.length-1;n>=0;n--)e[n].destroy();this.set("children",[]),this.onCanvasChange("clear"),this.set("clearing",!1)}},r.prototype.destroy=function(){this.get("destroyed")||(this.clear(),a.prototype.destroy.call(this))},r.prototype.getFirst=function(){return this.getChildByIndex(0)},r.prototype.getLast=function(){var e=this.getChildren();return this.getChildByIndex(e.length-1)},r.prototype.getChildByIndex=function(e){var n=this.getChildren();return n[e]},r.prototype.getCount=function(){var e=this.getChildren();return e.length},r.prototype.contain=function(e){var n=this.getChildren();return n.indexOf(e)>-1},r.prototype.removeChild=function(e,n){n===void 0&&(n=!0),this.contain(e)&&e.remove(n)},r.prototype.findAll=function(e){var n=[],o=this.getChildren();return each$1(o,function(s){e(s)&&n.push(s),s.isGroup()&&(n=n.concat(s.findAll(e)))}),n},r.prototype.find=function(e){var n=null,o=this.getChildren();return each$1(o,function(s){if(e(s)?n=s:s.isGroup()&&(n=s.find(e)),n)return!1}),n},r.prototype.findById=function(e){return this.find(function(n){return n.get("id")===e})},r.prototype.findByClassName=function(e){return this.find(function(n){return n.get("className")===e})},r.prototype.findAllByName=function(e){return this.findAll(function(n){return n.get("name")===e})},r}(Element$2),frame=0,timeout=0,interval$1=0,pokeDelay=1e3,taskHead,taskTail,clockLast=0,clockNow=0,clockSkew=0,clock=typeof performance=="object"&&performance.now?performance:Date,setFrame=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(a){setTimeout(a,17)};function now$2(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer(){this._call=this._time=this._next=null}Timer.prototype=timer.prototype={constructor:Timer,restart:function(a,r,e){if(typeof a!="function")throw new TypeError("callback is not a function");e=(e==null?now$2():+e)+(r==null?0:+r),!this._next&&taskTail!==this&&(taskTail?taskTail._next=this:taskHead=this,taskTail=this),this._call=a,this._time=e,sleep()},stop:function(){this._call&&(this._call=null,this._time=1/0,sleep())}};function timer(a,r,e){var n=new Timer;return n.restart(a,r,e),n}function timerFlush(){now$2(),++frame;for(var a=taskHead,r;a;)(r=clockNow-a._time)>=0&&a._call.call(null,r),a=a._next;--frame}function wake(){clockNow=(clockLast=clock.now())+clockSkew,frame=timeout=0;try{timerFlush()}finally{frame=0,nap(),clockNow=0}}function poke(){var a=clock.now(),r=a-clockLast;r>pokeDelay&&(clockSkew-=r,clockLast=a)}function nap(){for(var a,r=taskHead,e,n=1/0;r;)r._call?(n>r._time&&(n=r._time),a=r,r=r._next):(e=r._next,r._next=null,r=a?a._next=e:taskHead=e);taskTail=a,sleep(n)}function sleep(a){if(!frame){timeout&&(timeout=clearTimeout(timeout));var r=a-clockNow;r>24?(a<1/0&&(timeout=setTimeout(wake,a-clock.now()-clockSkew)),interval$1&&(interval$1=clearInterval(interval$1))):(interval$1||(clockLast=clock.now(),interval$1=setInterval(poke,pokeDelay)),frame=1,setFrame(wake))}}function define(a,r,e){a.prototype=r.prototype=e,e.constructor=a}function extend(a,r){var e=Object.create(a.prototype);for(var n in r)e[n]=r[n];return e}function Color$1(){}var darker=.7,brighter=1/darker,reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp(`^rgb\\(${reI},${reI},${reI}\\)$`),reRgbPercent=new RegExp(`^rgb\\(${reP},${reP},${reP}\\)$`),reRgbaInteger=new RegExp(`^rgba\\(${reI},${reI},${reI},${reN}\\)$`),reRgbaPercent=new RegExp(`^rgba\\(${reP},${reP},${reP},${reN}\\)$`),reHslPercent=new RegExp(`^hsl\\(${reN},${reP},${reP}\\)$`),reHslaPercent=new RegExp(`^hsla\\(${reN},${reP},${reP},${reN}\\)$`),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};define(Color$1,color$1,{copy(a){return Object.assign(new this.constructor,this,a)},displayable(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHex8:color_formatHex8,formatHsl:color_formatHsl,formatRgb:color_formatRgb,toString:color_formatRgb});function color_formatHex(){return this.rgb().formatHex()}function color_formatHex8(){return this.rgb().formatHex8()}function color_formatHsl(){return hslConvert(this).formatHsl()}function color_formatRgb(){return this.rgb().formatRgb()}function color$1(a){var r,e;return a=(a+"").trim().toLowerCase(),(r=reHex.exec(a))?(e=r[1].length,r=parseInt(r[1],16),e===6?rgbn(r):e===3?new Rgb(r>>8&15|r>>4&240,r>>4&15|r&240,(r&15)<<4|r&15,1):e===8?rgba(r>>24&255,r>>16&255,r>>8&255,(r&255)/255):e===4?rgba(r>>12&15|r>>8&240,r>>8&15|r>>4&240,r>>4&15|r&240,((r&15)<<4|r&15)/255):null):(r=reRgbInteger.exec(a))?new Rgb(r[1],r[2],r[3],1):(r=reRgbPercent.exec(a))?new Rgb(r[1]*255/100,r[2]*255/100,r[3]*255/100,1):(r=reRgbaInteger.exec(a))?rgba(r[1],r[2],r[3],r[4]):(r=reRgbaPercent.exec(a))?rgba(r[1]*255/100,r[2]*255/100,r[3]*255/100,r[4]):(r=reHslPercent.exec(a))?hsla(r[1],r[2]/100,r[3]/100,1):(r=reHslaPercent.exec(a))?hsla(r[1],r[2]/100,r[3]/100,r[4]):named.hasOwnProperty(a)?rgbn(named[a]):a==="transparent"?new Rgb(NaN,NaN,NaN,0):null}function rgbn(a){return new Rgb(a>>16&255,a>>8&255,a&255,1)}function rgba(a,r,e,n){return n<=0&&(a=r=e=NaN),new Rgb(a,r,e,n)}function rgbConvert(a){return a instanceof Color$1||(a=color$1(a)),a?(a=a.rgb(),new Rgb(a.r,a.g,a.b,a.opacity)):new Rgb}function rgb$1(a,r,e,n){return arguments.length===1?rgbConvert(a):new Rgb(a,r,e,n??1)}function Rgb(a,r,e,n){this.r=+a,this.g=+r,this.b=+e,this.opacity=+n}define(Rgb,rgb$1,extend(Color$1,{brighter(a){return a=a==null?brighter:Math.pow(brighter,a),new Rgb(this.r*a,this.g*a,this.b*a,this.opacity)},darker(a){return a=a==null?darker:Math.pow(darker,a),new Rgb(this.r*a,this.g*a,this.b*a,this.opacity)},rgb(){return this},clamp(){return new Rgb(clampi(this.r),clampi(this.g),clampi(this.b),clampa(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatHex8:rgb_formatHex8,formatRgb:rgb_formatRgb,toString:rgb_formatRgb}));function rgb_formatHex(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}`}function rgb_formatHex8(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}${hex((isNaN(this.opacity)?1:this.opacity)*255)}`}function rgb_formatRgb(){const a=clampa(this.opacity);return`${a===1?"rgb(":"rgba("}${clampi(this.r)}, ${clampi(this.g)}, ${clampi(this.b)}${a===1?")":`, ${a})`}`}function clampa(a){return isNaN(a)?1:Math.max(0,Math.min(1,a))}function clampi(a){return Math.max(0,Math.min(255,Math.round(a)||0))}function hex(a){return a=clampi(a),(a<16?"0":"")+a.toString(16)}function hsla(a,r,e,n){return n<=0?a=r=e=NaN:e<=0||e>=1?a=r=NaN:r<=0&&(a=NaN),new Hsl(a,r,e,n)}function hslConvert(a){if(a instanceof Hsl)return new Hsl(a.h,a.s,a.l,a.opacity);if(a instanceof Color$1||(a=color$1(a)),!a)return new Hsl;if(a instanceof Hsl)return a;a=a.rgb();var r=a.r/255,e=a.g/255,n=a.b/255,o=Math.min(r,e,n),s=Math.max(r,e,n),l=NaN,c=s-o,u=(s+o)/2;return c?(r===s?l=(e-n)/c+(e<n)*6:e===s?l=(n-r)/c+2:l=(r-e)/c+4,c/=u<.5?s+o:2-s-o,l*=60):c=u>0&&u<1?0:l,new Hsl(l,c,u,a.opacity)}function hsl(a,r,e,n){return arguments.length===1?hslConvert(a):new Hsl(a,r,e,n??1)}function Hsl(a,r,e,n){this.h=+a,this.s=+r,this.l=+e,this.opacity=+n}define(Hsl,hsl,extend(Color$1,{brighter(a){return a=a==null?brighter:Math.pow(brighter,a),new Hsl(this.h,this.s,this.l*a,this.opacity)},darker(a){return a=a==null?darker:Math.pow(darker,a),new Hsl(this.h,this.s,this.l*a,this.opacity)},rgb(){var a=this.h%360+(this.h<0)*360,r=isNaN(a)||isNaN(this.s)?0:this.s,e=this.l,n=e+(e<.5?e:1-e)*r,o=2*e-n;return new Rgb(hsl2rgb(a>=240?a-240:a+120,o,n),hsl2rgb(a,o,n),hsl2rgb(a<120?a+240:a-120,o,n),this.opacity)},clamp(){return new Hsl(clamph(this.h),clampt(this.s),clampt(this.l),clampa(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const a=clampa(this.opacity);return`${a===1?"hsl(":"hsla("}${clamph(this.h)}, ${clampt(this.s)*100}%, ${clampt(this.l)*100}%${a===1?")":`, ${a})`}`}}));function clamph(a){return a=(a||0)%360,a<0?a+360:a}function clampt(a){return Math.max(0,Math.min(1,a||0))}function hsl2rgb(a,r,e){return(a<60?r+(e-r)*a/60:a<180?e:a<240?r+(e-r)*(240-a)/60:r)*255}const constant$3=a=>()=>a;function linear$3(a,r){return function(e){return a+e*r}}function exponential$1(a,r,e){return a=Math.pow(a,e),r=Math.pow(r,e)-a,e=1/e,function(n){return Math.pow(a+n*r,e)}}function gamma(a){return(a=+a)==1?nogamma:function(r,e){return e-r?exponential$1(r,e,a):constant$3(isNaN(r)?e:r)}}function nogamma(a,r){var e=r-a;return e?linear$3(a,e):constant$3(isNaN(a)?r:a)}const rgb=function a(r){var e=gamma(r);function n(o,s){var l=e((o=rgb$1(o)).r,(s=rgb$1(s)).r),c=e(o.g,s.g),u=e(o.b,s.b),f=nogamma(o.opacity,s.opacity);return function(d){return o.r=l(d),o.g=c(d),o.b=u(d),o.opacity=f(d),o+""}}return n.gamma=a,n}(1);function numberArray(a,r){r||(r=[]);var e=a?Math.min(r.length,a.length):0,n=r.slice(),o;return function(s){for(o=0;o<e;++o)n[o]=a[o]*(1-s)+r[o]*s;return n}}function isNumberArray(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function interpolateArray(a,r){return(isNumberArray(r)?numberArray:genericArray)(a,r)}function genericArray(a,r){var e=r?r.length:0,n=a?Math.min(e,a.length):0,o=new Array(n),s=new Array(e),l;for(l=0;l<n;++l)o[l]=interpolate(a[l],r[l]);for(;l<e;++l)s[l]=r[l];return function(c){for(l=0;l<n;++l)s[l]=o[l](c);return s}}function date(a,r){var e=new Date;return a=+a,r=+r,function(n){return e.setTime(a*(1-n)+r*n),e}}function number(a,r){return a=+a,r=+r,function(e){return a*(1-e)+r*e}}function object$1(a,r){var e={},n={},o;(a===null||typeof a!="object")&&(a={}),(r===null||typeof r!="object")&&(r={});for(o in r)o in a?e[o]=interpolate(a[o],r[o]):n[o]=r[o];return function(s){for(o in e)n[o]=e[o](s);return n}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function zero(a){return function(){return a}}function one(a){return function(r){return a(r)+""}}function string(a,r){var e=reA.lastIndex=reB.lastIndex=0,n,o,s,l=-1,c=[],u=[];for(a=a+"",r=r+"";(n=reA.exec(a))&&(o=reB.exec(r));)(s=o.index)>e&&(s=r.slice(e,s),c[l]?c[l]+=s:c[++l]=s),(n=n[0])===(o=o[0])?c[l]?c[l]+=o:c[++l]=o:(c[++l]=null,u.push({i:l,x:number(n,o)})),e=reB.lastIndex;return e<r.length&&(s=r.slice(e),c[l]?c[l]+=s:c[++l]=s),c.length<2?u[0]?one(u[0].x):zero(r):(r=u.length,function(f){for(var d=0,g;d<r;++d)c[(g=u[d]).i]=g.x(f);return c.join("")})}function interpolate(a,r){var e=typeof r,n;return r==null||e==="boolean"?constant$3(r):(e==="number"?number:e==="string"?(n=color$1(r))?(r=n,rgb):string:r instanceof color$1?rgb:r instanceof Date?date:isNumberArray(r)?numberArray:Array.isArray(r)?genericArray:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?object$1:number)(a,r)}function linear$2(a){return+a}function quadIn(a){return a*a}function quadOut(a){return a*(2-a)}function quadInOut(a){return((a*=2)<=1?a*a:--a*(2-a)+1)/2}function cubicIn(a){return a*a*a}function cubicOut(a){return--a*a*a+1}function cubicInOut(a){return((a*=2)<=1?a*a*a:(a-=2)*a*a+2)/2}var exponent=3,polyIn=function a(r){r=+r;function e(n){return Math.pow(n,r)}return e.exponent=a,e}(exponent),polyOut=function a(r){r=+r;function e(n){return 1-Math.pow(1-n,r)}return e.exponent=a,e}(exponent),polyInOut=function a(r){r=+r;function e(n){return((n*=2)<=1?Math.pow(n,r):2-Math.pow(2-n,r))/2}return e.exponent=a,e}(exponent),pi=Math.PI,halfPi=pi/2;function sinIn(a){return+a==1?1:1-Math.cos(a*halfPi)}function sinOut(a){return Math.sin(a*halfPi)}function sinInOut(a){return(1-Math.cos(pi*a))/2}function tpmt(a){return(Math.pow(2,-10*a)-.0009765625)*1.0009775171065494}function expIn(a){return tpmt(1-+a)}function expOut(a){return 1-tpmt(a)}function expInOut(a){return((a*=2)<=1?tpmt(1-a):2-tpmt(a-1))/2}function circleIn(a){return 1-Math.sqrt(1-a*a)}function circleOut(a){return Math.sqrt(1- --a*a)}function circleInOut(a){return((a*=2)<=1?1-Math.sqrt(1-a*a):Math.sqrt(1-(a-=2)*a)+1)/2}var b1=4/11,b2=6/11,b3=8/11,b4=3/4,b5=9/11,b6=10/11,b7=15/16,b8=21/22,b9=63/64,b0=1/b1/b1;function bounceIn(a){return 1-bounceOut(1-a)}function bounceOut(a){return(a=+a)<b1?b0*a*a:a<b3?b0*(a-=b2)*a+b4:a<b6?b0*(a-=b5)*a+b7:b0*(a-=b8)*a+b9}function bounceInOut(a){return((a*=2)<=1?1-bounceOut(1-a):bounceOut(a-1)+1)/2}var overshoot=1.70158,backIn=function a(r){r=+r;function e(n){return(n=+n)*n*(r*(n-1)+n)}return e.overshoot=a,e}(overshoot),backOut=function a(r){r=+r;function e(n){return--n*n*((n+1)*r+n)+1}return e.overshoot=a,e}(overshoot),backInOut=function a(r){r=+r;function e(n){return((n*=2)<1?n*n*((r+1)*n-r):(n-=2)*n*((r+1)*n+r)+2)/2}return e.overshoot=a,e}(overshoot),tau=2*Math.PI,amplitude=1,period=.3,elasticIn=function a(r,e){var n=Math.asin(1/(r=Math.max(1,r)))*(e/=tau);function o(s){return r*tpmt(- --s)*Math.sin((n-s)/e)}return o.amplitude=function(s){return a(s,e*tau)},o.period=function(s){return a(r,s)},o}(amplitude,period),elasticOut=function a(r,e){var n=Math.asin(1/(r=Math.max(1,r)))*(e/=tau);function o(s){return 1-r*tpmt(s=+s)*Math.sin((s+n)/e)}return o.amplitude=function(s){return a(s,e*tau)},o.period=function(s){return a(r,s)},o}(amplitude,period),elasticInOut=function a(r,e){var n=Math.asin(1/(r=Math.max(1,r)))*(e/=tau);function o(s){return((s=s*2-1)<0?r*tpmt(-s)*Math.sin((n-s)/e):2-r*tpmt(s)*Math.sin((n+s)/e))/2}return o.amplitude=function(s){return a(s,e*tau)},o.period=function(s){return a(r,s)},o}(amplitude,period);const d3Ease=Object.freeze(Object.defineProperty({__proto__:null,easeBack:backInOut,easeBackIn:backIn,easeBackInOut:backInOut,easeBackOut:backOut,easeBounce:bounceOut,easeBounceIn:bounceIn,easeBounceInOut:bounceInOut,easeBounceOut:bounceOut,easeCircle:circleInOut,easeCircleIn:circleIn,easeCircleInOut:circleInOut,easeCircleOut:circleOut,easeCubic:cubicInOut,easeCubicIn:cubicIn,easeCubicInOut:cubicInOut,easeCubicOut:cubicOut,easeElastic:elasticOut,easeElasticIn:elasticIn,easeElasticInOut:elasticInOut,easeElasticOut:elasticOut,easeExp:expInOut,easeExpIn:expIn,easeExpInOut:expInOut,easeExpOut:expOut,easeLinear:linear$2,easePoly:polyInOut,easePolyIn:polyIn,easePolyInOut:polyInOut,easePolyOut:polyOut,easeQuad:quadInOut,easeQuadIn:quadIn,easeQuadInOut:quadInOut,easeQuadOut:quadOut,easeSin:sinInOut,easeSinIn:sinIn,easeSinInOut:sinInOut,easeSinOut:sinOut},Symbol.toStringTag,{value:"Module"}));var EASING_MAP={};function getEasing(a){return EASING_MAP[a.toLowerCase()]||d3Ease[a]}function registerEasing(a,r){EASING_MAP[a.toLowerCase()]=r}var isColorProp=function(a){return["fill","stroke","fillStyle","strokeStyle"].includes(a)},isGradientColor$1=function(a){return/^[r,R,L,l]{1}[\s]*\(/.test(a)},IDENTITY_MATRIX=[1,0,0,0,1,0,0,0,1];function _update(a,r,e){var n={},o=r.fromAttrs,s=r.toAttrs;if(!a.destroyed){var l;for(var c in s)if(!isEqual$1(o[c],s[c]))if(c==="path"){var u=s[c],f=o[c];u.length>f.length?(u=parsePathString$2(s[c]),f=parsePathString$2(o[c]),f=fillPathByDiff(f,u),f=formatPath(f,u),r.fromAttrs.path=f,r.toAttrs.path=u):r.pathFormatted||(u=parsePathString$2(s[c]),f=parsePathString$2(o[c]),f=formatPath(f,u),r.fromAttrs.path=f,r.toAttrs.path=u,r.pathFormatted=!0),n[c]=[];for(var d=0;d<u.length;d++){for(var g=u[d],p=f[d],v=[],m=0;m<g.length;m++)isNumber$2(g[m])&&p&&isNumber$2(p[m])?(l=interpolate(p[m],g[m]),v.push(l(e))):v.push(g[m]);n[c].push(v)}}else if(c==="matrix"){var y=interpolateArray(o[c]||IDENTITY_MATRIX,s[c]||IDENTITY_MATRIX),x=y(e);n[c]=x}else isColorProp(c)&&isGradientColor$1(s[c])?n[c]=s[c]:isFunction$1(s[c])||(l=interpolate(o[c],s[c]),n[c]=l(e));a.attr(n)}}function update(a,r,e){var n=r.startTime,o=r.delay;if(e<n+o||r._paused)return!1;var s,l=r.duration,c=r.easing,u=getEasing(c);if(e=e-n-r.delay,r.repeat)s=e%l/l,s=u(s);else if(s=e/l,s<1)s=u(s);else return r.onFrame?a.attr(r.onFrame(1)):a.attr(r.toAttrs),!0;if(r.onFrame){var f=r.onFrame(s);a.attr(f)}else _update(a,r,s);return!1}var Timeline=function(){function a(r){this.animators=[],this.current=0,this.timer=null,this.canvas=r}return a.prototype.initTimer=function(){var r=this,e=!1,n,o,s;this.timer=timer(function(l){if(r.current=l,r.animators.length>0){for(var c=r.animators.length-1;c>=0;c--){if(n=r.animators[c],n.destroyed){r.removeAnimator(c);continue}if(!n.isAnimatePaused()){o=n.get("animations");for(var u=o.length-1;u>=0;u--)s=o[u],e=update(n,s,l),e&&(o.splice(u,1),e=!1,s.callback&&s.callback())}o.length===0&&r.removeAnimator(c)}var f=r.canvas.get("autoDraw");f||r.canvas.draw()}})},a.prototype.addAnimator=function(r){this.animators.push(r)},a.prototype.removeAnimator=function(r){this.animators.splice(r,1)},a.prototype.isAnimating=function(){return!!this.animators.length},a.prototype.stop=function(){this.timer&&this.timer.stop()},a.prototype.stopAllAnimations=function(r){r===void 0&&(r=!0),this.animators.forEach(function(e){e.stopAnimate(r)}),this.animators=[],this.canvas.draw()},a.prototype.getTime=function(){return this.current},a}(),CLICK_OFFSET=40,LEFT_BTN_CODE=0,EVENTS$3=["mousedown","mouseup","dblclick","mouseout","mouseover","mousemove","mouseleave","mouseenter","touchstart","touchmove","touchend","dragenter","dragover","dragleave","drop","contextmenu","mousewheel"];function emitTargetEvent(a,r,e){e.name=r,e.target=a,e.currentTarget=a,e.delegateTarget=a,a.emit(r,e)}function bubbleEvent(a,r,e){if(e.bubbles){var n=void 0,o=!1;if(r==="mouseenter"?(n=e.fromShape,o=!0):r==="mouseleave"&&(o=!0,n=e.toShape),a.isCanvas()&&o)return;if(n&&isParent(a,n)){e.bubbles=!1;return}e.name=r,e.currentTarget=a,e.delegateTarget=a,a.emit(r,e)}}var EventController=function(){function a(r){var e=this;this.draggingShape=null,this.dragging=!1,this.currentShape=null,this.mousedownShape=null,this.mousedownPoint=null,this._eventCallback=function(n){var o=n.type;e._triggerEvent(o,n)},this._onDocumentMove=function(n){var o=e.canvas,s=o.get("el");if(s!==n.target&&(e.dragging||e.currentShape)){var l=e._getPointInfo(n);e.dragging&&e._emitEvent("drag",n,l,e.draggingShape)}},this._onDocumentMouseUp=function(n){var o=e.canvas,s=o.get("el");if(s!==n.target&&e.dragging){var l=e._getPointInfo(n);e.draggingShape&&e._emitEvent("drop",n,l,null),e._emitEvent("dragend",n,l,e.draggingShape),e._afterDrag(e.draggingShape,l,n)}},this.canvas=r.canvas}return a.prototype.init=function(){this._bindEvents()},a.prototype._bindEvents=function(){var r=this,e=this.canvas.get("el");each$1(EVENTS$3,function(n){e.addEventListener(n,r._eventCallback)}),document&&(document.addEventListener("mousemove",this._onDocumentMove),document.addEventListener("mouseup",this._onDocumentMouseUp))},a.prototype._clearEvents=function(){var r=this,e=this.canvas.get("el");each$1(EVENTS$3,function(n){e.removeEventListener(n,r._eventCallback)}),document&&(document.removeEventListener("mousemove",this._onDocumentMove),document.removeEventListener("mouseup",this._onDocumentMouseUp))},a.prototype._getEventObj=function(r,e,n,o,s,l){var c=new GraphEvent(r,e);return c.fromShape=s,c.toShape=l,c.x=n.x,c.y=n.y,c.clientX=n.clientX,c.clientY=n.clientY,c.propagationPath.push(o),c},a.prototype._getShape=function(r,e){return this.canvas.getShape(r.x,r.y,e)},a.prototype._getPointInfo=function(r){var e=this.canvas,n=e.getClientByEvent(r),o=e.getPointByEvent(r);return{x:o.x,y:o.y,clientX:n.x,clientY:n.y}},a.prototype._triggerEvent=function(r,e){var n=this._getPointInfo(e),o=this._getShape(n,e),s=this["_on"+r],l=!1;if(s)s.call(this,n,o,e);else{var c=this.currentShape;r==="mouseenter"||r==="dragenter"||r==="mouseover"?(this._emitEvent(r,e,n,null,null,o),o&&this._emitEvent(r,e,n,o,null,o),r==="mouseenter"&&this.draggingShape&&this._emitEvent("dragenter",e,n,null)):r==="mouseleave"||r==="dragleave"||r==="mouseout"?(l=!0,c&&this._emitEvent(r,e,n,c,c,null),this._emitEvent(r,e,n,null,c,null),r==="mouseleave"&&this.draggingShape&&this._emitEvent("dragleave",e,n,null)):this._emitEvent(r,e,n,o,null,null)}if(l||(this.currentShape=o),o&&!o.get("destroyed")){var u=this.canvas,f=u.get("el");f.style.cursor=o.attr("cursor")||u.get("cursor")}},a.prototype._onmousedown=function(r,e,n){n.button===LEFT_BTN_CODE&&(this.mousedownShape=e,this.mousedownPoint=r,this.mousedownTimeStamp=n.timeStamp),this._emitEvent("mousedown",n,r,e,null,null)},a.prototype._emitMouseoverEvents=function(r,e,n,o){var s=this.canvas.get("el");n!==o&&(n&&(this._emitEvent("mouseout",r,e,n,n,o),this._emitEvent("mouseleave",r,e,n,n,o),(!o||o.get("destroyed"))&&(s.style.cursor=this.canvas.get("cursor"))),o&&(this._emitEvent("mouseover",r,e,o,n,o),this._emitEvent("mouseenter",r,e,o,n,o)))},a.prototype._emitDragoverEvents=function(r,e,n,o,s){o?(o!==n&&(n&&this._emitEvent("dragleave",r,e,n,n,o),this._emitEvent("dragenter",r,e,o,n,o)),s||this._emitEvent("dragover",r,e,o)):n&&this._emitEvent("dragleave",r,e,n,n,o),s&&this._emitEvent("dragover",r,e,o)},a.prototype._afterDrag=function(r,e,n){r&&(r.set("capture",!0),this.draggingShape=null),this.dragging=!1;var o=this._getShape(e,n);o!==r&&this._emitMouseoverEvents(n,e,r,o),this.currentShape=o},a.prototype._onmouseup=function(r,e,n){if(n.button===LEFT_BTN_CODE){var o=this.draggingShape;this.dragging?(o&&this._emitEvent("drop",n,r,e),this._emitEvent("dragend",n,r,o),this._afterDrag(o,r,n)):(this._emitEvent("mouseup",n,r,e),e===this.mousedownShape&&this._emitEvent("click",n,r,e),this.mousedownShape=null,this.mousedownPoint=null)}},a.prototype._ondragover=function(r,e,n){n.preventDefault();var o=this.currentShape;this._emitDragoverEvents(n,r,o,e,!0)},a.prototype._onmousemove=function(r,e,n){var o=this.canvas,s=this.currentShape,l=this.draggingShape;if(this.dragging)l&&this._emitDragoverEvents(n,r,s,e,!1),this._emitEvent("drag",n,r,l);else{var c=this.mousedownPoint;if(c){var u=this.mousedownShape,f=n.timeStamp,d=f-this.mousedownTimeStamp,g=c.clientX-r.clientX,p=c.clientY-r.clientY,v=g*g+p*p;d>120||v>CLICK_OFFSET?u&&u.get("draggable")?(l=this.mousedownShape,l.set("capture",!1),this.draggingShape=l,this.dragging=!0,this._emitEvent("dragstart",n,r,l),this.mousedownShape=null,this.mousedownPoint=null):!u&&o.get("draggable")?(this.dragging=!0,this._emitEvent("dragstart",n,r,null),this.mousedownShape=null,this.mousedownPoint=null):(this._emitMouseoverEvents(n,r,s,e),this._emitEvent("mousemove",n,r,e)):(this._emitMouseoverEvents(n,r,s,e),this._emitEvent("mousemove",n,r,e))}else this._emitMouseoverEvents(n,r,s,e),this._emitEvent("mousemove",n,r,e)}},a.prototype._emitEvent=function(r,e,n,o,s,l){var c=this._getEventObj(r,e,n,o,s,l);if(o){c.shape=o,emitTargetEvent(o,r,c);for(var u=o.getParent();u;)u.emitDelegation(r,c),c.propagationStopped||bubbleEvent(u,r,c),c.propagationPath.push(u),u=u.getParent()}else{var f=this.canvas;emitTargetEvent(f,r,c)}},a.prototype.destroy=function(){this._clearEvents(),this.canvas=null,this.currentShape=null,this.draggingShape=null,this.mousedownPoint=null,this.mousedownShape=null,this.mousedownTimeStamp=null},a}(),PX_SUFFIX="px",browser=detect(),isFirefox=browser&&browser.name==="firefox",Canvas$2=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;return n.initContainer(),n.initDom(),n.initEvents(),n.initTimeline(),n}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return e.cursor="default",e.supportCSSTransform=!1,e},r.prototype.initContainer=function(){var e=this.get("container");isString$1(e)&&(e=document.getElementById(e),this.set("container",e))},r.prototype.initDom=function(){var e=this.createDom();this.set("el",e);var n=this.get("container");n.appendChild(e),this.setDOMSize(this.get("width"),this.get("height"))},r.prototype.initEvents=function(){var e=new EventController({canvas:this});e.init(),this.set("eventController",e)},r.prototype.initTimeline=function(){var e=new Timeline(this);this.set("timeline",e)},r.prototype.setDOMSize=function(e,n){var o=this.get("el");isBrowser&&(o.style.width=e+PX_SUFFIX,o.style.height=n+PX_SUFFIX)},r.prototype.changeSize=function(e,n){this.setDOMSize(e,n),this.set("width",e),this.set("height",n),this.onCanvasChange("changeSize")},r.prototype.getRenderer=function(){return this.get("renderer")},r.prototype.getCursor=function(){return this.get("cursor")},r.prototype.setCursor=function(e){this.set("cursor",e);var n=this.get("el");isBrowser&&n&&(n.style.cursor=e)},r.prototype.getPointByEvent=function(e){var n=this.get("supportCSSTransform");if(n){if(isFirefox&&!isNil(e.layerX)&&e.layerX!==e.offsetX)return{x:e.layerX,y:e.layerY};if(!isNil(e.offsetX))return{x:e.offsetX,y:e.offsetY}}var o=this.getClientByEvent(e),s=o.x,l=o.y;return this.getPointByClient(s,l)},r.prototype.getClientByEvent=function(e){var n=e;return e.touches&&(e.type==="touchend"?n=e.changedTouches[0]:n=e.touches[0]),{x:n.clientX,y:n.clientY}},r.prototype.getPointByClient=function(e,n){var o=this.get("el"),s=o.getBoundingClientRect();return{x:e-s.left,y:n-s.top}},r.prototype.getClientByPoint=function(e,n){var o=this.get("el"),s=o.getBoundingClientRect();return{x:e+s.left,y:n+s.top}},r.prototype.draw=function(){},r.prototype.removeDom=function(){var e=this.get("el");e.parentNode.removeChild(e)},r.prototype.clearEvents=function(){var e=this.get("eventController");e.destroy()},r.prototype.isCanvas=function(){return!0},r.prototype.getParent=function(){return null},r.prototype.destroy=function(){var e=this.get("timeline");this.get("destroyed")||(this.clear(),e&&e.stop(),this.clearEvents(),this.removeDom(),a.prototype.destroy.call(this))},r}(Container),AbstractGroup=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.isGroup=function(){return!0},r.prototype.isEntityGroup=function(){return!1},r.prototype.clone=function(){for(var e=a.prototype.clone.call(this),n=this.getChildren(),o=0;o<n.length;o++){var s=n[o];e.add(s.clone())}return e},r}(Container),AbstractShape=function(a){__extends$7(r,a);function r(e){return a.call(this,e)||this}return r.prototype._isInBBox=function(e,n){var o=this.getBBox();return o.minX<=e&&o.maxX>=e&&o.minY<=n&&o.maxY>=n},r.prototype.afterAttrsChange=function(e){a.prototype.afterAttrsChange.call(this,e),this.clearCacheBBox()},r.prototype.getBBox=function(){var e=this.cfg.bbox;return e||(e=this.calculateBBox(),this.set("bbox",e)),e},r.prototype.getCanvasBBox=function(){var e=this.cfg.canvasBBox;return e||(e=this.calculateCanvasBBox(),this.set("canvasBBox",e)),e},r.prototype.applyMatrix=function(e){a.prototype.applyMatrix.call(this,e),this.set("canvasBBox",null)},r.prototype.calculateCanvasBBox=function(){var e=this.getBBox(),n=this.getTotalMatrix(),o=e.minX,s=e.minY,l=e.maxX,c=e.maxY;if(n){var u=multiplyVec2$1(n,[e.minX,e.minY]),f=multiplyVec2$1(n,[e.maxX,e.minY]),d=multiplyVec2$1(n,[e.minX,e.maxY]),g=multiplyVec2$1(n,[e.maxX,e.maxY]);o=Math.min(u[0],f[0],d[0],g[0]),l=Math.max(u[0],f[0],d[0],g[0]),s=Math.min(u[1],f[1],d[1],g[1]),c=Math.max(u[1],f[1],d[1],g[1])}var p=this.attrs;if(p.shadowColor){var v=p.shadowBlur,m=v===void 0?0:v,y=p.shadowOffsetX,x=y===void 0?0:y,_=p.shadowOffsetY,E=_===void 0?0:_,S=o-m+x,A=l+m+x,T=s-m+E,b=c+m+E;o=Math.min(o,S),l=Math.max(l,A),s=Math.min(s,T),c=Math.max(c,b)}return{x:o,y:s,minX:o,minY:s,maxX:l,maxY:c,width:l-o,height:c-s}},r.prototype.clearCacheBBox=function(){this.set("bbox",null),this.set("canvasBBox",null)},r.prototype.isClipShape=function(){return this.get("isClipShape")},r.prototype.isInShape=function(e,n){return!1},r.prototype.isOnlyHitBox=function(){return!1},r.prototype.isHit=function(e,n){var o=this.get("startArrowShape"),s=this.get("endArrowShape"),l=[e,n,1];l=this.invertFromMatrix(l);var c=l[0],u=l[1],f=this._isInBBox(c,u);return this.isOnlyHitBox()?f:!!(f&&!this.isClipped(c,u)&&(this.isInShape(c,u)||o&&o.isHit(c,u)||s&&s.isHit(c,u)))},r}(Element$2),cache$1=new Map;function register(a,r){cache$1.set(a,r)}function getMethod(a){return cache$1.get(a)}function rect$1(a){var r=a.attr(),e=r.x,n=r.y,o=r.width,s=r.height;return{x:e,y:n,width:o,height:s}}function circle$1(a){var r=a.attr(),e=r.x,n=r.y,o=r.r;return{x:e-o,y:n-o,width:o*2,height:o*2}}function distance$5(a,r,e,n){var o=a-e,s=r-n;return Math.sqrt(o*o+s*s)}function isNumberEqual(a,r){return Math.abs(a-r)<.001}function getBBoxByArray(a,r){var e=min$2(a),n=min$2(r),o=max$2(a),s=max$2(r);return{x:e,y:n,width:o-e,height:s-n}}function piMod(a){return(a+Math.PI*2)%(Math.PI*2)}const LineUtil={box:function(a,r,e,n){return getBBoxByArray([a,e],[r,n])},length:function(a,r,e,n){return distance$5(a,r,e,n)},pointAt:function(a,r,e,n,o){return{x:(1-o)*a+o*e,y:(1-o)*r+o*n}},pointDistance:function(a,r,e,n,o,s){var l=(e-a)*(o-a)+(n-r)*(s-r);if(l<0)return distance$5(a,r,o,s);var c=(e-a)*(e-a)+(n-r)*(n-r);return l>c?distance$5(e,n,o,s):this.pointToLine(a,r,e,n,o,s)},pointToLine:function(a,r,e,n,o,s){var l=[e-a,n-r];if(exactEquals(l,[0,0]))return Math.sqrt((o-a)*(o-a)+(s-r)*(s-r));var c=[-l[1],l[0]];normalize(c,c);var u=[o-a,s-r];return Math.abs(dot$3(u,c))},tangentAngle:function(a,r,e,n){return Math.atan2(n-r,e-a)}};var EPSILON=1e-4;function nearestPoint(a,r,e,n,o,s){var l,c=1/0,u=[e,n],f=20;s&&s>200&&(f=s/10);for(var d=1/f,g=d/10,p=0;p<=f;p++){var v=p*d,m=[o.apply(null,a.concat([v])),o.apply(null,r.concat([v]))],y=distance$5(u[0],u[1],m[0],m[1]);y<c&&(l=v,c=y)}if(l===0)return{x:a[0],y:r[0]};if(l===1){var x=a.length;return{x:a[x-1],y:r[x-1]}}c=1/0;for(var p=0;p<32&&!(g<EPSILON);p++){var _=l-g,E=l+g,m=[o.apply(null,a.concat([_])),o.apply(null,r.concat([_]))],y=distance$5(u[0],u[1],m[0],m[1]);if(_>=0&&y<c)l=_,c=y;else{var S=[o.apply(null,a.concat([E])),o.apply(null,r.concat([E]))],A=distance$5(u[0],u[1],S[0],S[1]);E<=1&&A<c?(l=E,c=A):g*=.5}}return{x:o.apply(null,a.concat([l])),y:o.apply(null,r.concat([l]))}}function snapLength(a,r){for(var e=0,n=a.length,o=0;o<n;o++){var s=a[o],l=r[o],c=a[(o+1)%n],u=r[(o+1)%n];e+=distance$5(s,l,c,u)}return e/2}function quadraticAt(a,r,e,n){var o=1-n;return o*o*a+2*n*o*r+n*n*e}function extrema$1(a,r,e){var n=a+e-2*r;if(isNumberEqual(n,0))return[.5];var o=(a-r)/n;return o<=1&&o>=0?[o]:[]}function derivativeAt$1(a,r,e,n){return 2*(1-n)*(r-a)+2*n*(e-r)}function divideQuadratic(a,r,e,n,o,s,l){var c=quadraticAt(a,e,o,l),u=quadraticAt(r,n,s,l),f=LineUtil.pointAt(a,r,e,n,l),d=LineUtil.pointAt(e,n,o,s,l);return[[a,r,f.x,f.y,c,u],[c,u,d.x,d.y,o,s]]}function quadraticLength(a,r,e,n,o,s,l){if(l===0)return(distance$5(a,r,e,n)+distance$5(e,n,o,s)+distance$5(a,r,o,s))/2;var c=divideQuadratic(a,r,e,n,o,s,.5),u=c[0],f=c[1];return u.push(l-1),f.push(l-1),quadraticLength.apply(null,u)+quadraticLength.apply(null,f)}const QuadUtil={box:function(a,r,e,n,o,s){var l=extrema$1(a,e,o)[0],c=extrema$1(r,n,s)[0],u=[a,o],f=[r,s];return l!==void 0&&u.push(quadraticAt(a,e,o,l)),c!==void 0&&f.push(quadraticAt(r,n,s,c)),getBBoxByArray(u,f)},length:function(a,r,e,n,o,s){return quadraticLength(a,r,e,n,o,s,3)},nearestPoint:function(a,r,e,n,o,s,l,c){return nearestPoint([a,e,o],[r,n,s],l,c,quadraticAt)},pointDistance:function(a,r,e,n,o,s,l,c){var u=this.nearestPoint(a,r,e,n,o,s,l,c);return distance$5(u.x,u.y,l,c)},interpolationAt:quadraticAt,pointAt:function(a,r,e,n,o,s,l){return{x:quadraticAt(a,e,o,l),y:quadraticAt(r,n,s,l)}},divide:function(a,r,e,n,o,s,l){return divideQuadratic(a,r,e,n,o,s,l)},tangentAngle:function(a,r,e,n,o,s,l){var c=derivativeAt$1(a,e,o,l),u=derivativeAt$1(r,n,s,l),f=Math.atan2(u,c);return piMod(f)}};function cubicAt(a,r,e,n,o){var s=1-o;return s*s*s*a+3*r*o*s*s+3*e*o*o*s+n*o*o*o}function derivativeAt(a,r,e,n,o){var s=1-o;return 3*(s*s*(r-a)+2*s*o*(e-r)+o*o*(n-e))}function extrema(a,r,e,n){var o=-3*a+9*r-9*e+3*n,s=6*a-12*r+6*e,l=3*r-3*a,c=[],u,f,d;if(isNumberEqual(o,0))isNumberEqual(s,0)||(u=-l/s,u>=0&&u<=1&&c.push(u));else{var g=s*s-4*o*l;isNumberEqual(g,0)?c.push(-s/(2*o)):g>0&&(d=Math.sqrt(g),u=(-s+d)/(2*o),f=(-s-d)/(2*o),u>=0&&u<=1&&c.push(u),f>=0&&f<=1&&c.push(f))}return c}function divideCubic(a,r,e,n,o,s,l,c,u){var f=cubicAt(a,e,o,l,u),d=cubicAt(r,n,s,c,u),g=LineUtil.pointAt(a,r,e,n,u),p=LineUtil.pointAt(e,n,o,s,u),v=LineUtil.pointAt(o,s,l,c,u),m=LineUtil.pointAt(g.x,g.y,p.x,p.y,u),y=LineUtil.pointAt(p.x,p.y,v.x,v.y,u);return[[a,r,g.x,g.y,m.x,m.y,f,d],[f,d,y.x,y.y,v.x,v.y,l,c]]}function cubicLength(a,r,e,n,o,s,l,c,u){if(u===0)return snapLength([a,e,o,l],[r,n,s,c]);var f=divideCubic(a,r,e,n,o,s,l,c,.5),d=f[0],g=f[1];return d.push(u-1),g.push(u-1),cubicLength.apply(null,d)+cubicLength.apply(null,g)}const CubicUtil={extrema,box:function(a,r,e,n,o,s,l,c){for(var u=[a,l],f=[r,c],d=extrema(a,e,o,l),g=extrema(r,n,s,c),p=0;p<d.length;p++)u.push(cubicAt(a,e,o,l,d[p]));for(var p=0;p<g.length;p++)f.push(cubicAt(r,n,s,c,g[p]));return getBBoxByArray(u,f)},length:function(a,r,e,n,o,s,l,c){return cubicLength(a,r,e,n,o,s,l,c,3)},nearestPoint:function(a,r,e,n,o,s,l,c,u,f,d){return nearestPoint([a,e,o,l],[r,n,s,c],u,f,cubicAt,d)},pointDistance:function(a,r,e,n,o,s,l,c,u,f,d){var g=this.nearestPoint(a,r,e,n,o,s,l,c,u,f,d);return distance$5(g.x,g.y,u,f)},interpolationAt:cubicAt,pointAt:function(a,r,e,n,o,s,l,c,u){return{x:cubicAt(a,e,o,l,u),y:cubicAt(r,n,s,c,u)}},divide:function(a,r,e,n,o,s,l,c,u){return divideCubic(a,r,e,n,o,s,l,c,u)},tangentAngle:function(a,r,e,n,o,s,l,c,u){var f=derivativeAt(a,e,o,l,u),d=derivativeAt(r,n,s,c,u);return piMod(Math.atan2(d,f))}};function copysign(a,r){var e=Math.abs(a);return r>0?e:e*-1}const ellipse$1={box:function(a,r,e,n){return{x:a-e,y:r-n,width:e*2,height:n*2}},length:function(a,r,e,n){return Math.PI*(3*(e+n)-Math.sqrt((3*e+n)*(e+3*n)))},nearestPoint:function(a,r,e,n,o,s){var l=e,c=n;if(l===0||c===0)return{x:a,y:r};for(var u=o-a,f=s-r,d=Math.abs(u),g=Math.abs(f),p=l*l,v=c*c,m=Math.PI/4,y,x,_=0;_<4;_++){y=l*Math.cos(m),x=c*Math.sin(m);var E=(p-v)*Math.pow(Math.cos(m),3)/l,S=(v-p)*Math.pow(Math.sin(m),3)/c,A=y-E,T=x-S,b=d-E,C=g-S,L=Math.hypot(T,A),R=Math.hypot(C,b),I=L*Math.asin((A*C-T*b)/(L*R)),w=I/Math.sqrt(p+v-y*y-x*x);m+=w,m=Math.min(Math.PI/2,Math.max(0,m))}return{x:a+copysign(y,u),y:r+copysign(x,f)}},pointDistance:function(a,r,e,n,o,s){var l=this.nearestPoint(a,r,e,n,o,s);return distance$5(l.x,l.y,o,s)},pointAt:function(a,r,e,n,o){var s=2*Math.PI*o;return{x:a+e*Math.cos(s),y:r+n*Math.sin(s)}},tangentAngle:function(a,r,e,n,o){var s=2*Math.PI*o,l=Math.atan2(n*Math.cos(s),-e*Math.sin(s));return piMod(l)}};function derivativeXAt(a,r,e,n,o,s,l,c){return-1*e*Math.cos(o)*Math.sin(c)-n*Math.sin(o)*Math.cos(c)}function derivativeYAt(a,r,e,n,o,s,l,c){return-1*e*Math.sin(o)*Math.sin(c)+n*Math.cos(o)*Math.cos(c)}function xExtrema(a,r,e){return Math.atan(-r/a*Math.tan(e))}function yExtrema(a,r,e){return Math.atan(r/(a*Math.tan(e)))}function xAt(a,r,e,n,o,s){return e*Math.cos(o)*Math.cos(s)-n*Math.sin(o)*Math.sin(s)+a}function yAt(a,r,e,n,o,s){return e*Math.sin(o)*Math.cos(s)+n*Math.cos(o)*Math.sin(s)+r}function getAngle$2(a,r,e,n){var o=Math.atan2(n*a,e*r);return(o+Math.PI*2)%(Math.PI*2)}function getPoint(a,r,e){return{x:a*Math.cos(e),y:r*Math.sin(e)}}function rotate$2(a,r,e){var n=Math.cos(e),o=Math.sin(e);return[a*n-r*o,a*o+r*n]}const EllipseArcUtil={box:function(a,r,e,n,o,s,l){for(var c=xExtrema(e,n,o),u=1/0,f=-1/0,d=[s,l],g=-Math.PI*2;g<=Math.PI*2;g+=Math.PI){var p=c+g;s<l?s<p&&p<l&&d.push(p):l<p&&p<s&&d.push(p)}for(var g=0;g<d.length;g++){var v=xAt(a,r,e,n,o,d[g]);v<u&&(u=v),v>f&&(f=v)}for(var m=yExtrema(e,n,o),y=1/0,x=-1/0,_=[s,l],g=-Math.PI*2;g<=Math.PI*2;g+=Math.PI){var E=m+g;s<l?s<E&&E<l&&_.push(E):l<E&&E<s&&_.push(E)}for(var g=0;g<_.length;g++){var S=yAt(a,r,e,n,o,_[g]);S<y&&(y=S),S>x&&(x=S)}return{x:u,y,width:f-u,height:x-y}},length:function(a,r,e,n,o,s,l){},nearestPoint:function(a,r,e,n,o,s,l,c,u){var f=rotate$2(c-a,u-r,-o),d=f[0],g=f[1],p=ellipse$1.nearestPoint(0,0,e,n,d,g),v=getAngle$2(e,n,p.x,p.y);v<s?p=getPoint(e,n,s):v>l&&(p=getPoint(e,n,l));var m=rotate$2(p.x,p.y,o);return{x:m[0]+a,y:m[1]+r}},pointDistance:function(a,r,e,n,o,s,l,c,u){var f=this.nearestPoint(a,r,e,n,c,u);return distance$5(f.x,f.y,c,u)},pointAt:function(a,r,e,n,o,s,l,c){var u=(l-s)*c+s;return{x:xAt(a,r,e,n,o,u),y:yAt(a,r,e,n,o,u)}},tangentAngle:function(a,r,e,n,o,s,l,c){var u=(l-s)*c+s,f=derivativeXAt(a,r,e,n,o,s,l,u),d=derivativeYAt(a,r,e,n,o,s,l,u);return piMod(Math.atan2(d,f))}};function analyzePoints(a){for(var r=0,e=[],n=0;n<a.length-1;n++){var o=a[n],s=a[n+1],l=distance$5(o[0],o[1],s[0],s[1]),c={from:o,to:s,length:l};e.push(c),r+=l}return{segments:e,totalLength:r}}function lengthOfSegment(a){if(a.length<2)return 0;for(var r=0,e=0;e<a.length-1;e++){var n=a[e],o=a[e+1];r+=distance$5(n[0],n[1],o[0],o[1])}return r}function pointAtSegments(a,r){if(r>1||r<0||a.length<2)return null;var e=analyzePoints(a),n=e.segments,o=e.totalLength;if(o===0)return{x:a[0][0],y:a[0][1]};for(var s=0,l=null,c=0;c<n.length;c++){var u=n[c],f=u.from,d=u.to,g=u.length/o;if(r>=s&&r<=s+g){var p=(r-s)/g;l=LineUtil.pointAt(f[0],f[1],d[0],d[1],p);break}s+=g}return l}function angleAtSegments(a,r){if(r>1||r<0||a.length<2)return 0;for(var e=analyzePoints(a),n=e.segments,o=e.totalLength,s=0,l=0,c=0;c<n.length;c++){var u=n[c],f=u.from,d=u.to,g=u.length/o;if(r>=s&&r<=s+g){l=Math.atan2(d[1]-f[1],d[0]-f[0]);break}s+=g}return l}function distanceAtSegment(a,r,e){for(var n=1/0,o=0;o<a.length-1;o++){var s=a[o],l=a[o+1],c=LineUtil.pointDistance(s[0],s[1],l[0],l[1],r,e);c<n&&(n=c)}return n}const PolylineUtil={box:function(a){for(var r=[],e=[],n=0;n<a.length;n++){var o=a[n];r.push(o[0]),e.push(o[1])}return getBBoxByArray(r,e)},length:function(a){return lengthOfSegment(a)},pointAt:function(a,r){return pointAtSegments(a,r)},pointDistance:function(a,r,e){return distanceAtSegment(a,r,e)},tangentAngle:function(a,r){return angleAtSegments(a,r)}};function mergeBBox(a,r){return!a||!r?a||r:{minX:Math.min(a.minX,r.minX),minY:Math.min(a.minY,r.minY),maxX:Math.max(a.maxX,r.maxX),maxY:Math.max(a.maxY,r.maxY)}}function mergeArrowBBox(a,r){var e=a.get("startArrowShape"),n=a.get("endArrowShape"),o=null,s=null;return e&&(o=e.getCanvasBBox(),r=mergeBBox(r,o)),n&&(s=n.getCanvasBBox(),r=mergeBBox(r,s)),r}function polyline(a){for(var r=a.attr(),e=r.points,n=[],o=[],s=0;s<e.length;s++){var l=e[s];n.push(l[0]),o.push(l[1])}var c=getBBoxByArray(n,o),u=c.x,f=c.y,d=c.width,g=c.height,p={minX:u,minY:f,maxX:u+d,maxY:f+g};return p=mergeArrowBBox(a,p),{x:p.minX,y:p.minY,width:p.maxX-p.minX,height:p.maxY-p.minY}}function polygon$1(a){for(var r=a.attr(),e=r.points,n=[],o=[],s=0;s<e.length;s++){var l=e[s];n.push(l[0]),o.push(l[1])}return getBBoxByArray(n,o)}var offScreenCtx=null;function getOffScreenContext(){if(!offScreenCtx){var a=document.createElement("canvas");a.width=1,a.height=1,offScreenCtx=a.getContext("2d")}return offScreenCtx}function getTextHeight(a,r,e){var n=1;if(isString$1(a)&&(n=a.split(`
`).length),n>1){var o=getLineSpaceing(r,e);return r*n+o*(n-1)}return r}function getLineSpaceing(a,r){return r?r-a:a*.14}function getTextWidth(a,r){var e=getOffScreenContext(),n=0;if(isNil(a)||a==="")return n;if(e.save(),e.font=r,isString$1(a)&&a.includes(`
`)){var o=a.split(`
`);each$1(o,function(s){var l=e.measureText(s).width;n<l&&(n=l)})}else n=e.measureText(a).width;return e.restore(),n}function assembleFont(a){var r=a.fontSize,e=a.fontFamily,n=a.fontWeight,o=a.fontStyle,s=a.fontVariant;return[o,s,n,r+"px",e].join(" ").trim()}function text(a){var r=a.attr(),e=r.x,n=r.y,o=r.text,s=r.fontSize,l=r.lineHeight,c=r.font;c||(c=assembleFont(r));var u=getTextWidth(o,c),f;if(!u)f={x:e,y:n,width:0,height:0};else{var d=r.textAlign,g=r.textBaseline,p=getTextHeight(o,s,l),v={x:e,y:n-p};d&&(d==="end"||d==="right"?v.x-=u:d==="center"&&(v.x-=u/2)),g&&(g==="top"?v.y+=p:g==="middle"&&(v.y+=p/2)),f={x:v.x,y:v.y,width:u,height:p}}return f}var regexTags=/[MLHVQTCSAZ]([^MLHVQTCSAZ]*)/ig,regexDot=/[^\s\,]+/ig;function parsePath(a){var r=a||[];if(isArray$4(r))return r;if(isString$1(r))return r=r.match(regexTags),each$1(r,function(e,n){if(e=e.match(regexDot),e[0].length>1){var o=e[0].charAt(0);e.splice(1,0,e[0].substr(1)),e[0]=o}each$1(e,function(s,l){isNaN(s)||(e[l]=+s)}),r[n]=e}),r}function smoothBezier$2(a,r,e,n){var o=[],s=!!n,l,c,u,f,d,g,p;if(s){u=n[0],f=n[1];for(var v=0,m=a.length;v<m;v+=1){var y=a[v];u=min$1([0,0],u,y),f=max$1([0,0],f,y)}}for(var v=0,x=a.length;v<x;v+=1){var y=a[v];if(v===0&&!e)p=y;else if(v===x-1&&!e)g=y,o.push(p),o.push(g);else{var _=[v?v-1:x-1,v-1][e?0:1];l=a[_],c=a[e?(v+1)%x:v+1];var E=[0,0];E=sub(E,c,l),E=scale$3(E,E,r);var S=distance$6(y,l),A=distance$6(y,c),T=S+A;T!==0&&(S/=T,A/=T);var b=scale$3([0,0],E,-S),C=scale$3([0,0],E,A);g=add$1([0,0],y,b),d=add$1([0,0],y,C),d=min$1([0,0],d,max$1([0,0],c,y)),d=max$1([0,0],d,min$1([0,0],c,y)),b=sub([0,0],d,y),b=scale$3([0,0],b,-S/A),g=add$1([0,0],y,b),g=min$1([0,0],g,max$1([0,0],l,y)),g=max$1([0,0],g,min$1([0,0],l,y)),C=sub([0,0],y,g),C=scale$3([0,0],C,A/S),d=add$1([0,0],y,C),s&&(g=max$1([0,0],g,u),g=min$1([0,0],g,f),d=max$1([0,0],d,u),d=min$1([0,0],d,f)),o.push(p),o.push(g),p=d}}return e&&o.push(o.shift()),o}function catmullRom2Bezier(a,r,e){r===void 0&&(r=!1),e===void 0&&(e=[[0,0],[1,1]]);for(var n=!!r,o=[],s=0,l=a.length;s<l;s+=2)o.push([a[s],a[s+1]]);for(var c=smoothBezier$2(o,.4,n,e),u=o.length,f=[],d,g,p,s=0;s<u-1;s+=1)d=c[s*2],g=c[s*2+1],p=o[s+1],f.push(["C",d[0],d[1],g[0],g[1],p[0],p[1]]);return n&&(d=c[u],g=c[u+1],p=o[0],f.push(["C",d[0],d[1],g[0],g[1],p[0],p[1]])),f}var SPACES$1=`	
\v\f\r   ᠎             　\u2028\u2029`,PATH_COMMAND$1=new RegExp("([a-z])["+SPACES$1+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+SPACES$1+"]*,?["+SPACES$1+"]*)+)","ig"),PATH_VALUES$1=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+SPACES$1+"]*,?["+SPACES$1+"]*","ig");function parsePathString$1(a){if(!a)return null;if(isArray$4(a))return a;var r={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(a).replace(PATH_COMMAND$1,function(n,o,s){var l=[],c=o.toLowerCase();if(s.replace(PATH_VALUES$1,function(u,f){f&&l.push(+f)}),c==="m"&&l.length>2&&(e.push([o].concat(l.splice(0,2))),c="l",o=o==="m"?"l":"L"),c==="o"&&l.length===1&&e.push([o,l[0]]),c==="r")e.push([o].concat(l));else for(;l.length>=r[c]&&(e.push([o].concat(l.splice(0,r[c]))),!!r[c]););return""}),e}var REGEX_MD=/[a-z]/;function toSymmetry$1(a,r){return[r[0]+(r[0]-a[0]),r[1]+(r[1]-a[1])]}function pathToAbsolute(a){var r=parsePathString$1(a);if(!r||!r.length)return[["M",0,0]];for(var e=!1,n=0;n<r.length;n++){var o=r[n][0];if(REGEX_MD.test(o)||["V","H","T","S"].indexOf(o)>=0){e=!0;break}}if(!e)return r;var s=[],l=0,c=0,u=0,f=0,d=0,g=r[0];(g[0]==="M"||g[0]==="m")&&(l=+g[1],c=+g[2],u=l,f=c,d++,s[0]=["M",l,c]);for(var n=d,p=r.length;n<p;n++){var v=r[n],m=s[n-1],y=[],o=v[0],x=o.toUpperCase();if(o!==x)switch(y[0]=x,x){case"A":y[1]=v[1],y[2]=v[2],y[3]=v[3],y[4]=v[4],y[5]=v[5],y[6]=+v[6]+l,y[7]=+v[7]+c;break;case"V":y[1]=+v[1]+c;break;case"H":y[1]=+v[1]+l;break;case"M":u=+v[1]+l,f=+v[2]+c,y[1]=u,y[2]=f;break;default:for(var _=1,E=v.length;_<E;_++)y[_]=+v[_]+(_%2?l:c)}else y=r[n];switch(x){case"Z":l=+u,c=+f;break;case"H":l=y[1],y=["L",l,c];break;case"V":c=y[1],y=["L",l,c];break;case"T":l=y[1],c=y[2];var S=toSymmetry$1([m[1],m[2]],[m[3],m[4]]);y=["Q",S[0],S[1],l,c];break;case"S":l=y[y.length-2],c=y[y.length-1];var A=m.length,T=toSymmetry$1([m[A-4],m[A-3]],[m[A-2],m[A-1]]);y=["C",T[0],T[1],y[1],y[2],l,c];break;case"M":u=y[y.length-2],f=y[y.length-1];break;default:l=y[y.length-2],c=y[y.length-1]}s.push(y)}return s}function vMag$1(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function vRatio$1(a,r){return vMag$1(a)*vMag$1(r)?(a[0]*r[0]+a[1]*r[1])/(vMag$1(a)*vMag$1(r)):1}function vAngle$1(a,r){return(a[0]*r[1]<a[1]*r[0]?-1:1)*Math.acos(vRatio$1(a,r))}function isSamePoint$2(a,r){return a[0]===r[0]&&a[1]===r[1]}function getArcParams$1(a,r){var e=r[1],n=r[2],o=mod$1(toRadian(r[3]),Math.PI*2),s=r[4],l=r[5],c=a[0],u=a[1],f=r[6],d=r[7],g=Math.cos(o)*(c-f)/2+Math.sin(o)*(u-d)/2,p=-1*Math.sin(o)*(c-f)/2+Math.cos(o)*(u-d)/2,v=g*g/(e*e)+p*p/(n*n);v>1&&(e*=Math.sqrt(v),n*=Math.sqrt(v));var m=e*e*(p*p)+n*n*(g*g),y=m?Math.sqrt((e*e*(n*n)-m)/m):1;s===l&&(y*=-1),isNaN(y)&&(y=0);var x=n?y*e*p/n:0,_=e?y*-n*g/e:0,E=(c+f)/2+Math.cos(o)*x-Math.sin(o)*_,S=(u+d)/2+Math.sin(o)*x+Math.cos(o)*_,A=[(g-x)/e,(p-_)/n],T=[(-1*g-x)/e,(-1*p-_)/n],b=vAngle$1([1,0],A),C=vAngle$1(A,T);return vRatio$1(A,T)<=-1&&(C=Math.PI),vRatio$1(A,T)>=1&&(C=0),l===0&&C>0&&(C=C-2*Math.PI),l===1&&C<0&&(C=C+2*Math.PI),{cx:E,cy:S,rx:isSamePoint$2(a,[f,d])?0:e,ry:isSamePoint$2(a,[f,d])?0:n,startAngle:b,endAngle:b+C,xRotation:o,arcFlag:s,sweepFlag:l}}function toSymmetry(a,r){return[r[0]+(r[0]-a[0]),r[1]+(r[1]-a[1])]}function getSegments(a){a=parsePath(a);for(var r=[],e=null,n=null,o=null,s=0,l=a.length,c=0;c<l;c++){var u=a[c];n=a[c+1];var f=u[0],d={command:f,prePoint:e,params:u,startTangent:null,endTangent:null};switch(f){case"M":o=[u[1],u[2]],s=c;break;case"A":var g=getArcParams$1(e,u);d.arcParams=g;break}if(f==="Z")e=o,n=a[s+1];else{var p=u.length;e=[u[p-2],u[p-1]]}n&&n[0]==="Z"&&(n=a[s],r[s]&&(r[s].prePoint=e)),d.currentPoint=e,r[s]&&isSamePoint$2(e,r[s].currentPoint)&&(r[s].prePoint=d.prePoint);var v=n?[n[n.length-2],n[n.length-1]]:null;d.nextPoint=v;var m=d.prePoint;if(["L","H","V"].includes(f))d.startTangent=[m[0]-e[0],m[1]-e[1]],d.endTangent=[e[0]-m[0],e[1]-m[1]];else if(f==="Q"){var y=[u[1],u[2]];d.startTangent=[m[0]-y[0],m[1]-y[1]],d.endTangent=[e[0]-y[0],e[1]-y[1]]}else if(f==="T"){var x=r[c-1],y=toSymmetry(x.currentPoint,m);x.command==="Q"?(d.command="Q",d.startTangent=[m[0]-y[0],m[1]-y[1]],d.endTangent=[e[0]-y[0],e[1]-y[1]]):(d.command="TL",d.startTangent=[m[0]-e[0],m[1]-e[1]],d.endTangent=[e[0]-m[0],e[1]-m[1]])}else if(f==="C"){var _=[u[1],u[2]],E=[u[3],u[4]];d.startTangent=[m[0]-_[0],m[1]-_[1]],d.endTangent=[e[0]-E[0],e[1]-E[1]],d.startTangent[0]===0&&d.startTangent[1]===0&&(d.startTangent=[_[0]-E[0],_[1]-E[1]]),d.endTangent[0]===0&&d.endTangent[1]===0&&(d.endTangent=[E[0]-_[0],E[1]-_[1]])}else if(f==="S"){var x=r[c-1],_=toSymmetry(x.currentPoint,m),E=[u[1],u[2]];x.command==="C"?(d.command="C",d.startTangent=[m[0]-_[0],m[1]-_[1]],d.endTangent=[e[0]-E[0],e[1]-E[1]]):(d.command="SQ",d.startTangent=[m[0]-E[0],m[1]-E[1]],d.endTangent=[e[0]-E[0],e[1]-E[1]])}else if(f==="A"){var S=.001,A=d.arcParams||{},T=A.cx,b=T===void 0?0:T,C=A.cy,L=C===void 0?0:C,R=A.rx,I=R===void 0?0:R,w=A.ry,M=w===void 0?0:w,D=A.sweepFlag,O=D===void 0?0:D,F=A.startAngle,k=F===void 0?0:F,$=A.endAngle,V=$===void 0?0:$;O===0&&(S*=-1);var N=I*Math.cos(k-S)+b,B=M*Math.sin(k-S)+L;d.startTangent=[N-o[0],B-o[1]];var G=I*Math.cos(k+V+S)+b,z=M*Math.sin(k+V-S)+L;d.endTangent=[m[0]-G,m[1]-z]}r.push(d)}return r}var isBetween$2=function(a,r,e){return a>=r&&a<=e};function getLineIntersect(a,r,e,n){var o=.001,s={x:e.x-a.x,y:e.y-a.y},l={x:r.x-a.x,y:r.y-a.y},c={x:n.x-e.x,y:n.y-e.y},u=l.x*c.y-l.y*c.x,f=u*u,d=l.x*l.x+l.y*l.y,g=c.x*c.x+c.y*c.y,p=null;if(f>o*d*g){var v=(s.x*c.y-s.y*c.x)/u,m=(s.x*l.y-s.y*l.x)/u;isBetween$2(v,0,1)&&isBetween$2(m,0,1)&&(p={x:a.x+v*l.x,y:a.y+v*l.y})}return p}var tolerance$1=1e-6;function dcmp$1(a){return Math.abs(a)<tolerance$1?0:a<0?-1:1}function onSegment$1(a,r,e){return(e[0]-a[0])*(r[1]-a[1])===(r[0]-a[0])*(e[1]-a[1])&&Math.min(a[0],r[0])<=e[0]&&e[0]<=Math.max(a[0],r[0])&&Math.min(a[1],r[1])<=e[1]&&e[1]<=Math.max(a[1],r[1])}function isInPolygon$1(a,r,e){var n=!1,o=a.length;if(o<=2)return!1;for(var s=0;s<o;s++){var l=a[s],c=a[(s+1)%o];if(onSegment$1(l,c,[r,e]))return!0;dcmp$1(l[1]-e)>0!=dcmp$1(c[1]-e)>0&&dcmp$1(r-(e-l[1])*(l[0]-c[0])/(l[1]-c[1])-l[0])<0&&(n=!n)}return n}function parseToLines(a){for(var r=[],e=a.length,n=0;n<e-1;n++){var o=a[n],s=a[n+1];r.push({from:{x:o[0],y:o[1]},to:{x:s[0],y:s[1]}})}if(r.length>1){var l=a[0],c=a[e-1];r.push({from:{x:c[0],y:c[1]},to:{x:l[0],y:l[1]}})}return r}function lineIntersectPolygon(a,r){var e=!1;return each$1(a,function(n){if(getLineIntersect(n.from,n.to,r.from,r.to))return e=!0,!1}),e}function getBBox(a){var r=a.map(function(n){return n[0]}),e=a.map(function(n){return n[1]});return{minX:Math.min.apply(null,r),maxX:Math.max.apply(null,r),minY:Math.min.apply(null,e),maxY:Math.max.apply(null,e)}}function intersectBBox$1(a,r){return!(r.minX>a.maxX||r.maxX<a.minX||r.minY>a.maxY||r.maxY<a.minY)}function isPolygonsIntersect(a,r){if(a.length<2||r.length<2)return!1;var e=getBBox(a),n=getBBox(r);if(!intersectBBox$1(e,n))return!1;var o=!1;if(each$1(r,function(u){if(isInPolygon$1(a,u[0],u[1]))return o=!0,!1}),o||(each$1(a,function(u){if(isInPolygon$1(r,u[0],u[1]))return o=!0,!1}),o))return!0;var s=parseToLines(a),l=parseToLines(r),c=!1;return each$1(l,function(u){if(lineIntersectPolygon(s,u))return c=!0,!1}),c}function getPathBox(a,r){for(var e=[],n=[],o=[],s=0;s<a.length;s++){var l=a[s],c=l.currentPoint,u=l.params,f=l.prePoint,d=void 0;switch(l.command){case"Q":d=QuadUtil.box(f[0],f[1],u[1],u[2],u[3],u[4]);break;case"C":d=CubicUtil.box(f[0],f[1],u[1],u[2],u[3],u[4],u[5],u[6]);break;case"A":var g=l.arcParams;d=EllipseArcUtil.box(g.cx,g.cy,g.rx,g.ry,g.xRotation,g.startAngle,g.endAngle);break;default:e.push(c[0]),n.push(c[1]);break}d&&(l.box=d,e.push(d.x,d.x+d.width),n.push(d.y,d.y+d.height)),r&&(l.command==="L"||l.command==="M")&&l.prePoint&&l.nextPoint&&o.push(l)}e=e.filter(function(_){return!Number.isNaN(_)&&_!==1/0&&_!==-1/0}),n=n.filter(function(_){return!Number.isNaN(_)&&_!==1/0&&_!==-1/0});var p=min$2(e),v=min$2(n),m=max$2(e),y=max$2(n);if(o.length===0)return{x:p,y:v,width:m-p,height:y-v};for(var s=0;s<o.length;s++){var l=o[s],c=l.currentPoint,x=void 0;c[0]===p?(x=getExtraFromSegmentWithAngle(l,r),p=p-x.xExtra):c[0]===m&&(x=getExtraFromSegmentWithAngle(l,r),m=m+x.xExtra),c[1]===v?(x=getExtraFromSegmentWithAngle(l,r),v=v-x.yExtra):c[1]===y&&(x=getExtraFromSegmentWithAngle(l,r),y=y+x.yExtra)}return{x:p,y:v,width:m-p,height:y-v}}function getExtraFromSegmentWithAngle(a,r){var e=a.prePoint,n=a.currentPoint,o=a.nextPoint,s=Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2),l=Math.pow(n[0]-o[0],2)+Math.pow(n[1]-o[1],2),c=Math.pow(e[0]-o[0],2)+Math.pow(e[1]-o[1],2),u=Math.acos((s+l-c)/(2*Math.sqrt(s)*Math.sqrt(l)));if(!u||Math.sin(u)===0||isNumberEqual$1(u,0))return{xExtra:0,yExtra:0};var f=Math.abs(Math.atan2(o[1]-n[1],o[0]-n[0])),d=Math.abs(Math.atan2(o[0]-n[0],o[1]-n[1]));f=f>Math.PI/2?Math.PI-f:f,d=d>Math.PI/2?Math.PI-d:d;var g={xExtra:Math.cos(u/2-f)*(r/2*(1/Math.sin(u/2)))-r/2||0,yExtra:Math.cos(d-u/2)*(r/2*(1/Math.sin(u/2)))-r/2||0};return g}function path(a){var r=a.attr(),e=r.path,n=r.stroke,o=n?r.lineWidth:0,s=a.get("segments")||getSegments(e),l=getPathBox(s,o),c=l.x,u=l.y,f=l.width,d=l.height,g={minX:c,minY:u,maxX:c+f,maxY:u+d};return g=mergeArrowBBox(a,g),{x:g.minX,y:g.minY,width:g.maxX-g.minX,height:g.maxY-g.minY}}function line$1(a){var r=a.attr(),e=r.x1,n=r.y1,o=r.x2,s=r.y2,l=Math.min(e,o),c=Math.max(e,o),u=Math.min(n,s),f=Math.max(n,s),d={minX:l,maxX:c,minY:u,maxY:f};return d=mergeArrowBBox(a,d),{x:d.minX,y:d.minY,width:d.maxX-d.minX,height:d.maxY-d.minY}}function ellipse(a){var r=a.attr(),e=r.x,n=r.y,o=r.rx,s=r.ry;return{x:e-o,y:n-s,width:o*2,height:s*2}}register("rect",rect$1);register("image",rect$1);register("circle",circle$1);register("marker",circle$1);register("polyline",polyline);register("polygon",polygon$1);register("text",text);register("path",path);register("line",line$1);register("ellipse",ellipse);var DEFAULT_Y=0,MARGIN_RATIO=1/2,DODGE_RATIO=1/2,GAP=.05,Adjust=function(){function a(r){var e=r.xField,n=r.yField,o=r.adjustNames,s=o===void 0?["x","y"]:o,l=r.dimValuesMap;this.adjustNames=s,this.xField=e,this.yField=n,this.dimValuesMap=l}return a.prototype.isAdjust=function(r){return this.adjustNames.indexOf(r)>=0},a.prototype.getAdjustRange=function(r,e,n){var o=this.yField,s=n.indexOf(e),l=n.length,c,u;return!o&&this.isAdjust("y")?(c=0,u=1):l>1?(c=n[s===0?0:s-1],u=n[s===l-1?l-1:s+1],s!==0?c+=(e-c)/2:c-=(u-e)/2,s!==l-1?u-=(u-e)/2:u+=(e-n[l-2])/2):(c=e===0?0:e-.5,u=e===0?1:e+.5),{pre:c,next:u}},a.prototype.adjustData=function(r,e){var n=this,o=this.getDimValues(e);each$1(r,function(s,l){each$1(o,function(c,u){n.adjustDim(u,c,s,l)})})},a.prototype.groupData=function(r,e){return each$1(r,function(n){n[e]===void 0&&(n[e]=DEFAULT_Y)}),groupBy(r,e)},a.prototype.adjustDim=function(r,e,n,o){},a.prototype.getDimValues=function(r){var e=this,n=e.xField,o=e.yField,s=mix({},this.dimValuesMap),l=[];if(n&&this.isAdjust("x")&&l.push(n),o&&this.isAdjust("y")&&l.push(o),l.forEach(function(u){s&&s[u]||(s[u]=valuesOfKey(r,u).sort(function(f,d){return f-d}))}),!o&&this.isAdjust("y")){var c="y";s[c]=[DEFAULT_Y,1]}return s},a}(),ADJUST_MAP={},getAdjust=function(a){return ADJUST_MAP[a.toLowerCase()]},registerAdjust=function(a,r){if(getAdjust(a))throw new Error("Adjust type '"+a+"' existed.");ADJUST_MAP[a.toLowerCase()]=r};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$6=function(a,r){return extendStatics$6=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])},extendStatics$6(a,r)};function __extends$6(a,r){extendStatics$6(a,r);function e(){this.constructor=a}a.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}var __assign$7=function(){return __assign$7=Object.assign||function(r){for(var e,n=1,o=arguments.length;n<o;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=e[s])}return r},__assign$7.apply(this,arguments)},Dodge=function(a){__extends$6(r,a);function r(e){var n=a.call(this,e)||this;n.cacheMap={},n.adjustDataArray=[],n.mergeData=[];var o=e.marginRatio,s=o===void 0?MARGIN_RATIO:o,l=e.dodgeRatio,c=l===void 0?DODGE_RATIO:l,u=e.dodgeBy,f=e.intervalPadding,d=e.dodgePadding,g=e.xDimensionLength,p=e.groupNum,v=e.defaultSize,m=e.maxColumnWidth,y=e.minColumnWidth,x=e.columnWidthRatio,_=e.customOffset;return n.marginRatio=s,n.dodgeRatio=c,n.dodgeBy=u,n.intervalPadding=f,n.dodgePadding=d,n.xDimensionLegenth=g,n.groupNum=p,n.defaultSize=v,n.maxColumnWidth=m,n.minColumnWidth=y,n.columnWidthRatio=x,n.customOffset=_,n}return r.prototype.process=function(e){var n=clone(e),o=flatten(n),s=this.dodgeBy,l=s?group$1(o,s):n;return this.cacheMap={},this.adjustDataArray=l,this.mergeData=o,this.adjustData(l,o),this.adjustDataArray=[],this.mergeData=[],n},r.prototype.adjustDim=function(e,n,o,s){var l=this,c=this.customOffset,u=this.getDistribution(e),f=this.groupData(o,e);return each$1(f,function(d,g){var p;n.length===1?p={pre:n[0]-1,next:n[0]+1}:p=l.getAdjustRange(e,parseFloat(g),n),each$1(d,function(v){var m=v[e],y=u[m],x=y.indexOf(s);if(isNil(c))v[e]=l.getDodgeOffset(p,x,y.length);else{var _=p.pre,E=p.next;v[e]=isFunction$1(c)?c(v,p):(_+E)/2+c}})}),[]},r.prototype.getDodgeOffset=function(e,n,o){var s=this,l=s.dodgeRatio,c=s.marginRatio,u=s.intervalPadding,f=s.dodgePadding,d=e.pre,g=e.next,p=g-d,v;if(!isNil(u)&&isNil(f)&&u>=0){var m=this.getIntervalOnlyOffset(o,n);v=d+m}else if(!isNil(f)&&isNil(u)&&f>=0){var m=this.getDodgeOnlyOffset(o,n);v=d+m}else if(!isNil(u)&&!isNil(f)&&u>=0&&f>=0){var m=this.getIntervalAndDodgeOffset(o,n);v=d+m}else{var y=p*l/o,x=c*y,m=1/2*(p-o*y-(o-1)*x)+((n+1)*y+n*x)-1/2*y-1/2*p;v=(d+g)/2+m}return v},r.prototype.getIntervalOnlyOffset=function(e,n){var o=this,s=o.defaultSize,l=o.intervalPadding,c=o.xDimensionLegenth,u=o.groupNum,f=o.dodgeRatio,d=o.maxColumnWidth,g=o.minColumnWidth,p=o.columnWidthRatio,v=l/c,m=(1-(u-1)*v)/u*f/(e-1),y=((1-v*(u-1))/u-m*(e-1))/e;if(y=isNil(p)?y:1/u/e*p,!isNil(d)){var x=d/c;y=Math.min(y,x)}if(!isNil(g)){var _=g/c;y=Math.max(y,_)}y=s?s/c:y,m=((1-(u-1)*v)/u-e*y)/(e-1);var E=((1/2+n)*y+n*m+1/2*v)*u-v/2;return E},r.prototype.getDodgeOnlyOffset=function(e,n){var o=this,s=o.defaultSize,l=o.dodgePadding,c=o.xDimensionLegenth,u=o.groupNum,f=o.marginRatio,d=o.maxColumnWidth,g=o.minColumnWidth,p=o.columnWidthRatio,v=l/c,m=1*f/(u-1),y=((1-m*(u-1))/u-v*(e-1))/e;if(y=p?1/u/e*p:y,!isNil(d)){var x=d/c;y=Math.min(y,x)}if(!isNil(g)){var _=g/c;y=Math.max(y,_)}y=s?s/c:y,m=(1-(y*e+v*(e-1))*u)/(u-1);var E=((1/2+n)*y+n*v+1/2*m)*u-m/2;return E},r.prototype.getIntervalAndDodgeOffset=function(e,n){var o=this,s=o.intervalPadding,l=o.dodgePadding,c=o.xDimensionLegenth,u=o.groupNum,f=s/c,d=l/c,g=((1-f*(u-1))/u-d*(e-1))/e,p=((1/2+n)*g+n*d+1/2*f)*u-f/2;return p},r.prototype.getDistribution=function(e){var n=this.adjustDataArray,o=this.cacheMap,s=o[e];return s||(s={},each$1(n,function(l,c){var u=valuesOfKey(l,e);u.length||u.push(0),each$1(u,function(f){s[f]||(s[f]=[]),s[f].push(c)})}),o[e]=s),s},r}(Adjust);function randomNumber(a,r){return(r-a)*Math.random()+a}var Jitter=function(a){__extends$6(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.process=function(e){var n=clone(e),o=flatten(n);return this.adjustData(n,o),n},r.prototype.adjustDim=function(e,n,o){var s=this,l=this.groupData(o,e);return each$1(l,function(c,u){return s.adjustGroup(c,e,parseFloat(u),n)})},r.prototype.getAdjustOffset=function(e){var n=e.pre,o=e.next,s=(o-n)*GAP;return randomNumber(n+s,o-s)},r.prototype.adjustGroup=function(e,n,o,s){var l=this,c=this.getAdjustRange(n,o,s);return each$1(e,function(u){u[n]=l.getAdjustOffset(c)}),e},r}(Adjust),Cache=default_1,Stack=function(a){__extends$6(r,a);function r(e){var n=a.call(this,e)||this,o=e.adjustNames,s=o===void 0?["y"]:o,l=e.height,c=l===void 0?NaN:l,u=e.size,f=u===void 0?10:u,d=e.reverseOrder,g=d===void 0?!1:d;return n.adjustNames=s,n.height=c,n.size=f,n.reverseOrder=g,n}return r.prototype.process=function(e){var n=this,o=n.yField,s=n.reverseOrder,l=o?this.processStack(e):this.processOneDimStack(e);return s?this.reverse(l):l},r.prototype.reverse=function(e){return e.slice(0).reverse()},r.prototype.processStack=function(e){var n=this,o=n.xField,s=n.yField,l=n.reverseOrder,c=l?this.reverse(e):e,u=new Cache,f=new Cache;return c.map(function(d){return d.map(function(g){var p,v=get(g,o,0),m=get(g,[s]),y=v.toString();if(m=isArray$4(m)?m[1]:m,!isNil(m)){var x=m>=0?u:f;x.has(y)||x.set(y,0);var _=x.get(y),E=m+_;return x.set(y,E),__assign$7(__assign$7({},g),(p={},p[s]=[_,E],p))}return g})})},r.prototype.processOneDimStack=function(e){var n=this,o=this,s=o.xField,l=o.height,c=o.reverseOrder,u="y",f=c?this.reverse(e):e,d=new Cache;return f.map(function(g){return g.map(function(p){var v,m=n.size,y=p[s],x=m*2/l;d.has(y)||d.set(y,x/2);var _=d.get(y);return d.set(y,_+x),__assign$7(__assign$7({},p),(v={},v[u]=_,v))})})},r}(Adjust),Symmetric=function(a){__extends$6(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.process=function(e){var n=flatten(e),o=this,s=o.xField,l=o.yField,c=this.getXValuesMaxMap(n),u=Math.max.apply(Math,Object.keys(c).map(function(f){return c[f]}));return map$2(e,function(f){return map$2(f,function(d){var g,p,v=d[l],m=d[s];if(isArray$4(v)){var y=(u-c[m])/2;return __assign$7(__assign$7({},d),(g={},g[l]=map$2(v,function(_){return y+_}),g))}var x=(u-v)/2;return __assign$7(__assign$7({},d),(p={},p[l]=[x,v+x],p))})})},r.prototype.getXValuesMaxMap=function(e){var n=this,o=this,s=o.xField,l=o.yField,c=groupBy(e,function(u){return u[s]});return mapValues(c,function(u){return n.getDimMaxValue(u,l)})},r.prototype.getDimMaxValue=function(e,n){var o=map$2(e,function(l){return get(l,n,[])}),s=flatten(o);return Math.max.apply(Math,s)},r}(Adjust);registerAdjust("Dodge",Dodge);registerAdjust("Jitter",Jitter);registerAdjust("Stack",Stack);registerAdjust("Symmetric",Symmetric);var toScaleString=function(a,r){return isString$1(r)?r:a.invert(a.scale(r))},Attribute=function(){function a(r){this.names=[],this.scales=[],this.linear=!1,this.values=[],this.callback=function(){return[]},this._parseCfg(r)}return a.prototype.mapping=function(){for(var r=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=e.map(function(s,l){return r._toOriginParam(s,r.scales[l])});return this.callback.apply(this,o)},a.prototype.getLinearValue=function(r){var e=this.values.length-1,n=Math.floor(e*r),o=e*r-n,s=this.values[n],l=n===e?s:this.values[n+1];return s+(l-s)*o},a.prototype.getNames=function(){for(var r=this.scales,e=this.names,n=Math.min(r.length,e.length),o=[],s=0;s<n;s+=1)o.push(e[s]);return o},a.prototype.getFields=function(){return this.scales.map(function(r){return r.field})},a.prototype.getScale=function(r){return this.scales[this.names.indexOf(r)]},a.prototype.defaultCallback=function(){for(var r=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return e.length===0?this.values:e.map(function(o,s){var l=r.scales[s];return l.type==="identity"?l.values[0]:r._getAttributeValue(l,o)})},a.prototype._parseCfg=function(r){var e=this,n=r.type,o=n===void 0?"base":n,s=r.names,l=s===void 0?[]:s,c=r.scales,u=c===void 0?[]:c,f=r.values,d=f===void 0?[]:f,g=r.callback;this.type=o,this.scales=u,this.values=d,this.names=l,this.callback=function(){for(var p=[],v=0;v<arguments.length;v++)p[v]=arguments[v];if(g){var m=g.apply(void 0,p);if(!isNil(m))return[m]}return e.defaultCallback.apply(e,p)}},a.prototype._getAttributeValue=function(r,e){if(r.isCategory&&!this.linear){var n=r.translate(e);return this.values[n%this.values.length]}var o=r.scale(e);return this.getLinearValue(o)},a.prototype._toOriginParam=function(r,e){return e.isLinear?r:isArray$4(r)?r.map(function(n){return toScaleString(e,n)}):toScaleString(e,r)},a}(),RGB_REG=/rgba?\(([\s.,0-9]+)\)/,regexLG$2=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,regexRG$2=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,regexColorStop$2=/[\d.]+:(#[^\s]+|[^\)]+\))/gi,isGradientColor=function(a){return/^[r,R,L,l]{1}[\s]*\(/.test(a)},createTmp=function(){var a=document.createElement("i");return a.title="Web Colour Picker",a.style.display="none",document.body.appendChild(a),a},getValue=function(a,r,e,n){return a[n]+(r[n]-a[n])*e};function arr2rgb(a){return"#"+toHex$1(a[0])+toHex$1(a[1])+toHex$1(a[2])}var rgb2arr=function(a){return[parseInt(a.substr(1,2),16),parseInt(a.substr(3,2),16),parseInt(a.substr(5,2),16)]},toHex$1=function(a){var r=Math.round(a).toString(16);return r.length===1?"0"+r:r},calColor=function(a,r){var e=isNaN(Number(r))||r<0?0:r>1?1:Number(r),n=a.length-1,o=Math.floor(n*e),s=n*e-o,l=a[o],c=o===n?l:a[o+1];return arr2rgb([getValue(l,c,s,0),getValue(l,c,s,1),getValue(l,c,s,2)])},iEl,toRGB=function(a){if(a[0]==="#"&&a.length===7)return a;iEl||(iEl=createTmp()),iEl.style.color=a;var r=document.defaultView.getComputedStyle(iEl,"").getPropertyValue("color"),e=RGB_REG.exec(r),n=e[1].split(/\s*,\s*/).map(function(o){return Number(o)});return r=arr2rgb(n),r},gradient=function(a){var r=isString$1(a)?a.split("-"):a,e=map$2(r,function(n){return rgb2arr(n.indexOf("#")===-1?toRGB(n):n)});return function(n){return calColor(e,n)}},toCSSGradient=function(a){if(isGradientColor(a)){var r,e=void 0;if(a[0]==="l"){var n=regexLG$2.exec(a),o=+n[1]+90;e=n[2],r="linear-gradient("+o+"deg, "}else if(a[0]==="r"){r="radial-gradient(";var n=regexRG$2.exec(a);e=n[4]}var s=e.match(regexColorStop$2);return each$1(s,function(l,c){var u=l.split(":");r+=u[1]+" "+u[0]*100+"%",c!==s.length-1&&(r+=", ")}),r+=")",r}return a};const colorUtil={rgb2arr,gradient,toRGB:memoize(toRGB),toCSSGradient};var Color=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;return n.type="color",n.names=["color"],isString$1(n.values)&&(n.linear=!0),n.gradient=colorUtil.gradient(n.values),n}return r.prototype.getLinearValue=function(e){return this.gradient(e)},r}(Attribute),Opacity=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;return n.type="opacity",n.names=["opacity"],n}return r}(Attribute),Position=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;return n.names=["x","y"],n.type="position",n}return r.prototype.mapping=function(e,n){var o=this.scales,s=o[0],l=o[1];return isNil(e)||isNil(n)?[]:[isArray$4(e)?e.map(function(c){return s.scale(c)}):s.scale(e),isArray$4(n)?n.map(function(c){return l.scale(c)}):l.scale(n)]},r}(Attribute),Shape$2=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;return n.type="shape",n.names=["shape"],n}return r.prototype.getLinearValue=function(e){var n=Math.round((this.values.length-1)*e);return this.values[n]},r}(Attribute),Size=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;return n.type="size",n.names=["size"],n}return r}(Attribute),methodCache={};function getTickMethod(a){return methodCache[a]}function registerTickMethod(a,r){methodCache[a]=r}var Scale=function(){function a(r){this.type="base",this.isCategory=!1,this.isLinear=!1,this.isContinuous=!1,this.isIdentity=!1,this.values=[],this.range=[0,1],this.ticks=[],this.__cfg__=r,this.initCfg(),this.init()}return a.prototype.translate=function(r){return r},a.prototype.change=function(r){mix(this.__cfg__,r),this.init()},a.prototype.clone=function(){return this.constructor(this.__cfg__)},a.prototype.getTicks=function(){var r=this;return map$2(this.ticks,function(e,n){return isObject$1(e)?e:{text:r.getText(e,n),tickValue:e,value:r.scale(e)}})},a.prototype.getText=function(r,e){var n=this.formatter,o=n?n(r,e):r;return isNil(o)||!isFunction$1(o.toString)?"":o.toString()},a.prototype.getConfig=function(r){return this.__cfg__[r]},a.prototype.init=function(){mix(this,this.__cfg__),this.setDomain(),isEmpty(this.getConfig("ticks"))&&(this.ticks=this.calculateTicks())},a.prototype.initCfg=function(){},a.prototype.setDomain=function(){},a.prototype.calculateTicks=function(){var r=this.tickMethod,e=[];if(isString$1(r)){var n=getTickMethod(r);if(!n)throw new Error("There is no method to to calculate ticks!");e=n(this)}else isFunction$1(r)&&(e=r(this));return e},a.prototype.rangeMin=function(){return this.range[0]},a.prototype.rangeMax=function(){return this.range[1]},a.prototype.calcPercent=function(r,e,n){return isNumber$2(r)?(r-e)/(n-e):NaN},a.prototype.calcValue=function(r,e,n){return e+r*(n-e)},a}(),Category$1=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="cat",e.isCategory=!0,e}return r.prototype.buildIndexMap=function(){if(!this.translateIndexMap){this.translateIndexMap=new Map;for(var e=0;e<this.values.length;e++)this.translateIndexMap.set(this.values[e],e)}},r.prototype.translate=function(e){this.buildIndexMap();var n=this.translateIndexMap.get(e);return n===void 0&&(n=isNumber$2(e)?e:NaN),n},r.prototype.scale=function(e){var n=this.translate(e),o=this.calcPercent(n,this.min,this.max);return this.calcValue(o,this.rangeMin(),this.rangeMax())},r.prototype.invert=function(e){var n=this.max-this.min,o=this.calcPercent(e,this.rangeMin(),this.rangeMax()),s=Math.round(n*o)+this.min;return s<this.min||s>this.max?NaN:this.values[s]},r.prototype.getText=function(e){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];var s=e;return isNumber$2(e)&&!this.values.includes(e)&&(s=this.values[s]),a.prototype.getText.apply(this,__spreadArrays$3([s],n))},r.prototype.initCfg=function(){this.tickMethod="cat"},r.prototype.setDomain=function(){if(isNil(this.getConfig("min"))&&(this.min=0),isNil(this.getConfig("max"))){var e=this.values.length;this.max=e>1?e-1:e}this.translateIndexMap&&(this.translateIndexMap=void 0)},r}(Scale),token=/d{1,4}|M{1,4}|YY(?:YY)?|S{1,3}|Do|ZZ|Z|([HhMsDm])\1?|[aA]|"[^"]*"|'[^']*'/g,twoDigitsOptional="\\d\\d?",twoDigits="\\d\\d",threeDigits="\\d{3}",fourDigits="\\d{4}",word="[^\\s]+",literal=/\[([^]*?)\]/gm;function shorten(a,r){for(var e=[],n=0,o=a.length;n<o;n++)e.push(a[n].substr(0,r));return e}var monthUpdate=function(a){return function(r,e){var n=e[a].map(function(s){return s.toLowerCase()}),o=n.indexOf(r.toLowerCase());return o>-1?o:null}};function assign(a){for(var r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];for(var n=0,o=r;n<o.length;n++){var s=o[n];for(var l in s)a[l]=s[l]}return a}var dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort=shorten(monthNames,3),dayNamesShort=shorten(dayNames,3),defaultI18n={dayNamesShort,dayNames,monthNamesShort,monthNames,amPm:["am","pm"],DoFn:function(a){return a+["th","st","nd","rd"][a%10>3?0:(a-a%10!==10?1:0)*a%10]}},globalI18n=assign({},defaultI18n),setGlobalDateI18n=function(a){return globalI18n=assign(globalI18n,a)},regexEscape=function(a){return a.replace(/[|\\{()[^$+*?.-]/g,"\\$&")},pad=function(a,r){for(r===void 0&&(r=2),a=String(a);a.length<r;)a="0"+a;return a},formatFlags={D:function(a){return String(a.getDate())},DD:function(a){return pad(a.getDate())},Do:function(a,r){return r.DoFn(a.getDate())},d:function(a){return String(a.getDay())},dd:function(a){return pad(a.getDay())},ddd:function(a,r){return r.dayNamesShort[a.getDay()]},dddd:function(a,r){return r.dayNames[a.getDay()]},M:function(a){return String(a.getMonth()+1)},MM:function(a){return pad(a.getMonth()+1)},MMM:function(a,r){return r.monthNamesShort[a.getMonth()]},MMMM:function(a,r){return r.monthNames[a.getMonth()]},YY:function(a){return pad(String(a.getFullYear()),4).substr(2)},YYYY:function(a){return pad(a.getFullYear(),4)},h:function(a){return String(a.getHours()%12||12)},hh:function(a){return pad(a.getHours()%12||12)},H:function(a){return String(a.getHours())},HH:function(a){return pad(a.getHours())},m:function(a){return String(a.getMinutes())},mm:function(a){return pad(a.getMinutes())},s:function(a){return String(a.getSeconds())},ss:function(a){return pad(a.getSeconds())},S:function(a){return String(Math.round(a.getMilliseconds()/100))},SS:function(a){return pad(Math.round(a.getMilliseconds()/10),2)},SSS:function(a){return pad(a.getMilliseconds(),3)},a:function(a,r){return a.getHours()<12?r.amPm[0]:r.amPm[1]},A:function(a,r){return a.getHours()<12?r.amPm[0].toUpperCase():r.amPm[1].toUpperCase()},ZZ:function(a){var r=a.getTimezoneOffset();return(r>0?"-":"+")+pad(Math.floor(Math.abs(r)/60)*100+Math.abs(r)%60,4)},Z:function(a){var r=a.getTimezoneOffset();return(r>0?"-":"+")+pad(Math.floor(Math.abs(r)/60),2)+":"+pad(Math.abs(r)%60,2)}},monthParse=function(a){return+a-1},emptyDigits=[null,twoDigitsOptional],emptyWord=[null,word],amPm=["isPm",word,function(a,r){var e=a.toLowerCase();return e===r.amPm[0]?0:e===r.amPm[1]?1:null}],timezoneOffset=["timezoneOffset","[^\\s]*?[\\+\\-]\\d\\d:?\\d\\d|[^\\s]*?Z?",function(a){var r=(a+"").match(/([+-]|\d\d)/gi);if(r){var e=+r[1]*60+parseInt(r[2],10);return r[0]==="+"?e:-e}return 0}],parseFlags={D:["day",twoDigitsOptional],DD:["day",twoDigits],Do:["day",twoDigitsOptional+word,function(a){return parseInt(a,10)}],M:["month",twoDigitsOptional,monthParse],MM:["month",twoDigits,monthParse],YY:["year",twoDigits,function(a){var r=new Date,e=+(""+r.getFullYear()).substr(0,2);return+(""+(+a>68?e-1:e)+a)}],h:["hour",twoDigitsOptional,void 0,"isPm"],hh:["hour",twoDigits,void 0,"isPm"],H:["hour",twoDigitsOptional],HH:["hour",twoDigits],m:["minute",twoDigitsOptional],mm:["minute",twoDigits],s:["second",twoDigitsOptional],ss:["second",twoDigits],YYYY:["year",fourDigits],S:["millisecond","\\d",function(a){return+a*100}],SS:["millisecond",twoDigits,function(a){return+a*10}],SSS:["millisecond",threeDigits],d:emptyDigits,dd:emptyDigits,ddd:emptyWord,dddd:emptyWord,MMM:["month",word,monthUpdate("monthNamesShort")],MMMM:["month",word,monthUpdate("monthNames")],a:amPm,A:amPm,ZZ:timezoneOffset,Z:timezoneOffset},globalMasks={default:"ddd MMM DD YYYY HH:mm:ss",shortDate:"M/D/YY",mediumDate:"MMM D, YYYY",longDate:"MMMM D, YYYY",fullDate:"dddd, MMMM D, YYYY",isoDate:"YYYY-MM-DD",isoDateTime:"YYYY-MM-DDTHH:mm:ssZ",shortTime:"HH:mm",mediumTime:"HH:mm:ss",longTime:"HH:mm:ss.SSS"},setGlobalDateMasks=function(a){return assign(globalMasks,a)},format$1=function(a,r,e){if(r===void 0&&(r=globalMasks.default),e===void 0&&(e={}),typeof a=="number"&&(a=new Date(a)),Object.prototype.toString.call(a)!=="[object Date]"||isNaN(a.getTime()))throw new Error("Invalid Date pass to format");r=globalMasks[r]||r;var n=[];r=r.replace(literal,function(s,l){return n.push(l),"@@@"});var o=assign(assign({},globalI18n),e);return r=r.replace(token,function(s){return formatFlags[s](a,o)}),r.replace(/@@@/g,function(){return n.shift()})};function parse$1(a,r,e){if(e===void 0&&(e={}),typeof r!="string")throw new Error("Invalid format in fecha parse");if(r=globalMasks[r]||r,a.length>1e3)return null;var n=new Date,o={year:n.getFullYear(),month:0,day:1,hour:0,minute:0,second:0,millisecond:0,isPm:null,timezoneOffset:null},s=[],l=[],c=r.replace(literal,function(A,T){return l.push(regexEscape(T)),"@@@"}),u={},f={};c=regexEscape(c).replace(token,function(A){var T=parseFlags[A],b=T[0],C=T[1],L=T[3];if(u[b])throw new Error("Invalid format. "+b+" specified twice in format");return u[b]=!0,L&&(f[L]=!0),s.push(T),"("+C+")"}),Object.keys(f).forEach(function(A){if(!u[A])throw new Error("Invalid format. "+A+" is required in specified format")}),c=c.replace(/@@@/g,function(){return l.shift()});var d=a.match(new RegExp(c,"i"));if(!d)return null;for(var g=assign(assign({},globalI18n),e),p=1;p<d.length;p++){var v=s[p-1],m=v[0],y=v[2],x=y?y(d[p],g):+d[p];if(x==null)return null;o[m]=x}o.isPm===1&&o.hour!=null&&+o.hour!=12?o.hour=+o.hour+12:o.isPm===0&&+o.hour==12&&(o.hour=0);var _;if(o.timezoneOffset==null){_=new Date(o.year,o.month,o.day,o.hour,o.minute,o.second,o.millisecond);for(var E=[["month","getMonth"],["day","getDate"],["hour","getHours"],["minute","getMinutes"],["second","getSeconds"]],p=0,S=E.length;p<S;p++)if(u[E[p][0]]&&o[E[p][0]]!==_[E[p][1]]())return null}else if(_=new Date(Date.UTC(o.year,o.month,o.day,o.hour,o.minute-o.timezoneOffset,o.second,o.millisecond)),o.month>11||o.month<0||o.day>31||o.day<1||o.hour>23||o.hour<0||o.minute>59||o.minute<0||o.second>59||o.second<0)return null;return _}var fecha={format:format$1,parse:parse$1,defaultI18n,setGlobalDateI18n,setGlobalDateMasks};const fecha1=Object.freeze(Object.defineProperty({__proto__:null,assign,default:fecha,defaultI18n,format:format$1,parse:parse$1,setGlobalDateI18n,setGlobalDateMasks},Symbol.toStringTag,{value:"Module"}));function bisector(a){return function(r,e,n,o){for(var s=isNil(n)?0:n,l=isNil(o)?r.length:o;s<l;){var c=s+l>>>1;a(r[c])>e?l=c:s=c+1}return s}}var FORMAT_METHOD="format";function timeFormat(a,r){var e=fecha1[FORMAT_METHOD]||fecha[FORMAT_METHOD];return e(a,r)}function toTimeStamp(a){return isString$1(a)&&(a.indexOf("T")>0?a=new Date(a).getTime():a=new Date(a.replace(/-/gi,"/")).getTime()),isDate(a)&&(a=a.getTime()),a}var SECOND=1e3,MINUTE=60*SECOND,HOUR=60*MINUTE,DAY=24*HOUR,MONTH=DAY*31,YEAR=DAY*365,intervals=[["HH:mm:ss",SECOND],["HH:mm:ss",SECOND*10],["HH:mm:ss",SECOND*30],["HH:mm",MINUTE],["HH:mm",MINUTE*10],["HH:mm",MINUTE*30],["HH",HOUR],["HH",HOUR*6],["HH",HOUR*12],["YYYY-MM-DD",DAY],["YYYY-MM-DD",DAY*4],["YYYY-WW",DAY*7],["YYYY-MM",MONTH],["YYYY-MM",MONTH*4],["YYYY-MM",MONTH*6],["YYYY",DAY*380]];function getTickInterval(a,r,e){var n=(r-a)/e,o=bisector(function(l){return l[1]})(intervals,n)-1,s=intervals[o];return o<0?s=intervals[0]:o>=intervals.length&&(s=last(intervals)),s}var TimeCat=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="timeCat",e}return r.prototype.translate=function(e){e=toTimeStamp(e);var n=this.values.indexOf(e);return n===-1&&(isNumber$2(e)&&e<this.values.length?n=e:n=NaN),n},r.prototype.getText=function(e,n){var o=this.translate(e);if(o>-1){var s=this.values[o],l=this.formatter;return s=l?l(s,n):timeFormat(s,this.mask),s}return e},r.prototype.initCfg=function(){this.tickMethod="time-cat",this.mask="YYYY-MM-DD",this.tickCount=7},r.prototype.setDomain=function(){var e=this.values;each$1(e,function(n,o){e[o]=toTimeStamp(n)}),e.sort(function(n,o){return n-o}),a.prototype.setDomain.call(this)},r}(Category$1),Continuous=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.isContinuous=!0,e}return r.prototype.scale=function(e){if(isNil(e))return NaN;var n=this.rangeMin(),o=this.rangeMax(),s=this.max,l=this.min;if(s===l)return n;var c=this.getScalePercent(e);return n+c*(o-n)},r.prototype.init=function(){a.prototype.init.call(this);var e=this.ticks,n=head(e),o=last(e);n<this.min&&(this.min=n),o>this.max&&(this.max=o),isNil(this.minLimit)||(this.min=n),isNil(this.maxLimit)||(this.max=o)},r.prototype.setDomain=function(){var e=getRange(this.values),n=e.min,o=e.max;isNil(this.min)&&(this.min=n),isNil(this.max)&&(this.max=o),this.min>this.max&&(this.min=n,this.max=o)},r.prototype.calculateTicks=function(){var e=this,n=a.prototype.calculateTicks.call(this);return this.nice||(n=filter(n,function(o){return o>=e.min&&o<=e.max})),n},r.prototype.getScalePercent=function(e){var n=this.max,o=this.min;return(e-o)/(n-o)},r.prototype.getInvertPercent=function(e){return(e-this.rangeMin())/(this.rangeMax()-this.rangeMin())},r}(Scale),Linear=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="linear",e.isLinear=!0,e}return r.prototype.invert=function(e){var n=this.getInvertPercent(e);return this.min+n*(this.max-this.min)},r.prototype.initCfg=function(){this.tickMethod="wilkinson-extended",this.nice=!1},r}(Continuous);function calBase(a,r){var e=Math.E,n;return r>=0?n=Math.pow(e,Math.log(r)/a):n=Math.pow(e,Math.log(-r)/a)*-1,n}function log$1(a,r){return a===1?1:Math.log(r)/Math.log(a)}function getLogPositiveMin(a,r,e){isNil(e)&&(e=Math.max.apply(null,a));var n=e;return each$1(a,function(o){o>0&&o<n&&(n=o)}),n===e&&(n=e/r),n>1&&(n=1),n}var Log=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="log",e}return r.prototype.invert=function(e){var n=this.base,o=log$1(n,this.max),s=this.rangeMin(),l=this.rangeMax()-s,c,u=this.positiveMin;if(u){if(e===0)return 0;c=log$1(n,u/n);var f=1/(o-c)*l;if(e<f)return e/f*u}else c=log$1(n,this.min);var d=(e-s)/l,g=d*(o-c)+c;return Math.pow(n,g)},r.prototype.initCfg=function(){this.tickMethod="log",this.base=10,this.tickCount=6,this.nice=!0},r.prototype.setDomain=function(){a.prototype.setDomain.call(this);var e=this.min;if(e<0)throw new Error("When you use log scale, the minimum value must be greater than zero!");e===0&&(this.positiveMin=getLogPositiveMin(this.values,this.base,this.max))},r.prototype.getScalePercent=function(e){var n=this.max,o=this.min;if(n===o||e<=0)return 0;var s=this.base,l=this.positiveMin;l&&(o=l*1/s);var c;return e<l?c=e/l/(log$1(s,n)-log$1(s,o)):c=(log$1(s,e)-log$1(s,o))/(log$1(s,n)-log$1(s,o)),c},r}(Continuous),Pow=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="pow",e}return r.prototype.invert=function(e){var n=this.getInvertPercent(e),o=this.exponent,s=calBase(o,this.max),l=calBase(o,this.min),c=n*(s-l)+l,u=c>=0?1:-1;return Math.pow(c,o)*u},r.prototype.initCfg=function(){this.tickMethod="pow",this.exponent=2,this.tickCount=5,this.nice=!0},r.prototype.getScalePercent=function(e){var n=this.max,o=this.min;if(n===o)return 0;var s=this.exponent,l=(calBase(s,e)-calBase(s,o))/(calBase(s,n)-calBase(s,o));return l},r}(Continuous),Time=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="time",e}return r.prototype.getText=function(e,n){var o=this.translate(e),s=this.formatter;return s?s(o,n):timeFormat(o,this.mask)},r.prototype.scale=function(e){var n=e;return(isString$1(n)||isDate(n))&&(n=this.translate(n)),a.prototype.scale.call(this,n)},r.prototype.translate=function(e){return toTimeStamp(e)},r.prototype.initCfg=function(){this.tickMethod="time-pretty",this.mask="YYYY-MM-DD",this.tickCount=7,this.nice=!1},r.prototype.setDomain=function(){var e=this.values,n=this.getConfig("min"),o=this.getConfig("max");if((!isNil(n)||!isNumber$2(n))&&(this.min=this.translate(this.min)),(!isNil(o)||!isNumber$2(o))&&(this.max=this.translate(this.max)),e&&e.length){var s=[],l=1/0,c=l,u=0;each$1(e,function(f){var d=toTimeStamp(f);if(isNaN(d))throw new TypeError("Invalid Time: "+f+" in time scale!");l>d?(c=l,l=d):c>d&&(c=d),u<d&&(u=d),s.push(d)}),e.length>1&&(this.minTickInterval=c-l),isNil(n)&&(this.min=l),isNil(o)&&(this.max=u)}},r}(Linear),Quantize=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="quantize",e}return r.prototype.invert=function(e){var n=this.ticks,o=n.length,s=this.getInvertPercent(e),l=Math.floor(s*(o-1));if(l>=o-1)return last(n);if(l<0)return head(n);var c=n[l],u=n[l+1],f=l/(o-1),d=(l+1)/(o-1);return c+(s-f)/(d-f)*(u-c)},r.prototype.initCfg=function(){this.tickMethod="r-pretty",this.tickCount=5,this.nice=!0},r.prototype.calculateTicks=function(){var e=a.prototype.calculateTicks.call(this);return this.nice||(last(e)!==this.max&&e.push(this.max),head(e)!==this.min&&e.unshift(this.min)),e},r.prototype.getScalePercent=function(e){var n=this.ticks;if(e<head(n))return 0;if(e>last(n))return 1;var o=0;return each$1(n,function(s,l){if(e>=s)o=l;else return!1}),o/(n.length-1)},r}(Continuous),Quantile=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="quantile",e}return r.prototype.initCfg=function(){this.tickMethod="quantile",this.tickCount=5,this.nice=!0},r}(Quantize),map={};function getClass(a){return map[a]}function registerClass(a,r){if(getClass(a))throw new Error("type '"+a+"' existed.");map[a]=r}var Identity=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="identity",e.isIdentity=!0,e}return r.prototype.calculateTicks=function(){return this.values},r.prototype.scale=function(e){return this.values[0]!==e&&isNumber$2(e)?e:this.range[0]},r.prototype.invert=function(e){var n=this.range;return e<n[0]||e>n[1]?NaN:this.values[0]},r}(Scale);function calculateCatTicks(a){var r=a.values,e=a.tickInterval,n=a.tickCount,o=a.showLast;if(isNumber$2(e)){var s=filter(r,function(m,y){return y%e===0}),l=last(r);return o&&last(s)!==l&&s.push(l),s}var c=r.length,u=a.min,f=a.max;if(isNil(u)&&(u=0),isNil(f)&&(f=r.length-1),!isNumber$2(n)||n>=c)return r.slice(u,f+1);if(n<=0||f<=0)return[];for(var d=n===1?c:Math.floor(c/(n-1)),g=[],p=u,v=0;v<n&&!(p>=f);v++)p=Math.min(u+v*d,f),v===n-1&&o?g.push(r[f]):g.push(r[p]);return g}function d3Linear(a){var r=a.min,e=a.max,n=a.nice,o=a.tickCount,s=new D3Linear;return s.domain([r,e]),n&&s.nice(o),s.ticks(o)}var DEFAULT_COUNT=5,e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2),D3Linear=function(){function a(){this._domain=[0,1]}return a.prototype.domain=function(r){return r?(this._domain=Array.from(r,Number),this):this._domain.slice()},a.prototype.nice=function(r){var e,n;r===void 0&&(r=DEFAULT_COUNT);var o=this._domain.slice(),s=0,l=this._domain.length-1,c=this._domain[s],u=this._domain[l],f;return u<c&&(e=[u,c],c=e[0],u=e[1],n=[l,s],s=n[0],l=n[1]),f=tickIncrement(c,u,r),f>0?(c=Math.floor(c/f)*f,u=Math.ceil(u/f)*f,f=tickIncrement(c,u,r)):f<0&&(c=Math.ceil(c*f)/f,u=Math.floor(u*f)/f,f=tickIncrement(c,u,r)),f>0?(o[s]=Math.floor(c/f)*f,o[l]=Math.ceil(u/f)*f,this.domain(o)):f<0&&(o[s]=Math.ceil(c*f)/f,o[l]=Math.floor(u*f)/f,this.domain(o)),this},a.prototype.ticks=function(r){return r===void 0&&(r=DEFAULT_COUNT),d3ArrayTicks(this._domain[0],this._domain[this._domain.length-1],r||DEFAULT_COUNT)},a}();function d3ArrayTicks(a,r,e){var n,o=-1,s,l,c;if(r=+r,a=+a,e=+e,a===r&&e>0)return[a];if((n=r<a)&&(s=a,a=r,r=s),(c=tickIncrement(a,r,e))===0||!isFinite(c))return[];if(c>0)for(a=Math.ceil(a/c),r=Math.floor(r/c),l=new Array(s=Math.ceil(r-a+1));++o<s;)l[o]=(a+o)*c;else for(a=Math.floor(a*c),r=Math.ceil(r*c),l=new Array(s=Math.ceil(a-r+1));++o<s;)l[o]=(a-o)/c;return n&&l.reverse(),l}function tickIncrement(a,r,e){var n=(r-a)/Math.max(0,e),o=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,o);return o>=0?(s>=e10?10:s>=e5?5:s>=e2?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(s>=e10?10:s>=e5?5:s>=e2?2:1)}function snapMultiple(a,r,e){var n;return e==="ceil"?n=Math.ceil(a/r):e==="floor"?n=Math.floor(a/r):n=Math.round(a/r),n*r}function intervalTicks(a,r,e){var n=snapMultiple(a,e,"floor"),o=snapMultiple(r,e,"ceil");n=fixedBase(n,e),o=fixedBase(o,e);for(var s=[],l=Math.max((o-n)/(Math.pow(2,12)-1),e),c=n;c<=o;c=c+l){var u=fixedBase(c,l);s.push(u)}return{min:n,max:o,ticks:s}}function strictLimit(a,r,e){var n,o=a.minLimit,s=a.maxLimit,l=a.min,c=a.max,u=a.tickCount,f=u===void 0?5:u,d=isNil(o)?isNil(r)?l:r:o,g=isNil(s)?isNil(e)?c:e:s;if(d>g&&(n=[d,g],g=n[0],d=n[1]),f<=2)return[d,g];for(var p=(g-d)/(f-1),v=[],m=0;m<f;m++)v.push(d+p*m);return v}function d3LinearTickMethod(a){var r=a.min,e=a.max,n=a.tickInterval,o=a.minLimit,s=a.maxLimit,l=d3Linear(a);return!isNil(o)||!isNil(s)?strictLimit(a,head(l),last(l)):n?intervalTicks(r,e,n).ticks:l}function prettyNumber(a){return Math.abs(a)<1e-15?a:parseFloat(a.toFixed(15))}var DEFAULT_Q=[1,5,2,2.5,4,3],eps=Number.EPSILON*100;function mod(a,r){return(a%r+r)%r}function round(a){return Math.round(a*1e12)/1e12}function simplicity(a,r,e,n,o,s){var l=size(r),c=indexOf(r,a),u=0,f=mod(n,s);return(f<eps||s-f<eps)&&n<=0&&o>=0&&(u=1),1-c/(l-1)-e+u}function simplicityMax(a,r,e){var n=size(r),o=indexOf(r,a),s=1;return 1-o/(n-1)-e+s}function density(a,r,e,n,o,s){var l=(a-1)/(s-o),c=(r-1)/(Math.max(s,n)-Math.min(e,o));return 2-Math.max(l/c,c/l)}function densityMax(a,r){return a>=r?2-(a-1)/(r-1):1}function coverage(a,r,e,n){var o=r-a;return 1-.5*(Math.pow(r-n,2)+Math.pow(a-e,2))/Math.pow(.1*o,2)}function coverageMax(a,r,e){var n=r-a;if(e>n){var o=(e-n)/2;return 1-Math.pow(o,2)/Math.pow(.1*n,2)}return 1}function legibility(){return 1}function extended(a,r,e,n,o,s){e===void 0&&(e=5),n===void 0&&(n=!0),o===void 0&&(o=DEFAULT_Q),s===void 0&&(s=[.25,.2,.5,.05]);var l=e<0?0:Math.round(e);if(Number.isNaN(a)||Number.isNaN(r)||typeof a!="number"||typeof r!="number"||!l)return{min:0,max:0,ticks:[]};if(r-a<1e-15||l===1)return{min:a,max:r,ticks:[a]};if(r-a>1e148){var c=e||5,u=(r-a)/c;return{min:a,max:r,ticks:Array(c).fill(null).map(function(G,z){return prettyNumber(a+u*z)})}}for(var f={score:-2,lmin:0,lmax:0,lstep:0},d=1;d<1/0;){for(var g=0;g<o.length;g+=1){var p=o[g],v=simplicityMax(p,o,d);if(s[0]*v+s[1]+s[2]+s[3]<f.score){d=1/0;break}for(var m=2;m<1/0;){var y=densityMax(m,l);if(s[0]*v+s[1]+s[2]*y+s[3]<f.score)break;for(var x=(r-a)/(m+1)/d/p,_=Math.ceil(Math.log10(x));_<1/0;){var E=d*p*Math.pow(10,_),S=coverageMax(a,r,E*(m-1));if(s[0]*v+s[1]*S+s[2]*y+s[3]<f.score)break;var A=Math.floor(r/E)*d-(m-1)*d,T=Math.ceil(a/E)*d;if(A<=T)for(var c=T-A,b=0;b<=c;b+=1){var C=A+b,L=C*(E/d),R=L+E*(m-1),I=E,w=simplicity(p,o,d,L,R,I),M=coverage(a,r,L,R),D=density(m,l,a,r,L,R),O=legibility(),F=s[0]*w+s[1]*M+s[2]*D+s[3]*O;F>f.score&&(!n||L<=a&&R>=r)&&(f.lmin=L,f.lmax=R,f.lstep=I,f.score=F)}_+=1}m+=1}}d+=1}var k=prettyNumber(f.lmax),$=prettyNumber(f.lmin),V=prettyNumber(f.lstep),N=Math.floor(round((k-$)/V))+1,B=new Array(N);B[0]=prettyNumber($);for(var g=1;g<N;g++)B[g]=prettyNumber(B[g-1]+V);return{min:Math.min(a,head(B)),max:Math.max(r,last(B)),ticks:B}}function linear$1(a){var r=a.min,e=a.max,n=a.tickCount,o=a.nice,s=a.tickInterval,l=a.minLimit,c=a.maxLimit,u=extended(r,e,n,o).ticks;return!isNil(l)||!isNil(c)?strictLimit(a,head(u),last(u)):s?intervalTicks(r,e,s).ticks:u}function calculateLogTicks(a){var r=a.base,e=a.tickCount,n=a.min,o=a.max,s=a.values,l,c=log$1(r,o);if(n>0)l=Math.floor(log$1(r,n));else{var u=getLogPositiveMin(s,r,o);l=Math.floor(log$1(r,u))}for(var f=c-l,d=Math.ceil(f/e),g=[],p=l;p<c+d;p=p+d)g.push(Math.pow(r,p));return n<=0&&g.unshift(0),g}function pretty(a,r,e){if(e===void 0&&(e=5),a===r)return{max:r,min:a,ticks:[a]};var n=e<0?0:Math.round(e);if(n===0)return{max:r,min:a,ticks:[]};var o=1.5,s=.5+1.5*o,l=r-a,c=l/n,u=Math.pow(10,Math.floor(Math.log10(c))),f=u;2*u-c<o*(c-f)&&(f=2*u,5*u-c<s*(c-f)&&(f=5*u,10*u-c<o*(c-f)&&(f=10*u)));for(var d=Math.ceil(r/f),g=Math.floor(a/f),p=Math.max(d*f,r),v=Math.min(g*f,a),m=Math.floor((p-v)/f)+1,y=new Array(m),x=0;x<m;x++)y[x]=prettyNumber(v+x*f);return{min:v,max:p,ticks:y}}function calculatePowTicks(a){var r=a.exponent,e=a.tickCount,n=Math.ceil(calBase(r,a.max)),o=Math.floor(calBase(r,a.min)),s=pretty(o,n,e).ticks;return s.map(function(l){var c=l>=0?1:-1;return Math.pow(l,r)*c})}function quantileSorted$1(a,r){var e=a.length*r;return r===1?a[a.length-1]:r===0?a[0]:e%1!==0?a[Math.ceil(e)-1]:a.length%2===0?(a[e-1]+a[e])/2:a[e]}function calculateTicks(a){var r=a.tickCount,e=a.values;if(!e||!e.length)return[];for(var n=e.slice().sort(function(c,u){return c-u}),o=[],s=0;s<r;s++){var l=s/(r-1);o.push(quantileSorted$1(n,l))}return o}function linearPretty(a){var r=a.min,e=a.max,n=a.tickCount,o=a.tickInterval,s=a.minLimit,l=a.maxLimit,c=pretty(r,e,n).ticks;return!isNil(s)||!isNil(l)?strictLimit(a,head(c),last(c)):o?intervalTicks(r,e,o).ticks:c}function calculateTimeTicks(a){var r=a.min,e=a.max,n=a.minTickInterval,o=a.tickInterval,s=a.tickCount;if(o)s=Math.ceil((e-r)/o);else{o=getTickInterval(r,e,s)[1];var l=(e-r)/o,c=l/s;c>1&&(o=o*Math.ceil(c)),n&&o<n&&(o=n)}o=Math.max(Math.floor((e-r)/(Math.pow(2,12)-1)),o);for(var u=[],f=r;f<e+o;f+=o)u.push(f);return u}function timeCat(a){var r=calculateCatTicks(__assign$8({showLast:!0},a));return r}function getYear(a){return new Date(a).getFullYear()}function createYear(a){return new Date(a,0,1).getTime()}function getMonth(a){return new Date(a).getMonth()}function diffMonth(a,r){var e=getYear(a),n=getYear(r),o=getMonth(a),s=getMonth(r);return(n-e)*12+(s-o)%12}function creatMonth(a,r){return new Date(a,r,1).getTime()}function diffDay(a,r){return Math.ceil((r-a)/DAY)}function diffHour(a,r){return Math.ceil((r-a)/HOUR)}function diffMinus(a,r){return Math.ceil((r-a)/(60*1e3))}function timePretty(a){var r=a.min,e=a.max,n=a.minTickInterval,o=a.tickCount,s=a.tickInterval,l=[];s||(s=(e-r)/o,n&&s<n&&(s=n)),s=Math.max(Math.floor((e-r)/(Math.pow(2,12)-1)),s);var c=getYear(r);if(s>YEAR)for(var u=getYear(e),f=Math.ceil(s/YEAR),d=c;d<=u+f;d=d+f)l.push(createYear(d));else if(s>MONTH)for(var g=Math.ceil(s/MONTH),p=getMonth(r),v=diffMonth(r,e),d=0;d<=v+g;d=d+g)l.push(creatMonth(c,d+p));else if(s>DAY)for(var m=new Date(r),y=m.getFullYear(),x=m.getMonth(),_=m.getDate(),E=Math.ceil(s/DAY),S=diffDay(r,e),d=0;d<S+E;d=d+E)l.push(new Date(y,x,_+d).getTime());else if(s>HOUR)for(var m=new Date(r),y=m.getFullYear(),x=m.getMonth(),E=m.getDate(),A=m.getHours(),T=Math.ceil(s/HOUR),b=diffHour(r,e),d=0;d<=b+T;d=d+T)l.push(new Date(y,x,E,A+d).getTime());else if(s>MINUTE)for(var C=diffMinus(r,e),L=Math.ceil(s/MINUTE),d=0;d<=C+L;d=d+L)l.push(r+d*MINUTE);else{var R=s;R<SECOND&&(R=SECOND);for(var I=Math.floor(r/SECOND)*SECOND,w=Math.ceil((e-r)/SECOND),M=Math.ceil(R/SECOND),d=0;d<w+M;d=d+M)l.push(I+d*SECOND)}return l.length>=512&&console.warn("Notice: current ticks length("+l.length+') >= 512, may cause performance issues, even out of memory. Because of the configure "tickInterval"(in milliseconds, current is '+s+") is too small, increase the value to solve the problem!"),l}registerTickMethod("cat",calculateCatTicks);registerTickMethod("time-cat",timeCat);registerTickMethod("wilkinson-extended",linear$1);registerTickMethod("r-pretty",linearPretty);registerTickMethod("time",calculateTimeTicks);registerTickMethod("time-pretty",timePretty);registerTickMethod("log",calculateLogTicks);registerTickMethod("pow",calculatePowTicks);registerTickMethod("quantile",calculateTicks);registerTickMethod("d3-linear",d3LinearTickMethod);registerClass("cat",Category$1);registerClass("category",Category$1);registerClass("identity",Identity);registerClass("linear",Linear);registerClass("log",Log);registerClass("pow",Pow);registerClass("time",Time);registerClass("timeCat",TimeCat);registerClass("quantize",Quantize);registerClass("quantile",Quantile);var ATTRIBUTE_MAP={},getAttribute=function(a){return ATTRIBUTE_MAP[a.toLowerCase()]},registerAttribute=function(a,r){if(getAttribute(a))throw new Error("Attribute type '".concat(a,"' existed."));ATTRIBUTE_MAP[a.toLowerCase()]=r};registerAttribute("Color",Color);registerAttribute("Opacity",Opacity);registerAttribute("Position",Position);registerAttribute("Shape",Shape$2);registerAttribute("Size",Size);var Coordinate=function(){function a(r){this.type="coordinate",this.isRect=!1,this.isHelix=!1,this.isPolar=!1,this.isReflectX=!1,this.isReflectY=!1;var e=r.start,n=r.end,o=r.matrix,s=o===void 0?[1,0,0,0,1,0,0,0,1]:o,l=r.isTransposed,c=l===void 0?!1:l;this.start=e,this.end=n,this.matrix=s,this.originalMatrix=__spreadArray$2([],s),this.isTransposed=c}return a.prototype.initial=function(){this.center={x:(this.start.x+this.end.x)/2,y:(this.start.y+this.end.y)/2},this.width=Math.abs(this.end.x-this.start.x),this.height=Math.abs(this.end.y-this.start.y)},a.prototype.update=function(r){mix(this,r),this.initial()},a.prototype.convertDim=function(r,e){var n,o=this[e],s=o.start,l=o.end;return this.isReflect(e)&&(n=[l,s],s=n[0],l=n[1]),s+r*(l-s)},a.prototype.invertDim=function(r,e){var n,o=this[e],s=o.start,l=o.end;return this.isReflect(e)&&(n=[l,s],s=n[0],l=n[1]),(r-s)/(l-s)},a.prototype.applyMatrix=function(r,e,n){n===void 0&&(n=0);var o=this.matrix,s=[r,e,n];return transformMat3$1(s,s,o),s},a.prototype.invertMatrix=function(r,e,n){n===void 0&&(n=0);var o=this.matrix,s=invert$2([0,0,0,0,0,0,0,0,0],o),l=[r,e,n];return s&&transformMat3$1(l,l,s),l},a.prototype.convert=function(r){var e=this.convertPoint(r),n=e.x,o=e.y,s=this.applyMatrix(n,o,1);return{x:s[0],y:s[1]}},a.prototype.invert=function(r){var e=this.invertMatrix(r.x,r.y,1);return this.invertPoint({x:e[0],y:e[1]})},a.prototype.rotate=function(r){var e=this.matrix,n=this.center;return leftTranslate(e,e,[-n.x,-n.y]),leftRotate(e,e,r),leftTranslate(e,e,[n.x,n.y]),this},a.prototype.reflect=function(r){return r==="x"?this.isReflectX=!this.isReflectX:this.isReflectY=!this.isReflectY,this},a.prototype.scale=function(r,e){var n=this.matrix,o=this.center;return leftTranslate(n,n,[-o.x,-o.y]),leftScale(n,n,[r,e]),leftTranslate(n,n,[o.x,o.y]),this},a.prototype.translate=function(r,e){var n=this.matrix;return leftTranslate(n,n,[r,e]),this},a.prototype.transpose=function(){return this.isTransposed=!this.isTransposed,this},a.prototype.getCenter=function(){return this.center},a.prototype.getWidth=function(){return this.width},a.prototype.getHeight=function(){return this.height},a.prototype.getRadius=function(){return this.radius},a.prototype.isReflect=function(r){return r==="x"?this.isReflectX:this.isReflectY},a.prototype.resetMatrix=function(r){this.matrix=r||__spreadArray$2([],this.originalMatrix)},a}(),Cartesian=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;return n.isRect=!0,n.type="cartesian",n.initial(),n}return r.prototype.initial=function(){a.prototype.initial.call(this);var e=this.start,n=this.end;this.x={start:e.x,end:n.x},this.y={start:e.y,end:n.y}},r.prototype.convertPoint=function(e){var n,o=e.x,s=e.y;return this.isTransposed&&(n=[s,o],o=n[0],s=n[1]),{x:this.convertDim(o,"x"),y:this.convertDim(s,"y")}},r.prototype.invertPoint=function(e){var n,o=this.invertDim(e.x,"x"),s=this.invertDim(e.y,"y");return this.isTransposed&&(n=[s,o],o=n[0],s=n[1]),{x:o,y:s}},r}(Coordinate),Helix=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;n.isHelix=!0,n.type="helix";var o=e.startAngle,s=o===void 0?1.25*Math.PI:o,l=e.endAngle,c=l===void 0?7.25*Math.PI:l,u=e.innerRadius,f=u===void 0?0:u,d=e.radius;return n.startAngle=s,n.endAngle=c,n.innerRadius=f,n.radius=d,n.initial(),n}return r.prototype.initial=function(){a.prototype.initial.call(this);var e=(this.endAngle-this.startAngle)/(2*Math.PI)+1,n=Math.min(this.width,this.height)/2;this.radius&&this.radius>=0&&this.radius<=1&&(n=n*this.radius),this.d=Math.floor(n*(1-this.innerRadius)/e),this.a=this.d/(Math.PI*2),this.x={start:this.startAngle,end:this.endAngle},this.y={start:this.innerRadius*n,end:this.innerRadius*n+this.d*.99}},r.prototype.convertPoint=function(e){var n,o=e.x,s=e.y;this.isTransposed&&(n=[s,o],o=n[0],s=n[1]);var l=this.convertDim(o,"x"),c=this.a*l,u=this.convertDim(s,"y");return{x:this.center.x+Math.cos(l)*(c+u),y:this.center.y+Math.sin(l)*(c+u)}},r.prototype.invertPoint=function(e){var n,o=this.d+this.y.start,s=subtract([0,0],[e.x,e.y],[this.center.x,this.center.y]),l=angleTo(s,[1,0],!0),c=l*this.a;length(s)<c&&(c=length(s));var u=Math.floor((length(s)-c)/o);l=2*u*Math.PI+l;var f=this.a*l,d=length(s)-f;d=isNumberEqual$1(d,0)?0:d;var g=this.invertDim(l,"x"),p=this.invertDim(d,"y");return g=isNumberEqual$1(g,0)?0:g,p=isNumberEqual$1(p,0)?0:p,this.isTransposed&&(n=[p,g],g=n[0],p=n[1]),{x:g,y:p}},r}(Coordinate),Polar=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;n.isPolar=!0,n.type="polar";var o=e.startAngle,s=o===void 0?-Math.PI/2:o,l=e.endAngle,c=l===void 0?Math.PI*3/2:l,u=e.innerRadius,f=u===void 0?0:u,d=e.radius;return n.startAngle=s,n.endAngle=c,n.innerRadius=f,n.radius=d,n.initial(),n}return r.prototype.initial=function(){for(a.prototype.initial.call(this);this.endAngle<this.startAngle;)this.endAngle+=Math.PI*2;var e=this.getOneBox(),n=e.maxX-e.minX,o=e.maxY-e.minY,s=Math.abs(e.minX)/n,l=Math.abs(e.minY)/o,c;this.height/o>this.width/n?(c=this.width/n,this.circleCenter={x:this.center.x-(.5-s)*this.width,y:this.center.y-(.5-l)*c*o}):(c=this.height/o,this.circleCenter={x:this.center.x-(.5-s)*c*n,y:this.center.y-(.5-l)*this.height}),this.polarRadius=this.radius,this.radius?this.radius>0&&this.radius<=1?this.polarRadius=c*this.radius:(this.radius<=0||this.radius>c)&&(this.polarRadius=c):this.polarRadius=c,this.x={start:this.startAngle,end:this.endAngle},this.y={start:this.innerRadius*this.polarRadius,end:this.polarRadius}},r.prototype.getRadius=function(){return this.polarRadius},r.prototype.convertPoint=function(e){var n,o=this.getCenter(),s=e.x,l=e.y;return this.isTransposed&&(n=[l,s],s=n[0],l=n[1]),s=this.convertDim(s,"x"),l=this.convertDim(l,"y"),{x:o.x+Math.cos(s)*l,y:o.y+Math.sin(s)*l}},r.prototype.invertPoint=function(e){var n,o=this.getCenter(),s=[e.x-o.x,e.y-o.y],l=this,c=l.startAngle,u=l.endAngle;this.isReflect("x")&&(n=[u,c],c=n[0],u=n[1]);var f=[1,0,0,0,1,0,0,0,1];leftRotate(f,f,c);var d=[1,0,0];transformMat3$1(d,d,f);var g=[d[0],d[1]],p=angleTo(g,s,u<c);isNumberEqual$1(p,Math.PI*2)&&(p=0);var v=length(s),m=p/(u-c);m=u-c>0?m:-m;var y=this.invertDim(v,"y"),x={x:0,y:0};return x.x=this.isTransposed?y:m,x.y=this.isTransposed?m:y,x},r.prototype.getCenter=function(){return this.circleCenter},r.prototype.getOneBox=function(){var e=this.startAngle,n=this.endAngle;if(Math.abs(n-e)>=Math.PI*2)return{minX:-1,maxX:1,minY:-1,maxY:1};for(var o=[0,Math.cos(e),Math.cos(n)],s=[0,Math.sin(e),Math.sin(n)],l=Math.min(e,n);l<Math.max(e,n);l+=Math.PI/18)o.push(Math.cos(l)),s.push(Math.sin(l));return{minX:Math.min.apply(Math,o),maxX:Math.max.apply(Math,o),minY:Math.min.apply(Math,s),maxY:Math.max.apply(Math,s)}},r}(Coordinate),COORDINATE_MAP={},getCoordinate=function(a){return COORDINATE_MAP[a.toLowerCase()]},registerCoordinate=function(a,r){COORDINATE_MAP[a.toLowerCase()]=r};registerCoordinate("rect",Cartesian);registerCoordinate("cartesian",Cartesian);registerCoordinate("polar",Polar);registerCoordinate("helix",Helix);function propagationDelegate(a,r,e){var n=new GraphEvent(r,e);n.target=a,n.propagationPath.push(a),a.emitDelegation(r,n);for(var o=a.getParent();o;)o.emitDelegation(r,n),n.propagationPath.push(o),o=o.getParent()}var identityMatrix=[1,0,0,0,1,0,0,0,1];function getMatrixByAngle(a,r,e){if(e===void 0&&(e=identityMatrix),!r)return null;var n=transform$6(e,[["t",-a.x,-a.y],["r",r],["t",a.x,a.y]]);return n}function getMatrixByTranslate(a,r){return!a.x&&!a.y?null:transform$6(r||identityMatrix,[["t",a.x,a.y]])}function getAngleByMatrix(a){var r=[1,0,0],e=[0,0,0];return transformMat3$1(e,r,a),Math.atan2(e[1],e[0])}function multiplyVec2(a,r){var e=[0,0];return transformMat3(e,r,a),e}function applyMatrix2BBox(a,r){var e=multiplyVec2(a,[r.minX,r.minY]),n=multiplyVec2(a,[r.maxX,r.minY]),o=multiplyVec2(a,[r.minX,r.maxY]),s=multiplyVec2(a,[r.maxX,r.maxY]),l=Math.min(e[0],n[0],o[0],s[0]),c=Math.max(e[0],n[0],o[0],s[0]),u=Math.min(e[1],n[1],o[1],s[1]),f=Math.max(e[1],n[1],o[1],s[1]);return{x:l,y:u,minX:l,minY:u,maxX:c,maxY:f,width:c-l,height:f-u}}function applyRotate(a,r,e,n){if(r){var o=getMatrixByAngle({x:e,y:n},r,a.getMatrix());a.setMatrix(o)}}function applyTranslate(a,r,e){var n=getMatrixByTranslate({x:r,y:e});a.attr("matrix",n)}function formatPadding(a){var r=0,e=0,n=0,o=0;return isNumber$2(a)?r=e=n=o=a:isArray$4(a)&&(r=a[0],n=isNil(a[1])?a[0]:a[1],o=isNil(a[2])?a[0]:a[2],e=isNil(a[3])?n:a[3]),[r,n,o,e]}function clearDom(a){for(var r=a.childNodes,e=r.length,n=e-1;n>=0;n--)a.removeChild(r[n])}function hasClass$1(a,r){return!!a.className.match(new RegExp("(\\s|^)"+r+"(\\s|$)"))}function regionToBBox(a){var r=a.start,e=a.end,n=Math.min(r.x,e.x),o=Math.min(r.y,e.y),s=Math.max(r.x,e.x),l=Math.max(r.y,e.y);return{x:n,y:o,minX:n,minY:o,maxX:s,maxY:l,width:s-n,height:l-o}}function pointsToBBox(a){var r=a.map(function(c){return c.x}),e=a.map(function(c){return c.y}),n=Math.min.apply(Math,r),o=Math.min.apply(Math,e),s=Math.max.apply(Math,r),l=Math.max.apply(Math,e);return{x:n,y:o,minX:n,minY:o,maxX:s,maxY:l,width:s-n,height:l-o}}function createBBox(a,r,e,n){var o=a+e,s=r+n;return{x:a,y:r,width:e,height:n,minX:a,minY:r,maxX:isNaN(o)?0:o,maxY:isNaN(s)?0:s}}function getValueByPercent(a,r,e){return(1-e)*a+r*e}function getCirclePoint(a,r,e){return{x:a.x+Math.cos(e)*r,y:a.y+Math.sin(e)*r}}function distance$4(a,r){var e=r.x-a.x,n=r.y-a.y;return Math.sqrt(e*e+n*n)}var near=function(a,r,e){return e===void 0&&(e=Math.pow(Number.EPSILON,.5)),[a,r].includes(1/0)?Math.abs(a)===Math.abs(r):Math.abs(a-r)<e};function intersectBBox(a,r){var e=Math.max(a.minX,r.minX),n=Math.max(a.minY,r.minY),o=Math.min(a.maxX,r.maxX),s=Math.min(a.maxY,r.maxY);return createBBox(e,n,o-e,s-n)}function getBBoxWithClip(a){var r=a.getClip(),e=r&&r.getBBox(),n;if(!a.isGroup())n=a.getBBox();else{var o=1/0,s=-1/0,l=1/0,c=-1/0,u=a.getChildren();u.length>0?each$1(u,function(f){if(f.get("visible")){if(f.isGroup()&&f.get("children").length===0)return!0;var d=getBBoxWithClip(f),g=f.applyToMatrix([d.minX,d.minY,1]),p=f.applyToMatrix([d.minX,d.maxY,1]),v=f.applyToMatrix([d.maxX,d.minY,1]),m=f.applyToMatrix([d.maxX,d.maxY,1]),y=Math.min(g[0],p[0],v[0],m[0]),x=Math.max(g[0],p[0],v[0],m[0]),_=Math.min(g[1],p[1],v[1],m[1]),E=Math.max(g[1],p[1],v[1],m[1]);y<o&&(o=y),x>s&&(s=x),_<l&&(l=_),E>c&&(c=E)}}):(o=0,s=0,l=0,c=0),n=createBBox(o,l,s-o,c-l)}return e?intersectBBox(n,e):n}function updateClip(a,r){if(!(!a.getClip()&&!r.getClip())){var e=r.getClip();if(!e){a.setClip(null);return}var n={type:e.get("type"),attrs:e.attr()};a.setClip(n)}}function toPx(a){return a+"px"}function getTextPoint(a,r,e,n){var o=distance$4(a,r),s=n/o,l=0;return e==="start"?l=0-s:e==="end"&&(l=1+s),{x:getValueByPercent(a.x,r.x,l),y:getValueByPercent(a.y,r.y,l)}}var LOCATION_FIELD_MAP={none:[],point:["x","y"],region:["start","end"],points:["points"],circle:["center","radius","startAngle","endAngle"]},Component=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;return n.initCfg(),n}return r.prototype.getDefaultCfg=function(){return{id:"",name:"",type:"",locationType:"none",offsetX:0,offsetY:0,animate:!1,capture:!0,updateAutoRender:!1,animateOption:{appear:null,update:{duration:400,easing:"easeQuadInOut"},enter:{duration:400,easing:"easeQuadInOut"},leave:{duration:350,easing:"easeQuadIn"}},events:null,defaultCfg:{},visible:!0}},r.prototype.clear=function(){},r.prototype.update=function(e){var n=this,o=this.get("defaultCfg")||{};each$1(e,function(s,l){var c=n.get(l),u=s;c!==s&&(isObject$1(s)&&o[l]&&(u=deepMix({},o[l],s)),n.set(l,u))}),this.updateInner(e),this.afterUpdate(e)},r.prototype.updateInner=function(e){},r.prototype.afterUpdate=function(e){has(e,"visible")&&(e.visible?this.show():this.hide()),has(e,"capture")&&this.setCapture(e.capture)},r.prototype.getLayoutBBox=function(){return this.getBBox()},r.prototype.getLocationType=function(){return this.get("locationType")},r.prototype.getOffset=function(){return{offsetX:this.get("offsetX"),offsetY:this.get("offsetY")}},r.prototype.setOffset=function(e,n){this.update({offsetX:e,offsetY:n})},r.prototype.setLocation=function(e){var n=__assign$8({},e);this.update(n)},r.prototype.getLocation=function(){var e=this,n={},o=this.get("locationType"),s=LOCATION_FIELD_MAP[o];return each$1(s,function(l){n[l]=e.get(l)}),n},r.prototype.isList=function(){return!1},r.prototype.isSlider=function(){return!1},r.prototype.init=function(){},r.prototype.initCfg=function(){var e=this,n=this.get("defaultCfg");each$1(n,function(o,s){var l=e.get(s);if(isObject$1(l)){var c=deepMix({},o,l);e.set(s,c)}})},r}(Base),STATUS_UPDATE="update_status",COPY_PROPERTIES=["visible","tip","delegateObject"],COPY_PROPERTIES_EXCLUDES=["container","group","shapesMap","isRegister","isUpdating","destroyed"],GroupComponent=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{container:null,shapesMap:{},group:null,capture:!0,isRegister:!1,isUpdating:!1,isInit:!0})},r.prototype.remove=function(){this.clear();var e=this.get("group");e.remove()},r.prototype.clear=function(){var e=this.get("group");e.clear(),this.set("shapesMap",{}),this.clearOffScreenCache(),this.set("isInit",!0)},r.prototype.getChildComponentById=function(e){var n=this.getElementById(e),o=n&&n.get("component");return o},r.prototype.getElementById=function(e){return this.get("shapesMap")[e]},r.prototype.getElementByLocalId=function(e){var n=this.getElementId(e);return this.getElementById(n)},r.prototype.getElementsByName=function(e){var n=[];return each$1(this.get("shapesMap"),function(o){o.get("name")===e&&n.push(o)}),n},r.prototype.getContainer=function(){return this.get("container")},r.prototype.updateInner=function(e){this.offScreenRender(),this.get("updateAutoRender")&&this.render()},r.prototype.render=function(){var e=this.get("offScreenGroup");e||(e=this.offScreenRender());var n=this.get("group");this.updateElements(e,n),this.deleteElements(),this.applyOffset(),this.get("eventInitted")||(this.initEvent(),this.set("eventInitted",!0)),this.set("isInit",!1)},r.prototype.show=function(){var e=this.get("group");e.show(),this.set("visible",!0)},r.prototype.hide=function(){var e=this.get("group");e.hide(),this.set("visible",!1)},r.prototype.setCapture=function(e){var n=this.get("group");n.set("capture",e),this.set("capture",e)},r.prototype.destroy=function(){this.removeEvent(),this.remove(),a.prototype.destroy.call(this)},r.prototype.getBBox=function(){return this.get("group").getCanvasBBox()},r.prototype.getLayoutBBox=function(){var e=this.get("group"),n=this.getInnerLayoutBBox(),o=e.getTotalMatrix();return o&&(n=applyMatrix2BBox(o,n)),n},r.prototype.on=function(e,n,o){var s=this.get("group");return s.on(e,n,o),this},r.prototype.off=function(e,n){var o=this.get("group");return o&&o.off(e,n),this},r.prototype.emit=function(e,n){var o=this.get("group");o.emit(e,n)},r.prototype.init=function(){a.prototype.init.call(this),this.get("group")||this.initGroup(),this.offScreenRender()},r.prototype.getInnerLayoutBBox=function(){return this.get("offScreenBBox")||this.get("group").getBBox()},r.prototype.delegateEmit=function(e,n){var o=this.get("group");n.target=o,o.emit(e,n),propagationDelegate(o,e,n)},r.prototype.createOffScreenGroup=function(){var e=this.get("group"),n=e.getGroupBase(),o=new n({delegateObject:this.getDelegateObject()});return o},r.prototype.applyOffset=function(){var e=this.get("offsetX"),n=this.get("offsetY");this.moveElementTo(this.get("group"),{x:e,y:n})},r.prototype.initGroup=function(){var e=this.get("container");this.set("group",e.addGroup({id:this.get("id"),name:this.get("name"),capture:this.get("capture"),visible:this.get("visible"),isComponent:!0,component:this,delegateObject:this.getDelegateObject()}))},r.prototype.offScreenRender=function(){this.clearOffScreenCache();var e=this.createOffScreenGroup();return this.renderInner(e),this.set("offScreenGroup",e),this.set("offScreenBBox",getBBoxWithClip(e)),e},r.prototype.addGroup=function(e,n){this.appendDelegateObject(e,n);var o=e.addGroup(n);return this.get("isRegister")&&this.registerElement(o),o},r.prototype.addShape=function(e,n){this.appendDelegateObject(e,n);var o=e.addShape(n);return this.get("isRegister")&&this.registerElement(o),o},r.prototype.addComponent=function(e,n){var o=n.id,s=n.component,l=__rest$1(n,["id","component"]),c=new s(__assign$8(__assign$8({},l),{id:o,container:e,updateAutoRender:this.get("updateAutoRender")}));return c.init(),c.render(),this.get("isRegister")&&this.registerElement(c.get("group")),c},r.prototype.initEvent=function(){},r.prototype.removeEvent=function(){var e=this.get("group");e.off()},r.prototype.getElementId=function(e){var n=this.get("id"),o=this.get("name");return n+"-"+o+"-"+e},r.prototype.registerElement=function(e){var n=e.get("id");this.get("shapesMap")[n]=e},r.prototype.unregisterElement=function(e){var n=e.get("id");delete this.get("shapesMap")[n]},r.prototype.moveElementTo=function(e,n){var o=getMatrixByTranslate(n);e.attr("matrix",o)},r.prototype.addAnimation=function(e,n,o){var s=n.attr("opacity");isNil(s)&&(s=1),n.attr("opacity",0),n.animate({opacity:s},o)},r.prototype.removeAnimation=function(e,n,o){n.animate({opacity:0},o)},r.prototype.updateAnimation=function(e,n,o,s){n.animate(o,s)},r.prototype.updateElements=function(e,n){var o=this,s=this.get("animate"),l=this.get("animateOption"),c=e.getChildren().slice(0),u;each$1(c,function(f){var d=f.get("id"),g=o.getElementById(d),p=f.get("name");if(g)if(f.get("isComponent")){var v=f.get("component"),m=g.get("component"),y=pick$1(v.cfg,difference(keys(v.cfg),COPY_PROPERTIES_EXCLUDES));m.update(y),g.set(STATUS_UPDATE,"update")}else{var x=o.getReplaceAttrs(g,f);s&&l.update?o.updateAnimation(p,g,x,l.update):g.attr(x),f.isGroup()&&o.updateElements(f,g),each$1(COPY_PROPERTIES,function(A){g.set(A,f.get(A))}),updateClip(g,f),u=g,g.set(STATUS_UPDATE,"update")}else{n.add(f);var _=n.getChildren();if(_.splice(_.length-1,1),u){var E=_.indexOf(u);_.splice(E+1,0,f)}else _.unshift(f);if(o.registerElement(f),f.set(STATUS_UPDATE,"add"),f.get("isComponent")){var v=f.get("component");v.set("container",n)}else f.isGroup()&&o.registerNewGroup(f);if(u=f,s){var S=o.get("isInit")?l.appear:l.enter;S&&o.addAnimation(p,f,S)}}})},r.prototype.clearUpdateStatus=function(e){var n=e.getChildren();each$1(n,function(o){o.set(STATUS_UPDATE,null)})},r.prototype.clearOffScreenCache=function(){var e=this.get("offScreenGroup");e&&e.destroy(),this.set("offScreenGroup",null),this.set("offScreenBBox",null)},r.prototype.getDelegateObject=function(){var e,n=this.get("name"),o=(e={},e[n]=this,e.component=this,e);return o},r.prototype.appendDelegateObject=function(e,n){var o=e.get("delegateObject");n.delegateObject||(n.delegateObject={}),mix(n.delegateObject,o)},r.prototype.getReplaceAttrs=function(e,n){var o=e.attr(),s=n.attr();return each$1(o,function(l,c){s[c]===void 0&&(s[c]=void 0)}),s},r.prototype.registerNewGroup=function(e){var n=this,o=e.getChildren();each$1(o,function(s){n.registerElement(s),s.set(STATUS_UPDATE,"add"),s.isGroup()&&n.registerNewGroup(s)})},r.prototype.deleteElements=function(){var e=this,n=this.get("shapesMap"),o=[];each$1(n,function(c,u){!c.get(STATUS_UPDATE)||c.destroyed?o.push([u,c]):c.set(STATUS_UPDATE,null)});var s=this.get("animate"),l=this.get("animateOption");each$1(o,function(c){var u=c[0],f=c[1];if(!f.destroyed){var d=f.get("name");if(s&&l.leave){var g=mix({callback:function(){e.removeElement(f)}},l.leave);e.removeAnimation(d,f,g)}else e.removeElement(f)}delete n[u]})},r.prototype.removeElement=function(e){if(e.get("isGroup")){var n=e.get("component");n&&n.destroy()}e.remove()},r}(Component),ELLIPSIS_CODE$1="…";function strLen(a){for(var r=0,e=0;e<a.length;e++)r+=charAtLength(a,e);return r}function charAtLength(a,r){return a.charCodeAt(r)>0&&a.charCodeAt(r)<128?1:2}function ellipsisString(a,r,e){e===void 0&&(e="tail");var n=a.length,o="";if(e==="tail"){for(var s=0,l=0;s<r;){var c=charAtLength(a,l);if(s+c<=r)o+=a[l],s+=charAtLength(a,l),l++;else break}o+=ELLIPSIS_CODE$1}else if(e==="head"){for(var s=0,l=n-1;s<r;){var c=charAtLength(a,l);if(s+c<=r)o+=a[l],s+=charAtLength(a,l),l--;else break}o=ELLIPSIS_CODE$1+o}else{for(var u="",f="",s=0,d=0,g=n-1;s<r;){var p=charAtLength(a,d),v=!1;p+s<=r&&(u+=a[d],d++,s+=p,v=!0);var m=charAtLength(a,g);if(m+s<=r&&(f=a[g]+f,s+=m,g--,v=!0),!v)break}o=u+ELLIPSIS_CODE$1+f}return o}var ELLIPSIS_CODE="…",ELLIPSIS_CODE_LENGTH=2,OPTIMIZE_THRESHOLD=400;function getMaxLabelWidthOptimized(a){for(var r=a.map(function(u){var f=u.attr("text");return isNil(f)?"":""+f}),e=0,n=0,o=0;o<r.length;o+=1){for(var s=0,l=0;l<=r[o].length;l+=1){var c=r[o].charCodeAt(l);c>=19968&&c<=40869?s+=2:s+=1}s>e&&(e=s,n=o)}return a[n].getBBox().width}function getMaxLabelWidth(a){if(a.length>OPTIMIZE_THRESHOLD)return getMaxLabelWidthOptimized(a);var r=0;return each$1(a,function(e){var n=e.getBBox(),o=n.width;r<o&&(r=o)}),r}function getLabelLength(a,r){var e=r.getCanvasBBox();return a?e.width:e.height}function ellipsisLabel(a,r,e,n){var o;n===void 0&&(n="tail");var s=(o=r.attr("text"))!==null&&o!==void 0?o:"";if(n==="tail"){var l=pick$1(r.attr(),["fontSize","fontFamily","fontWeight","fontStyle","fontVariant"]),c=getEllipsisText$1(s,e,l,"…");return s!==c?(r.attr("text",c),r.set("tip",s),!0):(r.set("tip",null),!1)}var u=getLabelLength(a,r),f=strLen(s),d=!1;if(e<u){var g=Math.floor(e/u*f)-ELLIPSIS_CODE_LENGTH,p=void 0;g>=0?p=ellipsisString(s,g,n):p=ELLIPSIS_CODE,p&&(r.attr("text",p),d=!0)}return d?r.set("tip",s):r.set("tip",null),d}function renderTag$1(a,r){var e=r.x,n=r.y,o=r.content,s=r.style,l=r.id,c=r.name,u=r.rotate,f=r.maxLength,d=r.autoEllipsis,g=r.isVertical,p=r.ellipsisPosition,v=r.background,m=a.addGroup({id:l+"-group",name:c+"-group",attrs:{x:e,y:n}}),y=m.addShape({type:"text",id:l,name:c,attrs:__assign$8({x:0,y:0,text:o},s)}),x=formatPadding(get(v,"padding",0));if(f&&d){var _=f-(x[1]+x[3]);ellipsisLabel(!g,y,_,p)}if(v){var E=get(v,"style",{}),S=y.getCanvasBBox(),A=S.minX,T=S.minY,b=S.width,C=S.height,L=m.addShape("rect",{id:l+"-bg",name:l+"-bg",attrs:__assign$8({x:A-x[3],y:T-x[0],width:b+x[1]+x[3],height:C+x[0]+x[2]},E)});L.toBack()}applyTranslate(m,e,n),applyRotate(m,u,e,n)}const Theme={fontFamily:`
  BlinkMacSystemFont, "Segoe UI", Roboto,"Helvetica Neue",
  Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei",
  SimSun, "sans-serif"`,textColor:"#2C3542",activeTextColor:"#333333",uncheckedColor:"#D8D8D8",lineColor:"#416180",regionColor:"#CCD7EB",verticalAxisRotate:-Math.PI/4,horizontalAxisRotate:Math.PI/4,descriptionIconStroke:"#fff",descriptionIconFill:"rgba(58, 73, 101, .25)"};var LineAnnotation=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"annotation",type:"line",locationType:"region",start:null,end:null,style:{},text:null,defaultCfg:{style:{fill:Theme.textColor,fontSize:12,textAlign:"center",textBaseline:"bottom",fontFamily:Theme.fontFamily},text:{position:"center",autoRotate:!0,content:null,offsetX:0,offsetY:0,style:{stroke:Theme.lineColor,lineWidth:1}}}})},r.prototype.renderInner=function(e){this.renderLine(e),this.get("text")&&this.renderLabel(e)},r.prototype.renderLine=function(e){var n=this.get("start"),o=this.get("end"),s=this.get("style");this.addShape(e,{type:"line",id:this.getElementId("line"),name:"annotation-line",attrs:__assign$8({x1:n.x,y1:n.y,x2:o.x,y2:o.y},s)})},r.prototype.getLabelPoint=function(e,n,o){var s;return o==="start"?s=0:o==="center"?s=.5:isString$1(o)&&o.indexOf("%")!==-1?s=parseInt(o,10)/100:isNumber$2(o)?s=o:s=1,(s>1||s<0)&&(s=1),{x:getValueByPercent(e.x,n.x,s),y:getValueByPercent(e.y,n.y,s)}},r.prototype.renderLabel=function(e){var n=this.get("text"),o=this.get("start"),s=this.get("end"),l=n.position,c=n.content,u=n.style,f=n.offsetX,d=n.offsetY,g=n.autoRotate,p=n.maxLength,v=n.autoEllipsis,m=n.ellipsisPosition,y=n.background,x=n.isVertical,_=x===void 0?!1:x,E=this.getLabelPoint(o,s,l),S=E.x+f,A=E.y+d,T={id:this.getElementId("line-text"),name:"annotation-line-text",x:S,y:A,content:c,style:u,maxLength:p,autoEllipsis:v,ellipsisPosition:m,background:y,isVertical:_};if(g){var b=[s.x-o.x,s.y-o.y];T.rotate=Math.atan2(b[1],b[0])}renderTag$1(e,T)},r}(GroupComponent),TextAnnotation=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"annotation",type:"text",locationType:"point",x:0,y:0,content:"",rotate:null,style:{},background:null,maxLength:null,autoEllipsis:!0,isVertical:!1,ellipsisPosition:"tail",defaultCfg:{style:{fill:Theme.textColor,fontSize:12,textAlign:"center",textBaseline:"middle",fontFamily:Theme.fontFamily}}})},r.prototype.setLocation=function(e){this.set("x",e.x),this.set("y",e.y),this.resetLocation()},r.prototype.renderInner=function(e){var n=this.getLocation(),o=n.x,s=n.y,l=this.get("content"),c=this.get("style"),u=this.getElementId("text"),f=this.get("name")+"-text",d=this.get("maxLength"),g=this.get("autoEllipsis"),p=this.get("isVertical"),v=this.get("ellipsisPosition"),m=this.get("background"),y=this.get("rotate"),x={id:u,name:f,x:o,y:s,content:l,style:c,maxLength:d,autoEllipsis:g,isVertical:p,ellipsisPosition:v,background:m,rotate:y};renderTag$1(e,x)},r.prototype.resetLocation=function(){var e=this.getElementByLocalId("text-group");if(e){var n=this.getLocation(),o=n.x,s=n.y,l=this.get("rotate");applyTranslate(e,o,s),applyRotate(e,l,o,s)}},r}(GroupComponent),ArcAnnotation=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"annotation",type:"arc",locationType:"circle",center:null,radius:100,startAngle:-Math.PI/2,endAngle:Math.PI*3/2,style:{stroke:"#999",lineWidth:1}})},r.prototype.renderInner=function(e){this.renderArc(e)},r.prototype.getArcPath=function(){var e=this.getLocation(),n=e.center,o=e.radius,s=e.startAngle,l=e.endAngle,c=getCirclePoint(n,o,s),u=getCirclePoint(n,o,l),f=l-s>Math.PI?1:0,d=[["M",c.x,c.y]];if(l-s===Math.PI*2){var g=getCirclePoint(n,o,s+Math.PI);d.push(["A",o,o,0,f,1,g.x,g.y]),d.push(["A",o,o,0,f,1,u.x,u.y])}else d.push(["A",o,o,0,f,1,u.x,u.y]);return d},r.prototype.renderArc=function(e){var n=this.getArcPath(),o=this.get("style");this.addShape(e,{type:"path",id:this.getElementId("arc"),name:"annotation-arc",attrs:__assign$8({path:n},o)})},r}(GroupComponent),RegionAnnotation=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"annotation",type:"region",locationType:"region",start:null,end:null,style:{},defaultCfg:{style:{lineWidth:0,fill:Theme.regionColor,opacity:.4}}})},r.prototype.renderInner=function(e){this.renderRegion(e)},r.prototype.renderRegion=function(e){var n=this.get("start"),o=this.get("end"),s=this.get("style"),l=regionToBBox({start:n,end:o});this.addShape(e,{type:"rect",id:this.getElementId("region"),name:"annotation-region",attrs:__assign$8({x:l.x,y:l.y,width:l.width,height:l.height},s)})},r}(GroupComponent),ImageAnnotation=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"annotation",type:"image",locationType:"region",start:null,end:null,src:null,style:{}})},r.prototype.renderInner=function(e){this.renderImage(e)},r.prototype.getImageAttrs=function(){var e=this.get("start"),n=this.get("end"),o=this.get("style"),s=regionToBBox({start:e,end:n}),l=this.get("src");return __assign$8({x:s.x,y:s.y,img:l,width:s.width,height:s.height},o)},r.prototype.renderImage=function(e){this.addShape(e,{type:"image",id:this.getElementId("image"),name:"annotation-image",attrs:this.getImageAttrs()})},r}(GroupComponent),DataMarkerAnnotation=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"annotation",type:"dataMarker",locationType:"point",x:0,y:0,point:{},line:{},text:{},direction:"upward",autoAdjust:!0,coordinateBBox:null,defaultCfg:{point:{display:!0,style:{r:3,fill:"#FFFFFF",stroke:"#1890FF",lineWidth:2}},line:{display:!0,length:20,style:{stroke:Theme.lineColor,lineWidth:1}},text:{content:"",display:!0,style:{fill:Theme.textColor,opacity:.65,fontSize:12,textAlign:"start",fontFamily:Theme.fontFamily}}}})},r.prototype.renderInner=function(e){get(this.get("line"),"display")&&this.renderLine(e),get(this.get("text"),"display")&&this.renderText(e),get(this.get("point"),"display")&&this.renderPoint(e),this.get("autoAdjust")&&this.autoAdjust(e)},r.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x")+this.get("offsetX"),y:this.get("y")+this.get("offsetY")})},r.prototype.renderPoint=function(e){var n=this.getShapeAttrs().point;this.addShape(e,{type:"circle",id:this.getElementId("point"),name:"annotation-point",attrs:n})},r.prototype.renderLine=function(e){var n=this.getShapeAttrs().line;this.addShape(e,{type:"path",id:this.getElementId("line"),name:"annotation-line",attrs:n})},r.prototype.renderText=function(e){var n=this.getShapeAttrs().text,o=n.x,s=n.y,l=n.text,c=__rest$1(n,["x","y","text"]),u=this.get("text"),f=u.background,d=u.maxLength,g=u.autoEllipsis,p=u.isVertival,v=u.ellipsisPosition,m={x:o,y:s,id:this.getElementId("text"),name:"annotation-text",content:l,style:c,background:f,maxLength:d,autoEllipsis:g,isVertival:p,ellipsisPosition:v};renderTag$1(e,m)},r.prototype.autoAdjust=function(e){var n=this.get("direction"),o=this.get("x"),s=this.get("y"),l=get(this.get("line"),"length",0),c=this.get("coordinateBBox"),u=e.getBBox(),f=u.minX,d=u.maxX,g=u.minY,p=u.maxY,v=e.findById(this.getElementId("text-group")),m=e.findById(this.getElementId("text")),y=e.findById(this.getElementId("line"));if(c&&v){var x=v.attr("x"),_=v.attr("y"),E=m.getCanvasBBox(),S=E.width,A=E.height,T=0,b=0;if(o+f<=c.minX)if(n==="leftward")T=1;else{var C=c.minX-(o+f);x=v.attr("x")+C}else if(o+d>=c.maxX)if(n==="rightward")T=-1;else{var C=o+d-c.maxX;x=v.attr("x")-C}if(T&&(y&&y.attr("path",[["M",0,0],["L",l*T,0]]),x=(l+2+S)*T),s+g<=c.minY)if(n==="upward")b=1;else{var C=c.minY-(s+g);_=v.attr("y")+C}else if(s+p>=c.maxY)if(n==="downward")b=-1;else{var C=s+p-c.maxY;_=v.attr("y")-C}b&&(y&&y.attr("path",[["M",0,0],["L",0,l*b]]),_=(l+2+A)*b),(x!==v.attr("x")||_!==v.attr("y"))&&applyTranslate(v,x,_)}},r.prototype.getShapeAttrs=function(){var e=get(this.get("line"),"display"),n=get(this.get("point"),"style",{}),o=get(this.get("line"),"style",{}),s=get(this.get("text"),"style",{}),l=this.get("direction"),c=e?get(this.get("line"),"length",0):0,u=0,f=0,d="top",g="start";switch(l){case"upward":f=-1,d="bottom";break;case"downward":f=1,d="top";break;case"leftward":u=-1,g="end";break;case"rightward":u=1,g="start";break}return{point:__assign$8({x:0,y:0},n),line:__assign$8({path:[["M",0,0],["L",c*u,c*f]]},o),text:__assign$8({x:(c+2)*u,y:(c+2)*f,text:get(this.get("text"),"content",""),textBaseline:d,textAlign:g},s)}},r}(GroupComponent),DataRegionAnnotation=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"annotation",type:"dataRegion",locationType:"points",points:[],lineLength:0,region:{},text:{},defaultCfg:{region:{style:{lineWidth:0,fill:Theme.regionColor,opacity:.4}},text:{content:"",style:{textAlign:"center",textBaseline:"bottom",fontSize:12,fill:Theme.textColor,fontFamily:Theme.fontFamily}}}})},r.prototype.renderInner=function(e){var n=get(this.get("region"),"style",{});get(this.get("text"),"style",{});var o=this.get("lineLength")||0,s=this.get("points");if(s.length){var l=pointsToBBox(s),c=[];c.push(["M",s[0].x,l.minY-o]),s.forEach(function(f){c.push(["L",f.x,f.y])}),c.push(["L",s[s.length-1].x,s[s.length-1].y-o]),this.addShape(e,{type:"path",id:this.getElementId("region"),name:"annotation-region",attrs:__assign$8({path:c},n)});var u=__assign$8({id:this.getElementId("text"),name:"annotation-text",x:(l.minX+l.maxX)/2,y:l.minY-o},this.get("text"));renderTag$1(e,u)}},r}(GroupComponent),RegionFilterAnnotation=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"annotation",type:"regionFilter",locationType:"region",start:null,end:null,color:null,shape:[]})},r.prototype.renderInner=function(e){var n=this,o=this.get("start"),s=this.get("end"),l=this.addGroup(e,{id:this.getElementId("region-filter"),capture:!1});each$1(this.get("shapes"),function(u,f){var d=u.get("type"),g=clone(u.attr());n.adjustShapeAttrs(g),n.addShape(l,{id:n.getElementId("shape-"+d+"-"+f),capture:!1,type:d,attrs:g})});var c=regionToBBox({start:o,end:s});l.setClip({type:"rect",attrs:{x:c.minX,y:c.minY,width:c.width,height:c.height}})},r.prototype.adjustShapeAttrs=function(e){var n=this.get("color");e.fill&&(e.fill=e.fillStyle=n),e.stroke=e.strokeStyle=n},r}(GroupComponent),ShapeAnnotation=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"annotation",type:"shape",draw:noop$1})},r.prototype.renderInner=function(e){var n=this.get("render");isFunction$1(n)&&n(e)},r}(GroupComponent),HtmlComponent=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{container:null,containerTpl:"<div></div>",updateAutoRender:!0,containerClassName:"",parent:null})},r.prototype.getContainer=function(){return this.get("container")},r.prototype.show=function(){var e=this.get("container");e.style.display="",this.set("visible",!0)},r.prototype.hide=function(){var e=this.get("container");e.style.display="none",this.set("visible",!1)},r.prototype.setCapture=function(e){var n=this.getContainer(),o=e?"auto":"none";n.style.pointerEvents=o,this.set("capture",e)},r.prototype.getBBox=function(){var e=this.getContainer(),n=parseFloat(e.style.left)||0,o=parseFloat(e.style.top)||0;return createBBox(n,o,e.clientWidth,e.clientHeight)},r.prototype.clear=function(){var e=this.get("container");clearDom(e)},r.prototype.destroy=function(){this.removeEvent(),this.removeDom(),a.prototype.destroy.call(this)},r.prototype.init=function(){a.prototype.init.call(this),this.initContainer(),this.initDom(),this.resetStyles(),this.applyStyles(),this.initEvent(),this.initCapture(),this.initVisible()},r.prototype.initCapture=function(){this.setCapture(this.get("capture"))},r.prototype.initVisible=function(){this.get("visible")?this.show():this.hide()},r.prototype.initDom=function(){},r.prototype.initContainer=function(){var e=this.get("container");if(isNil(e)){e=this.createDom();var n=this.get("parent");isString$1(n)&&(n=document.getElementById(n),this.set("parent",n)),n.appendChild(e),this.get("containerId")&&e.setAttribute("id",this.get("containerId")),this.set("container",e)}else isString$1(e)&&(e=document.getElementById(e),this.set("container",e));this.get("parent")||this.set("parent",e.parentNode)},r.prototype.resetStyles=function(){var e=this.get("domStyles"),n=this.get("defaultStyles");e?e=deepMix({},n,e):e=n,this.set("domStyles",e)},r.prototype.applyStyles=function(){var e=this.get("domStyles");if(e){var n=this.getContainer();this.applyChildrenStyles(n,e);var o=this.get("containerClassName");if(o&&hasClass$1(n,o)){var s=e[o];modifyCSS(n,s)}}},r.prototype.applyChildrenStyles=function(e,n){each$1(n,function(o,s){var l=e.getElementsByClassName(s);each$1(l,function(c){modifyCSS(c,o)})})},r.prototype.applyStyle=function(e,n){var o=this.get("domStyles");modifyCSS(n,o[e])},r.prototype.createDom=function(){var e=this.get("containerTpl");return createDom$1(e)},r.prototype.initEvent=function(){},r.prototype.removeDom=function(){var e=this.get("container");e&&e.parentNode&&e.parentNode.removeChild(e)},r.prototype.removeEvent=function(){},r.prototype.updateInner=function(e){has(e,"domStyles")&&(this.resetStyles(),this.applyStyles()),this.resetPosition()},r.prototype.resetPosition=function(){},r}(Component),HtmlAnnotation=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"annotation",type:"html",locationType:"point",x:0,y:0,containerTpl:'<div class="g2-html-annotation" style="position:absolute"></div>',alignX:"left",alignY:"top",html:"",zIndex:7})},r.prototype.render=function(){var e=this.getContainer(),n=this.get("html");clearDom(e);var o=isFunction$1(n)?n(e):n;if(isElement(o))e.appendChild(o);else if(isString$1(o)||isNumber$2(o)){var s=createDom$1(""+o);s&&e.appendChild(s)}this.resetPosition()},r.prototype.resetPosition=function(){var e=this.getContainer(),n=this.getLocation(),o=n.x,s=n.y,l=this.get("alignX"),c=this.get("alignY"),u=this.get("offsetX"),f=this.get("offsetY"),d=getOuterWidth(e),g=getOuterHeight(e),p={x:o,y:s};l==="middle"?p.x-=Math.round(d/2):l==="right"&&(p.x-=Math.round(d)),c==="middle"?p.y-=Math.round(g/2):c==="bottom"&&(p.y-=Math.round(g)),u&&(p.x+=u),f&&(p.y+=f),modifyCSS(e,{position:"absolute",left:p.x+"px",top:p.y+"px",zIndex:this.get("zIndex")})},r}(HtmlComponent);const AnnotationComponent=Object.freeze(Object.defineProperty({__proto__:null,Arc:ArcAnnotation,DataMarker:DataMarkerAnnotation,DataRegion:DataRegionAnnotation,Html:HtmlAnnotation,Image:ImageAnnotation,Line:LineAnnotation,Region:RegionAnnotation,RegionFilter:RegionFilterAnnotation,Shape:ShapeAnnotation,Text:TextAnnotation},Symbol.toStringTag,{value:"Module"}));function getStatesStyle(a,r,e){var n=r+"Style",o=null;return each$1(e,function(s,l){a[l]&&s[n]&&(o||(o={}),mix(o,s[n]))}),o}var AxisBase=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"axis",ticks:[],line:{},tickLine:{},subTickLine:null,title:null,label:{},verticalFactor:1,verticalLimitLength:null,overlapOrder:["autoRotate","autoEllipsis","autoHide"],tickStates:{},optimize:{},defaultCfg:{line:{style:{lineWidth:1,stroke:Theme.lineColor}},tickLine:{style:{lineWidth:1,stroke:Theme.lineColor},alignTick:!0,length:5,displayWithLabel:!0},subTickLine:{style:{lineWidth:1,stroke:Theme.lineColor},count:4,length:2},label:{autoRotate:!0,autoHide:!1,autoEllipsis:!1,style:{fontSize:12,fill:Theme.textColor,fontFamily:Theme.fontFamily,fontWeight:"normal"},offset:10,offsetX:0,offsetY:0},title:{autoRotate:!0,spacing:5,position:"center",style:{fontSize:12,fill:Theme.textColor,textBaseline:"middle",fontFamily:Theme.fontFamily,textAlign:"center"},iconStyle:{fill:Theme.descriptionIconFill,stroke:Theme.descriptionIconStroke},description:""},tickStates:{active:{labelStyle:{fontWeight:500},tickLineStyle:{lineWidth:2}},inactive:{labelStyle:{fill:Theme.uncheckedColor}}},optimize:{enable:!0,threshold:400}},theme:{}})},r.prototype.renderInner=function(e){this.get("line")&&this.drawLine(e),this.drawTicks(e),this.get("title")&&this.drawTitle(e)},r.prototype.isList=function(){return!0},r.prototype.getItems=function(){return this.get("ticks")},r.prototype.setItems=function(e){this.update({ticks:e})},r.prototype.updateItem=function(e,n){mix(e,n),this.clear(),this.render()},r.prototype.clearItems=function(){var e=this.getElementByLocalId("label-group");e&&e.clear()},r.prototype.setItemState=function(e,n,o){e[n]=o,this.updateTickStates(e)},r.prototype.hasState=function(e,n){return!!e[n]},r.prototype.getItemStates=function(e){var n=this.get("tickStates"),o=[];return each$1(n,function(s,l){e[l]&&o.push(l)}),o},r.prototype.clearItemsState=function(e){var n=this,o=this.getItemsByState(e);each$1(o,function(s){n.setItemState(s,e,!1)})},r.prototype.getItemsByState=function(e){var n=this,o=this.getItems();return filter(o,function(s){return n.hasState(s,e)})},r.prototype.getSidePoint=function(e,n){var o=this,s=o.getSideVector(n,e);return{x:e.x+s[0],y:e.y+s[1]}},r.prototype.getTextAnchor=function(e){var n;return isNumberEqual$1(e[0],0)?n="center":e[0]>0?n="start":e[0]<0&&(n="end"),n},r.prototype.getTextBaseline=function(e){var n;return isNumberEqual$1(e[1],0)?n="middle":e[1]>0?n="top":e[1]<0&&(n="bottom"),n},r.prototype.processOverlap=function(e){},r.prototype.drawLine=function(e){var n=this.getLinePath(),o=this.get("line");this.addShape(e,{type:"path",id:this.getElementId("line"),name:"axis-line",attrs:mix({path:n},o.style)})},r.prototype.getTickLineItems=function(e){var n=this,o=[],s=this.get("tickLine"),l=s.alignTick,c=s.length,u=1,f=e.length;return f>=2&&(u=e[1].value-e[0].value),each$1(e,function(d){var g=d.point;l||(g=n.getTickPoint(d.value-u/2));var p=n.getSidePoint(g,c);o.push({startPoint:g,tickValue:d.value,endPoint:p,tickId:d.id,id:"tickline-"+d.id})}),o},r.prototype.getSubTickLineItems=function(e){var n=[],o=this.get("subTickLine"),s=o.count,l=e.length;if(l>=2)for(var c=0;c<l-1;c++)for(var u=e[c],f=e[c+1],d=0;d<s;d++){var g=(d+1)/(s+1),p=(1-g)*u.tickValue+g*f.tickValue,v=this.getTickPoint(p),m=this.getSidePoint(v,o.length);n.push({startPoint:v,endPoint:m,tickValue:p,id:"sub-"+u.id+"-"+d})}return n},r.prototype.getTickLineAttrs=function(e,n,o,s){var l=this.get(n).style,c={points:[e.startPoint,e.endPoint]},u=get(this.get("theme"),["tickLine","style"],{});l=isFunction$1(l)?mix({},u,l(c,o,s)):l;var f=e.startPoint,d=e.endPoint;return __assign$8({x1:f.x,y1:f.y,x2:d.x,y2:d.y},l)},r.prototype.drawTick=function(e,n,o,s,l){this.addShape(n,{type:"line",id:this.getElementId(e.id),name:"axis-"+o,attrs:this.getTickLineAttrs(e,o,s,l)})},r.prototype.drawTickLines=function(e){var n=this,o=this.get("ticks"),s=this.get("subTickLine"),l=this.getTickLineItems(o),c=this.addGroup(e,{name:"axis-tickline-group",id:this.getElementId("tickline-group")}),u=this.get("tickLine");if(each$1(l,function(d,g){if(u.displayWithLabel){var p=n.getElementId("label-"+d.tickId);e.findById(p)&&n.drawTick(d,c,"tickLine",g,l)}else n.drawTick(d,c,"tickLine",g,l)}),s){var f=this.getSubTickLineItems(l);each$1(f,function(d,g){n.drawTick(d,c,"subTickLine",g,f)})}},r.prototype.processTicks=function(){var e=this,n=this.get("ticks");each$1(n,function(o){o.point=e.getTickPoint(o.value),isNil(o.id)&&(o.id=o.name)})},r.prototype.drawTicks=function(e){var n=this;this.optimizeTicks(),this.processTicks(),this.get("label")&&this.drawLabels(e),this.get("tickLine")&&this.drawTickLines(e);var o=this.get("ticks");each$1(o,function(s){n.applyTickStates(s,e)})},r.prototype.optimizeTicks=function(){var e=this.get("optimize"),n=this.get("ticks");if(e&&e.enable&&e.threshold>0){var o=size(n);if(o>e.threshold){var s=Math.ceil(o/e.threshold),l=n.filter(function(c,u){return u%s===0});this.set("ticks",l),this.set("originalTicks",n)}}},r.prototype.getLabelAttrs=function(e,n,o){var s=this.get("label"),l=s.offset,c=s.offsetX,u=s.offsetY,f=s.rotate,d=s.formatter,g=this.getSidePoint(e.point,l),p=this.getSideVector(l,g),v=d?d(e.name,e,n):e.name,m=s.style;m=isFunction$1(m)?get(this.get("theme"),["label","style"],{}):m;var y=mix({x:g.x+c,y:g.y+u,text:v,textAlign:this.getTextAnchor(p),textBaseline:this.getTextBaseline(p)},m);return f&&(y.matrix=getMatrixByAngle(g,f)),y},r.prototype.drawLabels=function(e){var n=this,o=this.get("ticks"),s=this.addGroup(e,{name:"axis-label-group",id:this.getElementId("label-group")});each$1(o,function(p,v){n.addShape(s,{type:"text",name:"axis-label",id:n.getElementId("label-"+p.id),attrs:n.getLabelAttrs(p,v,o),delegateObject:{tick:p,item:p,index:v}})}),this.processOverlap(s);var l=s.getChildren(),c=get(this.get("theme"),["label","style"],{}),u=this.get("label"),f=u.style,d=u.formatter;if(isFunction$1(f)){var g=l.map(function(p){return get(p.get("delegateObject"),"tick")});each$1(l,function(p,v){var m=p.get("delegateObject").tick,y=d?d(m.name,m,v):m.name,x=mix({},c,f(y,v,g));p.attr(x)})}},r.prototype.getTitleAttrs=function(){var e=this.get("title"),n=e.style,o=e.position,s=e.offset,l=e.spacing,c=l===void 0?0:l,u=e.autoRotate,f=n.fontSize,d=.5;o==="start"?d=0:o==="end"&&(d=1);var g=this.getTickPoint(d),p=this.getSidePoint(g,s||c+f/2),v=mix({x:p.x,y:p.y,text:e.text},n),m=e.rotate,y=m;if(isNil(m)&&u){var x=this.getAxisVector(g),_=[1,0];y=angleTo(x,_,!0)}if(y){var E=getMatrixByAngle(p,y);v.matrix=E}return v},r.prototype.drawTitle=function(e){var n,o=this.getTitleAttrs(),s=this.addShape(e,{type:"text",id:this.getElementId("title"),name:"axis-title",attrs:o});!((n=this.get("title"))===null||n===void 0)&&n.description&&this.drawDescriptionIcon(e,s,o.matrix)},r.prototype.drawDescriptionIcon=function(e,n,o){var s=this.addGroup(e,{name:"axis-description",id:this.getElementById("description")}),l=n.getBBox(),c=l.maxX,u=l.maxY,f=l.height,d=this.get("title").iconStyle,g=4,p=f/2,v=p/6,m=c+g,y=u-f/2,x=[m+p,y-p],_=x[0],E=x[1],S=[_+p,E+p],A=S[0],T=S[1],b=[_,T+p],C=b[0],L=b[1],R=[m,E+p],I=R[0],w=R[1],M=[m+p,y-f/4],D=M[0],O=M[1],F=[D,O+v],k=F[0],$=F[1],V=[k,$+v],N=V[0],B=V[1],G=[N,B+p*3/4],z=G[0],H=G[1];this.addShape(s,{type:"path",id:this.getElementId("title-description-icon"),name:"axis-title-description-icon",attrs:__assign$8({path:[["M",_,E],["A",p,p,0,0,1,A,T],["A",p,p,0,0,1,C,L],["A",p,p,0,0,1,I,w],["A",p,p,0,0,1,_,E],["M",D,O],["L",k,$],["M",N,B],["L",z,H]],lineWidth:v,matrix:o},d)}),this.addShape(s,{type:"rect",id:this.getElementId("title-description-rect"),name:"axis-title-description-rect",attrs:{x:m,y:y-f/2,width:f,height:f,stroke:"#000",fill:"#000",opacity:0,matrix:o,cursor:"pointer"}})},r.prototype.applyTickStates=function(e,n){var o=this.getItemStates(e);if(o.length){var s=this.get("tickStates"),l=this.getElementId("label-"+e.id),c=n.findById(l);if(c){var u=getStatesStyle(e,"label",s);u&&c.attr(u)}var f=this.getElementId("tickline-"+e.id),d=n.findById(f);if(d){var g=getStatesStyle(e,"tickLine",s);g&&d.attr(g)}}},r.prototype.updateTickStates=function(e){var n=this.getItemStates(e),o=this.get("tickStates"),s=this.get("label"),l=this.getElementByLocalId("label-"+e.id),c=this.get("tickLine"),u=this.getElementByLocalId("tickline-"+e.id);if(n.length){if(l){var f=getStatesStyle(e,"label",o);f&&l.attr(f)}if(u){var d=getStatesStyle(e,"tickLine",o);d&&u.attr(d)}}else l&&l.attr(s.style),u&&u.attr(c.style)},r}(GroupComponent);function ellipseLabels(a,r,e,n){var o=r.getChildren(),s=!1;return each$1(o,function(l){var c=ellipsisLabel(a,l,e,n);s=s||c}),s}function getDefault$2(){return ellipsisTail}function ellipsisHead(a,r,e){return ellipseLabels(a,r,e,"head")}function ellipsisTail(a,r,e){return ellipseLabels(a,r,e,"tail")}function ellipsisMiddle(a,r,e){return ellipseLabels(a,r,e,"middle")}const autoEllipsis=Object.freeze(Object.defineProperty({__proto__:null,ellipsisHead,ellipsisMiddle,ellipsisTail,getDefault:getDefault$2},Symbol.toStringTag,{value:"Module"}));function isRotate(a){var r=a.attr("matrix");return r&&r[0]!==1}function getRotateAngle(a){var r=isRotate(a)?getAngleByMatrix(a.attr("matrix")):0;return r%360}function isOverlap(a,r,e,n){var o=!1,s=getRotateAngle(r),l=Math.abs(a?e.attr("y")-r.attr("y"):e.attr("x")-r.attr("x")),c=(a?e.attr("y")>r.attr("y"):e.attr("x")>r.attr("x"))?r.getBBox():e.getBBox();if(a){var u=Math.abs(Math.cos(s));near(u,0,Math.PI/180)?o=c.width+n>l:o=c.height/u+n>l}else{var u=Math.abs(Math.sin(s));near(u,0,Math.PI/180)?o=c.width+n>l:o=c.height/u+n>l}return o}function reserveOne(a,r,e,n){var o=(n==null?void 0:n.minGap)||0,s=r.getChildren().slice().filter(function(v){return v.get("visible")});if(!s.length)return!1;var l=!1;e&&s.reverse();for(var c=s.length,u=s[0],f=u,d=1;d<c;d++){var g=s[d];g.getBBox();var p=isOverlap(a,f,g,o);p?(g.hide(),l=!0):f=g}return l}function parityHide(a,r,e){var n=(e==null?void 0:e.minGap)||0,o=r.getChildren().slice();if(o.length<2)return!1;var s=!1,l=o[0],c=l.getBBox(),u=o[1],f=o.length,d=getRotateAngle(l),g=Math.abs(a?u.attr("y")-l.attr("y"):u.attr("x")-l.attr("x")),p=0;if(a){var v=Math.abs(Math.cos(d));if(near(v,0,Math.PI/180)){var m=getMaxLabelWidth(o);p=(m+n)/g}else p=(c.height/v+n)/g}else{var v=Math.abs(Math.sin(d));if(near(v,0,Math.PI/180)){var m=getMaxLabelWidth(o);p=(m+n)/g}else p=(c.height/v+n)/g}if(p>1){p=Math.ceil(p);for(var y=0;y<f;y++)y%p!==0&&(o[y].hide(),s=!0)}return s}function getDefault$1(){return equidistance}function reserveFirst(a,r,e,n){return reserveOne(a,r,!1,n)}function reserveLast(a,r,e,n){return reserveOne(a,r,!0,n)}function reserveBoth(a,r,e,n){var o=(n==null?void 0:n.minGap)||0,s=r.getChildren().slice();if(s.length<=2)return!1;for(var l=!1,c=s.length,u=s[0],f=s[c-1],d=u,g=1;g<c-1;g++){var p=s[g];p.getBBox();var v=isOverlap(a,d,p,o);v?(p.hide(),l=!0):d=p}var m=isOverlap(a,d,f,o);return m&&(d.hide(),l=!0),l}function equidistance(a,r,e,n){var o=parityHide(a,r,n);return reserveOne(a,r,!1)&&(o=!0),o}function equidistanceWithReverseBoth(a,r,e,n){var o=r.getChildren().slice(),s=parityHide(a,r,n);if(o.length>2){var l=o[0],c=o[o.length-1];l.get("visible")||(l.show(),reserveOne(a,r,!1,n)&&(s=!0)),c.get("visible")||(c.show(),reserveOne(a,r,!0,n)&&(s=!0))}return s}const autoHide=Object.freeze(Object.defineProperty({__proto__:null,equidistance,equidistanceWithReverseBoth,getDefault:getDefault$1,reserveBoth,reserveFirst,reserveLast},Symbol.toStringTag,{value:"Module"}));function setLabelsAngle(a,r){each$1(a,function(e){var n=e.attr("x"),o=e.attr("y"),s=getMatrixByAngle({x:n,y:o},r);e.attr("matrix",s)})}function labelRotate(a,r,e,n){var o=r.getChildren();if(!o.length||!a&&o.length<2)return!1;var s=getMaxLabelWidth(o),l=!1;if(a)l=!!e&&s>e;else{var c=Math.abs(o[1].attr("x")-o[0].attr("x"));l=s>c}if(l){var u=n(e,s);setLabelsAngle(o,u)}return l}function getDefault(){return fixedAngle}function fixedAngle(a,r,e,n){return labelRotate(a,r,e,function(){return isNumber$2(n)?n:a?Theme.verticalAxisRotate:Theme.horizontalAxisRotate})}function unfixedAngle(a,r,e){return labelRotate(a,r,e,function(n,o){if(!n)return a?Theme.verticalAxisRotate:Theme.horizontalAxisRotate;if(a)return-Math.acos(n/o);var s=0;return n>o?s=Math.PI/4:(s=Math.asin(n/o),s>Math.PI/4&&(s=Math.PI/4)),s})}const autoRotate=Object.freeze(Object.defineProperty({__proto__:null,fixedAngle,getDefault,unfixedAngle},Symbol.toStringTag,{value:"Module"})),OverlapUtil=Object.freeze(Object.defineProperty({__proto__:null,autoEllipsis,autoHide,autoRotate},Symbol.toStringTag,{value:"Module"}));var Line$5=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{type:"line",locationType:"region",start:null,end:null})},r.prototype.getLinePath=function(){var e=this.get("start"),n=this.get("end"),o=[];return o.push(["M",e.x,e.y]),o.push(["L",n.x,n.y]),o},r.prototype.getInnerLayoutBBox=function(){var e=this.get("start"),n=this.get("end"),o=a.prototype.getInnerLayoutBBox.call(this),s=Math.min(e.x,n.x,o.x),l=Math.min(e.y,n.y,o.y),c=Math.max(e.x,n.x,o.maxX),u=Math.max(e.y,n.y,o.maxY);return{x:s,y:l,minX:s,minY:l,maxX:c,maxY:u,width:c-s,height:u-l}},r.prototype.isVertical=function(){var e=this.get("start"),n=this.get("end");return isNumberEqual$1(e.x,n.x)},r.prototype.isHorizontal=function(){var e=this.get("start"),n=this.get("end");return isNumberEqual$1(e.y,n.y)},r.prototype.getTickPoint=function(e){var n=this,o=n.get("start"),s=n.get("end"),l=s.x-o.x,c=s.y-o.y;return{x:o.x+l*e,y:o.y+c*e}},r.prototype.getSideVector=function(e){var n=this.getAxisVector(),o=normalize([0,0],n),s=this.get("verticalFactor"),l=[o[1],o[0]*-1];return scale$3([0,0],l,e*s)},r.prototype.getAxisVector=function(){var e=this.get("start"),n=this.get("end");return[n.x-e.x,n.y-e.y]},r.prototype.processOverlap=function(e){var n=this,o=this.isVertical(),s=this.isHorizontal();if(!(!o&&!s)){var l=this.get("label"),c=this.get("title"),u=this.get("verticalLimitLength"),f=l.offset,d=u,g=0,p=0;c&&(g=c.style.fontSize,p=c.spacing),d&&(d=d-f-p-g);var v=this.get("overlapOrder");if(each$1(v,function(x){l[x]&&n.canProcessOverlap(x)&&n.autoProcessOverlap(x,l[x],e,d)}),c&&isNil(c.offset)){var m=e.getCanvasBBox(),y=o?m.width:m.height;c.offset=f+y+p+g/2}}},r.prototype.canProcessOverlap=function(e){var n=this.get("label");return e==="autoRotate"?isNil(n.rotate):!0},r.prototype.autoProcessOverlap=function(e,n,o,s){var l=this,c=this.isVertical(),u=!1,f=OverlapUtil[e];if(n===!0)this.get("label"),u=f.getDefault()(c,o,s);else if(isFunction$1(n))u=n(c,o,s);else if(isObject$1(n)){var d=n;f[d.type]&&(u=f[d.type](c,o,s,d.cfg))}else f[n]&&(u=f[n](c,o,s));if(e==="autoRotate"){if(u){var g=o.getChildren(),p=this.get("verticalFactor");each$1(g,function(m){var y=m.attr("textAlign");if(y==="center"){var x=p>0?"end":"start";m.attr("textAlign",x)}})}}else if(e==="autoHide"){var v=o.getChildren().slice(0);each$1(v,function(m){m.get("visible")||(l.get("isRegister")&&l.unregisterElement(m),m.remove())})}},r}(AxisBase),Circle$4=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{type:"circle",locationType:"circle",center:null,radius:null,startAngle:-Math.PI/2,endAngle:Math.PI*3/2})},r.prototype.getLinePath=function(){var e=this.get("center"),n=e.x,o=e.y,s=this.get("radius"),l=s,c=this.get("startAngle"),u=this.get("endAngle"),f=[];if(Math.abs(u-c)===Math.PI*2)f=[["M",n,o-l],["A",s,l,0,1,1,n,o+l],["A",s,l,0,1,1,n,o-l],["Z"]];else{var d=this.getCirclePoint(c),g=this.getCirclePoint(u),p=Math.abs(u-c)>Math.PI?1:0,v=c>u?0:1;f=[["M",n,o],["L",d.x,d.y],["A",s,l,0,p,v,g.x,g.y],["L",n,o]]}return f},r.prototype.getTickPoint=function(e){var n=this.get("startAngle"),o=this.get("endAngle"),s=n+(o-n)*e;return this.getCirclePoint(s)},r.prototype.getSideVector=function(e,n){var o=this.get("center"),s=[n.x-o.x,n.y-o.y],l=this.get("verticalFactor"),c=length(s);return scale$3(s,s,l*e/c),s},r.prototype.getAxisVector=function(e){var n=this.get("center"),o=[e.x-n.x,e.y-n.y];return[o[1],-1*o[0]]},r.prototype.getCirclePoint=function(e,n){var o=this.get("center");return n=n||this.get("radius"),{x:o.x+Math.cos(e)*n,y:o.y+Math.sin(e)*n}},r.prototype.canProcessOverlap=function(e){var n=this.get("label");return e==="autoRotate"?isNil(n.rotate):!0},r.prototype.processOverlap=function(e){var n=this,o=this.get("label"),s=this.get("title"),l=this.get("verticalLimitLength"),c=o.offset,u=l,f=0,d=0;s&&(f=s.style.fontSize,d=s.spacing),u&&(u=u-c-d-f);var g=this.get("overlapOrder");if(each$1(g,function(v){o[v]&&n.canProcessOverlap(v)&&n.autoProcessOverlap(v,o[v],e,u)}),s&&isNil(s.offset)){var p=e.getCanvasBBox().height;s.offset=c+p+d+f/2}},r.prototype.autoProcessOverlap=function(e,n,o,s){var l=this,c=!1,u=OverlapUtil[e];if(s>0)if(n===!0)c=u.getDefault()(!1,o,s);else if(isFunction$1(n))c=n(!1,o,s);else if(isObject$1(n)){var f=n;u[f.type]&&(c=u[f.type](!1,o,s,f.cfg))}else u[n]&&(c=u[n](!1,o,s));if(e==="autoRotate"){if(c){var d=o.getChildren(),g=this.get("verticalFactor");each$1(d,function(v){var m=v.attr("textAlign");if(m==="center"){var y=g>0?"end":"start";v.attr("textAlign",y)}})}}else if(e==="autoHide"){var p=o.getChildren().slice(0);each$1(p,function(v){v.get("visible")||(l.get("isRegister")&&l.unregisterElement(v),v.remove())})}},r}(AxisBase),CrosshairBase=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"crosshair",type:"base",line:{},text:null,textBackground:{},capture:!1,defaultCfg:{line:{style:{lineWidth:1,stroke:Theme.lineColor}},text:{position:"start",offset:10,autoRotate:!1,content:null,style:{fill:Theme.textColor,textAlign:"center",textBaseline:"middle",fontFamily:Theme.fontFamily}},textBackground:{padding:5,style:{stroke:Theme.lineColor}}}})},r.prototype.renderInner=function(e){this.get("line")&&this.renderLine(e),this.get("text")&&(this.renderText(e),this.renderBackground(e))},r.prototype.renderText=function(e){var n=this.get("text"),o=n.style,s=n.autoRotate,l=n.content;if(!isNil(l)){var c=this.getTextPoint(),u=null;if(s){var f=this.getRotateAngle();u=getMatrixByAngle(c,f)}this.addShape(e,{type:"text",name:"crosshair-text",id:this.getElementId("text"),attrs:__assign$8(__assign$8(__assign$8({},c),{text:l,matrix:u}),o)})}},r.prototype.renderLine=function(e){var n=this.getLinePath(),o=this.get("line"),s=o.style;this.addShape(e,{type:"path",name:"crosshair-line",id:this.getElementId("line"),attrs:__assign$8({path:n},s)})},r.prototype.renderBackground=function(e){var n=this.getElementId("text"),o=e.findById(n),s=this.get("textBackground");if(s&&o){var l=o.getBBox(),c=formatPadding(s.padding),u=s.style,f=this.addShape(e,{type:"rect",name:"crosshair-text-background",id:this.getElementId("text-background"),attrs:__assign$8({x:l.x-c[3],y:l.y-c[0],width:l.width+c[1]+c[3],height:l.height+c[0]+c[2],matrix:o.attr("matrix")},u)});f.toBack()}},r}(GroupComponent),LineCrosshair$1=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{type:"line",locationType:"region",start:null,end:null})},r.prototype.getRotateAngle=function(){var e=this.getLocation(),n=e.start,o=e.end,s=this.get("text").position,l=Math.atan2(o.y-n.y,o.x-n.x),c=s==="start"?l-Math.PI/2:l+Math.PI/2;return c},r.prototype.getTextPoint=function(){var e=this.getLocation(),n=e.start,o=e.end,s=this.get("text"),l=s.position,c=s.offset;return getTextPoint(n,o,l,c)},r.prototype.getLinePath=function(){var e=this.getLocation(),n=e.start,o=e.end;return[["M",n.x,n.y],["L",o.x,o.y]]},r}(CrosshairBase),LineCrosshair=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{type:"circle",locationType:"circle",center:null,radius:100,startAngle:-Math.PI/2,endAngle:Math.PI*3/2})},r.prototype.getRotateAngle=function(){var e=this.getLocation(),n=e.startAngle,o=e.endAngle,s=this.get("text").position,l=s==="start"?n+Math.PI/2:o-Math.PI/2;return l},r.prototype.getTextPoint=function(){var e=this.get("text"),n=e.position,o=e.offset,s=this.getLocation(),l=s.center,c=s.radius,u=s.startAngle,f=s.endAngle,d=n==="start"?u:f,g=this.getRotateAngle()-Math.PI,p=getCirclePoint(l,c,d),v=Math.cos(g)*o,m=Math.sin(g)*o;return{x:p.x+v,y:p.y+m}},r.prototype.getLinePath=function(){var e=this.getLocation(),n=e.center,o=e.radius,s=e.startAngle,l=e.endAngle,c=null;if(l-s===Math.PI*2){var u=n.x,f=n.y;c=[["M",u,f-o],["A",o,o,0,1,1,u,f+o],["A",o,o,0,1,1,u,f-o],["Z"]]}else{var d=getCirclePoint(n,o,s),g=getCirclePoint(n,o,l),p=Math.abs(l-s)>Math.PI?1:0,v=s>l?0:1;c=[["M",d.x,d.y],["A",o,o,0,p,v,g.x,g.y]]}return c},r}(CrosshairBase),CONTAINER_CLASS$1="g2-crosshair",CROSSHAIR_LINE=CONTAINER_CLASS$1+"-line",CROSSHAIR_TEXT=CONTAINER_CLASS$1+"-text",_a$4;const HtmlTheme=(_a$4={},_a$4[""+CONTAINER_CLASS$1]={position:"relative"},_a$4[""+CROSSHAIR_LINE]={position:"absolute",backgroundColor:"rgba(0, 0, 0, 0.25)"},_a$4[""+CROSSHAIR_TEXT]={position:"absolute",color:Theme.textColor,fontFamily:Theme.fontFamily},_a$4);var HtmlCrosshair=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"crosshair",type:"html",locationType:"region",start:{x:0,y:0},end:{x:0,y:0},capture:!1,text:null,containerTpl:'<div class="'+CONTAINER_CLASS$1+'"></div>',crosshairTpl:'<div class="'+CROSSHAIR_LINE+'"></div>',textTpl:'<span class="'+CROSSHAIR_TEXT+'">{content}</span>',domStyles:null,containerClassName:CONTAINER_CLASS$1,defaultStyles:HtmlTheme,defaultCfg:{text:{position:"start",content:null,align:"center",offset:10}}})},r.prototype.render=function(){this.resetText(),this.resetPosition()},r.prototype.initCrossHair=function(){var e=this.getContainer(),n=this.get("crosshairTpl"),o=createDom$1(n);e.appendChild(o),this.applyStyle(CROSSHAIR_LINE,o),this.set("crosshairEl",o)},r.prototype.getTextPoint=function(){var e=this.getLocation(),n=e.start,o=e.end,s=this.get("text"),l=s.position,c=s.offset;return getTextPoint(n,o,l,c)},r.prototype.resetText=function(){var e=this.get("text"),n=this.get("textEl");if(e){var o=e.content;if(!n){var s=this.getContainer(),l=substitute(this.get("textTpl"),e);n=createDom$1(l),s.appendChild(n),this.applyStyle(CROSSHAIR_TEXT,n),this.set("textEl",n)}n.innerHTML=o}else n&&n.remove()},r.prototype.isVertical=function(e,n){return e.x===n.x},r.prototype.resetPosition=function(){var e=this.get("crosshairEl");e||(this.initCrossHair(),e=this.get("crosshairEl"));var n=this.get("start"),o=this.get("end"),s=Math.min(n.x,o.x),l=Math.min(n.y,o.y);this.isVertical(n,o)?modifyCSS(e,{width:"1px",height:toPx(Math.abs(o.y-n.y))}):modifyCSS(e,{height:"1px",width:toPx(Math.abs(o.x-n.x))}),modifyCSS(e,{top:toPx(l),left:toPx(s)}),this.alignText()},r.prototype.alignText=function(){var e=this.get("textEl");if(e){var n=this.get("text").align,o=e.clientWidth,s=this.getTextPoint();switch(n){case"center":s.x=s.x-o/2;break;case"right":s.x=s.x-o}modifyCSS(e,{top:toPx(s.y),left:toPx(s.x)})}},r.prototype.updateInner=function(e){has(e,"text")&&this.resetText(),a.prototype.updateInner.call(this,e)},r}(HtmlComponent);const Crosshair=Object.freeze(Object.defineProperty({__proto__:null,Base:CrosshairBase,Circle:LineCrosshair,Html:HtmlCrosshair,Line:LineCrosshair$1},Symbol.toStringTag,{value:"Module"}));var GridBase=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"grid",line:{},alternateColor:null,capture:!1,items:[],closed:!1,defaultCfg:{line:{type:"line",style:{lineWidth:1,stroke:Theme.lineColor}}}})},r.prototype.getLineType=function(){var e=this.get("line")||this.get("defaultCfg").line;return e.type},r.prototype.renderInner=function(e){this.drawGrid(e)},r.prototype.getAlternatePath=function(e,n){var o=this.getGridPath(e),s=n.slice(0).reverse(),l=this.getGridPath(s,!0),c=this.get("closed");return c?o=o.concat(l):(l[0][0]="L",o=o.concat(l),o.push(["Z"])),o},r.prototype.getPathStyle=function(){return this.get("line").style},r.prototype.drawGrid=function(e){var n=this,o=this.get("line"),s=this.get("items"),l=this.get("alternateColor"),c=null;each$1(s,function(u,f){var d=u.id||f;if(o){var g=n.getPathStyle();g=isFunction$1(g)?g(u,f,s):g;var p=n.getElementId("line-"+d),v=n.getGridPath(u.points);n.addShape(e,{type:"path",name:"grid-line",id:p,attrs:mix({path:v},g)})}if(l&&f>0){var m=n.getElementId("region-"+d),y=f%2===0;if(isString$1(l))y&&n.drawAlternateRegion(m,e,c.points,u.points,l);else{var x=y?l[1]:l[0];n.drawAlternateRegion(m,e,c.points,u.points,x)}}c=u})},r.prototype.drawAlternateRegion=function(e,n,o,s,l){var c=this.getAlternatePath(o,s);this.addShape(n,{type:"path",id:e,name:"grid-region",attrs:{path:c,fill:l}})},r}(GroupComponent);function distance$3(a,r,e,n){var o=e-a,s=n-r;return Math.sqrt(o*o+s*s)}var Circle$3=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{type:"circle",center:null,closed:!0})},r.prototype.getGridPath=function(e,n){var o=this.getLineType(),s=this.get("closed"),l=[];if(e.length)if(o==="circle"){var c=this.get("center"),u=e[0],f=distance$3(c.x,c.y,u.x,u.y),d=n?0:1;s?(l.push(["M",c.x,c.y-f]),l.push(["A",f,f,0,0,d,c.x,c.y+f]),l.push(["A",f,f,0,0,d,c.x,c.y-f]),l.push(["Z"])):each$1(e,function(g,p){p===0?l.push(["M",g.x,g.y]):l.push(["A",f,f,0,0,d,g.x,g.y])})}else each$1(e,function(g,p){p===0?l.push(["M",g.x,g.y]):l.push(["L",g.x,g.y])}),s&&l.push(["Z"]);return l},r}(GridBase),Line$4=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{type:"line"})},r.prototype.getGridPath=function(e){var n=[];return each$1(e,function(o,s){s===0?n.push(["M",o.x,o.y]):n.push(["L",o.x,o.y])}),n},r}(GridBase),LegendBase=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"legend",layout:"horizontal",locationType:"point",x:0,y:0,offsetX:0,offsetY:0,title:null,background:null})},r.prototype.getLayoutBBox=function(){var e=a.prototype.getLayoutBBox.call(this),n=this.get("maxWidth"),o=this.get("maxHeight"),s=e.width,l=e.height;return n&&(s=Math.min(s,n)),o&&(l=Math.min(l,o)),createBBox(e.minX,e.minY,s,l)},r.prototype.setLocation=function(e){this.set("x",e.x),this.set("y",e.y),this.resetLocation()},r.prototype.resetLocation=function(){var e=this.get("x"),n=this.get("y"),o=this.get("offsetX"),s=this.get("offsetY");this.moveElementTo(this.get("group"),{x:e+o,y:n+s})},r.prototype.applyOffset=function(){this.resetLocation()},r.prototype.getDrawPoint=function(){return this.get("currentPoint")},r.prototype.setDrawPoint=function(e){return this.set("currentPoint",e)},r.prototype.renderInner=function(e){this.resetDraw(),this.get("title")&&this.drawTitle(e),this.drawLegendContent(e),this.get("background")&&this.drawBackground(e)},r.prototype.drawBackground=function(e){var n=this.get("background"),o=e.getBBox(),s=formatPadding(n.padding),l=__assign$8({x:0,y:0,width:o.width+s[1]+s[3],height:o.height+s[0]+s[2]},n.style),c=this.addShape(e,{type:"rect",id:this.getElementId("background"),name:"legend-background",attrs:l});c.toBack()},r.prototype.drawTitle=function(e){var n=this.get("currentPoint"),o=this.get("title"),s=o.spacing,l=o.style,c=o.text,u=this.addShape(e,{type:"text",id:this.getElementId("title"),name:"legend-title",attrs:__assign$8({text:c,x:n.x,y:n.y},l)}),f=u.getBBox();this.set("currentPoint",{x:n.x,y:f.maxY+s})},r.prototype.resetDraw=function(){var e=this.get("background"),n={x:0,y:0};if(e){var o=formatPadding(e.padding);n.x=o[3],n.y=o[0]}this.set("currentPoint",n)},r}(GroupComponent),DEFAULT_PAGE_NAVIGATOR={marker:{style:{inactiveFill:"#000",inactiveOpacity:.45,fill:"#000",opacity:1,size:12}},text:{style:{fill:"#ccc",fontSize:12}}},textStyle={fill:Theme.textColor,fontSize:12,textAlign:"start",textBaseline:"middle",fontFamily:Theme.fontFamily,fontWeight:"normal",lineHeight:12},RIGHT_ARROW_NAME="navigation-arrow-right",LEFT_ARROW_NAME="navigation-arrow-left",ROTATE_MAP={right:90*Math.PI/180,left:270*Math.PI/180,up:0,down:180*Math.PI/180},Category=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.currentPageIndex=1,e.totalPagesCnt=1,e.pageWidth=0,e.pageHeight=0,e.startX=0,e.startY=0,e.onNavigationBack=function(){var n=e.getElementByLocalId("item-group");if(e.currentPageIndex>1){e.currentPageIndex-=1,e.updateNavigation();var o=e.getCurrentNavigationMatrix();e.get("animate")?n.animate({matrix:o},100):n.attr({matrix:o})}},e.onNavigationAfter=function(){var n=e.getElementByLocalId("item-group");if(e.currentPageIndex<e.totalPagesCnt){e.currentPageIndex+=1,e.updateNavigation();var o=e.getCurrentNavigationMatrix();e.get("animate")?n.animate({matrix:o},100):n.attr({matrix:o})}},e}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"legend",type:"category",itemSpacing:24,itemMarginBottom:8,maxItemWidth:null,itemWidth:null,itemHeight:null,itemName:{},itemValue:null,maxWidth:null,maxHeight:null,marker:{},radio:null,items:[],itemStates:{},itemBackground:{},pageNavigator:{},defaultCfg:{title:{spacing:5,style:{fill:Theme.textColor,fontSize:12,textAlign:"start",textBaseline:"top"}},background:{padding:5,style:{stroke:Theme.lineColor}},itemBackground:{style:{opacity:0,fill:"#fff"}},pageNavigator:DEFAULT_PAGE_NAVIGATOR,itemName:{spacing:16,style:textStyle},marker:{spacing:8,style:{r:6,symbol:"circle"}},itemValue:{alignRight:!1,formatter:null,style:textStyle,spacing:6},itemStates:{active:{nameStyle:{opacity:.8}},unchecked:{nameStyle:{fill:Theme.uncheckedColor},markerStyle:{fill:Theme.uncheckedColor,stroke:Theme.uncheckedColor}},inactive:{nameStyle:{fill:Theme.uncheckedColor},markerStyle:{opacity:.2}}}}})},r.prototype.isList=function(){return!0},r.prototype.getItems=function(){return this.get("items")},r.prototype.setItems=function(e){this.update({items:e})},r.prototype.updateItem=function(e,n){mix(e,n),this.clear(),this.render()},r.prototype.clearItems=function(){var e=this.getElementByLocalId("item-group");e&&e.clear()},r.prototype.setItemState=function(e,n,o){e[n]=o;var s=this.getElementByLocalId("item-"+e.id);if(s){var l=this.getItems(),c=l.indexOf(e),u=this.createOffScreenGroup(),f=this.drawItem(e,c,this.getItemHeight(),u);this.updateElements(f,s),this.clearUpdateStatus(s)}},r.prototype.hasState=function(e,n){return!!e[n]},r.prototype.getItemStates=function(e){var n=this.get("itemStates"),o=[];return each$1(n,function(s,l){e[l]&&o.push(l)}),o},r.prototype.clearItemsState=function(e){var n=this,o=this.getItemsByState(e);each$1(o,function(s){n.setItemState(s,e,!1)})},r.prototype.getItemsByState=function(e){var n=this,o=this.getItems();return filter(o,function(s){return n.hasState(s,e)})},r.prototype.drawLegendContent=function(e){this.processItems(),this.drawItems(e)},r.prototype.processItems=function(){var e=this.get("items");each$1(e,function(n){n.id||(n.id=n.name)})},r.prototype.drawItems=function(e){var n=this,o=this.addGroup(e,{id:this.getElementId("item-container-group"),name:"legend-item-container-group"}),s=this.addGroup(o,{id:this.getElementId("item-group"),name:"legend-item-group"}),l=this.getItemHeight(),c=this.get("itemWidth"),u=this.get("itemSpacing"),f=this.get("itemMarginBottom"),d=this.get("currentPoint"),g=d.x,p=d.y,v=this.get("layout"),m=this.get("items"),y=!1,x=0,_=this.get("maxWidth"),E=this.get("maxHeight");each$1(m,function(S,A){var T=n.drawItem(S,A,l,s),b=T.getBBox(),C=c||b.width;C>x&&(x=C),v==="horizontal"?(_&&_<d.x+C-g&&(y=!0,d.x=g,d.y+=l+f),n.moveElementTo(T,d),d.x+=C+u):(E&&E<d.y+l+f-p&&(y=!0,d.x+=x+u,d.y=p,x=0),n.moveElementTo(T,d),d.y+=l+f)}),y&&this.get("flipPage")&&(this.pageHeight=0,this.pageWidth=0,this.totalPagesCnt=1,this.startX=g,this.startY=p,this.adjustNavigation(e,s))},r.prototype.getItemHeight=function(){var e=this.get("itemHeight");if(!e){var n=(this.get("itemName")||{}).style;if(isFunction$1(n)){var o=this.getItems();o.forEach(function(s,l){var c=__assign$8(__assign$8({},textStyle),n(s,l,o)).fontSize;e<c&&(e=c)})}else n&&(e=n.fontSize)}return e},r.prototype.drawMarker=function(e,n,o,s){var l=__assign$8(__assign$8(__assign$8({x:0,y:s/2},n.style),{symbol:get(o.marker,"symbol","circle")}),get(o.marker,"style",{})),c=this.addShape(e,{type:"marker",id:this.getElementId("item-"+o.id+"-marker"),name:"legend-item-marker",attrs:l}),u=c.getBBox();c.attr("x",u.width/2);var f=c.attr(),d=f.stroke,g=f.fill;return d&&c.set("isStroke",!0),g&&c.set("isFill",!0),c},r.prototype.drawItemText=function(e,n,o,s,l,c,u){var f=o.formatter,d=o.style,g=__assign$8(__assign$8({x:c,y:l/2,text:f?f(s[n],s,u):s[n]},textStyle),isFunction$1(d)?d(s,u,this.getItems()):d);return this.addShape(e,{type:"text",id:this.getElementId("item-"+s.id+"-"+n),name:"legend-item-"+n,attrs:g})},r.prototype.drawRadio=function(e,n,o,s,l){var c,u,f=n.style||{},d=(c=f.r)!==null&&c!==void 0?c:s/2,g=d*3.6/8,p=[l+d,s/2-d],v=p[0],m=p[1],y=[v+d,m+d],x=y[0],_=y[1],E=[v,_+d],S=E[0],A=E[1],T=[l,m+d],b=T[0],C=T[1],L=o.showRadio,R=__assign$8(__assign$8({path:[["M",v,m],["A",d,d,0,0,1,x,_],["L",x-g,_],["L",x,_],["A",d,d,0,0,1,S,A],["L",S,A-g],["L",S,A],["A",d,d,0,0,1,b,C],["L",b+g,C],["L",b,C],["A",d,d,0,0,1,v,m],["L",v,m+g]],stroke:"#000000",fill:"#ffffff"},f),{opacity:L?(u=f==null?void 0:f.opacity)!==null&&u!==void 0?u:.45:0}),I=this.addShape(e,{type:"path",id:this.getElementId("item-"+o.id+"-radio"),name:"legend-item-radio",attrs:R});return I.set("tip",n.tip),I},r.prototype.drawItem=function(e,n,o,s){var l="item-"+e.id,c=this.addGroup(s,{name:"legend-item-container",id:this.getElementId("item-container-"+l),delegateObject:{item:e,index:n}}),u=this.addGroup(c,{name:"legend-item",id:this.getElementId(l),delegateObject:{item:e,index:n}}),f=this.get("marker"),d=this.get("itemName"),g=this.get("itemValue"),p=this.get("itemBackground"),v=this.get("radio"),m=this.getLimitItemWidth(),y=0;if(f){var x=this.drawMarker(u,f,e,o),_=f.spacing,E=get(e,["marker","spacing"]);isNumber$2(E)&&(_=E),y=x.getBBox().maxX+_}if(d){var S=this.drawItemText(u,"name",d,e,o,y,n);m&&ellipsisLabel(!0,S,clamp(m-y,0,m)),y=S.getBBox().maxX+d.spacing}if(g){var A=this.drawItemText(u,"value",g,e,o,y,n);m&&(g.alignRight?(A.attr({textAlign:"right",x:m}),ellipsisLabel(!0,A,clamp(m-y,0,m),"head")):ellipsisLabel(!0,A,clamp(m-y,0,m))),y=A.getBBox().maxX+g.spacing}if(v&&this.drawRadio(u,v,e,o,y),p){var T=u.getBBox(),b=this.addShape(u,{type:"rect",name:"legend-item-background",id:this.getElementId(l+"-background"),attrs:__assign$8({x:0,y:0,width:T.width,height:o},p.style)});b.toBack()}return this.applyItemStates(e,u),u},r.prototype.adjustNavigation=function(e,n){var o=this,s=this.startX,l=this.startY,c=this.get("layout"),u=n.findAll(function(M){return M.get("name")==="legend-item"}),f=this.get("maxWidth"),d=this.get("maxHeight"),g=this.get("itemWidth"),p=this.get("itemSpacing"),v=this.getItemHeight(),m=deepMix({},DEFAULT_PAGE_NAVIGATOR,this.get("pageNavigator")),y=this.drawNavigation(e,c,"00/00",m),x=y.getBBox(),_={x:s,y:l},E=1,S=0,A=0,T=0,b=this.get("itemMarginBottom");function C(M,D){var O=M.getBBox(),F=g||O.width,k=D.x+F+p+x.width;return k>f}if(c==="horizontal"){var L=this.get("maxRow")||1,R=v+(L===1?0:b),I=f-p-x.width-x.minX;this.pageHeight=R*L,this.pageWidth=I,each$1(u,function(M){var D=M.getBBox(),O=g||D.width;(S&&S<_.x+O+p||C(M,_))&&(E===1&&(S=_.x+p,o.moveElementTo(y,{x:I,y:_.y+v/2-x.height/2-x.minY})),E+=1,_.x=s,_.y+=R),o.moveElementTo(M,_),M.getParent().setClip({type:"rect",attrs:{x:_.x,y:_.y,width:O+p,height:v}}),_.x+=O+p})}else{each$1(u,function(M){var D=M.getBBox();D.width>A&&(A=D.width)}),T=A,A+=p,f&&(A=Math.min(f,A),T=Math.min(f,T)),this.pageWidth=A,this.pageHeight=d-Math.max(x.height,v+b);var w=Math.floor(this.pageHeight/(v+b));each$1(u,function(M,D){D!==0&&D%w===0&&(E+=1,_.x+=A,_.y=l),o.moveElementTo(M,_),M.getParent().setClip({type:"rect",attrs:{x:_.x,y:_.y,width:A,height:v}}),_.y+=v+b}),this.totalPagesCnt=E,this.moveElementTo(y,{x:s+T/2-x.width/2-x.minX,y:d-x.height-x.minY})}this.pageHeight&&this.pageWidth&&n.getParent().setClip({type:"rect",attrs:{x:this.startX,y:this.startY,width:this.pageWidth,height:this.pageHeight}}),c==="horizontal"&&this.get("maxRow")?this.totalPagesCnt=Math.ceil(E/this.get("maxRow")):this.totalPagesCnt=E,this.currentPageIndex>this.totalPagesCnt&&(this.currentPageIndex=1),this.updateNavigation(y),n.attr("matrix",this.getCurrentNavigationMatrix())},r.prototype.drawNavigation=function(e,n,o,s){var l={x:0,y:0},c=this.addGroup(e,{id:this.getElementId("navigation-group"),name:"legend-navigation"}),u=get(s.marker,"style",{}),f=u.size,d=f===void 0?12:f,g=__rest$1(u,["size"]),p=this.drawArrow(c,l,LEFT_ARROW_NAME,n==="horizontal"?"up":"left",d,g);p.on("click",this.onNavigationBack);var v=p.getBBox();l.x+=v.width+2;var m=this.addShape(c,{type:"text",id:this.getElementId("navigation-text"),name:"navigation-text",attrs:__assign$8({x:l.x,y:l.y+d/2,text:o,textBaseline:"middle"},get(s.text,"style"))}),y=m.getBBox();l.x+=y.width+2;var x=this.drawArrow(c,l,RIGHT_ARROW_NAME,n==="horizontal"?"down":"right",d,g);return x.on("click",this.onNavigationAfter),c},r.prototype.updateNavigation=function(e){var n=deepMix({},DEFAULT_PAGE_NAVIGATOR,this.get("pageNavigator")),o=n.marker.style,s=o.fill,l=o.opacity,c=o.inactiveFill,u=o.inactiveOpacity,f=this.currentPageIndex+"/"+this.totalPagesCnt,d=e?e.getChildren()[1]:this.getElementByLocalId("navigation-text"),g=e?e.findById(this.getElementId(LEFT_ARROW_NAME)):this.getElementByLocalId(LEFT_ARROW_NAME),p=e?e.findById(this.getElementId(RIGHT_ARROW_NAME)):this.getElementByLocalId(RIGHT_ARROW_NAME);d.attr("text",f),g.attr("opacity",this.currentPageIndex===1?u:l),g.attr("fill",this.currentPageIndex===1?c:s),g.attr("cursor",this.currentPageIndex===1?"not-allowed":"pointer"),p.attr("opacity",this.currentPageIndex===this.totalPagesCnt?u:l),p.attr("fill",this.currentPageIndex===this.totalPagesCnt?c:s),p.attr("cursor",this.currentPageIndex===this.totalPagesCnt?"not-allowed":"pointer");var v=g.getBBox().maxX+2;d.attr("x",v),v+=d.getBBox().width+2,this.updateArrowPath(p,{x:v,y:0})},r.prototype.drawArrow=function(e,n,o,s,l,c){var u=n.x,f=n.y,d=this.addShape(e,{type:"path",id:this.getElementId(o),name:o,attrs:__assign$8({size:l,direction:s,path:[["M",u+l/2,f],["L",u,f+l],["L",u+l,f+l],["Z"]],cursor:"pointer"},c)});return d.attr("matrix",getMatrixByAngle({x:u+l/2,y:f+l/2},ROTATE_MAP[s])),d},r.prototype.updateArrowPath=function(e,n){var o=n.x,s=n.y,l=e.attr(),c=l.size,u=l.direction,f=getMatrixByAngle({x:o+c/2,y:s+c/2},ROTATE_MAP[u]);e.attr("path",[["M",o+c/2,s],["L",o,s+c],["L",o+c,s+c],["Z"]]),e.attr("matrix",f)},r.prototype.getCurrentNavigationMatrix=function(){var e=this,n=e.currentPageIndex,o=e.pageWidth,s=e.pageHeight,l=this.get("layout"),c=l==="horizontal"?{x:0,y:s*(1-n)}:{x:o*(1-n),y:0};return getMatrixByTranslate(c)},r.prototype.applyItemStates=function(e,n){var o=this.getItemStates(e),s=o.length>0;if(s){var l=n.getChildren(),c=this.get("itemStates");each$1(l,function(u){var f=u.get("name"),d=f.split("-")[2],g=getStatesStyle(e,d,c);g&&(u.attr(g),d==="marker"&&!(u.get("isStroke")&&u.get("isFill"))&&(u.get("isStroke")&&u.attr("fill",null),u.get("isFill")&&u.attr("stroke",null)))})}},r.prototype.getLimitItemWidth=function(){var e=this.get("itemWidth"),n=this.get("maxItemWidth");return n?e&&(n=e<=n?e:n):e&&(n=e),n},r}(LegendBase),HANDLER_HEIGHT_RATIO=1.4,HANDLER_TRIANGLE_RATIO=.4,ContinueLegend=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{type:"continue",min:0,max:100,value:null,colors:[],track:{},rail:{},label:{},handler:{},slidable:!0,tip:null,step:null,maxWidth:null,maxHeight:null,defaultCfg:{label:{align:"rail",spacing:5,formatter:null,style:{fontSize:12,fill:Theme.textColor,textBaseline:"middle",fontFamily:Theme.fontFamily}},handler:{size:10,style:{fill:"#fff",stroke:"#333"}},track:{},rail:{type:"color",size:20,defaultLength:100,style:{fill:"#DCDEE2"}},title:{spacing:5,style:{fill:Theme.textColor,fontSize:12,textAlign:"start",textBaseline:"top"}}}})},r.prototype.isSlider=function(){return!0},r.prototype.getValue=function(){return this.getCurrentValue()},r.prototype.getRange=function(){return{min:this.get("min"),max:this.get("max")}},r.prototype.setRange=function(e,n){this.update({min:e,max:n})},r.prototype.setValue=function(e){var n=this.getValue();this.set("value",e);var o=this.get("group");this.resetTrackClip(),this.get("slidable")&&this.resetHandlers(o),this.delegateEmit("valuechanged",{originValue:n,value:e})},r.prototype.initEvent=function(){var e=this.get("group");this.bindSliderEvent(e),this.bindRailEvent(e),this.bindTrackEvent(e)},r.prototype.drawLegendContent=function(e){this.drawRail(e),this.drawLabels(e),this.fixedElements(e),this.resetTrack(e),this.resetTrackClip(e),this.get("slidable")&&this.resetHandlers(e)},r.prototype.bindSliderEvent=function(e){this.bindHandlersEvent(e)},r.prototype.bindHandlersEvent=function(e){var n=this;e.on("legend-handler-min:drag",function(o){var s=n.getValueByCanvasPoint(o.x,o.y),l=n.getCurrentValue(),c=l[1];c<s&&(c=s),n.setValue([s,c])}),e.on("legend-handler-max:drag",function(o){var s=n.getValueByCanvasPoint(o.x,o.y),l=n.getCurrentValue(),c=l[0];c>s&&(c=s),n.setValue([c,s])})},r.prototype.bindRailEvent=function(e){},r.prototype.bindTrackEvent=function(e){var n=this,o=null;e.on("legend-track:dragstart",function(s){o={x:s.x,y:s.y}}),e.on("legend-track:drag",function(s){if(o){var l=n.getValueByCanvasPoint(o.x,o.y),c=n.getValueByCanvasPoint(s.x,s.y),u=n.getCurrentValue(),f=u[1]-u[0],d=n.getRange(),g=c-l;g<0?u[0]+g>d.min?n.setValue([u[0]+g,u[1]+g]):n.setValue([d.min,d.min+f]):g>0&&(g>0&&u[1]+g<d.max?n.setValue([u[0]+g,u[1]+g]):n.setValue([d.max-f,d.max])),o={x:s.x,y:s.y}}}),e.on("legend-track:dragend",function(s){o=null})},r.prototype.drawLabels=function(e){this.drawLabel("min",e),this.drawLabel("max",e)},r.prototype.drawLabel=function(e,n){var o=this.get("label"),s=o.style,l=o.align,c=o.formatter,u=this.get(e),f=this.getLabelAlignAttrs(e,l),d="label-"+e;this.addShape(n,{type:"text",id:this.getElementId(d),name:"legend-label-"+e,attrs:__assign$8(__assign$8({x:0,y:0,text:isFunction$1(c)?c(u):u},s),f)})},r.prototype.getLabelAlignAttrs=function(e,n){var o=this.isVertical(),s="center",l="middle";return o?(s="start",n!=="rail"?e==="min"?l="top":l="bottom":l="top"):n!=="rail"?(l="top",e==="min"?s="start":s="end"):(s="start",l="middle"),{textAlign:s,textBaseline:l}},r.prototype.getRailPath=function(e,n,o,s){var l=this.get("rail"),c=l.size,u=l.defaultLength,f=l.type,d=this.isVertical(),g=u,p=o,v=s;p||(p=d?c:g),v||(v=d?g:c);var m=[];return f==="color"?(m.push(["M",e,n]),m.push(["L",e+p,n]),m.push(["L",e+p,n+v]),m.push(["L",e,n+v]),m.push(["Z"])):(m.push(["M",e+p,n]),m.push(["L",e+p,n+v]),m.push(["L",e,n+v]),m.push(["Z"])),m},r.prototype.drawRail=function(e){var n=this.get("rail"),o=n.style;this.addShape(e,{type:"path",id:this.getElementId("rail"),name:"legend-rail",attrs:__assign$8({path:this.getRailPath(0,0)},o)})},r.prototype.getTrackColor=function(e){var n=e.length;if(!n)return null;if(n===1)return e[0];var o;this.isVertical()?o="l(90)":o="l(0)";for(var s=0;s<n;s++){var l=s/(n-1);o+=" "+l+":"+e[s]}return o},r.prototype.getTrackPath=function(e){var n=this.getRailShape(e),o=n.attr("path");return clone(o)},r.prototype.getClipTrackAttrs=function(e){var n=this.getCurrentValue(),o=n[0],s=n[1],l=this.getRailBBox(e),c=this.getPointByValue(o,e),u=this.getPointByValue(s,e),f=this.isVertical(),d,g,p,v;return f?(d=l.minX,g=c.y,p=l.width,v=u.y-c.y):(d=c.x,g=l.minY,p=u.x-c.x,v=l.height),{x:d,y:g,width:p,height:v}},r.prototype.getTrackAttrs=function(e){var n=this.get("track"),o=this.get("colors"),s=this.getTrackPath(e);return mix({path:s,fill:this.getTrackColor(o)},n.style)},r.prototype.resetTrackClip=function(e){var n=e||this.get("group"),o=this.getElementId("track"),s=n.findById(o),l=s.getClip(),c=this.getClipTrackAttrs(e);l?l.attr(c):s.setClip({type:"rect",attrs:c})},r.prototype.resetTrack=function(e){var n=this.getElementId("track"),o=e.findById(n),s=this.getTrackAttrs(e);o?o.attr(s):this.addShape(e,{type:"path",id:n,draggable:this.get("slidable"),name:"legend-track",attrs:s})},r.prototype.getPointByValue=function(e,n){var o=this.getRange(),s=o.min,l=o.max,c=(e-s)/(l-s),u=this.getRailBBox(n),f=this.isVertical(),d={x:0,y:0};return f?(d.x=u.minX+u.width/2,d.y=getValueByPercent(u.minY,u.maxY,c)):(d.x=getValueByPercent(u.minX,u.maxX,c),d.y=u.minY+u.height/2),d},r.prototype.getRailShape=function(e){var n=e||this.get("group");return n.findById(this.getElementId("rail"))},r.prototype.getRailBBox=function(e){var n=this.getRailShape(e),o=n.getBBox();return o},r.prototype.getRailCanvasBBox=function(){var e=this.get("group"),n=e.findById(this.getElementId("rail")),o=n.getCanvasBBox();return o},r.prototype.isVertical=function(){return this.get("layout")==="vertical"},r.prototype.getValueByCanvasPoint=function(e,n){var o=this.getRange(),s=o.min,l=o.max,c=this.getRailCanvasBBox(),u=this.isVertical(),f=this.get("step"),d;u?d=(n-c.minY)/c.height:d=(e-c.minX)/c.width;var g=getValueByPercent(s,l,d);if(f){var p=Math.round((g-s)/f);g=s+p*f}return g>l&&(g=l),g<s&&(g=s),g},r.prototype.getCurrentValue=function(){var e=this.get("value");if(!e){var n=this.get("values");return n?[Math.max(Math.min.apply(Math,__spreadArrays$3(n,[this.get("max")])),this.get("min")),Math.min(Math.max.apply(Math,__spreadArrays$3(n,[this.get("min")])),this.get("max"))]:[this.get("min"),this.get("max")]}return e},r.prototype.resetHandlers=function(e){var n=this.getCurrentValue(),o=n[0],s=n[1];this.resetHandler(e,"min",o),this.resetHandler(e,"max",s)},r.prototype.getHandlerPath=function(e,n){var o=this.isVertical(),s=[],l=e.size,c=n.x,u=n.y,f=l*HANDLER_HEIGHT_RATIO,d=l/2,g=l/6;if(o){var p=c+f*HANDLER_TRIANGLE_RATIO;s.push(["M",c,u]),s.push(["L",p,u+d]),s.push(["L",c+f,u+d]),s.push(["L",c+f,u-d]),s.push(["L",p,u-d]),s.push(["Z"]),s.push(["M",p,u+g]),s.push(["L",c+f-2,u+g]),s.push(["M",p,u-g]),s.push(["L",c+f-2,u-g])}else{var v=u+f*HANDLER_TRIANGLE_RATIO;s.push(["M",c,u]),s.push(["L",c-d,v]),s.push(["L",c-d,u+f]),s.push(["L",c+d,u+f]),s.push(["L",c+d,v]),s.push(["Z"]),s.push(["M",c-g,v]),s.push(["L",c-g,u+f-2]),s.push(["M",c+g,v]),s.push(["L",c+g,u+f-2])}return s},r.prototype.resetHandler=function(e,n,o){var s=this.getPointByValue(o,e),l=this.get("handler"),c=this.getHandlerPath(l,s),u=this.getElementId("handler-"+n),f=e.findById(u),d=this.isVertical();f?f.attr("path",c):this.addShape(e,{type:"path",name:"legend-handler-"+n,draggable:!0,id:u,attrs:__assign$8(__assign$8({path:c},l.style),{cursor:d?"ns-resize":"ew-resize"})})},r.prototype.fixedElements=function(e){var n=e.findById(this.getElementId("rail")),o=e.findById(this.getElementId("label-min")),s=e.findById(this.getElementId("label-max")),l=this.getDrawPoint();this.isVertical()?this.fixedVertail(o,s,n,l):this.fixedHorizontal(o,s,n,l)},r.prototype.fitRailLength=function(e,n,o,s){var l=this.isVertical(),c=l?"height":"width",u=this.get("label"),f=u.align,d=u.spacing,g=this.get("max"+upperFirst(c));if(g){var p=f==="rail"?o[c]+e[c]+n[c]+d*2:o[c],v=p-g;v>0&&this.changeRailLength(s,c,o[c]-v)}},r.prototype.changeRailLength=function(e,n,o){var s=e.getBBox(),l;n==="height"?l=this.getRailPath(s.x,s.y,s.width,o):l=this.getRailPath(s.x,s.y,o,s.height),e.attr("path",l)},r.prototype.changeRailPosition=function(e,n,o){var s=e.getBBox(),l=this.getRailPath(n,o,s.width,s.height);e.attr("path",l)},r.prototype.fixedHorizontal=function(e,n,o,s){var l=this.get("label"),c=l.align,u=l.spacing,f=o.getBBox(),d=e.getBBox(),g=n.getBBox(),p=f.height;this.fitRailLength(d,g,f,o),f=o.getBBox(),c==="rail"?(e.attr({x:s.x,y:s.y+p/2}),this.changeRailPosition(o,s.x+d.width+u,s.y),n.attr({x:s.x+d.width+f.width+u*2,y:s.y+p/2})):c==="top"?(e.attr({x:s.x,y:s.y}),n.attr({x:s.x+f.width,y:s.y}),this.changeRailPosition(o,s.x,s.y+d.height+u)):(this.changeRailPosition(o,s.x,s.y),e.attr({x:s.x,y:s.y+f.height+u}),n.attr({x:s.x+f.width,y:s.y+f.height+u}))},r.prototype.fixedVertail=function(e,n,o,s){var l=this.get("label"),c=l.align,u=l.spacing,f=o.getBBox(),d=e.getBBox(),g=n.getBBox();if(this.fitRailLength(d,g,f,o),f=o.getBBox(),c==="rail")e.attr({x:s.x,y:s.y}),this.changeRailPosition(o,s.x,s.y+d.height+u),n.attr({x:s.x,y:s.y+d.height+f.height+u*2});else if(c==="right")e.attr({x:s.x+f.width+u,y:s.y}),this.changeRailPosition(o,s.x,s.y),n.attr({x:s.x+f.width+u,y:s.y+f.height});else{var p=Math.max(d.width,g.width);e.attr({x:s.x,y:s.y}),this.changeRailPosition(o,s.x+p+u,s.y),n.attr({x:s.x,y:s.y+f.height})}},r}(LegendBase),CONTAINER_CLASS="g2-tooltip",TITLE_CLASS="g2-tooltip-title",LIST_CLASS="g2-tooltip-list",LIST_ITEM_CLASS="g2-tooltip-list-item",MARKER_CLASS="g2-tooltip-marker",VALUE_CLASS="g2-tooltip-value",NAME_CLASS="g2-tooltip-name",CROSSHAIR_X="g2-tooltip-crosshair-x",CROSSHAIR_Y="g2-tooltip-crosshair-y";const CssConst=Object.freeze(Object.defineProperty({__proto__:null,CONTAINER_CLASS,CROSSHAIR_X,CROSSHAIR_Y,LIST_CLASS,LIST_ITEM_CLASS,MARKER_CLASS,NAME_CLASS,TITLE_CLASS,VALUE_CLASS},Symbol.toStringTag,{value:"Module"}));var _a$3;const TooltipTheme=(_a$3={},_a$3[""+CONTAINER_CLASS]={position:"absolute",visibility:"visible",zIndex:8,transition:"visibility 0.2s cubic-bezier(0.23, 1, 0.32, 1), left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1)",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"0px 0px 10px #aeaeae",borderRadius:"3px",color:"rgb(87, 87, 87)",fontSize:"12px",fontFamily:Theme.fontFamily,lineHeight:"20px",padding:"10px 10px 6px 10px"},_a$3[""+TITLE_CLASS]={marginBottom:"4px"},_a$3[""+LIST_CLASS]={margin:"0px",listStyleType:"none",padding:"0px"},_a$3[""+LIST_ITEM_CLASS]={listStyleType:"none",marginBottom:"4px"},_a$3[""+MARKER_CLASS]={width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"8px"},_a$3[""+VALUE_CLASS]={display:"inline-block",float:"right",marginLeft:"30px"},_a$3[""+CROSSHAIR_X]={position:"absolute",width:"1px",backgroundColor:"rgba(0, 0, 0, 0.25)"},_a$3[""+CROSSHAIR_Y]={position:"absolute",height:"1px",backgroundColor:"rgba(0, 0, 0, 0.25)"},_a$3);function getOutSides(a,r,e,n,o){var s={left:a<o.x,right:a+e>o.x+o.width,top:r<o.y,bottom:r+n>o.y+o.height};return s}function getPointByPosition(a,r,e,n,o,s){var l=a,c=r;switch(s){case"left":l=a-n-e,c=r-o/2;break;case"right":l=a+e,c=r-o/2;break;case"top":l=a-n/2,c=r-o-e;break;case"bottom":l=a-n/2,c=r+e;break;default:l=a+e,c=r-o-e;break}return{x:l,y:c}}function getAlignPoint(a,r,e,n,o,s,l){var c=getPointByPosition(a,r,e,n,o,s);if(l){var u=getOutSides(c.x,c.y,n,o,l);s==="auto"?(u.right&&(c.x=Math.max(0,a-n-e)),u.top&&(c.y=Math.max(0,r-o-e))):s==="top"||s==="bottom"?(u.left&&(c.x=l.x),u.right&&(c.x=l.x+l.width-n),s==="top"&&u.top&&(c.y=r+e),s==="bottom"&&u.bottom&&(c.y=r-o-e)):(u.top&&(c.y=l.y),u.bottom&&(c.y=l.y+l.height-o),s==="left"&&u.left&&(c.x=a+e),s==="right"&&u.right&&(c.x=a-n-e))}return c}function hasOneKey(a,r){var e=!1;return each$1(r,function(n){if(has(a,n))return e=!0,!1}),e}var Tooltip$1=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"tooltip",type:"html",x:0,y:0,items:[],customContent:null,containerTpl:'<div class="'+CONTAINER_CLASS+'"><div class="'+TITLE_CLASS+'"></div><ul class="'+LIST_CLASS+'"></ul></div>',itemTpl:'<li class="'+LIST_ITEM_CLASS+`" data-index={index}>
          <span class="`+MARKER_CLASS+`" style="background:{color}"></span>
          <span class="`+NAME_CLASS+`">{name}</span>:
          <span class="`+VALUE_CLASS+`">{value}</span>
        </li>`,xCrosshairTpl:'<div class="'+CROSSHAIR_X+'"></div>',yCrosshairTpl:'<div class="'+CROSSHAIR_Y+'"></div>',title:null,showTitle:!0,region:null,crosshairsRegion:null,containerClassName:CONTAINER_CLASS,crosshairs:null,offset:10,position:"right",domStyles:null,defaultStyles:TooltipTheme})},r.prototype.render=function(){this.get("customContent")?this.renderCustomContent():(this.resetTitle(),this.renderItems()),this.resetPosition()},r.prototype.clear=function(){this.clearCrosshairs(),this.setTitle(""),this.clearItemDoms()},r.prototype.show=function(){var e=this.getContainer();!e||this.destroyed||(this.set("visible",!0),modifyCSS(e,{visibility:"visible"}),this.setCrossHairsVisible(!0))},r.prototype.hide=function(){var e=this.getContainer();!e||this.destroyed||(this.set("visible",!1),modifyCSS(e,{visibility:"hidden"}),this.setCrossHairsVisible(!1))},r.prototype.getLocation=function(){return{x:this.get("x"),y:this.get("y")}},r.prototype.setLocation=function(e){this.set("x",e.x),this.set("y",e.y),this.resetPosition()},r.prototype.setCrossHairsVisible=function(e){var n=e?"":"none",o=this.get("xCrosshairDom"),s=this.get("yCrosshairDom");o&&modifyCSS(o,{display:n}),s&&modifyCSS(s,{display:n})},r.prototype.initContainer=function(){if(a.prototype.initContainer.call(this),this.get("customContent")){this.get("container")&&this.get("container").remove();var e=this.getHtmlContentNode();this.get("parent").appendChild(e),this.set("container",e),this.resetStyles(),this.applyStyles()}},r.prototype.updateInner=function(e){this.get("customContent")?this.renderCustomContent():(hasOneKey(e,["title","showTitle"])&&this.resetTitle(),has(e,"items")&&this.renderItems()),a.prototype.updateInner.call(this,e)},r.prototype.initDom=function(){this.cacheDoms()},r.prototype.removeDom=function(){a.prototype.removeDom.call(this),this.clearCrosshairs()},r.prototype.resetPosition=function(){var e=this.get("x"),n=this.get("y"),o=this.get("offset"),s=this.getOffset(),l=s.offsetX,c=s.offsetY,u=this.get("position"),f=this.get("region"),d=this.getContainer(),g=this.getBBox(),p=g.width,v=g.height,m;f&&(m=regionToBBox(f));var y=getAlignPoint(e,n,o,p,v,u,m);modifyCSS(d,{left:toPx(y.x+l),top:toPx(y.y+c)}),this.resetCrosshairs()},r.prototype.renderCustomContent=function(){var e=this.getHtmlContentNode(),n=this.get("parent"),o=this.get("container");o&&o.parentNode===n?n.replaceChild(e,o):n.appendChild(e),this.set("container",e),this.resetStyles(),this.applyStyles()},r.prototype.getHtmlContentNode=function(){var e,n=this.get("customContent");if(n){var o=n(this.get("title"),this.get("items"));isElement(o)?e=o:e=createDom$1(o)}return e},r.prototype.cacheDoms=function(){var e=this.getContainer(),n=e.getElementsByClassName(TITLE_CLASS)[0],o=e.getElementsByClassName(LIST_CLASS)[0];this.set("titleDom",n),this.set("listDom",o)},r.prototype.resetTitle=function(){var e=this.get("title"),n=this.get("showTitle");n&&e?this.setTitle(e):this.setTitle("")},r.prototype.setTitle=function(e){var n=this.get("titleDom");n&&(n.innerText=e)},r.prototype.resetCrosshairs=function(){var e=this.get("crosshairsRegion"),n=this.get("crosshairs");if(!e||!n)this.clearCrosshairs();else{var o=regionToBBox(e),s=this.get("xCrosshairDom"),l=this.get("yCrosshairDom");n==="x"?(this.resetCrosshair("x",o),l&&(l.remove(),this.set("yCrosshairDom",null))):n==="y"?(this.resetCrosshair("y",o),s&&(s.remove(),this.set("xCrosshairDom",null))):(this.resetCrosshair("x",o),this.resetCrosshair("y",o)),this.setCrossHairsVisible(this.get("visible"))}},r.prototype.resetCrosshair=function(e,n){var o=this.checkCrosshair(e),s=this.get(e);e==="x"?modifyCSS(o,{left:toPx(s),top:toPx(n.y),height:toPx(n.height)}):modifyCSS(o,{top:toPx(s),left:toPx(n.x),width:toPx(n.width)})},r.prototype.checkCrosshair=function(e){var n=e+"CrosshairDom",o=e+"CrosshairTpl",s="CROSSHAIR_"+e.toUpperCase(),l=CssConst[s],c=this.get(n),u=this.get("parent");return c||(c=createDom$1(this.get(o)),this.applyStyle(l,c),u.appendChild(c),this.set(n,c)),c},r.prototype.renderItems=function(){this.clearItemDoms();var e=this.get("items"),n=this.get("itemTpl"),o=this.get("listDom");o&&(each$1(e,function(s){var l=colorUtil.toCSSGradient(s.color),c=__assign$8(__assign$8({},s),{color:l}),u=substitute(n,c),f=createDom$1(u);o.appendChild(f)}),this.applyChildrenStyles(o,this.get("domStyles")))},r.prototype.clearItemDoms=function(){this.get("listDom")&&clearDom(this.get("listDom"))},r.prototype.clearCrosshairs=function(){var e=this.get("xCrosshairDom"),n=this.get("yCrosshairDom");e&&e.remove(),n&&n.remove(),this.set("xCrosshairDom",null),this.set("yCrosshairDom",null)},r}(HtmlComponent),BACKGROUND_STYLE$1={opacity:0},LINE_STYLE={stroke:"#C5C5C5",strokeOpacity:.85},AREA_STYLE={fill:"#CACED4",opacity:.85};function pointsToPath(a){return map$2(a,function(r,e){var n=e===0?"M":"L",o=r[0],s=r[1];return[n,o,s]})}function getLinePath$1(a){return pointsToPath(a)}function getSmoothLinePath(a){if(a.length<=2)return getLinePath$1(a);var r=[];each$1(a,function(l){isEqual$1(l,r.slice(r.length-2))||r.push(l[0],l[1])});var e=catmullRom2Bezier(r,!1),n=head(a),o=n[0],s=n[1];return e.unshift(["M",o,s]),e}function dataToPath(a,r,e,n){n===void 0&&(n=!0);var o=new Linear({values:a}),s=new Category$1({values:map$2(a,function(c,u){return u})}),l=map$2(a,function(c,u){return[s.scale(u)*r,e-o.scale(c)*e]});return n?getSmoothLinePath(l):getLinePath$1(l)}function getAreaLineY(a,r){var e=new Linear({values:a}),n=e.max<0?e.max:Math.max(0,e.min);return r-e.scale(n)*r}function linePathToAreaPath(a,r,e,n){var o=__spreadArrays$3(a),s=getAreaLineY(n,e);return o.push(["L",r,s]),o.push(["L",0,s]),o.push(["Z"]),o}var Trend=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"trend",x:0,y:0,width:200,height:16,smooth:!0,isArea:!1,data:[],backgroundStyle:BACKGROUND_STYLE$1,lineStyle:LINE_STYLE,areaStyle:AREA_STYLE})},r.prototype.renderInner=function(e){var n=this.cfg,o=n.width,s=n.height,l=n.data,c=n.smooth,u=n.isArea,f=n.backgroundStyle,d=n.lineStyle,g=n.areaStyle;this.addShape(e,{id:this.getElementId("background"),type:"rect",attrs:__assign$8({x:0,y:0,width:o,height:s},f)});var p=dataToPath(l,o,s,c);if(this.addShape(e,{id:this.getElementId("line"),type:"path",attrs:__assign$8({path:p},d)}),u){var v=linePathToAreaPath(p,o,s,l);this.addShape(e,{id:this.getElementId("area"),type:"path",attrs:__assign$8({path:v},g)})}},r.prototype.applyOffset=function(){var e=this.cfg,n=e.x,o=e.y;this.moveElementTo(this.get("group"),{x:n,y:o})},r}(GroupComponent),DEFAULT_HANDLER_STYLE={fill:"#F7F7F7",stroke:"#BFBFBF",radius:2,opacity:1,cursor:"ew-resize",highLightFill:"#FFF"},Handler=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"handler",x:0,y:0,width:10,height:24,style:DEFAULT_HANDLER_STYLE})},r.prototype.renderInner=function(e){var n=this.cfg,o=n.width,s=n.height,l=n.style,c=l.fill,u=l.stroke,f=l.radius,d=l.opacity,g=l.cursor;this.addShape(e,{type:"rect",id:this.getElementId("background"),attrs:{x:0,y:0,width:o,height:s,fill:c,stroke:u,radius:f,opacity:d,cursor:g}});var p=1/3*o,v=2/3*o,m=1/4*s,y=3/4*s;this.addShape(e,{id:this.getElementId("line-left"),type:"line",attrs:{x1:p,y1:m,x2:p,y2:y,stroke:u,cursor:g}}),this.addShape(e,{id:this.getElementId("line-right"),type:"line",attrs:{x1:v,y1:m,x2:v,y2:y,stroke:u,cursor:g}})},r.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},r.prototype.initEvent=function(){this.bindEvents()},r.prototype.bindEvents=function(){var e=this;this.get("group").on("mouseenter",function(){var n=e.get("style").highLightFill;e.getElementByLocalId("background").attr("fill",n),e.draw()}),this.get("group").on("mouseleave",function(){var n=e.get("style").fill;e.getElementByLocalId("background").attr("fill",n),e.draw()})},r.prototype.draw=function(){var e=this.get("container").get("canvas");e&&e.draw()},r}(GroupComponent),BACKGROUND_STYLE={fill:"#416180",opacity:.05},FOREGROUND_STYLE={fill:"#5B8FF9",opacity:.15,cursor:"move"},DEFAULT_HANDLER_WIDTH=10,HANDLER_STYLE={width:DEFAULT_HANDLER_WIDTH,height:24},TEXT_STYLE={textBaseline:"middle",fill:"#000",opacity:.45},SLIDER_CHANGE="sliderchange",Slider$2=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.onMouseDown=function(n){return function(o){e.currentTarget=n;var s=o.originalEvent;s.stopPropagation(),s.preventDefault(),e.prevX=get(s,"touches.0.pageX",s.pageX),e.prevY=get(s,"touches.0.pageY",s.pageY);var l=e.getContainerDOM();l.addEventListener("mousemove",e.onMouseMove),l.addEventListener("mouseup",e.onMouseUp),l.addEventListener("mouseleave",e.onMouseUp),l.addEventListener("touchmove",e.onMouseMove),l.addEventListener("touchend",e.onMouseUp),l.addEventListener("touchcancel",e.onMouseUp)}},e.onMouseMove=function(n){var o=e.cfg.width,s=[e.get("start"),e.get("end")];n.stopPropagation(),n.preventDefault();var l=get(n,"touches.0.pageX",n.pageX),c=get(n,"touches.0.pageY",n.pageY),u=l-e.prevX,f=e.adjustOffsetRange(u/o);e.updateStartEnd(f),e.updateUI(e.getElementByLocalId("foreground"),e.getElementByLocalId("minText"),e.getElementByLocalId("maxText")),e.prevX=l,e.prevY=c,e.draw(),e.emit(SLIDER_CHANGE,[e.get("start"),e.get("end")].sort()),e.delegateEmit("valuechanged",{originValue:s,value:[e.get("start"),e.get("end")]})},e.onMouseUp=function(){e.currentTarget&&(e.currentTarget=void 0);var n=e.getContainerDOM();n&&(n.removeEventListener("mousemove",e.onMouseMove),n.removeEventListener("mouseup",e.onMouseUp),n.removeEventListener("mouseleave",e.onMouseUp),n.removeEventListener("touchmove",e.onMouseMove),n.removeEventListener("touchend",e.onMouseUp),n.removeEventListener("touchcancel",e.onMouseUp))},e}return r.prototype.setRange=function(e,n){this.set("minLimit",e),this.set("maxLimit",n);var o=this.get("start"),s=this.get("end"),l=clamp(o,e,n),c=clamp(s,e,n);!this.get("isInit")&&(o!==l||s!==c)&&this.setValue([l,c])},r.prototype.getRange=function(){return{min:this.get("minLimit")||0,max:this.get("maxLimit")||1}},r.prototype.setValue=function(e){var n=this.getRange();if(isArray$4(e)&&e.length===2){var o=[this.get("start"),this.get("end")];this.update({start:clamp(e[0],n.min,n.max),end:clamp(e[1],n.min,n.max)}),this.get("updateAutoRender")||this.render(),this.delegateEmit("valuechanged",{originValue:o,value:e})}},r.prototype.getValue=function(){return[this.get("start"),this.get("end")]},r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"slider",x:0,y:0,width:100,height:16,backgroundStyle:{},foregroundStyle:{},handlerStyle:{},textStyle:{},defaultCfg:{backgroundStyle:BACKGROUND_STYLE,foregroundStyle:FOREGROUND_STYLE,handlerStyle:HANDLER_STYLE,textStyle:TEXT_STYLE}})},r.prototype.update=function(e){var n=e.start,o=e.end,s=__assign$8({},e);isNil(n)||(s.start=clamp(n,0,1)),isNil(o)||(s.end=clamp(o,0,1)),a.prototype.update.call(this,s),this.minHandler=this.getChildComponentById(this.getElementId("minHandler")),this.maxHandler=this.getChildComponentById(this.getElementId("maxHandler")),this.trend=this.getChildComponentById(this.getElementId("trend"))},r.prototype.init=function(){this.set("start",clamp(this.get("start"),0,1)),this.set("end",clamp(this.get("end"),0,1)),a.prototype.init.call(this)},r.prototype.render=function(){a.prototype.render.call(this),this.updateUI(this.getElementByLocalId("foreground"),this.getElementByLocalId("minText"),this.getElementByLocalId("maxText"))},r.prototype.renderInner=function(e){var n=this.cfg;n.start,n.end;var o=n.width,s=n.height,l=n.trendCfg,c=l===void 0?{}:l,u=n.minText,f=n.maxText,d=n.backgroundStyle,g=d===void 0?{}:d,p=n.foregroundStyle,v=p===void 0?{}:p,m=n.textStyle,y=m===void 0?{}:m,x=deepMix({},DEFAULT_HANDLER_STYLE,this.cfg.handlerStyle);size(get(c,"data"))&&(this.trend=this.addComponent(e,__assign$8({component:Trend,id:this.getElementId("trend"),x:0,y:0,width:o,height:s},c))),this.addShape(e,{id:this.getElementId("background"),type:"rect",attrs:__assign$8({x:0,y:0,width:o,height:s},g)}),this.addShape(e,{id:this.getElementId("minText"),type:"text",attrs:__assign$8({y:s/2,textAlign:"right",text:u,silent:!1},y)}),this.addShape(e,{id:this.getElementId("maxText"),type:"text",attrs:__assign$8({y:s/2,textAlign:"left",text:f,silent:!1},y)}),this.addShape(e,{id:this.getElementId("foreground"),name:"foreground",type:"rect",attrs:__assign$8({y:0,height:s},v)});var _=get(x,"width",DEFAULT_HANDLER_WIDTH),E=get(x,"height",24);this.minHandler=this.addComponent(e,{component:Handler,id:this.getElementId("minHandler"),name:"handler-min",x:0,y:(s-E)/2,width:_,height:E,cursor:"ew-resize",style:x}),this.maxHandler=this.addComponent(e,{component:Handler,id:this.getElementId("maxHandler"),name:"handler-max",x:0,y:(s-E)/2,width:_,height:E,cursor:"ew-resize",style:x})},r.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},r.prototype.initEvent=function(){this.bindEvents()},r.prototype.updateUI=function(e,n,o){var s=this.cfg,l=s.start,c=s.end,u=s.width,f=s.minText,d=s.maxText,g=s.handlerStyle,p=s.height,v=l*u,m=c*u;this.trend&&(this.trend.update({width:u,height:p}),this.get("updateAutoRender")||this.trend.render()),e.attr("x",v),e.attr("width",m-v);var y=get(g,"width",DEFAULT_HANDLER_WIDTH);n.attr("text",f),o.attr("text",d);var x=this._dodgeText([v,m],n,o),_=x[0],E=x[1];this.minHandler&&(this.minHandler.update({x:v-y/2}),this.get("updateAutoRender")||this.minHandler.render()),each$1(_,function(S,A){return n.attr(A,S)}),this.maxHandler&&(this.maxHandler.update({x:m-y/2}),this.get("updateAutoRender")||this.maxHandler.render()),each$1(E,function(S,A){return o.attr(A,S)})},r.prototype.bindEvents=function(){var e=this.get("group");e.on("handler-min:mousedown",this.onMouseDown("minHandler")),e.on("handler-min:touchstart",this.onMouseDown("minHandler")),e.on("handler-max:mousedown",this.onMouseDown("maxHandler")),e.on("handler-max:touchstart",this.onMouseDown("maxHandler"));var n=e.findById(this.getElementId("foreground"));n.on("mousedown",this.onMouseDown("foreground")),n.on("touchstart",this.onMouseDown("foreground"))},r.prototype.adjustOffsetRange=function(e){var n=this.cfg,o=n.start,s=n.end;switch(this.currentTarget){case"minHandler":{var l=0-o,c=1-o;return Math.min(c,Math.max(l,e))}case"maxHandler":{var l=0-s,c=1-s;return Math.min(c,Math.max(l,e))}case"foreground":{var l=0-o,c=1-s;return Math.min(c,Math.max(l,e))}}},r.prototype.updateStartEnd=function(e){var n=this.cfg,o=n.start,s=n.end;switch(this.currentTarget){case"minHandler":o+=e;break;case"maxHandler":s+=e;break;case"foreground":o+=e,s+=e;break}this.set("start",o),this.set("end",s)},r.prototype._dodgeText=function(e,n,o){var s,l,c=this.cfg,u=c.handlerStyle,f=c.width,d=2,g=get(u,"width",DEFAULT_HANDLER_WIDTH),p=e[0],v=e[1],m=!1;p>v&&(s=[v,p],p=s[0],v=s[1],l=[o,n],n=l[0],o=l[1],m=!0);var y=n.getBBox(),x=o.getBBox(),_=y.width>p-d?{x:p+g/2+d,textAlign:"left"}:{x:p-g/2-d,textAlign:"right"},E=x.width>f-v-d?{x:v-g/2-d,textAlign:"right"}:{x:v+g/2+d,textAlign:"left"};return m?[E,_]:[_,E]},r.prototype.draw=function(){var e=this.get("container"),n=e&&e.get("canvas");n&&n.draw()},r.prototype.getContainerDOM=function(){var e=this.get("container"),n=e&&e.get("canvas");return n&&n.get("container")},r}(GroupComponent),DEFAULT_STYLE={trackColor:"rgba(0,0,0,0)",thumbColor:"rgba(0,0,0,0.15)",size:8,lineCap:"round"},DEFAULT_THEME={default:DEFAULT_STYLE,hover:{thumbColor:"rgba(0,0,0,0.2)"}},Scrollbar$1=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.clearEvents=noop$1,e.onStartEvent=function(n){return function(o){e.isMobile=n,o.originalEvent.preventDefault();var s=n?get(o.originalEvent,"touches.0.clientX"):o.clientX,l=n?get(o.originalEvent,"touches.0.clientY"):o.clientY;e.startPos=e.cfg.isHorizontal?s:l,e.bindLaterEvent()}},e.bindLaterEvent=function(){var n=e.getContainerDOM(),o=[];e.isMobile?o=[addEventListener(n,"touchmove",e.onMouseMove),addEventListener(n,"touchend",e.onMouseUp),addEventListener(n,"touchcancel",e.onMouseUp)]:o=[addEventListener(n,"mousemove",e.onMouseMove),addEventListener(n,"mouseup",e.onMouseUp),addEventListener(n,"mouseleave",e.onMouseUp)],e.clearEvents=function(){o.forEach(function(s){s.remove()})}},e.onMouseMove=function(n){var o=e.cfg,s=o.isHorizontal,l=o.thumbOffset;n.preventDefault();var c=e.isMobile?get(n,"touches.0.clientX"):n.clientX,u=e.isMobile?get(n,"touches.0.clientY"):n.clientY,f=s?c:u,d=f-e.startPos;e.startPos=f,e.updateThumbOffset(l+d)},e.onMouseUp=function(n){n.preventDefault(),e.clearEvents()},e.onTrackClick=function(n){var o=e.cfg,s=o.isHorizontal,l=o.x,c=o.y,u=o.thumbLen,f=e.getContainerDOM(),d=f.getBoundingClientRect(),g=n.clientX,p=n.clientY,v=s?g-d.left-l-u/2:p-d.top-c-u/2,m=e.validateRange(v);e.updateThumbOffset(m)},e.onThumbMouseOver=function(){var n=e.cfg.theme.hover.thumbColor;e.getElementByLocalId("thumb").attr("stroke",n),e.draw()},e.onThumbMouseOut=function(){var n=e.cfg.theme.default.thumbColor;e.getElementByLocalId("thumb").attr("stroke",n),e.draw()},e}return r.prototype.setRange=function(e,n){this.set("minLimit",e),this.set("maxLimit",n);var o=this.getValue(),s=clamp(o,e,n);o!==s&&!this.get("isInit")&&this.setValue(s)},r.prototype.getRange=function(){var e=this.get("minLimit")||0,n=this.get("maxLimit")||1;return{min:e,max:n}},r.prototype.setValue=function(e){var n=this.getRange(),o=this.getValue();this.update({thumbOffset:(this.get("trackLen")-this.get("thumbLen"))*clamp(e,n.min,n.max)}),this.delegateEmit("valuechange",{originalValue:o,value:this.getValue()})},r.prototype.getValue=function(){return clamp(this.get("thumbOffset")/(this.get("trackLen")-this.get("thumbLen")),0,1)},r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return __assign$8(__assign$8({},e),{name:"scrollbar",isHorizontal:!0,minThumbLen:20,thumbOffset:0,theme:DEFAULT_THEME})},r.prototype.renderInner=function(e){this.renderTrackShape(e),this.renderThumbShape(e)},r.prototype.applyOffset=function(){this.moveElementTo(this.get("group"),{x:this.get("x"),y:this.get("y")})},r.prototype.initEvent=function(){this.bindEvents()},r.prototype.renderTrackShape=function(e){var n=this.cfg,o=n.trackLen,s=n.theme,l=s===void 0?{default:{}}:s,c=deepMix({},DEFAULT_THEME,l).default,u=c.lineCap,f=c.trackColor,d=c.size,g=get(this.cfg,"size",d),p=this.get("isHorizontal")?{x1:0+g/2,y1:g/2,x2:o-g/2,y2:g/2,lineWidth:g,stroke:f,lineCap:u}:{x1:g/2,y1:0+g/2,x2:g/2,y2:o-g/2,lineWidth:g,stroke:f,lineCap:u};return this.addShape(e,{id:this.getElementId("track"),name:"track",type:"line",attrs:p})},r.prototype.renderThumbShape=function(e){var n=this.cfg,o=n.thumbOffset,s=n.thumbLen,l=n.theme,c=deepMix({},DEFAULT_THEME,l).default,u=c.size,f=c.lineCap,d=c.thumbColor,g=get(this.cfg,"size",u),p=this.get("isHorizontal")?{x1:o+g/2,y1:g/2,x2:o+s-g/2,y2:g/2,lineWidth:g,stroke:d,lineCap:f,cursor:"default"}:{x1:g/2,y1:o+g/2,x2:g/2,y2:o+s-g/2,lineWidth:g,stroke:d,lineCap:f,cursor:"default"};return this.addShape(e,{id:this.getElementId("thumb"),name:"thumb",type:"line",attrs:p})},r.prototype.bindEvents=function(){var e=this.get("group");e.on("mousedown",this.onStartEvent(!1)),e.on("mouseup",this.onMouseUp),e.on("touchstart",this.onStartEvent(!0)),e.on("touchend",this.onMouseUp);var n=e.findById(this.getElementId("track"));n.on("click",this.onTrackClick);var o=e.findById(this.getElementId("thumb"));o.on("mouseover",this.onThumbMouseOver),o.on("mouseout",this.onThumbMouseOut)},r.prototype.getContainerDOM=function(){var e=this.get("container"),n=e&&e.get("canvas");return n&&n.get("container")},r.prototype.validateRange=function(e){var n=this.cfg,o=n.thumbLen,s=n.trackLen,l=e;return e+o>s?l=s-o:e+o<o&&(l=0),l},r.prototype.draw=function(){var e=this.get("container"),n=e&&e.get("canvas");n&&n.draw()},r.prototype.updateThumbOffset=function(e){var n=this.cfg,o=n.thumbOffset,s=n.isHorizontal,l=n.thumbLen,c=n.size,u=this.validateRange(e);if(u!==o){var f=this.getElementByLocalId("thumb");s?f.attr({x1:u+c/2,x2:u+l-c/2}):f.attr({y1:u+c/2,y2:u+l-c/2}),this.emitOffsetChange(u)}},r.prototype.emitOffsetChange=function(e){var n=this.cfg,o=n.thumbOffset,s=n.trackLen,l=n.thumbLen;this.cfg.thumbOffset=e,this.emit("scrollchange",{thumbOffset:e,ratio:clamp(e/(s-l),0,1)}),this.delegateEmit("valuechange",{originalValue:o,value:e})},r}(GroupComponent),LineAxis=Line$5,CircleAxis=Circle$4,LineGrid=Line$4,CircleGrid=Circle$3,CategoryLegend=Category,ContinuousLegend=ContinueLegend,HtmlTooltip=Tooltip$1;function getPointsBox(a){if(isEmpty(a))return null;var r=a[0].x,e=a[0].x,n=a[0].y,o=a[0].y;return each$1(a,function(s){r=r>s.x?s.x:r,e=e<s.x?s.x:e,n=n>s.y?s.y:n,o=o<s.y?s.y:o}),{minX:r,maxX:e,minY:n,maxY:o,centerX:(r+e)/2,centerY:(n+o)/2}}function uniqueValues(a){return Array.from(new Set(a)).length===1}function mid(a){return(min$2(a)+max$2(a))/2}function polarToCartesian(a,r,e,n){return{x:a+e*Math.cos(n),y:r+e*Math.sin(n)}}function getSectorPath(a,r,e,n,o,s){s===void 0&&(s=0);var l=polarToCartesian(a,r,e,n),c=polarToCartesian(a,r,e,o),u=polarToCartesian(a,r,s,n),f=polarToCartesian(a,r,s,o);if(o-n===Math.PI*2){var d=polarToCartesian(a,r,e,n+Math.PI),g=polarToCartesian(a,r,s,n+Math.PI),p=[["M",l.x,l.y],["A",e,e,0,1,1,d.x,d.y],["A",e,e,0,1,1,c.x,c.y],["M",u.x,u.y]];return s&&(p.push(["A",s,s,0,1,0,g.x,g.y]),p.push(["A",s,s,0,1,0,f.x,f.y])),p.push(["M",l.x,l.y]),p.push(["Z"]),p}var v=o-n<=Math.PI?0:1,m=[["M",l.x,l.y],["A",e,e,0,v,1,c.x,c.y],["L",f.x,f.y]];return s&&m.push(["A",s,s,0,v,0,u.x,u.y]),m.push(["L",l.x,l.y]),m.push(["Z"]),m}function getArcPath(a,r,e,n,o){var s=polarToCartesian(a,r,e,n),l=polarToCartesian(a,r,e,o);if(isNumberEqual$1(o-n,Math.PI*2)){var c=polarToCartesian(a,r,e,n+Math.PI);return[["M",s.x,s.y],["A",e,e,0,1,1,c.x,c.y],["A",e,e,0,1,1,s.x,s.y],["A",e,e,0,1,0,c.x,c.y],["A",e,e,0,1,0,s.x,s.y],["Z"]]}var u=o-n<=Math.PI?0:1;return[["M",s.x,s.y],["A",e,e,0,u,1,l.x,l.y]]}function getAngle$1(a,r){var e=a.points,n=getPointsBox(e),o,s,l=r.startAngle,c=r.endAngle,u=c-l;return r.isTransposed?(o=n.maxY*u,s=n.minY*u):(o=n.maxX*u,s=n.minX*u),o+=l,s+=l,{startAngle:s,endAngle:o}}function getPolygonCentroid(a,r){if(isNumber$2(a)&&isNumber$2(r))return[a,r];if(a=a,r=r,uniqueValues(a)||uniqueValues(r))return[mid(a),mid(r)];for(var e=-1,n=0,o=0,s,l=a.length-1,c,u=0;++e<a.length;)s=l,l=e,u+=c=a[s]*r[l]-a[l]*r[s],n+=(a[s]+a[l])*c,o+=(r[s]+r[l])*c;return u*=3,[n/u,o/u]}function getReplaceAttrs(a,r){var e=a.attr(),n=r.attr();return each$1(e,function(o,s){n[s]===void 0&&(n[s]=void 0)}),n}function isBetween$1(a,r,e){var n=Math.min(r,e),o=Math.max(r,e);return a>=n&&a<=o}function padEnd(a,r,e){if(isString$1(a))return a.padEnd(r,e);if(isArray$4(a)){var n=a.length;if(n<r)for(var o=r-n,s=0;s<o;s++)a.push(e)}return a}function omit(a,r){return typeof a=="object"&&r.forEach(function(e){delete a[e]}),a}function uniq$1(a,r,e){var n,o;r===void 0&&(r=[]),e===void 0&&(e=new Map);try{for(var s=__values(a),l=s.next();!l.done;l=s.next()){var c=l.value;e.has(c)||(r.push(c),e.set(c,!0))}}catch(u){n={error:u}}finally{try{l&&!l.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}return r}var BBox=function(){function a(r,e,n,o){r===void 0&&(r=0),e===void 0&&(e=0),n===void 0&&(n=0),o===void 0&&(o=0),this.x=r,this.y=e,this.height=o,this.width=n}return a.fromRange=function(r,e,n,o){return new a(r,e,n-r,o-e)},a.fromObject=function(r){return new a(r.minX,r.minY,r.width,r.height)},Object.defineProperty(a.prototype,"minX",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"maxX",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"minY",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"maxY",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"tl",{get:function(){return{x:this.x,y:this.y}},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"tr",{get:function(){return{x:this.maxX,y:this.y}},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"bl",{get:function(){return{x:this.x,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"br",{get:function(){return{x:this.maxX,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"top",{get:function(){return{x:this.x+this.width/2,y:this.minY}},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"right",{get:function(){return{x:this.maxX,y:this.y+this.height/2}},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"bottom",{get:function(){return{x:this.x+this.width/2,y:this.maxY}},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"left",{get:function(){return{x:this.minX,y:this.y+this.height/2}},enumerable:!1,configurable:!0}),a.prototype.isEqual=function(r){return this.x===r.x&&this.y===r.y&&this.width===r.width&&this.height===r.height},a.prototype.contains=function(r){return r.minX>=this.minX&&r.maxX<=this.maxX&&r.minY>=this.minY&&r.maxY<=this.maxY},a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)},a.prototype.add=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var n=this.clone();return each$1(r,function(o){n.x=Math.min(o.x,n.x),n.y=Math.min(o.y,n.y),n.width=Math.max(o.maxX,n.maxX)-n.x,n.height=Math.max(o.maxY,n.maxY)-n.y}),n},a.prototype.merge=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var n=this.clone();return each$1(r,function(o){n.x=Math.max(o.x,n.x),n.y=Math.max(o.y,n.y),n.width=Math.min(o.maxX,n.maxX)-n.x,n.height=Math.min(o.maxY,n.maxY)-n.y}),n},a.prototype.cut=function(r,e){var n=r.width,o=r.height;switch(e){case DIRECTION.TOP:case DIRECTION.TOP_LEFT:case DIRECTION.TOP_RIGHT:return a.fromRange(this.minX,this.minY+o,this.maxX,this.maxY);case DIRECTION.RIGHT:case DIRECTION.RIGHT_TOP:case DIRECTION.RIGHT_BOTTOM:return a.fromRange(this.minX,this.minY,this.maxX-n,this.maxY);case DIRECTION.BOTTOM:case DIRECTION.BOTTOM_LEFT:case DIRECTION.BOTTOM_RIGHT:return a.fromRange(this.minX,this.minY,this.maxX,this.maxY-o);case DIRECTION.LEFT:case DIRECTION.LEFT_TOP:case DIRECTION.LEFT_BOTTOM:return a.fromRange(this.minX+n,this.minY,this.maxX,this.maxY);default:return this}},a.prototype.shrink=function(r){var e=__read(r,4),n=e[0],o=e[1],s=e[2],l=e[3];return new a(this.x+l,this.y+n,this.width-l-o,this.height-n-s)},a.prototype.expand=function(r){var e=__read(r,4),n=e[0],o=e[1],s=e[2],l=e[3];return new a(this.x-l,this.y-n,this.width+l+o,this.height+n+s)},a.prototype.exceed=function(r){return[Math.max(-this.minY+r.minY,0),Math.max(this.maxX-r.maxX,0),Math.max(this.maxY-r.maxY,0),Math.max(-this.minX+r.minX,0)]},a.prototype.collide=function(r){return this.minX<r.maxX&&this.maxX>r.minX&&this.minY<r.maxY&&this.maxY>r.minY},a.prototype.size=function(){return this.width*this.height},a.prototype.isPointIn=function(r){return r.x>=this.minX&&r.x<=this.maxX&&r.y>=this.minY&&r.y<=this.maxY},a}();function toPoints(a){return[[a.minX,a.minY],[a.maxX,a.minY],[a.maxX,a.maxY],[a.minX,a.maxY]]}function getXDimensionLength(a){if(a.isPolar&&!a.isTransposed)return(a.endAngle-a.startAngle)*a.getRadius();var r=a.convert({x:0,y:0}),e=a.convert({x:1,y:0});return Math.sqrt(Math.pow(e.x-r.x,2)+Math.pow(e.y-r.y,2))}function isFullCircle(a){if(a.isPolar){var r=a.startAngle,e=a.endAngle;return e-r===Math.PI*2}return!1}function getDistanceToCenter(a,r){var e=a.getCenter();return Math.sqrt(Math.pow(r.x-e.x,2)+Math.pow(r.y-e.y,2))}function isPointInCoordinate(a,r){var e=!1;if(a)if(a.type==="theta"){var n=a.start,o=a.end;e=isBetween$1(r.x,n.x,o.x)&&isBetween$1(r.y,n.y,o.y)}else{var s=a.invert(r);e=isBetween$1(s.x,0,1)&&isBetween$1(s.y,0,1)}return e}function getAngleByPoint(a,r){var e=a.getCenter();return Math.atan2(r.y-e.y,r.x-e.x)}function getCoordinateClipCfg(a,r){r===void 0&&(r=0);var e=a.start,n=a.end,o=a.getWidth(),s=a.getHeight();if(a.isPolar){var l=a.startAngle,c=a.endAngle,u=a.getCenter(),f=a.getRadius();return{type:"path",startState:{path:getSectorPath(u.x,u.y,f+r,l,l)},endState:function(g){var p=(c-l)*g+l,v=getSectorPath(u.x,u.y,f+r,l,p);return{path:v}},attrs:{path:getSectorPath(u.x,u.y,f+r,l,c)}}}var d;return a.isTransposed?d={height:s+r*2}:d={width:o+r*2},{type:"rect",startState:{x:e.x-r,y:n.y-r,width:a.isTransposed?o+r*2:0,height:a.isTransposed?0:s+r*2},endState:d,attrs:{x:e.x-r,y:n.y-r,width:o+r*2,height:s+r*2}}}function getCoordinateBBox(a,r){r===void 0&&(r=0);var e=a.start,n=a.end,o=a.getWidth(),s=a.getHeight(),l=Math.min(e.x,n.x),c=Math.min(e.y,n.y);return BBox.fromRange(l-r,c-r,l+o+r,c+s+r)}var dateRegex=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]+)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/;function getDefaultType(a){var r="linear";return dateRegex.test(a)?r="timeCat":isString$1(a)&&(r="cat"),r}function inferScaleType(a,r,e,n){return r===void 0&&(r={}),r.type?r.type:a.type!=="identity"&&GROUP_ATTRS.includes(e)&&["interval"].includes(n)||a.isCategory?"cat":a.type}function createScaleByField(a,r,e){var n=r||[];if(isNumber$2(a)||isNil(firstValue(n,a))&&isEmpty(e)){var o=getClass("identity");return new o({field:a.toString(),values:[a]})}var s=valuesOfKey(n,a),l=get(e,"type",getDefaultType(s[0])),c=getClass(l);return new c(__assign$8({field:a,values:s},e))}function syncScale(a,r){if(a.type!=="identity"&&r.type!=="identity"){var e={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);a.change(e)}}function getName(a){return a.alias||a.field}function getDefaultCategoryScaleRange(a,r,e){var n=a.values,o=n.length,s;if(o===1)s=[.5,1];else{var l=1,c=0;isFullCircle(r)?r.isTransposed?(l=get(e,"widthRatio.multiplePie",1/1.3),c=1/o*l,s=[c/2,1-c/2]):s=[0,1-1/o]:(c=1/o/2,s=[c,1-c])}return s}function getMaxScale(a){var r=a.values.filter(function(e){return!isNil(e)&&!isNaN(e)});return Math.max.apply(Math,__spreadArray$2(__spreadArray$2([],__read(r),!1),[isNil(a.max)?-1/0:a.max],!1))}function getLineAxisRelativeRegion(a){var r,e;switch(a){case DIRECTION.TOP:r={x:0,y:1},e={x:1,y:1};break;case DIRECTION.RIGHT:r={x:1,y:0},e={x:1,y:1};break;case DIRECTION.BOTTOM:r={x:0,y:0},e={x:1,y:0};break;case DIRECTION.LEFT:r={x:0,y:0},e={x:0,y:1};break;default:r=e={x:0,y:0}}return{start:r,end:e}}function getCircleAxisRelativeRegion(a){var r,e;return a.isTransposed?(r={x:0,y:0},e={x:1,y:0}):(r={x:0,y:0},e={x:0,y:1}),{start:r,end:e}}function getAxisRegion(a,r){var e={start:{x:0,y:0},end:{x:0,y:0}};a.isRect?e=getLineAxisRelativeRegion(r):a.isPolar&&(e=getCircleAxisRelativeRegion(a));var n=e.start,o=e.end;return{start:a.convert(n),end:a.convert(o)}}function isVertical(a){var r=a.start,e=a.end;return r.x===e.x}function getAxisFactorByRegion(a,r){var e=a.start,n=a.end,o=isVertical(a);return o?(e.y-n.y)*(r.x-e.x)>0?1:-1:(n.x-e.x)*(e.y-r.y)>0?-1:1}function getAxisThemeCfg(a,r){var e=get(a,["components","axis"],{});return deepMix({},get(e,["common"],{}),deepMix({},get(e,[r],{})))}function getAxisTitleOptions(a,r,e){var n=get(a,["components","axis"],{});return deepMix({},get(n,["common","title"],{}),deepMix({},get(n,[r,"title"],{})),e)}function getCircleAxisCenterRadius(a){var r=a.x,e=a.y,n=a.circleCenter,o=e.start>e.end,s=a.isTransposed?a.convert({x:o?0:1,y:0}):a.convert({x:0,y:o?0:1}),l=[s.x-n.x,s.y-n.y],c=[1,0],u=s.y>n.y?angle$1(l,c):angle$1(l,c)*-1,f=u+(r.end-r.start),d=Math.sqrt(Math.pow(s.x-n.x,2)+Math.pow(s.y-n.y,2));return{center:n,radius:d,startAngle:u,endAngle:f}}function getAxisOption(a,r){return isBoolean(a)?a===!1?!1:{}:get(a,[r])}function getAxisDirection(a,r){return get(a,"position",r)}function getAxisTitleText(a,r){return get(r,["title","text"],getName(a))}var Facet$1=function(){function a(r,e){this.destroyed=!1,this.facets=[],this.view=r,this.cfg=deepMix({},this.getDefaultCfg(),e)}return a.prototype.init=function(){this.container||(this.container=this.createContainer());var r=this.view.getData();this.facets=this.generateFacets(r)},a.prototype.render=function(){this.renderViews()},a.prototype.update=function(){},a.prototype.clear=function(){this.clearFacetViews()},a.prototype.destroy=function(){this.clear(),this.container&&(this.container.remove(!0),this.container=void 0),this.destroyed=!0,this.view=void 0,this.facets=[]},a.prototype.facetToView=function(r){var e=r.region,n=r.data,o=r.padding,s=o===void 0?this.cfg.padding:o,l=this.view.createView({region:e,padding:s});l.data(n||[]),r.view=l,this.beforeEachView(l,r);var c=this.cfg.eachView;return c&&c(l,r),this.afterEachView(l,r),l},a.prototype.createContainer=function(){var r=this.view.getLayer(LAYER.FORE);return r.addGroup()},a.prototype.renderViews=function(){this.createFacetViews()},a.prototype.createFacetViews=function(){var r=this;return this.facets.map(function(e){return r.facetToView(e)})},a.prototype.clearFacetViews=function(){var r=this;each$1(this.facets,function(e){e.view&&(r.view.removeView(e.view),e.view=void 0)})},a.prototype.parseSpacing=function(){var r=this.view.viewBBox,e=r.width,n=r.height,o=this.cfg.spacing;return o.map(function(s,l){return isNumber$2(s)?s/(l===0?e:n):parseFloat(s)/100})},a.prototype.getFieldValues=function(r,e){var n=[],o={};return each$1(r,function(s){var l=s[e];!isNil(l)&&!o[l]&&(n.push(l),o[l]=!0)}),n},a.prototype.getRegion=function(r,e,n,o){var s=__read(this.parseSpacing(),2),l=s[0],c=s[1],u=(1+l)/(e===0?1:e)-l,f=(1+c)/(r===0?1:r)-c,d={x:(u+l)*n,y:(f+c)*o},g={x:d.x+u,y:d.y+f};return{start:d,end:g}},a.prototype.getDefaultCfg=function(){return{eachView:void 0,showTitle:!0,spacing:[0,0],padding:10,fields:[]}},a.prototype.getDefaultTitleCfg=function(){var r=this.view.getTheme().fontFamily;return{style:{fontSize:14,fill:"#666",fontFamily:r}}},a.prototype.processAxis=function(r,e){var n=r.getOptions(),o=n.coordinate,s=r.geometries,l=get(o,"type","rect");if(l==="rect"&&s.length){isNil(n.axes)&&(n.axes={});var c=n.axes,u=__read(s[0].getXYFields(),2),f=u[0],d=u[1],g=getAxisOption(c,f),p=getAxisOption(c,d);g!==!1&&(n.axes[f]=this.getXAxisOption(f,c,g,e)),p!==!1&&(n.axes[d]=this.getYAxisOption(d,c,p,e))}},a.prototype.getFacetDataFilter=function(r){return function(e){return every(r,function(n){var o=n.field,s=n.value;return!isNil(s)&&o?e[o]===s:!0})}},a}(),Facets={},getFacet=function(a){return Facets[lowerCase(a)]},registerFacet=function(a,r){Facets[lowerCase(a)]=r},Action=function(){function a(r,e){this.context=r,this.cfg=e,r.addAction(this)}return a.prototype.applyCfg=function(r){mix(this,r)},a.prototype.init=function(){this.applyCfg(this.cfg)},a.prototype.destroy=function(){this.context.removeAction(this),this.context=null},a}(),CallbackAction=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.execute=function(){this.callback&&this.callback(this.context)},r.prototype.destroy=function(){a.prototype.destroy.call(this),this.callback=null},r}(Action),ActionCache={};function createAction(a,r){var e=ActionCache[a],n=null;if(e){var o=e.ActionClass,s=e.cfg;n=new o(r,s),n.name=a,n.init()}return n}function getActionClass(a){var r=ActionCache[a];return get(r,"ActionClass")}function registerAction(a,r,e){ActionCache[a]={ActionClass:r,cfg:e}}function createCallbackAction(a,r){var e=new CallbackAction(r);return e.callback=a,e.name="callback",e}function _points2path(a,r){var e=[];if(a.length){e.push(["M",a[0].x,a[0].y]);for(var n=1,o=a.length;n<o;n+=1){var s=a[n];e.push(["L",s.x,s.y])}r&&e.push(["Z"])}return e}function _convertArr(a,r){for(var e=[a[0]],n=1,o=a.length;n<o;n=n+2){var s=r.convert({x:a[n],y:a[n+1]});e.push(s.x,s.y)}return e}function _convertArcPath(a,r){var e=r.isTransposed,n=a[1],o=a[6],s=a[7],l=r.convert({x:o,y:s}),c=e?0:1;return["A",n,n,0,0,c,l.x,l.y]}function _convertPolarPath(a,r,e){var n=e.isTransposed,o=e.startAngle,s=e.endAngle,l=a[0].toLowerCase()==="a"?{x:a[6],y:a[7]}:{x:a[1],y:a[2]},c={x:r[1],y:r[2]},u=[],f=n?"y":"x",d=Math.abs(c[f]-l[f])*(s-o),g=c[f]>=l[f]?1:0,p=d>Math.PI?1:0,v=e.convert(c),m=getDistanceToCenter(e,v);if(m>=.5)if(d===Math.PI*2){var y={x:(c.x+l.x)/2,y:(c.y+l.y)/2},x=e.convert(y);u.push(["A",m,m,0,p,g,x.x,x.y]),u.push(["A",m,m,0,p,g,v.x,v.y])}else u.push(["A",m,m,0,p,g,v.x,v.y]);return u}function _filterFullCirleLine(a){each$1(a,function(r,e){var n=r;if(n[0].toLowerCase()==="a"){var o=a[e-1],s=a[e+1];s&&s[0].toLowerCase()==="a"?o&&o[0].toLowerCase()==="l"&&(o[0]="M"):o&&o[0].toLowerCase()==="a"&&s&&s[0].toLowerCase()==="l"&&(s[0]="M")}})}var smoothBezier$1=function(a,r,e,n){var o,s=[],l=!!n,c,u,f,d,g,p,v;if(l){o=__read(n,2),f=o[0],d=o[1];for(var m=0,y=a.length;m<y;m++){var x=a[m];f=min$1([0,0],f,x),d=max$1([0,0],d,x)}}for(var m=0,_=a.length;m<_;m++){var x=a[m];if(m===0&&!e)v=x;else if(m===_-1&&!e)p=x,s.push(v),s.push(p);else{c=a[e?m?m-1:_-1:m-1],u=a[e?(m+1)%_:m+1];var E=[0,0];E=sub(E,u,c),E=scale$3(E,E,r);var S=distance$6(x,c),A=distance$6(x,u),T=S+A;T!==0&&(S/=T,A/=T);var b=scale$3([0,0],E,-S),C=scale$3([0,0],E,A);p=add$1([0,0],x,b),g=add$1([0,0],x,C),g=min$1([0,0],g,max$1([0,0],u,x)),g=max$1([0,0],g,min$1([0,0],u,x)),b=sub([0,0],g,x),b=scale$3([0,0],b,-S/A),p=add$1([0,0],x,b),p=min$1([0,0],p,max$1([0,0],c,x)),p=max$1([0,0],p,min$1([0,0],c,x)),C=sub([0,0],x,p),C=scale$3([0,0],C,A/S),g=add$1([0,0],x,C),l&&(p=max$1([0,0],p,f),p=min$1([0,0],p,d),g=max$1([0,0],g,f),g=min$1([0,0],g,d)),s.push(v),s.push(p),v=g}}return e&&s.push(s.shift()),s};function catmullRom2bezier$1(a,r,e){for(var n=!!r,o=[],s=0,l=a.length;s<l;s+=2)o.push([a[s],a[s+1]]);for(var c=smoothBezier$1(o,.4,n,e),u=o.length,f=[],d,g,p,s=0;s<u-1;s++)d=c[s*2],g=c[s*2+1],p=o[s+1],f.push(["C",d[0],d[1],g[0],g[1],p[0],p[1]]);return n&&(d=c[u],g=c[u+1],p=o[0],f.push(["C",d[0],d[1],g[0],g[1],p[0],p[1]])),f}function getLinePath(a,r){return _points2path(a,r)}function getSplinePath$1(a,r,e){var n=[],o=a[0],s=null;if(a.length<=2)return getLinePath(a,r);for(var l=0,c=a.length;l<c;l++){var u=a[l];(!s||!(s.x===u.x&&s.y===u.y))&&(n.push(u.x),n.push(u.y),s=u)}var f=e||[[0,0],[1,1]],d=catmullRom2bezier$1(n,r,f);return d.unshift(["M",o.x,o.y]),d}function convertNormalPath(a,r){var e=[];return each$1(r,function(n){var o=n[0];switch(o.toLowerCase()){case"m":case"l":case"c":e.push(_convertArr(n,a));break;case"a":e.push(_convertArcPath(n,a));break;case"z":default:e.push(n);break}}),e}function convertPolarPath(a,r){var e=[],n,o,s,l;return each$1(r,function(c,u){var f=c[0];switch(f.toLowerCase()){case"m":case"c":case"q":e.push(_convertArr(c,a));break;case"l":n=r[u-1],o=c,s=a.isTransposed,l=s?n[n.length-2]===o[1]:n[n.length-1]===o[2],l?e=e.concat(_convertPolarPath(n,o,a)):e.push(_convertArr(c,a));break;case"a":e.push(_convertArcPath(c,a));break;case"z":default:e.push(c);break}}),_filterFullCirleLine(e),e}function getMaskBBox(a,r){var e=a.event,n=e.target;return getMaskBBoxByShape(n,r)}function isValidMaskBBox(a,r){var e=a.getCanvasBBox(),n=e.width,o=e.height;return n>0&&o>0&&(n>=r||o>=r)}function getMaskBBoxByShape(a,r){var e=a.getCanvasBBox();return isValidMaskBBox(a,r)?e:null}function getMultiMaskBBoxList(a,r){var e=a.event.maskShapes;return e.map(function(n){return getMaskBBoxByShape(n,r)}).filter(function(n){return!!n})}function getMaskPath$2(a,r){var e=a.event,n=e.target;return getMaskPathByMaskShape(n,r)}function getMaskPathByMaskShape(a,r){return isValidMaskBBox(a,r)?a.attr("path"):null}function getMultiMaskPathList(a,r){var e=a.event.maskShapes;return e.map(function(n){return getMaskPathByMaskShape(n,r)})}function getCurrentElement$1(a){var r=a.event,e,n=r.target;return n&&(e=n.get("element")),e}function getDelegationObject(a){var r=a.event,e=r.target,n;return e&&(n=e.get("delegateObject")),n}function isElementChange(a){var r=a.event.gEvent;return!(r&&r.fromShape&&r.toShape&&r.fromShape.get("element")===r.toShape.get("element"))}function isList(a){return a&&a.component&&a.component.isList()}function isSlider(a){return a&&a.component&&a.component.isSlider()}function isMask(a){var r=a.event,e=r.target;return e&&(e==null?void 0:e.get("name"))==="mask"||isMultipleMask(a)}function isMultipleMask(a){var r;return((r=a.event.target)===null||r===void 0?void 0:r.get("name"))==="multi-mask"}function getMaskedElements(a,r){var e=a.event.target;if(isMultipleMask(a))return getMultiMaskedElements(a,r);if(e.get("type")==="path"){var n=getMaskPath$2(a,r);return n?getElementsByPath(a.view,n):void 0}var o=getMaskBBox(a,r);return o?getIntersectElements(a.view,o):null}function getMultiMaskedElements(a,r){var e=a.event.target;if(e.get("type")==="path"){var n=getMultiMaskPathList(a,r);return n.length>0?n.flatMap(function(s){return getElementsByPath(a.view,s)}):null}var o=getMultiMaskBBoxList(a,r);return o.length>0?o.flatMap(function(s){return getIntersectElements(a.view,s)}):null}function getSiblingMaskElements(a,r,e){if(isMultipleMask(a))return getSiblingMultiMaskedElements(a,r,e);var n=getMaskBBox(a,e);return n?getSiblingMaskElementsByBBox(n,a,r):null}function getSiblingMaskElementsByBBox(a,r,e){var n=r.view,o=getSiblingPoint(n,e,{x:a.x,y:a.y}),s=getSiblingPoint(n,e,{x:a.maxX,y:a.maxY}),l={minX:o.x,minY:o.y,maxX:s.x,maxY:s.y};return getIntersectElements(e,l)}function getSiblingMultiMaskedElements(a,r,e){var n=getMultiMaskBBoxList(a,e);return n.length>0?n.flatMap(function(o){return getSiblingMaskElementsByBBox(o,a,r)}):null}function getElements(a){var r=a.geometries,e=[];return each$1(r,function(n){var o=n.elements;e=e.concat(o)}),a.views&&a.views.length&&each$1(a.views,function(n){e=e.concat(getElements(n))}),e}function getElementsByField(a,r,e){var n=getElements(a);return n.filter(function(o){return getElementValue$1(o,r)===e})}function getElementsByState(a,r){var e=a.geometries,n=[];return each$1(e,function(o){var s=o.getElementsBy(function(l){return l.hasState(r)});n=n.concat(s)}),n}function getElementValue$1(a,r){var e=a.getModel(),n=e.data,o;return isArray$4(n)?o=n[0][r]:o=n[r],o}function intersectRect$1(a,r){return!(r.minX>a.maxX||r.maxX<a.minX||r.minY>a.maxY||r.maxY<a.minY)}function getIntersectElements(a,r){var e=getElements(a),n=[];return each$1(e,function(o){var s=o.shape,l=s.getCanvasBBox();intersectRect$1(r,l)&&n.push(o)}),n}function pathToPoints(a){var r=[];return each$1(a,function(e){var n=e[0];if(n!=="A")for(var o=1;o<e.length;o=o+2)r.push([e[o],e[o+1]]);else{var s=e.length;r.push([e[s-2],e[s-1]])}}),r}function getElementsByPath(a,r){var e=getElements(a),n=pathToPoints(r),o=e.filter(function(s){var l=s.shape,c;if(l.get("type")==="path")c=pathToPoints(l.attr("path"));else{var u=l.getCanvasBBox();c=toPoints(u)}return isPolygonsIntersect(n,c)});return o}function getComponents(a){return a.getComponents().map(function(r){return r.component})}function distance$2(a,r){var e=r.x-a.x,n=r.y-a.y;return Math.sqrt(e*e+n*n)}function getSpline(a,r){if(a.length<=2)return getLinePath(a,!1);var e=a[0],n=[];each$1(a,function(s){n.push(s.x),n.push(s.y)});var o=catmullRom2bezier$1(n,r,null);return o.unshift(["M",e.x,e.y]),o}function isInBox(a,r){return a.x<=r.x&&a.maxX>=r.x&&a.y<=r.y&&a.maxY>r.y}function getSilbings(a){var r=a.parent,e=null;return r&&(e=r.views.filter(function(n){return n!==a})),e}function point2Normalize(a,r){var e=a.getCoordinate();return e.invert(r)}function getSiblingPoint(a,r,e){var n=point2Normalize(a,e);return r.getCoordinate().convert(n)}function isInRecords(a,r,e,n){var o=!1;return each$1(a,function(s){if(s[e]===r[e]&&s[n]===r[n])return o=!0,!1}),o}function getScaleByField(a,r){var e=a.getScaleByField(r);return!e&&a.views&&each$1(a.views,function(n){if(e=getScaleByField(n,r),e)return!1}),e}var Context=function(){function a(r){this.actions=[],this.event=null,this.cacheMap={},this.view=r}return a.prototype.cache=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];if(r.length===1)return this.cacheMap[r[0]];r.length===2&&(this.cacheMap[r[0]]=r[1])},a.prototype.getAction=function(r){return this.actions.find(function(e){return e.name===r})},a.prototype.addAction=function(r){this.actions.push(r)},a.prototype.removeAction=function(r){var e=this.actions,n=this.actions.indexOf(r);n>=0&&e.splice(n,1)},a.prototype.getCurrentPoint=function(){var r=this.event;if(r)if(r.target instanceof HTMLElement){var e=this.view.getCanvas(),n=e.getPointByClient(r.clientX,r.clientY);return n}else return{x:r.x,y:r.y};return null},a.prototype.getCurrentShape=function(){return get(this.event,["gEvent","shape"])},a.prototype.isInPlot=function(){var r=this.getCurrentPoint();return r?this.view.isPointInPlot(r):!1},a.prototype.isInShape=function(r){var e=this.getCurrentShape();return e?e.get("name")===r:!1},a.prototype.isInComponent=function(r){var e=getComponents(this.view),n=this.getCurrentPoint();return n?!!e.find(function(o){var s=o.getBBox();return r?o.get("name")===r&&isInBox(s,n):isInBox(s,n)}):!1},a.prototype.destroy=function(){each$1(this.actions.slice(),function(r){r.destroy()}),this.view=null,this.event=null,this.actions=null,this.cacheMap=null},a}(),Interaction=function(){function a(r,e){this.view=r,this.cfg=e}return a.prototype.init=function(){this.initEvents()},a.prototype.initEvents=function(){},a.prototype.clearEvents=function(){},a.prototype.destroy=function(){this.clearEvents()},a}();function parseAction(a,r,e){var n=a.split(":"),o=n[0],s=r.getAction(o)||createAction(o,r);if(!s)throw new Error("There is no action named ".concat(o));var l=n[1];return{action:s,methodName:l,arg:e}}function executeAction(a){var r=a.action,e=a.methodName,n=a.arg;if(r[e])r[e](n);else throw new Error("Action(".concat(r.name,") doesn't have a method called ").concat(e))}var STEP_NAMES={START:"start",SHOW_ENABLE:"showEnable",END:"end",ROLLBACK:"rollback",PROCESSING:"processing"},GrammarInteraction=function(a){__extends$7(r,a);function r(e,n){var o=a.call(this,e,n)||this;return o.callbackCaches={},o.emitCaches={},o.steps=n,o}return r.prototype.init=function(){this.initContext(),a.prototype.init.call(this)},r.prototype.destroy=function(){a.prototype.destroy.call(this),this.steps=null,this.context&&(this.context.destroy(),this.context=null),this.callbackCaches=null,this.view=null},r.prototype.initEvents=function(){var e=this;each$1(this.steps,function(n,o){each$1(n,function(s){var l=e.getActionCallback(o,s);l&&e.bindEvent(s.trigger,l)})})},r.prototype.clearEvents=function(){var e=this;each$1(this.steps,function(n,o){each$1(n,function(s){var l=e.getActionCallback(o,s);l&&e.offEvent(s.trigger,l)})})},r.prototype.initContext=function(){var e=this.view,n=new Context(e);this.context=n;var o=this.steps;each$1(o,function(s){each$1(s,function(l){if(isFunction$1(l.action))l.actionObject={action:createCallbackAction(l.action,n),methodName:"execute"};else if(isString$1(l.action))l.actionObject=parseAction(l.action,n,l.arg);else if(isArray$4(l.action)){var c=l.action,u=isArray$4(l.arg)?l.arg:[l.arg];l.actionObject=[],each$1(c,function(f,d){l.actionObject.push(parseAction(f,n,u[d]))})}})})},r.prototype.isAllowStep=function(e){var n=this.currentStepName,o=this.steps;if(n===e||e===STEP_NAMES.SHOW_ENABLE)return!0;if(e===STEP_NAMES.PROCESSING)return n===STEP_NAMES.START;if(e===STEP_NAMES.START)return n!==STEP_NAMES.PROCESSING;if(e===STEP_NAMES.END)return n===STEP_NAMES.PROCESSING||n===STEP_NAMES.START;if(e===STEP_NAMES.ROLLBACK){if(o[STEP_NAMES.END])return n===STEP_NAMES.END;if(n===STEP_NAMES.START)return!0}return!1},r.prototype.isAllowExecute=function(e,n){if(this.isAllowStep(e)){var o=this.getKey(e,n);return n.once&&this.emitCaches[o]?!1:n.isEnable?n.isEnable(this.context):!0}return!1},r.prototype.enterStep=function(e){this.currentStepName=e,this.emitCaches={}},r.prototype.afterExecute=function(e,n){e!==STEP_NAMES.SHOW_ENABLE&&this.currentStepName!==e&&this.enterStep(e);var o=this.getKey(e,n);this.emitCaches[o]=!0},r.prototype.getKey=function(e,n){return e+n.trigger+n.action},r.prototype.getActionCallback=function(e,n){var o=this,s=this.context,l=this.callbackCaches,c=n.actionObject;if(n.action&&c){var u=this.getKey(e,n);if(!l[u]){var f=function(d){s.event=d,o.isAllowExecute(e,n)?(isArray$4(c)?each$1(c,function(g){s.event=d,executeAction(g)}):(s.event=d,executeAction(c)),o.afterExecute(e,n),n.callback&&(s.event=d,n.callback(s))):s.event=null};n.debounce?l[u]=debounce$1(f,n.debounce.wait,n.debounce.immediate):n.throttle?l[u]=throttle$1(f,n.throttle.wait,{leading:n.throttle.leading,trailing:n.throttle.trailing}):l[u]=f}return l[u]}return null},r.prototype.bindEvent=function(e,n){var o=e.split(":");o[0]==="window"?window.addEventListener(o[1],n):o[0]==="document"?document.addEventListener(o[1],n):this.view.on(e,n)},r.prototype.offEvent=function(e,n){var o=e.split(":");o[0]==="window"?window.removeEventListener(o[1],n):o[0]==="document"?document.removeEventListener(o[1],n):this.view.off(e,n)},r}(Interaction),Interactions={};function getInteraction(a){return Interactions[lowerCase(a)]}function registerInteraction(a,r){Interactions[lowerCase(a)]=r}function createInteraction(a,r,e){var n=getInteraction(a);if(!n)return null;if(isPlainObject$1(n)){var o=mix(clone(n),e);return new GrammarInteraction(r,o)}else{var s=n;return new s(r,e)}}function createAxisStyles(a){return{title:{autoRotate:!0,position:"center",spacing:a.axisTitleSpacing,style:{fill:a.axisTitleTextFillColor,fontSize:a.axisTitleTextFontSize,lineHeight:a.axisTitleTextLineHeight,textBaseline:"middle",fontFamily:a.fontFamily},iconStyle:{fill:a.axisDescriptionIconFillColor}},label:{autoRotate:!1,autoEllipsis:!1,autoHide:{type:"equidistance",cfg:{minGap:6}},offset:a.axisLabelOffset,style:{fill:a.axisLabelFillColor,fontSize:a.axisLabelFontSize,lineHeight:a.axisLabelLineHeight,fontFamily:a.fontFamily}},line:{style:{lineWidth:a.axisLineBorder,stroke:a.axisLineBorderColor}},grid:{line:{type:"line",style:{stroke:a.axisGridBorderColor,lineWidth:a.axisGridBorder,lineDash:a.axisGridLineDash}},alignTick:!0,animate:!0},tickLine:{style:{lineWidth:a.axisTickLineBorder,stroke:a.axisTickLineBorderColor},alignTick:!0,length:a.axisTickLineLength},subTickLine:null,animate:!0}}function createLegendStyles(a){return{title:null,marker:{symbol:"circle",spacing:a.legendMarkerSpacing,style:{r:a.legendCircleMarkerSize,fill:a.legendMarkerColor}},itemName:{spacing:5,style:{fill:a.legendItemNameFillColor,fontFamily:a.fontFamily,fontSize:a.legendItemNameFontSize,lineHeight:a.legendItemNameLineHeight,fontWeight:a.legendItemNameFontWeight,textAlign:"start",textBaseline:"middle"}},itemStates:{active:{nameStyle:{opacity:.8}},unchecked:{nameStyle:{fill:"#D8D8D8"},markerStyle:{fill:"#D8D8D8",stroke:"#D8D8D8"}},inactive:{nameStyle:{fill:"#D8D8D8"},markerStyle:{opacity:.2}}},flipPage:!0,pageNavigator:{marker:{style:{size:a.legendPageNavigatorMarkerSize,inactiveFill:a.legendPageNavigatorMarkerInactiveFillColor,inactiveOpacity:a.legendPageNavigatorMarkerInactiveFillOpacity,fill:a.legendPageNavigatorMarkerFillColor,opacity:a.legendPageNavigatorMarkerFillOpacity}},text:{style:{fill:a.legendPageNavigatorTextFillColor,fontSize:a.legendPageNavigatorTextFontSize}}},animate:!1,maxItemWidth:200,itemSpacing:a.legendItemSpacing,itemMarginBottom:a.legendItemMarginBottom,padding:a.legendPadding}}function createThemeByStyleSheet(a){var r,e={point:{default:{fill:a.pointFillColor,r:a.pointSize,stroke:a.pointBorderColor,lineWidth:a.pointBorder,fillOpacity:a.pointFillOpacity},active:{stroke:a.pointActiveBorderColor,lineWidth:a.pointActiveBorder},selected:{stroke:a.pointSelectedBorderColor,lineWidth:a.pointSelectedBorder},inactive:{fillOpacity:a.pointInactiveFillOpacity,strokeOpacity:a.pointInactiveBorderOpacity}},hollowPoint:{default:{fill:a.hollowPointFillColor,lineWidth:a.hollowPointBorder,stroke:a.hollowPointBorderColor,strokeOpacity:a.hollowPointBorderOpacity,r:a.hollowPointSize},active:{stroke:a.hollowPointActiveBorderColor,strokeOpacity:a.hollowPointActiveBorderOpacity},selected:{lineWidth:a.hollowPointSelectedBorder,stroke:a.hollowPointSelectedBorderColor,strokeOpacity:a.hollowPointSelectedBorderOpacity},inactive:{strokeOpacity:a.hollowPointInactiveBorderOpacity}},area:{default:{fill:a.areaFillColor,fillOpacity:a.areaFillOpacity,stroke:null},active:{fillOpacity:a.areaActiveFillOpacity},selected:{fillOpacity:a.areaSelectedFillOpacity},inactive:{fillOpacity:a.areaInactiveFillOpacity}},hollowArea:{default:{fill:null,stroke:a.hollowAreaBorderColor,lineWidth:a.hollowAreaBorder,strokeOpacity:a.hollowAreaBorderOpacity},active:{fill:null,lineWidth:a.hollowAreaActiveBorder},selected:{fill:null,lineWidth:a.hollowAreaSelectedBorder},inactive:{strokeOpacity:a.hollowAreaInactiveBorderOpacity}},interval:{default:{fill:a.intervalFillColor,fillOpacity:a.intervalFillOpacity},active:{stroke:a.intervalActiveBorderColor,lineWidth:a.intervalActiveBorder},selected:{stroke:a.intervalSelectedBorderColor,lineWidth:a.intervalSelectedBorder},inactive:{fillOpacity:a.intervalInactiveFillOpacity,strokeOpacity:a.intervalInactiveBorderOpacity}},hollowInterval:{default:{fill:a.hollowIntervalFillColor,stroke:a.hollowIntervalBorderColor,lineWidth:a.hollowIntervalBorder,strokeOpacity:a.hollowIntervalBorderOpacity},active:{stroke:a.hollowIntervalActiveBorderColor,lineWidth:a.hollowIntervalActiveBorder,strokeOpacity:a.hollowIntervalActiveBorderOpacity},selected:{stroke:a.hollowIntervalSelectedBorderColor,lineWidth:a.hollowIntervalSelectedBorder,strokeOpacity:a.hollowIntervalSelectedBorderOpacity},inactive:{stroke:a.hollowIntervalInactiveBorderColor,lineWidth:a.hollowIntervalInactiveBorder,strokeOpacity:a.hollowIntervalInactiveBorderOpacity}},line:{default:{stroke:a.lineBorderColor,lineWidth:a.lineBorder,strokeOpacity:a.lineBorderOpacity,fill:null,lineAppendWidth:10,lineCap:"round",lineJoin:"round"},active:{lineWidth:a.lineActiveBorder},selected:{lineWidth:a.lineSelectedBorder},inactive:{strokeOpacity:a.lineInactiveBorderOpacity}}},n=createAxisStyles(a),o=createLegendStyles(a);return{background:a.backgroundColor,defaultColor:a.brandColor,subColor:a.subColor,semanticRed:a.paletteSemanticRed,semanticGreen:a.paletteSemanticGreen,padding:"auto",fontFamily:a.fontFamily,columnWidthRatio:1/2,maxColumnWidth:null,minColumnWidth:null,roseWidthRatio:.9999999,multiplePieWidthRatio:1/1.3,colors10:a.paletteQualitative10,colors20:a.paletteQualitative20,sequenceColors:a.paletteSequence,shapes:{point:["hollow-circle","hollow-square","hollow-bowtie","hollow-diamond","hollow-hexagon","hollow-triangle","hollow-triangle-down","circle","square","bowtie","diamond","hexagon","triangle","triangle-down","cross","tick","plus","hyphen","line"],line:["line","dash","dot","smooth"],area:["area","smooth","line","smooth-line"],interval:["rect","hollow-rect","line","tick"]},sizes:[1,10],geometries:{interval:{rect:{default:{style:e.interval.default},active:{style:e.interval.active},inactive:{style:e.interval.inactive},selected:{style:function(s){var l=s.geometry.coordinate;if(l.isPolar&&l.isTransposed){var c=getAngle$1(s.getModel(),l),u=c.startAngle,f=c.endAngle,d=(u+f)/2,g=7.5,p=g*Math.cos(d),v=g*Math.sin(d);return{matrix:transform$6(null,[["t",p,v]])}}return e.interval.selected}}},"hollow-rect":{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}},line:{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}},tick:{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}},funnel:{default:{style:e.interval.default},active:{style:e.interval.active},inactive:{style:e.interval.inactive},selected:{style:e.interval.selected}},pyramid:{default:{style:e.interval.default},active:{style:e.interval.active},inactive:{style:e.interval.inactive},selected:{style:e.interval.selected}}},line:{line:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},dot:{default:{style:__assign$8(__assign$8({},e.line.default),{lineCap:null,lineDash:[1,1]})},active:{style:__assign$8(__assign$8({},e.line.active),{lineCap:null,lineDash:[1,1]})},inactive:{style:__assign$8(__assign$8({},e.line.inactive),{lineCap:null,lineDash:[1,1]})},selected:{style:__assign$8(__assign$8({},e.line.selected),{lineCap:null,lineDash:[1,1]})}},dash:{default:{style:__assign$8(__assign$8({},e.line.default),{lineCap:null,lineDash:[5.5,1]})},active:{style:__assign$8(__assign$8({},e.line.active),{lineCap:null,lineDash:[5.5,1]})},inactive:{style:__assign$8(__assign$8({},e.line.inactive),{lineCap:null,lineDash:[5.5,1]})},selected:{style:__assign$8(__assign$8({},e.line.selected),{lineCap:null,lineDash:[5.5,1]})}},smooth:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},hv:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},vh:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},hvh:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},vhv:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}}},polygon:{polygon:{default:{style:e.interval.default},active:{style:e.interval.active},inactive:{style:e.interval.inactive},selected:{style:e.interval.selected}}},point:{circle:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},square:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},bowtie:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},diamond:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},hexagon:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},triangle:{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},"triangle-down":{default:{style:e.point.default},active:{style:e.point.active},inactive:{style:e.point.inactive},selected:{style:e.point.selected}},"hollow-circle":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-square":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-bowtie":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-diamond":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-hexagon":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-triangle":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},"hollow-triangle-down":{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},cross:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},tick:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},plus:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},hyphen:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}},line:{default:{style:e.hollowPoint.default},active:{style:e.hollowPoint.active},inactive:{style:e.hollowPoint.inactive},selected:{style:e.hollowPoint.selected}}},area:{area:{default:{style:e.area.default},active:{style:e.area.active},inactive:{style:e.area.inactive},selected:{style:e.area.selected}},smooth:{default:{style:e.area.default},active:{style:e.area.active},inactive:{style:e.area.inactive},selected:{style:e.area.selected}},line:{default:{style:e.hollowArea.default},active:{style:e.hollowArea.active},inactive:{style:e.hollowArea.inactive},selected:{style:e.hollowArea.selected}},"smooth-line":{default:{style:e.hollowArea.default},active:{style:e.hollowArea.active},inactive:{style:e.hollowArea.inactive},selected:{style:e.hollowArea.selected}}},schema:{candle:{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}},box:{default:{style:e.hollowInterval.default},active:{style:e.hollowInterval.active},inactive:{style:e.hollowInterval.inactive},selected:{style:e.hollowInterval.selected}}},edge:{line:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},vhv:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},smooth:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},arc:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}}},violin:{violin:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},smooth:{default:{style:e.line.default},active:{style:e.line.active},inactive:{style:e.line.inactive},selected:{style:e.line.selected}},hollow:{default:{style:e.hollowArea.default},active:{style:e.hollowArea.active},inactive:{style:e.hollowArea.inactive},selected:{style:e.hollowArea.selected}},"hollow-smooth":{default:{style:e.hollowArea.default},active:{style:e.hollowArea.active},inactive:{style:e.hollowArea.inactive},selected:{style:e.hollowArea.selected}}}},components:{axis:{common:n,top:{position:"top",grid:null,title:null,verticalLimitLength:1/2},bottom:{position:"bottom",grid:null,title:null,verticalLimitLength:1/2},left:{position:"left",title:null,line:null,tickLine:null,verticalLimitLength:1/3},right:{position:"right",title:null,line:null,tickLine:null,verticalLimitLength:1/3},circle:{title:null,grid:deepMix({},n.grid,{line:{type:"line"}})},radius:{title:null,grid:deepMix({},n.grid,{line:{type:"circle"}})}},legend:{common:o,right:{layout:"vertical",padding:a.legendVerticalPadding},left:{layout:"vertical",padding:a.legendVerticalPadding},top:{layout:"horizontal",padding:a.legendHorizontalPadding},bottom:{layout:"horizontal",padding:a.legendHorizontalPadding},continuous:{title:null,background:null,track:{},rail:{type:"color",size:a.sliderRailHeight,defaultLength:a.sliderRailWidth,style:{fill:a.sliderRailFillColor,stroke:a.sliderRailBorderColor,lineWidth:a.sliderRailBorder}},label:{align:"rail",spacing:4,formatter:null,style:{fill:a.sliderLabelTextFillColor,fontSize:a.sliderLabelTextFontSize,lineHeight:a.sliderLabelTextLineHeight,textBaseline:"middle",fontFamily:a.fontFamily}},handler:{size:a.sliderHandlerWidth,style:{fill:a.sliderHandlerFillColor,stroke:a.sliderHandlerBorderColor}},slidable:!0,padding:o.padding}},tooltip:{showContent:!0,follow:!0,showCrosshairs:!1,showMarkers:!0,shared:!1,enterable:!1,position:"auto",marker:{symbol:"circle",stroke:"#fff",shadowBlur:10,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(0,0,0,0.09)",lineWidth:2,r:4},crosshairs:{line:{style:{stroke:a.tooltipCrosshairsBorderColor,lineWidth:a.tooltipCrosshairsBorder}},text:null,textBackground:{padding:2,style:{fill:"rgba(0, 0, 0, 0.25)",lineWidth:0,stroke:null}},follow:!1},domStyles:(r={},r["".concat(CONTAINER_CLASS)]={position:"absolute",visibility:"hidden",zIndex:8,transition:"left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s",backgroundColor:a.tooltipContainerFillColor,opacity:a.tooltipContainerFillOpacity,boxShadow:a.tooltipContainerShadow,borderRadius:"".concat(a.tooltipContainerBorderRadius,"px"),color:a.tooltipTextFillColor,fontSize:"".concat(a.tooltipTextFontSize,"px"),fontFamily:a.fontFamily,lineHeight:"".concat(a.tooltipTextLineHeight,"px"),padding:"0 12px 0 12px"},r["".concat(TITLE_CLASS)]={marginBottom:"12px",marginTop:"12px"},r["".concat(LIST_CLASS)]={margin:0,listStyleType:"none",padding:0},r["".concat(LIST_ITEM_CLASS)]={listStyleType:"none",padding:0,marginBottom:"12px",marginTop:"12px",marginLeft:0,marginRight:0},r["".concat(MARKER_CLASS)]={width:"8px",height:"8px",borderRadius:"50%",display:"inline-block",marginRight:"8px"},r["".concat(VALUE_CLASS)]={display:"inline-block",float:"right",marginLeft:"30px"},r)},annotation:{arc:{style:{stroke:a.annotationArcBorderColor,lineWidth:a.annotationArcBorder},animate:!0},line:{style:{stroke:a.annotationLineBorderColor,lineDash:a.annotationLineDash,lineWidth:a.annotationLineBorder},text:{position:"start",autoRotate:!0,style:{fill:a.annotationTextFillColor,stroke:a.annotationTextBorderColor,lineWidth:a.annotationTextBorder,fontSize:a.annotationTextFontSize,textAlign:"start",fontFamily:a.fontFamily,textBaseline:"bottom"}},animate:!0},text:{style:{fill:a.annotationTextFillColor,stroke:a.annotationTextBorderColor,lineWidth:a.annotationTextBorder,fontSize:a.annotationTextFontSize,textBaseline:"middle",textAlign:"start",fontFamily:a.fontFamily},animate:!0},region:{top:!1,style:{lineWidth:a.annotationRegionBorder,stroke:a.annotationRegionBorderColor,fill:a.annotationRegionFillColor,fillOpacity:a.annotationRegionFillOpacity},animate:!0},image:{top:!1,animate:!0},dataMarker:{top:!0,point:{style:{r:3,stroke:a.brandColor,lineWidth:2}},line:{style:{stroke:a.annotationLineBorderColor,lineWidth:a.annotationLineBorder},length:a.annotationDataMarkerLineLength},text:{style:{textAlign:"start",fill:a.annotationTextFillColor,stroke:a.annotationTextBorderColor,lineWidth:a.annotationTextBorder,fontSize:a.annotationTextFontSize,fontFamily:a.fontFamily}},direction:"upward",autoAdjust:!0,animate:!0},dataRegion:{style:{region:{fill:a.annotationRegionFillColor,fillOpacity:a.annotationRegionFillOpacity},text:{textAlign:"center",textBaseline:"bottom",fill:a.annotationTextFillColor,stroke:a.annotationTextBorderColor,lineWidth:a.annotationTextBorder,fontSize:a.annotationTextFontSize,fontFamily:a.fontFamily}},animate:!0}},slider:{common:{padding:[8,8,8,8],backgroundStyle:{fill:a.cSliderBackgroundFillColor,opacity:a.cSliderBackgroundFillOpacity},foregroundStyle:{fill:a.cSliderForegroundFillColor,opacity:a.cSliderForegroundFillOpacity},handlerStyle:{width:a.cSliderHandlerWidth,height:a.cSliderHandlerHeight,fill:a.cSliderHandlerFillColor,opacity:a.cSliderHandlerFillOpacity,stroke:a.cSliderHandlerBorderColor,lineWidth:a.cSliderHandlerBorder,radius:a.cSliderHandlerBorderRadius,highLightFill:a.cSliderHandlerHighlightFillColor},textStyle:{fill:a.cSliderTextFillColor,opacity:a.cSliderTextFillOpacity,fontSize:a.cSliderTextFontSize,lineHeight:a.cSliderTextLineHeight,fontWeight:a.cSliderTextFontWeight,stroke:a.cSliderTextBorderColor,lineWidth:a.cSliderTextBorder}}},scrollbar:{common:{padding:[8,8,8,8]},default:{style:{trackColor:a.scrollbarTrackFillColor,thumbColor:a.scrollbarThumbFillColor}},hover:{style:{thumbColor:a.scrollbarThumbHighlightFillColor}}}},labels:{offset:12,style:{fill:a.labelFillColor,fontSize:a.labelFontSize,fontFamily:a.fontFamily,stroke:a.labelBorderColor,lineWidth:a.labelBorder},fillColorDark:a.labelFillColorDark,fillColorLight:a.labelFillColorLight,autoRotate:!0},innerLabels:{style:{fill:a.innerLabelFillColor,fontSize:a.innerLabelFontSize,fontFamily:a.fontFamily,stroke:a.innerLabelBorderColor,lineWidth:a.innerLabelBorder},autoRotate:!0},overflowLabels:{style:{fill:a.overflowLabelFillColor,fontSize:a.overflowLabelFontSize,fontFamily:a.fontFamily,stroke:a.overflowLabelBorderColor,lineWidth:a.overflowLabelBorder}},pieLabels:{labelHeight:14,offset:10,labelLine:{style:{lineWidth:a.labelLineBorder}},autoRotate:!0}}}var BLACK_COLORS$1={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},WHITE_COLORS$1={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},QUALITATIVE_10$1=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#6F5EF9","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],QUALITATIVE_20$1=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#6F5EF9","#D3CEFD","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],SINGLE_SEQUENCE$1=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],createLightStyleSheet=function(a){a===void 0&&(a={});var r=a.paletteQualitative10,e=r===void 0?QUALITATIVE_10$1:r,n=a.paletteQualitative20,o=n===void 0?QUALITATIVE_20$1:n,s=a.brandColor,l=s===void 0?e[0]:s,c={backgroundColor:"transparent",brandColor:l,subColor:"rgba(0,0,0,0.05)",paletteQualitative10:e,paletteQualitative20:o,paletteSemanticRed:"#F4664A",paletteSemanticGreen:"#30BF78",paletteSemanticYellow:"#FAAD14",paletteSequence:SINGLE_SEQUENCE$1,fontFamily:`"Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`,axisLineBorderColor:BLACK_COLORS$1[25],axisLineBorder:1,axisLineDash:null,axisTitleTextFillColor:BLACK_COLORS$1[65],axisTitleTextFontSize:12,axisTitleTextLineHeight:12,axisTitleTextFontWeight:"normal",axisTitleSpacing:12,axisDescriptionIconFillColor:WHITE_COLORS$1[85],axisTickLineBorderColor:BLACK_COLORS$1[25],axisTickLineLength:4,axisTickLineBorder:1,axisSubTickLineBorderColor:BLACK_COLORS$1[15],axisSubTickLineLength:2,axisSubTickLineBorder:1,axisLabelFillColor:BLACK_COLORS$1[45],axisLabelFontSize:12,axisLabelLineHeight:12,axisLabelFontWeight:"normal",axisLabelOffset:8,axisGridBorderColor:BLACK_COLORS$1[15],axisGridBorder:1,axisGridLineDash:null,legendTitleTextFillColor:BLACK_COLORS$1[45],legendTitleTextFontSize:12,legendTitleTextLineHeight:21,legendTitleTextFontWeight:"normal",legendMarkerColor:l,legendMarkerSpacing:8,legendMarkerSize:4,legendCircleMarkerSize:4,legendSquareMarkerSize:4,legendLineMarkerSize:5,legendItemNameFillColor:BLACK_COLORS$1[65],legendItemNameFontSize:12,legendItemNameLineHeight:12,legendItemNameFontWeight:"normal",legendItemSpacing:24,legendItemMarginBottom:12,legendPadding:[8,8,8,8],legendHorizontalPadding:[8,0,8,0],legendVerticalPadding:[0,8,0,8],legendPageNavigatorMarkerSize:12,legendPageNavigatorMarkerInactiveFillColor:BLACK_COLORS$1[100],legendPageNavigatorMarkerInactiveFillOpacity:.45,legendPageNavigatorMarkerFillColor:BLACK_COLORS$1[100],legendPageNavigatorMarkerFillOpacity:1,legendPageNavigatorTextFillColor:BLACK_COLORS$1[45],legendPageNavigatorTextFontSize:12,sliderRailFillColor:BLACK_COLORS$1[15],sliderRailBorder:0,sliderRailBorderColor:null,sliderRailWidth:100,sliderRailHeight:12,sliderLabelTextFillColor:BLACK_COLORS$1[45],sliderLabelTextFontSize:12,sliderLabelTextLineHeight:12,sliderLabelTextFontWeight:"normal",sliderHandlerFillColor:BLACK_COLORS$1[6],sliderHandlerWidth:10,sliderHandlerHeight:14,sliderHandlerBorder:1,sliderHandlerBorderColor:BLACK_COLORS$1[25],annotationArcBorderColor:BLACK_COLORS$1[15],annotationArcBorder:1,annotationLineBorderColor:BLACK_COLORS$1[25],annotationLineBorder:1,annotationLineDash:null,annotationTextFillColor:BLACK_COLORS$1[65],annotationTextFontSize:12,annotationTextLineHeight:12,annotationTextFontWeight:"normal",annotationTextBorderColor:null,annotationTextBorder:0,annotationRegionFillColor:BLACK_COLORS$1[100],annotationRegionFillOpacity:.06,annotationRegionBorder:0,annotationRegionBorderColor:null,annotationDataMarkerLineLength:16,tooltipCrosshairsBorderColor:BLACK_COLORS$1[25],tooltipCrosshairsBorder:1,tooltipCrosshairsLineDash:null,tooltipContainerFillColor:"rgb(255, 255, 255)",tooltipContainerFillOpacity:.95,tooltipContainerShadow:"0px 0px 10px #aeaeae",tooltipContainerBorderRadius:3,tooltipTextFillColor:BLACK_COLORS$1[65],tooltipTextFontSize:12,tooltipTextLineHeight:12,tooltipTextFontWeight:"bold",labelFillColor:BLACK_COLORS$1[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,labelLineHeight:12,labelFontWeight:"normal",labelBorderColor:null,labelBorder:0,innerLabelFillColor:WHITE_COLORS$1[100],innerLabelFontSize:12,innerLabelLineHeight:12,innerLabelFontWeight:"normal",innerLabelBorderColor:null,innerLabelBorder:0,overflowLabelFillColor:BLACK_COLORS$1[65],overflowLabelFontSize:12,overflowLabelLineHeight:12,overflowLabelFontWeight:"normal",overflowLabelBorderColor:WHITE_COLORS$1[100],overflowLabelBorder:1,labelLineBorder:1,labelLineBorderColor:BLACK_COLORS$1[25],cSliderRailHieght:16,cSliderBackgroundFillColor:"#416180",cSliderBackgroundFillOpacity:.05,cSliderForegroundFillColor:"#5B8FF9",cSliderForegroundFillOpacity:.15,cSliderHandlerHeight:24,cSliderHandlerWidth:10,cSliderHandlerFillColor:"#F7F7F7",cSliderHandlerFillOpacity:1,cSliderHandlerHighlightFillColor:"#FFF",cSliderHandlerBorderColor:"#BFBFBF",cSliderHandlerBorder:1,cSliderHandlerBorderRadius:2,cSliderTextFillColor:"#000",cSliderTextFillOpacity:.45,cSliderTextFontSize:12,cSliderTextLineHeight:12,cSliderTextFontWeight:"normal",cSliderTextBorderColor:null,cSliderTextBorder:0,scrollbarTrackFillColor:"rgba(0,0,0,0)",scrollbarThumbFillColor:"rgba(0,0,0,0.15)",scrollbarThumbHighlightFillColor:"rgba(0,0,0,0.2)",pointFillColor:l,pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:WHITE_COLORS$1[100],pointBorderOpacity:1,pointActiveBorderColor:BLACK_COLORS$1[100],pointSelectedBorder:2,pointSelectedBorderColor:BLACK_COLORS$1[100],pointInactiveFillOpacity:.3,pointInactiveBorderOpacity:.3,hollowPointSize:4,hollowPointBorder:1,hollowPointBorderColor:l,hollowPointBorderOpacity:.95,hollowPointFillColor:WHITE_COLORS$1[100],hollowPointActiveBorder:1,hollowPointActiveBorderColor:BLACK_COLORS$1[100],hollowPointActiveBorderOpacity:1,hollowPointSelectedBorder:2,hollowPointSelectedBorderColor:BLACK_COLORS$1[100],hollowPointSelectedBorderOpacity:1,hollowPointInactiveBorderOpacity:.3,lineBorder:2,lineBorderColor:l,lineBorderOpacity:1,lineActiveBorder:3,lineSelectedBorder:3,lineInactiveBorderOpacity:.3,areaFillColor:l,areaFillOpacity:.25,areaActiveFillColor:l,areaActiveFillOpacity:.5,areaSelectedFillColor:l,areaSelectedFillOpacity:.5,areaInactiveFillOpacity:.3,hollowAreaBorderColor:l,hollowAreaBorder:2,hollowAreaBorderOpacity:1,hollowAreaActiveBorder:3,hollowAreaActiveBorderColor:BLACK_COLORS$1[100],hollowAreaSelectedBorder:3,hollowAreaSelectedBorderColor:BLACK_COLORS$1[100],hollowAreaInactiveBorderOpacity:.3,intervalFillColor:l,intervalFillOpacity:.95,intervalActiveBorder:1,intervalActiveBorderColor:BLACK_COLORS$1[100],intervalActiveBorderOpacity:1,intervalSelectedBorder:2,intervalSelectedBorderColor:BLACK_COLORS$1[100],intervalSelectedBorderOpacity:1,intervalInactiveBorderOpacity:.3,intervalInactiveFillOpacity:.3,hollowIntervalBorder:2,hollowIntervalBorderColor:l,hollowIntervalBorderOpacity:1,hollowIntervalFillColor:WHITE_COLORS$1[100],hollowIntervalActiveBorder:2,hollowIntervalActiveBorderColor:BLACK_COLORS$1[100],hollowIntervalSelectedBorder:3,hollowIntervalSelectedBorderColor:BLACK_COLORS$1[100],hollowIntervalSelectedBorderOpacity:1,hollowIntervalInactiveBorderOpacity:.3};return __assign$8(__assign$8({},c),a)};createLightStyleSheet();function createTheme(a){var r=a.styleSheet,e=r===void 0?{}:r,n=__rest$1(a,["styleSheet"]),o=createLightStyleSheet(e);return deepMix({},createThemeByStyleSheet(o),n)}var defaultTheme=createTheme({}),Themes={default:defaultTheme};function getTheme(a){return get(Themes,lowerCase(a),Themes.default)}function registerTheme(a,r){Themes[lowerCase(a)]=createTheme(r)}function snapEqual(a,r,e){var n=e.translate(a),o=e.translate(r);return isNumberEqual$1(n,o)}function getXValueByPoint(a,r){var e=r.coordinate,n=r.getXScale(),o=n.range,s=o[o.length-1],l=o[0],c=e.invert(a),u=c.x;return e.isPolar&&u>(1+s)/2&&(u=l),n.translate(n.invert(u))}function filterYValue(a,r,e){var n=e.coordinate,o=e.getYScale(),s=o.field,l=n.invert(r),c=o.invert(l.y),u=find$2(a,function(f){var d=f[FIELD_ORIGIN];return d[s][0]<=c&&d[s][1]>=c});return u||a[a.length-1]}var getXDistance=memoize(function(a){if(a.isCategory)return 1;for(var r=a.values,e=r.length,n=a.translate(r[0]),o=n,s=0;s<e;s++){var l=r[s],c=a.translate(l);c<n&&(n=c),c>o&&(o=c)}return(o-n)/(e-1)});function getTooltipTitle(a,r,e){var n=r.getAttribute("position"),o=n.getFields(),s=r.scales,l=isFunction$1(e)||!e?o[0]:e,c=s[l],u=c?c.getText(a[l]):a[l]||l;return isFunction$1(e)?e(u,a):u}function getAttributesForLegend(a){var r=values(a.attributes);return filter(r,function(e){return contains(GROUP_ATTRS,e.type)})}function getTooltipValueScale(a){var r,e,n=getAttributesForLegend(a),o;try{for(var s=__values(n),l=s.next();!l.done;l=s.next()){var c=l.value,u=c.getScale(c.type);if(u&&u.isLinear){var f=get(a.scaleDefs,u.field),d=inferScaleType(u,f,c.type,a.type);if(d!=="cat"){o=u;break}}}}catch(v){r={error:v}}finally{try{l&&!l.done&&(e=s.return)&&e.call(s)}finally{if(r)throw r.error}}var g=a.getXScale(),p=a.getYScale();return o||p||g}function getTooltipValue(a,r){var e=r.field,n=a[e];if(isArray$4(n)){var o=n.map(function(s){return r.getText(s)});return o.join("-")}return r.getText(n)}function getTooltipName(a,r){var e,n=r.getGroupScales();if(n.length&&(e=n[0]),e){var o=e.field;return e.getText(a[o])}var s=getTooltipValueScale(r);return getName(s)}function findDataByPoint(a,r,e){if(r.length===0)return null;var n=e.type,o=e.getXScale(),s=e.getYScale(),l=o.field,c=s.field,u=null;if(n==="heatmap"||n==="point"){for(var f=e.coordinate,d=f.invert(a),g=o.invert(d.x),p=s.invert(d.y),v=1/0,m=0;m<r.length;m++){var y=r[m],x=y[FIELD_ORIGIN],_=Math.pow(x[l]-g,2)+Math.pow(x[c]-p,2);_<v&&(v=_,u=y)}return u}var E=r[0],S=r[r.length-1],A=getXValueByPoint(a,e),T=E[FIELD_ORIGIN][l],b=E[FIELD_ORIGIN][c],C=S[FIELD_ORIGIN][l],L=s.isLinear&&isArray$4(b);if(isArray$4(T)){for(var m=0;m<r.length;m++){var R=r[m],x=R[FIELD_ORIGIN];if(o.translate(x[l][0])<=A&&o.translate(x[l][1])>=A)if(L)isArray$4(u)||(u=[]),u.push(R);else{u=R;break}}isArray$4(u)&&(u=filterYValue(u,a,e))}else{var I=void 0;if(!o.isLinear&&o.type!=="timeCat"){for(var m=0;m<r.length;m++){var R=r[m],x=R[FIELD_ORIGIN];if(snapEqual(x[l],A,o))if(L)isArray$4(u)||(u=[]),u.push(R);else{u=R;break}else o.translate(x[l])<=A&&(S=R,I=r[m+1])}isArray$4(u)&&(u=filterYValue(u,a,e))}else{if((A>o.translate(C)||A<o.translate(T))&&(A>o.max||A<o.min))return null;for(var w=0,M=r.length-1,D=void 0;w<=M;){D=Math.floor((w+M)/2);var O=r[D][FIELD_ORIGIN][l];if(snapEqual(O,A,o))return r[D];o.translate(O)<=o.translate(A)?(w=D+1,S=r[D],I=r[D+1]):(M===0&&(S=r[0]),M=D-1)}}S&&I&&Math.abs(o.translate(S[FIELD_ORIGIN][l])-A)>Math.abs(o.translate(I[FIELD_ORIGIN][l])-A)&&(S=I)}var F=getXDistance(e.getXScale());return!u&&Math.abs(o.translate(S[FIELD_ORIGIN][l])-A)<=F/2&&(u=S),u}function getTooltipItems(a,r,e,n){var o,s;e===void 0&&(e=""),n===void 0&&(n=!1);var l=a[FIELD_ORIGIN],c=getTooltipTitle(l,r,e),u=r.tooltipOption,f=r.theme.defaultColor,d=[],g,p;function v(R,I){if(n||!isNil(I)&&I!==""){var w={title:c,data:l,mappingData:a,name:R,value:I,color:a.color||f,marker:!0};d.push(w)}}if(isObject$1(u)){var m=u.fields,y=u.callback;if(y){var x=m.map(function(R){return a[FIELD_ORIGIN][R]}),_=y.apply(void 0,__spreadArray$2([],__read(x),!1)),E=__assign$8({data:a[FIELD_ORIGIN],mappingData:a,title:c,color:a.color||f,marker:!0},_);d.push(E)}else{var S=r.scales;try{for(var A=__values(m),T=A.next();!T.done;T=A.next()){var b=T.value;if(!isNil(l[b])){var C=S[b];g=getName(C),p=C.getText(l[b]),v(g,p)}}}catch(R){o={error:R}}finally{try{T&&!T.done&&(s=A.return)&&s.call(A)}finally{if(o)throw o.error}}}}else{var L=getTooltipValueScale(r);p=getTooltipValue(l,L),g=getTooltipName(l,r),v(g,p)}return d}function getTooltipItemsByFindData(a,r,e,n){var o,s,l=n.showNil,c=[],u=a.dataArray;if(!isEmpty(u)){a.sort(u);try{for(var f=__values(u),d=f.next();!d.done;d=f.next()){var g=d.value,p=findDataByPoint(r,g,a);if(p){var v=a.getElementId(p),m=a.elementsMap[v];if(a.type==="heatmap"||m.visible){var y=getTooltipItems(p,a,e,l);y.length&&c.push(y)}}}}catch(x){o={error:x}}finally{try{d&&!d.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}return c}function getTooltipItemsByHitShape(a,r,e,n){var o=n.showNil,s=[],l=a.container,c=l.getShape(r.x,r.y);if(c&&c.get("visible")&&c.get("origin")){var u=c.get("origin").mappingData,f=getTooltipItems(u,a,e,o);f.length&&s.push(f)}return s}function findItemsFromView(a,r,e){var n,o,s=[],l=a.geometries,c=e.shared,u=e.title,f=e.reversed;try{for(var d=__values(l),g=d.next();!g.done;g=d.next()){var p=g.value;if(p.visible&&p.tooltipOption!==!1){var v=p.type,m=void 0;["point","edge","polygon"].includes(v)?m=getTooltipItemsByHitShape(p,r,u,e):["area","line","path","heatmap"].includes(v)||c!==!1?m=getTooltipItemsByFindData(p,r,u,e):m=getTooltipItemsByHitShape(p,r,u,e),m.length&&(f&&m.reverse(),s.push(m))}}}catch(y){n={error:y}}finally{try{g&&!g.done&&(o=d.return)&&o.call(d)}finally{if(n)throw n.error}}return s}function findItemsFromViewRecurisive(a,r,e){var n,o,s=findItemsFromView(a,r,e);try{for(var l=__values(a.views),c=l.next();!c.done;c=l.next()){var u=c.value;s=s.concat(findItemsFromView(u,r,e))}}catch(f){n={error:f}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(n)throw n.error}}return s}function isAutoPadding(a){return!isNumber$2(a)&&!isArray$4(a)}function parsePadding(a){a===void 0&&(a=0);var r=isArray$4(a)?a:[a];switch(r.length){case 0:r=[0,0,0,0];break;case 1:r=new Array(4).fill(r[0]);break;case 2:r=__spreadArray$2(__spreadArray$2([],__read(r),!1),__read(r),!1);break;case 3:r=__spreadArray$2(__spreadArray$2([],__read(r),!1),[r[1]],!1);break;default:r=r.slice(0,4);break}return r}var LOAD_COMPONENT_CONTROLLERS={};function registerComponentController(a,r){LOAD_COMPONENT_CONTROLLERS[a]=r}function getComponentControllerNames(){return Object.keys(LOAD_COMPONENT_CONTROLLERS)}function getComponentController(a){return LOAD_COMPONENT_CONTROLLERS[a]}var CoordinateController=function(){function a(r){this.option=this.wrapperOption(r)}return a.prototype.update=function(r){return this.option=this.wrapperOption(r),this},a.prototype.hasAction=function(r){var e=this.option.actions;return some(e,function(n){return n[0]===r})},a.prototype.create=function(r,e){var n=this.option,o=n.type,s=n.cfg,l=o==="theta",c=__assign$8({start:r,end:e},s),u=getCoordinate(l?"polar":o);return this.coordinate=new u(c),this.coordinate.type=o,l&&(this.hasAction("transpose")||this.transpose()),this.execActions(),this.coordinate},a.prototype.adjust=function(r,e){return this.coordinate.update({start:r,end:e}),this.coordinate.resetMatrix(),this.execActions(["scale","rotate","translate"]),this.coordinate},a.prototype.rotate=function(r){return this.option.actions.push(["rotate",r]),this},a.prototype.reflect=function(r){return this.option.actions.push(["reflect",r]),this},a.prototype.scale=function(r,e){return this.option.actions.push(["scale",r,e]),this},a.prototype.transpose=function(){return this.option.actions.push(["transpose"]),this},a.prototype.getOption=function(){return this.option},a.prototype.getCoordinate=function(){return this.coordinate},a.prototype.wrapperOption=function(r){return __assign$8({type:"rect",actions:[],cfg:{}},r)},a.prototype.execActions=function(r){var e=this,n=this.option.actions;each$1(n,function(o){var s,l=__read(o),c=l[0],u=l.slice(1),f=isNil(r)?!0:r.includes(c);f&&(s=e.coordinate)[c].apply(s,__spreadArray$2([],__read(u),!1))})},a}(),Event$1=function(){function a(r,e,n){this.view=r,this.gEvent=e,this.data=n,this.type=e.type}return a.fromData=function(r,e,n){return new a(r,new GraphEvent(e,{}),n)},Object.defineProperty(a.prototype,"target",{get:function(){return this.gEvent.target},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"event",{get:function(){return this.gEvent.originalEvent},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"x",{get:function(){return this.gEvent.x},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"y",{get:function(){return this.gEvent.y},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"clientX",{get:function(){return this.gEvent.clientX},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"clientY",{get:function(){return this.gEvent.clientY},enumerable:!1,configurable:!0}),a.prototype.toString=function(){return"[Event (type=".concat(this.type,")]")},a.prototype.clone=function(){return new a(this.view,this.gEvent,this.data)},a}();function defaultLayout(a){var r=a.getController("axis"),e=a.getController("legend"),n=a.getController("annotation"),o=a.getController("slider"),s=a.getController("scrollbar");[r,o,s,e,n].forEach(function(l){l&&l.layout()})}var ScalePool=function(){function a(){this.scales=new Map,this.syncScales=new Map}return a.prototype.createScale=function(r,e,n,o){var s=n,l=this.getScaleMeta(o);if(e.length===0&&l){var c=l.scale,u={type:c.type};c.isCategory&&(u.values=c.values),s=deepMix(u,l.scaleDef,n)}var f=createScaleByField(r,e,s);return this.cacheScale(f,n,o),f},a.prototype.sync=function(r,e){var n=this;this.syncScales.forEach(function(o,s){var l=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,u=[];each$1(o,function(f){var d=n.getScale(f);c=isNumber$2(d.max)?Math.max(c,d.max):c,l=isNumber$2(d.min)?Math.min(l,d.min):l,each$1(d.values,function(g){u.includes(g)||u.push(g)})}),each$1(o,function(f){var d=n.getScale(f);if(d.isContinuous)d.change({min:l,max:c,values:u});else if(d.isCategory){var g=d.range,p=n.getScaleMeta(f);u&&!get(p,["scaleDef","range"])&&(g=getDefaultCategoryScaleRange(deepMix({},d,{values:u}),r,e)),d.change({values:u,range:g})}})})},a.prototype.cacheScale=function(r,e,n){var o=this.getScaleMeta(n);o&&o.scale.type===r.type?(syncScale(o.scale,r),o.scaleDef=e):(o={key:n,scale:r,scaleDef:e},this.scales.set(n,o));var s=this.getSyncKey(o);if(o.syncKey=s,this.removeFromSyncScales(n),s){var l=this.syncScales.get(s);l||(l=[],this.syncScales.set(s,l)),l.push(n)}},a.prototype.getScale=function(r){var e=this.getScaleMeta(r);if(!e){var n=last(r.split("-")),o=this.syncScales.get(n);o&&o.length&&(e=this.getScaleMeta(o[0]))}return e&&e.scale},a.prototype.deleteScale=function(r){var e=this.getScaleMeta(r);if(e){var n=e.syncKey,o=this.syncScales.get(n);if(o&&o.length){var s=o.indexOf(r);s!==-1&&o.splice(s,1)}}this.scales.delete(r)},a.prototype.clear=function(){this.scales.clear(),this.syncScales.clear()},a.prototype.removeFromSyncScales=function(r){var e=this;this.syncScales.forEach(function(n,o){var s=n.indexOf(r);if(s!==-1)return n.splice(s,1),n.length===0&&e.syncScales.delete(o),!1})},a.prototype.getSyncKey=function(r){var e=r.scale,n=r.scaleDef,o=e.field,s=get(n,["sync"]);return s===!0?o:s===!1?void 0:s},a.prototype.getScaleMeta=function(r){return this.scales.get(r)},a}(),PaddingCal=function(){function a(r,e,n,o){r===void 0&&(r=0),e===void 0&&(e=0),n===void 0&&(n=0),o===void 0&&(o=0),this.top=r,this.right=e,this.bottom=n,this.left=o}return a.instance=function(r,e,n,o){return r===void 0&&(r=0),e===void 0&&(e=0),n===void 0&&(n=0),o===void 0&&(o=0),new a(r,e,n,o)},a.prototype.max=function(r){var e=__read(r,4),n=e[0],o=e[1],s=e[2],l=e[3];return this.top=Math.max(this.top,n),this.right=Math.max(this.right,o),this.bottom=Math.max(this.bottom,s),this.left=Math.max(this.left,l),this},a.prototype.shrink=function(r){var e=__read(r,4),n=e[0],o=e[1],s=e[2],l=e[3];return this.top+=n,this.right+=o,this.bottom+=s,this.left+=l,this},a.prototype.inc=function(r,e){var n=r.width,o=r.height;switch(e){case DIRECTION.TOP:case DIRECTION.TOP_LEFT:case DIRECTION.TOP_RIGHT:this.top+=o;break;case DIRECTION.RIGHT:case DIRECTION.RIGHT_TOP:case DIRECTION.RIGHT_BOTTOM:this.right+=n;break;case DIRECTION.BOTTOM:case DIRECTION.BOTTOM_LEFT:case DIRECTION.BOTTOM_RIGHT:this.bottom+=o;break;case DIRECTION.LEFT:case DIRECTION.LEFT_TOP:case DIRECTION.LEFT_BOTTOM:this.left+=n;break}return this},a.prototype.getPadding=function(){return[this.top,this.right,this.bottom,this.left]},a.prototype.clone=function(){return new(a.bind.apply(a,__spreadArray$2([void 0],__read(this.getPadding()),!1)))},a}();function calculatePadding(a){var r=a.padding;if(!isAutoPadding(r))return new(PaddingCal.bind.apply(PaddingCal,__spreadArray$2([void 0],__read(parsePadding(r)),!1)));var e=a.viewBBox,n=new PaddingCal,o=[],s=[],l=[];return each$1(a.getComponents(),function(c){var u=c.type;u===COMPONENT_TYPE.AXIS?o.push(c):[COMPONENT_TYPE.LEGEND,COMPONENT_TYPE.SLIDER,COMPONENT_TYPE.SCROLLBAR].includes(u)?s.push(c):u!==COMPONENT_TYPE.GRID&&u!==COMPONENT_TYPE.TOOLTIP&&l.push(c)}),each$1(o,function(c){var u=c.component,f=u.getLayoutBBox(),d=new BBox(f.x,f.y,f.width,f.height),g=d.exceed(e);n.max(g)}),each$1(s,function(c){var u=c.component,f=c.direction,d=u.getLayoutBBox(),g=u.get("padding"),p=new BBox(d.x,d.y,d.width,d.height).expand(g);n.inc(p,f)}),each$1(l,function(c){var u=c.component,f=c.direction,d=u.getLayoutBBox(),g=new BBox(d.x,d.y,d.width,d.height);n.inc(g,f)}),n}function defaultSyncViewPadding(a,r,e){var n=e.instance();r.forEach(function(o){o.autoPadding=n.max(o.autoPadding.getPadding())})}var View=function(a){__extends$7(r,a);function r(e){var n=a.call(this,{visible:e.visible})||this;n.views=[],n.geometries=[],n.controllers=[],n.interactions={},n.limitInPlot=!1,n.options={data:[],animate:!0},n.usedControllers=getComponentControllerNames(),n.scalePool=new ScalePool,n.layoutFunc=defaultLayout,n.isPreMouseInPlot=!1,n.isDataChanged=!1,n.isCoordinateChanged=!1,n.createdScaleKeys=new Map,n.onCanvasEvent=function(S){var A=S.name;if(!A.includes(":")){var T=n.createViewEvent(S);n.doPlotEvent(T),n.emit(A,T)}},n.onDelegateEvents=function(S){var A=S.name;if(A.includes(":")){var T=n.createViewEvent(S);n.emit(A,T)}};var o=e.id,s=o===void 0?uniqueId("view"):o,l=e.parent,c=e.canvas,u=e.backgroundGroup,f=e.middleGroup,d=e.foregroundGroup,g=e.region,p=g===void 0?{start:{x:0,y:0},end:{x:1,y:1}}:g,v=e.padding,m=e.appendPadding,y=e.theme,x=e.options,_=e.limitInPlot,E=e.syncViewPadding;return n.parent=l,n.canvas=c,n.backgroundGroup=u,n.middleGroup=f,n.foregroundGroup=d,n.region=p,n.padding=v,n.appendPadding=m,n.options=__assign$8(__assign$8({},n.options),x),n.limitInPlot=_,n.id=s,n.syncViewPadding=E,n.themeObject=isObject$1(y)?deepMix({},getTheme("default"),createTheme(y)):getTheme(y),n.init(),n}return r.prototype.setLayout=function(e){this.layoutFunc=e},r.prototype.init=function(){this.calculateViewBBox(),this.initEvents(),this.initComponentController(),this.initOptions()},r.prototype.render=function(e,n){e===void 0&&(e=!1),this.emit(VIEW_LIFE_CIRCLE.BEFORE_RENDER,Event$1.fromData(this,VIEW_LIFE_CIRCLE.BEFORE_RENDER,n)),this.paint(e),this.emit(VIEW_LIFE_CIRCLE.AFTER_RENDER,Event$1.fromData(this,VIEW_LIFE_CIRCLE.AFTER_RENDER,n)),this.visible===!1&&this.changeVisible(!1)},r.prototype.clear=function(){var e=this;this.emit(VIEW_LIFE_CIRCLE.BEFORE_CLEAR),this.filteredData=[],this.coordinateInstance=void 0,this.isDataChanged=!1,this.isCoordinateChanged=!1;for(var n=this.geometries,o=0;o<n.length;o++)n[o].clear(),n[o].container.remove(!0),n[o].labelsContainer.remove(!0);this.geometries=[];for(var s=this.controllers,o=0;o<s.length;o++)s[o].name==="annotation"?s[o].clear(!0):s[o].clear();this.createdScaleKeys.forEach(function(c,u){e.getRootView().scalePool.deleteScale(u)}),this.createdScaleKeys.clear();for(var l=this.views,o=0;o<l.length;o++)l[o].clear();this.emit(VIEW_LIFE_CIRCLE.AFTER_CLEAR)},r.prototype.destroy=function(){this.emit(VIEW_LIFE_CIRCLE.BEFORE_DESTROY);var e=this.interactions;each$1(e,function(c){c&&c.destroy()}),this.clear();for(var n=this.controllers,o=0,s=n.length;o<s;o++){var l=n[o];l.destroy()}this.backgroundGroup.remove(!0),this.middleGroup.remove(!0),this.foregroundGroup.remove(!0),a.prototype.destroy.call(this)},r.prototype.changeVisible=function(e){a.prototype.changeVisible.call(this,e);for(var n=this.geometries,o=0,s=n.length;o<s;o++){var l=n[o];l.changeVisible(e)}for(var c=this.controllers,o=0,s=c.length;o<s;o++){var u=c[o];u.changeVisible(e)}return this.foregroundGroup.set("visible",e),this.middleGroup.set("visible",e),this.backgroundGroup.set("visible",e),this.getCanvas().draw(),this},r.prototype.data=function(e){return set(this.options,"data",e),this.isDataChanged=!0,this},r.prototype.source=function(e){return console.warn("This method will be removed at G2 V4.1. Please use chart.data() instead."),this.data(e)},r.prototype.filter=function(e,n){return isFunction$1(n)?(set(this.options,["filters",e],n),this):(!n&&get(this.options,["filters",e])&&delete this.options.filters[e],this)},r.prototype.axis=function(e,n){return isBoolean(e)?set(this.options,["axes"],e):set(this.options,["axes",e],n),this},r.prototype.legend=function(e,n){return isBoolean(e)?set(this.options,["legends"],e):isString$1(e)?(set(this.options,["legends",e],n),isPlainObject$1(n)&&(n!=null&&n.selected)&&set(this.options,["filters",e],function(o){var s;return(s=n==null?void 0:n.selected[o])!==null&&s!==void 0?s:!0})):set(this.options,["legends"],e),this},r.prototype.scale=function(e,n){var o=this;return isString$1(e)?set(this.options,["scales",e],n):isObject$1(e)&&each$1(e,function(s,l){set(o.options,["scales",l],s)}),this},r.prototype.tooltip=function(e){return set(this.options,"tooltip",e),this},r.prototype.annotation=function(){return this.getController("annotation")},r.prototype.guide=function(){return console.warn("This method will be removed at G2 V4.1. Please use chart.annotation() instead."),this.annotation()},r.prototype.coordinate=function(e,n){return isString$1(e)?set(this.options,"coordinate",{type:e,cfg:n}):set(this.options,"coordinate",e),this.coordinateController.update(this.options.coordinate),this.coordinateController},r.prototype.coord=function(e,n){return console.warn("This method will be removed at G2 V4.1. Please use chart.coordinate() instead."),this.coordinate(e,n)},r.prototype.facet=function(e,n){this.facetInstance&&this.facetInstance.destroy();var o=getFacet(e);if(!o)throw new Error("facet '".concat(e,"' is not exist!"));return this.facetInstance=new o(this,__assign$8(__assign$8({},n),{type:e})),this},r.prototype.animate=function(e){return set(this.options,"animate",e),this},r.prototype.updateOptions=function(e){return this.clear(),mix(this.options,e),this.views.forEach(function(n){return n.destroy()}),this.views=[],this.initOptions(),this.coordinateBBox=this.viewBBox,this},r.prototype.option=function(e,n){if(r.prototype[e])throw new Error(`Can't use built in variable name "`.concat(e,'", please change another one.'));return set(this.options,e,n),this},r.prototype.theme=function(e){return this.themeObject=isObject$1(e)?deepMix({},this.themeObject,createTheme(e)):getTheme(e),this},r.prototype.interaction=function(e,n){var o=this.interactions[e];o&&o.destroy();var s=createInteraction(e,this,n);return s&&(s.init(),this.interactions[e]=s),this},r.prototype.removeInteraction=function(e){var n=this.interactions[e];n&&(n.destroy(),this.interactions[e]=void 0)},r.prototype.changeData=function(e){this.isDataChanged=!0,this.emit(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,Event$1.fromData(this,VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,null)),this.data(e),this.paint(!0);for(var n=this.views,o=0,s=n.length;o<s;o++){var l=n[o];l.changeData(e)}this.emit(VIEW_LIFE_CIRCLE.AFTER_CHANGE_DATA,Event$1.fromData(this,VIEW_LIFE_CIRCLE.AFTER_CHANGE_DATA,null))},r.prototype.createView=function(e){this.parent&&this.parent.parent&&console.warn("The view nesting recursive feature will be removed at G2 V4.1. Please avoid to use it.");var n={data:this.options.data,scales:clone(this.options.scales),axes:clone(this.options.axes),coordinate:clone(this.coordinateController.getOption()),tooltip:clone(this.options.tooltip),legends:clone(this.options.legends),animate:this.options.animate,visible:this.visible},o=new r(__assign$8(__assign$8({parent:this,canvas:this.canvas,backgroundGroup:this.backgroundGroup.addGroup({zIndex:GROUP_Z_INDEX.BG}),middleGroup:this.middleGroup.addGroup({zIndex:GROUP_Z_INDEX.MID}),foregroundGroup:this.foregroundGroup.addGroup({zIndex:GROUP_Z_INDEX.FORE}),theme:this.themeObject,padding:this.padding},e),{options:__assign$8(__assign$8({},n),get(e,"options",{}))}));return this.views.push(o),o},r.prototype.view=function(e){return console.warn("This method will be removed at G2 V4.1. Please use chart.createView() instead."),this.createView(e)},r.prototype.removeView=function(e){var n=remove(this.views,function(o){return o===e})[0];return n&&n.destroy(),n},r.prototype.getCoordinate=function(){return this.coordinateInstance},r.prototype.getTheme=function(){return this.themeObject},r.prototype.getXScale=function(){var e=this.geometries[0];return e?e.getXScale():null},r.prototype.getYScales=function(){var e={},n=[];return this.geometries.forEach(function(o){var s=o.getYScale(),l=s.field;e[l]||(e[l]=!0,n.push(s))}),n},r.prototype.getScalesByDim=function(e){for(var n=this.geometries,o={},s=0,l=n.length;s<l;s++){var c=n[s],u=e==="x"?c.getXScale():c.getYScale();u&&!o[u.field]&&(o[u.field]=u)}return o},r.prototype.getScale=function(e,n){var o=n||this.getScaleKey(e);return this.getRootView().scalePool.getScale(o)},r.prototype.getScaleByField=function(e,n){return this.getScale(e,n)},r.prototype.getOptions=function(){return this.options},r.prototype.getData=function(){return this.filteredData},r.prototype.getOriginalData=function(){return this.options.data},r.prototype.getPadding=function(){return this.autoPadding.getPadding()},r.prototype.getGeometries=function(){return this.geometries},r.prototype.getElements=function(){return reduce(this.geometries,function(e,n){return e.concat(n.getElements())},[])},r.prototype.getElementsBy=function(e){return this.getElements().filter(function(n){return e(n)})},r.prototype.getLayer=function(e){return e===LAYER.BG?this.backgroundGroup:e===LAYER.MID?this.middleGroup:e===LAYER.FORE?this.foregroundGroup:this.foregroundGroup},r.prototype.isPointInPlot=function(e){return isPointInCoordinate(this.getCoordinate(),e)},r.prototype.getLegendAttributes=function(){return flatten(this.geometries.map(function(e){return e.getGroupAttributes()}))},r.prototype.getGroupScales=function(){var e=this.geometries.map(function(n){return n.getGroupScales()});return uniq$1(flatten(e))},r.prototype.getCanvas=function(){return this.getRootView().canvas},r.prototype.getRootView=function(){for(var e=this;;){if(e.parent){e=e.parent;continue}break}return e},r.prototype.getXY=function(e){var n=this.getCoordinate(),o=this.getScalesByDim("x"),s=this.getScalesByDim("y"),l,c;if(each$1(e,function(u,f){o[f]&&(l=o[f].scale(u)),s[f]&&(c=s[f].scale(u))}),!isNil(l)&&!isNil(c))return n.convert({x:l,y:c})},r.prototype.getController=function(e){return find$2(this.controllers,function(n){return n.name===e})},r.prototype.showTooltip=function(e){var n=this.getController("tooltip");return n&&n.showTooltip(e),this},r.prototype.hideTooltip=function(){var e=this.getController("tooltip");return e&&e.hideTooltip(),this},r.prototype.lockTooltip=function(){var e=this.getController("tooltip");return e&&e.lockTooltip(),this},r.prototype.unlockTooltip=function(){var e=this.getController("tooltip");return e&&e.unlockTooltip(),this},r.prototype.isTooltipLocked=function(){var e=this.getController("tooltip");return e&&e.isTooltipLocked()},r.prototype.getTooltipItems=function(e){var n=this.getController("tooltip");return n?n.getTooltipItems(e):[]},r.prototype.getSnapRecords=function(e){for(var n=this.geometries,o=[],s=0,l=n.length;s<l;s++){var c=n[s],u=c.dataArray;c.sort(u);for(var f=void 0,d=0,g=u.length;d<g;d++){var p=u[d];f=findDataByPoint(e,p,c),f&&o.push(f)}}for(var v=this.views,s=0,l=v.length;s<l;s++){var m=v[s],y=m.getSnapRecords(e);o=o.concat(y)}return o},r.prototype.getComponents=function(){for(var e=[],n=this.controllers,o=0,s=n.length;o<s;o++){var l=n[o];e=e.concat(l.getComponents())}return e},r.prototype.filterData=function(e){var n=this.options.filters;return size(n)===0?e:filter(e,function(o,s){var l=Object.keys(n);return l.every(function(c){var u=n[c];return u(o[c],o,s)})})},r.prototype.filterFieldData=function(e,n){var o=this.options.filters,s=get(o,e);return isUndefined$1(s)?n:n.filter(function(l,c){return s(l[e],l,c)})},r.prototype.adjustCoordinate=function(){var e=this.getCoordinate(),n=e.start,o=e.end,s=this.coordinateBBox.bl,l=this.coordinateBBox.tr;if(isEqual$1(n,s)&&isEqual$1(o,l)){this.isCoordinateChanged=!1;return}this.isCoordinateChanged=!0,this.coordinateInstance=this.coordinateController.adjust(s,l)},r.prototype.paint=function(e){this.renderDataRecursive(e),this.syncScale(),this.emit(VIEW_LIFE_CIRCLE.BEFORE_PAINT),this.renderPaddingRecursive(e),this.renderLayoutRecursive(e),this.renderBackgroundStyleShape(),this.renderPaintRecursive(e),this.emit(VIEW_LIFE_CIRCLE.AFTER_PAINT),this.isDataChanged=!1},r.prototype.renderBackgroundStyleShape=function(){if(!this.parent){var e=get(this.themeObject,"background");if(e){this.backgroundStyleRectShape||(this.backgroundStyleRectShape=this.backgroundGroup.addShape("rect",{attrs:{},zIndex:-1,capture:!1}),this.backgroundStyleRectShape.toBack());var n=this.viewBBox,o=n.x,s=n.y,l=n.width,c=n.height;this.backgroundStyleRectShape.attr({fill:e,x:o,y:s,width:l,height:c})}else this.backgroundStyleRectShape&&(this.backgroundStyleRectShape.remove(!0),this.backgroundStyleRectShape=void 0)}},r.prototype.renderPaddingRecursive=function(e){this.calculateViewBBox(),this.adjustCoordinate(),this.initComponents(e),this.autoPadding=calculatePadding(this).shrink(parsePadding(this.appendPadding)),this.coordinateBBox=this.viewBBox.shrink(this.autoPadding.getPadding()),this.adjustCoordinate();var n=this.controllers.find(function(u){return u.name==="tooltip"});n.update();for(var o=this.views,s=0,l=o.length;s<l;s++){var c=o[s];c.renderPaddingRecursive(e)}},r.prototype.renderLayoutRecursive=function(e){var n=this.syncViewPadding===!0?defaultSyncViewPadding:isFunction$1(this.syncViewPadding)?this.syncViewPadding:void 0;n&&(n(this,this.views,PaddingCal),this.views.forEach(function(u){u.coordinateBBox=u.viewBBox.shrink(u.autoPadding.getPadding()),u.adjustCoordinate()})),this.doLayout();for(var o=this.views,s=0,l=o.length;s<l;s++){var c=o[s];c.renderLayoutRecursive(e)}},r.prototype.renderPaintRecursive=function(e){var n=this.middleGroup;if(this.limitInPlot){var o=getCoordinateClipCfg(this.coordinateInstance),s=o.type,l=o.attrs;n.setClip({type:s,attrs:l})}else n.setClip(void 0);this.paintGeometries(e),this.renderComponents(e);for(var c=this.views,u=0,f=c.length;u<f;u++){var d=c[u];d.renderPaintRecursive(e)}},r.prototype.createScale=function(e,n,o,s){var l=get(this.options.scales,[e]),c=__assign$8(__assign$8({},l),o);return this.parent?this.parent.createScale(e,n,c,s):this.scalePool.createScale(e,n,c,s)},r.prototype.renderDataRecursive=function(e){this.doFilterData(),this.createCoordinate(),this.initGeometries(e),this.renderFacet(e);for(var n=this.views,o=0,s=n.length;o<s;o++){var l=n[o];l.renderDataRecursive(e)}},r.prototype.calculateViewBBox=function(){var e,n,o,s;if(this.parent){var l=this.parent.coordinateBBox;e=l.x,n=l.y,o=l.width,s=l.height}else e=0,n=0,o=this.canvas.get("width"),s=this.canvas.get("height");var c=this.region,u=c.start,f=c.end,d=new BBox(e+o*u.x,n+s*u.y,o*(f.x-u.x),s*(f.y-u.y));(!this.viewBBox||!this.viewBBox.isEqual(d))&&(this.viewBBox=new BBox(e+o*u.x,n+s*u.y,o*(f.x-u.x),s*(f.y-u.y))),this.coordinateBBox=this.viewBBox},r.prototype.initEvents=function(){this.foregroundGroup.on("*",this.onDelegateEvents),this.middleGroup.on("*",this.onDelegateEvents),this.backgroundGroup.on("*",this.onDelegateEvents),this.canvas.on("*",this.onCanvasEvent)},r.prototype.initComponentController=function(){for(var e=this.usedControllers,n=0,o=e.length;n<o;n++){var s=e[n],l=getComponentController(s);l&&this.controllers.push(new l(this))}},r.prototype.createViewEvent=function(e){var n=e.shape,o=e.name,s=n?n.get("origin"):null,l=new Event$1(this,e,s);return l.type=o,l},r.prototype.doPlotEvent=function(e){var n=e.type,o=e.x,s=e.y,l={x:o,y:s},c=["mousedown","mouseup","mousemove","mouseleave","mousewheel","touchstart","touchmove","touchend","touchcancel","click","dblclick","contextmenu"];if(c.includes(n)){var u=this.isPointInPlot(l),f=e.clone();if(u){var d="plot:".concat(n);f.type=d,this.emit(d,f),(n==="mouseleave"||n==="touchend")&&(this.isPreMouseInPlot=!1)}n==="mousemove"||n==="touchmove"?(this.isPreMouseInPlot&&!u?(n==="mousemove"&&(f.type=PLOT_EVENTS.MOUSE_LEAVE,this.emit(PLOT_EVENTS.MOUSE_LEAVE,f)),f.type=PLOT_EVENTS.LEAVE,this.emit(PLOT_EVENTS.LEAVE,f)):!this.isPreMouseInPlot&&u&&(n==="mousemove"&&(f.type=PLOT_EVENTS.MOUSE_ENTER,this.emit(PLOT_EVENTS.MOUSE_ENTER,f)),f.type=PLOT_EVENTS.ENTER,this.emit(PLOT_EVENTS.ENTER,f)),this.isPreMouseInPlot=u):(n==="mouseleave"||n==="touchend")&&this.isPreMouseInPlot&&(n==="mouseleave"&&(f.type=PLOT_EVENTS.MOUSE_LEAVE,this.emit(PLOT_EVENTS.MOUSE_LEAVE,f)),f.type=PLOT_EVENTS.LEAVE,this.emit(PLOT_EVENTS.LEAVE,f),this.isPreMouseInPlot=!1)}},r.prototype.doFilterData=function(){var e=this.options.data;this.filteredData=this.filterData(e)},r.prototype.initGeometries=function(e){this.createOrUpdateScales();for(var n=this.getCoordinate(),o=get(this.options,"scales",{}),s=this.geometries,l=0,c=s.length;l<c;l++){var u=s[l];u.scales=this.getGeometryScales();var f={coordinate:n,scaleDefs:o,data:this.filteredData,theme:this.themeObject,isDataChanged:this.isDataChanged,isCoordinateChanged:this.isCoordinateChanged};e?u.update(f):u.init(f)}this.adjustScales()},r.prototype.createOrUpdateScales=function(){for(var e=this.getScaleFields(),n=this.getGroupedFields(),o=this.getOptions(),s=o.data,l=o.scales,c=l===void 0?{}:l,u=this.filteredData,f=0,d=e.length;f<d;f++){var g=e[f],p=c[g],v=this.getScaleKey(g);this.createScale(g,n.includes(g)?s:u,p,v),this.createdScaleKeys.set(v,!0)}},r.prototype.syncScale=function(){this.getRootView().scalePool.sync(this.getCoordinate(),this.theme)},r.prototype.getGeometryScales=function(){for(var e=this.getScaleFields(),n={},o=0;o<e.length;o++){var s=e[o];n[s]=this.getScaleByField(s)}return n},r.prototype.getScaleFields=function(){for(var e=[],n=new Map,o=this.geometries,s=0;s<o.length;s++){var l=o[s],c=l.getScaleFields();uniq$1(c,e,n)}return e},r.prototype.getGroupedFields=function(){for(var e=[],n=new Map,o=this.geometries,s=0;s<o.length;s++){var l=o[s],c=l.getGroupFields();uniq$1(c,e,n)}return e},r.prototype.adjustScales=function(){this.adjustCategoryScaleRange()},r.prototype.adjustCategoryScaleRange=function(){var e=this,n=__spreadArray$2([this.getXScale()],__read(this.getYScales()),!1).filter(function(l){return!!l}),o=this.getCoordinate(),s=this.options.scales;each$1(n,function(l){var c=l.field,u=l.values,f=l.isCategory,d=l.isIdentity;(f||d)&&u&&!get(s,[c,"range"])&&(l.range=getDefaultCategoryScaleRange(l,o,e.theme))})},r.prototype.initComponents=function(e){for(var n=this.controllers,o=0;o<n.length;o++){var s=n[o];e?s.update():(s.clear(),s.render())}},r.prototype.doLayout=function(){this.layoutFunc(this)},r.prototype.createCoordinate=function(){var e=this.coordinateBBox.bl,n=this.coordinateBBox.tr;this.coordinateInstance=this.coordinateController.create(e,n)},r.prototype.paintGeometries=function(e){for(var n=this.options.animate,o=this.getCoordinate(),s={x:this.viewBBox.x,y:this.viewBBox.y,minX:this.viewBBox.minX,minY:this.viewBBox.minY,maxX:this.viewBBox.maxX,maxY:this.viewBBox.maxY,width:this.viewBBox.width,height:this.viewBBox.height},l=this.geometries,c=0;c<l.length;c++){var u=l[c];u.coordinate=o,u.canvasRegion=s,n||u.animate(!1),u.paint(e)}},r.prototype.renderComponents=function(e){for(var n=this.getComponents(),o=0;o<n.length;o++){var s=n[o];s.component.render()}},r.prototype.renderFacet=function(e){this.facetInstance&&(e?this.facetInstance.update():(this.facetInstance.clear(),this.facetInstance.init(),this.facetInstance.render()))},r.prototype.initOptions=function(){var e=this,n=this.options,o=n.geometries,s=o===void 0?[]:o,l=n.interactions,c=l===void 0?[]:l,u=n.views,f=u===void 0?[]:u,d=n.annotations,g=d===void 0?[]:d,p=n.coordinate,v=n.events,m=n.facets;this.coordinateController?p&&this.coordinateController.update(p):this.coordinateController=new CoordinateController(p);for(var y=0;y<s.length;y++){var x=s[y];this.createGeometry(x)}for(var _=0;_<c.length;_++){var E=c[_],S=E.type,A=E.cfg;this.interaction(S,A)}for(var T=0;T<f.length;T++){var b=f[T];this.createView(b)}for(var C=this.getController("annotation"),L=0;L<g.length;L++){var R=g[L];C.annotation(R)}v&&each$1(v,function(I,w){e.on(w,I)}),m&&each$1(m,function(I){var w=I.type,M=__rest$1(I,["type"]);e.facet(w,M)})},r.prototype.createGeometry=function(e){var n=e.type,o=e.cfg,s=o===void 0?{}:o;if(this[n]){var l=this[n](s);each$1(e,function(c,u){isFunction$1(l[u])&&l[u](c)})}},r.prototype.getScaleKey=function(e){return"".concat(this.id,"-").concat(e)},r}(Base$1);function registerGeometry(a,r){View.prototype[a.toLowerCase()]=function(e){e===void 0&&(e={});var n=__assign$8({container:this.middleGroup.addGroup(),labelsContainer:this.foregroundGroup.addGroup()},e),o=new r(n);return this.geometries.push(o),o}}var Chart=function(a){__extends$7(r,a);function r(e){var n=this,o=e.container,s=e.width,l=e.height,c=e.autoFit,u=c===void 0?!1:c,f=e.padding,d=e.appendPadding,g=e.renderer,p=g===void 0?"canvas":g,v=e.pixelRatio,m=e.localRefresh,y=m===void 0?!0:m,x=e.visible,_=x===void 0?!0:x,E=e.supportCSSTransform,S=E===void 0?!1:E,A=e.defaultInteractions,T=A===void 0?["tooltip","legend-filter","legend-active","continuous-filter","ellipsis-text","axis-description"]:A,b=e.options,C=e.limitInPlot,L=e.theme,R=e.syncViewPadding,I=isString$1(o)?document.getElementById(o):o,w=createDom$1('<div style="position:relative;"></div>');I.appendChild(w);var M=getChartSize(I,u,s,l),D=getEngine(p),O=new D.Canvas(__assign$8({container:w,pixelRatio:v,localRefresh:y,supportCSSTransform:S},M));return n=a.call(this,{parent:null,canvas:O,backgroundGroup:O.addGroup({zIndex:GROUP_Z_INDEX.BG}),middleGroup:O.addGroup({zIndex:GROUP_Z_INDEX.MID}),foregroundGroup:O.addGroup({zIndex:GROUP_Z_INDEX.FORE}),padding:f,appendPadding:d,visible:_,options:b,limitInPlot:C,theme:L,syncViewPadding:R})||this,n.onResize=debounce$1(function(){n.forceFit()},300),n.ele=I,n.canvas=O,n.width=M.width,n.height=M.height,n.autoFit=u,n.localRefresh=y,n.renderer=p,n.wrapperElement=w,n.updateCanvasStyle(),n.bindAutoFit(),n.initDefaultInteractions(T),n}return r.prototype.initDefaultInteractions=function(e){var n=this;each$1(e,function(o){n.interaction(o)})},r.prototype.aria=function(e){var n="aria-label";e===!1?this.ele.removeAttribute(n):this.ele.setAttribute(n,e.label)},r.prototype.changeSize=function(e,n){return this.width===e&&this.height===n?this:(this.emit(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_SIZE),this.width=e,this.height=n,this.canvas.changeSize(e,n),this.render(!0),this.emit(VIEW_LIFE_CIRCLE.AFTER_CHANGE_SIZE),this)},r.prototype.clear=function(){a.prototype.clear.call(this),this.aria(!1)},r.prototype.destroy=function(){a.prototype.destroy.call(this),this.unbindAutoFit(),this.canvas.destroy(),removeDom(this.wrapperElement),this.wrapperElement=null},r.prototype.changeVisible=function(e){return a.prototype.changeVisible.call(this,e),this.wrapperElement.style.display=e?"":"none",this},r.prototype.forceFit=function(){if(!this.destroyed){var e=getChartSize(this.ele,!0,this.width,this.height),n=e.width,o=e.height;this.changeSize(n,o)}},r.prototype.updateCanvasStyle=function(){modifyCSS(this.canvas.get("el"),{display:"inline-block",verticalAlign:"middle"})},r.prototype.bindAutoFit=function(){this.autoFit&&window.addEventListener("resize",this.onResize)},r.prototype.unbindAutoFit=function(){this.autoFit&&window.removeEventListener("resize",this.onResize)},r}(View),Controller=function(){function a(r){this.visible=!0,this.components=[],this.view=r}return a.prototype.clear=function(r){each$1(this.components,function(e){e.component.destroy()}),this.components=[]},a.prototype.destroy=function(){this.clear()},a.prototype.getComponents=function(){return this.components},a.prototype.changeVisible=function(r){this.visible!==r&&(this.components.forEach(function(e){r?e.component.show():e.component.hide()}),this.visible=r)},a}();function uniq(a){for(var r=[],e=function(o){var s=a[o],l=find$2(r,function(c){return c.color===s.color&&c.name===s.name&&c.value===s.value&&c.title===s.title});l||r.push(s)},n=0;n<a.length;n++)e(n);return r}var Tooltip=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.isLocked=!1,e}return Object.defineProperty(r.prototype,"name",{get:function(){return"tooltip"},enumerable:!1,configurable:!0}),r.prototype.init=function(){},r.prototype.isVisible=function(){var e=this.view.getOptions().tooltip;return e!==!1},r.prototype.render=function(){},r.prototype.showTooltip=function(e){if(this.point=e,!!this.isVisible()){var n=this.view,o=this.getTooltipItems(e);if(!o.length){this.hideTooltip();return}var s=this.getTitle(o),l={x:o[0].x,y:o[0].y};n.emit("tooltip:show",Event$1.fromData(n,"tooltip:show",__assign$8({items:o,title:s},e)));var c=this.getTooltipCfg(),u=c.follow,f=c.showMarkers,d=c.showCrosshairs,g=c.showContent,p=c.marker,v=this.items,m=this.title;if(!isEqual$1(m,s)||!isEqual$1(v,o)?(n.emit("tooltip:change",Event$1.fromData(n,"tooltip:change",__assign$8({items:o,title:s},e))),(isFunction$1(g)?g(o):g)&&(this.tooltip||this.renderTooltip(),this.tooltip.update(mix({},c,{items:this.getItemsAfterProcess(o),title:s},u?e:{})),this.tooltip.show()),f&&this.renderTooltipMarkers(o,p)):(this.tooltip&&u&&(this.tooltip.update(e),this.tooltip.show()),this.tooltipMarkersGroup&&this.tooltipMarkersGroup.show()),this.items=o,this.title=s,d){var y=get(c,["crosshairs","follow"],!1);this.renderCrosshairs(y?e:l,c)}}},r.prototype.hideTooltip=function(){var e=this.getTooltipCfg().follow;if(!e){this.point=null;return}var n=this.tooltipMarkersGroup;n&&n.hide();var o=this.xCrosshair,s=this.yCrosshair;o&&o.hide(),s&&s.hide();var l=this.tooltip;l&&l.hide(),this.view.emit("tooltip:hide",Event$1.fromData(this.view,"tooltip:hide",{})),this.point=null},r.prototype.lockTooltip=function(){this.isLocked=!0,this.tooltip&&this.tooltip.setCapture(!0)},r.prototype.unlockTooltip=function(){this.isLocked=!1;var e=this.getTooltipCfg();this.tooltip&&this.tooltip.setCapture(e.capture)},r.prototype.isTooltipLocked=function(){return this.isLocked},r.prototype.clear=function(){var e=this,n=e.tooltip,o=e.xCrosshair,s=e.yCrosshair,l=e.tooltipMarkersGroup;n&&(n.hide(),n.clear()),o&&o.clear(),s&&s.clear(),l&&l.clear(),n!=null&&n.get("customContent")&&(this.tooltip.destroy(),this.tooltip=null),this.title=null,this.items=null},r.prototype.destroy=function(){this.tooltip&&this.tooltip.destroy(),this.xCrosshair&&this.xCrosshair.destroy(),this.yCrosshair&&this.yCrosshair.destroy(),this.guideGroup&&this.guideGroup.remove(!0),this.reset()},r.prototype.reset=function(){this.items=null,this.title=null,this.tooltipMarkersGroup=null,this.tooltipCrosshairsGroup=null,this.xCrosshair=null,this.yCrosshair=null,this.tooltip=null,this.guideGroup=null,this.isLocked=!1,this.point=null},r.prototype.changeVisible=function(e){if(this.visible!==e){var n=this,o=n.tooltip,s=n.tooltipMarkersGroup,l=n.xCrosshair,c=n.yCrosshair;e?(o&&o.show(),s&&s.show(),l&&l.show(),c&&c.show()):(o&&o.hide(),s&&s.hide(),l&&l.hide(),c&&c.hide()),this.visible=e}},r.prototype.getTooltipItems=function(e){var n,o,s,l,c,u,f=this.findItemsFromView(this.view,e);if(f.length){f=flatten(f);try{for(var d=__values(f),g=d.next();!g.done;g=d.next()){var p=g.value;try{for(var v=(s=void 0,__values(p)),m=v.next();!m.done;m=v.next()){var y=m.value,x=y.mappingData,_=x.x,E=x.y;y.x=isArray$4(_)?_[_.length-1]:_,y.y=isArray$4(E)?E[E.length-1]:E}}catch(I){s={error:I}}finally{try{m&&!m.done&&(l=v.return)&&l.call(v)}finally{if(s)throw s.error}}}}catch(I){n={error:I}}finally{try{g&&!g.done&&(o=d.return)&&o.call(d)}finally{if(n)throw n.error}}var S=this.getTooltipCfg().shared;if(S===!1&&f.length>1){var A=f[0],T=Math.abs(e.y-A[0].y);try{for(var b=__values(f),C=b.next();!C.done;C=b.next()){var L=C.value,R=Math.abs(e.y-L[0].y);R<=T&&(A=L,T=R)}}catch(I){c={error:I}}finally{try{C&&!C.done&&(u=b.return)&&u.call(b)}finally{if(c)throw c.error}}f=[A]}return uniq(flatten(f))}return[]},r.prototype.layout=function(){},r.prototype.update=function(){if(this.point&&this.showTooltip(this.point),this.tooltip){var e=this.view.getCanvas();this.tooltip.set("region",{start:{x:0,y:0},end:{x:e.get("width"),y:e.get("height")}})}},r.prototype.isCursorEntered=function(e){if(this.tooltip){var n=this.tooltip.getContainer(),o=this.tooltip.get("capture");if(n&&o){var s=n.getBoundingClientRect(),l=s.x,c=s.y,u=s.width,f=s.height;return new BBox(l,c,u,f).isPointIn(e)}}return!1},r.prototype.getTooltipCfg=function(){var e=this.view,n=e.getOptions().tooltip,o=this.processCustomContent(n),s=e.getTheme(),l=get(s,["components","tooltip"],{}),c=get(o,"enterable",l.enterable);return deepMix({},l,o,{capture:!!(c||this.isLocked)})},r.prototype.processCustomContent=function(e){if(isBoolean(e)||!get(e,"customContent"))return e;var n=e.customContent,o=function(s,l){var c=n(s,l)||"";return isString$1(c)?'<div class="g2-tooltip">'+c+"</div>":c};return __assign$8(__assign$8({},e),{customContent:o})},r.prototype.getTitle=function(e){var n=e[0].title||e[0].name;return this.title=n,n},r.prototype.renderTooltip=function(){var e=this.view.getCanvas(),n={start:{x:0,y:0},end:{x:e.get("width"),y:e.get("height")}},o=this.getTooltipCfg(),s=new HtmlTooltip(__assign$8(__assign$8({parent:e.get("el").parentNode,region:n},o),{visible:!1,crosshairs:null}));s.init(),this.tooltip=s},r.prototype.renderTooltipMarkers=function(e,n){var o,s,l=this.getTooltipMarkersGroup(),c=this.view.getRootView(),u=c.limitInPlot;try{for(var f=__values(e),d=f.next();!d.done;d=f.next()){var g=d.value,p=g.x,v=g.y;if(u||l!=null&&l.getClip()){var m=getCoordinateClipCfg(c.getCoordinate()),y=m.type,x=m.attrs;l==null||l.setClip({type:y,attrs:x})}else l==null||l.setClip(void 0);var _=this.view.getTheme(),E=get(_,["components","tooltip","marker"],{}),S=__assign$8(__assign$8({fill:g.color,symbol:"circle",shadowColor:g.color},isFunction$1(n)?__assign$8(__assign$8({},E),n(g)):n),{x:p,y:v});l.addShape("marker",{attrs:S})}}catch(A){o={error:A}}finally{try{d&&!d.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}},r.prototype.renderCrosshairs=function(e,n){var o=get(n,["crosshairs","type"],"x");o==="x"?(this.yCrosshair&&this.yCrosshair.hide(),this.renderXCrosshairs(e,n)):o==="y"?(this.xCrosshair&&this.xCrosshair.hide(),this.renderYCrosshairs(e,n)):o==="xy"&&(this.renderXCrosshairs(e,n),this.renderYCrosshairs(e,n))},r.prototype.renderXCrosshairs=function(e,n){var o=this.getViewWithGeometry(this.view).getCoordinate(),s,l;if(o.isRect)o.isTransposed?(s={x:o.start.x,y:e.y},l={x:o.end.x,y:e.y}):(s={x:e.x,y:o.end.y},l={x:e.x,y:o.start.y});else{var c=getAngleByPoint(o,e),u=o.getCenter(),f=o.getRadius();l=polarToCartesian(u.x,u.y,f,c),s=u}var d=deepMix({start:s,end:l,container:this.getTooltipCrosshairsGroup()},get(n,"crosshairs",{}),this.getCrosshairsText("x",e,n));delete d.type;var g=this.xCrosshair;g?g.update(d):(g=new LineCrosshair$1(d),g.init()),g.render(),g.show(),this.xCrosshair=g},r.prototype.renderYCrosshairs=function(e,n){var o=this.getViewWithGeometry(this.view).getCoordinate(),s,l;if(o.isRect){var c=void 0,u=void 0;o.isTransposed?(c={x:e.x,y:o.end.y},u={x:e.x,y:o.start.y}):(c={x:o.start.x,y:e.y},u={x:o.end.x,y:e.y}),s={start:c,end:u},l="Line"}else s={center:o.getCenter(),radius:getDistanceToCenter(o,e),startAngle:o.startAngle,endAngle:o.endAngle},l="Circle";s=deepMix({container:this.getTooltipCrosshairsGroup()},s,get(n,"crosshairs",{}),this.getCrosshairsText("y",e,n)),delete s.type;var f=this.yCrosshair;f?o.isRect&&f.get("type")==="circle"||!o.isRect&&f.get("type")==="line"?(f=new Crosshair[l](s),f.init()):f.update(s):(f=new Crosshair[l](s),f.init()),f.render(),f.show(),this.yCrosshair=f},r.prototype.getCrosshairsText=function(e,n,o){var s=get(o,["crosshairs","text"]),l=get(o,["crosshairs","follow"]),c=this.items;if(s){var u=this.getViewWithGeometry(this.view),f=c[0],d=u.getXScale(),g=u.getYScales()[0],p=void 0,v=void 0;if(l){var m=this.view.getCoordinate().invert(n);p=d.invert(m.x),v=g.invert(m.y)}else p=f.data[d.field],v=f.data[g.field];var y=e==="x"?p:v;return isFunction$1(s)?s=s(e,y,c,n):s.content=y,{text:s}}},r.prototype.getGuideGroup=function(){if(!this.guideGroup){var e=this.view.foregroundGroup;this.guideGroup=e.addGroup({name:"tooltipGuide",capture:!1})}return this.guideGroup},r.prototype.getTooltipMarkersGroup=function(){var e=this.tooltipMarkersGroup;return e&&!e.destroyed?(e.clear(),e.show()):(e=this.getGuideGroup().addGroup({name:"tooltipMarkersGroup"}),e.toFront(),this.tooltipMarkersGroup=e),e},r.prototype.getTooltipCrosshairsGroup=function(){var e=this.tooltipCrosshairsGroup;return e||(e=this.getGuideGroup().addGroup({name:"tooltipCrosshairsGroup",capture:!1}),e.toBack(),this.tooltipCrosshairsGroup=e),e},r.prototype.findItemsFromView=function(e,n){var o,s;if(e.getOptions().tooltip===!1)return[];var l=this.getTooltipCfg(),c=findItemsFromView(e,n,l);try{for(var u=__values(e.views),f=u.next();!f.done;f=u.next()){var d=f.value;c=c.concat(this.findItemsFromView(d,n))}}catch(g){o={error:g}}finally{try{f&&!f.done&&(s=u.return)&&s.call(u)}finally{if(o)throw o.error}}return c},r.prototype.getViewWithGeometry=function(e){var n=this;return e.geometries.length?e:find$2(e.views,function(o){return n.getViewWithGeometry(o)})},r.prototype.getItemsAfterProcess=function(e){var n=this.getTooltipCfg().customItems,o=n||function(s){return s};return o(e)},r}(Controller),ANIMATIONS_MAP={};function getAnimation(a){return ANIMATIONS_MAP[a.toLowerCase()]}function registerAnimation(a,r){ANIMATIONS_MAP[a.toLowerCase()]=r}var DEFAULT_ANIMATE_CFG={appear:{duration:450,easing:"easeQuadOut"},update:{duration:400,easing:"easeQuadInOut"},enter:{duration:400,easing:"easeQuadInOut"},leave:{duration:350,easing:"easeQuadIn"}},GEOMETRY_ANIMATE_CFG={interval:function(a){return{enter:{animation:a.isRect?a.isTransposed?"scale-in-x":"scale-in-y":"fade-in"},update:{animation:a.isPolar&&a.isTransposed?"sector-path-update":null},leave:{animation:"fade-out"}}},line:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},path:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},point:{appear:{animation:"zoom-in"},enter:{animation:"zoom-in"},leave:{animation:"zoom-out"}},area:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},polygon:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},schema:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},edge:{enter:{animation:"fade-in"},leave:{animation:"fade-out"}},label:{appear:{animation:"fade-in",delay:450},enter:{animation:"fade-in"},update:{animation:"position-update"},leave:{animation:"fade-out"}}},GEOMETRY_GROUP_APPEAR_ANIMATION={line:function(){return{animation:"wave-in"}},area:function(){return{animation:"wave-in"}},path:function(){return{animation:"fade-in"}},interval:function(a){var r;return a.isRect?r=a.isTransposed?"grow-in-x":"grow-in-y":(r="grow-in-xy",a.isPolar&&a.isTransposed&&(r="wave-in")),{animation:r}},schema:function(a){var r;return a.isRect?r=a.isTransposed?"grow-in-x":"grow-in-y":r="grow-in-xy",{animation:r}},polygon:function(){return{animation:"fade-in",duration:500}},edge:function(){return{animation:"fade-in"}}};function parseAnimateConfig(a,r){return{delay:isFunction$1(a.delay)?a.delay(r):a.delay,easing:isFunction$1(a.easing)?a.easing(r):a.easing,duration:isFunction$1(a.duration)?a.duration(r):a.duration,callback:a.callback,repeat:a.repeat}}function getDefaultAnimateCfg(a,r,e){var n=GEOMETRY_ANIMATE_CFG[a];return n&&(isFunction$1(n)&&(n=n(r)),n=deepMix({},DEFAULT_ANIMATE_CFG,n),e)?n[e]:n}function doAnimate(a,r,e){var n=get(a.get("origin"),"data",FIELD_ORIGIN),o=r.animation,s=parseAnimateConfig(r,n);if(o){var l=getAnimation(o);l&&l(a,s,e)}else a.animate(e.toAttrs,s)}function doGroupAppearAnimate(a,r,e,n,o){if(GEOMETRY_GROUP_APPEAR_ANIMATION[e]){var s=GEOMETRY_GROUP_APPEAR_ANIMATION[e](n),l=getAnimation(get(s,"animation",""));if(l){var c=__assign$8(__assign$8(__assign$8({},DEFAULT_ANIMATE_CFG.appear),s),r);a.stopAnimate(),l(a,c,{coordinate:n,minYPoint:o,toAttrs:null})}}}var BACKGROUND_SHAPE="element-background",Element$1=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;n.labelShape=[],n.states=[];var o=e.shapeFactory,s=e.container,l=e.offscreenGroup,c=e.elementIndex,u=e.visible,f=u===void 0?!0:u;return n.shapeFactory=o,n.container=s,n.offscreenGroup=l,n.visible=f,n.elementIndex=c,n}return r.prototype.draw=function(e,n){n===void 0&&(n=!1),this.model=e,this.data=e.data,this.shapeType=this.getShapeType(e),this.drawShape(e,n),this.visible===!1&&this.changeVisible(!1)},r.prototype.update=function(e){var n=this,o=n.shapeFactory,s=n.shape;if(s){this.model=e,this.data=e.data,this.shapeType=this.getShapeType(e),this.setShapeInfo(s,e);var l=this.getOffscreenGroup(),c=o.drawShape(this.shapeType,e,l);c.cfg.data=this.data,c.cfg.origin=e,c.cfg.element=this,this.syncShapeStyle(s,c,this.getStates(),this.getAnimateCfg("update"))}},r.prototype.destroy=function(){var e=this,n=e.shapeFactory,o=e.shape;if(o){var s=this.getAnimateCfg("leave");s?doAnimate(o,s,{coordinate:n.coordinate,toAttrs:__assign$8({},o.attr())}):o.remove(!0)}this.states=[],this.shapeFactory=void 0,this.container=void 0,this.shape=void 0,this.animate=void 0,this.geometry=void 0,this.labelShape=[],this.model=void 0,this.data=void 0,this.offscreenGroup=void 0,this.statesStyle=void 0,a.prototype.destroy.call(this)},r.prototype.changeVisible=function(e){a.prototype.changeVisible.call(this,e),e?(this.shape&&this.shape.show(),this.labelShape&&this.labelShape.forEach(function(n){n.show()})):(this.shape&&this.shape.hide(),this.labelShape&&this.labelShape.forEach(function(n){n.hide()}))},r.prototype.setState=function(e,n){var o=this,s=o.states,l=o.shapeFactory,c=o.model,u=o.shape,f=o.shapeType,d=s.indexOf(e);if(n){if(d>-1)return;s.push(e),(e==="active"||e==="selected")&&(u==null||u.toFront())}else{if(d===-1)return;if(s.splice(d,1),e==="active"||e==="selected"){var g=this.geometry,p=g.sortZIndex,v=g.zIndexReversed,m=v?this.geometry.elements.length-this.elementIndex:this.elementIndex;p?u.setZIndex(m):u.set("zIndex",m)}}var y=l.drawShape(f,c,this.getOffscreenGroup());s.length?this.syncShapeStyle(u,y,s,null):this.syncShapeStyle(u,y,["reset"],null),y.remove(!0);var x={state:e,stateStatus:n,element:this,target:this.container};this.container.emit("statechange",x),propagationDelegate(this.shape,"statechange",x)},r.prototype.clearStates=function(){var e=this,n=this.states;each$1(n,function(o){e.setState(o,!1)}),this.states=[]},r.prototype.hasState=function(e){return this.states.includes(e)},r.prototype.getStates=function(){return this.states},r.prototype.getData=function(){return this.data},r.prototype.getModel=function(){return this.model},r.prototype.getBBox=function(){var e=this,n=e.shape,o=e.labelShape,s={x:0,y:0,minX:0,minY:0,maxX:0,maxY:0,width:0,height:0};return n&&(s=n.getCanvasBBox()),o&&o.forEach(function(l){var c=l.getCanvasBBox();s.x=Math.min(c.x,s.x),s.y=Math.min(c.y,s.y),s.minX=Math.min(c.minX,s.minX),s.minY=Math.min(c.minY,s.minY),s.maxX=Math.max(c.maxX,s.maxX),s.maxY=Math.max(c.maxY,s.maxY)}),s.width=s.maxX-s.minX,s.height=s.maxY-s.minY,s},r.prototype.getStatesStyle=function(){if(!this.statesStyle){var e=this,n=e.shapeType,o=e.geometry,s=e.shapeFactory,l=o.stateOption,c=s.defaultShapeType,u=s.theme[n]||s.theme[c];this.statesStyle=deepMix({},u,l)}return this.statesStyle},r.prototype.getStateStyle=function(e,n){var o=this.getStatesStyle(),s=get(o,[e,"style"],{}),l=s[n]||s;return isFunction$1(l)?l(this):l},r.prototype.getAnimateCfg=function(e){var n=this,o=this.animate;if(o){var s=o[e];return s&&__assign$8(__assign$8({},s),{callback:function(){var l;isFunction$1(s.callback)&&s.callback(),(l=n.geometry)===null||l===void 0||l.emit(GEOMETRY_LIFE_CIRCLE.AFTER_DRAW_ANIMATE)}})}return null},r.prototype.drawShape=function(e,n){var o;n===void 0&&(n=!1);var s=this,l=s.shapeFactory,c=s.container,u=s.shapeType;if(this.shape=l.drawShape(u,e,c),this.shape){this.setShapeInfo(this.shape,e);var f=this.shape.cfg.name;f?isString$1(f)&&(this.shape.cfg.name=["element",f]):this.shape.cfg.name=["element",this.shapeFactory.geometryType];var d=n?"enter":"appear",g=this.getAnimateCfg(d);g&&((o=this.geometry)===null||o===void 0||o.emit(GEOMETRY_LIFE_CIRCLE.BEFORE_DRAW_ANIMATE),doAnimate(this.shape,g,{coordinate:l.coordinate,toAttrs:__assign$8({},this.shape.attr())}))}},r.prototype.getOffscreenGroup=function(){if(!this.offscreenGroup){var e=this.container.getGroupBase();this.offscreenGroup=new e({})}return this.offscreenGroup},r.prototype.setShapeInfo=function(e,n){var o=this;if(e.cfg.origin=n,e.cfg.element=this,e.isGroup()){var s=e.get("children");s.forEach(function(l){o.setShapeInfo(l,n)})}},r.prototype.syncShapeStyle=function(e,n,o,s,l){var c=this,u;if(o===void 0&&(o=[]),l===void 0&&(l=0),!(!e||!n)){var f=e.get("clipShape"),d=n.get("clipShape");if(this.syncShapeStyle(f,d,o,s),e.isGroup())for(var g=e.get("children"),p=n.get("children"),v=0;v<g.length;v++)this.syncShapeStyle(g[v],p[v],o,s,l+v);else{if(!isEmpty(o)&&!isEqual$1(o,["reset"])){var m=e.get("name");isArray$4(m)&&(m=m[1]),each$1(o,function(x){if(n.get("name")!==BACKGROUND_SHAPE){var _=c.getStateStyle(x,m||l);n.attr(_)}})}var y=getReplaceAttrs(e,n);this.animate?s?((u=this.geometry)===null||u===void 0||u.emit(GEOMETRY_LIFE_CIRCLE.BEFORE_DRAW_ANIMATE),doAnimate(e,s,{coordinate:this.shapeFactory.coordinate,toAttrs:y,shapeModel:this.model})):isEmpty(o)?e.attr(y):(e.stopAnimate(),e.animate(y,{duration:300})):e.attr(y)}}},r.prototype.getShapeType=function(e){var n=get(e,"shape");return isArray$4(n)?n[0]:n},r}(Base$1),GEOMETRY_LABELS_MAP={},GEOMETRY_LABELS_LAYOUT_MAP={};function getGeometryLabel(a){return GEOMETRY_LABELS_MAP[a.toLowerCase()]}function registerGeometryLabel(a,r){GEOMETRY_LABELS_MAP[a.toLowerCase()]=r}function getGeometryLabelLayout(a){return GEOMETRY_LABELS_LAYOUT_MAP[a.toLowerCase()]}function registerGeometryLabelLayout(a,r){GEOMETRY_LABELS_LAYOUT_MAP[a.toLowerCase()]=r}var ShapeFactoryBase={coordinate:null,defaultShapeType:null,theme:null,getShapePoints:function(a,r){var e=this.getShape(a);return e.getPoints?e.getPoints(r):this.getDefaultPoints(r)},getShape:function(a){var r=this[a]||this[this.defaultShapeType];return r.coordinate=this.coordinate,r},getDefaultPoints:function(){return[]},getDefaultStyle:function(a){return get(a,[this.defaultShapeType,"default","style"],{})},getMarker:function(a,r){var e=this.getShape(a);if(!e.getMarker){var n=this.defaultShapeType;e=this.getShape(n)}var o=this.theme,s=get(o,[a,"default"],{}),l=e.getMarker(r);return deepMix({},s,l)},drawShape:function(a,r,e){var n=this.getShape(a);return n.draw(r,e)}},ShapeBase$2={coordinate:null,parsePath:function(a){var r=this.coordinate,e=parsePathString$1(a);return r.isPolar?e=convertPolarPath(r,e):e=convertNormalPath(r,e),e},parsePoint:function(a){var r=this.coordinate;return r.convert(a)},parsePoints:function(a){var r=this.coordinate;return a.map(function(e){return r.convert(e)})},draw:function(a,r){}},ShapeFactoryMap={};function registerShapeFactory(a,r){var e=upperFirst(a),n=__assign$8(__assign$8(__assign$8({},ShapeFactoryBase),r),{geometryType:a});return ShapeFactoryMap[e]=n,n}function registerShape(a,r,e){var n=upperFirst(a),o=ShapeFactoryMap[n],s=__assign$8(__assign$8({},ShapeBase$2),e);return o[r]=s,s}function getShapeFactory(a){var r=upperFirst(a);return ShapeFactoryMap[r]}function group(a,r,e){var n,o;if(e===void 0&&(e={}),!r)return[a];var s=groupToMap(a,r),l=[];if(r.length===1&&e[r[0]]){var c=e[r[0]];try{for(var u=__values(c),f=u.next();!f.done;f=u.next()){var d=f.value,g=s["_".concat(d)];g&&l.push(g)}}catch(m){n={error:m}}finally{try{f&&!f.done&&(o=u.return)&&o.call(u)}finally{if(n)throw n.error}}}else for(var p in s)if(s.hasOwnProperty(p)){var v=s[p];l.push(v)}return l}function isModelChange(a,r){return some(["color","shape","size","x","y","isInCircle","data","style","defaultStyle","points","mappingData"],function(e){return!isEqual$1(a[e],r[e])})}function parseFields(a){return isArray$4(a)?a:a.split("*")}function diff$2(a,r){for(var e=[],n=[],o=[],s=new Map,l=0;l<r.length;l++){var c=r[l];a[c]?n.push(c):e.push(c),s.set(c,!0)}return Object.keys(a).forEach(function(u){s.has(u)||o.push(u)}),{added:e,updated:n,removed:o}}var Geometry=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;n.type="base",n.attributes={},n.elements=[],n.elementsMap={},n.animateOption=!0,n.attributeOption={},n.lastElementsMap={},n.generatePoints=!1,n.beforeMappingData=null,n.adjusts={},n.idFields=[],n.hasSorted=!1,n.isCoordinateChanged=!1;var o=e.container,s=e.labelsContainer,l=e.coordinate,c=e.data,u=e.sortable,f=u===void 0?!1:u,d=e.visible,g=d===void 0?!0:d,p=e.theme,v=e.scales,m=v===void 0?{}:v,y=e.scaleDefs,x=y===void 0?{}:y,_=e.intervalPadding,E=e.dodgePadding,S=e.maxColumnWidth,A=e.minColumnWidth,T=e.columnWidthRatio,b=e.roseWidthRatio,C=e.multiplePieWidthRatio,L=e.zIndexReversed,R=e.sortZIndex,I=e.useDeferredLabel;return n.container=o,n.labelsContainer=s,n.coordinate=l,n.data=c,n.sortable=f,n.visible=g,n.userTheme=p,n.scales=m,n.scaleDefs=x,n.intervalPadding=_,n.dodgePadding=E,n.maxColumnWidth=S,n.minColumnWidth=A,n.columnWidthRatio=T,n.roseWidthRatio=b,n.multiplePieWidthRatio=C,n.zIndexReversed=L,n.sortZIndex=R,n.useDeferredLabel=I?typeof I=="number"?I:1/0:null,n}return r.prototype.position=function(e){var n=e;isPlainObject$1(e)||(n={fields:parseFields(e)});var o=get(n,"fields");return o.length===1&&(o.unshift("1"),set(n,"fields",o)),set(this.attributeOption,"position",n),this},r.prototype.color=function(e,n){return this.createAttrOption("color",e,n),this},r.prototype.shape=function(e,n){return this.createAttrOption("shape",e,n),this},r.prototype.size=function(e,n){return this.createAttrOption("size",e,n),this},r.prototype.adjust=function(e){var n=e;return(isString$1(e)||isPlainObject$1(e))&&(n=[e]),each$1(n,function(o,s){isObject$1(o)||(n[s]={type:o})}),this.adjustOption=n,this},r.prototype.style=function(e,n){if(isString$1(e)){var o=parseFields(e);this.styleOption={fields:o,callback:n}}else{var s=e,o=s.fields,l=s.callback,c=s.cfg;o||l||c?this.styleOption=e:this.styleOption={cfg:e}}return this},r.prototype.tooltip=function(e,n){if(isString$1(e)){var o=parseFields(e);this.tooltipOption={fields:o,callback:n}}else this.tooltipOption=e;return this},r.prototype.animate=function(e){return this.animateOption=e,this},r.prototype.label=function(e,n,o){if(isString$1(e)){var s={},l=parseFields(e);s.fields=l,isFunction$1(n)?s.callback=n:isPlainObject$1(n)&&(s.cfg=n),o&&(s.cfg=o),this.labelOption=s}else this.labelOption=e;return this},r.prototype.state=function(e){return this.stateOption=e,this},r.prototype.customInfo=function(e){return this.customOption=e,this},r.prototype.init=function(e){e===void 0&&(e={}),this.setCfg(e),this.initAttributes(),this.processData(this.data),this.adjustScale()},r.prototype.update=function(e){e===void 0&&(e={});var n=e.data,o=e.isDataChanged,s=e.isCoordinateChanged,l=this,c=l.attributeOption,u=l.lastAttributeOption;isEqual$1(c,u)?n&&(o||!isEqual$1(n,this.data))?(this.setCfg(e),this.initAttributes(),this.processData(n)):this.setCfg(e):this.init(e),this.adjustScale(),this.isCoordinateChanged=s},r.prototype.paint=function(e){var n=this;e===void 0&&(e=!1),this.animateOption&&(this.animateOption=deepMix({},getDefaultAnimateCfg(this.type,this.coordinate),this.animateOption)),this.defaultSize=void 0,this.elementsMap={},this.elements=[];var o=this.getOffscreenGroup();o.clear();var s=this.beforeMappingData,l=this.beforeMapping(s);this.dataArray=new Array(l.length);for(var c=0;c<l.length;c++){var u=l[c];this.dataArray[c]=this.mapping(u)}if(this.updateElements(this.dataArray,e),this.lastElementsMap=this.elementsMap,this.canDoGroupAnimation(e)){var f=this.container,d=this.type,g=this.coordinate,p=get(this.animateOption,"appear"),v=this.getYScale(),m=g.convert({x:0,y:v.scale(this.getYMinValue())});doGroupAppearAnimate(f,p,d,g,m)}if(this.labelOption){var y=this.useDeferredLabel,x=(function(){return n.renderLabels(flatten(n.dataArray),e)}).bind(this);if(typeof y=="number"){var _=typeof y=="number"&&y!==1/0?y:0;if(!window.requestIdleCallback)setTimeout(x,_);else{var E=_&&_!==1/0?{timeout:_}:void 0;window.requestIdleCallback(x,E)}}else x()}this.lastAttributeOption=__assign$8({},this.attributeOption),this.visible===!1&&this.changeVisible(!1)},r.prototype.clear=function(){var e=this,n=e.container,o=e.geometryLabel,s=e.offscreenGroup;n&&n.clear(),o&&o.clear(),s&&s.clear(),this.scaleDefs=void 0,this.attributes={},this.scales={},this.elementsMap={},this.lastElementsMap={},this.elements=[],this.adjusts={},this.dataArray=null,this.beforeMappingData=null,this.lastAttributeOption=void 0,this.defaultSize=void 0,this.idFields=[],this.groupScales=void 0,this.hasSorted=!1,this.isCoordinateChanged=!1},r.prototype.destroy=function(){this.clear();var e=this.container;e.remove(!0),this.offscreenGroup&&(this.offscreenGroup.remove(!0),this.offscreenGroup=null),this.geometryLabel&&(this.geometryLabel.destroy(),this.geometryLabel=null),this.theme=void 0,this.shapeFactory=void 0,a.prototype.destroy.call(this)},r.prototype.getGroupScales=function(){return this.groupScales},r.prototype.getAttribute=function(e){return this.attributes[e]},r.prototype.getXScale=function(){return this.getAttribute("position").scales[0]},r.prototype.getYScale=function(){return this.getAttribute("position").scales[1]},r.prototype.getGroupAttributes=function(){var e=[];return each$1(this.attributes,function(n){GROUP_ATTRS.includes(n.type)&&e.push(n)}),e},r.prototype.getDefaultValue=function(e){var n,o=this.getAttribute(e);return o&&isEmpty(o.scales)&&(n=o.values[0]),n},r.prototype.getAttributeValues=function(e,n){for(var o=[],s=e.scales,l=0,c=s.length;l<c;l++){var u=s[l],f=u.field;u.isIdentity?o.push(u.values):o.push(n[f])}return e.mapping.apply(e,__spreadArray$2([],__read(o),!1))},r.prototype.getAdjust=function(e){return this.adjusts[e]},r.prototype.getCoordinate=function(){return this.coordinate},r.prototype.getData=function(){return this.data},r.prototype.getShapeMarker=function(e,n){var o=this.getShapeFactory();return o.getMarker(e,n)},r.prototype.getElementsBy=function(e){return this.elements.filter(function(n){return e(n)})},r.prototype.getElements=function(){return this.elements},r.prototype.getElementId=function(e){e=isArray$4(e)?e[0]:e;var n=e[FIELD_ORIGIN];if(this.idFields.length){for(var o=n[this.idFields[0]],s=1;s<this.idFields.length;s++)o+="-"+n[this.idFields[s]];return o}var l=this.type,c=this.getXScale(),u=this.getYScale(),f=c.field||"x",d=u.field||"y",g=n[d],p;c.type==="identity"?p=c.values[0]:p=n[f];var v;l==="interval"||l==="schema"?v="".concat(p):l==="line"||l==="area"||l==="path"?v=l:v="".concat(p,"-").concat(g);for(var m=this.groupScales,s=0,y=m.length;s<y;s++){var x=m[s],_=x.field;v="".concat(v,"-").concat(n[_])}var E=this.getAdjust("dodge");if(E){var S=E.dodgeBy;S&&(v="".concat(v,"-").concat(n[S]))}return this.getAdjust("jitter")&&(v="".concat(v,"-").concat(e.x,"-").concat(e.y)),v},r.prototype.getScaleFields=function(){var e=[],n=new Map,o=this,s=o.attributeOption,l=o.labelOption,c=o.tooltipOption;for(var u in s)if(s.hasOwnProperty(u)){var f=s[u];f.fields?uniq$1(f.fields,e,n):f.values&&uniq$1(f.values,e,n)}return l&&l.fields&&uniq$1(l.fields,e,n),isObject$1(c)&&c.fields&&uniq$1(c.fields,e,n),e},r.prototype.changeVisible=function(e){a.prototype.changeVisible.call(this,e);for(var n=this.elements,o=0,s=n.length;o<s;o++){var l=n[o];l.changeVisible(e)}e?(this.container&&this.container.show(),this.labelsContainer&&this.labelsContainer.show()):(this.container&&this.container.hide(),this.labelsContainer&&this.labelsContainer.hide())},r.prototype.getFields=function(){var e=new Map,n=[];return Object.values(this.attributeOption).forEach(function(o){var s=(o==null?void 0:o.fields)||[];s.forEach(function(l){e.has(l)||n.push(l),e.set(l,!0)})},[]),n},r.prototype.getGroupFields=function(){for(var e=[],n=new Map,o=0,s=GROUP_ATTRS.length;o<s;o++){var l=GROUP_ATTRS[o],c=this.attributeOption[l];c&&c.fields&&uniq$1(c.fields,e,n)}return e},r.prototype.getXYFields=function(){var e=__read(this.attributeOption.position.fields,2),n=e[0],o=e[1];return[n,o]},r.prototype.getXField=function(){return get(this.getXYFields(),[0])},r.prototype.getYField=function(){return get(this.getXYFields(),[1])},r.prototype.getShapes=function(){return this.elements.map(function(e){return e.shape})},r.prototype.getOffscreenGroup=function(){if(!this.offscreenGroup){var e=this.container.getGroupBase();this.offscreenGroup=new e({})}return this.offscreenGroup},r.prototype.sort=function(e){if(!this.hasSorted)for(var n=this.getXScale(),o=n.field,s=0;s<e.length;s++){var l=e[s];l.sort(function(c,u){return n.translate(c[FIELD_ORIGIN][o])-n.translate(u[FIELD_ORIGIN][o])})}this.hasSorted=!0},r.prototype.adjustScale=function(){var e=this.getYScale();e&&this.getAdjust("stack")&&this.updateStackRange(e,this.beforeMappingData)},r.prototype.getShapeFactory=function(){var e=this.shapeType;if(getShapeFactory(e))return this.shapeFactory||(this.shapeFactory=clone(getShapeFactory(e))),this.shapeFactory.coordinate=this.coordinate,this.shapeFactory.theme=this.theme.geometries[e]||{},this.shapeFactory},r.prototype.createShapePointsCfg=function(e){var n=this.getXScale(),o=this.getYScale(),s=this.normalizeValues(e[n.field],n),l;return o?l=this.normalizeValues(e[o.field],o):l=e.y?e.y:.1,{x:s,y:l,y0:o?o.scale(this.getYMinValue()):void 0}},r.prototype.createElement=function(e,n,o){o===void 0&&(o=!1);var s=this.container,l=this.getDrawCfg(e),c=this.getShapeFactory(),u=new Element$1({shapeFactory:c,container:s,offscreenGroup:this.getOffscreenGroup(),elementIndex:n});return u.animate=this.animateOption,u.geometry=this,u.draw(l,o),u},r.prototype.getDrawCfg=function(e){var n=e[FIELD_ORIGIN],o={mappingData:e,data:n,x:e.x,y:e.y,color:e.color,size:e.size,isInCircle:this.coordinate.isPolar,customInfo:this.customOption},s=e.shape;!s&&this.getShapeFactory()&&(s=this.getShapeFactory().defaultShapeType),o.shape=s;var l=this.theme.geometries[this.shapeType];o.defaultStyle=get(l,[s,"default"],{}).style,!o.defaultStyle&&this.getShapeFactory()&&(o.defaultStyle=this.getShapeFactory().getDefaultStyle(l));var c=this.styleOption;return c&&(o.style=this.getStyleCfg(c,n)),this.generatePoints&&(o.points=e.points,o.nextPoints=e.nextPoints),o},r.prototype.updateElements=function(e,n){var o,s,l,c,u,f;n===void 0&&(n=!1);for(var d=new Map,g=[],p=new Map,v=0,m=0;m<e.length;m++)for(var y=e[m],x=0;x<y.length;x++){var _=y[x],E=this.getElementId(_),S=d.has(E)?"".concat(E,"-").concat(m,"-").concat(x):E;g.push(S),d.set(S,_),p.set(S,v),v++}this.elements=new Array(v);var A=diff$2(this.lastElementsMap,g),T=A.added,b=A.updated,C=A.removed;try{for(var L=__values(T),R=L.next();!R.done;R=L.next()){var E=R.value,_=d.get(E),m=p.get(E),I=this.createElement(_,m,n);this.elements[m]=I,this.elementsMap[E]=I,I.shape&&I.shape.set("zIndex",this.zIndexReversed?this.elements.length-m:m)}}catch($){o={error:$}}finally{try{R&&!R.done&&(s=L.return)&&s.call(L)}finally{if(o)throw o.error}}try{for(var w=__values(b),M=w.next();!M.done;M=w.next()){var E=M.value,I=this.lastElementsMap[E],_=d.get(E),D=this.getDrawCfg(_),O=I.getModel(),m=p.get(E);(this.isCoordinateChanged||isModelChange(D,O))&&(I.animate=this.animateOption,I.update(D)),this.elements[m]=I,this.elementsMap[E]=I,I.shape&&I.shape.set("zIndex",this.zIndexReversed?this.elements.length-m:m)}}catch($){l={error:$}}finally{try{M&&!M.done&&(c=w.return)&&c.call(w)}finally{if(l)throw l.error}}this.container&&this.container.sort();try{for(var F=__values(C),k=F.next();!k.done;k=F.next()){var E=k.value,I=this.lastElementsMap[E];I.animate=this.animateOption,I.destroy()}}catch($){u={error:$}}finally{try{k&&!k.done&&(f=F.return)&&f.call(F)}finally{if(u)throw u.error}}},r.prototype.getLabelType=function(){var e=this,n=e.labelOption,o=e.coordinate,s=e.type,l=o.type,c=o.isTransposed,u=get(n,["cfg","type"]);return u||(l==="polar"?u=c?"pie":"polar":l==="theta"?u="pie":s==="interval"||s==="polygon"?u="interval":u="base"),u},r.prototype.getYMinValue=function(){var e=this.getYScale(),n=e.min,o=e.max,s;return n>=0?s=n:o<=0?s=o:s=0,s},r.prototype.createAttrOption=function(e,n,o){if(isNil(n)||isObject$1(n))isObject$1(n)&&isEqual$1(Object.keys(n),["values"])?set(this.attributeOption,e,{fields:n.values}):set(this.attributeOption,e,n);else{var s={};isNumber$2(n)?s.values=[n]:s.fields=parseFields(n),o&&(isFunction$1(o)?s.callback=o:s.values=o),set(this.attributeOption,e,s)}},r.prototype.initAttributes=function(){var e=this,n=this,o=n.attributes,s=n.attributeOption,l=n.theme,c=n.shapeType;this.groupScales=[];var u={},f=function(p){if(s.hasOwnProperty(p)){var v=s[p];if(!v)return{value:void 0};var m=__assign$8({},v),y=m.callback,x=m.values,_=m.fields,E=_===void 0?[]:_,S=E.map(function(T){var b=e.scales[T];if(!u[T]&&GROUP_ATTRS.includes(p)){var C=inferScaleType(b,get(e.scaleDefs,T),p,e.type);C==="cat"&&(e.groupScales.push(b),u[T]=!0)}return b});m.scales=S,p!=="position"&&S.length===1&&S[0].type==="identity"?m.values=S[0].values:!y&&!x&&(p==="size"?m.values=l.sizes:p==="shape"?m.values=l.shapes[c]||[]:p==="color"&&(S.length?m.values=S[0].values.length<=10?l.colors10:l.colors20:m.values=l.colors10));var A=getAttribute(p);o[p]=new A(m)}};for(var d in s){var g=f(d);if(typeof g=="object")return g.value}},r.prototype.processData=function(e){var n,o;this.hasSorted=!1;for(var s=this.getAttribute("position").scales,l=s.filter(function(C){return C.isCategory}),c=this.groupData(e),u=[],f=0,d=c.length;f<d;f++){for(var g=c[f],p=[],v=0,m=g.length;v<m;v++){var y=g[v],x={};for(var _ in y)x[_]=y[_];x[FIELD_ORIGIN]=y;try{for(var E=(n=void 0,__values(l)),S=E.next();!S.done;S=E.next()){var A=S.value,T=A.field;x[T]=A.translate(x[T])}}catch(C){n={error:C}}finally{try{S&&!S.done&&(o=E.return)&&o.call(E)}finally{if(n)throw n.error}}p.push(x)}u.push(p)}var b=this.adjustData(u);return this.beforeMappingData=b,b},r.prototype.adjustData=function(e){var n=this.adjustOption,o=this,s=o.intervalPadding,l=o.dodgePadding,c=o.theme,u=this.maxColumnWidth||c.maxColumnWidth,f=this.minColumnWidth||c.minColumnWidth,d=this.columnWidthRatio||c.columnWidthRatio,g=e;if(n){var p=this.getXScale(),v=this.getYScale(),m=p.field,y=v?v.field:null,x=getXDimensionLength(this.coordinate),_=p.values.length,E=this.getAttribute("size"),S=void 0;E&&(S=E.values[0]);for(var A=0,T=n.length;A<T;A++){var b=n[A],C=__assign$8({xField:m,yField:y,intervalPadding:s,dodgePadding:l,xDimensionLength:x,groupNum:_,defaultSize:S,maxColumnWidth:u,minColumnWidth:f,columnWidthRatio:d},b),L=b.type;if(L==="dodge"){var R=[];if(p.isCategory||p.type==="identity")R.push("x");else if(!v)R.push("y");else throw new Error("dodge is not support linear attribute, please use category attribute!");C.adjustNames=R,C.dodgeRatio=d}else if(L==="stack"){var I=this.coordinate;if(!v){C.height=I.getHeight();var w=this.getDefaultValue("size")||3;C.size=w}!I.isTransposed&&isNil(C.reverseOrder)&&(C.reverseOrder=!0)}var M=getAdjust(L);C.dimValuesMap={},p&&p.values&&(C.dimValuesMap[p.field]=p.values.map(function(O){return p.translate(O)}));var D=new M(C);g=D.process(g),this.adjusts[L]=D}}return g},r.prototype.groupData=function(e){for(var n=this.getGroupScales(),o=this.scaleDefs,s={},l=[],c=0;c<n.length;c++){var u=n[c],f=u.field;l.push(f),get(o,[f,"values"])&&(s[f]=o[f].values)}return group(e,l,s)},r.prototype.updateStackRange=function(e,n){for(var o=flatten(n),s=e.field,l=e.min,c=e.max,u=0;u<o.length;u++){var f=o[u],d=Math.min.apply(null,f[s]),g=Math.max.apply(null,f[s]);d<l&&(l=d),g>c&&(c=g)}var p=this.scaleDefs,v={};l<e.min&&!get(p,[s,"min"])&&(v.min=l),c>e.max&&!get(p,[s,"max"])&&(v.max=c),e.change(v)},r.prototype.beforeMapping=function(e){var n=e;if(this.sortable&&this.sort(n),this.generatePoints)for(var o=0,s=n.length;o<s;o++){var l=n[o];this.generateShapePoints(l);var c=n[o+1];c&&(this.generateShapePoints(c),l[0].nextPoints=c[0].points)}return n},r.prototype.generateShapePoints=function(e){for(var n=this.getShapeFactory(),o=this.getAttribute("shape"),s=0;s<e.length;s++){var l=e[s],c=this.createShapePointsCfg(l),u=o?this.getAttributeValues(o,l):null,f=n.getShapePoints(u,c);l.points=f}},r.prototype.normalizeValues=function(e,n){var o=[];if(isArray$4(e))for(var s=0;s<e.length;s++){var l=e[s];o.push(n.scale(l))}else o=n.scale(e);return o},r.prototype.mapping=function(e){for(var n=this.attributes,o=[],s=0;s<e.length;s++){var l=e[s],c={_origin:l[FIELD_ORIGIN],points:l.points,nextPoints:l.nextPoints};for(var u in n)if(n.hasOwnProperty(u)){var f=n[u],d=f.names,g=this.getAttributeValues(f,l);if(d.length>1)for(var p=0;p<g.length;p+=1){var v=g[p],m=d[p];c[m]=isArray$4(v)&&v.length===1?v[0]:v}else c[d[0]]=g.length===1?g[0]:g}this.convertPoint(c),o.push(c)}return o},r.prototype.convertPoint=function(e){var n=e.x,o=e.y,s,l,c,u=this.coordinate;if(isArray$4(n)&&isArray$4(o)){s=[],l=[];for(var f=0,d=0,g=n.length,p=o.length;f<g&&d<p;f+=1,d+=1)c=u.convert({x:n[f],y:o[d]}),s.push(c.x),l.push(c.y)}else if(isArray$4(o)){l=[];for(var v=0;v<o.length;v++){var m=o[v];c=u.convert({x:n,y:m}),s&&s!==c.x?(isArray$4(s)||(s=[s]),s.push(c.x)):s=c.x,l.push(c.y)}}else if(isArray$4(n)){s=[];for(var v=0;v<n.length;v++){var y=n[v];c=u.convert({x:y,y:o}),l&&l!==c.y?(isArray$4(l)||(l=[l]),l.push(c.y)):l=c.y,s.push(c.x)}}else{var x=u.convert({x:n,y:o});s=x.x,l=x.y}e.x=s,e.y=l},r.prototype.getStyleCfg=function(e,n){var o=e.fields,s=o===void 0?[]:o,l=e.callback,c=e.cfg;if(c)return c;var u=s.map(function(f){return n[f]});return l.apply(void 0,__spreadArray$2([],__read(u),!1))},r.prototype.setCfg=function(e){var n=this,o=e.coordinate,s=e.data,l=e.theme,c=e.scaleDefs;o&&(this.coordinate=o),s&&(this.data=s),c&&(this.scaleDefs=c,this.idFields=[],each$1(c,function(u,f){u&&u.key&&n.idFields.push(f)})),l&&(this.theme=this.userTheme?deepMix({},l,this.userTheme):l)},r.prototype.renderLabels=function(e,n){return n===void 0&&(n=!1),__awaiter(this,void 0,void 0,function(){var o,s,l,c,u,f,d,g,p,v,m,y,x=this;return __generator(this,function(_){switch(_.label){case 0:return o=this.geometryLabel,this.emit(GEOMETRY_LIFE_CIRCLE.BEFORE_RENDER_LABEL),o||(s=this.getLabelType(),l=getGeometryLabel(s),o=new l(this),this.geometryLabel=o),[4,o.render(e,n)];case 1:_.sent(),c=o.labelsRenderer.shapesMap,u=new Map,each$1(c,function(E,S){for(var A=E.getChildren()||[],T=0;T<A.length;T++){var b=A[T],C=x.elementsMap[b.get("elementId")||S.split(" ")[0]];if(C){b.cfg.name=["element","label"],b.cfg.element=C;var L=u.get(C)||new Set;L.add(E),u.set(C,L)}}});try{for(f=__values(u.entries()),d=f.next();!d.done;d=f.next())g=__read(d.value,2),p=g[0],v=g[1],p.labelShape=__spreadArray$2([],__read(v),!1)}catch(E){m={error:E}}finally{try{d&&!d.done&&(y=f.return)&&y.call(f)}finally{if(m)throw m.error}}return this.emit(GEOMETRY_LIFE_CIRCLE.AFTER_RENDER_LABEL),[2]}})})},r.prototype.canDoGroupAnimation=function(e){return!e&&this.animateOption&&(get(this.animateOption,"appear")===void 0||get(this.animateOption,"appear")&&get(this.animateOption,["appear","animation"])===void 0)},r}(Base$1),transform$4=transform$6;function translate(a,r,e){var n=transform$4(a.getMatrix(),[["t",r,e]]);a.setMatrix(n)}function getRotateMatrix(a,r){var e=a.attr(),n=e.x,o=e.y,s=transform$4(a.getMatrix(),[["t",-n,-o],["r",r],["t",n,o]]);return s}function rotate$1(a,r){var e=getRotateMatrix(a,r);a.setMatrix(e)}function zoom(a,r){var e=a.getBBox(),n=(e.minX+e.maxX)/2,o=(e.minY+e.maxY)/2;a.applyToMatrix([n,o,1]);var s=transform$4(a.getMatrix(),[["t",-n,-o],["s",r,r],["t",n,o]]);a.setMatrix(s)}function findLabelTextShape(a){return a.find(function(r){return r.get("type")==="text"})}function getLabelBackgroundInfo(a,r,e){e===void 0&&(e=[0,0,0,0]);var n=a&&a.getChildren()[0];if(n){var o=n.clone();r!=null&&r.rotate&&rotate$1(o,-r.rotate);var s=o.getCanvasBBox(),l=s.x,c=s.y,u=s.width,f=s.height;o.destroy();var d=e;return isNil(d)?d=[2,2,2,2]:isNumber$2(d)&&(d=new Array(4).fill(d)),{x:l-d[3],y:c-d[0],width:u+d[1]+d[3],height:f+d[0]+d[2],rotation:(r==null?void 0:r.rotate)||0}}return{x:0,y:0,width:0,height:0,rotation:0}}function getOverlapArea$2(a,r,e){e===void 0&&(e=0);var n=Math.max(0,Math.min(a.x+a.width+e,r.x+r.width+e)-Math.max(a.x-e,r.x-e)),o=Math.max(0,Math.min(a.y+a.height+e,r.y+r.height+e)-Math.max(a.y-e,r.y-e));return n*o}function checkShapeOverlap$2(a,r){var e=a.getBBox();return some(r,function(n){var o=n.getBBox();return getOverlapArea$2(e,o,2)>0})}function updateLabel(a,r,e){var n=e.data,o=e.origin,s=e.animateCfg,l=e.coordinate,c=get(s,"update");a.set("data",n),a.set("origin",o),a.set("animateCfg",s),a.set("coordinate",l),a.set("visible",r.get("visible")),(a.getChildren()||[]).forEach(function(u,f){var d=r.getChildByIndex(f);if(!d)a.removeChild(u),u.remove(!0);else{u.set("data",n),u.set("origin",o),u.set("animateCfg",s),u.set("coordinate",l);var g=getReplaceAttrs(u,d);c?doAnimate(u,c,{toAttrs:g,coordinate:l}):u.attr(g),d.isGroup()&&updateLabel(u,d,e)}}),each$1(r.getChildren(),function(u,f){f>=a.getCount()&&(u.destroyed||a.add(u))})}var Labels=function(){function a(r){this.shapesMap={};var e=r.layout,n=r.container;this.layout=e,this.container=n}return a.prototype.render=function(r,e,n){return n===void 0&&(n=!1),__awaiter(this,void 0,void 0,function(){var o,s,l,c,u,f,d,g,p=this;return __generator(this,function(v){switch(v.label){case 0:if(o={},s=this.createOffscreenGroup(),!r.length)return[3,2];try{for(l=__values(r),c=l.next();!c.done;c=l.next())u=c.value,u&&(o[u.id]=this.renderLabel(u,s))}catch(m){d={error:m}}finally{try{c&&!c.done&&(g=l.return)&&g.call(l)}finally{if(d)throw d.error}}return[4,this.doLayout(r,e,o)];case 1:v.sent(),this.renderLabelLine(r,o),this.renderLabelBackground(r,o),this.adjustLabel(r,o),v.label=2;case 2:return f=this.shapesMap,each$1(o,function(m,y){if(m.destroyed)delete o[y];else{if(f[y]){var x=m.get("data"),_=m.get("origin"),E=m.get("coordinate"),S=m.get("animateCfg"),A=f[y];updateLabel(A,o[y],{data:x,origin:_,animateCfg:S,coordinate:E}),o[y]=A}else{if(p.container.destroyed)return;p.container.add(m);var T=get(m.get("animateCfg"),n?"enter":"appear");T&&doAnimate(m,T,{toAttrs:__assign$8({},m.attr()),coordinate:m.get("coordinate")})}delete f[y]}}),each$1(f,function(m){var y=get(m.get("animateCfg"),"leave");y?doAnimate(m,y,{toAttrs:null,coordinate:m.get("coordinate")}):m.remove(!0)}),this.shapesMap=o,s.destroy(),[2]}})})},a.prototype.clear=function(){this.container.clear(),this.shapesMap={}},a.prototype.destroy=function(){this.container.destroy(),this.shapesMap=null},a.prototype.renderLabel=function(r,e){var n=r.id,o=r.elementId,s=r.data,l=r.mappingData,c=r.coordinate,u=r.animate,f=r.content,d=r.capture,g={id:n,elementId:o,capture:d,data:s,origin:__assign$8(__assign$8({},l),{data:l[FIELD_ORIGIN]}),coordinate:c},p=e.addGroup(__assign$8({name:"label",animateCfg:this.animate===!1||u===null||u===!1?!1:deepMix({},this.animate,u)},g)),v;if(f.isGroup&&f.isGroup()||f.isShape&&f.isShape()){var m=f.getCanvasBBox(),y=m.width,x=m.height,_=get(r,"textAlign","left"),E=r.x,S=r.y-x/2;_==="center"?E=E-y/2:(_==="right"||_==="end")&&(E=E-y),translate(f,E,S),v=f,p.add(f)}else{var A=get(r,["style","fill"]);v=p.addShape("text",__assign$8({attrs:__assign$8(__assign$8({x:r.x,y:r.y,textAlign:r.textAlign,textBaseline:get(r,"textBaseline","middle"),text:r.content},r.style),{fill:isNull(A)?r.color:A})},g))}return r.rotate&&rotate$1(v,r.rotate),p},a.prototype.doLayout=function(r,e,n){return __awaiter(this,void 0,void 0,function(){var o,s=this;return __generator(this,function(l){switch(l.label){case 0:return this.layout?(o=isArray$4(this.layout)?this.layout:[this.layout],[4,Promise.all(o.map(function(c){var u=getGeometryLabelLayout(get(c,"type",""));if(u){var f=[],d=[];return each$1(n,function(g,p){f.push(g),d.push(e[g.get("elementId")])}),u(r,f,d,s.region,c.cfg)}}))]):[3,2];case 1:l.sent(),l.label=2;case 2:return[2]}})})},a.prototype.renderLabelLine=function(r,e){each$1(r,function(n){var o=get(n,"coordinate");if(!(!n||!o)){var s=o.getCenter(),l=o.getRadius();if(n.labelLine){var c=get(n,"labelLine",{}),u=n.id,f=c.path;if(!f){var d=polarToCartesian(s.x,s.y,l,n.angle);f=[["M",d.x,d.y],["L",n.x,n.y]]}var g=e[u];g.destroyed||g.addShape("path",{capture:!1,attrs:__assign$8({path:f,stroke:n.color?n.color:get(n,["style","fill"],"#000"),fill:null},c.style),id:u,origin:n.mappingData,data:n.data,coordinate:n.coordinate})}}})},a.prototype.renderLabelBackground=function(r,e){each$1(r,function(n){var o=get(n,"coordinate"),s=get(n,"background");if(!(!s||!o)){var l=n.id,c=e[l];if(!c.destroyed){var u=c.getChildren()[0];if(u){var f=getLabelBackgroundInfo(c,n,s.padding),d=f.rotation,g=__rest$1(f,["rotation"]),p=c.addShape("rect",{attrs:__assign$8(__assign$8({},g),s.style||{}),id:l,origin:n.mappingData,data:n.data,coordinate:n.coordinate});if(p.setZIndex(-1),d){var v=u.getMatrix();p.setMatrix(v)}}}}})},a.prototype.createOffscreenGroup=function(){var r=this.container,e=r.getGroupBase(),n=new e({});return n},a.prototype.adjustLabel=function(r,e){each$1(r,function(n){if(n){var o=n.id,s=e[o];if(!s.destroyed){var l=s.findAll(function(c){return c.get("type")!=="path"});each$1(l,function(c){c&&(n.offsetX&&c.attr("x",c.attr("x")+n.offsetX),n.offsetY&&c.attr("y",c.attr("y")+n.offsetY))})}}})},a}();function avg(a){var r=0;return each$1(a,function(e){r+=e}),r/a.length}var GeometryLabel=function(){function a(r){this.geometry=r}return a.prototype.getLabelItems=function(r){var e=this,n=[],o=this.getLabelCfgs(r);return each$1(r,function(s,l){var c=o[l];if(!c||isNil(s.x)||isNil(s.y)){n.push(null);return}var u=isArray$4(c.content)?c.content:[c.content];c.content=u;var f=u.length;each$1(u,function(d,g){if(isNil(d)||d===""){n.push(null);return}var p=__assign$8(__assign$8({},c),e.getLabelPoint(c,s,g));p.textAlign||(p.textAlign=e.getLabelAlign(p,g,f)),p.offset<=0&&(p.labelLine=null),n.push(p)})}),n},a.prototype.render=function(r,e){return e===void 0&&(e=!1),__awaiter(this,void 0,void 0,function(){var n,o,s;return __generator(this,function(l){switch(l.label){case 0:return n=this.getLabelItems(r),o=this.getLabelsRenderer(),s=this.getGeometryShapes(),[4,o.render(n,s,e)];case 1:return l.sent(),[2]}})})},a.prototype.clear=function(){var r=this.labelsRenderer;r&&r.clear()},a.prototype.destroy=function(){var r=this.labelsRenderer;r&&r.destroy(),this.labelsRenderer=null},a.prototype.getCoordinate=function(){return this.geometry.coordinate},a.prototype.getDefaultLabelCfg=function(r,e){var n=this.geometry,o=n.type,s=n.theme;return o==="polygon"||o==="interval"&&e==="middle"||r<0&&!["line","point","path"].includes(o)?get(s,"innerLabels",{}):get(s,"labels",{})},a.prototype.getThemedLabelCfg=function(r){var e=this.geometry,n=this.getDefaultLabelCfg(),o=e.type,s=e.theme,l;return o==="polygon"||r.offset<0&&!["line","point","path"].includes(o)?l=deepMix({},n,s.innerLabels,r):l=deepMix({},n,s.labels,r),l},a.prototype.setLabelPosition=function(r,e,n,o){},a.prototype.getLabelOffset=function(r){var e=this.getCoordinate(),n=this.getOffsetVector(r);return e.isTransposed?n[0]:n[1]},a.prototype.getLabelOffsetPoint=function(r,e,n){var o=r.offset,s=this.getCoordinate(),l=s.isTransposed,c=l?"x":"y",u=l?1:-1,f={x:0,y:0};return e>0||n===1?f[c]=o*u:f[c]=o*u*-1,f},a.prototype.getLabelPoint=function(r,e,n){var o=this.getCoordinate(),s=r.content.length;function l(x,_,E){E===void 0&&(E=!1);var S=x;return isArray$4(S)&&(r.content.length===1?E?S=avg(S):S.length<=2?S=S[x.length-1]:S=avg(S):S=S[_]),S}var c={content:r.content[n],x:0,y:0,start:{x:0,y:0},color:"#fff"},u=isArray$4(e.shape)?e.shape[0]:e.shape,f=u==="funnel"||u==="pyramid";if(this.geometry.type==="polygon"){var d=getPolygonCentroid(e.x,e.y);c.x=d[0],c.y=d[1]}else this.geometry.type==="interval"&&!f?(c.x=l(e.x,n,!0),c.y=l(e.y,n)):(c.x=l(e.x,n),c.y=l(e.y,n));if(f){var g=get(e,"nextPoints"),p=get(e,"points");if(g){var v=o.convert(p[1]),m=o.convert(g[1]);c.x=(v.x+m.x)/2,c.y=(v.y+m.y)/2}else if(u==="pyramid"){var v=o.convert(p[1]),m=o.convert(p[2]);c.x=(v.x+m.x)/2,c.y=(v.y+m.y)/2}}r.position&&this.setLabelPosition(c,e,n,r.position);var y=this.getLabelOffsetPoint(r,n,s);return c.start={x:c.x,y:c.y},c.x+=y.x,c.y+=y.y,c.color=e.color,c},a.prototype.getLabelAlign=function(r,e,n){var o="center",s=this.getCoordinate();if(s.isTransposed){var l=r.offset;l<0?o="right":l===0?o="center":o="left",n>1&&e===0&&(o==="right"?o="left":o==="left"&&(o="right"))}return o},a.prototype.getLabelId=function(r){var e=this.geometry,n=e.type,o=e.getXScale(),s=e.getYScale(),l=r[FIELD_ORIGIN],c=e.getElementId(r);return n==="line"||n==="area"?c+=" ".concat(l[o.field]):n==="path"&&(c+=" ".concat(l[o.field],"-").concat(l[s.field])),c},a.prototype.getLabelsRenderer=function(){var r=this.geometry,e=r.labelsContainer,n=r.labelOption,o=r.canvasRegion,s=r.animateOption,l=this.geometry.coordinate,c=this.labelsRenderer;return c||(c=new Labels({container:e,layout:get(n,["cfg","layout"],{type:this.defaultLayout})}),this.labelsRenderer=c),c.region=o,c.animate=s?getDefaultAnimateCfg("label",l):!1,c},a.prototype.getLabelCfgs=function(r){var e=this,n=this.geometry,o=n.labelOption,s=n.scales,l=n.coordinate,c=o,u=c.fields,f=c.callback,d=c.cfg,g=u.map(function(v){return s[v]}),p=[];return each$1(r,function(v,m){var y=v[FIELD_ORIGIN],x=e.getLabelText(y,g),_;if(f){var E=u.map(function(C){return y[C]});if(_=f.apply(void 0,__spreadArray$2([],__read(E),!1)),isNil(_)){p.push(null);return}}var S=__assign$8(__assign$8({id:e.getLabelId(v),elementId:e.geometry.getElementId(v),data:y,mappingData:v,coordinate:l},d),_);isFunction$1(S.position)&&(S.position=S.position(y,v,m));var A=e.getLabelOffset(S.offset||0),T=e.getDefaultLabelCfg(A,S.position);S=deepMix({},T,S),S.offset=e.getLabelOffset(S.offset||0);var b=S.content;isFunction$1(b)?S.content=b(y,v,m):isUndefined$1(b)&&(S.content=x[0]),p.push(S)}),p},a.prototype.getLabelText=function(r,e){var n=[];return each$1(e,function(o){var s=r[o.field];isArray$4(s)?s=s.map(function(l){return o.getText(l)}):s=o.getText(s),isNil(s)||s===""?n.push(null):n.push(s)}),n},a.prototype.getOffsetVector=function(r){r===void 0&&(r=0);var e=this.getCoordinate(),n=0;return isNumber$2(r)&&(n=r),e.isTransposed?e.applyMatrix(n,0):e.applyMatrix(0,n)},a.prototype.getGeometryShapes=function(){var r=this.geometry,e={};return each$1(r.elementsMap,function(n,o){e[o]=n.shape}),each$1(r.getOffscreenGroup().getChildren(),function(n){var o=r.getElementId(n.get("origin").mappingData);e[o]=n}),e},a}();function getMappingValue(a,r,e){if(!a)return e;var n;if(a.callback&&a.callback.length>1){var o=Array(a.callback.length-1).fill("");n=a.mapping.apply(a,__spreadArray$2([r],__read(o),!1)).join("")}else n=a.mapping(r).join("");return n||e}var MarkerSymbols={hexagon:function(a,r,e){var n=e/2*Math.sqrt(3);return[["M",a,r-e],["L",a+n,r-e/2],["L",a+n,r+e/2],["L",a,r+e],["L",a-n,r+e/2],["L",a-n,r-e/2],["Z"]]},bowtie:function(a,r,e){var n=e-1.5;return[["M",a-e,r-n],["L",a+e,r+n],["L",a+e,r-n],["L",a-e,r+n],["Z"]]},cross:function(a,r,e){return[["M",a-e,r-e],["L",a+e,r+e],["M",a+e,r-e],["L",a-e,r+e]]},tick:function(a,r,e){return[["M",a-e/2,r-e],["L",a+e/2,r-e],["M",a,r-e],["L",a,r+e],["M",a-e/2,r+e],["L",a+e/2,r+e]]},plus:function(a,r,e){return[["M",a-e,r],["L",a+e,r],["M",a,r-e],["L",a,r+e]]},hyphen:function(a,r,e){return[["M",a-e,r],["L",a+e,r]]},line:function(a,r,e){return[["M",a,r-e],["L",a,r+e]]}},STROKES_SYMBOLS=["line","cross","tick","plus","hyphen"];function handleUserMarkerStyle(a,r){return isFunction$1(r)?r(a):deepMix({},a,r)}function adpatorMarkerStyle(a,r){var e=a.symbol;if(isString$1(e)&&STROKES_SYMBOLS.indexOf(e)!==-1){var n=get(a,"style",{}),o=get(n,"lineWidth",1),s=n.stroke||n.fill||r;a.style=deepMix({},a.style,{lineWidth:o,stroke:s,fill:null})}}function setMarkerSymbol(a){var r=a.symbol;isString$1(r)&&MarkerSymbols[r]&&(a.symbol=MarkerSymbols[r])}function getLegendLayout(a){return a.startsWith(DIRECTION.LEFT)||a.startsWith(DIRECTION.RIGHT)?"vertical":"horizontal"}function getLegendItems(a,r,e,n,o){var s=e.getScale(e.type);if(s.isCategory){var l=s.field,c=r.getAttribute("color"),u=r.getAttribute("shape"),f=a.getTheme().defaultColor,d=r.coordinate.isPolar;return s.getTicks().map(function(g,p){var v,m=g.text,y=g.value,x=m,_=s.invert(y),E=a.filterFieldData(l,[(v={},v[l]=_,v)]).length===0;each$1(a.views,function(C){var L;C.filterFieldData(l,[(L={},L[l]=_,L)]).length||(E=!0)});var S=getMappingValue(c,_,f),A=getMappingValue(u,_,"point"),T=r.getShapeMarker(A,{color:S,isInPolar:d}),b=o;return isFunction$1(b)&&(b=b(x,p,__assign$8({name:x,value:_},deepMix({},n,T)))),T=deepMix({},n,T,omit(__assign$8({},b),["style"])),adpatorMarkerStyle(T,S),b&&b.style&&(T.style=handleUserMarkerStyle(T.style,b.style)),setMarkerSymbol(T),{id:_,name:x,value:_,marker:T,unchecked:E}})}return[]}function getCustomLegendItems(a,r,e){return e.map(function(n,o){var s=r;isFunction$1(s)&&(s=s(n.name,o,deepMix({},a,n)));var l=isFunction$1(n.marker)?n.marker(n.name,o,deepMix({},a,n)):n.marker,c=deepMix({},a,s,l);return setMarkerSymbol(c),n.marker=c,n})}function getLegendThemeCfg(a,r){var e=get(a,["components","legend"],{});return deepMix({},get(e,["common"],{}),deepMix({},get(e,[r],{})))}function isValueEmpty(a){return a?!1:a==null||isNaN(a)}function isYNil(a){if(isArray$4(a))return isValueEmpty(a[1].y);var r=a.y;return isArray$4(r)?isValueEmpty(r[0]):isValueEmpty(r)}function getPathPoints(a,r,e){if(r===void 0&&(r=!1),e===void 0&&(e=!0),!a.length||a.length===1&&!e)return[];if(r){for(var n=[],o=0,s=a.length;o<s;o++){var l=a[o];isYNil(l)||n.push(l)}return[n]}for(var c=[],u=[],o=0,s=a.length;o<s;o++){var l=a[o];isYNil(l)?u.length&&(u.length===1&&!e||c.push(u),u=[]):u.push(l)}return u.length&&c.push(u),c}function getViolinPath(a){for(var r=[],e=0;e<a.length;e++){var n=a[e];if(n){var o=e===0?"M":"L";r.push([o,n.x,n.y])}}var s=a[0];return s&&(r.push(["L",s.x,s.y]),r.push(["z"])),r}function getSmoothViolinPath(a){for(var r=a.length/2,e=[],n=[],o=0;o<a.length;o++)o<r?e.push(a[o]):n.push(a[o]);var s=getSplinePath$1(e,!1),l=getSplinePath$1(n,!1);n.length&&s.push(["L",n[0].x,n[0].y]),l.shift();var c=s.concat(l);return e.length&&c.push(["L",e[0].x,e[0].y]),c.push(["z"]),c}function getStyle(a,r,e,n){n===void 0&&(n="");var o=a.style,s=o===void 0?{}:o,l=a.defaultStyle,c=a.color,u=a.size,f=__assign$8(__assign$8({},l),s);return c&&(r&&(s.stroke||(f.stroke=c)),e&&(s.fill||(f.fill=c))),n&&isNil(s[n])&&!isNil(u)&&(f[n]=u),f}function getBackgroundRectStyle(a){return deepMix({},{fill:"#CCD6EC",fillOpacity:.3},get(a,["background","style"]))}function splitPoints(a){var r=a.x,e=isArray$4(a.y)?a.y:[a.y];return e.map(function(n,o){return{x:isArray$4(r)?r[o]:r,y:n}})}var LineSymbols={line:function(a,r,e){return[["M",a-e,r],["L",a+e,r]]},dot:function(a,r,e){return[["M",a-e,r],["L",a+e,r]]},dash:function(a,r,e){return[["M",a-e,r],["L",a+e,r]]},smooth:function(a,r,e){return[["M",a-e,r],["A",e/2,e/2,0,1,1,a,r],["A",e/2,e/2,0,1,0,a+e,r]]},hv:function(a,r,e){return[["M",a-e-1,r-2.5],["L",a,r-2.5],["L",a,r+2.5],["L",a+e+1,r+2.5]]},vh:function(a,r,e){return[["M",a-e-1,r+2.5],["L",a,r+2.5],["L",a,r-2.5],["L",a+e+1,r-2.5]]},hvh:function(a,r,e){return[["M",a-(e+1),r+2.5],["L",a-e/2,r+2.5],["L",a-e/2,r-2.5],["L",a+e/2,r-2.5],["L",a+e/2,r+2.5],["L",a+e+1,r+2.5]]},vhv:function(a,r){return[["M",a-5,r+2.5],["L",a-5,r],["L",a,r],["L",a,r-3],["L",a,r+3],["L",a+6.5,r+3]]}};function getLineMarker(a,r){var e=a.color;return{symbol:LineSymbols[r],style:{lineWidth:2,r:6,stroke:e}}}function getShapeAttrs$1(a,r,e){for(var n=a.isStack,o=a.connectNulls,s=a.isInCircle,l=a.showSinglePoint,c=getStyle(a,!0,!1,"lineWidth"),u=getPathPoints(a.points,o,l),f=[],d=0,g=u.length;d<g;d++){var p=u[d];f=f.concat(getPath$3(p,s,n,r,e,c))}return c.path=f,c}function getSinglePath(a,r,e,n,o){if(a.length===1)return[["M",a[0].x,a[0].y-o.lineWidth/2],["L",a[0].x,a[0].y],["L",a[0].x,a[0].y+o.lineWidth/2]];var s;return e?(r&&a.length&&a.push({x:a[0].x,y:a[0].y}),s=getSplinePath$1(a,!1,n)):(s=getLinePath(a,!1),r&&s.push(["Z"])),s}function getRangePath(a,r,e,n,o,s){var l=[],c=[];each$1(a,function(d){var g=splitPoints(d);l.push(g[1]),c.push(g[0])});var u=getSinglePath(l,r,n,o,s),f=getSinglePath(c,r,n,o,s);return e?u:u.concat(f)}function getPath$3(a,r,e,n,o,s){if(a.length){var l=a[0];return isArray$4(l.y)?getRangePath(a,r,e,n,o,s):getSinglePath(a,r,n,o,s)}return[]}registerShapeFactory("line",{defaultShapeType:"line"});each$1(["line","dot","dash","smooth"],function(a){registerShape("line",a,{draw:function(r,e){var n=a==="smooth",o;if(n){var s=this.coordinate,l=s.start,c=s.end;o=[[l.x,c.y],[c.x,l.y]]}var u=getShapeAttrs$1(r,n,o),f=e.addShape({type:"path",attrs:u,name:"line",capture:!n});return f},getMarker:function(r){return getLineMarker(r,a)}})});var VERSION="4.2.10",Util={getLegendItems,translate,rotate:rotate$1,zoom,transform:transform$4,getAngle:getAngle$1,getSectorPath,polarToCartesian,getDelegationObject,getTooltipItems,getMappingValue,getPath:getPath$3,getPathPoints},WHITE_COLORS={100:"#000",95:"#0D0D0D",85:"#262626",65:"#595959",45:"#8C8C8C",25:"#BFBFBF",15:"#D9D9D9",6:"#F0F0F0"},BLACK_COLORS={100:"#FFFFFF",95:"#F2F2F2",85:"#D9D9D9",65:"#A6A6A6",45:"#737373",25:"#404040",15:"#262626",6:"#0F0F0F"},QUALITATIVE_10=["#5B8FF9","#5AD8A6","#5D7092","#F6BD16","#E86452","#6DC8EC","#945FB9","#FF9845","#1E9493","#FF99C3"],QUALITATIVE_20=["#5B8FF9","#CDDDFD","#5AD8A6","#CDF3E4","#5D7092","#CED4DE","#F6BD16","#FCEBB9","#E86452","#F8D0CB","#6DC8EC","#D3EEF9","#945FB9","#DECFEA","#FF9845","#FFE0C7","#1E9493","#BBDEDE","#FF99C3","#FFE0ED"],SINGLE_SEQUENCE=["#B8E1FF","#9AC5FF","#7DAAFF","#5B8FF9","#3D76DD","#085EC0","#0047A5","#00318A","#001D70"],createDarkStyleSheet=function(a){a===void 0&&(a={});var r=a.paletteQualitative10,e=r===void 0?QUALITATIVE_10:r,n=a.paletteQualitative20,o=n===void 0?QUALITATIVE_20:n,s=a.brandColor,l=s===void 0?e[0]:s,c={backgroundColor:"#141414",brandColor:l,subColor:"rgba(255,255,255,0.05)",paletteQualitative10:e,paletteQualitative20:o,paletteSemanticRed:"#F4664A",paletteSemanticGreen:"#30BF78",paletteSemanticYellow:"#FAAD14",paletteSequence:SINGLE_SEQUENCE,fontFamily:`"Segoe UI", Roboto, "Helvetica Neue", Arial,
    "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
    "Noto Color Emoji"`,axisLineBorderColor:BLACK_COLORS[25],axisLineBorder:1,axisLineDash:null,axisTitleTextFillColor:BLACK_COLORS[65],axisTitleTextFontSize:12,axisTitleTextLineHeight:12,axisTitleTextFontWeight:"normal",axisTitleSpacing:12,axisDescriptionIconFillColor:WHITE_COLORS[85],axisTickLineBorderColor:BLACK_COLORS[25],axisTickLineLength:4,axisTickLineBorder:1,axisSubTickLineBorderColor:BLACK_COLORS[15],axisSubTickLineLength:2,axisSubTickLineBorder:1,axisLabelFillColor:BLACK_COLORS[45],axisLabelFontSize:12,axisLabelLineHeight:12,axisLabelFontWeight:"normal",axisLabelOffset:8,axisGridBorderColor:BLACK_COLORS[15],axisGridBorder:1,axisGridLineDash:null,legendTitleTextFillColor:BLACK_COLORS[45],legendTitleTextFontSize:12,legendTitleTextLineHeight:21,legendTitleTextFontWeight:"normal",legendMarkerColor:QUALITATIVE_10[0],legendMarkerSpacing:8,legendMarkerSize:4,legendCircleMarkerSize:4,legendSquareMarkerSize:4,legendLineMarkerSize:5,legendItemNameFillColor:BLACK_COLORS[65],legendItemNameFontSize:12,legendItemNameLineHeight:12,legendItemNameFontWeight:"normal",legendItemSpacing:24,legendItemMarginBottom:12,legendSpacing:16,legendPadding:[8,8,8,8],legendHorizontalPadding:[8,0,8,0],legendVerticalPadding:[0,8,0,8],legendPageNavigatorMarkerSize:12,legendPageNavigatorMarkerInactiveFillColor:BLACK_COLORS[45],legendPageNavigatorMarkerInactiveFillOpacity:.45,legendPageNavigatorMarkerFillColor:BLACK_COLORS[45],legendPageNavigatorMarkerFillOpacity:1,legendPageNavigatorTextFillColor:BLACK_COLORS[65],legendPageNavigatorTextFontSize:12,sliderRailFillColor:BLACK_COLORS[15],sliderRailBorder:0,sliderRailBorderColor:null,sliderRailWidth:100,sliderRailHeight:12,sliderLabelTextFillColor:BLACK_COLORS[45],sliderLabelTextFontSize:12,sliderLabelTextLineHeight:12,sliderLabelTextFontWeight:"normal",sliderHandlerFillColor:WHITE_COLORS[6],sliderHandlerWidth:10,sliderHandlerHeight:14,sliderHandlerBorder:1,sliderHandlerBorderColor:WHITE_COLORS[25],annotationArcBorderColor:BLACK_COLORS[15],annotationArcBorder:1,annotationLineBorderColor:BLACK_COLORS[25],annotationLineBorder:1,annotationLineDash:null,annotationTextFillColor:BLACK_COLORS[65],annotationTextFontSize:12,annotationTextLineHeight:12,annotationTextFontWeight:"normal",annotationTextBorderColor:null,annotationTextBorder:0,annotationRegionFillColor:BLACK_COLORS[100],annotationRegionFillOpacity:.06,annotationRegionBorder:0,annotationRegionBorderColor:null,annotationDataMarkerLineLength:16,tooltipCrosshairsBorderColor:BLACK_COLORS[25],tooltipCrosshairsBorder:1,tooltipCrosshairsLineDash:null,tooltipContainerFillColor:"#1f1f1f",tooltipContainerFillOpacity:.95,tooltipContainerShadow:"0px 2px 4px rgba(0,0,0,.5)",tooltipContainerBorderRadius:3,tooltipTextFillColor:BLACK_COLORS[65],tooltipTextFontSize:12,tooltipTextLineHeight:12,tooltipTextFontWeight:"bold",labelFillColor:BLACK_COLORS[65],labelFillColorDark:"#2c3542",labelFillColorLight:"#ffffff",labelFontSize:12,labelLineHeight:12,labelFontWeight:"normal",labelBorderColor:null,labelBorder:0,innerLabelFillColor:WHITE_COLORS[100],innerLabelFontSize:12,innerLabelLineHeight:12,innerLabelFontWeight:"normal",innerLabelBorderColor:null,innerLabelBorder:0,overflowLabelFillColor:BLACK_COLORS[65],overflowLabelFillColorDark:"#2c3542",overflowLabelFillColorLight:"#ffffff",overflowLabelFontSize:12,overflowLabelLineHeight:12,overflowLabelFontWeight:"normal",overflowLabelBorderColor:WHITE_COLORS[100],overflowLabelBorder:1,labelLineBorder:1,labelLineBorderColor:BLACK_COLORS[25],cSliderRailHieght:16,cSliderBackgroundFillColor:"#416180",cSliderBackgroundFillOpacity:.05,cSliderForegroundFillColor:"#5B8FF9",cSliderForegroundFillOpacity:.15,cSliderHandlerHeight:24,cSliderHandlerWidth:10,cSliderHandlerFillColor:"#F7F7F7",cSliderHandlerFillOpacity:1,cSliderHandlerHighlightFillColor:"#FFF",cSliderHandlerBorderColor:"#BFBFBF",cSliderHandlerBorder:1,cSliderHandlerBorderRadius:2,cSliderTextFillColor:"#fff",cSliderTextFillOpacity:.45,cSliderTextFontSize:12,cSliderTextLineHeight:12,cSliderTextFontWeight:"normal",cSliderTextBorderColor:null,cSliderTextBorder:0,scrollbarTrackFillColor:"rgba(255,255,255,0.65)",scrollbarThumbFillColor:"rgba(0,0,0,0.35)",scrollbarThumbHighlightFillColor:"rgba(0,0,0,0.45)",pointFillColor:QUALITATIVE_10[0],pointFillOpacity:.95,pointSize:4,pointBorder:1,pointBorderColor:WHITE_COLORS[100],pointBorderOpacity:1,pointActiveBorderColor:BLACK_COLORS[100],pointSelectedBorder:2,pointSelectedBorderColor:BLACK_COLORS[100],pointInactiveFillOpacity:.3,pointInactiveBorderOpacity:.3,hollowPointSize:4,hollowPointBorder:1,hollowPointBorderColor:QUALITATIVE_10[0],hollowPointBorderOpacity:.95,hollowPointFillColor:WHITE_COLORS[100],hollowPointActiveBorder:1,hollowPointActiveBorderColor:BLACK_COLORS[100],hollowPointActiveBorderOpacity:1,hollowPointSelectedBorder:2,hollowPointSelectedBorderColor:BLACK_COLORS[100],hollowPointSelectedBorderOpacity:1,hollowPointInactiveBorderOpacity:.3,lineBorder:2,lineBorderColor:QUALITATIVE_10[0],lineBorderOpacity:1,lineActiveBorder:3,lineSelectedBorder:3,lineInactiveBorderOpacity:.3,areaFillColor:QUALITATIVE_10[0],areaFillOpacity:.25,areaActiveFillColor:QUALITATIVE_10[0],areaActiveFillOpacity:.5,areaSelectedFillColor:QUALITATIVE_10[0],areaSelectedFillOpacity:.5,areaInactiveFillOpacity:.3,hollowAreaBorderColor:QUALITATIVE_10[0],hollowAreaBorder:2,hollowAreaBorderOpacity:1,hollowAreaActiveBorder:3,hollowAreaActiveBorderColor:BLACK_COLORS[100],hollowAreaSelectedBorder:3,hollowAreaSelectedBorderColor:BLACK_COLORS[100],hollowAreaInactiveBorderOpacity:.3,intervalFillColor:QUALITATIVE_10[0],intervalFillOpacity:.95,intervalActiveBorder:1,intervalActiveBorderColor:BLACK_COLORS[100],intervalActiveBorderOpacity:1,intervalSelectedBorder:2,intervalSelectedBorderColor:BLACK_COLORS[100],intervalSelectedBorderOpacity:1,intervalInactiveBorderOpacity:.3,intervalInactiveFillOpacity:.3,hollowIntervalBorder:2,hollowIntervalBorderColor:QUALITATIVE_10[0],hollowIntervalBorderOpacity:1,hollowIntervalFillColor:WHITE_COLORS[100],hollowIntervalActiveBorder:2,hollowIntervalActiveBorderColor:BLACK_COLORS[100],hollowIntervalSelectedBorder:3,hollowIntervalSelectedBorderColor:BLACK_COLORS[100],hollowIntervalSelectedBorderOpacity:1,hollowIntervalInactiveBorderOpacity:.3};return __assign$8(__assign$8({},c),a)},antvDark=createDarkStyleSheet();function getPixelRatio$1(){return window?window.devicePixelRatio:1}function distance$1(a,r,e,n){var o=a-e,s=r-n;return Math.sqrt(o*o+s*s)}function inBox(a,r,e,n,o,s){return o>=a&&o<=a+e&&s>=r&&s<=r+n}function intersectRect(a,r){return!(r.minX>a.maxX||r.maxX<a.minX||r.minY>a.maxY||r.maxY<a.minY)}function mergeRegion(a,r){return!a||!r?a||r:{minX:Math.min(a.minX,r.minX),minY:Math.min(a.minY,r.minY),maxX:Math.max(a.maxX,r.maxX),maxY:Math.max(a.maxY,r.maxY)}}function isSamePoint$1(a,r){return a[0]===r[0]&&a[1]===r[1]}var regexLG$1=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,regexRG$1=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,regexPR$1=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,regexColorStop$1=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;function addStop$1(a,r){var e=a.match(regexColorStop$1);each$1(e,function(n){var o=n.split(":");r.addColorStop(o[0],o[1])})}function parseLineGradient$1(a,r,e){var n=regexLG$1.exec(e),o=parseFloat(n[1])%360*(Math.PI/180),s=n[2],l=r.getBBox(),c,u;o>=0&&o<1/2*Math.PI?(c={x:l.minX,y:l.minY},u={x:l.maxX,y:l.maxY}):1/2*Math.PI<=o&&o<Math.PI?(c={x:l.maxX,y:l.minY},u={x:l.minX,y:l.maxY}):Math.PI<=o&&o<3/2*Math.PI?(c={x:l.maxX,y:l.maxY},u={x:l.minX,y:l.minY}):(c={x:l.minX,y:l.maxY},u={x:l.maxX,y:l.minY});var f=Math.tan(o),d=f*f,g=(u.x-c.x+f*(u.y-c.y))/(d+1)+c.x,p=f*(u.x-c.x+f*(u.y-c.y))/(d+1)+c.y,v=a.createLinearGradient(c.x,c.y,g,p);return addStop$1(s,v),v}function parseRadialGradient$1(a,r,e){var n=regexRG$1.exec(e),o=parseFloat(n[1]),s=parseFloat(n[2]),l=parseFloat(n[3]),c=n[4];if(l===0){var u=c.match(regexColorStop$1);return u[u.length-1].split(":")[1]}var f=r.getBBox(),d=f.maxX-f.minX,g=f.maxY-f.minY,p=Math.sqrt(d*d+g*g)/2,v=a.createRadialGradient(f.minX+d*o,f.minY+g*s,0,f.minX+d/2,f.minY+g/2,l*p);return addStop$1(c,v),v}function parsePattern(a,r,e){if(r.get("patternSource")&&r.get("patternSource")===e)return r.get("pattern");var n,o,s=regexPR$1.exec(e),l=s[1],c=s[2];function u(){n=a.createPattern(o,l),r.set("pattern",n),r.set("patternSource",e)}switch(l){case"a":l="repeat";break;case"x":l="repeat-x";break;case"y":l="repeat-y";break;case"n":l="no-repeat";break;default:l="no-repeat"}return o=new Image,c.match(/^data:/i)||(o.crossOrigin="Anonymous"),o.src=c,o.complete?u():(o.onload=u,o.src=o.src),n}function parseStyle(a,r,e){var n=r.getBBox();if(isNaN(n.x)||isNaN(n.y)||isNaN(n.width)||isNaN(n.height))return e;if(isString$1(e)){if(e[1]==="("||e[2]==="("){if(e[0]==="l")return parseLineGradient$1(a,r,e);if(e[0]==="r")return parseRadialGradient$1(a,r,e);if(e[0]==="p")return parsePattern(a,r,e)}return e}if(e instanceof CanvasPattern)return e}function parseRadius$2(a){var r=0,e=0,n=0,o=0;return isArray$4(a)?a.length===1?r=e=n=o=a[0]:a.length===2?(r=n=a[0],e=o=a[1]):a.length===3?(r=a[0],e=o=a[1],n=a[2]):(r=a[0],e=a[1],n=a[2],o=a[3]):r=e=n=o=a,[r,e,n,o]}function vMag(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function vRatio(a,r){return vMag(a)*vMag(r)?(a[0]*r[0]+a[1]*r[1])/(vMag(a)*vMag(r)):1}function vAngle(a,r){return(a[0]*r[1]<a[1]*r[0]?-1:1)*Math.acos(vRatio(a,r))}function getArcParams(a,r){var e=r[1],n=r[2],o=mod$1(toRadian(r[3]),Math.PI*2),s=r[4],l=r[5],c=a[0],u=a[1],f=r[6],d=r[7],g=Math.cos(o)*(c-f)/2+Math.sin(o)*(u-d)/2,p=-1*Math.sin(o)*(c-f)/2+Math.cos(o)*(u-d)/2,v=g*g/(e*e)+p*p/(n*n);v>1&&(e*=Math.sqrt(v),n*=Math.sqrt(v));var m=e*e*(p*p)+n*n*(g*g),y=m?Math.sqrt((e*e*(n*n)-m)/m):1;s===l&&(y*=-1),isNaN(y)&&(y=0);var x=n?y*e*p/n:0,_=e?y*-n*g/e:0,E=(c+f)/2+Math.cos(o)*x-Math.sin(o)*_,S=(u+d)/2+Math.sin(o)*x+Math.cos(o)*_,A=[(g-x)/e,(p-_)/n],T=[(-1*g-x)/e,(-1*p-_)/n],b=vAngle([1,0],A),C=vAngle(A,T);return vRatio(A,T)<=-1&&(C=Math.PI),vRatio(A,T)>=1&&(C=0),l===0&&C>0&&(C=C-2*Math.PI),l===1&&C<0&&(C=C+2*Math.PI),{cx:E,cy:S,rx:isSamePoint$1(a,[f,d])?0:e,ry:isSamePoint$1(a,[f,d])?0:n,startAngle:b,endAngle:b+C,xRotation:o,arcFlag:s,sweepFlag:l}}var sin=Math.sin,cos=Math.cos,atan2=Math.atan2,PI=Math.PI;function _addDefaultArrow(a,r,e,n,o,s,l){var c=r.stroke,u=r.lineWidth,f=e-o,d=n-s,g=atan2(d,f),p=new Path$2({type:"path",canvas:a.get("canvas"),isArrowShape:!0,attrs:{path:"M"+10*cos(PI/6)+","+10*sin(PI/6)+" L0,0 L"+10*cos(PI/6)+",-"+10*sin(PI/6),stroke:c,lineWidth:u}});p.translate(o,s),p.rotateAtPoint(o,s,g),a.set(l?"startArrowShape":"endArrowShape",p)}function _addCustomizedArrow(a,r,e,n,o,s,l){var c=r.startArrow,u=r.endArrow,f=r.stroke,d=r.lineWidth,g=l?c:u,p=g.d,v=g.fill,m=g.stroke,y=g.lineWidth,x=__rest$1(g,["d","fill","stroke","lineWidth"]),_=e-o,E=n-s,S=atan2(E,_);p&&(o=o-cos(S)*p,s=s-sin(S)*p);var A=new Path$2({type:"path",canvas:a.get("canvas"),isArrowShape:!0,attrs:__assign$8(__assign$8({},x),{stroke:m||f,lineWidth:y||d,fill:v})});A.translate(o,s),A.rotateAtPoint(o,s,S),a.set(l?"startArrowShape":"endArrowShape",A)}function getShortenOffset(a,r,e,n,o){var s=atan2(n-r,e-a);return{dx:cos(s)*o,dy:sin(s)*o}}function addStartArrow(a,r,e,n,o,s){typeof r.startArrow=="object"?_addCustomizedArrow(a,r,e,n,o,s,!0):r.startArrow?_addDefaultArrow(a,r,e,n,o,s,!0):a.set("startArrowShape",null)}function addEndArrow(a,r,e,n,o,s){typeof r.endArrow=="object"?_addCustomizedArrow(a,r,e,n,o,s,!1):r.endArrow?_addDefaultArrow(a,r,e,n,o,s,!1):a.set("startArrowShape",null)}var SHAPE_ATTRS_MAP={fill:"fillStyle",stroke:"strokeStyle",opacity:"globalAlpha"};function applyAttrsToContext(a,r){var e=r.attr();for(var n in e){var o=e[n],s=SHAPE_ATTRS_MAP[n]?SHAPE_ATTRS_MAP[n]:n;s==="matrix"&&o?a.transform(o[0],o[1],o[3],o[4],o[6],o[7]):s==="lineDash"&&a.setLineDash?isArray$4(o)&&a.setLineDash(o):(s==="strokeStyle"||s==="fillStyle"?o=parseStyle(a,r,o):s==="globalAlpha"&&(o=o*a.globalAlpha),a[s]=o)}}function drawChildren$1(a,r,e){for(var n=0;n<r.length;n++){var o=r[n];o.cfg.visible?o.draw(a,e):o.skipDraw()}}function checkRefresh(a,r,e){var n=a.get("refreshElements");each$1(n,function(o){if(o!==a)for(var s=o.cfg.parent;s&&s!==a&&!s.cfg.refresh;)s.cfg.refresh=!0,s=s.cfg.parent}),n[0]===a?setChildrenRefresh(r):checkChildrenRefresh(r,e)}function checkChildrenRefresh(a,r){for(var e=0;e<a.length;e++){var n=a[e];if(n.cfg.visible)if(n.cfg.hasChanged)n.cfg.refresh=!0,n.isGroup()&&setChildrenRefresh(n.cfg.children);else if(n.cfg.refresh)n.isGroup()&&checkChildrenRefresh(n.cfg.children,r);else{var o=checkElementRefresh(n,r);n.cfg.refresh=o,o&&n.isGroup()&&checkChildrenRefresh(n.cfg.children,r)}}}function clearChanged(a){for(var r=0;r<a.length;r++){var e=a[r];e.cfg.hasChanged=!1,e.isGroup()&&!e.destroyed&&clearChanged(e.cfg.children)}}function setChildrenRefresh(a,r){for(var e=0;e<a.length;e++){var n=a[e];n.cfg.visible&&(n.cfg.refresh=!0,n.isGroup()&&setChildrenRefresh(n.get("children")))}}function checkElementRefresh(a,r){var e=a.cfg.cacheCanvasBBox,n=a.cfg.isInView&&e&&intersectRect(e,r);return n}function drawPath(a,r,e,n){var o=e.path,s=e.startArrow,l=e.endArrow;if(o){var c=[0,0],u=[0,0],f={dx:0,dy:0};r.beginPath();for(var d=0;d<o.length;d++){var g=o[d],p=g[0];if(d===0&&s&&s.d){var v=a.getStartTangent();f=getShortenOffset(v[0][0],v[0][1],v[1][0],v[1][1],s.d)}else if(d===o.length-2&&o[d+1][0]==="Z"&&l&&l.d){var m=o[d+1];if(m[0]==="Z"){var v=a.getEndTangent();f=getShortenOffset(v[0][0],v[0][1],v[1][0],v[1][1],l.d)}}else if(d===o.length-1&&l&&l.d&&o[0]!=="Z"){var v=a.getEndTangent();f=getShortenOffset(v[0][0],v[0][1],v[1][0],v[1][1],l.d)}var y=f.dx,x=f.dy;switch(p){case"M":r.moveTo(g[1]-y,g[2]-x),u=[g[1],g[2]];break;case"L":r.lineTo(g[1]-y,g[2]-x);break;case"Q":r.quadraticCurveTo(g[1],g[2],g[3]-y,g[4]-x);break;case"C":r.bezierCurveTo(g[1],g[2],g[3],g[4],g[5]-y,g[6]-x);break;case"A":{var _=void 0;n?(_=n[d],_||(_=getArcParams(c,g),n[d]=_)):_=getArcParams(c,g);var E=_.cx,S=_.cy,A=_.rx,T=_.ry,b=_.startAngle,C=_.endAngle,L=_.xRotation,R=_.sweepFlag;if(r.ellipse)r.ellipse(E,S,A,T,L,b,C,1-R);else{var I=A>T?A:T,w=A>T?1:A/T,M=A>T?T/A:1;r.translate(E,S),r.rotate(L),r.scale(w,M),r.arc(0,0,I,b,C,1-R),r.scale(1/w,1/M),r.rotate(-L),r.translate(-E,-S)}break}case"Z":r.closePath();break}if(p==="Z")c=u;else{var D=g.length;c=[g[D-2],g[D-1]]}}}}function refreshElement$1(a,r){var e=a.get("canvas");e&&(r==="remove"&&(a._cacheCanvasBBox=a.get("cacheCanvasBBox")),a.get("hasChanged")||(a.set("hasChanged",!0),a.cfg.parent&&a.cfg.parent.get("hasChanged")||(e.refreshElement(a,r,e),e.get("autoDraw")&&e.draw())))}function getRefreshRegion(a){var r;if(a.destroyed)r=a._cacheCanvasBBox;else{var e=a.get("cacheCanvasBBox"),n=e&&!!(e.width&&e.height),o=a.getCanvasBBox(),s=o&&!!(o.width&&o.height);n&&s?r=mergeRegion(e,o):n?r=e:s&&(r=o)}return r}function getMergedRegion(a){if(!a.length)return null;var r=[],e=[],n=[],o=[];return each$1(a,function(s){var l=getRefreshRegion(s);l&&(r.push(l.minX),e.push(l.minY),n.push(l.maxX),o.push(l.maxY))}),{minX:min$2(r),minY:min$2(e),maxX:max$2(n),maxY:max$2(o)}}function mergeView(a,r){return!a||!r||!intersectRect(a,r)?null:{minX:Math.max(a.minX,r.minX),minY:Math.max(a.minY,r.minY),maxX:Math.min(a.maxX,r.maxX),maxY:Math.min(a.maxY,r.maxY)}}var Group$1=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.onCanvasChange=function(e){refreshElement$1(this,e)},r.prototype.getShapeBase=function(){return Shape$1},r.prototype.getGroupBase=function(){return r},r.prototype._applyClip=function(e,n){n&&(e.save(),applyAttrsToContext(e,n),n.createPath(e),e.restore(),e.clip(),n._afterDraw())},r.prototype.cacheCanvasBBox=function(){var e=this.cfg.children,n=[],o=[];each$1(e,function(p){var v=p.cfg.cacheCanvasBBox;v&&p.cfg.isInView&&(n.push(v.minX,v.maxX),o.push(v.minY,v.maxY))});var s=null;if(n.length){var l=min$2(n),c=max$2(n),u=min$2(o),f=max$2(o);s={minX:l,minY:u,x:l,y:u,maxX:c,maxY:f,width:c-l,height:f-u};var d=this.cfg.canvas;if(d){var g=d.getViewRange();this.set("isInView",intersectRect(s,g))}}else this.set("isInView",!1);this.set("cacheCanvasBBox",s)},r.prototype.draw=function(e,n){var o=this.cfg.children,s=n?this.cfg.refresh:!0;o.length&&s&&(e.save(),applyAttrsToContext(e,this),this._applyClip(e,this.getClip()),drawChildren$1(e,o,n),e.restore(),this.cacheCanvasBBox()),this.cfg.refresh=null,this.set("hasChanged",!1)},r.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("hasChanged",!1)},r}(AbstractGroup),ShapeBase$1=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},r.prototype.getShapeBase=function(){return Shape$1},r.prototype.getGroupBase=function(){return Group$1},r.prototype.onCanvasChange=function(e){refreshElement$1(this,e)},r.prototype.calculateBBox=function(){var e=this.get("type"),n=this.getHitLineWidth(),o=getMethod(e),s=o(this),l=n/2,c=s.x-l,u=s.y-l,f=s.x+s.width+l,d=s.y+s.height+l;return{x:c,minX:c,y:u,minY:u,width:s.width+n,height:s.height+n,maxX:f,maxY:d}},r.prototype.isFill=function(){return!!this.attrs.fill||this.isClipShape()},r.prototype.isStroke=function(){return!!this.attrs.stroke},r.prototype._applyClip=function(e,n){n&&(e.save(),applyAttrsToContext(e,n),n.createPath(e),e.restore(),e.clip(),n._afterDraw())},r.prototype.draw=function(e,n){var o=this.cfg.clipShape;if(n){if(this.cfg.refresh===!1){this.set("hasChanged",!1);return}var s=this.getCanvasBBox();if(!intersectRect(n,s)){this.set("hasChanged",!1),this.cfg.isInView&&this._afterDraw();return}}e.save(),applyAttrsToContext(e,this),this._applyClip(e,o),this.drawPath(e),e.restore(),this._afterDraw()},r.prototype.getCanvasViewBox=function(){var e=this.cfg.canvas;return e?e.getViewRange():null},r.prototype.cacheCanvasBBox=function(){var e=this.getCanvasViewBox();if(e){var n=this.getCanvasBBox(),o=intersectRect(n,e);this.set("isInView",o),o?this.set("cacheCanvasBBox",n):this.set("cacheCanvasBBox",null)}},r.prototype._afterDraw=function(){this.cacheCanvasBBox(),this.set("hasChanged",!1),this.set("refresh",null)},r.prototype.skipDraw=function(){this.set("cacheCanvasBBox",null),this.set("isInView",null),this.set("hasChanged",!1)},r.prototype.drawPath=function(e){this.createPath(e),this.strokeAndFill(e),this.afterDrawPath(e)},r.prototype.fill=function(e){e.fill()},r.prototype.stroke=function(e){e.stroke()},r.prototype.strokeAndFill=function(e){var n=this.attrs,o=n.lineWidth,s=n.opacity,l=n.strokeOpacity,c=n.fillOpacity;this.isFill()&&(!isNil(c)&&c!==1?(e.globalAlpha=c,this.fill(e),e.globalAlpha=s):this.fill(e)),this.isStroke()&&o>0&&(!isNil(l)&&l!==1&&(e.globalAlpha=l),this.stroke(e)),this.afterDrawPath(e)},r.prototype.createPath=function(e){},r.prototype.afterDrawPath=function(e){},r.prototype.isInShape=function(e,n){var o=this.isStroke(),s=this.isFill(),l=this.getHitLineWidth();return this.isInStrokeOrPath(e,n,o,s,l)},r.prototype.isInStrokeOrPath=function(e,n,o,s,l){return!1},r.prototype.getHitLineWidth=function(){if(!this.isStroke())return 0;var e=this.attrs;return e.lineWidth+e.lineAppendWidth},r}(AbstractShape),Circle$2=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{x:0,y:0,r:0})},r.prototype.isInStrokeOrPath=function(e,n,o,s,l){var c=this.attr(),u=c.x,f=c.y,d=c.r,g=l/2,p=distance$1(u,f,e,n);return s&&o?p<=d+g:s?p<=d:o?p>=d-g&&p<=d+g:!1},r.prototype.createPath=function(e){var n=this.attr(),o=n.x,s=n.y,l=n.r;e.beginPath(),e.arc(o,s,l,0,Math.PI*2,!1),e.closePath()},r}(ShapeBase$1);function ellipseDistance(a,r,e,n){return a/(e*e)+r/(n*n)}var Ellipse$1=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{x:0,y:0,rx:0,ry:0})},r.prototype.isInStrokeOrPath=function(e,n,o,s,l){var c=this.attr(),u=l/2,f=c.x,d=c.y,g=c.rx,p=c.ry,v=(e-f)*(e-f),m=(n-d)*(n-d);return s&&o?ellipseDistance(v,m,g+u,p+u)<=1:s?ellipseDistance(v,m,g,p)<=1:o?ellipseDistance(v,m,g-u,p-u)>=1&&ellipseDistance(v,m,g+u,p+u)<=1:!1},r.prototype.createPath=function(e){var n=this.attr(),o=n.x,s=n.y,l=n.rx,c=n.ry;if(e.beginPath(),e.ellipse)e.ellipse(o,s,l,c,0,0,Math.PI*2,!1);else{var u=l>c?l:c,f=l>c?1:l/c,d=l>c?c/l:1;e.save(),e.translate(o,s),e.scale(f,d),e.arc(0,0,u,0,Math.PI*2),e.restore(),e.closePath()}},r}(ShapeBase$1);function isCanvas(a){return a instanceof HTMLElement&&isString$1(a.nodeName)&&a.nodeName.toUpperCase()==="CANVAS"}var ImageShape=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{x:0,y:0,width:0,height:0})},r.prototype.initAttrs=function(e){this._setImage(e.img)},r.prototype.isStroke=function(){return!1},r.prototype.isOnlyHitBox=function(){return!0},r.prototype._afterLoading=function(){if(this.get("toDraw")===!0){var e=this.get("canvas");e?e.draw():this.createPath(this.get("context"))}},r.prototype._setImage=function(e){var n=this,o=this.attrs;if(isString$1(e)){var s=new Image;s.onload=function(){if(n.destroyed)return!1;n.attr("img",s),n.set("loading",!1),n._afterLoading();var l=n.get("callback");l&&l.call(n)},s.crossOrigin="Anonymous",s.src=e,this.set("loading",!0)}else e instanceof Image?(o.width||(o.width=e.width),o.height||(o.height=e.height)):isCanvas(e)&&(o.width||(o.width=Number(e.getAttribute("width"))),o.height||(o.height,Number(e.getAttribute("height"))))},r.prototype.onAttrChange=function(e,n,o){a.prototype.onAttrChange.call(this,e,n,o),e==="img"&&this._setImage(n)},r.prototype.createPath=function(e){if(this.get("loading")){this.set("toDraw",!0),this.set("context",e);return}var n=this.attr(),o=n.x,s=n.y,l=n.width,c=n.height,u=n.sx,f=n.sy,d=n.swidth,g=n.sheight,p=n.img;(p instanceof Image||isCanvas(p))&&(!isNil(u)&&!isNil(f)&&!isNil(d)&&!isNil(g)?e.drawImage(p,u,f,d,g,o,s,l,c):e.drawImage(p,o,s,l,c))},r}(ShapeBase$1);function inLine(a,r,e,n,o,s,l){var c=Math.min(a,e),u=Math.max(a,e),f=Math.min(r,n),d=Math.max(r,n),g=o/2;return s>=c-g&&s<=u+g&&l>=f-g&&l<=d+g?LineUtil.pointToLine(a,r,e,n,s,l)<=o/2:!1}var Line$3=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},r.prototype.initAttrs=function(e){this.setArrow()},r.prototype.onAttrChange=function(e,n,o){a.prototype.onAttrChange.call(this,e,n,o),this.setArrow()},r.prototype.setArrow=function(){var e=this.attr(),n=e.x1,o=e.y1,s=e.x2,l=e.y2,c=e.startArrow,u=e.endArrow;c&&addStartArrow(this,e,s,l,n,o),u&&addEndArrow(this,e,n,o,s,l)},r.prototype.isInStrokeOrPath=function(e,n,o,s,l){if(!o||!l)return!1;var c=this.attr(),u=c.x1,f=c.y1,d=c.x2,g=c.y2;return inLine(u,f,d,g,l,e,n)},r.prototype.createPath=function(e){var n=this.attr(),o=n.x1,s=n.y1,l=n.x2,c=n.y2,u=n.startArrow,f=n.endArrow,d={dx:0,dy:0},g={dx:0,dy:0};u&&u.d&&(d=getShortenOffset(o,s,l,c,n.startArrow.d)),f&&f.d&&(g=getShortenOffset(o,s,l,c,n.endArrow.d)),e.beginPath(),e.moveTo(o+d.dx,s+d.dy),e.lineTo(l-g.dx,c-g.dy)},r.prototype.afterDrawPath=function(e){var n=this.get("startArrowShape"),o=this.get("endArrowShape");n&&n.draw(e),o&&o.draw(e)},r.prototype.getTotalLength=function(){var e=this.attr(),n=e.x1,o=e.y1,s=e.x2,l=e.y2;return LineUtil.length(n,o,s,l)},r.prototype.getPoint=function(e){var n=this.attr(),o=n.x1,s=n.y1,l=n.x2,c=n.y2;return LineUtil.pointAt(o,s,l,c,e)},r}(ShapeBase$1),Symbols$1={circle:function(a,r,e){return[["M",a-e,r],["A",e,e,0,1,0,a+e,r],["A",e,e,0,1,0,a-e,r]]},square:function(a,r,e){return[["M",a-e,r-e],["L",a+e,r-e],["L",a+e,r+e],["L",a-e,r+e],["Z"]]},diamond:function(a,r,e){return[["M",a-e,r],["L",a,r-e],["L",a+e,r],["L",a,r+e],["Z"]]},triangle:function(a,r,e){var n=e*Math.sin(.3333333333333333*Math.PI);return[["M",a-e,r+n],["L",a,r-n],["L",a+e,r+n],["Z"]]},"triangle-down":function(a,r,e){var n=e*Math.sin(.3333333333333333*Math.PI);return[["M",a-e,r-n],["L",a+e,r-n],["L",a,r+n],["Z"]]}},Marker$1=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.initAttrs=function(e){this._resetParamsCache()},r.prototype._resetParamsCache=function(){this.set("paramsCache",{})},r.prototype.onAttrChange=function(e,n,o){a.prototype.onAttrChange.call(this,e,n,o),["symbol","x","y","r","radius"].indexOf(e)!==-1&&this._resetParamsCache()},r.prototype.isOnlyHitBox=function(){return!0},r.prototype._getR=function(e){return isNil(e.r)?e.radius:e.r},r.prototype._getPath=function(){var e=this.attr(),n=e.x,o=e.y,s=e.symbol||"circle",l=this._getR(e),c,u;if(isFunction$1(s))c=s,u=c(n,o,l),u=pathToAbsolute(u);else{if(c=r.Symbols[s],!c)return console.warn(s+" marker is not supported."),null;u=c(n,o,l)}return u},r.prototype.createPath=function(e){var n=this._getPath(),o=this.get("paramsCache");drawPath(this,e,{path:n},o)},r.Symbols=Symbols$1,r}(ShapeBase$1);function isPointInPath(a,r,e){var n=getOffScreenContext();return a.createPath(n),n.isPointInPath(r,e)}var tolerance=1e-6;function dcmp(a){return Math.abs(a)<tolerance?0:a<0?-1:1}function onSegment(a,r,e){return(e[0]-a[0])*(r[1]-a[1])===(r[0]-a[0])*(e[1]-a[1])&&Math.min(a[0],r[0])<=e[0]&&e[0]<=Math.max(a[0],r[0])&&Math.min(a[1],r[1])<=e[1]&&e[1]<=Math.max(a[1],r[1])}function isInPolygon(a,r,e){var n=!1,o=a.length;if(o<=2)return!1;for(var s=0;s<o;s++){var l=a[s],c=a[(s+1)%o];if(onSegment(l,c,[r,e]))return!0;dcmp(l[1]-e)>0!=dcmp(c[1]-e)>0&&dcmp(r-(e-l[1])*(l[0]-c[0])/(l[1]-c[1])-l[0])<0&&(n=!n)}return n}function arc(a,r,e,n,o,s,l,c){var u=(Math.atan2(c-r,l-a)+Math.PI*2)%(Math.PI*2);if(u<n||u>o)return!1;var f={x:a+e*Math.cos(u),y:r+e*Math.sin(u)};return distance$1(f.x,f.y,l,c)<=s/2}var transform$3=transform$6;function hasArc(a){for(var r=!1,e=a.length,n=0;n<e;n++){var o=a[n],s=o[0];if(s==="C"||s==="A"||s==="Q"){r=!0;break}}return r}function isPointInStroke(a,r,e,n,o){for(var s=!1,l=r/2,c=0;c<a.length;c++){var u=a[c],f=u.currentPoint,d=u.params,g=u.prePoint,p=u.box;if(!(p&&!inBox(p.x-l,p.y-l,p.width+r,p.height+r,e,n))){switch(u.command){case"L":case"Z":s=inLine(g[0],g[1],f[0],f[1],r,e,n);break;case"Q":var v=QuadUtil.pointDistance(g[0],g[1],d[1],d[2],d[3],d[4],e,n);s=v<=r/2;break;case"C":var m=CubicUtil.pointDistance(g[0],g[1],d[1],d[2],d[3],d[4],d[5],d[6],e,n,o);s=m<=r/2;break;case"A":var y=u.arcParams,x=y.cx,_=y.cy,E=y.rx,S=y.ry,A=y.startAngle,T=y.endAngle,b=y.xRotation,C=[e,n,1],L=E>S?E:S,R=E>S?1:E/S,I=E>S?S/E:1,w=transform$3(null,[["t",-x,-_],["r",-b],["s",1/R,1/I]]);transformMat3$1(C,C,w),s=arc(0,0,L,A,T,r,C[0],C[1]);break}if(s)break}}return s}function extractPolygons(a){for(var r=a.length,e=[],n=[],o=[],s=0;s<r;s++){var l=a[s],c=l[0];c==="M"?(o.length&&(n.push(o),o=[]),o.push([l[1],l[2]])):c==="Z"?o.length&&(e.push(o),o=[]):o.push([l[1],l[2]])}return o.length>0&&n.push(o),{polygons:e,polylines:n}}const PathUtil=__assign$8({hasArc,extractPolygons,isPointInStroke},PathUtil$1);function isInPolygons(a,r,e){for(var n=!1,o=0;o<a.length;o++){var s=a[o];if(n=isInPolygon(s,r,e),n)break}return n}var Path$2=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{startArrow:!1,endArrow:!1})},r.prototype.initAttrs=function(e){this._setPathArr(e.path),this.setArrow()},r.prototype.onAttrChange=function(e,n,o){a.prototype.onAttrChange.call(this,e,n,o),e==="path"&&this._setPathArr(n),this.setArrow()},r.prototype._setPathArr=function(e){this.attrs.path=pathToAbsolute(e);var n=PathUtil.hasArc(e);this.set("hasArc",n),this.set("paramsCache",{}),this.set("segments",null),this.set("curve",null),this.set("tCache",null),this.set("totalLength",null)},r.prototype.getSegments=function(){var e=this.get("segements");return e||(e=getSegments(this.attr("path")),this.set("segments",e)),e},r.prototype.setArrow=function(){var e=this.attr(),n=e.startArrow,o=e.endArrow;if(n){var s=this.getStartTangent();addStartArrow(this,e,s[0][0],s[0][1],s[1][0],s[1][1])}if(o){var s=this.getEndTangent();addEndArrow(this,e,s[0][0],s[0][1],s[1][0],s[1][1])}},r.prototype.isInStrokeOrPath=function(e,n,o,s,l){var c=this.getSegments(),u=this.get("hasArc"),f=!1;if(o){var d=this.getTotalLength();f=PathUtil.isPointInStroke(c,l,e,n,d)}if(!f&&s)if(u)f=isPointInPath(this,e,n);else{var g=this.attr("path"),p=PathUtil.extractPolygons(g);f=isInPolygons(p.polygons,e,n)||isInPolygons(p.polylines,e,n)}return f},r.prototype.createPath=function(e){var n=this.attr(),o=this.get("paramsCache");drawPath(this,e,n,o)},r.prototype.afterDrawPath=function(e){var n=this.get("startArrowShape"),o=this.get("endArrowShape");n&&n.draw(e),o&&o.draw(e)},r.prototype.getTotalLength=function(){var e=this.get("totalLength");return isNil(e)?(this._calculateCurve(),this._setTcache(),this.get("totalLength")):e},r.prototype.getPoint=function(e){var n=this.get("tCache");n||(this._calculateCurve(),this._setTcache(),n=this.get("tCache"));var o,s,l=this.get("curve");if(!n||n.length===0)return l?{x:l[0][1],y:l[0][2]}:null;each$1(n,function(d,g){e>=d[0]&&e<=d[1]&&(o=(e-d[0])/(d[1]-d[0]),s=g)});var c=l[s];if(isNil(c)||isNil(s))return null;var u=c.length,f=l[s+1];return CubicUtil.pointAt(c[u-2],c[u-1],f[1],f[2],f[3],f[4],f[5],f[6],o)},r.prototype._calculateCurve=function(){var e=this.attr().path;this.set("curve",PathUtil.pathToCurve(e))},r.prototype._setTcache=function(){var e=0,n=0,o=[],s,l,c,u,f=this.get("curve");if(f){if(each$1(f,function(d,g){c=f[g+1],u=d.length,c&&(e+=CubicUtil.length(d[u-2],d[u-1],c[1],c[2],c[3],c[4],c[5],c[6])||0)}),this.set("totalLength",e),e===0){this.set("tCache",[]);return}each$1(f,function(d,g){c=f[g+1],u=d.length,c&&(s=[],s[0]=n/e,l=CubicUtil.length(d[u-2],d[u-1],c[1],c[2],c[3],c[4],c[5],c[6]),n+=l||0,s[1]=n/e,o.push(s))}),this.set("tCache",o)}},r.prototype.getStartTangent=function(){var e=this.getSegments(),n;if(e.length>1){var o=e[0].currentPoint,s=e[1].currentPoint,l=e[1].startTangent;n=[],l?(n.push([o[0]-l[0],o[1]-l[1]]),n.push([o[0],o[1]])):(n.push([s[0],s[1]]),n.push([o[0],o[1]]))}return n},r.prototype.getEndTangent=function(){var e=this.getSegments(),n=e.length,o;if(n>1){var s=e[n-2].currentPoint,l=e[n-1].currentPoint,c=e[n-1].endTangent;o=[],c?(o.push([l[0]-c[0],l[1]-c[1]]),o.push([l[0],l[1]])):(o.push([s[0],s[1]]),o.push([l[0],l[1]]))}return o},r}(ShapeBase$1);function inPolyline(a,r,e,n,o){var s=a.length;if(s<2)return!1;for(var l=0;l<s-1;l++){var c=a[l][0],u=a[l][1],f=a[l+1][0],d=a[l+1][1];if(inLine(c,u,f,d,r,e,n))return!0}if(o){var g=a[0],p=a[s-1];if(inLine(g[0],g[1],p[0],p[1],r,e,n))return!0}return!1}var Polygon$2=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.isInStrokeOrPath=function(e,n,o,s,l){var c=this.attr().points,u=!1;return o&&(u=inPolyline(c,l,e,n,!0)),!u&&s&&(u=isInPolygon(c,e,n)),u},r.prototype.createPath=function(e){var n=this.attr(),o=n.points;if(!(o.length<2)){e.beginPath();for(var s=0;s<o.length;s++){var l=o[s];s===0?e.moveTo(l[0],l[1]):e.lineTo(l[0],l[1])}e.closePath()}},r}(ShapeBase$1),PolyLine=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{startArrow:!1,endArrow:!1})},r.prototype.initAttrs=function(e){this.setArrow()},r.prototype.onAttrChange=function(e,n,o){a.prototype.onAttrChange.call(this,e,n,o),this.setArrow(),["points"].indexOf(e)!==-1&&this._resetCache()},r.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},r.prototype.setArrow=function(){var e=this.attr(),n=this.attrs,o=n.points,s=n.startArrow,l=n.endArrow,c=o.length,u=o[0][0],f=o[0][1],d=o[c-1][0],g=o[c-1][1];s&&addStartArrow(this,e,o[1][0],o[1][1],u,f),l&&addEndArrow(this,e,o[c-2][0],o[c-2][1],d,g)},r.prototype.isFill=function(){return!1},r.prototype.isInStrokeOrPath=function(e,n,o,s,l){if(!o||!l)return!1;var c=this.attr().points;return inPolyline(c,l,e,n,!1)},r.prototype.isStroke=function(){return!0},r.prototype.createPath=function(e){var n=this.attr(),o=n.points,s=n.startArrow,l=n.endArrow,c=o.length;if(!(o.length<2)){var u=o[0][0],f=o[0][1],d=o[c-1][0],g=o[c-1][1];if(s&&s.d){var p=getShortenOffset(u,f,o[1][0],o[1][1],s.d);u+=p.dx,f+=p.dy}if(l&&l.d){var p=getShortenOffset(o[c-2][0],o[c-2][1],d,g,l.d);d-=p.dx,g-=p.dy}e.beginPath(),e.moveTo(u,f);for(var v=0;v<c-1;v++){var m=o[v];e.lineTo(m[0],m[1])}e.lineTo(d,g)}},r.prototype.afterDrawPath=function(e){var n=this.get("startArrowShape"),o=this.get("endArrowShape");n&&n.draw(e),o&&o.draw(e)},r.prototype.getTotalLength=function(){var e=this.attr().points,n=this.get("totalLength");return isNil(n)?(this.set("totalLength",PolylineUtil.length(e)),this.get("totalLength")):n},r.prototype.getPoint=function(e){var n=this.attr().points,o=this.get("tCache");o||(this._setTcache(),o=this.get("tCache"));var s,l;return each$1(o,function(c,u){e>=c[0]&&e<=c[1]&&(s=(e-c[0])/(c[1]-c[0]),l=u)}),LineUtil.pointAt(n[l][0],n[l][1],n[l+1][0],n[l+1][1],s)},r.prototype._setTcache=function(){var e=this.attr().points;if(!(!e||e.length===0)){var n=this.getTotalLength();if(!(n<=0)){var o=0,s=[],l,c;each$1(e,function(u,f){e[f+1]&&(l=[],l[0]=o/n,c=LineUtil.length(u[0],u[1],e[f+1][0],e[f+1][1]),o+=c,l[1]=o/n,s.push(l))}),this.set("tCache",s)}}},r.prototype.getStartTangent=function(){var e=this.attr().points,n=[];return n.push([e[1][0],e[1][1]]),n.push([e[0][0],e[0][1]]),n},r.prototype.getEndTangent=function(){var e=this.attr().points,n=e.length-1,o=[];return o.push([e[n-1][0],e[n-1][1]]),o.push([e[n][0],e[n][1]]),o},r}(ShapeBase$1);function inRect(a,r,e,n,o,s,l){var c=o/2;return inBox(a-c,r-c,e,o,s,l)||inBox(a+e-c,r-c,o,n,s,l)||inBox(a+c,r+n-c,e,o,s,l)||inBox(a-c,r+c,o,n,s,l)}function rectWithRadius(a,r,e,n,o,s,l,c){return inLine(a+o,r,a+e-o,r,s,l,c)||inLine(a+e,r+o,a+e,r+n-o,s,l,c)||inLine(a+e-o,r+n,a+o,r+n,s,l,c)||inLine(a,r+n-o,a,r+o,s,l,c)||arc(a+e-o,r+o,o,1.5*Math.PI,2*Math.PI,s,l,c)||arc(a+e-o,r+n-o,o,0,.5*Math.PI,s,l,c)||arc(a+o,r+n-o,o,.5*Math.PI,Math.PI,s,l,c)||arc(a+o,r+o,o,Math.PI,1.5*Math.PI,s,l,c)}var Rect$2=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{x:0,y:0,width:0,height:0,radius:0})},r.prototype.isInStrokeOrPath=function(e,n,o,s,l){var c=this.attr(),u=c.x,f=c.y,d=c.width,g=c.height,p=c.radius;if(p){var m=!1;return o&&(m=rectWithRadius(u,f,d,g,p,l,e,n)),!m&&s&&(m=isPointInPath(this,e,n)),m}else{var v=l/2;if(s&&o)return inBox(u-v,f-v,d+v,g+v,e,n);if(s)return inBox(u,f,d,g,e,n);if(o)return inRect(u,f,d,g,l,e,n)}},r.prototype.createPath=function(e){var n=this.attr(),o=n.x,s=n.y,l=n.width,c=n.height,u=n.radius;if(e.beginPath(),u===0)e.rect(o,s,l,c);else{var f=parseRadius$2(u),d=f[0],g=f[1],p=f[2],v=f[3];e.moveTo(o+d,s),e.lineTo(o+l-g,s),g!==0&&e.arc(o+l-g,s+g,g,-Math.PI/2,0),e.lineTo(o+l,s+c-p),p!==0&&e.arc(o+l-p,s+c-p,p,0,Math.PI/2),e.lineTo(o+v,s+c),v!==0&&e.arc(o+v,s+c-v,v,Math.PI/2,Math.PI),e.lineTo(o,s+d),d!==0&&e.arc(o+d,s+d,d,Math.PI,Math.PI*1.5),e.closePath()}},r}(ShapeBase$1),Text$1=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},r.prototype.isOnlyHitBox=function(){return!0},r.prototype.initAttrs=function(e){this._assembleFont(),e.text&&this._setText(e.text)},r.prototype._assembleFont=function(){var e=this.attrs;e.font=assembleFont(e)},r.prototype._setText=function(e){var n=null;isString$1(e)&&e.indexOf(`
`)!==-1&&(n=e.split(`
`)),this.set("textArr",n)},r.prototype.onAttrChange=function(e,n,o){a.prototype.onAttrChange.call(this,e,n,o),e.startsWith("font")&&this._assembleFont(),e==="text"&&this._setText(n)},r.prototype._getSpaceingY=function(){var e=this.attrs,n=e.lineHeight,o=e.fontSize*1;return n?n-o:o*.14},r.prototype._drawTextArr=function(e,n,o){var s=this.attrs,l=s.textBaseline,c=s.x,u=s.y,f=s.fontSize*1,d=this._getSpaceingY(),g=getTextHeight(s.text,s.fontSize,s.lineHeight),p;each$1(n,function(v,m){p=u+m*(d+f)-g+f,l==="middle"&&(p+=g-f-(g-f)/2),l==="top"&&(p+=g-f),isNil(v)||(o?e.fillText(v,c,p):e.strokeText(v,c,p))})},r.prototype._drawText=function(e,n){var o=this.attr(),s=o.x,l=o.y,c=this.get("textArr");if(c)this._drawTextArr(e,c,n);else{var u=o.text;isNil(u)||(n?e.fillText(u,s,l):e.strokeText(u,s,l))}},r.prototype.strokeAndFill=function(e){var n=this.attrs,o=n.lineWidth,s=n.opacity,l=n.strokeOpacity,c=n.fillOpacity;this.isStroke()&&o>0&&(!isNil(l)&&l!==1&&(e.globalAlpha=s),this.stroke(e)),this.isFill()&&(!isNil(c)&&c!==1?(e.globalAlpha=c,this.fill(e),e.globalAlpha=s):this.fill(e)),this.afterDrawPath(e)},r.prototype.fill=function(e){this._drawText(e,!0)},r.prototype.stroke=function(e){this._drawText(e,!1)},r}(ShapeBase$1);function invertFromMatrix(a,r){if(r){var e=invert$1(r);return multiplyVec2$1(e,a)}return a}function getRefXY(a,r,e){var n=a.getTotalMatrix();if(n){var o=invertFromMatrix([r,e,1],n),s=o[0],l=o[1];return[s,l]}return[r,e]}function preTest(a,r,e){if(a.isCanvas&&a.isCanvas())return!0;if(!isAllowCapture(a)||a.cfg.isInView===!1)return!1;if(a.cfg.clipShape){var n=getRefXY(a,r,e),o=n[0],s=n[1];if(a.isClipped(o,s))return!1}var l=a.cfg.cacheCanvasBBox||a.getCanvasBBox();return r>=l.minX&&r<=l.maxX&&e>=l.minY&&e<=l.maxY}function getShape(a,r,e){if(!preTest(a,r,e))return null;for(var n=null,o=a.getChildren(),s=o.length,l=s-1;l>=0;l--){var c=o[l];if(c.isGroup())n=getShape(c,r,e);else if(preTest(c,r,e)){var u=c,f=getRefXY(c,r,e),d=f[0],g=f[1];u.isInShape(d,g)&&(n=c)}if(n)break}return n}var Canvas$1=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){var e=a.prototype.getDefaultCfg.call(this);return e.renderer="canvas",e.autoDraw=!0,e.localRefresh=!0,e.refreshElements=[],e.clipView=!0,e.quickHit=!1,e},r.prototype.onCanvasChange=function(e){(e==="attr"||e==="sort"||e==="changeSize")&&(this.set("refreshElements",[this]),this.draw())},r.prototype.getShapeBase=function(){return Shape$1},r.prototype.getGroupBase=function(){return Group$1},r.prototype.getPixelRatio=function(){var e=this.get("pixelRatio")||getPixelRatio$1();return e>=1?Math.ceil(e):1},r.prototype.getViewRange=function(){return{minX:0,minY:0,maxX:this.cfg.width,maxY:this.cfg.height}},r.prototype.createDom=function(){var e=document.createElement("canvas"),n=e.getContext("2d");return this.set("context",n),e},r.prototype.setDOMSize=function(e,n){a.prototype.setDOMSize.call(this,e,n);var o=this.get("context"),s=this.get("el"),l=this.getPixelRatio();s.width=l*e,s.height=l*n,l>1&&o.scale(l,l)},r.prototype.clear=function(){a.prototype.clear.call(this),this._clearFrame();var e=this.get("context"),n=this.get("el");e.clearRect(0,0,n.width,n.height)},r.prototype.getShape=function(e,n){var o;return this.get("quickHit")?o=getShape(this,e,n):o=a.prototype.getShape.call(this,e,n,null),o},r.prototype._getRefreshRegion=function(){var e=this.get("refreshElements"),n=this.getViewRange(),o;if(e.length&&e[0]===this)o=n;else if(o=getMergedRegion(e),o){o.minX=Math.floor(o.minX),o.minY=Math.floor(o.minY),o.maxX=Math.ceil(o.maxX),o.maxY=Math.ceil(o.maxY),o.maxY+=1;var s=this.get("clipView");s&&(o=mergeView(o,n))}return o},r.prototype.refreshElement=function(e){var n=this.get("refreshElements");n.push(e)},r.prototype._clearFrame=function(){var e=this.get("drawFrame");e&&(cancelAnimationFrame$2(e),this.set("drawFrame",null),this.set("refreshElements",[]))},r.prototype.draw=function(){var e=this.get("drawFrame");this.get("autoDraw")&&e||this._startDraw()},r.prototype._drawAll=function(){var e=this.get("context"),n=this.get("el"),o=this.getChildren();e.clearRect(0,0,n.width,n.height),applyAttrsToContext(e,this),drawChildren$1(e,o),this.set("refreshElements",[])},r.prototype._drawRegion=function(){var e=this.get("context"),n=this.get("refreshElements"),o=this.getChildren(),s=this._getRefreshRegion();s?(e.clearRect(s.minX,s.minY,s.maxX-s.minX,s.maxY-s.minY),e.save(),e.beginPath(),e.rect(s.minX,s.minY,s.maxX-s.minX,s.maxY-s.minY),e.clip(),applyAttrsToContext(e,this),checkRefresh(this,o,s),drawChildren$1(e,o,s),e.restore()):n.length&&clearChanged(n),each$1(n,function(l){l.get("hasChanged")&&l.set("hasChanged",!1)}),this.set("refreshElements",[])},r.prototype._startDraw=function(){var e=this,n=this.get("drawFrame");n||(n=requestAnimationFrame$2(function(){e.get("localRefresh")?e._drawRegion():e._drawAll(),e.set("drawFrame",null)}),this.set("drawFrame",n))},r.prototype.skipDraw=function(){},r.prototype.removeDom=function(){var e=this.get("el");e.width=0,e.height=0,e.parentNode.removeChild(e)},r}(Canvas$2),version$2="0.5.12";const CanvasEngine=Object.freeze(Object.defineProperty({__proto__:null,AbstractCanvas:Canvas$2,AbstractGroup,AbstractShape,Base,Canvas:Canvas$1,Event:GraphEvent,Group:Group$1,PathUtil:PathUtil$1,Shape:Shape$1,assembleFont,getArcParams,getBBoxMethod:getMethod,getOffScreenContext,getTextHeight,invert:invert$1,isAllowCapture,multiplyVec2:multiplyVec2$1,registerBBox:register,registerEasing,version:version$2},Symbol.toStringTag,{value:"Module"}));var SHAPE_TO_TAGS={rect:"path",circle:"circle",line:"line",path:"path",marker:"path",text:"text",polyline:"polyline",polygon:"polygon",image:"image",ellipse:"ellipse",dom:"foreignObject"},SVG_ATTR_MAP={opacity:"opacity",fillStyle:"fill",fill:"fill",fillOpacity:"fill-opacity",strokeStyle:"stroke",strokeOpacity:"stroke-opacity",stroke:"stroke",x:"x",y:"y",r:"r",rx:"rx",ry:"ry",width:"width",height:"height",x1:"x1",x2:"x2",y1:"y1",y2:"y2",lineCap:"stroke-linecap",lineJoin:"stroke-linejoin",lineWidth:"stroke-width",lineDash:"stroke-dasharray",lineDashOffset:"stroke-dashoffset",miterLimit:"stroke-miterlimit",font:"font",fontSize:"font-size",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",fontFamily:"font-family",startArrow:"marker-start",endArrow:"marker-end",path:"d",class:"class",id:"id",style:"style",preserveAspectRatio:"preserveAspectRatio"};function createSVGElement(a){return document.createElementNS("http://www.w3.org/2000/svg",a)}function createDom(a){var r=SHAPE_TO_TAGS[a.type],e=a.getParent();if(!r)throw new Error("the type "+a.type+" is not supported by svg");var n=createSVGElement(r);if(a.get("id")&&(n.id=a.get("id")),a.set("el",n),a.set("attrs",{}),e){var o=e.get("el");o||(o=e.createDom(),e.set("el",o)),o.appendChild(n)}return n}function sortDom(a,r){var e=a.get("el"),n=toArray(e.children).sort(r),o=document.createDocumentFragment();n.forEach(function(s){o.appendChild(s)}),e.appendChild(o)}function moveTo(a,r){var e=a.parentNode,n=Array.from(e.childNodes).filter(function(c){return c.nodeType===1&&c.nodeName.toLowerCase()!=="defs"}),o=n[r],s=n.indexOf(a);if(o){if(s>r)e.insertBefore(a,o);else if(s<r){var l=n[r+1];l?e.insertBefore(a,l):e.appendChild(a)}}else e.appendChild(a)}function setShadow(a,r){var e=a.cfg.el,n=a.attr(),o={dx:n.shadowOffsetX,dy:n.shadowOffsetY,blur:n.shadowBlur,color:n.shadowColor};if(!o.dx&&!o.dy&&!o.blur&&!o.color)e.removeAttribute("filter");else{var s=r.find("filter",o);s||(s=r.addShadow(o)),e.setAttribute("filter","url(#"+s+")")}}function setTransform(a){var r=a.attr().matrix;if(r){for(var e=a.cfg.el,n=[],o=0;o<9;o+=3)n.push(r[o]+","+r[o+1]);n=n.join(","),n.indexOf("NaN")===-1?e.setAttribute("transform","matrix("+n+")"):console.warn("invalid matrix:",r)}}function setClip(a,r){var e=a.getClip(),n=a.get("el");if(!e)n.removeAttribute("clip-path");else if(e&&!n.hasAttribute("clip-path")){createDom(e),e.createPath(r);var o=r.addClip(e);n.setAttribute("clip-path","url(#"+o+")")}}function drawChildren(a,r){r.forEach(function(e){e.draw(a)})}function refreshElement(a,r){var e=a.get("canvas");if(e&&e.get("autoDraw")){var n=e.get("context"),o=a.getParent(),s=o?o.getChildren():[e],l=a.get("el");if(r==="remove"){var c=a.get("isClipShape");if(c){var u=l&&l.parentNode,f=u&&u.parentNode;u&&f&&f.removeChild(u)}else l&&l.parentNode&&l.parentNode.removeChild(l)}else if(r==="show")l.setAttribute("visibility","visible");else if(r==="hide")l.setAttribute("visibility","hidden");else if(r==="zIndex")moveTo(l,s.indexOf(a));else if(r==="sort"){var d=a.get("children");d&&d.length&&sortDom(a,function(g,p){return d.indexOf(g)-d.indexOf(p)?1:0})}else r==="clear"?l&&(l.innerHTML=""):r==="matrix"?setTransform(a):r==="clip"?setClip(a,n):r==="attr"||r==="add"&&a.draw(n)}}var Group=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.isEntityGroup=function(){return!0},r.prototype.createDom=function(){var e=createSVGElement("g");this.set("el",e);var n=this.getParent();if(n){var o=n.get("el");o||(o=n.createDom(),n.set("el",o)),o.appendChild(e)}return e},r.prototype.afterAttrsChange=function(e){a.prototype.afterAttrsChange.call(this,e);var n=this.get("canvas");if(n&&n.get("autoDraw")){var o=n.get("context");this.createPath(o,e)}},r.prototype.onCanvasChange=function(e){refreshElement(this,e)},r.prototype.getShapeBase=function(){return Shape},r.prototype.getGroupBase=function(){return r},r.prototype.draw=function(e){var n=this.getChildren(),o=this.get("el");this.get("destroyed")?o&&o.parentNode.removeChild(o):(o||this.createDom(),setClip(this,e),this.createPath(e),n.length&&drawChildren(e,n))},r.prototype.createPath=function(e,n){var o=this.attr(),s=this.get("el");each$1(n||o,function(l,c){SVG_ATTR_MAP[c]&&s.setAttribute(SVG_ATTR_MAP[c],l)}),setTransform(this)},r}(AbstractGroup),ShapeBase=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="svg",e.canFill=!1,e.canStroke=!1,e}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{lineWidth:1,lineAppendWidth:0,strokeOpacity:1,fillOpacity:1})},r.prototype.afterAttrsChange=function(e){a.prototype.afterAttrsChange.call(this,e);var n=this.get("canvas");if(n&&n.get("autoDraw")){var o=n.get("context");this.draw(o,e)}},r.prototype.getShapeBase=function(){return Shape},r.prototype.getGroupBase=function(){return Group},r.prototype.onCanvasChange=function(e){refreshElement(this,e)},r.prototype.calculateBBox=function(){var e=this.get("el"),n=null;if(e)n=e.getBBox();else{var o=getMethod(this.get("type"));o&&(n=o(this))}if(n){var s=n.x,l=n.y,c=n.width,u=n.height,f=this.getHitLineWidth(),d=f/2,g=s-d,p=l-d,v=s+c+d,m=l+u+d;return{x:g,y:p,minX:g,minY:p,maxX:v,maxY:m,width:c+f,height:u+f}}return{x:0,y:0,minX:0,minY:0,maxX:0,maxY:0,width:0,height:0}},r.prototype.isFill=function(){var e=this.attr(),n=e.fill,o=e.fillStyle;return(n||o||this.isClipShape())&&this.canFill},r.prototype.isStroke=function(){var e=this.attr(),n=e.stroke,o=e.strokeStyle;return(n||o)&&this.canStroke},r.prototype.draw=function(e,n){var o=this.get("el");this.get("destroyed")?o&&o.parentNode.removeChild(o):(o||createDom(this),setClip(this,e),this.createPath(e,n),this.shadow(e,n),this.strokeAndFill(e,n),this.transform(n))},r.prototype.createPath=function(e,n){},r.prototype.strokeAndFill=function(e,n){var o=n||this.attr(),s=o.fill,l=o.fillStyle,c=o.stroke,u=o.strokeStyle,f=o.fillOpacity,d=o.strokeOpacity,g=o.lineWidth,p=this.get("el");this.canFill&&(n?"fill"in o?this._setColor(e,"fill",s):"fillStyle"in o&&this._setColor(e,"fill",l):this._setColor(e,"fill",s||l),f&&p.setAttribute(SVG_ATTR_MAP.fillOpacity,f)),this.canStroke&&g>0&&(n?"stroke"in o?this._setColor(e,"stroke",c):"strokeStyle"in o&&this._setColor(e,"stroke",u):this._setColor(e,"stroke",c||u),d&&p.setAttribute(SVG_ATTR_MAP.strokeOpacity,d),g&&p.setAttribute(SVG_ATTR_MAP.lineWidth,g))},r.prototype._setColor=function(e,n,o){var s=this.get("el");if(!o){s.setAttribute(SVG_ATTR_MAP[n],"none");return}if(o=o.trim(),/^[r,R,L,l]{1}[\s]*\(/.test(o)){var l=e.find("gradient",o);l||(l=e.addGradient(o)),s.setAttribute(SVG_ATTR_MAP[n],"url(#"+l+")")}else if(/^[p,P]{1}[\s]*\(/.test(o)){var l=e.find("pattern",o);l||(l=e.addPattern(o)),s.setAttribute(SVG_ATTR_MAP[n],"url(#"+l+")")}else s.setAttribute(SVG_ATTR_MAP[n],o)},r.prototype.shadow=function(e,n){var o=this.attr(),s=n||o,l=s.shadowOffsetX,c=s.shadowOffsetY,u=s.shadowBlur,f=s.shadowColor;(l||c||u||f)&&setShadow(this,e)},r.prototype.transform=function(e){var n=this.attr(),o=(e||n).matrix;o&&setTransform(this)},r.prototype.isInShape=function(e,n){return this.isPointInPath(e,n)},r.prototype.isPointInPath=function(e,n){var o=this.get("el"),s=this.get("canvas"),l=s.get("el").getBoundingClientRect(),c=e+l.left,u=n+l.top,f=document.elementFromPoint(c,u);return!!(f&&f.isEqualNode(o))},r.prototype.getHitLineWidth=function(){var e=this.attrs,n=e.lineWidth,o=e.lineAppendWidth;return this.isStroke()?n+o:0},r}(AbstractShape),Circle$1=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="circle",e.canFill=!0,e.canStroke=!0,e}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{x:0,y:0,r:0})},r.prototype.createPath=function(e,n){var o=this.attr(),s=this.get("el");each$1(n||o,function(l,c){c==="x"||c==="y"?s.setAttribute("c"+c,l):SVG_ATTR_MAP[c]&&s.setAttribute(SVG_ATTR_MAP[c],l)})},r}(ShapeBase),Dom=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="dom",e.canFill=!1,e.canStroke=!1,e}return r.prototype.createPath=function(e,n){var o=this.attr(),s=this.get("el");if(each$1(n||o,function(f,d){SVG_ATTR_MAP[d]&&s.setAttribute(SVG_ATTR_MAP[d],f)}),typeof o.html=="function"){var l=o.html.call(this,o);if(l instanceof Element||l instanceof HTMLDocument){for(var c=s.childNodes,u=c.length-1;u>=0;u--)s.removeChild(c[u]);s.appendChild(l)}else s.innerHTML=l}else s.innerHTML=o.html},r}(ShapeBase),Ellipse=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="ellipse",e.canFill=!0,e.canStroke=!0,e}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{x:0,y:0,rx:0,ry:0})},r.prototype.createPath=function(e,n){var o=this.attr(),s=this.get("el");each$1(n||o,function(l,c){c==="x"||c==="y"?s.setAttribute("c"+c,l):SVG_ATTR_MAP[c]&&s.setAttribute(SVG_ATTR_MAP[c],l)})},r}(ShapeBase),Image$1=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="image",e.canFill=!1,e.canStroke=!1,e}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{x:0,y:0,width:0,height:0})},r.prototype.createPath=function(e,n){var o=this,s=this.attr(),l=this.get("el");each$1(n||s,function(c,u){u==="img"?o._setImage(s.img):SVG_ATTR_MAP[u]&&l.setAttribute(SVG_ATTR_MAP[u],c)})},r.prototype.setAttr=function(e,n){this.attrs[e]=n,e==="img"&&this._setImage(n)},r.prototype._setImage=function(e){var n=this.attr(),o=this.get("el");if(isString$1(e))o.setAttribute("href",e);else if(e instanceof window.Image)n.width||(o.setAttribute("width",e.width),this.attr("width",e.width)),n.height||(o.setAttribute("height",e.height),this.attr("height",e.height)),o.setAttribute("href",e.src);else if(e instanceof HTMLElement&&isString$1(e.nodeName)&&e.nodeName.toUpperCase()==="CANVAS")o.setAttribute("href",e.toDataURL());else if(e instanceof ImageData){var s=document.createElement("canvas");s.setAttribute("width",""+e.width),s.setAttribute("height",""+e.height),s.getContext("2d").putImageData(e,0,0),n.width||(o.setAttribute("width",""+e.width),this.attr("width",e.width)),n.height||(o.setAttribute("height",""+e.height),this.attr("height",e.height)),o.setAttribute("href",s.toDataURL())}},r}(ShapeBase),Line$2=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="line",e.canFill=!1,e.canStroke=!0,e}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{x1:0,y1:0,x2:0,y2:0,startArrow:!1,endArrow:!1})},r.prototype.createPath=function(e,n){var o=this.attr(),s=this.get("el");each$1(n||o,function(l,c){if(c==="startArrow"||c==="endArrow")if(l){var u=isObject$1(l)?e.addArrow(o,SVG_ATTR_MAP[c]):e.getDefaultArrow(o,SVG_ATTR_MAP[c]);s.setAttribute(SVG_ATTR_MAP[c],"url(#"+u+")")}else s.removeAttribute(SVG_ATTR_MAP[c]);else SVG_ATTR_MAP[c]&&s.setAttribute(SVG_ATTR_MAP[c],l)})},r.prototype.getTotalLength=function(){var e=this.attr(),n=e.x1,o=e.y1,s=e.x2,l=e.y2;return LineUtil.length(n,o,s,l)},r.prototype.getPoint=function(e){var n=this.attr(),o=n.x1,s=n.y1,l=n.x2,c=n.y2;return LineUtil.pointAt(o,s,l,c,e)},r}(ShapeBase),Symbols={circle:function(a,r,e){return[["M",a,r],["m",-e,0],["a",e,e,0,1,0,e*2,0],["a",e,e,0,1,0,-e*2,0]]},square:function(a,r,e){return[["M",a-e,r-e],["L",a+e,r-e],["L",a+e,r+e],["L",a-e,r+e],["Z"]]},diamond:function(a,r,e){return[["M",a-e,r],["L",a,r-e],["L",a+e,r],["L",a,r+e],["Z"]]},triangle:function(a,r,e){var n=e*Math.sin(.3333333333333333*Math.PI);return[["M",a-e,r+n],["L",a,r-n],["L",a+e,r+n],["z"]]},triangleDown:function(a,r,e){var n=e*Math.sin(.3333333333333333*Math.PI);return[["M",a-e,r-n],["L",a+e,r-n],["L",a,r+n],["Z"]]}};const symbolsFactory={get:function(a){return Symbols[a]},register:function(a,r){Symbols[a]=r},remove:function(a){delete Symbols[a]},getAll:function(){return Symbols}};var Marker=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="marker",e.canFill=!0,e.canStroke=!0,e}return r.prototype.createPath=function(e){var n=this.get("el");n.setAttribute("d",this._assembleMarker())},r.prototype._assembleMarker=function(){var e=this._getPath();return isArray$4(e)?e.map(function(n){return n.join(" ")}).join(""):e},r.prototype._getPath=function(){var e=this.attr(),n=e.x,o=e.y,s=e.r||e.radius,l=e.symbol||"circle",c;return isFunction$1(l)?c=l:c=symbolsFactory.get(l),c?c(n,o,s):(console.warn(c+" symbol is not exist."),null)},r.symbolsFactory=symbolsFactory,r}(ShapeBase),Path$1=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="path",e.canFill=!0,e.canStroke=!0,e}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{startArrow:!1,endArrow:!1})},r.prototype.createPath=function(e,n){var o=this,s=this.attr(),l=this.get("el");each$1(n||s,function(c,u){if(u==="path"&&isArray$4(c))l.setAttribute("d",o._formatPath(c));else if(u==="startArrow"||u==="endArrow")if(c){var f=isObject$1(c)?e.addArrow(s,SVG_ATTR_MAP[u]):e.getDefaultArrow(s,SVG_ATTR_MAP[u]);l.setAttribute(SVG_ATTR_MAP[u],"url(#"+f+")")}else l.removeAttribute(SVG_ATTR_MAP[u]);else SVG_ATTR_MAP[u]&&l.setAttribute(SVG_ATTR_MAP[u],c)})},r.prototype._formatPath=function(e){var n=e.map(function(o){return o.join(" ")}).join("");return~n.indexOf("NaN")?"":n},r.prototype.getTotalLength=function(){var e=this.get("el");return e?e.getTotalLength():null},r.prototype.getPoint=function(e){var n=this.get("el"),o=this.getTotalLength();if(o===0)return null;var s=n?n.getPointAtLength(e*o):null;return s?{x:s.x,y:s.y}:null},r}(ShapeBase),Polygon$1=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="polygon",e.canFill=!0,e.canStroke=!0,e}return r.prototype.createPath=function(e,n){var o=this.attr(),s=this.get("el");each$1(n||o,function(l,c){c==="points"&&isArray$4(l)&&l.length>=2?s.setAttribute("points",l.map(function(u){return u[0]+","+u[1]}).join(" ")):SVG_ATTR_MAP[c]&&s.setAttribute(SVG_ATTR_MAP[c],l)})},r}(ShapeBase),Polyline=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="polyline",e.canFill=!0,e.canStroke=!0,e}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{startArrow:!1,endArrow:!1})},r.prototype.onAttrChange=function(e,n,o){a.prototype.onAttrChange.call(this,e,n,o),["points"].indexOf(e)!==-1&&this._resetCache()},r.prototype._resetCache=function(){this.set("totalLength",null),this.set("tCache",null)},r.prototype.createPath=function(e,n){var o=this.attr(),s=this.get("el");each$1(n||o,function(l,c){c==="points"&&isArray$4(l)&&l.length>=2?s.setAttribute("points",l.map(function(u){return u[0]+","+u[1]}).join(" ")):SVG_ATTR_MAP[c]&&s.setAttribute(SVG_ATTR_MAP[c],l)})},r.prototype.getTotalLength=function(){var e=this.attr().points,n=this.get("totalLength");return isNil(n)?(this.set("totalLength",PolylineUtil.length(e)),this.get("totalLength")):n},r.prototype.getPoint=function(e){var n=this.attr().points,o=this.get("tCache");o||(this._setTcache(),o=this.get("tCache"));var s,l;return each$1(o,function(c,u){e>=c[0]&&e<=c[1]&&(s=(e-c[0])/(c[1]-c[0]),l=u)}),LineUtil.pointAt(n[l][0],n[l][1],n[l+1][0],n[l+1][1],s)},r.prototype._setTcache=function(){var e=this.attr().points;if(!(!e||e.length===0)){var n=this.getTotalLength();if(!(n<=0)){var o=0,s=[],l,c;each$1(e,function(u,f){e[f+1]&&(l=[],l[0]=o/n,c=LineUtil.length(u[0],u[1],e[f+1][0],e[f+1][1]),o+=c,l[1]=o/n,s.push(l))}),this.set("tCache",s)}}},r.prototype.getStartTangent=function(){var e=this.attr().points,n=[];return n.push([e[1][0],e[1][1]]),n.push([e[0][0],e[0][1]]),n},r.prototype.getEndTangent=function(){var e=this.attr().points,n=e.length-1,o=[];return o.push([e[n-1][0],e[n-1][1]]),o.push([e[n][0],e[n][1]]),o},r}(ShapeBase);function parseRadius$1(a){var r=0,e=0,n=0,o=0;return isArray$4(a)?a.length===1?r=e=n=o=a[0]:a.length===2?(r=n=a[0],e=o=a[1]):a.length===3?(r=a[0],e=o=a[1],n=a[2]):(r=a[0],e=a[1],n=a[2],o=a[3]):r=e=n=o=a,{r1:r,r2:e,r3:n,r4:o}}var Rect$1=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="rect",e.canFill=!0,e.canStroke=!0,e}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{x:0,y:0,width:0,height:0,radius:0})},r.prototype.createPath=function(e,n){var o=this,s=this.attr(),l=this.get("el"),c=!1,u=["x","y","width","height","radius"];each$1(n||s,function(f,d){u.indexOf(d)!==-1&&!c?(l.setAttribute("d",o._assembleRect(s)),c=!0):u.indexOf(d)===-1&&SVG_ATTR_MAP[d]&&l.setAttribute(SVG_ATTR_MAP[d],f)})},r.prototype._assembleRect=function(e){var n=e.x,o=e.y,s=e.width,l=e.height,c=e.radius;if(!c)return"M "+n+","+o+" l "+s+",0 l 0,"+l+" l"+-s+" 0 z";var u=parseRadius$1(c);isArray$4(c)?c.length===1?u.r1=u.r2=u.r3=u.r4=c[0]:c.length===2?(u.r1=u.r3=c[0],u.r2=u.r4=c[1]):c.length===3?(u.r1=c[0],u.r2=u.r4=c[1],u.r3=c[2]):(u.r1=c[0],u.r2=c[1],u.r3=c[2],u.r4=c[3]):u.r1=u.r2=u.r3=u.r4=c;var f=[["M "+(n+u.r1)+","+o],["l "+(s-u.r1-u.r2)+",0"],["a "+u.r2+","+u.r2+",0,0,1,"+u.r2+","+u.r2],["l 0,"+(l-u.r2-u.r3)],["a "+u.r3+","+u.r3+",0,0,1,"+-u.r3+","+u.r3],["l "+(u.r3+u.r4-s)+",0"],["a "+u.r4+","+u.r4+",0,0,1,"+-u.r4+","+-u.r4],["l 0,"+(u.r4+u.r1-l)],["a "+u.r1+","+u.r1+",0,0,1,"+u.r1+","+-u.r1],["z"]];return f.join(" ")},r}(ShapeBase),LETTER_SPACING=.3,BASELINE_MAP={top:"before-edge",middle:"central",bottom:"after-edge",alphabetic:"baseline",hanging:"hanging"},BASELINE_MAP_FOR_FIREFOX={top:"text-before-edge",middle:"central",bottom:"text-after-edge",alphabetic:"alphabetic",hanging:"hanging"},ANCHOR_MAP={left:"left",start:"left",center:"middle",right:"end",end:"end"},Text=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="text",e.canFill=!0,e.canStroke=!0,e}return r.prototype.getDefaultAttrs=function(){var e=a.prototype.getDefaultAttrs.call(this);return __assign$8(__assign$8({},e),{x:0,y:0,text:null,fontSize:12,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",textAlign:"start",textBaseline:"bottom"})},r.prototype.createPath=function(e,n){var o=this,s=this.attr(),l=this.get("el");this._setFont(),each$1(n||s,function(c,u){u==="text"?o._setText(""+c):u==="matrix"&&c?setTransform(o):SVG_ATTR_MAP[u]&&l.setAttribute(SVG_ATTR_MAP[u],c)}),l.setAttribute("paint-order","stroke"),l.setAttribute("style","stroke-linecap:butt; stroke-linejoin:miter;")},r.prototype._setFont=function(){var e=this.get("el"),n=this.attr(),o=n.textBaseline,s=n.textAlign,l=detect();l&&l.name==="firefox"?e.setAttribute("dominant-baseline",BASELINE_MAP_FOR_FIREFOX[o]||"alphabetic"):e.setAttribute("alignment-baseline",BASELINE_MAP[o]||"baseline"),e.setAttribute("text-anchor",ANCHOR_MAP[s]||"left")},r.prototype._setText=function(e){var n=this.get("el"),o=this.attr(),s=o.x,l=o.textBaseline,c=l===void 0?"bottom":l;if(!e)n.innerHTML="";else if(~e.indexOf(`
`)){var u=e.split(`
`),f=u.length-1,d="";each$1(u,function(g,p){p===0?c==="alphabetic"?d+='<tspan x="'+s+'" dy="'+-f+'em">'+g+"</tspan>":c==="top"?d+='<tspan x="'+s+'" dy="0.9em">'+g+"</tspan>":c==="middle"?d+='<tspan x="'+s+'" dy="'+-(f-1)/2+'em">'+g+"</tspan>":c==="bottom"?d+='<tspan x="'+s+'" dy="-'+(f+LETTER_SPACING)+'em">'+g+"</tspan>":c==="hanging"&&(d+='<tspan x="'+s+'" dy="'+(-(f-1)-LETTER_SPACING)+'em">'+g+"</tspan>"):d+='<tspan x="'+s+'" dy="1em">'+g+"</tspan>"}),n.innerHTML=d}else n.innerHTML=e},r}(ShapeBase),regexLG=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,regexRG=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,regexColorStop=/[\d.]+:(#[^\s]+|[^)]+\))/gi;function addStop(a){var r=a.match(regexColorStop);if(!r)return"";var e="";return r.sort(function(n,o){return n=n.split(":"),o=o.split(":"),Number(n[0])-Number(o[0])}),each$1(r,function(n){n=n.split(":"),e+='<stop offset="'+n[0]+'" stop-color="'+n[1]+'"></stop>'}),e}function parseLineGradient(a,r){var e=regexLG.exec(a),n=mod$1(toRadian(parseFloat(e[1])),Math.PI*2),o=e[2],s,l;n>=0&&n<.5*Math.PI?(s={x:0,y:0},l={x:1,y:1}):.5*Math.PI<=n&&n<Math.PI?(s={x:1,y:0},l={x:0,y:1}):Math.PI<=n&&n<1.5*Math.PI?(s={x:1,y:1},l={x:0,y:0}):(s={x:0,y:1},l={x:1,y:0});var c=Math.tan(n),u=c*c,f=(l.x-s.x+c*(l.y-s.y))/(u+1)+s.x,d=c*(l.x-s.x+c*(l.y-s.y))/(u+1)+s.y;r.setAttribute("x1",s.x),r.setAttribute("y1",s.y),r.setAttribute("x2",f),r.setAttribute("y2",d),r.innerHTML=addStop(o)}function parseRadialGradient(a,r){var e=regexRG.exec(a),n=parseFloat(e[1]),o=parseFloat(e[2]),s=parseFloat(e[3]),l=e[4];r.setAttribute("cx",n),r.setAttribute("cy",o),r.setAttribute("r",s),r.innerHTML=addStop(l)}var Gradient=function(){function a(r){this.cfg={};var e=null,n=uniqueId("gradient_");return r.toLowerCase()[0]==="l"?(e=createSVGElement("linearGradient"),parseLineGradient(r,e)):(e=createSVGElement("radialGradient"),parseRadialGradient(r,e)),e.setAttribute("id",n),this.el=e,this.id=n,this.cfg=r,this}return a.prototype.match=function(r,e){return this.cfg===e},a}(),ATTR_MAP={shadowColor:"color",shadowOpacity:"opacity",shadowBlur:"blur",shadowOffsetX:"dx",shadowOffsetY:"dy"},SHADOW_DIMENSION={x:"-40%",y:"-40%",width:"200%",height:"200%"},Shadow=function(){function a(r){this.type="filter",this.cfg={},this.type="filter";var e=createSVGElement("filter");return each$1(SHADOW_DIMENSION,function(n,o){e.setAttribute(o,n)}),this.el=e,this.id=uniqueId("filter_"),this.el.id=this.id,this.cfg=r,this._parseShadow(r,e),this}return a.prototype.match=function(r,e){if(this.type!==r)return!1;var n=!0,o=this.cfg;return each$1(Object.keys(o),function(s){if(o[s]!==e[s])return n=!1,!1}),n},a.prototype.update=function(r,e){var n=this.cfg;return n[ATTR_MAP[r]]=e,this._parseShadow(n,this.el),this},a.prototype._parseShadow=function(r,e){var n=`<feDropShadow
      dx="`+(r.dx||0)+`"
      dy="`+(r.dy||0)+`"
      stdDeviation="`+(r.blur?r.blur/10:0)+`"
      flood-color="`+(r.color?r.color:"#000")+`"
      flood-opacity="`+(r.opacity?r.opacity:1)+`"
      />`;e.innerHTML=n},a}(),Arrow=function(){function a(r,e){this.cfg={};var n=createSVGElement("marker"),o=uniqueId("marker_");n.setAttribute("id",o);var s=createSVGElement("path");s.setAttribute("stroke",r.stroke||"none"),s.setAttribute("fill",r.fill||"none"),n.appendChild(s),n.setAttribute("overflow","visible"),n.setAttribute("orient","auto-start-reverse"),this.el=n,this.child=s,this.id=o;var l=r[e==="marker-start"?"startArrow":"endArrow"];return this.stroke=r.stroke||"#000",l===!0?this._setDefaultPath(e,s):(this.cfg=l,this._setMarker(r.lineWidth,s)),this}return a.prototype.match=function(){return!1},a.prototype._setDefaultPath=function(r,e){var n=this.el;e.setAttribute("d","M0,0 L"+10*Math.cos(Math.PI/6)+",5 L0,10"),n.setAttribute("refX",""+10*Math.cos(Math.PI/6)),n.setAttribute("refY","5")},a.prototype._setMarker=function(r,e){var n=this.el,o=this.cfg.path,s=this.cfg.d;isArray$4(o)&&(o=o.map(function(l){return l.join(" ")}).join("")),e.setAttribute("d",o),n.appendChild(e),s&&n.setAttribute("refX",""+s/r)},a.prototype.update=function(r){var e=this.child;e.attr?e.attr("fill",r):e.setAttribute("fill",r)},a}(),Clip=function(){function a(r){this.type="clip",this.cfg={};var e=createSVGElement("clipPath");this.el=e,this.id=uniqueId("clip_"),e.id=this.id;var n=r.cfg.el;return e.appendChild(n),this.cfg=r,this}return a.prototype.match=function(){return!1},a.prototype.remove=function(){var r=this.el;r.parentNode.removeChild(r)},a}(),regexPR=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,Pattern=function(){function a(r){this.cfg={};var e=createSVGElement("pattern");e.setAttribute("patternUnits","userSpaceOnUse");var n=createSVGElement("image");e.appendChild(n);var o=uniqueId("pattern_");e.id=o,this.el=e,this.id=o,this.cfg=r;var s=regexPR.exec(r),l=s[2];n.setAttribute("href",l);var c=new Image;l.match(/^data:/i)||(c.crossOrigin="Anonymous"),c.src=l;function u(){e.setAttribute("width",""+c.width),e.setAttribute("height",""+c.height)}return c.complete?u():(c.onload=u,c.src=c.src),this}return a.prototype.match=function(r,e){return this.cfg===e},a}(),Defs=function(){function a(r){var e=createSVGElement("defs"),n=uniqueId("defs_");e.id=n,r.appendChild(e),this.children=[],this.defaultArrow={},this.el=e,this.canvas=r}return a.prototype.find=function(r,e){for(var n=this.children,o=null,s=0;s<n.length;s++)if(n[s].match(r,e)){o=n[s].id;break}return o},a.prototype.findById=function(r){for(var e=this.children,n=null,o=0;o<e.length;o++)if(e[o].id===r){n=e[o];break}return n},a.prototype.add=function(r){this.children.push(r),r.canvas=this.canvas,r.parent=this},a.prototype.getDefaultArrow=function(r,e){var n=r.stroke||r.strokeStyle;if(this.defaultArrow[n])return this.defaultArrow[n].id;var o=new Arrow(r,e);return this.defaultArrow[n]=o,this.el.appendChild(o.el),this.add(o),o.id},a.prototype.addGradient=function(r){var e=new Gradient(r);return this.el.appendChild(e.el),this.add(e),e.id},a.prototype.addArrow=function(r,e){var n=new Arrow(r,e);return this.el.appendChild(n.el),this.add(n),n.id},a.prototype.addShadow=function(r){var e=new Shadow(r);return this.el.appendChild(e.el),this.add(e),e.id},a.prototype.addPattern=function(r){var e=new Pattern(r);return this.el.appendChild(e.el),this.add(e),e.id},a.prototype.addClip=function(r){var e=new Clip(r);return this.el.appendChild(e.el),this.add(e),e.id},a}(),Canvas=function(a){__extends$7(r,a);function r(e){return a.call(this,__assign$8(__assign$8({},e),{autoDraw:!0,renderer:"svg"}))||this}return r.prototype.getShapeBase=function(){return Shape},r.prototype.getGroupBase=function(){return Group},r.prototype.getShape=function(e,n,o){var s=o.target||o.srcElement;if(!SHAPE_TO_TAGS[s.tagName]){for(var l=s.parentNode;l&&!SHAPE_TO_TAGS[l.tagName];)l=l.parentNode;s=l}return this.find(function(c){return c.get("el")===s})},r.prototype.createDom=function(){var e=createSVGElement("svg"),n=new Defs(e);return e.setAttribute("width",""+this.get("width")),e.setAttribute("height",""+this.get("height")),this.set("context",n),e},r.prototype.onCanvasChange=function(e){var n=this.get("context"),o=this.get("el");if(e==="sort"){var s=this.get("children");s&&s.length&&sortDom(this,function(c,u){return s.indexOf(c)-s.indexOf(u)?1:0})}else if(e==="clear"){if(o){o.innerHTML="";var l=n.el;l.innerHTML="",o.appendChild(l)}}else e==="matrix"?setTransform(this):e==="clip"?setClip(this,n):e==="changeSize"&&(o.setAttribute("width",""+this.get("width")),o.setAttribute("height",""+this.get("height")))},r.prototype.draw=function(){var e=this.get("context"),n=this.getChildren();setClip(this,e),n.length&&drawChildren(e,n)},r}(Canvas$2),version$1="0.5.6";const SVGEngine=Object.freeze(Object.defineProperty({__proto__:null,AbstractCanvas:Canvas$2,AbstractGroup,AbstractShape,Base,Canvas,Event:GraphEvent,Group,PathUtil:PathUtil$1,Shape,assembleFont,getBBoxMethod:getMethod,getOffScreenContext,getTextHeight,invert:invert$1,isAllowCapture,multiplyVec2:multiplyVec2$1,registerBBox:register,registerEasing,version:version$1},Symbol.toStringTag,{value:"Module"}));var Path=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;n.type="path",n.shapeType="line";var o=e.connectNulls,s=o===void 0?!1:o,l=e.showSinglePoint,c=l===void 0?!0:l;return n.connectNulls=s,n.showSinglePoint=c,n}return r.prototype.updateElements=function(e,n){var o,s,l,c,u,f;n===void 0&&(n=!1);for(var d=new Map,g=new Map,p=[],v=0,m=0;m<e.length;m++){var y=e[m],x=this.getElementId(y);p.push(x),d.set(x,y),g.set(x,v),v++}this.elements=new Array(v);var _=diff$2(this.lastElementsMap,p),E=_.added,S=_.updated,A=_.removed;try{for(var T=__values(E),b=T.next();!b.done;b=T.next()){var x=b.value,y=d.get(x),C=this.getShapeFactory(),L=this.getShapeInfo(y),m=g.get(x),R=new Element$1({shapeFactory:C,container:this.container,offscreenGroup:this.getOffscreenGroup(),elementIndex:m});R.geometry=this,R.animate=this.animateOption,R.draw(L,n),this.elementsMap[x]=R,this.elements[m]=R}}catch(F){o={error:F}}finally{try{b&&!b.done&&(s=T.return)&&s.call(T)}finally{if(o)throw o.error}}try{for(var I=__values(S),w=I.next();!w.done;w=I.next()){var x=w.value,y=d.get(x),R=this.lastElementsMap[x],m=g.get(x),L=this.getShapeInfo(y),M=R.getModel();(this.isCoordinateChanged||isModelChange(M,L))&&(R.animate=this.animateOption,R.update(L)),this.elementsMap[x]=R,this.elements[m]=R}}catch(F){l={error:F}}finally{try{w&&!w.done&&(c=I.return)&&c.call(I)}finally{if(l)throw l.error}}try{for(var D=__values(A),O=D.next();!O.done;O=D.next()){var x=O.value,R=this.lastElementsMap[x];R.animate=this.animateOption,R.destroy()}}catch(F){u={error:F}}finally{try{O&&!O.done&&(f=D.return)&&f.call(D)}finally{if(u)throw u.error}}},r.prototype.getPointsAndData=function(e){for(var n=[],o=[],s=0,l=e.length;s<l;s++){var c=e[s];n.push({x:c.x,y:c.y}),o.push(c[FIELD_ORIGIN])}return{points:n,data:o}},r.prototype.getShapeInfo=function(e){var n=this.getDrawCfg(e[0]),o=this.getPointsAndData(e),s=o.points,l=o.data;return n.mappingData=e,n.data=l,n.isStack=!!this.getAdjust("stack"),n.points=s,n.connectNulls=this.connectNulls,n.showSinglePoint=this.showSinglePoint,n},r}(Geometry);function getPath$2(a,r,e,n,o){var s=[];if(a.length){for(var l=[],c=[],u=0,f=a.length;u<f;u++){var d=a[u];l.push(d[1]),c.push(d[0])}c=c.reverse(),each$1([l,c],function(g,p){var v=[],m=n.parsePoints(g),y=m[0];l.length===1&&c.length===1?v=p===0?[["M",y.x-.5,y.y],["L",y.x+.5,y.y]]:[["L",y.x+.5,y.y],["L",y.x-.5,y.y]]:(r&&m.push({x:y.x,y:y.y}),e?v=getSplinePath$1(m,!1,o):v=getLinePath(m,!1),p>0&&(v[0][0]="L")),s=s.concat(v)}),s.push(["Z"])}return s}function getShapeAttrs(a,r,e,n,o){for(var s=getStyle(a,r,!r,"lineWidth"),l=a.connectNulls,c=a.isInCircle,u=a.points,f=a.showSinglePoint,d=getPathPoints(u,l,f),g=[],p=0,v=d.length;p<v;p++){var m=d[p];g=g.concat(getPath$2(m,c,e,n,o))}return s.path=g,s}function getConstraint(a){var r=a.start,e=a.end;return[[r.x,e.y],[e.x,r.y]]}registerShapeFactory("area",{defaultShapeType:"area",getDefaultPoints:function(a){var r=a.x,e=a.y0,n=isArray$4(a.y)?a.y:[e,a.y];return n.map(function(o){return{x:r,y:o}})}});registerShape("area","area",{draw:function(a,r){var e=getShapeAttrs(a,!1,!1,this),n=r.addShape({type:"path",attrs:e,name:"area"});return n},getMarker:function(a){var r=a.color;return{symbol:function(e,n,o){return o===void 0&&(o=5.5),[["M",e-o,n-4],["L",e+o,n-4],["L",e+o,n+4],["L",e-o,n+4],["Z"]]},style:{r:5,fill:r,fillOpacity:1}}}});var Area$1=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;n.type="area",n.shapeType="area",n.generatePoints=!0,n.startOnZero=!0;var o=e.startOnZero,s=o===void 0?!0:o,l=e.sortable,c=l===void 0?!1:l,u=e.showSinglePoint,f=u===void 0?!1:u;return n.startOnZero=s,n.sortable=c,n.showSinglePoint=f,n}return r.prototype.getPointsAndData=function(e){for(var n=[],o=[],s=0,l=e.length;s<l;s++){var c=e[s];n.push(c.points),o.push(c[FIELD_ORIGIN])}return{points:n,data:o}},r.prototype.getYMinValue=function(){if(this.startOnZero)return a.prototype.getYMinValue.call(this);var e=this.getYScale();return e.min},r}(Path);registerShapeFactory("edge",{defaultShapeType:"line",getDefaultPoints:function(a){return splitPoints(a)}});registerShape("edge","line",{draw:function(a,r){var e=getStyle(a,!0,!1,"lineWidth"),n=getLinePath(this.parsePoints(a.points),this.coordinate.isPolar);return r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:n})})},getMarker:function(a){return{symbol:"circle",style:{r:4.5,fill:a.color}}}});var Edge=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="edge",e.shapeType="edge",e.generatePoints=!0,e}return r}(Geometry),Heatmap$1=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="heatmap",e.paletteCache={},e}return r.prototype.updateElements=function(e,n){for(var o=0;o<e.length;o++){var s=e[o],l=this.prepareRange(s),c=this.prepareSize(),u=get(this.styleOption,["cfg","shadowBlur"]);isNumber$2(u)||(u=c/2),this.prepareGreyScaleBlurredCircle(c,u),this.drawWithRange(s,l,c,u)}},r.prototype.color=function(e,n){return this.createAttrOption("color",e,typeof n!="function"?n:""),this},r.prototype.clear=function(){a.prototype.clear.call(this),this.clearShadowCanvasCtx(),this.paletteCache={}},r.prototype.prepareRange=function(e){var n=this.getAttribute("color"),o=n.getFields()[0],s=1/0,l=-1/0;return e.forEach(function(c){var u=c[FIELD_ORIGIN][o];u>l&&(l=u),u<s&&(s=u)}),s===l&&(s=l-1),[s,l]},r.prototype.prepareSize=function(){var e=this.getDefaultValue("size");return isNumber$2(e)||(e=this.getDefaultSize()),e},r.prototype.prepareGreyScaleBlurredCircle=function(e,n){var o=this.getGrayScaleBlurredCanvas(),s=e+n,l=o.getContext("2d");o.width=o.height=s*2,l.clearRect(0,0,o.width,o.height),l.shadowOffsetX=l.shadowOffsetY=s*2,l.shadowBlur=n,l.shadowColor="black",l.beginPath(),l.arc(-s,-s,e,0,Math.PI*2,!0),l.closePath(),l.fill()},r.prototype.drawWithRange=function(e,n,o,s){var l,c,u=this.coordinate,f=u.start,d=u.end,g=this.coordinate.getWidth(),p=this.coordinate.getHeight(),v=this.getAttribute("color"),m=v.getFields()[0];this.clearShadowCanvasCtx();var y=this.getShadowCanvasCtx();n&&(e=e.filter(function(I){return I[FIELD_ORIGIN][m]<=n[1]&&I[FIELD_ORIGIN][m]>=n[0]}));var x=this.scales[m];try{for(var _=__values(e),E=_.next();!E.done;E=_.next()){var S=E.value,A=this.getDrawCfg(S),T=A.x,b=A.y,C=x.scale(S[FIELD_ORIGIN][m]);this.drawGrayScaleBlurredCircle(T-f.x,b-d.y,o+s,C,y)}}catch(I){l={error:I}}finally{try{E&&!E.done&&(c=_.return)&&c.call(_)}finally{if(l)throw l.error}}var L=y.getImageData(0,0,g,p);this.clearShadowCanvasCtx(),this.colorize(L),y.putImageData(L,0,0);var R=this.getImageShape();R.attr("x",f.x),R.attr("y",d.y),R.attr("width",g),R.attr("height",p),R.attr("img",y.canvas),R.set("origin",this.getShapeInfo(e))},r.prototype.getDefaultSize=function(){var e=this.getAttribute("position"),n=this.coordinate;return Math.min(n.getWidth()/(e.scales[0].ticks.length*4),n.getHeight()/(e.scales[1].ticks.length*4))},r.prototype.clearShadowCanvasCtx=function(){var e=this.getShadowCanvasCtx();e.clearRect(0,0,e.canvas.width,e.canvas.height)},r.prototype.getShadowCanvasCtx=function(){var e=this.shadowCanvas;return e||(e=document.createElement("canvas"),this.shadowCanvas=e),e.width=this.coordinate.getWidth(),e.height=this.coordinate.getHeight(),e.getContext("2d")},r.prototype.getGrayScaleBlurredCanvas=function(){return this.grayScaleBlurredCanvas||(this.grayScaleBlurredCanvas=document.createElement("canvas")),this.grayScaleBlurredCanvas},r.prototype.drawGrayScaleBlurredCircle=function(e,n,o,s,l){var c=this.getGrayScaleBlurredCanvas();l.globalAlpha=s,l.drawImage(c,e-o,n-o)},r.prototype.colorize=function(e){for(var n=this.getAttribute("color"),o=e.data,s=this.paletteCache,l=3;l<o.length;l+=4){var c=o[l];if(isNumber$2(c)){var u=s[c]?s[c]:colorUtil.rgb2arr(n.gradient(c/256));o[l-3]=u[0],o[l-2]=u[1],o[l-1]=u[2],o[l]=c}}},r.prototype.getImageShape=function(){var e=this.imageShape;if(e)return e;var n=this.container;return e=n.addShape({type:"image",attrs:{}}),this.imageShape=e,e},r.prototype.getShapeInfo=function(e){var n=this.getDrawCfg(e[0]),o=e.map(function(s){return s[FIELD_ORIGIN]});return __assign$8(__assign$8({},n),{mappingData:e,data:o})},r}(Geometry);function getRectPoints$1(a){var r,e,n=a.x,o=a.y,s=a.y0,l=a.size,c,u;isArray$4(o)?(r=__read(o,2),c=r[0],u=r[1]):(c=s,u=o);var f,d;isArray$4(n)?(e=__read(n,2),f=e[0],d=e[1]):(f=n-l/2,d=n+l/2);var g=[{x:f,y:c},{x:f,y:u}];return g.push({x:d,y:u},{x:d,y:c}),g}function getRectPath$1(a,r){r===void 0&&(r=!0);var e=[],n=a[0];e.push(["M",n.x,n.y]);for(var o=1,s=a.length;o<s;o++)e.push(["L",a[o].x,a[o].y]);return r&&(e.push(["L",n.x,n.y]),e.push(["z"])),e}function parseRadius(a,r){var e=0,n=0,o=0,s=0;return isArray$4(a)?a.length===1?e=n=o=s=a[0]:a.length===2?(e=o=a[0],n=s=a[1]):a.length===3?(e=a[0],n=s=a[1],o=a[2]):(e=a[0],n=a[1],o=a[2],s=a[3]):e=n=o=s=a,e+n>r&&(e=e?r/(1+n/e):0,n=r-e),o+s>r&&(o=o?r/(1+s/o):0,s=r-o),[e||0,n||0,o||0,s||0]}function getBackgroundRectPath(a,r,e){var n=[];if(e.isRect){var o=e.isTransposed?{x:e.start.x,y:r[0].y}:{x:r[0].x,y:e.start.y},s=e.isTransposed?{x:e.end.x,y:r[2].y}:{x:r[3].x,y:e.end.y},l=get(a,["background","style","radius"]);if(l){var c=e.isTransposed?Math.abs(r[0].y-r[2].y):r[2].x-r[1].x,u=e.isTransposed?e.getWidth():e.getHeight(),f=__read(parseRadius(l,Math.min(c,u)),4),d=f[0],g=f[1],p=f[2],v=f[3],m=e.isTransposed&&e.isReflect("y"),y=m?0:1,x=function(b){return m?-b:b};n.push(["M",o.x,s.y+x(d)]),d!==0&&n.push(["A",d,d,0,0,y,o.x+d,s.y]),n.push(["L",s.x-g,s.y]),g!==0&&n.push(["A",g,g,0,0,y,s.x,s.y+x(g)]),n.push(["L",s.x,o.y-x(p)]),p!==0&&n.push(["A",p,p,0,0,y,s.x-p,o.y]),n.push(["L",o.x+v,o.y]),v!==0&&n.push(["A",v,v,0,0,y,o.x,o.y-x(v)])}else n.push(["M",o.x,o.y]),n.push(["L",s.x,o.y]),n.push(["L",s.x,s.y]),n.push(["L",o.x,s.y]),n.push(["L",o.x,o.y]);n.push(["z"])}if(e.isPolar){var _=e.getCenter(),E=getAngle$1(a,e),S=E.startAngle,A=E.endAngle;if(e.type!=="theta"&&!e.isTransposed)n=getSectorPath(_.x,_.y,e.getRadius(),S,A);else{var T=function(L){return Math.pow(L,2)},d=Math.sqrt(T(_.x-r[0].x)+T(_.y-r[0].y)),g=Math.sqrt(T(_.x-r[2].x)+T(_.y-r[2].y));n=getSectorPath(_.x,_.y,d,e.startAngle,e.endAngle,g)}}return n}function getIntervalRectPath(a,r,e){var n=e.getWidth(),o=e.getHeight(),s=e.type==="rect",l=[],c=(a[2].x-a[1].x)/2,u=e.isTransposed?c*o/n:c*n/o;return r==="round"?(s?(l.push(["M",a[0].x,a[0].y+u]),l.push(["L",a[1].x,a[1].y-u]),l.push(["A",c,c,0,0,1,a[2].x,a[2].y-u]),l.push(["L",a[3].x,a[3].y+u]),l.push(["A",c,c,0,0,1,a[0].x,a[0].y+u])):(l.push(["M",a[0].x,a[0].y]),l.push(["L",a[1].x,a[1].y]),l.push(["A",c,c,0,0,1,a[2].x,a[2].y]),l.push(["L",a[3].x,a[3].y]),l.push(["A",c,c,0,0,1,a[0].x,a[0].y])),l.push(["z"])):l=getRectPath$1(a),l}function getFunnelPath(a,r,e){var n=[];return isNil(r)?e?n.push(["M",a[0].x,a[0].y],["L",a[1].x,a[1].y],["L",(a[2].x+a[3].x)/2,(a[2].y+a[3].y)/2],["Z"]):n.push(["M",a[0].x,a[0].y],["L",a[1].x,a[1].y],["L",a[2].x,a[2].y],["L",a[3].x,a[3].y],["Z"]):n.push(["M",a[0].x,a[0].y],["L",a[1].x,a[1].y],["L",r[1].x,r[1].y],["L",r[0].x,r[0].y],["Z"]),n}function swap$2(a,r){return[r,a]}function getRectWithCornerRadius(a,r,e){var n,o,s,l,c,u,f,d=__read(__spreadArray$2([],__read(a),!1),4),g=d[0],p=d[1],v=d[2],m=d[3],y=__read(typeof e=="number"?Array(4).fill(e):e,4),x=y[0],_=y[1],E=y[2],S=y[3];r.isTransposed&&(n=__read(swap$2(p,m),2),p=n[0],m=n[1]),r.isReflect("y")&&(o=__read(swap$2(g,p),2),g=o[0],p=o[1],s=__read(swap$2(v,m),2),v=s[0],m=s[1]),r.isReflect("x")&&(l=__read(swap$2(g,m),2),g=l[0],m=l[1],c=__read(swap$2(p,v),2),p=c[0],v=c[1]);var A=[],T=function(b){return Math.abs(b)};return u=__read(parseRadius([x,_,E,S],Math.min(T(m.x-g.x),T(p.y-g.y))).map(function(b){return T(b)}),4),x=u[0],_=u[1],E=u[2],S=u[3],r.isTransposed&&(f=__read([S,x,_,E],4),x=f[0],_=f[1],E=f[2],S=f[3]),g.y<p.y?(A.push(["M",m.x,m.y+E]),E!==0&&A.push(["A",E,E,0,0,0,m.x-E,m.y]),A.push(["L",g.x+S,g.y]),S!==0&&A.push(["A",S,S,0,0,0,g.x,g.y+S]),A.push(["L",p.x,p.y-x]),x!==0&&A.push(["A",x,x,0,0,0,p.x+x,p.y]),A.push(["L",v.x-_,v.y]),_!==0&&A.push(["A",_,_,0,0,0,v.x,v.y-_]),A.push(["L",m.x,m.y+E]),A.push(["z"])):m.x<g.x?(A.push(["M",v.x+_,v.y]),_!==0&&A.push(["A",_,_,0,0,0,v.x,v.y+_]),A.push(["L",m.x,m.y-E]),E!==0&&A.push(["A",E,E,0,0,0,m.x+E,m.y]),A.push(["L",g.x-S,g.y]),S!==0&&A.push(["A",S,S,0,0,0,g.x,g.y-S]),A.push(["L",p.x,p.y+x]),x!==0&&A.push(["A",x,x,0,0,0,p.x-x,p.y]),A.push(["L",v.x+_,v.y]),A.push(["z"])):(A.push(["M",p.x,p.y+x]),x!==0&&A.push(["A",x,x,0,0,1,p.x+x,p.y]),A.push(["L",v.x-_,v.y]),_!==0&&A.push(["A",_,_,0,0,1,v.x,v.y+_]),A.push(["L",m.x,m.y-E]),E!==0&&A.push(["A",E,E,0,0,1,m.x-E,m.y]),A.push(["L",g.x+S,g.y]),S!==0&&A.push(["A",S,S,0,0,1,g.x,g.y-S]),A.push(["L",p.x,p.y+x]),A.push(["z"])),A}registerShapeFactory("interval",{defaultShapeType:"rect",getDefaultPoints:function(a){return getRectPoints$1(a)}});registerShape("interval","rect",{draw:function(a,r){var e=getStyle(a,!1,!0),n=r,o=a==null?void 0:a.background;if(o){n=r.addGroup({name:"interval-group"});var s=getBackgroundRectStyle(a),l=getBackgroundRectPath(a,this.parsePoints(a.points),this.coordinate);n.addShape("path",{attrs:__assign$8(__assign$8({},s),{path:l}),capture:!1,zIndex:-1,name:BACKGROUND_SHAPE})}var c;e.radius&&this.coordinate.isRect?c=getRectWithCornerRadius(this.parsePoints(a.points),this.coordinate,e.radius):c=this.parsePath(getIntervalRectPath(a.points,e.lineCap,this.coordinate));var u=n.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:c}),name:"interval"});return o?n:u},getMarker:function(a){var r=a.color,e=a.isInPolar;return e?{symbol:"circle",style:{r:4.5,fill:r}}:{symbol:"square",style:{r:4,fill:r}}}});function findMinDistance(a,r){var e=a.length,n=a;isString$1(n[0])&&(n=a.map(function(c){return r.translate(c)}));for(var o=n[1]-n[0],s=2;s<e;s++){var l=n[s]-n[s-1];o>l&&(o=l)}return o}function getDodgeCount(a,r){if(r){var e=flatten(a),n=valuesOfKey(e,r);return n.length}return a.length}function getDefaultSize(a){var r=a.theme,e=a.coordinate,n=a.getXScale(),o=n.values,s=a.beforeMappingData,l=o.length,c=getXDimensionLength(a.coordinate),u=a.intervalPadding,f=a.dodgePadding,d=a.maxColumnWidth||r.maxColumnWidth,g=a.minColumnWidth||r.minColumnWidth,p=a.columnWidthRatio||r.columnWidthRatio,v=a.multiplePieWidthRatio||r.multiplePieWidthRatio,m=a.roseWidthRatio||r.roseWidthRatio;if(n.isLinear&&o.length>1){o.sort();var y=findMinDistance(o,n);l=(n.max-n.min)/y,o.length>l&&(l=o.length)}var x=n.range,_=1/l,E=1;if(e.isPolar?e.isTransposed&&l>1?E=v:E=m:(n.isLinear&&(_*=x[1]-x[0]),E=p),!isNil(u)&&u>=0){var S=u/c;_=(1-(l-1)*S)/l}else _*=E;if(a.getAdjust("dodge")){var A=a.getAdjust("dodge"),T=A.dodgeBy,b=getDodgeCount(s,T);if(!isNil(f)&&f>=0){var C=f/c;_=(_-C*(b-1))/b}else!isNil(u)&&u>=0&&(_*=E),_=_/b;_=_>=0?_:0}if(!isNil(d)&&d>=0){var L=d/c;_>L&&(_=L)}if(!isNil(g)&&g>=0){var R=g/c;_<R&&(_=R)}return _}var Interval=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;n.type="interval",n.shapeType="interval",n.generatePoints=!0;var o=e.background;return n.background=o,n}return r.prototype.createShapePointsCfg=function(e){var n=a.prototype.createShapePointsCfg.call(this,e),o,s=this.getAttribute("size");if(s){o=this.getAttributeValues(s,e)[0];var l=this.coordinate,c=getXDimensionLength(l);o=o/c}else this.defaultSize||(this.defaultSize=getDefaultSize(this)),o=this.defaultSize;return n.size=o,n},r.prototype.adjustScale=function(){a.prototype.adjustScale.call(this);var e=this.getYScale();if(this.coordinate.type==="theta")e.change({nice:!1,min:0,max:getMaxScale(e)});else{var n=this.scaleDefs,o=e.field,s=e.min,l=e.max,c=e.type;c!=="time"&&(s>0&&!get(n,[o,"min"])&&e.change({min:0}),l<=0&&!get(n,[o,"max"])&&e.change({max:0}))}},r.prototype.getDrawCfg=function(e){var n=a.prototype.getDrawCfg.call(this,e);return n.background=this.background,n},r}(Geometry),Line$1=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;n.type="line";var o=e.sortable,s=o===void 0?!1:o;return n.sortable=s,n}return r}(Path),SHAPES=["circle","square","bowtie","diamond","hexagon","triangle","triangle-down"],HOLLOW_SHAPES=["cross","tick","plus","hyphen","line"];function drawPoints(a,r,e,n,o){var s,l,c=getStyle(r,o,!o,"r"),u=a.parsePoints(r.points),f=u[0];if(r.isStack)f=u[1];else if(u.length>1){var d=e.addGroup();try{for(var g=__values(u),p=g.next();!p.done;p=g.next()){var v=p.value;d.addShape({type:"marker",attrs:__assign$8(__assign$8(__assign$8({},c),{symbol:MarkerSymbols[n]||n}),v)})}}catch(m){s={error:m}}finally{try{p&&!p.done&&(l=g.return)&&l.call(g)}finally{if(s)throw s.error}}return d}return e.addShape({type:"marker",attrs:__assign$8(__assign$8(__assign$8({},c),{symbol:MarkerSymbols[n]||n}),f)})}registerShapeFactory("point",{defaultShapeType:"hollow-circle",getDefaultPoints:function(a){return splitPoints(a)}});each$1(SHAPES,function(a){registerShape("point","hollow-".concat(a),{draw:function(r,e){return drawPoints(this,r,e,a,!0)},getMarker:function(r){var e=r.color;return{symbol:MarkerSymbols[a]||a,style:{r:4.5,stroke:e,fill:null}}}})});var Point=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="point",e.shapeType="point",e.generatePoints=!0,e}return r.prototype.getDrawCfg=function(e){var n=a.prototype.getDrawCfg.call(this,e);return __assign$8(__assign$8({},n),{isStack:!!this.getAdjust("stack")})},r}(Geometry);function getPath$1(a){for(var r=a[0],e=1,n=[["M",r.x,r.y]];e<a.length;){var o=a[e];(o.x!==a[e-1].x||o.y!==a[e-1].y)&&(n.push(["L",o.x,o.y]),o.x===r.x&&o.y===r.y&&e<a.length-1&&(r=a[e+1],n.push(["Z"]),n.push(["M",r.x,r.y]),e++)),e++}return isEqual$1(last(n),r)||n.push(["L",r.x,r.y]),n.push(["Z"]),n}registerShapeFactory("polygon",{defaultShapeType:"polygon",getDefaultPoints:function(a){var r=[];return each$1(a.x,function(e,n){var o=a.y[n];r.push({x:e,y:o})}),r}});registerShape("polygon","polygon",{draw:function(a,r){if(!isEmpty(a.points)){var e=getStyle(a,!0,!0),n=this.parsePath(getPath$1(a.points));return r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:n}),name:"polygon"})}},getMarker:function(a){var r=a.color;return{symbol:"square",style:{r:4,fill:r}}}});var Polygon=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="polygon",e.shapeType="polygon",e.generatePoints=!0,e}return r.prototype.createShapePointsCfg=function(e){var n=a.prototype.createShapePointsCfg.call(this,e),o=n.x,s=n.y,l;if(!(isArray$4(o)&&isArray$4(s))){var c=this.getXScale(),u=this.getYScale(),f=c.values.length,d=u.values.length,g=.5*1/f,p=.5*1/d;c.isCategory&&u.isCategory?(o=[o-g,o-g,o+g,o+g],s=[s-p,s+p,s+p,s-p]):isArray$4(o)?(l=o,o=[l[0],l[0],l[1],l[1]],s=[s-p/2,s+p/2,s+p/2,s-p/2]):isArray$4(s)&&(l=s,s=[l[0],l[1],l[1],l[0]],o=[o-g/2,o-g/2,o+g/2,o+g/2]),n.x=o,n.y=s}return n},r}(Geometry);registerShapeFactory("schema",{defaultShapeType:""});var Schema=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="schema",e.shapeType="schema",e.generatePoints=!0,e}return r.prototype.createShapePointsCfg=function(e){var n=a.prototype.createShapePointsCfg.call(this,e),o,s=this.getAttribute("size");if(s){o=this.getAttributeValues(s,e)[0];var l=this.coordinate,c=getXDimensionLength(l);o=o/c}else this.defaultSize||(this.defaultSize=getDefaultSize(this)),o=this.defaultSize;return n.size=o,n},r}(Geometry);function normalizeSize(a){if(!isArray$4(a))return[];var r=max$2(a);return map$2(a,function(e){return e/r})}registerShapeFactory("violin",{defaultShapeType:"violin",getDefaultPoints:function(a){var r=a.size/2,e=[],n=normalizeSize(a._size);return each$1(a.y,function(o,s){var l=n[s]*r,c=s===0,u=s===a.y.length-1;e.push({isMin:c,isMax:u,x:a.x-l,y:o}),e.unshift({isMin:c,isMax:u,x:a.x+l,y:o})}),e}});registerShape("violin","violin",{draw:function(a,r){var e=getStyle(a,!0,!0),n=this.parsePath(getViolinPath(a.points));return r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:n}),name:"violin"})},getMarker:function(a){var r=a.color;return{symbol:"circle",style:{r:4,fill:r}}}});var Violin$1=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="violin",e.shapeType="violin",e.generatePoints=!0,e}return r.prototype.createShapePointsCfg=function(e){var n=a.prototype.createShapePointsCfg.call(this,e),o,s=this.getAttribute("size");if(s){o=this.getAttributeValues(s,e)[0];var l=this.coordinate,c=getXDimensionLength(l);o=o/c}else this.defaultSize||(this.defaultSize=getDefaultSize(this)),o=this.defaultSize;return n.size=o,n._size=get(e[FIELD_ORIGIN],[this._sizeField]),n},r.prototype.initAttributes=function(){var e=this.attributeOption,n=e.size?e.size.fields[0]:this._sizeField?this._sizeField:"size";this._sizeField=n,delete e.size,a.prototype.initAttributes.call(this)},r}(Geometry);registerShape("area","line",{draw:function(a,r){var e=getShapeAttrs(a,!0,!1,this),n=r.addShape({type:"path",attrs:e,name:"area"});return n},getMarker:function(a){var r=a.color;return{symbol:function(e,n,o){return o===void 0&&(o=5.5),[["M",e-o,n-4],["L",e+o,n-4],["L",e+o,n+4],["L",e-o,n+4],["Z"]]},style:{r:5,stroke:r,fill:null}}}});registerShape("area","smooth",{draw:function(a,r){var e=this.coordinate,n=getShapeAttrs(a,!1,!0,this,getConstraint(e)),o=r.addShape({type:"path",attrs:n,name:"area"});return o},getMarker:function(a){var r=a.color;return{symbol:function(e,n,o){return o===void 0&&(o=5.5),[["M",e-o,n-4],["L",e+o,n-4],["L",e+o,n+4],["L",e-o,n+4],["Z"]]},style:{r:5,fill:r,fillOpacity:1}}}});registerShape("area","smooth-line",{draw:function(a,r){var e=this.coordinate,n=getShapeAttrs(a,!0,!0,this,getConstraint(e)),o=r.addShape({type:"path",attrs:n,name:"area"});return o},getMarker:function(a){var r=a.color;return{symbol:function(e,n,o){return o===void 0&&(o=5.5),[["M",e-o,n-4],["L",e+o,n-4],["L",e+o,n+4],["L",e-o,n+4],["Z"]]},style:{r:5,stroke:r,fill:null}}}});function getCPath(a,r){return["C",a.x*1/2+r.x*1/2,a.y,a.x*1/2+r.x*1/2,r.y,r.x,r.y]}function getQPath(a,r){var e=[];e.push({x:r.x,y:r.y}),e.push(a);var n=["Q"];return each$1(e,function(o){n.push(o.x,o.y)}),n}function getArcShapePath(a,r,e){var n=getQPath(r,e),o=[["M",a.x,a.y]];return o.push(n),o}function getArcShapeWeightPath(a,r){var e=getQPath(a[1],r),n=getQPath(a[3],r),o=[["M",a[0].x,a[0].y]];return o.push(n),o.push(["L",a[3].x,a[3].y]),o.push(["L",a[2].x,a[2].y]),o.push(e),o.push(["L",a[1].x,a[1].y]),o.push(["L",a[0].x,a[0].y]),o.push(["Z"]),o}registerShape("edge","arc",{draw:function(a,r){var e=getStyle(a,!0,!1,"lineWidth"),n=a.points,o=n.length>2?"weight":"normal",s;if(a.isInCircle){var l={x:0,y:1};return o==="normal"?s=getArcShapePath(n[0],n[1],l):(e.fill=e.stroke,s=getArcShapeWeightPath(n,l)),s=this.parsePath(s),r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:s})})}else{if(o==="normal")return n=this.parsePoints(n),s=getArcPath((n[1].x+n[0].x)/2,n[0].y,Math.abs(n[1].x-n[0].x)/2,Math.PI,Math.PI*2),r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:s})});var c=getCPath(n[1],n[3]),u=getCPath(n[2],n[0]);return s=[["M",n[0].x,n[0].y],["L",n[1].x,n[1].y],c,["L",n[3].x,n[3].y],["L",n[2].x,n[2].y],u,["Z"]],s=this.parsePath(s),e.fill=e.stroke,r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:s})})}},getMarker:function(a){return{symbol:"circle",style:{r:4.5,fill:a.color}}}});function getSmoothPath(a,r){var e=getCPath(a,r),n=[["M",a.x,a.y]];return n.push(e),n}registerShape("edge","smooth",{draw:function(a,r){var e=getStyle(a,!0,!1,"lineWidth"),n=a.points,o=this.parsePath(getSmoothPath(n[0],n[1]));return r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:o})})},getMarker:function(a){return{symbol:"circle",style:{r:4.5,fill:a.color}}}});var CORNER_PERCENT=1/3;function getVHVPath(a,r){var e=[];e.push({x:a.x,y:a.y*(1-CORNER_PERCENT)+r.y*CORNER_PERCENT}),e.push({x:r.x,y:a.y*(1-CORNER_PERCENT)+r.y*CORNER_PERCENT}),e.push(r);var n=[["M",a.x,a.y]];return each$1(e,function(o){n.push(["L",o.x,o.y])}),n}registerShape("edge","vhv",{draw:function(a,r){var e=getStyle(a,!0,!1,"lineWidth"),n=a.points,o=this.parsePath(getVHVPath(n[0],n[1]));return r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:o})})},getMarker:function(a){return{symbol:"circle",style:{r:4.5,fill:a.color}}}});registerShape("interval","funnel",{getPoints:function(a){return a.size=a.size*2,getRectPoints$1(a)},draw:function(a,r){var e=getStyle(a,!1,!0),n=this.parsePath(getFunnelPath(a.points,a.nextPoints,!1)),o=r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:n}),name:"interval"});return o},getMarker:function(a){var r=a.color;return{symbol:"square",style:{r:4,fill:r}}}});registerShape("interval","hollow-rect",{draw:function(a,r){var e=getStyle(a,!0,!1),n=r,o=a==null?void 0:a.background;if(o){n=r.addGroup();var s=getBackgroundRectStyle(a),l=getBackgroundRectPath(a,this.parsePoints(a.points),this.coordinate);n.addShape("path",{attrs:__assign$8(__assign$8({},s),{path:l}),capture:!1,zIndex:-1,name:BACKGROUND_SHAPE})}var c=this.parsePath(getRectPath$1(a.points)),u=n.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:c}),name:"interval"});return o?n:u},getMarker:function(a){var r=a.color,e=a.isInPolar;return e?{symbol:"circle",style:{r:4.5,stroke:r,fill:null}}:{symbol:"square",style:{r:4,stroke:r,fill:null}}}});function getLinePoints(a){var r=a.x,e=a.y,n=a.y0;return isArray$4(e)?e.map(function(o,s){return{x:isArray$4(r)?r[s]:r,y:o}}):[{x:r,y:n},{x:r,y:e}]}registerShape("interval","line",{getPoints:function(a){return getLinePoints(a)},draw:function(a,r){var e=getStyle(a,!0,!1,"lineWidth"),n=omit(__assign$8({},e),["fill"]),o=this.parsePath(getRectPath$1(a.points,!1)),s=r.addShape("path",{attrs:__assign$8(__assign$8({},n),{path:o}),name:"interval"});return s},getMarker:function(a){var r=a.color;return{symbol:function(e,n,o){return[["M",e,n-o],["L",e,n+o]]},style:{r:5,stroke:r}}}});registerShape("interval","pyramid",{getPoints:function(a){return a.size=a.size*2,getRectPoints$1(a)},draw:function(a,r){var e=getStyle(a,!1,!0),n=this.parsePath(getFunnelPath(a.points,a.nextPoints,!0)),o=r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:n}),name:"interval"});return o},getMarker:function(a){var r=a.color;return{symbol:"square",style:{r:4,fill:r}}}});function getTickPoints(a){var r,e=a.x,n=a.y,o=a.y0,s=a.size,l,c;isArray$4(n)?(r=__read(n,2),l=r[0],c=r[1]):(l=o,c=n);var u=e+s/2,f=e-s/2;return[{x:e,y:l},{x:e,y:c},{x:f,y:l},{x:u,y:l},{x:f,y:c},{x:u,y:c}]}function getTickPath(a){return[["M",a[0].x,a[0].y],["L",a[1].x,a[1].y],["M",a[2].x,a[2].y],["L",a[3].x,a[3].y],["M",a[4].x,a[4].y],["L",a[5].x,a[5].y]]}registerShape("interval","tick",{getPoints:function(a){return getTickPoints(a)},draw:function(a,r){var e=getStyle(a,!0,!1),n=this.parsePath(getTickPath(a.points)),o=r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:n}),name:"interval"});return o},getMarker:function(a){var r=a.color;return{symbol:function(e,n,o){return[["M",e-o/2,n-o],["L",e+o/2,n-o],["M",e,n-o],["L",e,n+o],["M",e-o/2,n+o],["L",e+o/2,n+o]]},style:{r:5,stroke:r}}}});var interpolateCallback=function(a,r,e){var n=a.x,o=a.y,s=r.x,l=r.y,c;switch(e){case"hv":c=[{x:s,y:o}];break;case"vh":c=[{x:n,y:l}];break;case"hvh":var u=(s+n)/2;c=[{x:u,y:o},{x:u,y:l}];break;case"vhv":var f=(o+l)/2;c=[{x:n,y:f},{x:s,y:f}];break}return c};function getInterpolatePoints(a,r){var e=[];return each$1(a,function(n,o){var s=a[o+1];if(e.push(n),s){var l=interpolateCallback(n,s,r);e=e.concat(l)}}),e}function getInterpolatePath(a){return a.map(function(r,e){return e===0?["M",r.x,r.y]:["L",r.x,r.y]})}function getInterpolateShapeAttrs(a,r){var e=getPathPoints(a.points,a.connectNulls,a.showSinglePoint),n=[];return each$1(e,function(o){var s=getInterpolatePoints(o,r);n=n.concat(getInterpolatePath(s))}),__assign$8(__assign$8({},getStyle(a,!0,!1,"lineWidth")),{path:n})}each$1(["hv","vh","hvh","vhv"],function(a){registerShape("line",a,{draw:function(r,e){var n=getInterpolateShapeAttrs(r,a),o=e.addShape({type:"path",attrs:n,name:"line"});return o},getMarker:function(r){return getLineMarker(r,a)}})});each$1(HOLLOW_SHAPES,function(a){registerShape("point",a,{draw:function(r,e){return drawPoints(this,r,e,a,!0)},getMarker:function(r){var e=r.color;return{symbol:MarkerSymbols[a],style:{r:4.5,stroke:e,fill:null}}}})});registerShape("point","image",{draw:function(a,r){var e,n,o=getStyle(a,!1,!1,"r").r,s=this.parsePoints(a.points),l=s[0];if(a.isStack)l=s[1];else if(s.length>1){var c=r.addGroup();try{for(var u=__values(s),f=u.next();!f.done;f=u.next()){var d=f.value;c.addShape("image",{attrs:{x:d.x-o/2,y:d.y-o,width:o,height:o,img:a.shape[1]}})}}catch(g){e={error:g}}finally{try{f&&!f.done&&(n=u.return)&&n.call(u)}finally{if(e)throw e.error}}return c}return r.addShape("image",{attrs:{x:l.x-o/2,y:l.y-o,width:o,height:o,img:a.shape[1]}})},getMarker:function(a){var r=a.color;return{symbol:"circle",style:{r:4.5,fill:r}}}});each$1(SHAPES,function(a){registerShape("point",a,{draw:function(r,e){return drawPoints(this,r,e,a,!1)},getMarker:function(r){var e=r.color;return{symbol:MarkerSymbols[a]||a,style:{r:4.5,fill:e}}}})});function parseValue(a){var r=isArray$4(a)?a:[a],e=r[0],n=r[r.length-1],o=r.length>1?r[1]:e,s=r.length>3?r[3]:n,l=r.length>2?r[2]:o;return{min:e,max:n,min1:o,max1:s,median:l}}function getBoxPoints(a,r,e){var n=e/2,o;if(isArray$4(r)){var s=parseValue(r),l=s.min,c=s.max,u=s.median,f=s.min1,d=s.max1,g=a-n,p=a+n;o=[[g,c],[p,c],[a,c],[a,d],[g,f],[g,d],[p,d],[p,f],[a,f],[a,l],[g,l],[p,l],[g,u],[p,u]]}else{r=isNil(r)?.5:r;var v=parseValue(a),l=v.min,c=v.max,u=v.median,f=v.min1,d=v.max1,m=r-n,y=r+n;o=[[l,m],[l,y],[l,r],[f,r],[f,m],[f,y],[d,y],[d,m],[d,r],[c,r],[c,m],[c,y],[u,m],[u,y]]}return o.map(function(x){return{x:x[0],y:x[1]}})}function getBoxPath(a){return[["M",a[0].x,a[0].y],["L",a[1].x,a[1].y],["M",a[2].x,a[2].y],["L",a[3].x,a[3].y],["M",a[4].x,a[4].y],["L",a[5].x,a[5].y],["L",a[6].x,a[6].y],["L",a[7].x,a[7].y],["L",a[4].x,a[4].y],["Z"],["M",a[8].x,a[8].y],["L",a[9].x,a[9].y],["M",a[10].x,a[10].y],["L",a[11].x,a[11].y],["M",a[12].x,a[12].y],["L",a[13].x,a[13].y]]}registerShape("schema","box",{getPoints:function(a){var r=a.x,e=a.y,n=a.size;return getBoxPoints(r,e,n)},draw:function(a,r){var e=getStyle(a,!0,!1),n=this.parsePath(getBoxPath(a.points)),o=r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:n,name:"schema"})});return o},getMarker:function(a){var r=a.color;return{symbol:function(e,n,o){var s=[n-6,n-3,n,n+3,n+6],l=getBoxPoints(e,s,o);return[["M",l[0].x+1,l[0].y],["L",l[1].x-1,l[1].y],["M",l[2].x,l[2].y],["L",l[3].x,l[3].y],["M",l[4].x,l[4].y],["L",l[5].x,l[5].y],["L",l[6].x,l[6].y],["L",l[7].x,l[7].y],["L",l[4].x,l[4].y],["Z"],["M",l[8].x,l[8].y],["L",l[9].x,l[9].y],["M",l[10].x+1,l[10].y],["L",l[11].x-1,l[11].y],["M",l[12].x,l[12].y],["L",l[13].x,l[13].y]]},style:{r:6,lineWidth:1,stroke:r}}}});function getCandleYValues(a){var r=isArray$4(a)?a:[a],e=r.sort(function(n,o){return o-n});return padEnd(e,4,e[e.length-1])}function getCandlePoints(a,r,e){var n=getCandleYValues(r);return[{x:a,y:n[0]},{x:a,y:n[1]},{x:a-e/2,y:n[2]},{x:a-e/2,y:n[1]},{x:a+e/2,y:n[1]},{x:a+e/2,y:n[2]},{x:a,y:n[2]},{x:a,y:n[3]}]}function getCandlePath(a){return[["M",a[0].x,a[0].y],["L",a[1].x,a[1].y],["M",a[2].x,a[2].y],["L",a[3].x,a[3].y],["L",a[4].x,a[4].y],["L",a[5].x,a[5].y],["Z"],["M",a[6].x,a[6].y],["L",a[7].x,a[7].y]]}registerShape("schema","candle",{getPoints:function(a){var r=a.x,e=a.y,n=a.size;return getCandlePoints(r,e,n)},draw:function(a,r){var e=getStyle(a,!0,!0),n=this.parsePath(getCandlePath(a.points)),o=r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:n,name:"schema"})});return o},getMarker:function(a){var r=a.color;return{symbol:function(e,n,o){var s=[n+7.5,n+3,n-3,n-7.5],l=getCandlePoints(e,s,o);return[["M",l[0].x,l[0].y],["L",l[1].x,l[1].y],["M",l[2].x,l[2].y],["L",l[3].x,l[3].y],["L",l[4].x,l[4].y],["L",l[5].x,l[5].y],["Z"],["M",l[6].x,l[6].y],["L",l[7].x,l[7].y]]},style:{lineWidth:1,stroke:r,fill:r,r:6}}}});function getRectAttrs(a,r){var e=Math.abs(a[0].x-a[2].x),n=Math.abs(a[0].y-a[2].y),o=Math.min(e,n);r&&(o=clamp(r,0,Math.min(e,n))),o=o/2;var s=(a[0].x+a[2].x)/2,l=(a[0].y+a[2].y)/2;return{x:s-o,y:l-o,width:o*2,height:o*2}}registerShape("polygon","square",{draw:function(a,r){if(!isEmpty(a.points)){var e=getStyle(a,!0,!0),n=this.parsePoints(a.points);return r.addShape("rect",{attrs:__assign$8(__assign$8({},e),getRectAttrs(n,a.size)),name:"polygon"})}},getMarker:function(a){var r=a.color;return{symbol:"square",style:{r:4,fill:r}}}});registerShape("violin","smooth",{draw:function(a,r){var e=getStyle(a,!0,!0),n=this.parsePath(getSmoothViolinPath(a.points));return r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:n})})},getMarker:function(a){var r=a.color;return{symbol:"circle",style:{stroke:null,r:4,fill:r}}}});registerShape("violin","hollow",{draw:function(a,r){var e=getStyle(a,!0,!1),n=this.parsePath(getViolinPath(a.points));return r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:n})})},getMarker:function(a){var r=a.color;return{symbol:"circle",style:{r:4,fill:null,stroke:r}}}});registerShape("violin","hollow-smooth",{draw:function(a,r){var e=getStyle(a,!0,!1),n=this.parsePath(getSmoothViolinPath(a.points));return r.addShape("path",{attrs:__assign$8(__assign$8({},e),{path:n})})},getMarker:function(a){var r=a.color;return{symbol:"circle",style:{r:4,fill:null,stroke:r}}}});var IntervalLabel=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getLabelValueDir=function(e){var n="y",o=e.points;return o[0][n]<=o[2][n]?1:-1},r.prototype.getLabelOffsetPoint=function(e,n,o,s){var l,c=a.prototype.getLabelOffsetPoint.call(this,e,n,o),u=this.getCoordinate(),f=u.isTransposed,d=f?"x":"y",g=this.getLabelValueDir(e.mappingData);return c=__assign$8(__assign$8({},c),(l={},l[d]=c[d]*g,l)),u.isReflect("x")&&(c=__assign$8(__assign$8({},c),{x:c.x*-1})),u.isReflect("y")&&(c=__assign$8(__assign$8({},c),{y:c.y*-1})),c},r.prototype.getThemedLabelCfg=function(e){var n=this.geometry,o=this.getDefaultLabelCfg(),s=n.theme;return deepMix({},o,s.labels,e.position==="middle"?{offset:0}:{},e)},r.prototype.setLabelPosition=function(e,n,o,s){var l=this.getCoordinate(),c=l.isTransposed,u=n.points,f=l.convert(u[0]),d=l.convert(u[2]),g=this.getLabelValueDir(n),p,v,m,y,x=isArray$4(n.shape)?n.shape[0]:n.shape;if(x==="funnel"||x==="pyramid"){var _=get(n,"nextPoints"),E=get(n,"points");if(_){var S=l.convert(E[0]),A=l.convert(E[1]),T=l.convert(_[0]),b=l.convert(_[1]);c?(p=Math.min(T.y,S.y),m=Math.max(T.y,S.y),v=(A.x+b.x)/2,y=(S.x+T.x)/2):(p=Math.min((A.y+b.y)/2,(S.y+T.y)/2),m=Math.max((A.y+b.y)/2,(S.y+T.y)/2),v=b.x,y=S.x)}else p=Math.min(d.y,f.y),m=Math.max(d.y,f.y),v=d.x,y=f.x}else p=Math.min(d.y,f.y),m=Math.max(d.y,f.y),v=d.x,y=f.x;switch(s){case"right":e.x=v,e.y=(p+m)/2,e.textAlign=get(e,"textAlign",g>0?"left":"right");break;case"left":e.x=y,e.y=(p+m)/2,e.textAlign=get(e,"textAlign",g>0?"left":"right");break;case"bottom":c&&(e.x=(v+y)/2),e.y=m,e.textAlign=get(e,"textAlign","center"),e.textBaseline=get(e,"textBaseline",g>0?"bottom":"top");break;case"middle":c&&(e.x=(v+y)/2),e.y=(p+m)/2,e.textAlign=get(e,"textAlign","center"),e.textBaseline=get(e,"textBaseline","middle");break;case"top":c&&(e.x=(v+y)/2),e.y=p,e.textAlign=get(e,"textAlign","center"),e.textBaseline=get(e,"textBaseline",g>0?"bottom":"top");break}},r}(GeometryLabel),HALF_PI=Math.PI/2,PolarLabel=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getLabelOffset=function(e){var n=this.getCoordinate(),o=0;if(isNumber$2(e))o=e;else if(isString$1(e)&&e.indexOf("%")!==-1){var s=n.getRadius();n.innerRadius>0&&(s=s*(1-n.innerRadius)),o=parseFloat(e)*.01*s}return o},r.prototype.getLabelItems=function(e){var n=a.prototype.getLabelItems.call(this,e),o=this.geometry.getYScale();return map$2(n,function(s){if(s&&o){var l=o.scale(get(s.data,o.field));return __assign$8(__assign$8({},s),{percent:l})}return s})},r.prototype.getLabelAlign=function(e){var n=this.getCoordinate(),o;if(e.labelEmit)o=e.angle<=Math.PI/2&&e.angle>=-Math.PI/2?"left":"right";else if(!n.isTransposed)o="center";else{var s=n.getCenter(),l=e.offset;Math.abs(e.x-s.x)<1?o="center":e.angle>Math.PI||e.angle<=0?o=l>0?"left":"right":o=l>0?"right":"left"}return o},r.prototype.getLabelPoint=function(e,n,o){var s=1,l,c=e.content[o];this.isToMiddle(n)?l=this.getMiddlePoint(n.points):(e.content.length===1&&o===0?o=1:o===0&&(s=-1),l=this.getArcPoint(n,o));var u=e.offset*s,f=this.getPointAngle(l),d=e.labelEmit,g=this.getCirclePoint(f,u,l,d);return g.r===0?g.content="":(g.content=c,g.angle=f,g.color=n.color),g.rotate=e.autoRotate?this.getLabelRotate(f,u,d):e.rotate,g.start={x:l.x,y:l.y},g},r.prototype.getArcPoint=function(e,n){return n===void 0&&(n=0),!isArray$4(e.x)&&!isArray$4(e.y)?{x:e.x,y:e.y}:{x:isArray$4(e.x)?e.x[n]:e.x,y:isArray$4(e.y)?e.y[n]:e.y}},r.prototype.getPointAngle=function(e){return getAngleByPoint(this.getCoordinate(),e)},r.prototype.getCirclePoint=function(e,n,o,s){var l=this.getCoordinate(),c=l.getCenter(),u=getDistanceToCenter(l,o);if(u===0)return __assign$8(__assign$8({},c),{r:u});var f=e;if(l.isTransposed&&u>n&&!s){var d=Math.asin(n/(2*u));f=e+d*2}else u=u+n;return{x:c.x+u*Math.cos(f),y:c.y+u*Math.sin(f),r:u}},r.prototype.getLabelRotate=function(e,n,o){var s=e+HALF_PI;return o&&(s-=HALF_PI),s&&(s>HALF_PI?s=s-Math.PI:s<-HALF_PI&&(s=s+Math.PI)),s},r.prototype.getMiddlePoint=function(e){var n=this.getCoordinate(),o=e.length,s={x:0,y:0};return each$1(e,function(l){s.x+=l.x,s.y+=l.y}),s.x/=o,s.y/=o,s=n.convert(s),s},r.prototype.isToMiddle=function(e){return e.x.length>2},r}(GeometryLabel),PieLabel=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.defaultLayout="distribute",e}return r.prototype.getDefaultLabelCfg=function(e,n){var o=a.prototype.getDefaultLabelCfg.call(this,e,n);return deepMix({},o,get(this.geometry.theme,"pieLabels",{}))},r.prototype.getLabelOffset=function(e){return a.prototype.getLabelOffset.call(this,e)||0},r.prototype.getLabelRotate=function(e,n,o){var s;return n<0&&(s=e,s>Math.PI/2&&(s=s-Math.PI),s<-Math.PI/2&&(s=s+Math.PI)),s},r.prototype.getLabelAlign=function(e){var n=this.getCoordinate(),o=n.getCenter(),s;return e.angle<=Math.PI/2&&e.x>=o.x?s="left":s="right",e.offset<=0&&(s==="right"?s="left":s="right"),s},r.prototype.getArcPoint=function(e){return e},r.prototype.getPointAngle=function(e){var n=this.getCoordinate(),o={x:isArray$4(e.x)?e.x[0]:e.x,y:e.y[0]},s={x:isArray$4(e.x)?e.x[1]:e.x,y:e.y[1]},l,c=getAngleByPoint(n,o);if(e.points&&e.points[0].y===e.points[1].y)l=c;else{var u=getAngleByPoint(n,s);c>=u&&(u=u+Math.PI*2),l=c+(u-c)/2}return l},r.prototype.getCirclePoint=function(e,n){var o=this.getCoordinate(),s=o.getCenter(),l=o.getRadius()+n;return __assign$8(__assign$8({},polarToCartesian(s.x,s.y,l,e)),{angle:e,r:l})},r}(PolarLabel),MARGIN$1=4;function antiCollision$1(a,r,e,n,o,s){var l,c,u=!0,f=n.start,d=n.end,g=Math.min(f.y,d.y),p=Math.abs(f.y-d.y),v,m=0,y=Number.MIN_VALUE,x=r.map(function(C){return C.y>m&&(m=C.y),C.y<y&&(y=C.y),{size:e,targets:[C.y-g]}});for(y-=g,m-g>p&&(p=m-g);u;)for(x.forEach(function(C){var L=(Math.min.apply(y,C.targets)+Math.max.apply(y,C.targets))/2;C.pos=Math.min(Math.max(y,L-C.size/2),p-C.size)}),u=!1,v=x.length;v--;)if(v>0){var _=x[v-1],E=x[v];_.pos+_.size>E.pos&&(_.size+=E.size,_.targets=_.targets.concat(E.targets),_.pos+_.size>p&&(_.pos=p-_.size),x.splice(v,1),u=!0)}v=0,x.forEach(function(C){var L=g+e/2;C.targets.forEach(function(){r[v].y=C.pos+L,L+=e,v++})});var S={};try{for(var A=__values(a),T=A.next();!T.done;T=A.next()){var b=T.value;S[b.get("id")]=b}}catch(C){l={error:C}}finally{try{T&&!T.done&&(c=A.return)&&c.call(A)}finally{if(l)throw l.error}}r.forEach(function(C){var L=C.r*C.r,R=Math.pow(Math.abs(C.y-o.y),2);if(L<R)C.x=o.x;else{var I=Math.sqrt(L-R);s?C.x=o.x+I:C.x=o.x-I}var w=S[C.id];w.attr("x",C.x),w.attr("y",C.y);var M=find$2(w.getChildren(),function(D){return D.get("type")==="text"});M&&(M.attr("y",C.y),M.attr("x",C.x))})}function distribute(a,r,e,n){if(!(!a.length||!r.length)){var o=a[0]?a[0].offset:0,s=r[0].get("coordinate"),l=s.getRadius(),c=s.getCenter();if(o>0){var u=14,f=l+o,d=f*2+u*2,g={start:s.start,end:s.end},p=[[],[]];a.forEach(function(v){v&&(v.textAlign==="right"?p[0].push(v):p[1].push(v))}),p.forEach(function(v,m){var y=d/u;v.length>y&&(v.sort(function(x,_){return _["..percent"]-x["..percent"]}),v.splice(y,v.length-y)),v.sort(function(x,_){return x.y-_.y}),antiCollision$1(r,v,u,g,c,m)})}each$1(a,function(v){if(v&&v.labelLine){var m=v.offset,y=v.angle,x=polarToCartesian(c.x,c.y,l,y),_=polarToCartesian(c.x,c.y,l+m/2,y),E=v.x+get(v,"offsetX",0),S=v.y+get(v,"offsetY",0),A={x:E-Math.cos(y)*MARGIN$1,y:S-Math.sin(y)*MARGIN$1};isObject$1(v.labelLine)||(v.labelLine={}),v.labelLine.path=["M ".concat(x.x),"".concat(x.y," Q").concat(_.x),"".concat(_.y," ").concat(A.x),A.y].join(",")}})}}function antiCollision(a,r,e){var n=a.filter(function(m){return!m.invisible});n.sort(function(m,y){return m.y-y.y});var o=!0,s=e.minY,l=e.maxY,c=Math.abs(s-l),u,f=0,d=Number.MIN_VALUE,g=n.map(function(m){return m.y>f&&(f=m.y),m.y<d&&(d=m.y),{content:m.content,size:r,targets:[m.y-s],pos:null}});for(d-=s,f-s>c&&(c=f-s);o;)for(g.forEach(function(m){var y=(Math.min.apply(d,m.targets)+Math.max.apply(d,m.targets))/2;m.pos=Math.min(Math.max(d,y-m.size/2),c-m.size),m.pos=Math.max(0,m.pos)}),o=!1,u=g.length;u--;)if(u>0){var p=g[u-1],v=g[u];p.pos+p.size>v.pos&&(p.size+=v.size,p.targets=p.targets.concat(v.targets),p.pos+p.size>c&&(p.pos=c-p.size),g.splice(u,1),o=!0)}u=0,g.forEach(function(m){var y=s+r/2;m.targets.forEach(function(){n[u].y=m.pos+y,y+=r,u++})})}var MARGIN=4;function drawLabelline$1(a,r){var e=r.getCenter(),n=r.getRadius();if(a&&a.labelLine){var o=a.angle,s=a.offset,l=polarToCartesian(e.x,e.y,n,o),c=a.x+get(a,"offsetX",0)*(Math.cos(o)>0?1:-1),u=a.y+get(a,"offsetY",0)*(Math.sin(o)>0?1:-1),f={x:c-Math.cos(o)*MARGIN,y:u-Math.sin(o)*MARGIN},d=a.labelLine.smooth,g=[],p=f.x-e.x,v=f.y-e.y,m=Math.atan(v/p);if(p<0&&(m+=Math.PI),d===!1){isObject$1(a.labelLine)||(a.labelLine={});var y=0;(o<0&&o>-Math.PI/2||o>Math.PI*1.5)&&f.y>l.y&&(y=1),o>=0&&o<Math.PI/2&&f.y>l.y&&(y=1),o>=Math.PI/2&&o<Math.PI&&l.y>f.y&&(y=1),(o<-Math.PI/2||o>=Math.PI&&o<Math.PI*1.5)&&l.y>f.y&&(y=1);var x=s/2>4?4:Math.max(s/2-1,0),_=polarToCartesian(e.x,e.y,n+x,o),E=polarToCartesian(e.x,e.y,n+s/2,m),S=0;g.push("M ".concat(l.x," ").concat(l.y)),g.push("L ".concat(_.x," ").concat(_.y)),g.push("A ".concat(e.x," ").concat(e.y," 0 ").concat(S," ").concat(y," ").concat(E.x," ").concat(E.y)),g.push("L ".concat(f.x," ").concat(f.y))}else{var _=polarToCartesian(e.x,e.y,n+(s/2>4?4:Math.max(s/2-1,0)),o),A=l.x<e.x?1:-1;g.push("M ".concat(f.x," ").concat(f.y));var T=(l.y-e.y)/(l.x-e.x),b=(f.y-e.y)/(f.x-e.x);Math.abs(T-b)>Math.pow(Math.E,-16)&&g.push.apply(g,["C",f.x+A*4,f.y,2*_.x-l.x,2*_.y-l.y,l.x,l.y]),g.push("L ".concat(l.x," ").concat(l.y))}a.labelLine.path=g.join(" ")}}function pieOuterLabelLayout(a,r,e,n){var o,s,l=filter(a,function(L){return!isNil(L)}),c=r[0]&&r[0].get("coordinate");if(c){var u=c.getCenter(),f=c.getRadius(),d={};try{for(var g=__values(r),p=g.next();!p.done;p=g.next()){var v=p.value;d[v.get("id")]=v}}catch(L){o={error:L}}finally{try{p&&!p.done&&(s=g.return)&&s.call(g)}finally{if(o)throw o.error}}var m=get(l[0],"labelHeight",14),y=get(l[0],"offset",0);if(!(y<=0)){var x="left",_="right",E=groupBy(l,function(L){return L.x<u.x?x:_}),S=c.start,A=c.end,T=Math.min((f+y+m)*2,c.getHeight()),b=T/2,C={minX:S.x,maxX:A.x,minY:u.y-b,maxY:u.y+b};each$1(E,function(L,R){var I=Math.floor(T/m);L.length>I&&(L.sort(function(w,M){return M.percent-w.percent}),each$1(L,function(w,M){M+1>I&&(d[w.id].set("visible",!1),w.invisible=!0)})),antiCollision(L,m,C)}),each$1(E,function(L,R){each$1(L,function(I){var w=R===_,M=d[I.id],D=M.getChildByIndex(0);if(D){var O=f+y,F=I.y-u.y,k=Math.pow(O,2),$=Math.pow(F,2),V=k-$>0?k-$:0,N=Math.sqrt(V),B=Math.abs(Math.cos(I.angle)*O);w?I.x=u.x+Math.max(N,B):I.x=u.x-Math.max(N,B)}D&&(D.attr("y",I.y),D.attr("x",I.x)),drawLabelline$1(I,c)})})}}}var INFLECTION_OFFSET=4,LABEL_OFFSET_X=4,LABEL_TEXT_LINE_OFFSET=4;function drawLabelline(a,r,e){var n=r.getCenter(),o=r.getRadius(),s={x:a.x-(e?LABEL_TEXT_LINE_OFFSET:-LABEL_TEXT_LINE_OFFSET),y:a.y},l=polarToCartesian(n.x,n.y,o+INFLECTION_OFFSET,a.angle),c={x:s.x,y:s.y},u={x:l.x,y:l.y},f=polarToCartesian(n.x,n.y,o,a.angle),d="";if(s.y!==l.y){var g=e?4:-4;c.y=s.y,a.angle<0&&a.angle>=-Math.PI/2&&(c.x=Math.max(l.x,s.x-g),s.y<l.y?u.y=c.y:(u.y=l.y,u.x=Math.max(u.x,c.x-g))),a.angle>0&&a.angle<Math.PI/2&&(c.x=Math.max(l.x,s.x-g),s.y>l.y?u.y=c.y:(u.y=l.y,u.x=Math.max(u.x,c.x-g))),a.angle>Math.PI/2&&(c.x=Math.min(l.x,s.x-g),s.y>l.y?u.y=c.y:(u.y=l.y,u.x=Math.min(u.x,c.x-g))),a.angle<-Math.PI/2&&(c.x=Math.min(l.x,s.x-g),s.y<l.y?u.y=c.y:(u.y=l.y,u.x=Math.min(u.x,c.x-g)))}d=["M ".concat(s.x,",").concat(s.y),"L ".concat(c.x,",").concat(c.y),"L ".concat(u.x,",").concat(u.y),"L ".concat(l.x,",").concat(l.y),"L ".concat(f.x,",").concat(f.y)].join(" "),a.labelLine=deepMix({},a.labelLine,{path:d})}function pieSpiderLabelLayout(a,r,e,n){var o,s,l=r[0]&&r[0].get("coordinate");if(l){var c=l.getCenter(),u=l.getRadius(),f={};try{for(var d=__values(r),g=d.next();!g.done;g=d.next()){var p=g.value;f[p.get("id")]=p}}catch(L){o={error:L}}finally{try{g&&!g.done&&(s=d.return)&&s.call(d)}finally{if(o)throw o.error}}var v=get(a[0],"labelHeight",14),m=Math.max(get(a[0],"offset",0),INFLECTION_OFFSET);each$1(a,function(L){if(L){var R=get(f,[L.id]);if(R){var I=L.x>c.x||L.x===c.x&&L.y>c.y,w=isNil(L.offsetX)?LABEL_OFFSET_X:L.offsetX,M=polarToCartesian(c.x,c.y,u+INFLECTION_OFFSET,L.angle),D=m+w;L.x=c.x+(I?1:-1)*(u+D),L.y=M.y}}});var y=l.start,x=l.end,_="left",E="right",S=groupBy(a,function(L){return L.x<c.x?_:E}),A=(u+m)*2+v;each$1(S,function(L){var R=L.length*v;R>A&&(A=Math.min(R,Math.abs(y.y-x.y)))});var T={minX:y.x,maxX:x.x,minY:c.y-A/2,maxY:c.y+A/2};each$1(S,function(L,R){var I=A/v;L.length>I&&(L.sort(function(w,M){return M.percent-w.percent}),each$1(L,function(w,M){M>I&&(f[w.id].set("visible",!1),w.invisible=!0)})),antiCollision(L,v,T)});var b=T.minY,C=T.maxY;each$1(S,function(L,R){var I=R===E;each$1(L,function(w){var M=get(f,w&&[w.id]);if(M){if(w.y<b||w.y>C){M.set("visible",!1);return}var D=M.getChildByIndex(0),O=D.getCanvasBBox(),F={x:I?O.x:O.maxX,y:O.y+O.height/2};translate(D,w.x-F.x,w.y-F.y),w.labelLine&&drawLabelline(w,l,I)}})})}}function limitInCanvas(a,r,e,n){each$1(r,function(o){var s=n.minX,l=n.minY,c=n.maxX,u=n.maxY,f=o.getCanvasBBox(),d=f.minX,g=f.minY,p=f.maxX,v=f.maxY,m=f.x,y=f.y,x=f.width,_=f.height,E=m,S=y;(d<s||p<s)&&(E=s),(g<l||v<l)&&(S=l),d>c?E=c-x:p>c&&(E=E-(p-c)),g>u?S=u-_:v>u&&(S=S-(v-u)),(E!==m||S!==y)&&translate(o,E-m,S-y)})}function limitInShape(a,r,e,n){each$1(r,function(o,s){var l=o.getCanvasBBox(),c=e[s].getBBox();(l.minX<c.minX||l.minY<c.minY||l.maxX>c.maxX||l.maxY>c.maxY)&&o.remove(!0)})}var MAX_TIMES=100,Greedy=function(){function a(r){r===void 0&&(r={}),this.bitmap={};var e=r.xGap,n=e===void 0?1:e,o=r.yGap,s=o===void 0?8:o;this.xGap=n,this.yGap=s}return a.prototype.hasGap=function(r){for(var e=!0,n=this.bitmap,o=Math.round(r.minX),s=Math.round(r.maxX),l=Math.round(r.minY),c=Math.round(r.maxY),u=o;u<=s;u+=1){if(!n[u]){n[u]={};continue}if(u===o||u===s){for(var f=l;f<=c;f++)if(n[u][f]){e=!1;break}}else if(n[u][l]||n[u][c]){e=!1;break}}return e},a.prototype.fillGap=function(r){for(var e=this.bitmap,n=Math.round(r.minX),o=Math.round(r.maxX),s=Math.round(r.minY),l=Math.round(r.maxY),c=n;c<=o;c+=1)e[c]||(e[c]={});for(var c=n;c<=o;c+=this.xGap){for(var u=s;u<=l;u+=this.yGap)e[c][u]=!0;e[c][l]=!0}if(this.yGap!==1)for(var c=s;c<=l;c+=1)e[n][c]=!0,e[o][c]=!0;if(this.xGap!==1)for(var c=n;c<=o;c+=1)e[c][s]=!0,e[c][l]=!0},a.prototype.destroy=function(){this.bitmap={}},a}();function spiralFill(a,r,e){e===void 0&&(e=MAX_TIMES);var n=-1,o=a.attr(),s=o.x,l=o.y,c=a.getCanvasBBox(),u=Math.sqrt(c.width*c.width+c.height*c.height),f,d=-n,g=0,p=0,v=function(_){var E=_*.1;return[E*Math.cos(E),E*Math.sin(E)]};if(r.hasGap(c))return r.fillGap(c),!0;for(var m=!1,y=0,x={};Math.min(Math.abs(g),Math.abs(p))<u&&y<e;)if(f=v(d+=n),g=~~f[0],p=~~f[1],!(!g&&!p||x["".concat(g,"-").concat(p)])&&(a.attr({x:s+g,y:l+p}),g+p<0&&a.attr("textAlign","right"),y++,r.hasGap(a.getCanvasBBox()))){r.fillGap(a.getCanvasBBox()),m=!0,x["".concat(g,"-").concat(p)]=!0;break}return m}function adjustLabelPosition(a,r,e,n){var o=a.getCanvasBBox(),s=o.width,l=o.height,c={x:r,y:e,textAlign:"center"};switch(n){case 0:c.y-=l+1,c.x+=1,c.textAlign="left";break;case 1:c.y-=l+1,c.x-=1,c.textAlign="right";break;case 2:c.y+=l+1,c.x-=1,c.textAlign="right";break;case 3:c.y+=l+1,c.x+=1,c.textAlign="left";break;case 5:c.y-=l*2+2;break;case 6:c.y+=l*2+2;break;case 7:c.x+=s+1,c.textAlign="left";break;case 8:c.x-=s+1,c.textAlign="right";break}return a.attr(c),a.getCanvasBBox()}function fixedOverlap(a,r,e,n){var o=new Greedy;each$1(r,function(s){var l=s.find(function(c){return c.get("type")==="text"});spiralFill(l,o)||s.remove(!0)}),o.destroy()}function overlap(a,r,e,n){var o=new Greedy;each$1(r,function(s){for(var l=s.find(function(v){return v.get("type")==="text"}),c=l.attr(),u=c.x,f=c.y,d=!1,g=0;g<=8;g++){var p=adjustLabelPosition(l,u,f,g);if(o.hasGap(p)){o.fillGap(p),d=!0;break}}d||s.remove(!0)}),o.destroy()}function dot$2(a,r){return(a[0]||0)*(r[0]||0)+(a[1]||0)*(r[1]||0)+(a[2]||0)*(r[2]||0)}function getAxes(a){if(a.length>4)return[];var r=function(o,s){return[s.x-o.x,s.y-o.y]},e=r(a[0],a[1]),n=r(a[1],a[2]);return[e,n]}function rotateAtPoint(a,r,e){r===void 0&&(r=0),e===void 0&&(e={x:0,y:0});var n=a.x,o=a.y;return{x:(n-e.x)*Math.cos(-r)+(o-e.y)*Math.sin(-r)+e.x,y:(e.x-n)*Math.sin(-r)+(o-e.y)*Math.cos(-r)+e.y}}function getRectPoints(a){var r=[{x:a.x,y:a.y},{x:a.x+a.width,y:a.y},{x:a.x+a.width,y:a.y+a.height},{x:a.x,y:a.y+a.height}],e=a.rotation;return e?[rotateAtPoint(r[0],e,r[0]),rotateAtPoint(r[1],e,r[0]),rotateAtPoint(r[2],e,r[0]),rotateAtPoint(r[3],e,r[0])]:r}function getProjection(a,r){if(a.length>4)return{min:0,max:0};var e=[];return a.forEach(function(n){e.push(dot$2([n.x,n.y],r))}),{min:Math.min.apply(Math,__spreadArray$2([],__read(e),!1)),max:Math.max.apply(Math,__spreadArray$2([],__read(e),!1))}}function isProjectionOverlap(a,r){return a.max>r.min&&a.min<r.max}function isValidNumber(a){return typeof a=="number"&&!Number.isNaN(a)&&a!==1/0&&a!==-1/0}function isValidBox(a){return["x","y","width","height"].every(function(r){return isValidNumber(a[r])})}function isIntersectRect(a,r,e){return e===void 0&&(e=0),!(r.x>a.x+a.width+e||r.x+r.width<a.x-e||r.y>a.y+a.height+e||r.y+r.height<a.y-e)}function intersect(a,r,e){if(e===void 0&&(e=0),!isValidBox(a)||!isValidBox(r))return!1;if(!a.rotation&&!r.rotation)return isIntersectRect(a,r,e);for(var n=getRectPoints(a),o=getRectPoints(r),s=getAxes(n).concat(getAxes(o)),l=0;l<s.length;l++){var c=s[l],u=getProjection(n,c),f=getProjection(o,c);if(!isProjectionOverlap(u,f))return!1}return!0}var MyWorker=function(){function a(r){var e=this;this.queue=[],this.worker=new Worker(r),this.worker.onmessage=function(n){var o;(o=e.queue.shift())===null||o===void 0||o.resolve(n)},this.worker.onmessageerror=function(n){var o;console.warn("[AntV G2] Web worker is not available"),(o=e.queue.shift())===null||o===void 0||o.reject(n)}}return a.prototype.post=function(r,e){var n=this;return new Promise(function(o,s){n.queue.push({resolve:o,reject:s});try{n.worker.postMessage(r)}catch{console.warn("[AntV G2] Web worker is not available"),isFunction$1(e)&&e()}})},a.prototype.destroy=function(){this.worker.terminate()},a}();function createWorker(a){if(!(typeof window>"u")){var r;try{r=new Blob([a.toString()],{type:"application/javascript"})}catch{r=new window.BlobBuilder,r.append(a.toString()),r=r.getBlob()}return new MyWorker(URL.createObjectURL(r))}}var onmessage=function(a){function r(){function f(S,A){return(S[0]||0)*(A[0]||0)+(S[1]||0)*(A[1]||0)+(S[2]||0)*(A[2]||0)}function d(S){if(S.length>4)return[];var A=function(C,L){return[L.x-C.x,L.y-C.y]},T=A(S[0],S[1]),b=A(S[1],S[2]);return[T,b]}function g(S,A,T){A===void 0&&(A=0),T===void 0&&(T={x:0,y:0});var b=S.x,C=S.y;return{x:(b-T.x)*Math.cos(-A)+(C-T.y)*Math.sin(-A)+T.x,y:(T.x-b)*Math.sin(-A)+(C-T.y)*Math.cos(-A)+T.y}}function p(S){var A=[{x:S.x,y:S.y},{x:S.x+S.width,y:S.y},{x:S.x+S.width,y:S.y+S.height},{x:S.x,y:S.y+S.height}],T=S.rotation;return T?[g(A[0],T,A[0]),g(A[1],T,A[0]),g(A[2],T,A[0]),g(A[3],T,A[0])]:A}function v(S,A){if(S.length>4)return{min:0,max:0};var T=[];return S.forEach(function(b){T.push(f([b.x,b.y],A))}),{min:Math.min.apply(null,T),max:Math.max.apply(null,T)}}function m(S,A){return S.max>A.min&&S.min<A.max}function y(S){return typeof S=="number"&&!Number.isNaN(S)&&S!==1/0&&S!==-1/0}function x(S){return["x","y","width","height"].every(function(A){return y(S[A])})}function _(S,A,T){return T===void 0&&(T=0),!(A.x>S.x+S.width+T||A.x+A.width<S.x-T||A.y>S.y+S.height+T||A.y+A.height<S.y-T)}function E(S,A,T){if(T===void 0&&(T=0),!x(S)||!x(A))return!1;if(!S.rotation&&!A.rotation)return _(S,A,T);for(var b=p(S),C=p(A),L=d(b).concat(d(C)),R=0;R<L.length;R++){var I=L[R],w=v(b,I),M=v(C,I);if(!m(w,M))return!1}return!0}return{intersect:E}}var e=r().intersect;function n(f){for(var d=f.slice(),g=0;g<d.length;g++){var p=d[g];if(p.visible)for(var v=g+1;v<d.length;v++){var m=d[v];p!==m&&m.visible&&e(p,m)&&(m.visible=!1)}}return d}var o={"hide-overlap":n};try{var s=JSON.parse(a.data);if(!s||!s.type||!o[s.type])return;var l=s.type,c=s.items,u=o[l](c);self.postMessage(u)}catch(f){throw f}},code=`
   self.onmessage = `.concat(onmessage.toString(),`
`),layout=function(a){for(var r=a.slice(),e=0;e<r.length;e++){var n=r[e];if(n.visible)for(var o=e+1;o<r.length;o++){var s=r[o];n!==s&&s.visible&&intersect(n,s)&&(s.visible=!1)}}return r},cache=new Map,worker=createWorker(code);function hideOverlap(a,r,e,n){return __awaiter(this,void 0,void 0,function(){var o,s,l,c,u,f;return __generator(this,function(d){switch(d.label){case 0:return o=r.map(function(g,p){return __assign$8(__assign$8({},getLabelBackgroundInfo(g,a[p],get(a[p],"background.padding"))),{visible:!0})}),s=JSON.stringify(o),l=function(g){return cache.set(s,g),each$1(g,function(p,v){var m=p.visible,y=r[v];m?y==null||y.show():y==null||y.hide()}),g},cache.get(s)?(l(cache.get(s)),[3,7]):[3,1];case 1:if(!worker)return[3,6];d.label=2;case 2:return d.trys.push([2,4,,5]),c=JSON.stringify({type:"hide-overlap",items:o}),[4,worker.post(c,function(){return l(layout(o))})];case 3:return u=d.sent(),l(Array.isArray(u.data)?u.data:[]),[3,5];case 4:return f=d.sent(),console.error(f),l(layout(o)),[3,5];case 5:return[3,7];case 6:l(layout(o)),d.label=7;case 7:return[2]}})})}var preset={"#5B8FF9":!0},isContrastColorWhite=function(a){var r=colorUtil.toRGB(a).toUpperCase();if(preset[r])return preset[r];var e=__read(colorUtil.rgb2arr(r),3),n=e[0],o=e[1],s=e[2],l=(n*299+o*587+s*114)/1e3<128;return l};function adjustColor(a,r,e){if(e.length!==0){var n=e[0].get("element"),o=n.geometry.theme,s=o.labels||{},l=s.fillColorLight,c=s.fillColorDark;e.forEach(function(u,f){var d=r[f],g=d.find(function(_){return _.get("type")==="text"}),p=BBox.fromObject(u.getBBox()),v=BBox.fromObject(g.getCanvasBBox()),m=!p.contains(v),y=u.attr("fill"),x=isContrastColorWhite(y);m?g.attr(o.overflowLabels.style):x?l&&g.attr("fill",l):c&&g.attr("fill",c)})}}function shouldInShapeSingle(a,r,e){var n=a.coordinate,o=findLabelTextShape(r),s=BBox.fromObject(o.getCanvasBBox()),l=BBox.fromObject(e.getBBox());return n.isTransposed?l.height>=s.height:l.width>=s.width}function shouldInShape(a,r,e){var n=!!a.getAdjust("stack");return n||r.every(function(o,s){var l=e[s];return shouldInShapeSingle(a,o,l)})}function moveInShape(a,r,e){var n=a.coordinate,o=BBox.fromObject(e.getBBox()),s=findLabelTextShape(r);n.isTransposed?s.attr({x:o.minX+o.width/2,textAlign:"center"}):s.attr({y:o.minY+o.height/2,textBaseline:"middle"})}function intervalAdjustPosition(a,r,e){var n;if(e.length!==0){var o=(n=e[0])===null||n===void 0?void 0:n.get("element"),s=o==null?void 0:o.geometry;if(!(!s||s.type!=="interval")){var l=shouldInShape(s,r,e);l&&e.forEach(function(c,u){var f=r[u];moveInShape(s,f,c)})}}}function filterLabel(a){var r=500,e=[],n=Math.max(Math.floor(a.length/r),1);return each$1(a,function(o,s){s%n===0?e.push(o):o.set("visible",!1)}),e}function intervalHideOverlap(a,r,e){var n;if(e.length!==0){var o=(n=e[0])===null||n===void 0?void 0:n.get("element"),s=o==null?void 0:o.geometry;if(!(!s||s.type!=="interval")){var l=filterLabel(r),c=__read(s.getXYFields(),1),u=c[0],f=[],d=[],g=groupBy(l,function(x){return x.get("data")[u]}),p=uniq$2(map$2(l,function(x){return x.get("data")[u]})),v;l.forEach(function(x){x.set("visible",!0)});var m=function(x){x&&(x.length&&d.push(x.pop()),d.push.apply(d,__spreadArray$2([],__read(x),!1)))};for(size(p)>0&&(v=p.shift(),m(g[v])),size(p)>0&&(v=p.pop(),m(g[v])),each$1(p.reverse(),function(x){m(g[x])});d.length>0;){var y=d.shift();y.get("visible")&&(checkShapeOverlap$2(y,f)?y.set("visible",!1):f.push(y))}}}}function sortLabels$1(a,r){var e=a.getXYFields()[1],n=[],o=r.sort(function(s,l){return s.get("data")[e]-s.get("data")[e]});return o.length>0&&n.push(o.shift()),o.length>0&&n.push(o.pop()),n.push.apply(n,__spreadArray$2([],__read(o),!1)),n}function hasSome$1(a,r,e){return a.some(function(n){return e(n,r)})}function getOverlapArea$1(a,r,e){e===void 0&&(e=0);var n=Math.max(0,Math.min(a.x+a.width+e,r.x+r.width+e)-Math.max(a.x-e,r.x-e)),o=Math.max(0,Math.min(a.y+a.height+e,r.y+r.height+e)-Math.max(a.y-e,r.y-e));return n*o}function checkShapeOverlap$1(a,r){return hasSome$1(a,r,function(e,n){var o=findLabelTextShape(e),s=findLabelTextShape(n);return getOverlapArea$1(o.getCanvasBBox(),s.getCanvasBBox(),2)>0})}function pointAdjustPosition(a,r,e,n,o){var s,l;if(e.length!==0){var c=(s=e[0])===null||s===void 0?void 0:s.get("element"),u=c==null?void 0:c.geometry;if(!(!u||u.type!=="point")){var f=__read(u.getXYFields(),2),d=f[0],g=f[1],p=groupBy(r,function(y){return y.get("data")[d]}),v=[],m=o&&o.offset||((l=a[0])===null||l===void 0?void 0:l.offset)||12;map$2(keys(p).reverse(),function(y){for(var x=sortLabels$1(u,p[y]);x.length;){var _=x.shift(),E=findLabelTextShape(_);if(hasSome$1(v,_,function(T,b){return T.get("data")[d]===b.get("data")[d]&&T.get("data")[g]===b.get("data")[g]})){E.set("visible",!1);continue}var S=checkShapeOverlap$1(v,_),A=!1;if(S&&(E.attr("y",E.attr("y")+2*m),A=checkShapeOverlap$1(v,_)),A){E.set("visible",!1);continue}v.push(_)}})}}}function sortLabels(a,r){var e=a.getXYFields()[1],n=[],o=r.sort(function(s,l){return s.get("data")[e]-s.get("data")[e]});return o.length>0&&n.push(o.shift()),o.length>0&&n.push(o.pop()),n.push.apply(n,__spreadArray$2([],__read(o),!1)),n}function hasSome(a,r,e){return a.some(function(n){return e(n,r)})}function getOverlapArea(a,r,e){e===void 0&&(e=0);var n=Math.max(0,Math.min(a.x+a.width+e,r.x+r.width+e)-Math.max(a.x-e,r.x-e)),o=Math.max(0,Math.min(a.y+a.height+e,r.y+r.height+e)-Math.max(a.y-e,r.y-e));return n*o}function checkShapeOverlap(a,r){return hasSome(a,r,function(e,n){var o=findLabelTextShape(e),s=findLabelTextShape(n);return getOverlapArea(o.getCanvasBBox(),s.getCanvasBBox(),2)>0})}function pathAdjustPosition(a,r,e,n,o){var s,l;if(e.length!==0){var c=(s=e[0])===null||s===void 0?void 0:s.get("element"),u=c==null?void 0:c.geometry;if(!(!u||["path","line","area"].indexOf(u.type)<0)){var f=__read(u.getXYFields(),2),d=f[0],g=f[1],p=groupBy(r,function(y){return y.get("data")[d]}),v=[],m=o&&o.offset||((l=a[0])===null||l===void 0?void 0:l.offset)||12;map$2(keys(p).reverse(),function(y){for(var x=sortLabels(u,p[y]);x.length;){var _=x.shift(),E=findLabelTextShape(_);if(hasSome(v,_,function(T,b){return T.get("data")[d]===b.get("data")[d]&&T.get("data")[g]===b.get("data")[g]})){E.set("visible",!1);continue}var S=checkShapeOverlap(v,_),A=!1;if(S&&(E.attr("y",E.attr("y")+2*m),A=checkShapeOverlap(v,_)),A){E.set("visible",!1);continue}v.push(_)}})}}}var ctx$1;function getCanvasContext$1(){return ctx$1||(ctx$1=document.createElement("canvas").getContext("2d")),ctx$1}var measureTextWidth$1=memoize(function(a,r){r===void 0&&(r={});var e=r.fontSize,n=r.fontFamily,o=r.fontWeight,s=r.fontStyle,l=r.fontVariant,c=getCanvasContext$1();return c.font=[s,l,o,"".concat(e,"px"),n].join(" "),c.measureText(isString$1(a)?a:"").width},function(a,r){return r===void 0&&(r={}),__spreadArray$2([a],__read(values(r)),!1).join("")}),getEllipsisText=function(a,r,e){var n=16,o=measureTextWidth$1("...",e),s;isString$1(a)?s=a:s=toString$2(a);var l=r,c=[],u,f;if(measureTextWidth$1(a,e)<=r)return a;for(;u=s.substr(0,n),f=measureTextWidth$1(u,e),!(f+o>l&&f>l);)if(c.push(u),l-=f,s=s.substr(n),!s)return c.join("");for(;u=s.substr(0,1),f=measureTextWidth$1(u,e),!(f+o>l);)if(c.push(u),l-=f,s=s.substr(1),!s)return c.join("");return"".concat(c.join(""),"...")};function limitInPlot$3(a,r,e,n,o){if(!(r.length<=0)){var s=(o==null?void 0:o.direction)||["top","right","bottom","left"],l=(o==null?void 0:o.action)||"translate",c=(o==null?void 0:o.margin)||0,u=r[0].get("coordinate");if(u){var f=getCoordinateBBox(u,c),d=f.minX,g=f.minY,p=f.maxX,v=f.maxY;each$1(r,function(m){var y=m.getCanvasBBox(),x=y.minX,_=y.minY,E=y.maxX,S=y.maxY,A=y.x,T=y.y,b=y.width,C=y.height,L=A,R=T;if(s.indexOf("left")>=0&&(x<d||E<d)&&(L=d),s.indexOf("top")>=0&&(_<g||S<g)&&(R=g),s.indexOf("right")>=0&&(x>p?L=p-b:E>p&&(L=L-(E-p))),s.indexOf("bottom")>=0&&(_>v?R=v-C:S>v&&(R=R-(S-v))),L!==A||R!==T){var I=L-A;if(l==="translate")translate(m,I,R-T);else if(l==="ellipsis"){var w=m.findAll(function(M){return M.get("type")==="text"});w.forEach(function(M){var D=pick$1(M.attr(),["fontSize","fontFamily","fontWeight","fontStyle","fontVariant"]),O=M.getCanvasBBox(),F=getEllipsisText(M.attr("text"),O.width-Math.abs(I),D);M.attr("text",F)})}else m.hide()}})}}}function fadeIn(a,r,e){var n={fillOpacity:isNil(a.attr("fillOpacity"))?1:a.attr("fillOpacity"),strokeOpacity:isNil(a.attr("strokeOpacity"))?1:a.attr("strokeOpacity"),opacity:isNil(a.attr("opacity"))?1:a.attr("opacity")};a.attr({fillOpacity:0,strokeOpacity:0,opacity:0}),a.animate(n,r)}function fadeOut(a,r,e){var n={fillOpacity:0,strokeOpacity:0,opacity:0},o=r.easing,s=r.duration,l=r.delay;a.animate(n,s,o,function(){a.remove(!0)},l)}function transformShape(a,r,e){var n,o=__read(r,2),s=o[0],l=o[1];return a.applyToMatrix([s,l,1]),e==="x"?(a.setMatrix(transform$6(a.getMatrix(),[["t",-s,-l],["s",.01,1],["t",s,l]])),n=transform$6(a.getMatrix(),[["t",-s,-l],["s",100,1],["t",s,l]])):e==="y"?(a.setMatrix(transform$6(a.getMatrix(),[["t",-s,-l],["s",1,.01],["t",s,l]])),n=transform$6(a.getMatrix(),[["t",-s,-l],["s",1,100],["t",s,l]])):e==="xy"&&(a.setMatrix(transform$6(a.getMatrix(),[["t",-s,-l],["s",.01,.01],["t",s,l]])),n=transform$6(a.getMatrix(),[["t",-s,-l],["s",100,100],["t",s,l]])),n}function doScaleAnimate(a,r,e,n,o){var s=e.start,l=e.end,c=e.getWidth(),u=e.getHeight(),f,d;o==="y"?(f=s.x+c/2,d=n.y<s.y?n.y:s.y):o==="x"?(f=n.x>s.x?n.x:s.x,d=s.y+u/2):o==="xy"&&(e.isPolar?(f=e.getCenter().x,d=e.getCenter().y):(f=(s.x+l.x)/2,d=(s.y+l.y)/2));var g=transformShape(a,[f,d],o);a.animate({matrix:g},r)}function growInX(a,r,e){var n=e.coordinate,o=e.minYPoint;doScaleAnimate(a,r,n,o,"x")}function growInY(a,r,e){var n=e.coordinate,o=e.minYPoint;doScaleAnimate(a,r,n,o,"y")}function growInXY(a,r,e){var n=e.coordinate,o=e.minYPoint;doScaleAnimate(a,r,n,o,"xy")}function pathIn(a,r,e){var n=a.getTotalLength();a.attr("lineDash",[n]),a.animate(function(o){return{lineDashOffset:(1-o)*n}},r)}function positionUpdate(a,r,e){var n=e.toAttrs,o=n.x,s=n.y;delete n.x,delete n.y,a.attr(n),a.animate({x:o,y:s},r)}function scaleInX(a,r,e){var n=a.getBBox(),o=a.get("origin").mappingData,s=o.points,l=s[0].y-s[1].y>0?n.maxX:n.minX,c=(n.minY+n.maxY)/2;a.applyToMatrix([l,c,1]);var u=transform$6(a.getMatrix(),[["t",-l,-c],["s",.01,1],["t",l,c]]);a.setMatrix(u),a.animate({matrix:transform$6(a.getMatrix(),[["t",-l,-c],["s",100,1],["t",l,c]])},r)}function scaleInY(a,r,e){var n=a.getBBox(),o=a.get("origin").mappingData,s=(n.minX+n.maxX)/2,l=o.points,c=l[0].y-l[1].y<=0?n.maxY:n.minY;a.applyToMatrix([s,c,1]);var u=transform$6(a.getMatrix(),[["t",-s,-c],["s",1,.01],["t",s,c]]);a.setMatrix(u),a.animate({matrix:transform$6(a.getMatrix(),[["t",-s,-c],["s",1,100],["t",s,c]])},r)}function getAngle(a,r){var e,n=getArcParams(a,r),o=n.startAngle,s=n.endAngle;return!isNumberEqual$1(o,-Math.PI*.5)&&o<-Math.PI*.5&&(o+=Math.PI*2),!isNumberEqual$1(s,-Math.PI*.5)&&s<-Math.PI*.5&&(s+=Math.PI*2),r[5]===0&&(e=__read([s,o],2),o=e[0],s=e[1]),isNumberEqual$1(o,Math.PI*1.5)&&(o=Math.PI*-.5),isNumberEqual$1(s,Math.PI*-.5)&&!isNumberEqual$1(o,s)&&(s=Math.PI*1.5),{startAngle:o,endAngle:s}}function getArcStartPoint(a){var r;return a[0]==="M"||a[0]==="L"?r=[a[1],a[2]]:(a[0]==="a"||a[0]==="A"||a[0]==="C")&&(r=[a[a.length-2],a[a.length-1]]),r}function getArcInfo(a){var r,e,n,o=a.filter(function(S){return S[0]==="A"||S[0]==="a"});if(o.length===0)return{startAngle:0,endAngle:0,radius:0,innerRadius:0};var s=o[0],l=o.length>1?o[1]:o[0],c=a.indexOf(s),u=a.indexOf(l),f=getArcStartPoint(a[c-1]),d=getArcStartPoint(a[u-1]),g=getAngle(f,s),p=g.startAngle,v=g.endAngle,m=getAngle(d,l),y=m.startAngle,x=m.endAngle;isNumberEqual$1(p,y)&&isNumberEqual$1(v,x)?(e=p,n=v):(e=Math.min(p,y),n=Math.max(v,x));var _=s[1],E=o[o.length-1][1];return _<E?(r=__read([E,_],2),_=r[0],E=r[1]):_===E&&(E=0),{startAngle:e,endAngle:n,radius:_,innerRadius:E}}function sectorPathUpdate(a,r,e){var n=e.toAttrs,o=e.coordinate,s=n.path||[],l=s.map(function(E){return E[0]});if(!(s.length<1)){var c=getArcInfo(s),u=c.startAngle,f=c.endAngle,d=c.radius,g=c.innerRadius,p=getArcInfo(a.attr("path")),v=p.startAngle,m=p.endAngle,y=o.getCenter(),x=u-v,_=f-m;if(x===0&&_===0){a.attr("path",s);return}a.animate(function(E){var S=v+E*x,A=m+E*_;return __assign$8(__assign$8({},n),{path:isEqual$1(l,["M","A","A","Z"])?getArcPath(y.x,y.y,d,S,A):getSectorPath(y.x,y.y,d,S,A,g)})},__assign$8(__assign$8({},r),{callback:function(){a.attr("path",s),isFunction$1(r.callback)&&r.callback()}}))}}function waveIn(a,r,e){var n=getCoordinateClipCfg(e.coordinate,20),o=n.type,s=n.startState,l=n.endState,c=a.setClip({type:o,attrs:s});e.toAttrs&&a.attr(e.toAttrs),c.animate(l,__assign$8(__assign$8({},r),{callback:function(){a&&!a.get("destroyed")&&a.set("clipShape",null),c.remove(!0),isFunction$1(r.callback)&&r.callback()}}))}function doShapeZoom(a,r,e){if(a.isGroup())each$1(a.getChildren(),function(c){doShapeZoom(c,r,e)});else{var n=a.getBBox(),o=(n.minX+n.maxX)/2,s=(n.minY+n.maxY)/2;if(a.applyToMatrix([o,s,1]),e==="zoomIn"){var l=transform$6(a.getMatrix(),[["t",-o,-s],["s",.01,.01],["t",o,s]]);a.setMatrix(l),a.animate({matrix:transform$6(a.getMatrix(),[["t",-o,-s],["s",100,100],["t",o,s]])},r)}else a.animate({matrix:transform$6(a.getMatrix(),[["t",-o,-s],["s",.01,.01],["t",o,s]])},__assign$8(__assign$8({},r),{callback:function(){a.remove(!0),isFunction$1(r.callback)&&r.callback()}}))}}function zoomIn(a,r,e){doShapeZoom(a,r,"zoomIn")}function zoomOut(a,r,e){doShapeZoom(a,r,"zoomOut")}function getFactTitleConfig(a){return[DIRECTION.TOP,DIRECTION.BOTTOM].includes(a)?{offsetX:0,offsetY:a===DIRECTION.TOP?-8:8,style:{textAlign:"center",textBaseline:a===DIRECTION.TOP?"bottom":"top"}}:[DIRECTION.LEFT,DIRECTION.RIGHT].includes(a)?{offsetX:a===DIRECTION.LEFT?-8:8,offsetY:0,style:{textAlign:a===DIRECTION.LEFT?"right":"left",textBaseline:"middle",rotate:Math.PI/2}}:{}}function getAnglePoint(a,r,e){return{x:a.x+r*Math.cos(e),y:a.y+r*Math.sin(e)}}var Circle=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){return deepMix({},a.prototype.getDefaultCfg.call(this),{type:"circle",showTitle:!0,title:a.prototype.getDefaultTitleCfg.call(this)})},r.prototype.render=function(){a.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},r.prototype.getRegion=function(e,n){var o=.5,s={x:.5,y:.5},l=Math.PI*2/e,c=-1*Math.PI/2+l*n,u=o/(1+1/Math.sin(l/2)),f=getAnglePoint(s,o-u,c),d=Math.PI*5/4,g=Math.PI*1/4;return{start:getAnglePoint(f,u,d),end:getAnglePoint(f,u,g)}},r.prototype.afterEachView=function(e,n){this.processAxis(e,n)},r.prototype.beforeEachView=function(e,n){},r.prototype.generateFacets=function(e){var n=this,o=this.cfg,s=o.fields,l=o.type,c=__read(s,1),u=c[0];if(!u)throw new Error("No `fields` specified!");var f=this.getFieldValues(e,u),d=f.length,g=[];return f.forEach(function(p,v){var m=[{field:u,value:p,values:f}],y=filter(e,n.getFacetDataFilter(m)),x={type:l,data:y,region:n.getRegion(d,v),columnValue:p,columnField:u,columnIndex:v,columnValuesLength:d,rowValue:null,rowField:null,rowIndex:0,rowValuesLength:1};g.push(x)}),g},r.prototype.getXAxisOption=function(e,n,o,s){return o},r.prototype.getYAxisOption=function(e,n,o,s){return o},r.prototype.renderTitle=function(){var e=this;each$1(this.facets,function(n){var o=n.columnValue,s=n.view,l=get(e.cfg.title,"formatter"),c=deepMix({position:["50%","0%"],content:l?l(o):o},getFactTitleConfig(DIRECTION.TOP),e.cfg.title);s.annotation().text(c)})},r}(Facet$1),List=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){return deepMix({},a.prototype.getDefaultCfg.call(this),{type:"list",cols:null,showTitle:!0,title:a.prototype.getDefaultTitleCfg.call(this)})},r.prototype.render=function(){a.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},r.prototype.afterEachView=function(e,n){this.processAxis(e,n)},r.prototype.beforeEachView=function(e,n){},r.prototype.generateFacets=function(e){var n=this,o=this.cfg.fields,s=this.cfg.cols,l=__read(o,1),c=l[0];if(!c)throw new Error("No `fields` specified!");var u=this.getFieldValues(e,c),f=u.length;s=s||f;var d=this.getPageCount(f,s),g=[];return u.forEach(function(p,v){var m=n.getRowCol(v,s),y=m.row,x=m.col,_=[{field:c,value:p,values:u}],E=filter(e,n.getFacetDataFilter(_)),S={type:n.cfg.type,data:E,region:n.getRegion(d,s,x,y),columnValue:p,rowValue:p,columnField:c,rowField:null,columnIndex:x,rowIndex:y,columnValuesLength:s,rowValuesLength:d,total:f};g.push(S)}),g},r.prototype.getXAxisOption=function(e,n,o,s){return s.rowIndex!==s.rowValuesLength-1&&s.columnValuesLength*s.rowIndex+s.columnIndex+1+s.columnValuesLength<=s.total?__assign$8(__assign$8({},o),{label:null,title:null}):o},r.prototype.getYAxisOption=function(e,n,o,s){return s.columnIndex!==0?__assign$8(__assign$8({},o),{title:null,label:null}):o},r.prototype.renderTitle=function(){var e=this;each$1(this.facets,function(n){var o=n.columnValue,s=n.view,l=get(e.cfg.title,"formatter"),c=deepMix({position:["50%","0%"],content:l?l(o):o},getFactTitleConfig(DIRECTION.TOP),e.cfg.title);s.annotation().text(c)})},r.prototype.getPageCount=function(e,n){return Math.floor((e+n-1)/n)},r.prototype.getRowCol=function(e,n){var o=Math.floor(e/n),s=e%n;return{row:o,col:s}},r}(Facet$1),Matrix=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){return deepMix({},a.prototype.getDefaultCfg.call(this),{type:"matrix",showTitle:!1,columnTitle:__assign$8({},a.prototype.getDefaultTitleCfg.call(this)),rowTitle:__assign$8({},a.prototype.getDefaultTitleCfg.call(this))})},r.prototype.render=function(){a.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},r.prototype.afterEachView=function(e,n){this.processAxis(e,n)},r.prototype.beforeEachView=function(e,n){},r.prototype.generateFacets=function(e){for(var n=this.cfg,o=n.fields,s=n.type,l=o.length,c=l,u=[],f=0;f<c;f++)for(var d=o[f],g=0;g<l;g++){var p=o[g],v={type:s,data:e,region:this.getRegion(l,c,f,g),columnValue:d,rowValue:p,columnField:d,rowField:p,columnIndex:f,rowIndex:g,columnValuesLength:c,rowValuesLength:l};u.push(v)}return u},r.prototype.getXAxisOption=function(e,n,o,s){return s.rowIndex!==s.rowValuesLength-1?__assign$8(__assign$8({},o),{label:null,title:null}):o},r.prototype.getYAxisOption=function(e,n,o,s){return s.columnIndex!==0?__assign$8(__assign$8({},o),{title:null,label:null}):o},r.prototype.renderTitle=function(){var e=this;each$1(this.facets,function(n,o){var s=n.columnIndex,l=n.rowIndex,c=n.columnValuesLength;n.rowValuesLength;var u=n.columnValue,f=n.rowValue,d=n.view;if(l===0){var g=get(e.cfg.columnTitle,"formatter"),p=deepMix({position:["50%","0%"],content:g?g(u):u},getFactTitleConfig(DIRECTION.TOP),e.cfg.columnTitle);d.annotation().text(p)}if(s===c-1){var g=get(e.cfg.rowTitle,"formatter"),p=deepMix({position:["100%","50%"],content:g?g(f):f},getFactTitleConfig(DIRECTION.RIGHT),e.cfg.rowTitle);d.annotation().text(p)}})},r}(Facet$1),Mirror=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getDefaultCfg=function(){return deepMix({},a.prototype.getDefaultCfg.call(this),{type:"mirror",showTitle:!0,title:a.prototype.getDefaultTitleCfg.call(this),transpose:!1})},r.prototype.render=function(){a.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},r.prototype.beforeEachView=function(e,n){this.cfg.transpose?n.columnIndex%2===0?e.coordinate().transpose().reflect("x"):e.coordinate().transpose():n.rowIndex%2!==0&&e.coordinate().reflect("y")},r.prototype.afterEachView=function(e,n){this.processAxis(e,n)},r.prototype.generateFacets=function(e){var n=this,o=__read(this.cfg.fields,1),s=o[0],l=[],c=1,u=1,f=[""],d=[""],g,p;return this.cfg.transpose?(g=s,f=this.getFieldValues(e,g).slice(0,2),c=f.length):(p=s,d=this.getFieldValues(e,p).slice(0,2),u=d.length),f.forEach(function(v,m){d.forEach(function(y,x){var _=[{field:g,value:v,values:f},{field:p,value:y,values:d}],E=filter(e,n.getFacetDataFilter(_)),S={type:n.cfg.type,data:E,region:n.getRegion(u,c,m,x),columnValue:v,rowValue:y,columnField:g,rowField:p,columnIndex:m,rowIndex:x,columnValuesLength:c,rowValuesLength:u};l.push(S)})}),l},r.prototype.getXAxisOption=function(e,n,o,s){return s.columnIndex===1||s.rowIndex===1?__assign$8(__assign$8({},o),{label:null,title:null}):o},r.prototype.getYAxisOption=function(e,n,o,s){return o},r.prototype.renderTitle=function(){var e=this;each$1(this.facets,function(n,o){var s=n.columnValue,l=n.rowValue,c=n.view,u=get(e.cfg.title,"formatter");if(e.cfg.transpose){var f=deepMix({position:["50%","0%"],content:u?u(s):s},getFactTitleConfig(DIRECTION.TOP),e.cfg.title);c.annotation().text(f)}else{var f=deepMix({position:["100%","50%"],content:u?u(l):l},getFactTitleConfig(DIRECTION.RIGHT),e.cfg.title);c.annotation().text(f)}})},r}(Facet$1),Rect=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.afterEachView=function(e,n){this.processAxis(e,n)},r.prototype.beforeEachView=function(e,n){},r.prototype.getDefaultCfg=function(){return deepMix({},a.prototype.getDefaultCfg.call(this),{type:"rect",columnTitle:__assign$8({},a.prototype.getDefaultTitleCfg.call(this)),rowTitle:__assign$8({},a.prototype.getDefaultTitleCfg.call(this))})},r.prototype.render=function(){a.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},r.prototype.generateFacets=function(e){var n=this,o=__read(this.cfg.fields,2),s=o[0],l=o[1],c=[],u=1,f=1,d=[""],g=[""];return s&&(d=this.getFieldValues(e,s),u=d.length),l&&(g=this.getFieldValues(e,l),f=g.length),d.forEach(function(p,v){g.forEach(function(m,y){var x=[{field:s,value:p,values:d},{field:l,value:m,values:g}],_=filter(e,n.getFacetDataFilter(x)),E={type:n.cfg.type,data:_,region:n.getRegion(f,u,v,y),columnValue:p,rowValue:m,columnField:s,rowField:l,columnIndex:v,rowIndex:y,columnValuesLength:u,rowValuesLength:f};c.push(E)})}),c},r.prototype.renderTitle=function(){var e=this;each$1(this.facets,function(n,o){var s=n.columnIndex,l=n.rowIndex,c=n.columnValuesLength,u=n.columnValue,f=n.rowValue,d=n.view;if(l===0){var g=get(e.cfg.columnTitle,"formatter"),p=deepMix({position:["50%","0%"],content:g?g(u):u},getFactTitleConfig(DIRECTION.TOP),e.cfg.columnTitle);d.annotation().text(p)}if(s===c-1){var g=get(e.cfg.rowTitle,"formatter"),p=deepMix({position:["100%","50%"],content:g?g(f):f},getFactTitleConfig(DIRECTION.RIGHT),e.cfg.rowTitle);d.annotation().text(p)}})},r.prototype.getXAxisOption=function(e,n,o,s){return s.rowIndex!==s.rowValuesLength-1?__assign$8(__assign$8({},o),{title:null,label:null}):s.columnIndex!==Math.floor((s.columnValuesLength-1)/2)?__assign$8(__assign$8({},o),{title:null}):o},r.prototype.getYAxisOption=function(e,n,o,s){return s.columnIndex!==0?__assign$8(__assign$8({},o),{title:null,label:null}):s.rowIndex!==Math.floor((s.rowValuesLength-1)/2)?__assign$8(__assign$8({},o),{title:null}):o},r}(Facet$1),Tree=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.afterChartRender=function(){e.facets&&e.cfg.line&&(e.container.clear(),e.drawLines(e.facets))},e}return r.prototype.afterEachView=function(e,n){this.processAxis(e,n)},r.prototype.beforeEachView=function(e,n){},r.prototype.init=function(){a.prototype.init.call(this),this.view.on(VIEW_LIFE_CIRCLE.AFTER_RENDER,this.afterChartRender)},r.prototype.getDefaultCfg=function(){return deepMix({},a.prototype.getDefaultCfg.call(this),{type:"tree",line:{style:{lineWidth:1,stroke:"#ddd"},smooth:!1},showTitle:!0,title:a.prototype.getDefaultTitleCfg.call(this)})},r.prototype.generateFacets=function(e){var n=this.cfg.fields;if(!n.length)throw new Error("Please specify for the fields for rootFacet!");var o=[],s={type:this.cfg.type,data:e,region:null,rowValuesLength:this.getRows(),columnValuesLength:1,rowIndex:0,columnIndex:0,rowField:"",columnField:"",rowValue:"",columnValue:""};return o.push(s),s.children=this.getChildFacets(e,1,o),this.setRegion(o),o},r.prototype.setRegion=function(e){var n=this;this.forceColIndex(e),e.forEach(function(o){o.region=n.getRegion(o.rowValuesLength,o.columnValuesLength,o.columnIndex,o.rowIndex)})},r.prototype.getRegion=function(e,n,o,s){var l=1/n,c=1/e,u={x:l*o,y:c*s},f={x:u.x+l,y:u.y+c*2/3};return{start:u,end:f}},r.prototype.forceColIndex=function(e){var n,o,s=this,l=[],c=0;e.forEach(function(m){s.isLeaf(m)&&(l.push(m),m.columnIndex=c,c++)}),l.forEach(function(m){m.columnValuesLength=l.length});for(var u=this.cfg.fields.length,f=u-1;f>=0;f--){var d=this.getFacetsByLevel(e,f);try{for(var g=(n=void 0,__values(d)),p=g.next();!p.done;p=g.next()){var v=p.value;this.isLeaf(v)||(v.originColIndex=v.columnIndex,v.columnIndex=this.getRegionIndex(v.children),v.columnValuesLength=l.length)}}catch(m){n={error:m}}finally{try{p&&!p.done&&(o=g.return)&&o.call(g)}finally{if(n)throw n.error}}}},r.prototype.getFacetsByLevel=function(e,n){var o=[];return e.forEach(function(s){s.rowIndex===n&&o.push(s)}),o},r.prototype.getRegionIndex=function(e){var n=e[0],o=e[e.length-1];return(o.columnIndex-n.columnIndex)/2+n.columnIndex},r.prototype.isLeaf=function(e){return!e.children||!e.children.length},r.prototype.getRows=function(){return this.cfg.fields.length+1},r.prototype.getChildFacets=function(e,n,o){var s=this,l=this.cfg.fields,c=l.length;if(!(c<n)){var u=[],f=l[n-1],d=this.getFieldValues(e,f);return d.forEach(function(g,p){var v=[{field:f,value:g,values:d}],m=e.filter(s.getFacetDataFilter(v));if(m.length){var y={type:s.cfg.type,data:m,region:null,columnValue:g,rowValue:"",columnField:f,rowField:"",columnIndex:p,rowValuesLength:s.getRows(),columnValuesLength:1,rowIndex:n,children:s.getChildFacets(m,n+1,o)};u.push(y),o.push(y)}}),u}},r.prototype.render=function(){a.prototype.render.call(this),this.cfg.showTitle&&this.renderTitle()},r.prototype.renderTitle=function(){var e=this;each$1(this.facets,function(n){var o=n.columnValue,s=n.view,l=get(e.cfg.title,"formatter"),c=deepMix({position:["50%","0%"],content:l?l(o):o},getFactTitleConfig(DIRECTION.TOP),e.cfg.title);s.annotation().text(c)})},r.prototype.drawLines=function(e){var n=this;e.forEach(function(o){if(!n.isLeaf(o)){var s=o.children;n.addFacetLines(o,s)}})},r.prototype.addFacetLines=function(e,n){var o=this,s=e.view,l=s.coordinateBBox,c={x:l.x+l.width/2,y:l.y+l.height};n.forEach(function(u){var f=u.view.coordinateBBox,d={x:f.bl.x+(f.tr.x-f.bl.x)/2,y:f.tr.y},g={x:c.x,y:c.y+(d.y-c.y)/2},p={x:d.x,y:g.y};o.drawLine([c,g,p,d])})},r.prototype.getPath=function(e){var n=[],o=this.cfg.line.smooth;return o?(n.push(["M",e[0].x,e[0].y]),n.push(["C",e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y])):e.forEach(function(s,l){l===0?n.push(["M",s.x,s.y]):n.push(["L",s.x,s.y])}),n},r.prototype.drawLine=function(e){var n=this.getPath(e),o=this.cfg.line.style;this.container.addShape("path",{attrs:mix({path:n},o)})},r.prototype.getXAxisOption=function(e,n,o,s){return s.rowIndex!==s.rowValuesLength-1?__assign$8(__assign$8({},o),{title:null,label:null}):o},r.prototype.getYAxisOption=function(e,n,o,s){return s.originColIndex!==0&&s.columnIndex!==0?__assign$8(__assign$8({},o),{title:null,label:null}):o},r}(Facet$1);function getMedian(a){var r=__spreadArray$2([],__read(a),!1);r.sort(function(n,o){return n-o});var e=r.length;return e===0?0:e%2===1?r[(e-1)/2]:(r[e/2]+r[e/2-1])/2}function getMean(a){var r=reduce(a,function(e,n){return e+=isNaN(n)||!isNumber$2(n)?0:n},0);return a.length===0?0:r/a.length}function getNormalizedValue(a,r){if(!r)return null;var e;switch(a){case"start":return 0;case"center":return .5;case"end":return 1;case"median":{e=r.isCategory?getMedian(r.values.map(function(n,o){return o})):getMedian(r.values);break}case"mean":{e=r.isCategory?(r.values.length-1)/2:getMean(r.values);break}case"min":e=r.isCategory?0:r[a];break;case"max":e=r.isCategory?r.values.length-1:r[a];break;default:e=a;break}return r.scale(e)}var ANNOTATIONS_AFTER_RENDER=["regionFilter","shape"],Annotation=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;return n.cache=new Map,n.foregroundContainer=n.view.getLayer(LAYER.FORE).addGroup(),n.backgroundContainer=n.view.getLayer(LAYER.BG).addGroup(),n.option=[],n}return Object.defineProperty(r.prototype,"name",{get:function(){return"annotation"},enumerable:!1,configurable:!0}),r.prototype.init=function(){},r.prototype.layout=function(){this.update()},r.prototype.render=function(){},r.prototype.update=function(){var e=this;this.onAfterRender(function(){var o=new Map;each$1(e.option,function(s){if(contains(ANNOTATIONS_AFTER_RENDER,s.type)){var l=e.updateOrCreate(s);l&&o.set(e.getCacheKey(s),l)}}),e.cache=e.syncCache(o)});var n=new Map;each$1(this.option,function(o){if(!contains(ANNOTATIONS_AFTER_RENDER,o.type)){var s=e.updateOrCreate(o);s&&n.set(e.getCacheKey(o),s)}}),this.cache=this.syncCache(n)},r.prototype.clear=function(e){e===void 0&&(e=!1),a.prototype.clear.call(this),this.clearComponents(),this.foregroundContainer.clear(),this.backgroundContainer.clear(),e&&(this.option=[])},r.prototype.destroy=function(){this.clear(!0),this.foregroundContainer.remove(!0),this.backgroundContainer.remove(!0)},r.prototype.getComponents=function(){var e=[];return this.cache.forEach(function(n){e.push(n)}),e},r.prototype.clearComponents=function(){this.getComponents().forEach(function(e){e.component.destroy()}),this.cache.clear()},r.prototype.onAfterRender=function(e){var n=!1;this.view.getOptions().animate&&this.view.geometries.forEach(function(o){o.animateOption&&(o.once(GEOMETRY_LIFE_CIRCLE.AFTER_DRAW_ANIMATE,function(){e()}),n=!0)}),n||this.view.getRootView().once(VIEW_LIFE_CIRCLE.AFTER_RENDER,function(){e()})},r.prototype.createAnnotation=function(e){var n=e.type,o=AnnotationComponent[upperFirst(n)];if(o){var s=this.getAnnotationTheme(n),l=this.getAnnotationCfg(n,e,s);if(!l)return null;var c=new o(l);return{component:c,layer:this.isTop(l)?LAYER.FORE:LAYER.BG,direction:DIRECTION.NONE,type:COMPONENT_TYPE.ANNOTATION,extra:e}}},r.prototype.annotation=function(e){this.option.push(e)},r.prototype.arc=function(e){return this.annotation(__assign$8({type:"arc"},e)),this},r.prototype.image=function(e){return this.annotation(__assign$8({type:"image"},e)),this},r.prototype.line=function(e){return this.annotation(__assign$8({type:"line"},e)),this},r.prototype.region=function(e){return this.annotation(__assign$8({type:"region"},e)),this},r.prototype.text=function(e){return this.annotation(__assign$8({type:"text"},e)),this},r.prototype.dataMarker=function(e){return this.annotation(__assign$8({type:"dataMarker"},e)),this},r.prototype.dataRegion=function(e){this.annotation(__assign$8({type:"dataRegion"},e))},r.prototype.regionFilter=function(e){this.annotation(__assign$8({type:"regionFilter"},e))},r.prototype.shape=function(e){this.annotation(__assign$8({type:"shape"},e))},r.prototype.html=function(e){this.annotation(__assign$8({type:"html"},e))},r.prototype.parsePosition=function(e){var n,o,s=this.view.getXScale(),l=this.view.getScalesByDim("y"),c=isFunction$1(e)?e.call(null,s,l):e,u=0,f=0;if(isArray$4(c)){var d=__read(c,2),g=d[0],p=d[1];if(isString$1(g)&&g.indexOf("%")!==-1&&!isNaN(g.slice(0,-1)))return this.parsePercentPosition(c);u=getNormalizedValue(g,s),f=getNormalizedValue(p,Object.values(l)[0])}else if(!isNil(c))try{for(var v=__values(keys(c)),m=v.next();!m.done;m=v.next()){var y=m.value,x=c[y];y===s.field&&(u=getNormalizedValue(x,s)),l[y]&&(f=getNormalizedValue(x,l[y]))}}catch(_){n={error:_}}finally{try{m&&!m.done&&(o=v.return)&&o.call(v)}finally{if(n)throw n.error}}return isNaN(u)||isNaN(f)?null:this.view.getCoordinate().convert({x:u,y:f})},r.prototype.getRegionPoints=function(e,n){var o=this,s=this.view.getXScale(),l=this.view.getScalesByDim("y"),c=Object.values(l)[0],u=s.field,f=this.view.getData(),d=isArray$4(e)?e[0]:e[u],g=isArray$4(n)?n[0]:n[u],p=[],v;return each$1(f,function(m,y){if(m[u]===d&&(v=y),y>=v){var x=o.parsePosition([m[u],m[c.field]]);x&&p.push(x)}if(m[u]===g)return!1}),p},r.prototype.parsePercentPosition=function(e){var n=parseFloat(e[0])/100,o=parseFloat(e[1])/100,s=this.view.getCoordinate(),l=s.start,c=s.end,u={x:Math.min(l.x,c.x),y:Math.min(l.y,c.y)},f=s.getWidth()*n+u.x,d=s.getHeight()*o+u.y;return{x:f,y:d}},r.prototype.getCoordinateBBox=function(){var e=this.view.getCoordinate(),n=e.start,o=e.end,s=e.getWidth(),l=e.getHeight(),c={x:Math.min(n.x,o.x),y:Math.min(n.y,o.y)};return{x:c.x,y:c.y,minX:c.x,minY:c.y,maxX:c.x+s,maxY:c.y+l,width:s,height:l}},r.prototype.getAnnotationCfg=function(e,n,o){var s=this,l=this.view.getCoordinate(),c=this.view.getCanvas(),u={};if(isNil(n))return null;var f=n.start,d=n.end,g=n.position,p=this.parsePosition(f),v=this.parsePosition(d),m=this.parsePosition(g);if(["arc","image","line","region","regionFilter"].includes(e)&&(!p||!v))return null;if(["text","dataMarker","html"].includes(e)&&!m)return null;if(e==="arc"){var y=n;y.start,y.end;var x=__rest$1(y,["start","end"]),_=getAngleByPoint(l,p),E=getAngleByPoint(l,v);_>E&&(E=Math.PI*2+E),u=__assign$8(__assign$8({},x),{center:l.getCenter(),radius:getDistanceToCenter(l,p),startAngle:_,endAngle:E})}else if(e==="image"){var S=n;S.start,S.end;var x=__rest$1(S,["start","end"]);u=__assign$8(__assign$8({},x),{start:p,end:v,src:n.src})}else if(e==="line"){var A=n;A.start,A.end;var x=__rest$1(A,["start","end"]);u=__assign$8(__assign$8({},x),{start:p,end:v,text:get(n,"text",null)})}else if(e==="region"){var T=n;T.start,T.end;var x=__rest$1(T,["start","end"]);u=__assign$8(__assign$8({},x),{start:p,end:v})}else if(e==="text"){var b=this.view.getData(),C=n;C.position;var L=C.content,x=__rest$1(C,["position","content"]),R=L;isFunction$1(L)&&(R=L(b)),u=__assign$8(__assign$8(__assign$8({},m),x),{content:R})}else if(e==="dataMarker"){var I=n;I.position;var w=I.point,M=I.line,D=I.text,O=I.autoAdjust,F=I.direction,x=__rest$1(I,["position","point","line","text","autoAdjust","direction"]);u=__assign$8(__assign$8(__assign$8({},x),m),{coordinateBBox:this.getCoordinateBBox(),point:w,line:M,text:D,autoAdjust:O,direction:F})}else if(e==="dataRegion"){var k=n,$=k.start,V=k.end,N=k.region,D=k.text,B=k.lineLength,x=__rest$1(k,["start","end","region","text","lineLength"]);u=__assign$8(__assign$8({},x),{points:this.getRegionPoints($,V),region:N,text:D,lineLength:B})}else if(e==="regionFilter"){var G=n;G.start,G.end;var z=G.apply,H=G.color,x=__rest$1(G,["start","end","apply","color"]),W=this.view.geometries,Y=[],K=function(lt){lt&&(lt.isGroup()?lt.getChildren().forEach(function(ut){return K(ut)}):Y.push(lt))};each$1(W,function(lt){z?contains(z,lt.type)&&each$1(lt.elements,function(ut){K(ut.shape)}):each$1(lt.elements,function(ut){K(ut.shape)})}),u=__assign$8(__assign$8({},x),{color:H,shapes:Y,start:p,end:v})}else if(e==="shape"){var Z=n,tt=Z.render,et=__rest$1(Z,["render"]),at=function(dt){if(isFunction$1(n.render))return tt(dt,s.view,{parsePosition:s.parsePosition.bind(s)})};u=__assign$8(__assign$8({},et),{render:at})}else if(e==="html"){var ot=n,nt=ot.html;ot.position;var et=__rest$1(ot,["html","position"]),Q=function(lt){return isFunction$1(nt)?nt(lt,s.view):nt};u=__assign$8(__assign$8(__assign$8({},et),m),{parent:c.get("el").parentNode,html:Q})}var st=deepMix({},o,__assign$8(__assign$8({},u),{top:n.top,style:n.style,offsetX:n.offsetX,offsetY:n.offsetY}));return e!=="html"&&(st.container=this.getComponentContainer(st)),st.animate=this.view.getOptions().animate&&st.animate&&get(n,"animate",st.animate),st.animateOption=deepMix({},DEFAULT_ANIMATE_CFG,st.animateOption,n.animateOption),st},r.prototype.isTop=function(e){return get(e,"top",!0)},r.prototype.getComponentContainer=function(e){return this.isTop(e)?this.foregroundContainer:this.backgroundContainer},r.prototype.getAnnotationTheme=function(e){return get(this.view.getTheme(),["components","annotation",e],{})},r.prototype.updateOrCreate=function(e){var n=this.cache.get(this.getCacheKey(e));if(n){var o=e.type,s=this.getAnnotationTheme(o),l=this.getAnnotationCfg(o,e,s);l&&omit(l,["container"]),n.component.update(__assign$8(__assign$8({},l||{}),{visible:!!l})),contains(ANNOTATIONS_AFTER_RENDER,e.type)&&n.component.render()}else n=this.createAnnotation(e),n&&(n.component.init(),contains(ANNOTATIONS_AFTER_RENDER,e.type)&&n.component.render());return n},r.prototype.syncCache=function(e){var n=this,o=new Map(this.cache);return e.forEach(function(s,l){o.set(l,s)}),o.forEach(function(s,l){find$2(n.option,function(c){return l===n.getCacheKey(c)})||(s.component.destroy(),o.delete(l))}),o},r.prototype.getCacheKey=function(e){return e},r}(Controller);function getGridThemeCfg(a,r){var e=deepMix({},get(a,["components","axis","common"]),get(a,["components","axis",r]));return get(e,["grid"],{})}function getLineGridItems(a,r,e,n){var o=[],s=r.getTicks();return a.isPolar&&s.push({value:1,text:"",tickValue:""}),s.reduce(function(l,c,u){var f=c.value;if(n)o.push({points:[a.convert(e==="y"?{x:0,y:f}:{x:f,y:0}),a.convert(e==="y"?{x:1,y:f}:{x:f,y:1})]});else if(u){var d=l.value,g=(d+f)/2;o.push({points:[a.convert(e==="y"?{x:0,y:g}:{x:g,y:0}),a.convert(e==="y"?{x:1,y:g}:{x:g,y:1})]})}return c},s[0]),o}function getCircleGridItems(a,r,e,n,o){var s=r.values.length,l=[],c=e.getTicks();return c.reduce(function(u,f){var d=u?u.value:f.value,g=f.value,p=(d+g)/2;return o==="x"?l.push({points:[a.convert({x:n?g:p,y:0}),a.convert({x:n?g:p,y:1})]}):l.push({points:map$2(Array(s+1),function(v,m){return a.convert({x:m/s,y:n?g:p})})}),f},c[0]),l}function showGrid(a,r){var e=get(r,"grid");if(e===null)return!1;var n=get(a,"grid");return!(e===void 0&&n===null)}var OMIT_CFG=["container"],AXIS_DEFAULT_ANIMATE_CFG=__assign$8(__assign$8({},DEFAULT_ANIMATE_CFG),{appear:null}),Axis=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;return n.cache=new Map,n.gridContainer=n.view.getLayer(LAYER.BG).addGroup(),n.gridForeContainer=n.view.getLayer(LAYER.FORE).addGroup(),n.axisContainer=n.view.getLayer(LAYER.BG).addGroup(),n.axisForeContainer=n.view.getLayer(LAYER.FORE).addGroup(),n}return Object.defineProperty(r.prototype,"name",{get:function(){return"axis"},enumerable:!1,configurable:!0}),r.prototype.init=function(){},r.prototype.render=function(){this.update()},r.prototype.layout=function(){var e=this,n=this.view.getCoordinate();each$1(this.getComponents(),function(o){var s=o.component,l=o.direction,c=o.type,u=o.extra,f=u.dim,d=u.scale,g=u.alignTick,p;if(c===COMPONENT_TYPE.AXIS)n.isPolar?f==="x"?p=n.isTransposed?getAxisRegion(n,l):getCircleAxisCenterRadius(n):f==="y"&&(p=n.isTransposed?getCircleAxisCenterRadius(n):getAxisRegion(n,l)):p=getAxisRegion(n,l);else if(c===COMPONENT_TYPE.GRID)if(n.isPolar){var v=void 0;n.isTransposed?v=f==="x"?getCircleGridItems(n,e.view.getYScales()[0],d,g,f):getLineGridItems(n,d,f,g):v=f==="x"?getLineGridItems(n,d,f,g):getCircleGridItems(n,e.view.getXScale(),d,g,f),p={items:v,center:e.view.getCoordinate().getCenter()}}else p={items:getLineGridItems(n,d,f,g)};s.update(p)})},r.prototype.update=function(){this.option=this.view.getOptions().axes;var e=new Map;this.updateXAxes(e),this.updateYAxes(e);var n=new Map;this.cache.forEach(function(o,s){e.has(s)?n.set(s,o):o.component.destroy()}),this.cache=n},r.prototype.clear=function(){a.prototype.clear.call(this),this.cache.clear(),this.gridContainer.clear(),this.gridForeContainer.clear(),this.axisContainer.clear(),this.axisForeContainer.clear()},r.prototype.destroy=function(){a.prototype.destroy.call(this),this.gridContainer.remove(!0),this.gridForeContainer.remove(!0),this.axisContainer.remove(!0),this.axisForeContainer.remove(!0)},r.prototype.getComponents=function(){var e=[];return this.cache.forEach(function(n){e.push(n)}),e},r.prototype.updateXAxes=function(e){var n=this.view.getXScale();if(!(!n||n.isIdentity)){var o=getAxisOption(this.option,n.field);if(o!==!1){var s=getAxisDirection(o,DIRECTION.BOTTOM),l=LAYER.BG,c="x",u=this.view.getCoordinate(),f=this.getId("axis",n.field),d=this.getId("grid",n.field);if(u.isRect){var g=this.cache.get(f);if(g){var p=this.getLineAxisCfg(n,o,s);omit(p,OMIT_CFG),g.component.update(p),e.set(f,g)}else g=this.createLineAxis(n,o,l,s,c),this.cache.set(f,g),e.set(f,g);var v=this.cache.get(d);if(v){var p=this.getLineGridCfg(n,o,s,c);omit(p,OMIT_CFG),v.component.update(p),e.set(d,v)}else v=this.createLineGrid(n,o,l,s,c),v&&(this.cache.set(d,v),e.set(d,v))}else if(u.isPolar){var g=this.cache.get(f);if(g){var p=u.isTransposed?this.getLineAxisCfg(n,o,DIRECTION.RADIUS):this.getCircleAxisCfg(n,o,s);omit(p,OMIT_CFG),g.component.update(p),e.set(f,g)}else{if(u.isTransposed){if(isUndefined$1(o))return;g=this.createLineAxis(n,o,l,DIRECTION.RADIUS,c)}else g=this.createCircleAxis(n,o,l,s,c);this.cache.set(f,g),e.set(f,g)}var v=this.cache.get(d);if(v){var p=u.isTransposed?this.getCircleGridCfg(n,o,DIRECTION.RADIUS,c):this.getLineGridCfg(n,o,DIRECTION.CIRCLE,c);omit(p,OMIT_CFG),v.component.update(p),e.set(d,v)}else{if(u.isTransposed){if(isUndefined$1(o))return;v=this.createCircleGrid(n,o,l,DIRECTION.RADIUS,c)}else v=this.createLineGrid(n,o,l,DIRECTION.CIRCLE,c);v&&(this.cache.set(d,v),e.set(d,v))}}}}},r.prototype.updateYAxes=function(e){var n=this,o=this.view.getYScales();each$1(o,function(s,l){if(!(!s||s.isIdentity)){var c=s.field,u=getAxisOption(n.option,c);if(u!==!1){var f=LAYER.BG,d="y",g=n.getId("axis",c),p=n.getId("grid",c),v=n.view.getCoordinate();if(v.isRect){var m=getAxisDirection(u,l===0?DIRECTION.LEFT:DIRECTION.RIGHT),y=n.cache.get(g);if(y){var x=n.getLineAxisCfg(s,u,m);omit(x,OMIT_CFG),y.component.update(x),e.set(g,y)}else y=n.createLineAxis(s,u,f,m,d),n.cache.set(g,y),e.set(g,y);var _=n.cache.get(p);if(_){var x=n.getLineGridCfg(s,u,m,d);omit(x,OMIT_CFG),_.component.update(x),e.set(p,_)}else _=n.createLineGrid(s,u,f,m,d),_&&(n.cache.set(p,_),e.set(p,_))}else if(v.isPolar){var y=n.cache.get(g);if(y){var x=v.isTransposed?n.getCircleAxisCfg(s,u,DIRECTION.CIRCLE):n.getLineAxisCfg(s,u,DIRECTION.RADIUS);omit(x,OMIT_CFG),y.component.update(x),e.set(g,y)}else{if(v.isTransposed){if(isUndefined$1(u))return;y=n.createCircleAxis(s,u,f,DIRECTION.CIRCLE,d)}else y=n.createLineAxis(s,u,f,DIRECTION.RADIUS,d);n.cache.set(g,y),e.set(g,y)}var _=n.cache.get(p);if(_){var x=v.isTransposed?n.getLineGridCfg(s,u,DIRECTION.CIRCLE,d):n.getCircleGridCfg(s,u,DIRECTION.RADIUS,d);omit(x,OMIT_CFG),_.component.update(x),e.set(p,_)}else{if(v.isTransposed){if(isUndefined$1(u))return;_=n.createLineGrid(s,u,f,DIRECTION.CIRCLE,d)}else _=n.createCircleGrid(s,u,f,DIRECTION.RADIUS,d);_&&(n.cache.set(p,_),e.set(p,_))}}}}})},r.prototype.createLineAxis=function(e,n,o,s,l){var c={component:new LineAxis(this.getLineAxisCfg(e,n,s)),layer:o,direction:s===DIRECTION.RADIUS?DIRECTION.NONE:s,type:COMPONENT_TYPE.AXIS,extra:{dim:l,scale:e}};return c.component.set("field",e.field),c.component.init(),c},r.prototype.createLineGrid=function(e,n,o,s,l){var c=this.getLineGridCfg(e,n,s,l);if(c){var u={component:new LineGrid(c),layer:o,direction:DIRECTION.NONE,type:COMPONENT_TYPE.GRID,extra:{dim:l,scale:e,alignTick:get(c,"alignTick",!0)}};return u.component.init(),u}},r.prototype.createCircleAxis=function(e,n,o,s,l){var c={component:new CircleAxis(this.getCircleAxisCfg(e,n,s)),layer:o,direction:s,type:COMPONENT_TYPE.AXIS,extra:{dim:l,scale:e}};return c.component.set("field",e.field),c.component.init(),c},r.prototype.createCircleGrid=function(e,n,o,s,l){var c=this.getCircleGridCfg(e,n,s,l);if(c){var u={component:new CircleGrid(c),layer:o,direction:DIRECTION.NONE,type:COMPONENT_TYPE.GRID,extra:{dim:l,scale:e,alignTick:get(c,"alignTick",!0)}};return u.component.init(),u}},r.prototype.getLineAxisCfg=function(e,n,o){var s=get(n,["top"])?this.axisForeContainer:this.axisContainer,l=this.view.getCoordinate(),c=getAxisRegion(l,o),u=getAxisTitleText(e,n),f=getAxisThemeCfg(this.view.getTheme(),o),d=get(n,["title"])?deepMix({title:{style:{text:u}}},{title:getAxisTitleOptions(this.view.getTheme(),o,n.title)},n):n,g=deepMix(__assign$8(__assign$8({container:s},c),{ticks:e.getTicks().map(function(S){return{id:"".concat(S.tickValue),name:S.text,value:S.value}}),verticalFactor:l.isPolar?getAxisFactorByRegion(c,l.getCenter())*-1:getAxisFactorByRegion(c,l.getCenter()),theme:f}),f,d),p=this.getAnimateCfg(g),v=p.animate,m=p.animateOption;g.animateOption=m,g.animate=v;var y=isVertical(c),x=get(g,"verticalLimitLength",y?1/3:1/2);if(x<=1){var _=this.view.getCanvas().get("width"),E=this.view.getCanvas().get("height");g.verticalLimitLength=x*(y?_:E)}return g},r.prototype.getLineGridCfg=function(e,n,o,s){if(showGrid(getAxisThemeCfg(this.view.getTheme(),o),n)){var l=getGridThemeCfg(this.view.getTheme(),o),c=deepMix({container:get(n,["top"])?this.gridForeContainer:this.gridContainer},l,get(n,"grid"),this.getAnimateCfg(n));return c.items=getLineGridItems(this.view.getCoordinate(),e,s,get(c,"alignTick",!0)),c}},r.prototype.getCircleAxisCfg=function(e,n,o){var s=get(n,["top"])?this.axisForeContainer:this.axisContainer,l=this.view.getCoordinate(),c=e.getTicks().map(function(y){return{id:"".concat(y.tickValue),name:y.text,value:y.value}});!e.isCategory&&Math.abs(l.endAngle-l.startAngle)===Math.PI*2&&c.length&&(c[c.length-1].name="");var u=getAxisTitleText(e,n),f=getAxisThemeCfg(this.view.getTheme(),DIRECTION.CIRCLE),d=get(n,["title"])?deepMix({title:{style:{text:u}}},{title:getAxisTitleOptions(this.view.getTheme(),o,n.title)},n):n,g=deepMix(__assign$8(__assign$8({container:s},getCircleAxisCenterRadius(this.view.getCoordinate())),{ticks:c,verticalFactor:1,theme:f}),f,d),p=this.getAnimateCfg(g),v=p.animate,m=p.animateOption;return g.animate=v,g.animateOption=m,g},r.prototype.getCircleGridCfg=function(e,n,o,s){if(showGrid(getAxisThemeCfg(this.view.getTheme(),o),n)){var l=getGridThemeCfg(this.view.getTheme(),DIRECTION.RADIUS),c=deepMix({container:get(n,["top"])?this.gridForeContainer:this.gridContainer,center:this.view.getCoordinate().getCenter()},l,get(n,"grid"),this.getAnimateCfg(n)),u=get(c,"alignTick",!0),f=s==="x"?this.view.getYScales()[0]:this.view.getXScale();return c.items=getCircleGridItems(this.view.getCoordinate(),f,e,u,s),c}},r.prototype.getId=function(e,n){var o=this.view.getCoordinate();return"".concat(e,"-").concat(n,"-").concat(o.type)},r.prototype.getAnimateCfg=function(e){return{animate:this.view.getOptions().animate&&get(e,"animate"),animateOption:e&&e.animateOption?deepMix({},AXIS_DEFAULT_ANIMATE_CFG,e.animateOption):AXIS_DEFAULT_ANIMATE_CFG}},r}(Controller);function directionToPosition(a,r,e){return e===DIRECTION.TOP?[a.minX+a.width/2-r.width/2,a.minY]:e===DIRECTION.BOTTOM?[a.minX+a.width/2-r.width/2,a.maxY-r.height]:e===DIRECTION.LEFT?[a.minX,a.minY+a.height/2-r.height/2]:e===DIRECTION.RIGHT?[a.maxX-r.width,a.minY+a.height/2-r.height/2]:e===DIRECTION.TOP_LEFT||e===DIRECTION.LEFT_TOP?[a.tl.x,a.tl.y]:e===DIRECTION.TOP_RIGHT||e===DIRECTION.RIGHT_TOP?[a.tr.x-r.width,a.tr.y]:e===DIRECTION.BOTTOM_LEFT||e===DIRECTION.LEFT_BOTTOM?[a.bl.x,a.bl.y-r.height]:e===DIRECTION.BOTTOM_RIGHT||e===DIRECTION.RIGHT_BOTTOM?[a.br.x-r.width,a.br.y-r.height]:[0,0]}function getLegendOption(a,r){return isBoolean(a)?a===!1?!1:{}:get(a,[r],a)}function getDirection(a){return get(a,"position",DIRECTION.BOTTOM)}var Legend=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;return n.container=n.view.getLayer(LAYER.FORE).addGroup(),n}return Object.defineProperty(r.prototype,"name",{get:function(){return"legend"},enumerable:!1,configurable:!0}),r.prototype.init=function(){},r.prototype.render=function(){this.update()},r.prototype.layout=function(){var e=this;this.layoutBBox=this.view.viewBBox,each$1(this.components,function(n){var o=n.component,s=n.direction,l=getLegendLayout(s),c=o.get("maxWidthRatio"),u=o.get("maxHeightRatio"),f=e.getCategoryLegendSizeCfg(l,c,u),d=o.get("maxWidth"),g=o.get("maxHeight");o.update({maxWidth:Math.min(f.maxWidth,d||0),maxHeight:Math.min(f.maxHeight,g||0)});var p=o.get("padding"),v=o.getLayoutBBox(),m=new BBox(v.x,v.y,v.width,v.height).expand(p),y=__read(directionToPosition(e.view.viewBBox,m,s),2),x=y[0],_=y[1],E=__read(directionToPosition(e.layoutBBox,m,s),2),S=E[0],A=E[1],T=0,b=0;s.startsWith("top")||s.startsWith("bottom")?(T=x,b=A):(T=S,b=_),o.setLocation({x:T+p[3],y:b+p[0]}),e.layoutBBox=e.layoutBBox.cut(m,s)})},r.prototype.update=function(){var e=this;this.option=this.view.getOptions().legends;var n={},o=function(p,v,m){var y=e.getId(m.field),x=e.getComponentById(y);if(x){var _=void 0,E=getLegendOption(e.option,m.field);E!==!1&&(get(E,"custom")?_=e.getCategoryCfg(p,v,m,E,!0):m.isLinear?_=e.getContinuousCfg(p,v,m,E):m.isCategory&&(_=e.getCategoryCfg(p,v,m,E))),_&&(omit(_,["container"]),x.direction=getDirection(E),x.component.update(_),n[y]=!0)}else{var S=e.createFieldLegend(p,v,m);S&&(S.component.init(),e.components.push(S),n[y]=!0)}};if(get(this.option,"custom")){var s="global-custom",l=this.getComponentById(s);if(l){var c=this.getCategoryCfg(void 0,void 0,void 0,this.option,!0);omit(c,["container"]),l.component.update(c),n[s]=!0}else{var u=this.createCustomLegend(void 0,void 0,void 0,this.option);if(u){u.init();var f=LAYER.FORE,d=getDirection(this.option);this.components.push({id:s,component:u,layer:f,direction:d,type:COMPONENT_TYPE.LEGEND,extra:void 0}),n[s]=!0}}}else this.loopLegends(o);var g=[];each$1(this.getComponents(),function(p){n[p.id]?g.push(p):p.component.destroy()}),this.components=g},r.prototype.clear=function(){a.prototype.clear.call(this),this.container.clear()},r.prototype.destroy=function(){a.prototype.destroy.call(this),this.container.remove(!0)},r.prototype.getGeometries=function(e){var n=this,o=e.geometries;return each$1(e.views,function(s){o=o.concat(n.getGeometries(s))}),o},r.prototype.loopLegends=function(e){var n=this.view.getRootView()===this.view;if(n){var o=this.getGeometries(this.view),s={};each$1(o,function(l){var c=l.getGroupAttributes();each$1(c,function(u){var f=u.getScale(u.type);!f||f.type==="identity"||s[f.field]||(e(l,u,f),s[f.field]=!0)})})}},r.prototype.createFieldLegend=function(e,n,o){var s,l=getLegendOption(this.option,o.field),c=LAYER.FORE,u=getDirection(l);if(l!==!1&&(get(l,"custom")?s=this.createCustomLegend(e,n,o,l):o.isLinear?s=this.createContinuousLegend(e,n,o,l):o.isCategory&&(s=this.createCategoryLegend(e,n,o,l))),s)return s.set("field",o.field),{id:this.getId(o.field),component:s,layer:c,direction:u,type:COMPONENT_TYPE.LEGEND,extra:{scale:o}}},r.prototype.createCustomLegend=function(e,n,o,s){var l=this.getCategoryCfg(e,n,o,s,!0);return new CategoryLegend(l)},r.prototype.createContinuousLegend=function(e,n,o,s){var l=this.getContinuousCfg(e,n,o,omit(s,["value"]));return new ContinuousLegend(l)},r.prototype.createCategoryLegend=function(e,n,o,s){var l=this.getCategoryCfg(e,n,o,s);return new CategoryLegend(l)},r.prototype.getContinuousCfg=function(e,n,o,s){var l=o.getTicks(),c=find$2(l,function(y){return y.value===0}),u=find$2(l,function(y){return y.value===1}),f=l.map(function(y){var x=y.value,_=y.tickValue,E=n.mapping(o.invert(x)).join("");return{value:_,attrValue:E,color:E,scaleValue:x}});c||f.push({value:o.min,attrValue:n.mapping(o.invert(0)).join(""),color:n.mapping(o.invert(0)).join(""),scaleValue:0}),u||f.push({value:o.max,attrValue:n.mapping(o.invert(1)).join(""),color:n.mapping(o.invert(1)).join(""),scaleValue:1}),f.sort(function(y,x){return y.value-x.value});var d={min:head(f).value,max:last(f).value,colors:[],rail:{type:n.type},track:{}};n.type==="size"&&(d.track={style:{fill:n.type==="size"?this.view.getTheme().defaultColor:void 0}}),n.type==="color"&&(d.colors=f.map(function(y){return y.attrValue}));var g=this.container,p=getDirection(s),v=getLegendLayout(p),m=get(s,"title");return m&&(m=deepMix({text:getName(o)},m)),d.container=g,d.layout=v,d.title=m,d.animateOption=DEFAULT_ANIMATE_CFG,this.mergeLegendCfg(d,s,"continuous")},r.prototype.getCategoryCfg=function(e,n,o,s,l){var c=this.container,u=get(s,"position",DIRECTION.BOTTOM),f=getLegendThemeCfg(this.view.getTheme(),u),d=get(f,["marker"]),g=get(s,"marker"),p=getLegendLayout(u),v=get(f,["pageNavigator"]),m=get(s,"pageNavigator"),y=l?getCustomLegendItems(d,g,s.items):getLegendItems(this.view,e,n,d,g),x=get(s,"title");x&&(x=deepMix({text:o?getName(o):""},x));var _=get(s,"maxWidthRatio"),E=get(s,"maxHeightRatio"),S=this.getCategoryLegendSizeCfg(p,_,E);S.container=c,S.layout=p,S.items=y,S.title=x,S.animateOption=DEFAULT_ANIMATE_CFG,S.pageNavigator=deepMix({},v,m);var A=this.mergeLegendCfg(S,s,u);A.reversed&&A.items.reverse();var T=get(A,"maxItemWidth");return T&&T<=1&&(A.maxItemWidth=this.view.viewBBox.width*T),A},r.prototype.mergeLegendCfg=function(e,n,o){var s=o.split("-")[0],l=getLegendThemeCfg(this.view.getTheme(),s);return deepMix({},l,e,n)},r.prototype.getId=function(e){return"".concat(this.name,"-").concat(e)},r.prototype.getComponentById=function(e){return find$2(this.components,function(n){return n.id===e})},r.prototype.getCategoryLegendSizeCfg=function(e,n,o){n===void 0&&(n=COMPONENT_MAX_VIEW_PERCENTAGE),o===void 0&&(o=COMPONENT_MAX_VIEW_PERCENTAGE);var s=this.view.viewBBox,l=s.width,c=s.height;return e==="vertical"?{maxWidth:l*n,maxHeight:c}:{maxWidth:l,maxHeight:c*o}},r}(Controller),Slider$1=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;return n.onChangeFn=noop$1,n.resetMeasure=function(){n.clear()},n.onValueChange=function(o){var s=__read(o,2),l=s[0],c=s[1];n.start=l,n.end=c,n.changeViewData(l,c)},n.container=n.view.getLayer(LAYER.FORE).addGroup(),n.onChangeFn=throttle$1(n.onValueChange,20,{leading:!0}),n.width=0,n.view.on(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,n.resetMeasure),n.view.on(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_SIZE,n.resetMeasure),n}return Object.defineProperty(r.prototype,"name",{get:function(){return"slider"},enumerable:!1,configurable:!0}),r.prototype.destroy=function(){a.prototype.destroy.call(this),this.view.off(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,this.resetMeasure),this.view.off(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_SIZE,this.resetMeasure)},r.prototype.init=function(){},r.prototype.render=function(){this.option=this.view.getOptions().slider;var e=this.getSliderCfg(),n=e.start,o=e.end;isNil(this.start)&&(this.start=n,this.end=o);var s=this.view.getOptions().data;this.option&&!isEmpty(s)?this.slider?this.slider=this.updateSlider():(this.slider=this.createSlider(),this.slider.component.on("sliderchange",this.onChangeFn)):this.slider&&(this.slider.component.destroy(),this.slider=void 0)},r.prototype.layout=function(){var e=this;if(this.option&&!this.width&&(this.measureSlider(),setTimeout(function(){e.view.destroyed||e.changeViewData(e.start,e.end)},0)),this.slider){var n=this.view.coordinateBBox.width,o=this.slider.component.get("padding"),s=__read(o,4),l=s[0];s[1],s[2];var c=s[3],u=this.slider.component.getLayoutBBox(),f=new BBox(u.x,u.y,Math.min(u.width,n),u.height).expand(o),d=this.getMinMaxText(this.start,this.end),g=d.minText,p=d.maxText,v=__read(directionToPosition(this.view.viewBBox,f,DIRECTION.BOTTOM),2);v[0];var m=v[1],y=__read(directionToPosition(this.view.coordinateBBox,f,DIRECTION.BOTTOM),2),x=y[0];y[1],this.slider.component.update(__assign$8(__assign$8({},this.getSliderCfg()),{x:x+c,y:m+l,width:this.width,start:this.start,end:this.end,minText:g,maxText:p})),this.view.viewBBox=this.view.viewBBox.cut(f,DIRECTION.BOTTOM)}},r.prototype.update=function(){this.render()},r.prototype.createSlider=function(){var e=this.getSliderCfg(),n=new Slider$2(__assign$8({container:this.container},e));return n.init(),{component:n,layer:LAYER.FORE,direction:DIRECTION.BOTTOM,type:COMPONENT_TYPE.SLIDER}},r.prototype.updateSlider=function(){var e=this.getSliderCfg();if(this.width){var n=this.getMinMaxText(this.start,this.end),o=n.minText,s=n.maxText;e=__assign$8(__assign$8({},e),{width:this.width,start:this.start,end:this.end,minText:o,maxText:s})}return this.slider.component.update(e),this.slider},r.prototype.measureSlider=function(){var e=this.getSliderCfg().width;this.width=e},r.prototype.getSliderCfg=function(){var e={height:16,start:0,end:1,minText:"",maxText:"",x:0,y:0,width:this.view.coordinateBBox.width};if(isObject$1(this.option)){var n=__assign$8({data:this.getData()},get(this.option,"trendCfg",{}));e=deepMix({},e,this.getThemeOptions(),this.option),e=__assign$8(__assign$8({},e),{trendCfg:n})}return e.start=clamp(Math.min(isNil(e.start)?0:e.start,isNil(e.end)?1:e.end),0,1),e.end=clamp(Math.max(isNil(e.start)?0:e.start,isNil(e.end)?1:e.end),0,1),e},r.prototype.getData=function(){var e=this.view.getOptions().data,n=__read(this.view.getYScales(),1),o=n[0],s=this.view.getGroupScales();if(s.length){var l=s[0],c=l.field,u=l.ticks;return e.reduce(function(f,d){return d[c]===u[0]&&f.push(d[o.field]),f},[])}return e.map(function(f){return f[o.field]||0})},r.prototype.getThemeOptions=function(){var e=this.view.getTheme();return get(e,["components","slider","common"],{})},r.prototype.getMinMaxText=function(e,n){var o=this.view.getOptions().data,s=this.view.getXScale(),l=valuesOfKey(o,s.field);s.isLinear&&(l=l.sort());var c=l,u=size(o);if(!s||!u)return{};var f=size(c),d=Math.round(e*(f-1)),g=Math.round(n*(f-1)),p=get(c,[d]),v=get(c,[g]),m=this.getSliderCfg().formatter;return m&&(p=m(p,o[d],d),v=m(v,o[g],g)),{minText:p,maxText:v}},r.prototype.changeViewData=function(e,n){var o=this.view.getOptions().data,s=this.view.getXScale(),l=size(o);if(!(!s||!l)){var c=valuesOfKey(o,s.field),u=this.view.getXScale().isLinear?c.sort(function(v,m){return Number(v)-Number(m)}):c,f=u,d=size(f),g=Math.round(e*(d-1)),p=Math.round(n*(d-1));this.view.filter(s.field,function(v,m){var y=f.indexOf(v);return y>-1?isBetween$1(y,g,p):!0}),this.view.render(!0)}},r.prototype.getComponents=function(){return this.slider?[this.slider]:[]},r.prototype.clear=function(){this.slider&&(this.slider.component.destroy(),this.slider=void 0),this.width=0,this.start=void 0,this.end=void 0},r}(Controller),DEFAULT_PADDING=0,DEFAULT_SIZE=8,DEFAULT_CATEGORY_SIZE=32,MIN_THUMB_LENGTH=20,Scrollbar=function(a){__extends$7(r,a);function r(e){var n=a.call(this,e)||this;return n.onChangeFn=noop$1,n.resetMeasure=function(){n.clear()},n.onValueChange=function(o){var s=o.ratio,l=n.getValidScrollbarCfg().animate;n.ratio=clamp(s,0,1);var c=n.view.getOptions().animate;l||n.view.animate(!1),n.changeViewData(n.getScrollRange(),!0),n.view.animate(c)},n.container=n.view.getLayer(LAYER.FORE).addGroup(),n.onChangeFn=throttle$1(n.onValueChange,20,{leading:!0}),n.trackLen=0,n.thumbLen=0,n.ratio=0,n.view.on(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,n.resetMeasure),n.view.on(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_SIZE,n.resetMeasure),n}return Object.defineProperty(r.prototype,"name",{get:function(){return"scrollbar"},enumerable:!1,configurable:!0}),r.prototype.destroy=function(){a.prototype.destroy.call(this),this.view.off(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,this.resetMeasure),this.view.off(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_SIZE,this.resetMeasure)},r.prototype.init=function(){},r.prototype.render=function(){this.option=this.view.getOptions().scrollbar,this.option?this.scrollbar?this.scrollbar=this.updateScrollbar():(this.scrollbar=this.createScrollbar(),this.scrollbar.component.on("scrollchange",this.onChangeFn)):this.scrollbar&&(this.scrollbar.component.destroy(),this.scrollbar=void 0)},r.prototype.layout=function(){var e=this;if(this.option&&!this.trackLen&&(this.measureScrollbar(),setTimeout(function(){e.view.destroyed||e.changeViewData(e.getScrollRange(),!0)})),this.scrollbar){var n=this.view.coordinateBBox.width,o=this.scrollbar.component.get("padding"),s=this.scrollbar.component.getLayoutBBox(),l=new BBox(s.x,s.y,Math.min(s.width,n),s.height).expand(o),c=this.getScrollbarComponentCfg(),u=void 0,f=void 0;if(c.isHorizontal){var d=__read(directionToPosition(this.view.viewBBox,l,DIRECTION.BOTTOM),2);d[0];var g=d[1],p=__read(directionToPosition(this.view.coordinateBBox,l,DIRECTION.BOTTOM),2),v=p[0];p[1],u=v,f=g}else{var m=__read(directionToPosition(this.view.viewBBox,l,DIRECTION.RIGHT),2);m[0];var g=m[1],y=__read(directionToPosition(this.view.viewBBox,l,DIRECTION.RIGHT),2),v=y[0];y[1],u=v,f=g}u+=o[3],f+=o[0],this.trackLen?this.scrollbar.component.update(__assign$8(__assign$8({},c),{x:u,y:f,trackLen:this.trackLen,thumbLen:this.thumbLen,thumbOffset:(this.trackLen-this.thumbLen)*this.ratio})):this.scrollbar.component.update(__assign$8(__assign$8({},c),{x:u,y:f})),this.view.viewBBox=this.view.viewBBox.cut(l,c.isHorizontal?DIRECTION.BOTTOM:DIRECTION.RIGHT)}},r.prototype.update=function(){this.render()},r.prototype.getComponents=function(){return this.scrollbar?[this.scrollbar]:[]},r.prototype.clear=function(){this.scrollbar&&(this.scrollbar.component.destroy(),this.scrollbar=void 0),this.trackLen=0,this.thumbLen=0,this.ratio=0,this.cnt=0,this.step=0,this.data=void 0,this.xScaleCfg=void 0,this.yScalesCfg=[]},r.prototype.setValue=function(e){this.onValueChange({ratio:e})},r.prototype.getValue=function(){return this.ratio},r.prototype.getThemeOptions=function(){var e=this.view.getTheme();return get(e,["components","scrollbar","common"],{})},r.prototype.getScrollbarTheme=function(e){var n=get(this.view.getTheme(),["components","scrollbar"]),o=e||{},s=o.thumbHighlightColor,l=__rest$1(o,["thumbHighlightColor"]);return{default:deepMix({},get(n,["default","style"],{}),l),hover:deepMix({},get(n,["hover","style"],{}),{thumbColor:s})}},r.prototype.measureScrollbar=function(){var e=this.view.getXScale(),n=this.view.getYScales().slice();this.data=this.getScrollbarData(),this.step=this.getStep(),this.cnt=this.getCnt();var o=this.getScrollbarComponentCfg(),s=o.trackLen,l=o.thumbLen;this.trackLen=s,this.thumbLen=l,this.xScaleCfg={field:e.field,values:e.values||[]},this.yScalesCfg=n},r.prototype.getScrollRange=function(){var e=Math.floor((this.cnt-this.step)*clamp(this.ratio,0,1)),n=Math.min(e+this.step-1,this.cnt-1);return[e,n]},r.prototype.changeViewData=function(e,n){var o=this,s=__read(e,2),l=s[0],c=s[1],u=this.getValidScrollbarCfg().type,f=u!=="vertical",d=valuesOfKey(this.data,this.xScaleCfg.field),g=this.view.getXScale().isLinear?d.sort(function(v,m){return Number(v)-Number(m)}):d,p=f?g:g.reverse();this.yScalesCfg.forEach(function(v){o.view.scale(v.field,{formatter:v.formatter,type:v.type,min:v.min,max:v.max,tickMethod:v.tickMethod})}),this.view.filter(this.xScaleCfg.field,function(v){var m=p.indexOf(v);return m>-1?isBetween$1(m,l,c):!0}),this.view.render(!0)},r.prototype.createScrollbar=function(){var e=this.getValidScrollbarCfg().type,n=e!=="vertical",o=new Scrollbar$1(__assign$8(__assign$8({container:this.container},this.getScrollbarComponentCfg()),{x:0,y:0}));return o.init(),{component:o,layer:LAYER.FORE,direction:n?DIRECTION.BOTTOM:DIRECTION.RIGHT,type:COMPONENT_TYPE.SCROLLBAR}},r.prototype.updateScrollbar=function(){var e=this.getScrollbarComponentCfg(),n=this.trackLen?__assign$8(__assign$8({},e),{trackLen:this.trackLen,thumbLen:this.thumbLen,thumbOffset:(this.trackLen-this.thumbLen)*this.ratio}):__assign$8({},e);return this.scrollbar.component.update(n),this.scrollbar},r.prototype.getStep=function(){if(this.step)return this.step;var e=this.view.coordinateBBox,n=this.getValidScrollbarCfg(),o=n.type,s=n.categorySize,l=o!=="vertical";return Math.floor((l?e.width:e.height)/s)},r.prototype.getCnt=function(){if(this.cnt)return this.cnt;var e=this.view.getXScale(),n=this.getScrollbarData(),o=valuesOfKey(n,e.field);return size(o)},r.prototype.getScrollbarComponentCfg=function(){var e=this.view,n=e.coordinateBBox,o=e.viewBBox,s=this.getValidScrollbarCfg(),l=s.type,c=s.padding,u=s.width,f=s.height,d=s.style,g=l!=="vertical",p=__read(c,4),v=p[0],m=p[1],y=p[2],x=p[3],_=g?{x:n.minX+x,y:o.maxY-f-y}:{x:o.maxX-u-m,y:n.minY+v},E=this.getStep(),S=this.getCnt(),A=g?n.width-x-m:n.height-v-y,T=Math.max(A*clamp(E/S,0,1),MIN_THUMB_LENGTH);return __assign$8(__assign$8({},this.getThemeOptions()),{x:_.x,y:_.y,size:g?f:u,isHorizontal:g,trackLen:A,thumbLen:T,thumbOffset:0,theme:this.getScrollbarTheme(d)})},r.prototype.getValidScrollbarCfg=function(){var e={type:"horizontal",categorySize:DEFAULT_CATEGORY_SIZE,width:DEFAULT_SIZE,height:DEFAULT_SIZE,padding:[0,0,0,0],animate:!0,style:{}};return isObject$1(this.option)&&(e=__assign$8(__assign$8({},e),this.option)),(!isObject$1(this.option)||!this.option.padding)&&(e.padding=e.type==="horizontal"?[DEFAULT_PADDING,0,DEFAULT_PADDING,0]:[0,DEFAULT_PADDING,0,DEFAULT_PADDING]),e},r.prototype.getScrollbarData=function(){var e=this.view.getCoordinate(),n=this.getValidScrollbarCfg(),o=this.view.getOptions().data||[];return e.isReflect("y")&&n.type==="vertical"&&(o=__spreadArray$2([],__read(o),!1).reverse()),o},r}(Controller),DEFAULT_REGION_PATH_STYLE={fill:"#CCD6EC",opacity:.3};function getItemsOfView(a,r,e){var n,o,s,l,c,u,f=findItemsFromViewRecurisive(a,r,e);if(f.length){f=flatten(f);try{for(var d=__values(f),g=d.next();!g.done;g=d.next()){var p=g.value;try{for(var v=(s=void 0,__values(p)),m=v.next();!m.done;m=v.next()){var y=m.value,x=y.mappingData,_=x.x,E=x.y;y.x=isArray$4(_)?_[_.length-1]:_,y.y=isArray$4(E)?E[E.length-1]:E}}catch(I){s={error:I}}finally{try{m&&!m.done&&(l=v.return)&&l.call(v)}finally{if(s)throw s.error}}}}catch(I){n={error:I}}finally{try{g&&!g.done&&(o=d.return)&&o.call(d)}finally{if(n)throw n.error}}var S=e.shared;if(S===!1&&f.length>1){var A=f[0],T=Math.abs(r.y-A[0].y);try{for(var b=__values(f),C=b.next();!C.done;C=b.next()){var L=C.value,R=Math.abs(r.y-L[0].y);R<=T&&(A=L,T=R)}}catch(I){c={error:I}}finally{try{C&&!C.done&&(u=b.return)&&u.call(b)}finally{if(c)throw c.error}}f=[A]}return uniq$2(flatten(f))}return[]}var ActiveRegion=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.show=function(e){var n=this.context.view,o=this.context.event,s=n.getController("tooltip").getTooltipCfg(),l=getItemsOfView(n,{x:o.x,y:o.y},s);if(!isEqual$1(l,this.items)&&(this.items=l,l.length)){var c=n.getXScale().field,u=l[0].data[c],f=[],d=n.geometries;if(each$1(d,function(V){if(V.type==="interval"||V.type==="schema"){var N=V.getElementsBy(function(B){var G=B.getData();return G[c]===u});f=f.concat(N)}}),f.length){var g=n.getCoordinate(),p=f[0].shape.getCanvasBBox(),v=f[0].shape.getCanvasBBox(),m=p;each$1(f,function(V){var N=V.shape.getCanvasBBox();g.isTransposed?(N.minY<p.minY&&(p=N),N.maxY>v.maxY&&(v=N)):(N.minX<p.minX&&(p=N),N.maxX>v.maxX&&(v=N)),m.x=Math.min(N.minX,m.minX),m.y=Math.min(N.minY,m.minY),m.width=Math.max(N.maxX,m.maxX)-m.x,m.height=Math.max(N.maxY,m.maxY)-m.y});var y=n.backgroundGroup,x=n.coordinateBBox,_=void 0;if(g.isRect){var E=n.getXScale(),S=e||{},A=S.appendRatio,T=S.appendWidth;isNil(T)&&(A=isNil(A)?E.isLinear?0:.25:A,T=g.isTransposed?A*v.height:A*p.width);var b=void 0,C=void 0,L=void 0,R=void 0;g.isTransposed?(b=x.minX,C=Math.min(v.minY,p.minY)-T,L=x.width,R=m.height+T*2):(b=Math.min(p.minX,v.minX)-T,C=x.minY,L=m.width+T*2,R=x.height),_=[["M",b,C],["L",b+L,C],["L",b+L,C+R],["L",b,C+R],["Z"]]}else{var I=head(f),w=last(f),M=getAngle$1(I.getModel(),g).startAngle,D=getAngle$1(w.getModel(),g).endAngle,O=g.getCenter(),F=g.getRadius(),k=g.innerRadius*F;_=getSectorPath(O.x,O.y,F,M,D,k)}if(this.regionPath)this.regionPath.attr("path",_),this.regionPath.show();else{var $=get(e,"style",DEFAULT_REGION_PATH_STYLE);this.regionPath=y.addShape({type:"path",name:"active-region",capture:!1,attrs:__assign$8(__assign$8({},$),{path:_})})}}}},r.prototype.hide=function(){this.regionPath&&this.regionPath.hide(),this.items=null},r.prototype.destroy=function(){this.hide(),this.regionPath&&this.regionPath.remove(!0),a.prototype.destroy.call(this)},r}(Action),TooltipAction=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.timeStamp=0,e}return r.prototype.show=function(){var e=this.context,n=e.event,o=e.view,s=o.isTooltipLocked();if(!s){var l=this.timeStamp,c=+new Date,u=get(e.view.getOptions(),"tooltip.showDelay",16);if(c-l>u){var f=this.location,d={x:n.x,y:n.y};(!f||!isEqual$1(f,d))&&this.showTooltip(o,d),this.timeStamp=c,this.location=d}}},r.prototype.hide=function(){var e=this.context.view,n=e.getController("tooltip"),o=this.context.event,s=o.clientX,l=o.clientY;n.isCursorEntered({x:s,y:l})||e.isTooltipLocked()||(this.hideTooltip(e),this.location=null)},r.prototype.showTooltip=function(e,n){e.showTooltip(n)},r.prototype.hideTooltip=function(e){e.hideTooltip()},r}(Action),SiblingTooltip=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.showTooltip=function(e,n){var o=getSilbings(e);each$1(o,function(s){var l=getSiblingPoint(e,s,n);s.showTooltip(l)})},r.prototype.hideTooltip=function(e){var n=getSilbings(e);each$1(n,function(o){o.hideTooltip()})},r}(TooltipAction),EllipsisText=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.timeStamp=0,e}return r.prototype.destroy=function(){a.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},r.prototype.show=function(){var e=this.context,n=e.event,o=this.timeStamp,s=+new Date;if(s-o>16){var l=this.location,c={x:n.x,y:n.y};(!l||!isEqual$1(l,c))&&this.showTooltip(c),this.timeStamp=s,this.location=c}},r.prototype.hide=function(){this.hideTooltip(),this.location=null},r.prototype.showTooltip=function(e){var n=this.context,o=n.event,s=o.target;if(s&&s.get("tip")){this.tooltip||this.renderTooltip();var l=s.get("tip");this.tooltip.update(__assign$8({title:l},e)),this.tooltip.show()}},r.prototype.hideTooltip=function(){this.tooltip&&this.tooltip.hide()},r.prototype.renderTooltip=function(){var e,n=this.context.view,o=n.canvas,s={start:{x:0,y:0},end:{x:o.get("width"),y:o.get("height")}},l=n.getTheme(),c=get(l,["components","tooltip","domStyles"],{}),u=new HtmlTooltip({parent:o.get("el").parentNode,region:s,visible:!1,crosshairs:null,domStyles:__assign$8({},deepMix({},c,(e={},e[CONTAINER_CLASS]={"max-width":"50%"},e[TITLE_CLASS]={"word-break":"break-all"},e)))});u.init(),u.setCapture(!1),this.tooltip=u},r}(Action),StateBase=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName="",e}return r.prototype.hasState=function(e){return e.hasState(this.stateName)},r.prototype.setElementState=function(e,n){e.setState(this.stateName,n)},r.prototype.setState=function(){this.setStateEnable(!0)},r.prototype.clear=function(){var e=this.context.view;this.clearViewState(e)},r.prototype.clearViewState=function(e){var n=this,o=getElementsByState(e,this.stateName);each$1(o,function(s){n.setElementState(s,!1)})},r}(Action);function getItem(a){return get(a.get("delegateObject"),"item")}var ElementState=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.ignoreListItemStates=["unchecked"],e}return r.prototype.isItemIgnore=function(e,n){var o=this.ignoreListItemStates,s=o.filter(function(l){return n.hasState(e,l)});return!!s.length},r.prototype.setStateByComponent=function(e,n,o){var s=this.context.view,l=e.get("field"),c=getElements(s);this.setElementsStateByItem(c,l,n,o)},r.prototype.setStateByElement=function(e,n){this.setElementState(e,n)},r.prototype.isMathItem=function(e,n,o){var s=this.context.view,l=getScaleByField(s,n),c=getElementValue$1(e,n);return!isNil(c)&&o.name===l.getText(c)},r.prototype.setElementsStateByItem=function(e,n,o,s){var l=this;each$1(e,function(c){l.isMathItem(c,n,o)&&c.setState(l.stateName,s)})},r.prototype.setStateEnable=function(e){var n=getCurrentElement$1(this.context);if(n)isElementChange(this.context)&&this.setStateByElement(n,e);else{var o=getDelegationObject(this.context);if(isList(o)){var s=o.item,l=o.component;if(s&&l&&!this.isItemIgnore(s,l)){var c=this.context.event.gEvent;if(c&&c.fromShape&&c.toShape&&getItem(c.fromShape)===getItem(c.toShape))return;this.setStateByComponent(l,s,e)}}}},r.prototype.toggle=function(){var e=getCurrentElement$1(this.context);if(e){var n=e.hasState(this.stateName);this.setElementState(e,!n)}},r.prototype.reset=function(){this.setStateEnable(!1)},r}(StateBase),ElementActive=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName="active",e}return r.prototype.active=function(){this.setState()},r}(ElementState),LinkByColor=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.cache={},e}return r.prototype.getColorScale=function(e,n){var o=n.geometry.getAttribute("color");if(!o)return null;var s=e.getScaleByField(o.getFields()[0]);return s},r.prototype.getLinkPath=function(e,n){var o=this.context.view,s=o.getCoordinate().isTransposed,l=e.shape.getCanvasBBox(),c=n.shape.getCanvasBBox(),u=s?[["M",l.minX,l.minY],["L",c.minX,c.maxY],["L",c.maxX,c.maxY],["L",l.maxX,l.minY],["Z"]]:[["M",l.maxX,l.minY],["L",c.minX,c.minY],["L",c.minX,c.maxY],["L",l.maxX,l.maxY],["Z"]];return u},r.prototype.addLinkShape=function(e,n,o,s){var l={opacity:.4,fill:n.shape.attr("fill")};e.addShape({type:"path",attrs:__assign$8(__assign$8({},deepMix({},l,isFunction$1(s)?s(l,n):s)),{path:this.getLinkPath(n,o)})})},r.prototype.linkByElement=function(e,n){var o=this,s=this.context.view,l=this.getColorScale(s,e);if(l){var c=getElementValue$1(e,l.field);if(!this.cache[c]){var u=getElementsByField(s,l.field,c),f=this.linkGroup,d=f.addGroup();this.cache[c]=d;var g=u.length;each$1(u,function(p,v){if(v<g-1){var m=u[v+1];o.addLinkShape(d,p,m,n)}})}}},r.prototype.removeLink=function(e){var n=this.getColorScale(this.context.view,e);if(n){var o=getElementValue$1(e,n.field);this.cache[o]&&(this.cache[o].remove(),this.cache[o]=null)}},r.prototype.link=function(e){var n=this.context;this.linkGroup||(this.linkGroup=n.view.foregroundGroup.addGroup({id:"link-by-color-group",capture:!1}));var o=getCurrentElement$1(n);o&&this.linkByElement(o,e==null?void 0:e.style)},r.prototype.unlink=function(){var e=getCurrentElement$1(this.context);e&&this.removeLink(e)},r.prototype.clear=function(){this.linkGroup&&this.linkGroup.clear(),this.cache={}},r.prototype.destroy=function(){a.prototype.destroy.call(this),this.linkGroup&&this.linkGroup.remove()},r}(Action),ElementRangeState=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.startPoint=null,e.endPoint=null,e.isStarted=!1,e.effectSiblings=!1,e.effectByRecord=!1,e}return r.prototype.getCurrentPoint=function(){var e=this.context.event;return{x:e.x,y:e.y}},r.prototype.start=function(){this.clear(),this.startPoint=this.getCurrentPoint(),this.isStarted=!0},r.prototype.getIntersectElements=function(){var e=null;if(isMask(this.context))e=getMaskedElements(this.context,10);else{var n=this.startPoint,o=this.isStarted?this.getCurrentPoint():this.endPoint;if(!n||!o)return;var s={minX:Math.min(n.x,o.x),minY:Math.min(n.y,o.y),maxX:Math.max(n.x,o.x),maxY:Math.max(n.y,o.y)},l=this.context.view;e=getIntersectElements(l,s)}return e},r.prototype.setStateEnable=function(e){if(this.effectSiblings&&!this.effectByRecord)this.setSiblingsState(e);else{var n=getElements(this.context.view),o=this.getIntersectElements();o&&o.length?this.effectByRecord?this.setSiblingsStateByRecord(o,e):this.setElementsState(o,e,n):this.clear()}},r.prototype.setSiblingsStateByRecord=function(e,n){var o=this,s=this.context.view,l=getSilbings(s),c=e.map(function(d){return d.getModel().data}),u=s.getXScale().field,f=s.getYScales()[0].field;each$1(l,function(d){var g=getElements(d),p=g.filter(function(v){var m=v.getModel().data;return isInRecords(c,m,u,f)});o.setElementsState(p,n,g)})},r.prototype.setSiblingsState=function(e){var n=this,o=this.context.view,s=getSilbings(o);isMask(this.context)&&each$1(s,function(l){var c=getElements(l),u=getSiblingMaskElements(n.context,l,10);u&&u.length?n.setElementsState(u,e,c):n.clearViewState(l)})},r.prototype.setElementsState=function(e,n,o){var s=this;each$1(o,function(l){e.includes(l)?s.setElementState(l,n):s.setElementState(l,!1)})},r.prototype.end=function(){this.isStarted=!1,this.endPoint=this.getCurrentPoint()},r.prototype.clear=function(){var e=this,n=this.context.view;if(this.effectSiblings){var o=getSilbings(n);each$1(o,function(s){e.clearViewState(s)})}else this.clearViewState(n)},r}(StateBase),ElementRangeActive=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName="active",e}return r.prototype.active=function(){this.setState()},r}(ElementRangeState),ElementSingleState=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.setStateEnable=function(e){var n=getCurrentElement$1(this.context);if(n){if(!isElementChange(this.context))return;e?(this.clear(),this.setElementState(n,!0)):this.hasState(n)&&this.setElementState(n,!1)}},r.prototype.toggle=function(){var e=getCurrentElement$1(this.context);if(e){var n=this.hasState(e);n||this.clear(),this.setElementState(e,!n)}},r.prototype.reset=function(){this.setStateEnable(!1)},r}(StateBase),ElementSingleActive=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName="active",e}return r.prototype.active=function(){this.setState()},r}(ElementSingleState),STATUS_UNACTIVE$3="inactive",STATUS_ACTIVE$3="active";function clearHighlight$1(a){var r=getElements(a);each$1(r,function(e){e.hasState(STATUS_ACTIVE$3)&&e.setState(STATUS_ACTIVE$3,!1),e.hasState(STATUS_UNACTIVE$3)&&e.setState(STATUS_UNACTIVE$3,!1)})}function setHighlightBy(a,r,e){each$1(a,function(n){r(n)?(n.hasState(STATUS_UNACTIVE$3)&&n.setState(STATUS_UNACTIVE$3,!1),n.setState(STATUS_ACTIVE$3,e)):(n.hasState(STATUS_ACTIVE$3)&&n.setState(STATUS_ACTIVE$3,!1),n.setState(STATUS_UNACTIVE$3,e))})}var STATUS_UNACTIVE$2=ELEMENT_STATE.INACTIVE,STATUS_ACTIVE$2=ELEMENT_STATE.ACTIVE,ElementHighlight=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName=STATUS_ACTIVE$2,e}return r.prototype.setElementsStateByItem=function(e,n,o,s){var l=this,c=function(u){return l.isMathItem(u,n,o)};this.setHighlightBy(e,c,s)},r.prototype.setElementHighlight=function(e,n){n(e)?(e.hasState(STATUS_UNACTIVE$2)&&e.setState(STATUS_UNACTIVE$2,!1),e.setState(STATUS_ACTIVE$2,!0)):e.hasState(STATUS_ACTIVE$2)||e.setState(STATUS_UNACTIVE$2,!0)},r.prototype.setHighlightBy=function(e,n,o){var s=this;if(o)each$1(e,function(u){s.setElementHighlight(u,n)});else{var l=getElementsByState(this.context.view,STATUS_ACTIVE$2),c=!0;each$1(l,function(u){if(!n(u))return c=!1,!1}),c?this.clear():each$1(e,function(u){n(u)&&(u.hasState(STATUS_ACTIVE$2)&&u.setState(STATUS_ACTIVE$2,!1),u.setState(STATUS_UNACTIVE$2,!0))})}},r.prototype.setElementState=function(e,n){var o=this.context.view,s=getElements(o);this.setHighlightBy(s,function(l){return e===l},n)},r.prototype.highlight=function(){this.setState()},r.prototype.clear=function(){var e=this.context.view;clearHighlight$1(e)},r}(ElementState),HighlightColor=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.setStateByElement=function(e,n){var o=this.context.view,s=e.geometry.getAttribute("color");if(s){var l=o.getScaleByField(s.getFields()[0]),c=getElementValue$1(e,l.field),u=getElements(o),f=u.filter(function(d){return getElementValue$1(d,l.field)===c});this.setHighlightBy(u,function(d){return f.includes(d)},n)}},r}(ElementHighlight),HighlightX=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.setElementHighlight=function(e,n){n(e)?(e.hasState(STATUS_UNACTIVE$2)&&e.setState(STATUS_UNACTIVE$2,!1),e.setState(STATUS_ACTIVE$2,!0)):(e.setState(STATUS_UNACTIVE$2,!0),e.hasState(STATUS_ACTIVE$2)&&e.setState(STATUS_ACTIVE$2,!1))},r.prototype.setStateByElement=function(e,n){var o=this.context.view,s=o.getXScale(),l=getElementValue$1(e,s.field),c=getElements(o),u=c.filter(function(f){return getElementValue$1(f,s.field)===l});this.setHighlightBy(c,function(f){return u.includes(f)},n)},r.prototype.toggle=function(){var e=getCurrentElement$1(this.context);if(e){var n=e.hasState(this.stateName);this.setStateByElement(e,!n)}},r}(ElementHighlight),EVENTS$2;(function(a){a.BEFORE_HIGHLIGHT="element-range-highlight:beforehighlight",a.AFTER_HIGHLIGHT="element-range-highlight:afterhighlight",a.BEFORE_CLEAR="element-range-highlight:beforeclear",a.AFTER_CLEAR="element-range-highlight:afterclear"})(EVENTS$2||(EVENTS$2={}));var ElementRangeHighlight=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName="active",e}return r.prototype.clearViewState=function(e){clearHighlight$1(e)},r.prototype.highlight=function(){var e=this.context,n=e.view,o=e.event,s=this.getIntersectElements(),l={view:n,event:o,highlightElements:s};n.emit(EVENTS$2.BEFORE_HIGHLIGHT,Event$1.fromData(n,EVENTS$2.BEFORE_HIGHLIGHT,l)),this.setState(),n.emit(EVENTS$2.AFTER_HIGHLIGHT,Event$1.fromData(n,EVENTS$2.AFTER_HIGHLIGHT,l))},r.prototype.clear=function(){var e=this.context.view;e.emit(EVENTS$2.BEFORE_CLEAR,Event$1.fromData(e,EVENTS$2.BEFORE_CLEAR,{})),a.prototype.clear.call(this),e.emit(EVENTS$2.AFTER_CLEAR,Event$1.fromData(e,EVENTS$2.AFTER_CLEAR,{}))},r.prototype.setElementsState=function(e,n,o){setHighlightBy(o,function(s){return e.indexOf(s)>=0},n)},r}(ElementRangeState),ElementSingleHighlight=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName="active",e}return r.prototype.highlight=function(){this.setState()},r.prototype.setElementState=function(e,n){var o=this.context.view,s=getElements(o);setHighlightBy(s,function(l){return e===l},n)},r.prototype.clear=function(){var e=this.context.view;clearHighlight$1(e)},r}(ElementSingleState),ElementRangeSelected=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName="selected",e}return r.prototype.selected=function(){this.setState()},r}(ElementRangeState),ElementMultipleSelected=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName="selected",e}return r.prototype.selected=function(){this.setState()},r}(ElementState),ElementSingleSelected=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName="selected",e}return r.prototype.selected=function(){this.setState()},r}(ElementSingleState),ListState=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName="",e.ignoreItemStates=[],e}return r.prototype.getTriggerListInfo=function(){var e=getDelegationObject(this.context),n=null;return isList(e)&&(n={item:e.item,list:e.component}),n},r.prototype.getAllowComponents=function(){var e=this,n=this.context.view,o=getComponents(n),s=[];return each$1(o,function(l){l.isList()&&e.allowSetStateByElement(l)&&s.push(l)}),s},r.prototype.hasState=function(e,n){return e.hasState(n,this.stateName)},r.prototype.clearAllComponentsState=function(){var e=this,n=this.getAllowComponents();each$1(n,function(o){o.clearItemsState(e.stateName)})},r.prototype.allowSetStateByElement=function(e){var n=e.get("field");if(!n)return!1;if(this.cfg&&this.cfg.componentNames){var o=e.get("name");if(this.cfg.componentNames.indexOf(o)===-1)return!1}var s=this.context.view,l=getScaleByField(s,n);return l&&l.isCategory},r.prototype.allowSetStateByItem=function(e,n){var o=this.ignoreItemStates;if(o.length){var s=o.filter(function(l){return n.hasState(e,l)});return s.length===0}return!0},r.prototype.setStateByElement=function(e,n,o){var s=e.get("field"),l=this.context.view,c=getScaleByField(l,s),u=getElementValue$1(n,s),f=c.getText(u);this.setItemsState(e,f,o)},r.prototype.setStateEnable=function(e){var n=this,o=getCurrentElement$1(this.context);if(o){var s=this.getAllowComponents();each$1(s,function(f){n.setStateByElement(f,o,e)})}else{var l=getDelegationObject(this.context);if(isList(l)){var c=l.item,u=l.component;this.allowSetStateByElement(u)&&this.allowSetStateByItem(c,u)&&this.setItemState(u,c,e)}}},r.prototype.setItemsState=function(e,n,o){var s=this,l=e.getItems();each$1(l,function(c){c.name===n&&s.setItemState(e,c,o)})},r.prototype.setItemState=function(e,n,o){e.setItemState(n,this.stateName,o)},r.prototype.setState=function(){this.setStateEnable(!0)},r.prototype.reset=function(){this.setStateEnable(!1)},r.prototype.toggle=function(){var e=this.getTriggerListInfo();if(e&&e.item){var n=e.list,o=e.item,s=this.hasState(n,o);this.setItemState(n,o,!s)}},r.prototype.clear=function(){var e=this.getTriggerListInfo();e?e.list.clearItemsState(this.stateName):this.clearAllComponentsState()},r}(Action),ListActive=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName="active",e}return r.prototype.active=function(){this.setState()},r}(ListState),STATUS_UNACTIVE$1="inactive",STATUS_ACTIVE$1="active";function clearList(a){var r=a.getItems();each$1(r,function(e){a.hasState(e,STATUS_ACTIVE$1)&&a.setItemState(e,STATUS_ACTIVE$1,!1),a.hasState(e,STATUS_UNACTIVE$1)&&a.setItemState(e,STATUS_UNACTIVE$1,!1)})}var STATUS_UNACTIVE="inactive",STATUS_ACTIVE="active",ListHighlight=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName=STATUS_ACTIVE,e.ignoreItemStates=["unchecked"],e}return r.prototype.setItemsState=function(e,n,o){this.setHighlightBy(e,function(s){return s.name===n},o)},r.prototype.setItemState=function(e,n,o){e.getItems(),this.setHighlightBy(e,function(s){return s===n},o)},r.prototype.setHighlightBy=function(e,n,o){var s=e.getItems();if(o)each$1(s,function(u){n(u)?(e.hasState(u,STATUS_UNACTIVE)&&e.setItemState(u,STATUS_UNACTIVE,!1),e.setItemState(u,STATUS_ACTIVE,!0)):e.hasState(u,STATUS_ACTIVE)||e.setItemState(u,STATUS_UNACTIVE,!0)});else{var l=e.getItemsByState(STATUS_ACTIVE),c=!0;each$1(l,function(u){if(!n(u))return c=!1,!1}),c?this.clear():each$1(s,function(u){n(u)&&(e.hasState(u,STATUS_ACTIVE)&&e.setItemState(u,STATUS_ACTIVE,!1),e.setItemState(u,STATUS_UNACTIVE,!0))})}},r.prototype.highlight=function(){this.setState()},r.prototype.clear=function(){var e=this.getTriggerListInfo();if(e)clearList(e.list);else{var n=this.getAllowComponents();each$1(n,function(o){o.clearItemsState(STATUS_ACTIVE),o.clearItemsState(STATUS_UNACTIVE)})}},r}(ListState),ListSelected=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName="selected",e}return r.prototype.selected=function(){this.setState()},r}(ListState),ListUnchecked=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName="unchecked",e}return r.prototype.unchecked=function(){this.setState()},r}(ListState),STATUS_UNCHECKED$1="unchecked",STATUS_CHECKED="checked",ListChecked=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.stateName=STATUS_CHECKED,e}return r.prototype.setItemState=function(e,n,o){this.setCheckedBy(e,function(s){return s===n},o)},r.prototype.setCheckedBy=function(e,n,o){var s=e.getItems();o&&each$1(s,function(l){n(l)?(e.hasState(l,STATUS_UNCHECKED$1)&&e.setItemState(l,STATUS_UNCHECKED$1,!1),e.setItemState(l,STATUS_CHECKED,!0)):e.hasState(l,STATUS_CHECKED)||e.setItemState(l,STATUS_UNCHECKED$1,!0)})},r.prototype.toggle=function(){var e=this.getTriggerListInfo();if(e&&e.item){var n=e.list,o=e.item,s=!some(n.getItems(),function(l){return n.hasState(l,STATUS_UNCHECKED$1)});s||n.hasState(o,STATUS_UNCHECKED$1)?this.setItemState(n,o,!0):this.reset()}},r.prototype.checked=function(){this.setState()},r.prototype.reset=function(){var e=this.getAllowComponents();each$1(e,function(n){n.clearItemsState(STATUS_CHECKED),n.clearItemsState(STATUS_UNCHECKED$1)})},r}(ListState),STATUS_UNCHECKED="unchecked",ListFocus=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.toggle=function(){var e,n,o,s,l,c,u,f,d=this.getTriggerListInfo();if(d!=null&&d.item){var g=d.list,p=d.item,v=g.getItems(),m=v.filter(function(I){return!g.hasState(I,STATUS_UNCHECKED)}),y=v.filter(function(I){return g.hasState(I,STATUS_UNCHECKED)}),x=m[0];if(v.length===m.length)try{for(var _=__values(v),E=_.next();!E.done;E=_.next()){var S=E.value;g.setItemState(S,STATUS_UNCHECKED,S.id!==p.id)}}catch(I){e={error:I}}finally{try{E&&!E.done&&(n=_.return)&&n.call(_)}finally{if(e)throw e.error}}else if(v.length-y.length===1)if(x.id===p.id)try{for(var A=__values(v),T=A.next();!T.done;T=A.next()){var S=T.value;g.setItemState(S,STATUS_UNCHECKED,!1)}}catch(I){o={error:I}}finally{try{T&&!T.done&&(s=A.return)&&s.call(A)}finally{if(o)throw o.error}}else try{for(var b=__values(v),C=b.next();!C.done;C=b.next()){var S=C.value;g.setItemState(S,STATUS_UNCHECKED,S.id!==p.id)}}catch(I){l={error:I}}finally{try{C&&!C.done&&(c=b.return)&&c.call(b)}finally{if(l)throw l.error}}else try{for(var L=__values(v),R=L.next();!R.done;R=L.next()){var S=R.value;g.setItemState(S,STATUS_UNCHECKED,S.id!==p.id)}}catch(I){u={error:I}}finally{try{R&&!R.done&&(f=L.return)&&f.call(L)}finally{if(u)throw u.error}}}},r}(ListState),STATUS_SHOW="showRadio",TIP_ID="legend-radio-tip",ListRadio=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.timeStamp=0,e}return r.prototype.show=function(){var e=this.getTriggerListInfo();if(e!=null&&e.item){var n=e.list,o=e.item;n.setItemState(o,STATUS_SHOW,!0)}},r.prototype.hide=function(){var e=this.getTriggerListInfo();if(e!=null&&e.item){var n=e.list,o=e.item;n.setItemState(o,STATUS_SHOW,!1)}},r.prototype.destroy=function(){a.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},r.prototype.showTip=function(){var e=this.context,n=e.event,o=this.timeStamp,s=+new Date,l=this.context.event.target;if(s-o>16&&l.get("name")==="legend-item-radio"){var c=this.location,u={x:n.x,y:n.y};this.timeStamp=s,this.location=u,(!c||!isEqual$1(c,u))&&this.showTooltip(u)}},r.prototype.hideTip=function(){this.hideTooltip(),this.location=null},r.prototype.showTooltip=function(e){var n=this.context,o=n.event,s=o.target;if(s&&s.get("tip")){this.tooltip||this.renderTooltip();var l=n.view.getCanvas().get("el").getBoundingClientRect(),c=l.x,u=l.y;this.tooltip.update(__assign$8(__assign$8({title:s.get("tip")},e),{x:e.x+c,y:e.y+u})),this.tooltip.show()}},r.prototype.hideTooltip=function(){this.tooltip&&this.tooltip.hide()},r.prototype.renderTooltip=function(){var e,n=(e={},e[CONTAINER_CLASS]={padding:"6px 8px",transform:"translate(-50%, -80%)",background:"rgba(0,0,0,0.75)",color:"#fff","border-radius":"2px","z-index":100},e[TITLE_CLASS]={"font-size":"12px","line-height":"14px","margin-bottom":0,"word-break":"break-all"},e);document.getElementById(TIP_ID)&&document.body.removeChild(document.getElementById(TIP_ID));var o=new HtmlTooltip({parent:document.body,region:null,visible:!1,crosshairs:null,domStyles:n,containerId:TIP_ID});o.init(),o.setCapture(!1),this.tooltip=o},r}(ListState),MaskBase=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.maskShape=null,e.points=[],e.starting=!1,e.moving=!1,e.preMovePoint=null,e.shapeType="path",e}return r.prototype.getCurrentPoint=function(){var e=this.context.event;return{x:e.x,y:e.y}},r.prototype.emitEvent=function(e){var n="mask:".concat(e),o=this.context.view,s=this.context.event;o.emit(n,{target:this.maskShape,shape:this.maskShape,points:this.points,x:s.x,y:s.y})},r.prototype.createMask=function(){var e=this.context.view,n=this.getMaskAttrs(),o=e.foregroundGroup.addShape({type:this.shapeType,name:"mask",draggable:!0,attrs:__assign$8({fill:"#C5D4EB",opacity:.3},n)});return o},r.prototype.getMaskPath=function(){return[]},r.prototype.show=function(){this.maskShape&&(this.maskShape.show(),this.emitEvent("show"))},r.prototype.start=function(e){this.starting=!0,this.moving=!1,this.points=[this.getCurrentPoint()],this.maskShape||(this.maskShape=this.createMask(),this.maskShape.set("capture",!1)),this.updateMask(e==null?void 0:e.maskStyle),this.emitEvent("start")},r.prototype.moveStart=function(){this.moving=!0,this.preMovePoint=this.getCurrentPoint()},r.prototype.move=function(){if(!(!this.moving||!this.maskShape)){var e=this.getCurrentPoint(),n=this.preMovePoint,o=e.x-n.x,s=e.y-n.y,l=this.points;each$1(l,function(c){c.x+=o,c.y+=s}),this.updateMask(),this.emitEvent("change"),this.preMovePoint=e}},r.prototype.updateMask=function(e){var n=deepMix({},this.getMaskAttrs(),e);this.maskShape.attr(n)},r.prototype.moveEnd=function(){this.moving=!1,this.preMovePoint=null},r.prototype.end=function(){this.starting=!1,this.emitEvent("end"),this.maskShape&&this.maskShape.set("capture",!0)},r.prototype.hide=function(){this.maskShape&&(this.maskShape.hide(),this.emitEvent("hide"))},r.prototype.resize=function(){this.starting&&this.maskShape&&(this.points.push(this.getCurrentPoint()),this.updateMask(),this.emitEvent("change"))},r.prototype.destroy=function(){this.points=[],this.maskShape&&this.maskShape.remove(),this.maskShape=null,this.preMovePoint=null,a.prototype.destroy.call(this)},r}(Action);function getMaskAttrs$3(a){var r=last(a),e=0,n=0,o=0;if(a.length){var s=a[0];e=distance$2(s,r)/2,n=(r.x+s.x)/2,o=(r.y+s.y)/2}return{x:n,y:o,r:e}}var CircleMask=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.shapeType="circle",e}return r.prototype.getMaskAttrs=function(){return getMaskAttrs$3(this.points)},r}(MaskBase);function getRegion$1(a){return{start:head(a),end:last(a)}}function getMaskAttrs$2(a,r){var e=Math.min(a.x,r.x),n=Math.min(a.y,r.y),o=Math.abs(r.x-a.x),s=Math.abs(r.y-a.y);return{x:e,y:n,width:o,height:s}}var RectMask=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.shapeType="rect",e}return r.prototype.getRegion=function(){return getRegion$1(this.points)},r.prototype.getMaskAttrs=function(){var e=this.getRegion(),n=e.start,o=e.end;return getMaskAttrs$2(n,o)},r}(MaskBase);function clampPoint(a){a.x=clamp(a.x,0,1),a.y=clamp(a.y,0,1)}function getRegion(a,r,e,n){var o=null,s=null,l=n.invert(head(a)),c=n.invert(last(a));return e&&(clampPoint(l),clampPoint(c)),r==="x"?(o=n.convert({x:l.x,y:0}),s=n.convert({x:c.x,y:1})):(o=n.convert({x:0,y:l.y}),s=n.convert({x:1,y:c.y})),{start:o,end:s}}var DimRect=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.dim="x",e.inPlot=!0,e}return r.prototype.getRegion=function(){var e=this.context.view.getCoordinate();return getRegion(this.points,this.dim,this.inPlot,e)},r}(RectMask);function getMaskPath$1(a){var r=[];return a.length&&(each$1(a,function(e,n){n===0?r.push(["M",e.x,e.y]):r.push(["L",e.x,e.y])}),r.push(["L",a[0].x,a[0].y])),r}function getMaskAttrs$1(a){return{path:getMaskPath$1(a)}}var PathMask=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getMaskPath=function(){return getMaskPath$1(this.points)},r.prototype.getMaskAttrs=function(){return getMaskAttrs$1(this.points)},r.prototype.addPoint=function(){this.resize()},r}(MaskBase);function getMaskPath(a){return getSpline(a,!0)}function getMaskAttrs(a){return{path:getMaskPath(a)}}var SmoothPathMask=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getMaskPath=function(){return getMaskPath(this.points)},r.prototype.getMaskAttrs=function(){return getMaskAttrs(this.points)},r}(PathMask),MultipleMaskBase=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.maskShapes=[],e.starting=!1,e.moving=!1,e.recordPoints=null,e.preMovePoint=null,e.shapeType="path",e.maskType="multi-mask",e}return r.prototype.getCurrentPoint=function(){var e=this.context.event;return{x:e.x,y:e.y}},r.prototype.emitEvent=function(e){var n="".concat(this.maskType,":").concat(e),o=this.context.view,s=this.context.event,l={type:this.shapeType,name:this.maskType,get:function(c){return l.hasOwnProperty(c)?l[c]:void 0}};o.emit(n,{target:l,maskShapes:this.maskShapes,multiPoints:this.recordPoints,x:s.x,y:s.y})},r.prototype.createMask=function(e){var n=this.context.view,o=this.recordPoints[e],s=this.getMaskAttrs(o),l=n.foregroundGroup.addShape({type:this.shapeType,name:"mask",draggable:!0,attrs:__assign$8({fill:"#C5D4EB",opacity:.3},s)});this.maskShapes.push(l)},r.prototype.getMaskPath=function(e){return[]},r.prototype.show=function(){this.maskShapes.length>0&&(this.maskShapes.forEach(function(e){return e.show()}),this.emitEvent("show"))},r.prototype.start=function(e){this.recordPointStart(),this.starting=!0,this.moving=!1;var n=this.recordPoints.length-1;this.createMask(n),this.updateShapesCapture(!1),this.updateMask(e==null?void 0:e.maskStyle),this.emitEvent("start")},r.prototype.moveStart=function(){this.moving=!0,this.preMovePoint=this.getCurrentPoint(),this.updateShapesCapture(!1)},r.prototype.move=function(){if(!(!this.moving||this.maskShapes.length===0)){var e=this.getCurrentPoint(),n=this.preMovePoint,o=e.x-n.x,s=e.y-n.y,l=this.getCurMaskShapeIndex();l>-1&&(this.recordPoints[l].forEach(function(c){c.x+=o,c.y+=s}),this.updateMask(),this.emitEvent("change"),this.preMovePoint=e)}},r.prototype.updateMask=function(e){var n=this;this.recordPoints.forEach(function(o,s){var l=deepMix({},n.getMaskAttrs(o),e);n.maskShapes[s].attr(l)})},r.prototype.resize=function(){this.starting&&this.maskShapes.length>0&&(this.recordPointContinue(),this.updateMask(),this.emitEvent("change"))},r.prototype.moveEnd=function(){this.moving=!1,this.preMovePoint=null,this.updateShapesCapture(!0)},r.prototype.end=function(){this.starting=!1,this.emitEvent("end"),this.updateShapesCapture(!0)},r.prototype.hide=function(){this.maskShapes.length>0&&(this.maskShapes.forEach(function(e){return e.hide()}),this.emitEvent("hide"))},r.prototype.remove=function(){var e=this.getCurMaskShapeIndex();e>-1&&(this.recordPoints.splice(e,1),this.maskShapes[e].remove(),this.maskShapes.splice(e,1),this.preMovePoint=null,this.updateShapesCapture(!0),this.emitEvent("change"))},r.prototype.clearAll=function(){this.recordPointClear(),this.maskShapes.forEach(function(e){return e.remove()}),this.maskShapes=[],this.preMovePoint=null},r.prototype.clear=function(){var e=this.getCurMaskShapeIndex();e===-1?(this.recordPointClear(),this.maskShapes.forEach(function(n){return n.remove()}),this.maskShapes=[],this.emitEvent("clearAll")):(this.recordPoints.splice(e,1),this.maskShapes[e].remove(),this.maskShapes.splice(e,1),this.preMovePoint=null,this.emitEvent("clearSingle")),this.preMovePoint=null},r.prototype.destroy=function(){this.clear(),a.prototype.destroy.call(this)},r.prototype.getRecordPoints=function(){var e;return __spreadArray$2([],__read((e=this.recordPoints)!==null&&e!==void 0?e:[]),!1)},r.prototype.recordPointStart=function(){var e=this.getRecordPoints(),n=this.getCurrentPoint();this.recordPoints=__spreadArray$2(__spreadArray$2([],__read(e),!1),[[n]],!1)},r.prototype.recordPointContinue=function(){var e=this.getRecordPoints(),n=this.getCurrentPoint(),o=e.splice(-1,1)[0]||[];o.push(n),this.recordPoints=__spreadArray$2(__spreadArray$2([],__read(e),!1),[o],!1)},r.prototype.recordPointClear=function(){this.recordPoints=[]},r.prototype.updateShapesCapture=function(e){this.maskShapes.forEach(function(n){return n.set("capture",e)})},r.prototype.getCurMaskShapeIndex=function(){var e=this.getCurrentPoint();return this.maskShapes.findIndex(function(n){var o=n.attrs,s=o.width,l=o.height,c=o.r,u=s===0||l===0||c===0;return!u&&n.isHit(e.x,e.y)})},r}(Action),RectMultiMask=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.shapeType="rect",e}return r.prototype.getRegion=function(e){return getRegion$1(e)},r.prototype.getMaskAttrs=function(e){var n=this.getRegion(e),o=n.start,s=n.end;return getMaskAttrs$2(o,s)},r}(MultipleMaskBase),DimRectMultiMask=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.dim="x",e.inPlot=!0,e}return r.prototype.getRegion=function(e){var n=this.context.view.getCoordinate();return getRegion(e,this.dim,this.inPlot,n)},r}(RectMultiMask),CircleMultiMask=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.shapeType="circle",e.getMaskAttrs=getMaskAttrs$3,e}return r}(MultipleMaskBase),PathMultiMask=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.getMaskPath=getMaskPath$1,e.getMaskAttrs=getMaskAttrs$1,e}return r.prototype.addPoint=function(){this.resize()},r}(MultipleMaskBase),SmoothPathMultiMask=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.getMaskPath=getMaskPath,e.getMaskAttrs=getMaskAttrs,e}return r}(PathMultiMask),CursorAction=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.setCursor=function(e){var n=this.context.view;n.getCanvas().setCursor(e)},r.prototype.default=function(){this.setCursor("default")},r.prototype.pointer=function(){this.setCursor("pointer")},r.prototype.move=function(){this.setCursor("move")},r.prototype.crosshair=function(){this.setCursor("crosshair")},r.prototype.wait=function(){this.setCursor("wait")},r.prototype.help=function(){this.setCursor("help")},r.prototype.text=function(){this.setCursor("text")},r.prototype.eResize=function(){this.setCursor("e-resize")},r.prototype.wResize=function(){this.setCursor("w-resize")},r.prototype.nResize=function(){this.setCursor("n-resize")},r.prototype.sResize=function(){this.setCursor("s-resize")},r.prototype.neResize=function(){this.setCursor("ne-resize")},r.prototype.nwResize=function(){this.setCursor("nw-resize")},r.prototype.seResize=function(){this.setCursor("se-resize")},r.prototype.swResize=function(){this.setCursor("sw-resize")},r.prototype.nsResize=function(){this.setCursor("ns-resize")},r.prototype.ewResize=function(){this.setCursor("ew-resize")},r.prototype.zoomIn=function(){this.setCursor("zoom-in")},r.prototype.zoomOut=function(){this.setCursor("zoom-out")},r}(Action),DataFilter=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.filterView=function(e,n,o){var s=this;e.getScaleByField(n)&&e.filter(n,o),e.views&&e.views.length&&each$1(e.views,function(l){s.filterView(l,n,o)})},r.prototype.filter=function(){var e=getDelegationObject(this.context);if(e){var n=this.context.view,o=e.component,s=o.get("field");if(isList(e)){if(s){var l=o.getItemsByState("unchecked"),c=getScaleByField(n,s),u=l.map(function(v){return v.name});u.length?this.filterView(n,s,function(v){var m=c.getText(v);return!u.includes(m)}):this.filterView(n,s,null),n.render(!0)}}else if(isSlider(e)){var f=o.getValue(),d=__read(f,2),g=d[0],p=d[1];this.filterView(n,s,function(v){return v>=g&&v<=p}),n.render(!0)}}},r}(Action);function getFilter(a,r,e,n){var o=Math.min(e[r],n[r]),s=Math.max(e[r],n[r]),l=__read(a.range,2),c=l[0],u=l[1];if(o<c&&(o=c),s>u&&(s=u),o===u&&s===u)return null;var f=a.invert(o),d=a.invert(s);if(a.isCategory){var g=a.values.indexOf(f),p=a.values.indexOf(d),v=a.values.slice(g,p+1);return function(m){return v.includes(m)}}else return function(m){return m>=f&&m<=d}}var EVENTS$1;(function(a){a.FILTER="brush-filter-processing",a.RESET="brush-filter-reset",a.BEFORE_FILTER="brush-filter:beforefilter",a.AFTER_FILTER="brush-filter:afterfilter",a.BEFORE_RESET="brush-filter:beforereset",a.AFTER_RESET="brush-filter:afterreset"})(EVENTS$1||(EVENTS$1={}));var RangeFilter=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.dims=["x","y"],e.startPoint=null,e.isStarted=!1,e}return r.prototype.hasDim=function(e){return this.dims.includes(e)},r.prototype.start=function(){var e=this.context;this.isStarted=!0,this.startPoint=e.getCurrentPoint()},r.prototype.filter=function(){var e,n;if(isMask(this.context)){var o=this.context.event.target,s=o.getCanvasBBox();e={x:s.x,y:s.y},n={x:s.maxX,y:s.maxY}}else{if(!this.isStarted)return;e=this.startPoint,n=this.context.getCurrentPoint()}if(!(Math.abs(e.x-n.x)<5||Math.abs(e.x-n.y)<5)){var l=this.context,c=l.view,u=l.event,f={view:c,event:u,dims:this.dims};c.emit(EVENTS$1.BEFORE_FILTER,Event$1.fromData(c,EVENTS$1.BEFORE_FILTER,f));var d=c.getCoordinate(),g=d.invert(n),p=d.invert(e);if(this.hasDim("x")){var v=c.getXScale(),m=getFilter(v,"x",g,p);this.filterView(c,v.field,m)}if(this.hasDim("y")){var y=c.getYScales()[0],m=getFilter(y,"y",g,p);this.filterView(c,y.field,m)}this.reRender(c,{source:EVENTS$1.FILTER}),c.emit(EVENTS$1.AFTER_FILTER,Event$1.fromData(c,EVENTS$1.AFTER_FILTER,f))}},r.prototype.end=function(){this.isStarted=!1},r.prototype.reset=function(){var e=this.context.view;if(e.emit(EVENTS$1.BEFORE_RESET,Event$1.fromData(e,EVENTS$1.BEFORE_RESET,{})),this.isStarted=!1,this.hasDim("x")){var n=e.getXScale();this.filterView(e,n.field,null)}if(this.hasDim("y")){var o=e.getYScales()[0];this.filterView(e,o.field,null)}this.reRender(e,{source:EVENTS$1.RESET}),e.emit(EVENTS$1.AFTER_RESET,Event$1.fromData(e,EVENTS$1.AFTER_RESET,{}))},r.prototype.filterView=function(e,n,o){e.filter(n,o)},r.prototype.reRender=function(e,n){e.render(!0,n)},r}(Action),SiblingFilter$1=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.filterView=function(e,n,o){var s=getSilbings(e);each$1(s,function(l){l.filter(n,o)})},r.prototype.reRender=function(e){var n=getSilbings(e);each$1(n,function(o){o.render(!0)})},r}(RangeFilter),ElementFilter=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.filter=function(){var e=getDelegationObject(this.context),n=this.context.view,o=getElements(n);if(isMask(this.context)){var s=getMaskedElements(this.context,10);s&&each$1(o,function(y){s.includes(y)?y.show():y.hide()})}else if(e){var l=e.component,c=l.get("field");if(isList(e)){if(c){var u=l.getItemsByState("unchecked"),f=getScaleByField(n,c),d=u.map(function(y){return y.name});each$1(o,function(y){var x=getElementValue$1(y,c),_=f.getText(x);d.indexOf(_)>=0?y.hide():y.show()})}}else if(isSlider(e)){var g=l.getValue(),p=__read(g,2),v=p[0],m=p[1];each$1(o,function(y){var x=getElementValue$1(y,c);x>=v&&x<=m?y.show():y.hide()})}}},r.prototype.clear=function(){var e=getElements(this.context.view);each$1(e,function(n){n.show()})},r.prototype.reset=function(){this.clear()},r}(Action),SiblingFilter=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.byRecord=!1,e}return r.prototype.filter=function(){isMask(this.context)&&(this.byRecord?this.filterByRecord():this.filterByBBox())},r.prototype.filterByRecord=function(){var e=this.context.view,n=getMaskedElements(this.context,10);if(n){var o=e.getXScale().field,s=e.getYScales()[0].field,l=n.map(function(u){return u.getModel().data}),c=getSilbings(e);each$1(c,function(u){var f=getElements(u);each$1(f,function(d){var g=d.getModel().data;isInRecords(l,g,o,s)?d.show():d.hide()})})}},r.prototype.filterByBBox=function(){var e=this,n=this.context.view,o=getSilbings(n);each$1(o,function(s){var l=getSiblingMaskElements(e.context,s,10),c=getElements(s);l&&each$1(c,function(u){l.includes(u)?u.show():u.hide()})})},r.prototype.reset=function(){var e=getSilbings(this.context.view);each$1(e,function(n){var o=getElements(n);each$1(o,function(s){s.show()})})},r}(Action),PADDING_RIGHT$1=10,PADDING_TOP$2=5,ButtonAction$1=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.buttonGroup=null,e.buttonCfg={name:"button",text:"button",textStyle:{x:0,y:0,fontSize:12,fill:"#333333",cursor:"pointer"},padding:[8,10],style:{fill:"#f7f7f7",stroke:"#cccccc",cursor:"pointer"},activeStyle:{fill:"#e6e6e6"}},e}return r.prototype.getButtonCfg=function(){return deepMix(this.buttonCfg,this.cfg)},r.prototype.drawButton=function(){var e=this.getButtonCfg(),n=this.context.view.foregroundGroup.addGroup({name:e.name}),o=n.addShape({type:"text",name:"button-text",attrs:__assign$8({text:e.text},e.textStyle)}),s=o.getBBox(),l=parsePadding(e.padding),c=n.addShape({type:"rect",name:"button-rect",attrs:__assign$8({x:s.x-l[3],y:s.y-l[0],width:s.width+l[1]+l[3],height:s.height+l[0]+l[2]},e.style)});c.toBack(),n.on("mouseenter",function(){c.attr(e.activeStyle)}),n.on("mouseleave",function(){c.attr(e.style)}),this.buttonGroup=n},r.prototype.resetPosition=function(){var e=this.context.view,n=e.getCoordinate(),o=n.convert({x:1,y:1}),s=this.buttonGroup,l=s.getBBox(),c=transform$6(null,[["t",o.x-l.width-PADDING_RIGHT$1,o.y+l.height+PADDING_TOP$2]]);s.setMatrix(c)},r.prototype.show=function(){this.buttonGroup||this.drawButton(),this.resetPosition(),this.buttonGroup.show()},r.prototype.hide=function(){this.buttonGroup&&this.buttonGroup.hide()},r.prototype.destroy=function(){var e=this.buttonGroup;e&&e.remove(),a.prototype.destroy.call(this)},r}(Action),DISTANCE=4,Drag=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.starting=!1,e.dragStart=!1,e}return r.prototype.start=function(){this.starting=!0,this.startPoint=this.context.getCurrentPoint()},r.prototype.drag=function(){if(this.startPoint){var e=this.context.getCurrentPoint(),n=this.context.view,o=this.context.event;this.dragStart?n.emit("drag",{target:o.target,x:o.x,y:o.y}):distance$2(e,this.startPoint)>DISTANCE&&(n.emit("dragstart",{target:o.target,x:o.x,y:o.y}),this.dragStart=!0)}},r.prototype.end=function(){if(this.dragStart){var e=this.context.view,n=this.context.event;e.emit("dragend",{target:n.target,x:n.x,y:n.y})}this.starting=!1,this.dragStart=!1},r}(Action),MIN_DISTANCE=5,Move=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.starting=!1,e.isMoving=!1,e.startPoint=null,e.startMatrix=null,e}return r.prototype.start=function(){this.starting=!0,this.startPoint=this.context.getCurrentPoint(),this.startMatrix=this.context.view.middleGroup.getMatrix()},r.prototype.move=function(){if(this.starting){var e=this.startPoint,n=this.context.getCurrentPoint(),o=distance$2(e,n);if(o>MIN_DISTANCE&&!this.isMoving&&(this.isMoving=!0),this.isMoving){var s=this.context.view,l=transform$6(this.startMatrix,[["t",n.x-e.x,n.y-e.y]]);s.backgroundGroup.setMatrix(l),s.foregroundGroup.setMatrix(l),s.middleGroup.setMatrix(l)}}},r.prototype.end=function(){this.isMoving&&(this.isMoving=!1),this.startMatrix=null,this.starting=!1,this.startPoint=null},r.prototype.reset=function(){this.starting=!1,this.startPoint=null,this.isMoving=!1;var e=this.context.view;e.backgroundGroup.resetMatrix(),e.foregroundGroup.resetMatrix(),e.middleGroup.resetMatrix(),this.isMoving=!1},r}(Action),DIM_X="x",DIM_Y="y",ScaleTranslate$2=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.dims=[DIM_X,DIM_Y],e.cfgFields=["dims"],e.cacheScaleDefs={},e}return r.prototype.hasDim=function(e){return this.dims.includes(e)},r.prototype.getScale=function(e){var n=this.context.view;return e==="x"?n.getXScale():n.getYScales()[0]},r.prototype.resetDim=function(e){var n=this.context.view;if(this.hasDim(e)&&this.cacheScaleDefs[e]){var o=this.getScale(e);n.scale(o.field,this.cacheScaleDefs[e]),this.cacheScaleDefs[e]=null}},r.prototype.reset=function(){this.resetDim(DIM_X),this.resetDim(DIM_Y);var e=this.context.view;e.render(!0)},r}(Action),ScaleTranslate$1=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.startPoint=null,e.starting=!1,e.startCache={},e}return r.prototype.start=function(){var e=this;this.startPoint=this.context.getCurrentPoint(),this.starting=!0;var n=this.dims;each$1(n,function(o){var s=e.getScale(o),l=s.min,c=s.max,u=s.values;e.startCache[o]={min:l,max:c,values:u}})},r.prototype.end=function(){this.startPoint=null,this.starting=!1,this.startCache={}},r.prototype.translate=function(){var e=this;if(this.starting){var n=this.startPoint,o=this.context.view.getCoordinate(),s=this.context.getCurrentPoint(),l=o.invert(n),c=o.invert(s),u=c.x-l.x,f=c.y-l.y,d=this.context.view,g=this.dims;each$1(g,function(p){e.translateDim(p,{x:u*-1,y:f*-1})}),d.render(!0)}},r.prototype.translateDim=function(e,n){if(this.hasDim(e)){var o=this.getScale(e);o.isLinear&&this.translateLinear(e,o,n)}},r.prototype.translateLinear=function(e,n,o){var s=this.context.view,l=this.startCache[e],c=l.min,u=l.max,f=u-c,d=o[e]*f;this.cacheScaleDefs[e]||(this.cacheScaleDefs[e]={nice:n.nice,min:c,max:u}),s.scale(n.field,{nice:!1,min:c+d,max:u+d})},r.prototype.reset=function(){a.prototype.reset.call(this),this.startPoint=null,this.starting=!1},r}(ScaleTranslate$2),ScaleTranslate=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.zoomRatio=.05,e}return r.prototype.zoomIn=function(){this.zoom(this.zoomRatio)},r.prototype.zoom=function(e){var n=this,o=this.dims;each$1(o,function(s){n.zoomDim(s,e)}),this.context.view.render(!0)},r.prototype.zoomOut=function(){this.zoom(-1*this.zoomRatio)},r.prototype.zoomDim=function(e,n){if(this.hasDim(e)){var o=this.getScale(e);o.isLinear&&this.zoomLinear(e,o,n)}},r.prototype.zoomLinear=function(e,n,o){var s=this.context.view;this.cacheScaleDefs[e]||(this.cacheScaleDefs[e]={nice:n.nice,min:n.min,max:n.max});var l=this.cacheScaleDefs[e],c=l.max-l.min,u=n.min,f=n.max,d=o*c,g=u-d,p=f+d,v=p-g,m=v/c;p>g&&m<100&&m>.01&&s.scale(n.field,{nice:!1,min:u-d,max:f+d})},r}(ScaleTranslate$2);function isWheelDown$1(a){var r=a.gEvent.originalEvent;return r.deltaY>0}var DEFAULT_WHEELDELTA=1,MousewheelScroll=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.scroll=function(e){var n=this.context,o=n.view,s=n.event;if(o.getOptions().scrollbar){var l=(e==null?void 0:e.wheelDelta)||DEFAULT_WHEELDELTA,c=o.getController("scrollbar"),u=o.getXScale(),f=o.getOptions().data,d=size(valuesOfKey(f,u.field)),g=size(u.values),p=c.getValue(),v=Math.floor((d-g)*p),m=v+(isWheelDown$1(s)?l:-l),y=l/(d-g)/1e4,x=clamp(m/(d-g)+y,0,1);c.setValue(x)}},r}(Action),AXIS_DESCRIPTION_TOOLTIP="aixs-description-tooltip",AxisDescription=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.show=function(){var e=this.context,n=getDelegationObject(e).axis,o=n.cfg.title,s=o.description,l=o.text,c=o.descriptionTooltipStyle,u=e.event,f=u.x,d=u.y;this.tooltip||this.renderTooltip(),this.tooltip.update({title:l||"",customContent:function(){return`
          <div class="`.concat(CONTAINER_CLASS,'" style={').concat(c,`}>
            <div class="`).concat(TITLE_CLASS,`">
              字段说明：`).concat(s,`
            </div>
          </div>
        `)},x:f,y:d}),this.tooltip.show()},r.prototype.destroy=function(){a.prototype.destroy.call(this),this.tooltip&&this.tooltip.destroy()},r.prototype.hide=function(){this.tooltip&&this.tooltip.hide()},r.prototype.renderTooltip=function(){var e,n=this.context.view,o=n.canvas,s={start:{x:0,y:0},end:{x:o.get("width"),y:o.get("height")}},l=new HtmlTooltip({parent:o.get("el").parentNode,region:s,visible:!1,containerId:AXIS_DESCRIPTION_TOOLTIP,domStyles:__assign$8({},deepMix({},(e={},e[CONTAINER_CLASS]={"max-width":"50%",padding:"10px","line-height":"15px","font-size":"12px",color:"rgba(0, 0, 0, .65)"},e[TITLE_CLASS]={"word-break":"break-all","margin-bottom":"3px"},e)))});l.init(),l.setCapture(!1),this.tooltip=l},r}(Action);registerTheme("dark",createThemeByStyleSheet(antvDark));registerEngine("canvas",CanvasEngine);registerEngine("svg",SVGEngine);registerGeometry("Polygon",Polygon);registerGeometry("Interval",Interval);registerGeometry("Schema",Schema);registerGeometry("Path",Path);registerGeometry("Point",Point);registerGeometry("Line",Line$1);registerGeometry("Area",Area$1);registerGeometry("Edge",Edge);registerGeometry("Heatmap",Heatmap$1);registerGeometry("Violin",Violin$1);registerGeometryLabel("base",GeometryLabel);registerGeometryLabel("interval",IntervalLabel);registerGeometryLabel("pie",PieLabel);registerGeometryLabel("polar",PolarLabel);registerGeometryLabelLayout("overlap",overlap);registerGeometryLabelLayout("distribute",distribute);registerGeometryLabelLayout("fixed-overlap",fixedOverlap);registerGeometryLabelLayout("hide-overlap",hideOverlap);registerGeometryLabelLayout("limit-in-shape",limitInShape);registerGeometryLabelLayout("limit-in-canvas",limitInCanvas);registerGeometryLabelLayout("limit-in-plot",limitInPlot$3);registerGeometryLabelLayout("pie-outer",pieOuterLabelLayout);registerGeometryLabelLayout("adjust-color",adjustColor);registerGeometryLabelLayout("interval-adjust-position",intervalAdjustPosition);registerGeometryLabelLayout("interval-hide-overlap",intervalHideOverlap);registerGeometryLabelLayout("point-adjust-position",pointAdjustPosition);registerGeometryLabelLayout("pie-spider",pieSpiderLabelLayout);registerGeometryLabelLayout("path-adjust-position",pathAdjustPosition);registerAnimation("fade-in",fadeIn);registerAnimation("fade-out",fadeOut);registerAnimation("grow-in-x",growInX);registerAnimation("grow-in-xy",growInXY);registerAnimation("grow-in-y",growInY);registerAnimation("scale-in-x",scaleInX);registerAnimation("scale-in-y",scaleInY);registerAnimation("wave-in",waveIn);registerAnimation("zoom-in",zoomIn);registerAnimation("zoom-out",zoomOut);registerAnimation("position-update",positionUpdate);registerAnimation("sector-path-update",sectorPathUpdate);registerAnimation("path-in",pathIn);registerFacet("rect",Rect);registerFacet("mirror",Mirror);registerFacet("list",List);registerFacet("matrix",Matrix);registerFacet("circle",Circle);registerFacet("tree",Tree);registerComponentController("axis",Axis);registerComponentController("legend",Legend);registerComponentController("tooltip",Tooltip);registerComponentController("annotation",Annotation);registerComponentController("slider",Slider$1);registerComponentController("scrollbar",Scrollbar);registerAction("tooltip",TooltipAction);registerAction("sibling-tooltip",SiblingTooltip);registerAction("ellipsis-text",EllipsisText);registerAction("element-active",ElementActive);registerAction("element-single-active",ElementSingleActive);registerAction("element-range-active",ElementRangeActive);registerAction("element-highlight",ElementHighlight);registerAction("element-highlight-by-x",HighlightX);registerAction("element-highlight-by-color",HighlightColor);registerAction("element-single-highlight",ElementSingleHighlight);registerAction("element-range-highlight",ElementRangeHighlight);registerAction("element-sibling-highlight",ElementRangeHighlight,{effectSiblings:!0,effectByRecord:!0});registerAction("element-selected",ElementMultipleSelected);registerAction("element-single-selected",ElementSingleSelected);registerAction("element-range-selected",ElementRangeSelected);registerAction("element-link-by-color",LinkByColor);registerAction("active-region",ActiveRegion);registerAction("list-active",ListActive);registerAction("list-selected",ListSelected);registerAction("list-highlight",ListHighlight);registerAction("list-unchecked",ListUnchecked);registerAction("list-checked",ListChecked);registerAction("list-focus",ListFocus);registerAction("list-radio",ListRadio);registerAction("legend-item-highlight",ListHighlight,{componentNames:["legend"]});registerAction("axis-label-highlight",ListHighlight,{componentNames:["axis"]});registerAction("axis-description",AxisDescription);registerAction("rect-mask",RectMask);registerAction("x-rect-mask",DimRect,{dim:"x"});registerAction("y-rect-mask",DimRect,{dim:"y"});registerAction("circle-mask",CircleMask);registerAction("path-mask",PathMask);registerAction("smooth-path-mask",SmoothPathMask);registerAction("rect-multi-mask",RectMultiMask);registerAction("x-rect-multi-mask",DimRectMultiMask,{dim:"x"});registerAction("y-rect-multi-mask",DimRectMultiMask,{dim:"y"});registerAction("circle-multi-mask",CircleMultiMask);registerAction("path-multi-mask",PathMultiMask);registerAction("smooth-path-multi-mask",SmoothPathMultiMask);registerAction("cursor",CursorAction);registerAction("data-filter",DataFilter);registerAction("brush",RangeFilter);registerAction("brush-x",RangeFilter,{dims:["x"]});registerAction("brush-y",RangeFilter,{dims:["y"]});registerAction("sibling-filter",SiblingFilter$1);registerAction("sibling-x-filter",SiblingFilter$1,{dims:"x"});registerAction("sibling-y-filter",SiblingFilter$1,{dims:"y"});registerAction("element-filter",ElementFilter);registerAction("element-sibling-filter",SiblingFilter);registerAction("element-sibling-filter-record",SiblingFilter,{byRecord:!0});registerAction("view-drag",Drag);registerAction("view-move",Move);registerAction("scale-translate",ScaleTranslate$1);registerAction("scale-zoom",ScaleTranslate);registerAction("reset-button",ButtonAction$1,{name:"reset-button",text:"reset"});registerAction("mousewheel-scroll",MousewheelScroll);function isPointInView$1(a){return a.isInPlot()}registerInteraction("tooltip",{start:[{trigger:"plot:mousemove",action:"tooltip:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"plot:touchmove",action:"tooltip:show",throttle:{wait:50,leading:!0,trailing:!1}}],end:[{trigger:"plot:mouseleave",action:"tooltip:hide"},{trigger:"plot:leave",action:"tooltip:hide"},{trigger:"plot:touchend",action:"tooltip:hide"}]});registerInteraction("ellipsis-text",{start:[{trigger:"legend-item-name:mousemove",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"legend-item-name:touchstart",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"axis-label:mousemove",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}},{trigger:"axis-label:touchstart",action:"ellipsis-text:show",throttle:{wait:50,leading:!0,trailing:!1}}],end:[{trigger:"legend-item-name:mouseleave",action:"ellipsis-text:hide"},{trigger:"legend-item-name:touchend",action:"ellipsis-text:hide"},{trigger:"axis-label:mouseleave",action:"ellipsis-text:hide"},{trigger:"axis-label:mouseout",action:"ellipsis-text:hide"},{trigger:"axis-label:touchend",action:"ellipsis-text:hide"}]});registerInteraction("element-active",{start:[{trigger:"element:mouseenter",action:"element-active:active"}],end:[{trigger:"element:mouseleave",action:"element-active:reset"}]});registerInteraction("element-selected",{start:[{trigger:"element:click",action:"element-selected:toggle"}]});registerInteraction("element-highlight",{start:[{trigger:"element:mouseenter",action:"element-highlight:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight:reset"}]});registerInteraction("element-highlight-by-x",{start:[{trigger:"element:mouseenter",action:"element-highlight-by-x:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight-by-x:reset"}]});registerInteraction("element-highlight-by-color",{start:[{trigger:"element:mouseenter",action:"element-highlight-by-color:highlight"}],end:[{trigger:"element:mouseleave",action:"element-highlight-by-color:reset"}]});registerInteraction("legend-active",{start:[{trigger:"legend-item:mouseenter",action:["list-active:active","element-active:active"]}],end:[{trigger:"legend-item:mouseleave",action:["list-active:reset","element-active:reset"]}]});registerInteraction("legend-highlight",{start:[{trigger:"legend-item:mouseenter",action:["legend-item-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"legend-item:mouseleave",action:["legend-item-highlight:reset","element-highlight:reset"]}]});registerInteraction("axis-label-highlight",{start:[{trigger:"axis-label:mouseenter",action:["axis-label-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"axis-label:mouseleave",action:["axis-label-highlight:reset","element-highlight:reset"]}]});registerInteraction("element-list-highlight",{start:[{trigger:"element:mouseenter",action:["list-highlight:highlight","element-highlight:highlight"]}],end:[{trigger:"element:mouseleave",action:["list-highlight:reset","element-highlight:reset"]}]});registerInteraction("element-range-highlight",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"mask:mouseenter",action:"cursor:move"},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:function(a){return!a.isInShape("mask")},action:["rect-mask:start","rect-mask:show"]},{trigger:"mask:dragstart",action:["rect-mask:moveStart"]}],processing:[{trigger:"plot:mousemove",action:["rect-mask:resize"]},{trigger:"mask:drag",action:["rect-mask:move"]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["rect-mask:end"]},{trigger:"mask:dragend",action:["rect-mask:moveEnd"]},{trigger:"document:mouseup",isEnable:function(a){return!a.isInPlot()},action:["element-range-highlight:clear","rect-mask:end","rect-mask:hide"]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","rect-mask:hide"]}]});registerInteraction("brush",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:isPointInView$1,action:["brush:start","rect-mask:start","rect-mask:show"]}],processing:[{trigger:"mousemove",isEnable:isPointInView$1,action:["rect-mask:resize"]}],end:[{trigger:"mouseup",isEnable:isPointInView$1,action:["brush:filter","brush:end","rect-mask:end","rect-mask:hide","reset-button:show"]}],rollback:[{trigger:"reset-button:click",action:["brush:reset","reset-button:hide","cursor:crosshair"]}]});registerInteraction("brush-visible",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"plot:mousedown",action:["rect-mask:start","rect-mask:show"]}],processing:[{trigger:"plot:mousemove",action:["rect-mask:resize"]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["rect-mask:end","rect-mask:hide","element-filter:filter","element-range-highlight:clear"]}],rollback:[{trigger:"dblclick",action:["element-filter:clear"]}]});registerInteraction("brush-x",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:isPointInView$1,action:["brush-x:start","x-rect-mask:start","x-rect-mask:show"]}],processing:[{trigger:"mousemove",isEnable:isPointInView$1,action:["x-rect-mask:resize"]}],end:[{trigger:"mouseup",isEnable:isPointInView$1,action:["brush-x:filter","brush-x:end","x-rect-mask:end","x-rect-mask:hide"]}],rollback:[{trigger:"dblclick",action:["brush-x:reset"]}]});registerInteraction("element-path-highlight",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:isPointInView$1,action:"path-mask:start"},{trigger:"mousedown",isEnable:isPointInView$1,action:"path-mask:show"}],processing:[{trigger:"mousemove",action:"path-mask:addPoint"}],end:[{trigger:"mouseup",action:"path-mask:end"}],rollback:[{trigger:"dblclick",action:"path-mask:hide"}]});registerInteraction("brush-x-multi",{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair"},{trigger:"mask:mouseenter",action:"cursor:move"},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"mousedown",isEnable:isPointInView$1,action:["x-rect-multi-mask:start","x-rect-multi-mask:show"]},{trigger:"mask:dragstart",action:["x-rect-multi-mask:moveStart"]}],processing:[{trigger:"mousemove",isEnable:function(a){return!isMultipleMask(a)},action:["x-rect-multi-mask:resize"]},{trigger:"multi-mask:change",action:"element-range-highlight:highlight"},{trigger:"mask:drag",action:["x-rect-multi-mask:move"]}],end:[{trigger:"mouseup",action:["x-rect-multi-mask:end"]},{trigger:"mask:dragend",action:["x-rect-multi-mask:moveEnd"]}],rollback:[{trigger:"dblclick",action:["x-rect-multi-mask:clear","cursor:crosshair"]},{trigger:"multi-mask:clearAll",action:["element-range-highlight:clear"]},{trigger:"multi-mask:clearSingle",action:["element-range-highlight:highlight"]}]});registerInteraction("element-single-selected",{start:[{trigger:"element:click",action:"element-single-selected:toggle"}]});registerInteraction("legend-filter",{showEnable:[{trigger:"legend-item:mouseenter",action:["cursor:pointer","list-radio:show"]},{trigger:"legend-item:mouseleave",action:["cursor:default","list-radio:hide"]}],start:[{trigger:"legend-item:click",isEnable:function(a){return!a.isInShape("legend-item-radio")},action:["legend-item-highlight:reset","element-highlight:reset","list-unchecked:toggle","data-filter:filter","list-radio:show"]},{trigger:"legend-item-radio:mouseenter",action:["list-radio:showTip"]},{trigger:"legend-item-radio:mouseleave",action:["list-radio:hideTip"]},{trigger:"legend-item-radio:click",action:["list-focus:toggle","data-filter:filter","list-radio:show"]}]});registerInteraction("continuous-filter",{start:[{trigger:"legend:valuechanged",action:"data-filter:filter"}]});registerInteraction("continuous-visible-filter",{start:[{trigger:"legend:valuechanged",action:"element-filter:filter"}]});registerInteraction("legend-visible-filter",{showEnable:[{trigger:"legend-item:mouseenter",action:"cursor:pointer"},{trigger:"legend-item:mouseleave",action:"cursor:default"}],start:[{trigger:"legend-item:click",action:["legend-item-highlight:reset","element-highlight:reset","list-unchecked:toggle","element-filter:filter"]}]});registerInteraction("active-region",{start:[{trigger:"plot:mousemove",action:"active-region:show"}],end:[{trigger:"plot:mouseleave",action:"active-region:hide"}]});registerInteraction("axis-description",{start:[{trigger:"axis-description:mousemove",action:"axis-description:show"}],end:[{trigger:"axis-description:mouseleave",action:"axis-description:hide"}]});function isWheelDown(a){return a.gEvent.preventDefault(),a.gEvent.originalEvent.deltaY>0}registerInteraction("view-zoom",{start:[{trigger:"plot:mousewheel",isEnable:function(a){return isWheelDown(a.event)},action:"scale-zoom:zoomOut",throttle:{wait:100,leading:!0,trailing:!1}},{trigger:"plot:mousewheel",isEnable:function(a){return!isWheelDown(a.event)},action:"scale-zoom:zoomIn",throttle:{wait:100,leading:!0,trailing:!1}}]});registerInteraction("sibling-tooltip",{start:[{trigger:"plot:mousemove",action:"sibling-tooltip:show"}],end:[{trigger:"plot:mouseleave",action:"sibling-tooltip:hide"}]});registerInteraction("plot-mousewheel-scroll",{start:[{trigger:"plot:mousewheel",action:"mousewheel-scroll:scroll"}]});const index$2=Object.freeze(Object.defineProperty({__proto__:null,Action,get BRUSH_FILTER_EVENTS(){return EVENTS$1},Chart,ComponentController:Controller,Coordinate,get DIRECTION(){return DIRECTION},get ELEMENT_RANGE_HIGHLIGHT_EVENTS(){return EVENTS$2},Element:Element$1,Event:Event$1,Facet:Facet$1,Geometry,GeometryLabel,Interaction,InteractionAction:Action,get LAYER(){return LAYER},Scale,TooltipController:Tooltip,Util,VERSION,get VIEW_LIFE_CIRCLE(){return VIEW_LIFE_CIRCLE},View,getActionClass,getAnimation,getEngine,getFacet,getGeometryLabel,getGeometryLabelLayout,getInteraction,getShapeFactory,getTheme,registerAction,registerAnimation,registerComponentController,registerEngine,registerFacet,registerGeometry,registerGeometryLabel,registerGeometryLabelLayout,registerInteraction,registerShape,registerShapeFactory,registerTheme},Symbol.toStringTag,{value:"Module"}));var AXIS_META_CONFIG_KEYS=["type","alias","tickCount","tickInterval","min","max","nice","minLimit","maxLimit","range","tickMethod","base","exponent","mask","sync"],LEVEL;(function(a){a.ERROR="error",a.WARN="warn",a.INFO="log"})(LEVEL||(LEVEL={}));var BRAND="AntV/G2Plot";function getMessage(a){for(var r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];var n=0;return"".concat(BRAND,": ").concat(a.replace(/%s/g,function(){return"".concat(r[n++])}))}function log(a,r,e){for(var n=[],o=3;o<arguments.length;o++)n[o-3]=arguments[o];r||console[a](getMessage.apply(void 0,__spreadArray$2([e],n,!1)))}function pick(a,r){var e={};return a!==null&&typeof a=="object"&&r.forEach(function(n){var o=a[n];o!==void 0&&(e[n]=o)}),e}function adjustYMetaByZero(a,r){if(!a)return{};var e=a.filter(function(s){var l=get(s,[r]);return isNumber$2(l)&&!isNaN(l)}),n=e.every(function(s){return get(s,[r])>=0}),o=e.every(function(s){return get(s,[r])<=0});return n?{min:0}:o?{max:0}:{}}function transformDataToNodeLinkData(a,r,e,n,o){if(o===void 0&&(o=[]),!Array.isArray(a))return{nodes:[],links:[]};var s=[],l={},c=-1;return a.forEach(function(u){var f=u[r],d=u[e],g=u[n],p=pick(u,o);l[f]||(l[f]=__assign$8({id:++c,name:f},p)),l[d]||(l[d]=__assign$8({id:++c,name:d},p)),s.push(__assign$8({source:l[f].id,target:l[d].id,value:g},p))}),{nodes:Object.values(l).sort(function(u,f){return u.id-f.id}),links:s}}function processIllegalData(a,r){var e=filter(a,function(n){var o=n[r];return o===null||typeof o=="number"&&!isNaN(o)});return log(LEVEL.WARN,e.length===a.length,"illegal data existed in chart data."),e}var MAX_MIX_LEVEL=5,toString={}.toString,isType=function(a,r){return toString.call(a)==="[object "+r+"]"},isArray$3=function(a){return isType(a,"Array")},isObjectLike=function(a){return typeof a=="object"&&a!==null},isPlainObject=function(a){if(!isObjectLike(a)||!isType(a,"Object"))return!1;for(var r=a;Object.getPrototypeOf(r)!==null;)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(a)===r},deep=function(a,r,e,n){e=e||0,n=n||MAX_MIX_LEVEL;for(var o in r)if(Object.prototype.hasOwnProperty.call(r,o)){var s=r[o];s?isPlainObject(s)?(isPlainObject(a[o])||(a[o]={}),e<n?deep(a[o],s,e+1,n):a[o]=r[o]):isArray$3(s)?(a[o]=[],a[o]=a[o].concat(s)):a[o]=s:a[o]=s}},deepAssign=function(a){for(var r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];for(var n=0;n<r.length;n+=1)deep(a,r[n]);return a};function getContainerSize(a){if(!a)return{width:0,height:0};var r=getComputedStyle(a);return{width:(a.clientWidth||parseInt(r.width,10))-parseInt(r.paddingLeft,10)-parseInt(r.paddingRight,10),height:(a.clientHeight||parseInt(r.height,10))-parseInt(r.paddingTop,10)-parseInt(r.paddingBottom,10)}}function flow(){for(var a=[],r=0;r<arguments.length;r++)a[r]=arguments[r];return function(e){return a.reduce(function(n,o){return o(n)},e)}}function findGeometry(a,r){return a.geometries.find(function(e){return e.type===r})}function getAllElements(a){return reduce(a.geometries,function(r,e){return r.concat(e.elements)},[])}function getAllElementsRecursively(a){return get(a,["views","length"],0)<=0?getAllElements(a):reduce(a.views,function(r,e){return r.concat(getAllElementsRecursively(e))},getAllElements(a))}function getAllGeometriesRecursively(a){return get(a,["views","length"],0)<=0?a.geometries:reduce(a.views,function(r,e){return r.concat(e.geometries)},a.geometries)}function kebabCase(a){if(!a)return a;var r=a.match(/(([A-Z]{0,1}[a-z]*[^A-Z])|([A-Z]{1}))/g);return r.map(function(e){return e.toLowerCase()}).join("-")}function transformLabel(a){if(!isType$1(a,"Object"))return a;var r=__assign$8({},a);return r.formatter&&!r.content&&(r.content=r.formatter),r}var ctx;function getCanvasContext(){return ctx||(ctx=document.createElement("canvas").getContext("2d")),ctx}var measureTextWidth=memoize(function(a,r){r===void 0&&(r={});var e=r.fontSize,n=r.fontFamily,o=n===void 0?"sans-serif":n,s=r.fontWeight,l=r.fontStyle,c=r.fontVariant,u=getCanvasContext();u.font=[l,s,c,"".concat(e,"px"),o].join(" ");var f=u.measureText(isString$1(a)?a:"");return f.width},function(a,r){return r===void 0&&(r={}),__spreadArray$2([a],values(r),!0).join("")});function isRealNumber(a){return typeof a=="number"&&!isNaN(a)}function isBetween(a,r,e){var n=Math.min(r,e),o=Math.max(r,e);return a>=n&&a<=o}function normalPadding(a){if(isNumber$2(a))return[a,a,a,a];if(isArray$4(a)){var r=a.length;if(r===1)return[a[0],a[0],a[0],a[0]];if(r===2)return[a[0],a[1],a[0],a[1]];if(r===3)return[a[0],a[1],a[2],a[1]];if(r===4)return a}return[0,0,0,0]}function getAdjustAppendPadding(a,r,e){r===void 0&&(r="bottom"),e===void 0&&(e=25);var n=normalPadding(a),o=[r.startsWith("top")?e:0,r.startsWith("right")?e:0,r.startsWith("bottom")?e:0,r.startsWith("left")?e:0];return[n[0]+o[0],n[1]+o[1],n[2]+o[2],n[3]+o[3]]}function resolveAllPadding(a){var r=a.map(function(n){return normalPadding(n)}),e=[0,0,0,0];return r.length>0&&(e=e.map(function(n,o){return r.forEach(function(s,l){n+=r[l][o]}),n})),e}function points2Path(a,r){var e=[];if(a.length){e.push(["M",a[0].x,a[0].y]);for(var n=1,o=a.length;n<o;n+=1){var s=a[n];e.push(["L",s.x,s.y])}r&&e.push(["Z"])}return e}var smoothBezier=function(a,r,e,n){var o=[],s,l,c=!!n,u,f;if(c){u=[1/0,1/0],f=[-1/0,-1/0];for(var d=0,g=a.length;d<g;d++){var p=a[d];u=min$1([0,0],u,p),f=max$1([0,0],f,p)}u=min$1([0,0],u,n[0]),f=max$1([0,0],f,n[1])}for(var d=0,v=a.length;d<v;d++){var p=a[d];if(e)s=a[d?d-1:v-1],l=a[(d+1)%v];else if(d===0||d===v-1){o.push(p);continue}else s=a[d-1],l=a[d+1];var m=[0,0];m=sub(m,l,s),m=scale$3(m,m,r);var y=distance$6(p,s),x=distance$6(p,l),_=y+x;_!==0&&(y/=_,x/=_);var E=scale$3([0,0],m,-y),S=scale$3([0,0],m,x),A=add$1([0,0],p,E),T=add$1([0,0],p,S);c&&(A=max$1([0,0],A,u),A=min$1([0,0],A,f),T=max$1([0,0],T,u),T=min$1([0,0],T,f)),o.push(A),o.push(T)}return e&&o.push(o.shift()),o};function catmullRom2bezier(a,r,e){for(var n=!!r,o=[],s=0,l=a.length;s<l;s+=2)o.push([a[s],a[s+1]]);for(var c=smoothBezier(o,.4,n,e),u=o.length,f=[],d,g,p,s=0;s<u-1;s++)d=c[s*2],g=c[s*2+1],p=o[s+1],f.push(["C",d[0],d[1],g[0],g[1],p[0],p[1]]);return n&&(d=c[u],g=c[u+1],p=o[0],f.push(["C",d[0],d[1],g[0],g[1],p[0],p[1]])),f}function getSplinePath(a,r,e){var n=[],o=a[0],s=null;if(a.length<=2)return points2Path(a,r);for(var l=0,c=a.length;l<c;l++){var u=a[l];(!s||!(s.x===u.x&&s.y===u.y))&&(n.push(u.x),n.push(u.y),s=u)}var f=e||[[0,0],[1,1]],d=catmullRom2bezier(n,r,f);return d.unshift(["M",o.x,o.y]),d}function adapteStyle(a){var r={overflow:"hidden","white-space":"nowrap","text-overflow":"ellipsis",display:"flex",justifyContent:"center",alignItems:"center"},e=["stroke","lineWidth","shadowColor","strokeOpacity","shadowBlur","shadowOffsetX","shadowOffsetY","fill"];get(a,"fill")&&(r.color=a.fill);var n=pick(a,e),o=n.shadowColor,s=n.shadowBlur,l=s===void 0?0:s,c=n.shadowOffsetX,u=c===void 0?0:c,f=n.shadowOffsetY,d=f===void 0?0:f;r["text-shadow"]="".concat([o,"".concat(u,"px"),"".concat(d,"px"),"".concat(l,"px")].join(" "));var g=pick(a,e),p=g.stroke,v=g.lineWidth,m=v===void 0?0:v;return r["-webkit-text-stroke"]="".concat(["".concat(m,"px"),p].join(" ")),each$1(a,function(y,x){["fontSize"].includes(x)&&isNumber$2(y)?r[kebabCase(x)]="".concat(y,"px"):x&&!e.includes(x)&&(r[kebabCase(x)]="".concat(y))}),r}function setStatisticContainerStyle(a,r){a.style["pointer-events"]="none",each$1(r,function(e,n){n&&e&&(a.style[n]=e)})}var renderStatistic=function(a,r,e){var n=r.statistic,o=r.plotType,s=n.title,l=n.content;[s,l].forEach(function(c,u){if(c){var f="";u===0?f=l?"translate(-50%, -100%)":"translate(-50%, -50%)":f=s?"translate(-50%, 0)":"translate(-50%, -50%)";var d=isFunction$1(c.style)?c.style(e):c.style;a.annotation().html(__assign$8({position:["50%","50%"],html:function(g,p){var v=p.getCoordinate(),m=0;if(o==="pie"||o==="ring-progress")m=v.getRadius()*v.innerRadius*2;else if(o==="liquid"){var y=get(p.geometries,[0,"elements",0,"shape"]);if(y){var x=y.find(function(A){return A.get("name")==="wrap"}),_=x.getCanvasBBox().width;m=_}}else m||(m=v.getWidth());setStatisticContainerStyle(g,__assign$8({width:"".concat(m,"px"),transform:f},adapteStyle(d)));var E=p.getData();if(c.customHtml)return c.customHtml(g,p,e,E);var S=c.content;return c.formatter&&(S=c.formatter(e,E)),S?isString$1(S)?S:"".concat(S):"<div></div>"},key:"".concat(u===0?"top":"bottom","-statistic")},pick(c,["offsetX","offsetY","rotate","style","formatter"])))}})},renderGaugeStatistic=function(a,r,e){var n=r.statistic,o=n.title,s=n.content;[o,s].forEach(function(l){if(l){var c=isFunction$1(l.style)?l.style(e):l.style;a.annotation().html(__assign$8({position:["50%","100%"],html:function(u,f){var d=f.getCoordinate(),g=f.views[0].getCoordinate(),p=g.getCenter(),v=g.getRadius(),m=Math.max(Math.sin(g.startAngle),Math.sin(g.endAngle))*v,y=p.y+m-d.y.start-parseFloat(get(c,"fontSize",0)),x=d.getRadius()*d.innerRadius*2;setStatisticContainerStyle(u,__assign$8({width:"".concat(x,"px"),transform:"translate(-50%, ".concat(y,"px)")},adapteStyle(c)));var _=f.getData();if(l.customHtml)return l.customHtml(u,f,e,_);var E=l.content;return l.formatter&&(E=l.formatter(e,_)),E?isString$1(E)?E:"".concat(E):"<div></div>"}},pick(l,["offsetX","offsetY","rotate","style","formatter"])))}})};function template(a,r){return r?reduce(r,function(e,n,o){return e.replace(new RegExp("{\\s*".concat(o,"\\s*}"),"g"),n)},a):a}function findViewById(a,r){return a.views.find(function(e){return e.id===r})}function getViews(a){var r=a.parent;return r?r.views:[]}function getSiblingViews(a){return getViews(a).filter(function(r){return r!==a})}function addViewAnimation(a,r,e){e===void 0&&(e=a.geometries),typeof r=="boolean"?a.animate(r):a.animate(!0),each$1(e,function(n){var o;isFunction$1(r)?o=r(n.type||n.shapeType,n)||!0:o=r,n.animate(o)})}function getPixelRatio(){return typeof window=="object"?window==null?void 0:window.devicePixelRatio:2}function initCanvas(a,r){r===void 0&&(r=a);var e=document.createElement("canvas"),n=getPixelRatio();e.width=a*n,e.height=r*n,e.style.width="".concat(a,"px"),e.style.height="".concat(r,"px");var o=e.getContext("2d");return o.scale(n,n),e}function drawBackground(a,r,e,n){n===void 0&&(n=e);var o=r.backgroundColor,s=r.opacity;a.globalAlpha=s,a.fillStyle=o,a.beginPath(),a.fillRect(0,0,e,n),a.closePath()}function getUnitPatternSize(a,r,e){var n=a+r;return e?n*2:n}function getSymbolsPosition(a,r){var e=r?[[a*.25,a*.25],[a*.75,a*.75]]:[[a*.5,a*.5]];return e}function transformMatrix(a,r){var e=r*Math.PI/180,n={a:Math.cos(e)*(1/a),b:Math.sin(e)*(1/a),c:-Math.sin(e)*(1/a),d:Math.cos(e)*(1/a),e:0,f:0};return n}var defaultDotPatternCfg={size:6,padding:2,backgroundColor:"transparent",opacity:1,rotation:0,fill:"#fff",fillOpacity:.5,stroke:"transparent",lineWidth:0,isStagger:!0};function drawDot(a,r,e,n){var o=r.size,s=r.fill,l=r.lineWidth,c=r.stroke,u=r.fillOpacity;a.beginPath(),a.globalAlpha=u,a.fillStyle=s,a.strokeStyle=c,a.lineWidth=l,a.arc(e,n,o/2,0,2*Math.PI,!1),a.fill(),l&&a.stroke(),a.closePath()}function createDotPattern(a){var r=deepAssign({},defaultDotPatternCfg,a),e=r.size,n=r.padding,o=r.isStagger,s=r.rotation,l=getUnitPatternSize(e,n,o),c=getSymbolsPosition(l,o),u=initCanvas(l,l),f=u.getContext("2d");drawBackground(f,r,l);for(var d=0,g=c;d<g.length;d++){var p=g[d],v=p[0],m=p[1];drawDot(f,r,v,m)}var y=f.createPattern(u,"repeat");if(y){var x=getPixelRatio(),_=transformMatrix(x,s);y.setTransform(_)}return y}var defaultLinePatternCfg={rotation:45,spacing:5,opacity:1,backgroundColor:"transparent",strokeOpacity:.5,stroke:"#fff",lineWidth:2};function drawLine(a,r,e){var n=r.stroke,o=r.lineWidth,s=r.strokeOpacity,l=new Path2D(e);a.globalAlpha=s,a.lineCap="square",a.strokeStyle=o?n:"transparent",a.lineWidth=o,a.stroke(l)}function createLinePattern(a){var r=deepAssign({},defaultLinePatternCfg,a),e=r.spacing,n=r.rotation,o=r.lineWidth,s=e+o||1,l=e+o||1,c=`
            M 0 0 L `.concat(s,` 0
            M 0 `).concat(l," L ").concat(s," ").concat(l,`
            `),u=initCanvas(s,l),f=u.getContext("2d");drawBackground(f,r,s,l),drawLine(f,r,c);var d=f.createPattern(u,"repeat");if(d){var g=getPixelRatio(),p=transformMatrix(g,n);d.setTransform(p)}return d}var defaultSquarePatternCfg={size:6,padding:1,isStagger:!0,backgroundColor:"transparent",opacity:1,rotation:0,fill:"#fff",fillOpacity:.5,stroke:"transparent",lineWidth:0};function drawSquare(a,r,e,n){var o=r.stroke,s=r.size,l=r.fill,c=r.lineWidth,u=r.fillOpacity;a.globalAlpha=u,a.strokeStyle=o,a.lineWidth=c,a.fillStyle=l,a.strokeRect(e-s/2,n-s/2,s,s),a.fillRect(e-s/2,n-s/2,s,s)}function createSquarePattern(a){var r=deepAssign({},defaultSquarePatternCfg,a),e=r.size,n=r.padding,o=r.isStagger,s=r.rotation,l=getUnitPatternSize(e,n,o),c=getSymbolsPosition(l,o),u=initCanvas(l,l),f=u.getContext("2d");drawBackground(f,r,l);for(var d=0,g=c;d<g.length;d++){var p=g[d],v=p[0],m=p[1];drawSquare(f,r,v,m)}var y=f.createPattern(u,"repeat");if(y){var x=getPixelRatio(),_=transformMatrix(x,s);y.setTransform(_)}return y}function getCanvasPattern(a){var r=a.type,e=a.cfg,n;switch(r){case"dot":n=createDotPattern(e);break;case"line":n=createLinePattern(e);break;case"square":n=createSquarePattern(e);break}return n}function pattern(a){var r=this;return function(e){var n,o=e.options,s=e.chart,l=o.pattern;if(!l)return e;var c=function(u){for(var f,d,g,p=[],v=1;v<arguments.length;v++)p[v-1]=arguments[v];var m=s.getTheme().defaultColor,y=m,x=(d=(f=s.geometries)===null||f===void 0?void 0:f[0])===null||d===void 0?void 0:d.getAttribute("color");if(x){var _=x.getFields()[0],E=get(u,_);y=Util.getMappingValue(x,E,((g=x.values)===null||g===void 0?void 0:g[0])||m)}var S=l;typeof l=="function"&&(S=l.call(r,u,y)),S instanceof CanvasPattern||(S=getCanvasPattern(deepAssign({},{cfg:{backgroundColor:y}},S)));var A=o[a];return __assign$8(__assign$8({},typeof A=="function"?A.call.apply(A,__spreadArray$2([r,u],p,!1)):A||{}),{fill:S||y})};return deepAssign({},e,{options:(n={},n[a]=c,n)})}}function legend$g(a){var r=a.chart,e=a.options,n=e.legend,o=e.colorField,s=e.seriesField;return n===!1?r.legend(!1):(o||s)&&r.legend(o||s,n),a}function tooltip$9(a){var r=a.chart,e=a.options,n=e.tooltip;return n!==void 0&&r.tooltip(n),a}function interaction$8(a){var r=a.chart,e=a.options,n=e.interactions;return each$1(n,function(o){o.enable===!1?r.removeInteraction(o.type):r.interaction(o.type,o.cfg||{})}),a}function animation$5(a){var r=a.chart,e=a.options,n=e.animation;return addViewAnimation(r,n),a}function theme$2(a){var r=a.chart,e=a.options,n=e.theme;return n&&r.theme(n),a}function state(a){var r=a.chart,e=a.options,n=e.state;return n&&each$1(r.geometries,function(o){o.state(n)}),a}function slider$2(a){var r=a.chart,e=a.options,n=e.slider;return r.option("slider",n),a}function scrollbar(a){var r=a.chart,e=a.options,n=e.scrollbar;return r.option("scrollbar",n),a}function scale$2(a,r){return function(e){var n=e.chart,o=e.options,s={};return each$1(a,function(l,c){s[c]=pick(l,AXIS_META_CONFIG_KEYS)}),s=deepAssign({},r,o.meta,s),n.scale(s),e}}function annotation$2(a){return function(r){var e=r.chart,n=r.options,o=e.getController("annotation");return each$1(__spreadArray$2(__spreadArray$2([],n.annotations||[],!0),a||[],!0),function(s){o.annotation(s)}),r}}function limitInPlot$2(a){var r=a.chart,e=a.options,n=e.yAxis,o=e.limitInPlot,s=o;return isObject$1(n)&&isNil(o)&&(Object.values(pick(n,["min","max","minLimit","maxLimit"])).some(function(l){return!isNil(l)})?s=!0:s=!1),r.limitInPlot=s,a}function transformations(a){return a===void 0&&(a="rect"),function(r){var e=r.chart,n=r.options,o=n.coordinate,s=Array.from(o||[]).map(function(l){return l.type==="reflectX"?["reflect","x"]:l.type==="reflectY"?["reflect","y"]:l.type==="transpose"?["transpose"]:null}).filter(function(l){return!!l});return s.length!==0&&e.coordinate({type:a,actions:s}),r}}var GLOBAL={locale:"en-US"};function setGlobal(a){each$1(a,function(r,e){return GLOBAL[e]=r})}var LocaleMap={};function registerLocale(a,r){LocaleMap[a]=r}function getLocale(a){return{get:function(r,e){return template(get(LocaleMap[a],r)||get(LocaleMap[GLOBAL.locale],r)||get(LocaleMap["en-US"],r)||r,e)}}}var EN_US_LOCALE={locale:"en-US",general:{increase:"Increase",decrease:"Decrease",root:"Root"},statistic:{total:"Total"},conversionTag:{label:"Rate"},legend:{},tooltip:{},slider:{},scrollbar:{},waterfall:{total:"Total"}},ZH_CN_LOCALE={locale:"zh-CN",general:{increase:"增加",decrease:"减少",root:"初始"},statistic:{total:"总计"},conversionTag:{label:"转化率"},legend:{},tooltip:{},slider:{},scrollbar:{},waterfall:{total:"总计"}};function getTooltipMapping(a,r){if(a===!1)return{fields:!1};var e=get(a,"fields"),n=get(a,"formatter");return n&&!e&&(e=r),{fields:e,formatter:n}}function getMappingField(a,r){var e=a.type,n=a.xField,o=a.yField,s=a.colorField,l=a.shapeField,c=a.sizeField,u=a.styleField,f=a.rawFields,d=[];if(f=(isFunction$1(f)?f(e,r):f)||[],r==="color")d=__spreadArray$2([s||n],f,!0);else if(r==="shape")d=__spreadArray$2([l||n],f,!0);else if(r==="size")d=__spreadArray$2([c||n],f,!0);else{d=__spreadArray$2([n,o,s,l,c,u],f,!0);var g=["x","y","color","shape","size","style"].indexOf(r),p=d[g];d.splice(g,1),d.unshift(p)}var v=uniq$2(d.filter(function(y){return!!y})),m=e==="line"&&[n,o].includes(v.join("*"))?"":v.join("*");return{mappingFields:v,tileMappingField:m}}function getMappingFunction(a,r){if(r)return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o={};return a.forEach(function(s,l){o[s]=e[l]}),delete o.undefined,r(o)}}function geometry$x(a){var r=a.chart,e=a.options,n=e.type,o=e.args,s=e.mapping,l=e.xField,c=e.yField,u=e.colorField,f=e.shapeField,d=e.sizeField,g=e.tooltipFields,p=e.label,v=e.state,m=e.customInfo;if(!s)return a;var y=s.color,x=s.shape,_=s.size,E=s.style,S=s.tooltip,A=r[n](o).position("".concat(l,"*").concat(c));if(isString$1(y))u?A.color(u,y):A.color(y);else if(isFunction$1(y)){var T=getMappingField(e,"color"),b=T.mappingFields,C=T.tileMappingField;A.color(C,getMappingFunction(b,y))}else u&&A.color(u,y);if(isString$1(x))f?A.shape(f,[x]):A.shape(x);else if(isFunction$1(x)){var L=getMappingField(e,"shape"),b=L.mappingFields,C=L.tileMappingField;A.shape(C,getMappingFunction(b,x))}else f&&A.shape(f,x);if(isNumber$2(_))d?A.size(d,_):A.size(_);else if(isFunction$1(_)){var R=getMappingField(e,"size"),b=R.mappingFields,C=R.tileMappingField;A.size(C,getMappingFunction(b,_))}else d&&A.size(d,_);if(isFunction$1(E)){var I=getMappingField(e,"style"),b=I.mappingFields,C=I.tileMappingField;A.style(C,getMappingFunction(b,E))}else isObject$1(E)&&A.style(E);if(g===!1?A.tooltip(!1):isEmpty(g)||A.tooltip(g.join("*"),getMappingFunction(g,S)),p===!1)A.label(!1);else if(p){var w=p.callback,M=p.fields,D=__rest$1(p,["callback","fields"]);A.label({fields:M||[c],callback:w,cfg:transformLabel(D)})}return v&&A.state(v),m&&A.customInfo(m),[l,c].filter(function(O){return O!==u}).forEach(function(O){r.legend(O,!1)}),__assign$8(__assign$8({},a),{ext:{geometry:A}})}function area(a){var r=a.options,e=r.area,n=r.xField,o=r.yField,s=r.seriesField,l=r.smooth,c=r.tooltip,u=r.useDeferredLabel,f=getTooltipMapping(c,[n,o,s]),d=f.fields,g=f.formatter;return e?geometry$x(deepAssign({},a,{options:{type:"area",colorField:s,tooltipFields:d,mapping:deepMix({shape:l?"smooth":"area",tooltip:g},e),args:{useDeferredLabel:u}}})):a}function edge(a){var r=a.options,e=r.edge,n=r.xField,o=r.yField,s=r.seriesField,l=r.tooltip,c=r.useDeferredLabel,u=getTooltipMapping(l,[n,o,s]),f=u.fields,d=u.formatter;return e?geometry$x(deepAssign({},a,{options:{type:"edge",colorField:s,tooltipFields:f,mapping:__assign$8({tooltip:d},e),args:{useDeferredLabel:c}}})):a}function otherAdaptor(a){var r=a.chart,e=a.options,n=a.ext,o=e.seriesField,s=e.isGroup,l=e.isStack,c=e.marginRatio,u=e.widthRatio,f=e.groupField,d=e.theme,g=[];if(o&&(s&&g.push({type:"dodge",dodgeBy:f||o,marginRatio:c}),l&&g.push({type:"stack",marginRatio:c})),g.length&&(n!=null&&n.geometry)){var p=n==null?void 0:n.geometry;p.adjust(g)}return isNil(u)||r.theme(deepAssign({},isObject$1(d)?d:getTheme(d),{columnWidthRatio:u})),a}function interval(a){var r=a.options,e=r.xField,n=r.yField,o=r.interval,s=r.seriesField,l=r.tooltip,c=r.minColumnWidth,u=r.maxColumnWidth,f=r.columnBackground,d=r.dodgePadding,g=r.intervalPadding,p=r.useDeferredLabel,v=getTooltipMapping(l,[e,n,s]),m=v.fields,y=v.formatter,x=(o?geometry$x(deepAssign({},a,{options:{type:"interval",colorField:s,tooltipFields:m,mapping:__assign$8({tooltip:y},o),args:{dodgePadding:d,intervalPadding:g,minColumnWidth:c,maxColumnWidth:u,background:f,useDeferredLabel:p}}})):a).ext;return otherAdaptor(__assign$8(__assign$8({},a),{ext:x}))}function line(a){var r=a.options,e=r.line,n=r.stepType,o=r.xField,s=r.yField,l=r.seriesField,c=r.smooth,u=r.connectNulls,f=r.tooltip,d=r.useDeferredLabel,g=getTooltipMapping(f,[o,s,l]),p=g.fields,v=g.formatter;return e?geometry$x(deepAssign({},a,{options:{type:"line",colorField:l,tooltipFields:p,mapping:deepMix({shape:n||(c?"smooth":"line"),tooltip:v},e),args:{connectNulls:u,useDeferredLabel:d}}})):a}function point(a){var r=a.options,e=r.point,n=r.xField,o=r.yField,s=r.seriesField,l=r.sizeField,c=r.shapeField,u=r.tooltip,f=r.useDeferredLabel,d=getTooltipMapping(u,[n,o,s,l,c]),g=d.fields,p=d.formatter;return e?geometry$x(deepAssign({},a,{options:{type:"point",colorField:s,shapeField:c,tooltipFields:g,mapping:__assign$8({tooltip:p},e),args:{useDeferredLabel:f}}})):a}function polygon(a){var r=a.options,e=r.polygon,n=r.xField,o=r.yField,s=r.seriesField,l=r.tooltip,c=r.useDeferredLabel,u=getTooltipMapping(l,[n,o,s]),f=u.fields,d=u.formatter;return e?geometry$x(deepAssign({},a,{options:{type:"polygon",colorField:s,tooltipFields:f,mapping:__assign$8({tooltip:d},e),args:{useDeferredLabel:c}}})):a}function schema(a){var r=a.options,e=r.schema,n=r.xField,o=r.yField,s=r.seriesField,l=r.tooltip,c=r.useDeferredLabel,u=getTooltipMapping(l,[n,o,s]),f=u.fields,d=u.formatter;return e?geometry$x(deepAssign({},a,{options:{type:"schema",colorField:s,tooltipFields:f,mapping:__assign$8({tooltip:d},e),args:{useDeferredLabel:c}}})):a}function violin(a){var r=a.options,e=r.violin,n=r.xField,o=r.yField,s=r.seriesField,l=r.sizeField,c=r.tooltip,u=getTooltipMapping(c,[n,o,s,l]),f=u.fields,d=u.formatter;return e?geometry$x(deepAssign({},a,{options:{type:"violin",colorField:s,tooltipFields:f,mapping:__assign$8({tooltip:d},e)}})):a}var lib={},sensorPool={},id={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var r=1,e=function(){return"".concat(r++)};a.default=e})(id);var sensors={},object={},debounce={};(function(a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var r=function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:60,s=null;return function(){for(var l=this,c=arguments.length,u=new Array(c),f=0;f<c;f++)u[f]=arguments[f];clearTimeout(s),s=setTimeout(function(){n.apply(l,u)},o)}};a.default=r})(debounce);var constant$2={};Object.defineProperty(constant$2,"__esModule",{value:!0});constant$2.SizeSensorId=constant$2.SensorTabIndex=constant$2.SensorClassName=void 0;var SizeSensorId="size-sensor-id";constant$2.SizeSensorId=SizeSensorId;var SensorClassName="size-sensor-object";constant$2.SensorClassName=SensorClassName;var SensorTabIndex="-1";constant$2.SensorTabIndex=SensorTabIndex;Object.defineProperty(object,"__esModule",{value:!0});object.createSensor=void 0;var _debounce$1=_interopRequireDefault$2(debounce),_constant$2=constant$2;function _interopRequireDefault$2(a){return a&&a.__esModule?a:{default:a}}var createSensor$2=function a(r,e){var n=void 0,o=[],s=function(){getComputedStyle(r).position==="static"&&(r.style.position="relative");var g=document.createElement("object");return g.onload=function(){g.contentDocument.defaultView.addEventListener("resize",l),l()},g.style.display="block",g.style.position="absolute",g.style.top="0",g.style.left="0",g.style.height="100%",g.style.width="100%",g.style.overflow="hidden",g.style.pointerEvents="none",g.style.zIndex="-1",g.style.opacity="0",g.setAttribute("class",_constant$2.SensorClassName),g.setAttribute("tabindex",_constant$2.SensorTabIndex),g.type="text/html",r.appendChild(g),g.data="about:blank",g},l=(0,_debounce$1.default)(function(){o.forEach(function(d){d(r)})}),c=function(g){n||(n=s()),o.indexOf(g)===-1&&o.push(g)},u=function(){n&&n.parentNode&&(n.contentDocument&&n.contentDocument.defaultView.removeEventListener("resize",l),n.parentNode.removeChild(n),r.removeAttribute(_constant$2.SizeSensorId),n=void 0,o=[],e&&e())},f=function(g){var p=o.indexOf(g);p!==-1&&o.splice(p,1),o.length===0&&n&&u()};return{element:r,bind:c,destroy:u,unbind:f}};object.createSensor=createSensor$2;var resizeObserver={};Object.defineProperty(resizeObserver,"__esModule",{value:!0});resizeObserver.createSensor=void 0;var _constant$1=constant$2,_debounce=_interopRequireDefault$1(debounce);function _interopRequireDefault$1(a){return a&&a.__esModule?a:{default:a}}var createSensor$1=function a(r,e){var n=void 0,o=[],s=(0,_debounce.default)(function(){o.forEach(function(d){d(r)})}),l=function(){var g=new ResizeObserver(s);return g.observe(r),s(),g},c=function(g){n||(n=l()),o.indexOf(g)===-1&&o.push(g)},u=function(){n.disconnect(),o=[],n=void 0,r.removeAttribute(_constant$1.SizeSensorId),e&&e()},f=function(g){var p=o.indexOf(g);p!==-1&&o.splice(p,1),o.length===0&&n&&u()};return{element:r,bind:c,destroy:u,unbind:f}};resizeObserver.createSensor=createSensor$1;Object.defineProperty(sensors,"__esModule",{value:!0});sensors.createSensor=void 0;var _object=object,_resizeObserver=resizeObserver,createSensor=typeof ResizeObserver<"u"?_resizeObserver.createSensor:_object.createSensor;sensors.createSensor=createSensor;Object.defineProperty(sensorPool,"__esModule",{value:!0});sensorPool.removeSensor=sensorPool.getSensor=sensorPool.Sensors=void 0;var _id=_interopRequireDefault(id),_sensors=sensors,_constant=constant$2;function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var Sensors={};sensorPool.Sensors=Sensors;function clean(a){a&&Sensors[a]&&delete Sensors[a]}var getSensor=function a(r){var e=r.getAttribute(_constant.SizeSensorId);if(e&&Sensors[e])return Sensors[e];var n=(0,_id.default)();r.setAttribute(_constant.SizeSensorId,n);var o=(0,_sensors.createSensor)(r,function(){return clean(n)});return Sensors[n]=o,o};sensorPool.getSensor=getSensor;var removeSensor=function a(r){var e=r.element.getAttribute(_constant.SizeSensorId);r.destroy(),clean(e)};sensorPool.removeSensor=removeSensor;Object.defineProperty(lib,"__esModule",{value:!0});lib.ver=lib.clear=bind_1=lib.bind=void 0;var _sensorPool=sensorPool,bind=function a(r,e){var n=(0,_sensorPool.getSensor)(r);return n.bind(e),function(){n.unbind(e)}},bind_1=lib.bind=bind,clear=function a(r){var e=(0,_sensorPool.getSensor)(r);(0,_sensorPool.removeSensor)(e)};lib.clear=clear;var ver="1.0.2";lib.ver=ver;var SOURCE_ATTRIBUTE_NAME="data-chart-source-type",PLOT_CONTAINER_OPTIONS=["padding","appendPadding","renderer","pixelRatio","syncViewPadding","supportCSSTransform","limitInPlot"],Plot=function(a){__extends$7(r,a);function r(e,n){var o=a.call(this)||this;return o.container=typeof e=="string"?document.getElementById(e):e,o.options=deepAssign({},o.getDefaultOptions(),n),o.createG2(),o.bindEvents(),o}return r.getDefaultOptions=function(){return{renderer:"canvas",xAxis:{nice:!0,label:{autoRotate:!1,autoHide:{type:"equidistance",cfg:{minGap:6}}}},yAxis:{nice:!0,label:{autoHide:!0,autoRotate:!1}},animation:!0}},r.prototype.createG2=function(){var e=this.options,n=e.width,o=e.height,s=e.defaultInteractions;this.chart=new Chart(__assign$8(__assign$8(__assign$8(__assign$8({container:this.container,autoFit:!1},this.getChartSize(n,o)),{localRefresh:!1}),pick(this.options,PLOT_CONTAINER_OPTIONS)),{defaultInteractions:s})),this.container.setAttribute(SOURCE_ATTRIBUTE_NAME,"G2Plot")},r.prototype.getChartSize=function(e,n){var o=getContainerSize(this.container);return{width:e||o.width||400,height:n||o.height||400}},r.prototype.bindEvents=function(){var e=this;this.chart&&this.chart.on("*",function(n){n!=null&&n.type&&e.emit(n.type,n)})},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.render=function(){this.chart.clear(),this.chart.options={data:[],animate:!0},this.chart.views=[],this.execAdaptor(),this.chart.render(),this.bindSizeSensor()},r.prototype.update=function(e){this.updateOption(e),this.render()},r.prototype.updateOption=function(e){this.options=deepAssign({},this.options,e)},r.prototype.setState=function(e,n,o){o===void 0&&(o=!0);var s=getAllElementsRecursively(this.chart);each$1(s,function(l){n(l.getData())&&l.setState(e,o)})},r.prototype.getStates=function(){var e=getAllElementsRecursively(this.chart),n=[];return each$1(e,function(o){var s=o.getData(),l=o.getStates();each$1(l,function(c){n.push({data:s,state:c,geometry:o.geometry,element:o})})}),n},r.prototype.changeData=function(e){this.update({data:e})},r.prototype.changeSize=function(e,n){this.chart.changeSize(e,n)},r.prototype.addAnnotations=function(e,n){n=n||this.chart;var o=__spreadArray$2([],e,!0),s=n.getController("annotation"),l=s.getComponents().map(function(f){return f.extra});s.clear(!0);for(var c=function(f){var d=l[f],g=o.findIndex(function(p){return p.id&&p.id===d.id});g!==-1&&(d=deepAssign({},d,o[g]),o.splice(g,1)),s.annotation(d)},u=0;u<l.length;u++)c(u);o.forEach(function(f){return s.annotation(f)}),n.render(!0)},r.prototype.removeAnnotations=function(e){var n=this.chart.getController("annotation"),o=n.getComponents().map(function(c){return c.extra});n.clear(!0);for(var s=function(c){var u=o[c];e.find(function(f){return f.id&&f.id===u.id})||n.annotation(u)},l=0;l<o.length;l++)s(l);this.chart.render(!0)},r.prototype.destroy=function(){this.unbindSizeSensor(),this.chart.destroy(),this.off(),this.container.removeAttribute(SOURCE_ATTRIBUTE_NAME)},r.prototype.execAdaptor=function(){var e=this.getSchemaAdaptor(),n=this.options,o=n.padding,s=n.appendPadding;this.chart.padding=o,this.chart.appendPadding=s,e({chart:this.chart,options:this.options})},r.prototype.triggerResize=function(){this.chart.forceFit()},r.prototype.bindSizeSensor=function(){var e=this;if(!this.unbind){var n=this.options.autoFit,o=n===void 0?!0:n;o&&(this.unbind=bind_1(this.container,function(){var s=getContainerSize(e.container),l=s.width,c=s.height;(l!==e.chart.width||c!==e.chart.height)&&e.triggerResize()}))}},r.prototype.unbindSizeSensor=function(){this.unbind&&(this.unbind(),this.unbind=void 0)},r}(EventEmitter$3);function percent(a,r,e,n){var o=reduce(a,function(s,l){var c=l[e],u=s.has(c)?s.get(c):0,f=l[r];return u=isRealNumber(f)?u+f:u,s.set(c,u),s},new Map);return map$2(a,function(s){var l,c=s[r],u=s[e],f=isRealNumber(c)&&o.get(u)!==0?c/o.get(u):0;return __assign$8(__assign$8({},s),(l={},l[n]=f,l))})}function getDeepPercent(a,r,e,n){var o=reduce(a,function(s,l){var c=reduce(e,function(d,g){return"".concat(d).concat(l[g])},""),u=s.has(c)?s.get(c):0,f=l[r];return u=isRealNumber(f)?u+f:u,s.set(c,u),s},new Map);return map$2(a,function(s){var l,c=s[r],u=reduce(e,function(d,g){return"".concat(d).concat(s[g])},""),f=isRealNumber(c)&&o.get(u)!==0?c/o.get(u):0;return __assign$8(__assign$8({},s),(l={},l[n]=f,l))})}function getDataWhetherPercentage(a,r,e,n,o){return o?percent(a,r,e,n):a}function geometry$w(a){var r=a.chart,e=a.options,n=e.data,o=e.color,s=e.lineStyle,l=e.lineShape,c=e.point,u=e.area,f=e.seriesField,d=c==null?void 0:c.state,g=u==null?void 0:u.state;r.data(n);var p=deepAssign({},a,{options:{shapeField:f,line:{color:o,style:s,shape:l},point:c&&__assign$8({color:o,shape:"circle"},c),area:u&&__assign$8({color:o},u),label:void 0}}),v=deepAssign({},p,{options:{tooltip:!1,state:d}}),m=deepAssign({},p,{options:{tooltip:!1,state:g}});return line(p),point(v),area(m),a}function meta$l(a){var r,e,n=a.options,o=n.xAxis,s=n.yAxis,l=n.xField,c=n.yField,u=n.data;return flow(scale$2((r={},r[l]=o,r[c]=s,r),(e={},e[l]={type:"cat"},e[c]=adjustYMetaByZero(u,c),e)))(a)}function coordinate$9(a){var r=a.chart,e=a.options,n=e.reflect;if(n){var o=n;isArray$4(o)||(o=[o]);var s=o.map(function(l){return["reflect",l]});r.coordinate({type:"rect",actions:s})}return a}function axis$k(a){var r=a.chart,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField,l=e.yField;return n===!1?r.axis(s,!1):r.axis(s,n),o===!1?r.axis(l,!1):r.axis(l,o),a}function legend$f(a){var r=a.chart,e=a.options,n=e.legend,o=e.seriesField;return n&&o?r.legend(o,n):n===!1&&r.legend(!1),a}function label$f(a){var r=a.chart,e=a.options,n=e.label,o=e.yField,s=findGeometry(r,"line");if(!n)s.label(!1);else{var l=n.callback,c=__rest$1(n,["callback"]);s.label({fields:[o],callback:l,cfg:__assign$8({layout:[{type:"limit-in-plot"},{type:"path-adjust-position"},{type:"point-adjust-position"},{type:"limit-in-plot",cfg:{action:"hide"}}]},transformLabel(c))})}return a}function adjust$1(a){var r=a.chart,e=a.options,n=e.isStack;return n&&each$1(r.geometries,function(o){o.adjust("stack")}),a}function adaptor$y(a){return flow(geometry$w,meta$l,adjust$1,theme$2,coordinate$9,axis$k,legend$f,tooltip$9,label$f,slider$2,scrollbar,interaction$8,animation$5,annotation$2(),limitInPlot$2)(a)}function geometry$v(a){var r=a.chart,e=a.options,n=e.data,o=e.areaStyle,s=e.areaShape,l=e.color,c=e.point,u=e.line,f=e.isPercent,d=e.xField,g=e.yField,p=e.tooltip,v=e.seriesField,m=e.startOnZero,y=c==null?void 0:c.state,x=getDataWhetherPercentage(n,g,d,g,f);r.data(x);var _=f?__assign$8({formatter:function(T){return{name:T[v]||T[d],value:(Number(T[g])*100).toFixed(2)+"%"}}},p):p,E=deepAssign({},a,{options:{area:{color:l,style:o,shape:s},point:c&&__assign$8({color:l},c),tooltip:_,label:void 0,args:{startOnZero:m}}}),S={chart:r,options:deepAssign({line:{size:2}},omit$1(e,["state"]),{line:u&&__assign$8({color:l},u),sizeField:v,state:u==null?void 0:u.state,tooltip:!1,label:void 0,args:{startOnZero:m}})},A=deepAssign({},E,{options:{tooltip:!1,state:y}});return area(E),line(S),point(A),a}function label$e(a){var r=a.chart,e=a.options,n=e.label,o=e.yField,s=findGeometry(r,"area");if(!n)s.label(!1);else{var l=n.callback,c=__rest$1(n,["callback"]);s.label({fields:[o],callback:l,cfg:__assign$8({layout:[{type:"limit-in-plot"},{type:"path-adjust-position"},{type:"point-adjust-position"},{type:"limit-in-plot",cfg:{action:"hide"}}]},transformLabel(c))})}return a}function adjust(a){var r=a.chart,e=a.options,n=e.isStack,o=e.isPercent,s=e.seriesField;return(o||n)&&s&&each$1(r.geometries,function(l){l.adjust("stack")}),a}function adaptor$x(a){return flow(theme$2,pattern("areaStyle"),transformations("rect"),geometry$v,meta$l,adjust,axis$k,legend$f,tooltip$9,label$e,slider$2,annotation$2(),interaction$8,animation$5,limitInPlot$2)(a)}var DEFAULT_OPTIONS$z=deepAssign({},Plot.getDefaultOptions(),{tooltip:{shared:!0,showMarkers:!0,showCrosshairs:!0,crosshairs:{type:"x"}},isStack:!0,line:{},legend:{position:"top-left",radio:{}}}),Area=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="area",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$z},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.changeData=function(e){this.updateOption({data:e});var n=this.options,o=n.isPercent,s=n.xField,l=n.yField,c=this,u=c.chart,f=c.options;meta$l({chart:u,options:f}),this.chart.changeData(getDataWhetherPercentage(e,l,s,l,o))},r.prototype.getSchemaAdaptor=function(){return adaptor$x},r}(Plot),PADDING_RIGHT=10,PADDING_TOP$1=5,BUTTON_ACTION_CONFIG={padding:[8,10],text:"reset",textStyle:{default:{x:0,y:0,fontSize:12,fill:"#333333",cursor:"pointer"}},buttonStyle:{default:{fill:"#f7f7f7",stroke:"#cccccc",cursor:"pointer"},active:{fill:"#e6e6e6"}}},ButtonAction=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.buttonGroup=null,e.buttonCfg=__assign$8({name:"button"},BUTTON_ACTION_CONFIG),e}return r.prototype.getButtonCfg=function(){var e=this.context.view,n=get(e,["interactions","filter-action","cfg","buttonConfig"]);return deepAssign(this.buttonCfg,n,this.cfg)},r.prototype.drawButton=function(){var e=this.getButtonCfg(),n=this.context.view.foregroundGroup.addGroup({name:e.name}),o=this.drawText(n);this.drawBackground(n,o.getBBox()),this.buttonGroup=n},r.prototype.drawText=function(e){var n,o=this.getButtonCfg();return e.addShape({type:"text",name:"button-text",attrs:__assign$8({text:o.text},(n=o.textStyle)===null||n===void 0?void 0:n.default)})},r.prototype.drawBackground=function(e,n){var o,s=this.getButtonCfg(),l=normalPadding(s.padding),c=e.addShape({type:"rect",name:"button-rect",attrs:__assign$8({x:n.x-l[3],y:n.y-l[0],width:n.width+l[1]+l[3],height:n.height+l[0]+l[2]},(o=s.buttonStyle)===null||o===void 0?void 0:o.default)});return c.toBack(),e.on("mouseenter",function(){var u;c.attr((u=s.buttonStyle)===null||u===void 0?void 0:u.active)}),e.on("mouseleave",function(){var u;c.attr((u=s.buttonStyle)===null||u===void 0?void 0:u.default)}),c},r.prototype.resetPosition=function(){var e=this.context.view,n=e.getCoordinate(),o=n.convert({x:1,y:1}),s=this.buttonGroup,l=s.getBBox(),c=Util.transform(null,[["t",o.x-l.width-PADDING_RIGHT,o.y+l.height+PADDING_TOP$1]]);s.setMatrix(c)},r.prototype.show=function(){this.buttonGroup||this.drawButton(),this.resetPosition(),this.buttonGroup.show()},r.prototype.hide=function(){this.buttonGroup&&this.buttonGroup.hide()},r.prototype.destroy=function(){var e=this.buttonGroup;e&&e.remove(),a.prototype.destroy.call(this)},r}(Action);registerAction("brush-reset-button",ButtonAction,{name:"brush-reset-button"});registerInteraction("filter-action",{});function isPointInView(a){return a.isInPlot()}function getInteractionCfg(a,r,e){var n=e||{},o=n.mask,s=n.isStartEnable,l=r||"rect";switch(a){case"brush":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:s||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:s||isPointInView,action:["brush:start","".concat(l,"-mask:start"),"".concat(l,"-mask:show")],arg:[null,{maskStyle:o==null?void 0:o.style}]}],processing:[{trigger:"mousemove",isEnable:isPointInView,action:["".concat(l,"-mask:resize")]}],end:[{trigger:"mouseup",isEnable:isPointInView,action:["brush:filter","brush:end","".concat(l,"-mask:end"),"".concat(l,"-mask:hide"),"brush-reset-button:show"]}],rollback:[{trigger:"brush-reset-button:click",action:["brush:reset","brush-reset-button:hide","cursor:crosshair"]}]};case"brush-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:s||function(){return!0}},{trigger:"plot:mousemove",action:"cursor:crosshair",isEnable:s||function(){return!0}},{trigger:"plot:mousemove",action:"cursor:default",isEnable:function(c){return s?!s(c):!1}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:s||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:s||function(c){return!c.isInShape("mask")},action:["".concat(l,"-mask:start"),"".concat(l,"-mask:show")],arg:[{maskStyle:o==null?void 0:o.style}]},{trigger:"mask:dragstart",action:["".concat(l,"-mask:moveStart")]}],processing:[{trigger:"plot:mousemove",action:["".concat(l,"-mask:resize")]},{trigger:"mask:drag",action:["".concat(l,"-mask:move")]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["".concat(l,"-mask:end")]},{trigger:"mask:dragend",action:["".concat(l,"-mask:moveEnd")]},{trigger:"document:mouseup",isEnable:function(c){return!c.isInPlot()},action:["element-range-highlight:clear","".concat(l,"-mask:end"),"".concat(l,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","".concat(l,"-mask:hide")]}]};case"brush-x":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:s||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:s||isPointInView,action:["brush-x:start","".concat(l,"-mask:start"),"".concat(l,"-mask:show")],arg:[null,{maskStyle:o==null?void 0:o.style}]}],processing:[{trigger:"mousemove",isEnable:isPointInView,action:["".concat(l,"-mask:resize")]}],end:[{trigger:"mouseup",isEnable:isPointInView,action:["brush-x:filter","brush-x:end","".concat(l,"-mask:end"),"".concat(l,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["brush-x:reset"]}]};case"brush-x-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:s||function(){return!0}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:s||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:s||function(c){return!c.isInShape("mask")},action:["".concat(l,"-mask:start"),"".concat(l,"-mask:show")],arg:[{maskStyle:o==null?void 0:o.style}]},{trigger:"mask:dragstart",action:["".concat(l,"-mask:moveStart")]}],processing:[{trigger:"plot:mousemove",action:["".concat(l,"-mask:resize")]},{trigger:"mask:drag",action:["".concat(l,"-mask:move")]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["".concat(l,"-mask:end")]},{trigger:"mask:dragend",action:["".concat(l,"-mask:moveEnd")]},{trigger:"document:mouseup",isEnable:function(c){return!c.isInPlot()},action:["element-range-highlight:clear","".concat(l,"-mask:end"),"".concat(l,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","".concat(l,"-mask:hide")]}]};case"brush-y":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:s||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"}],start:[{trigger:"mousedown",isEnable:s||isPointInView,action:["brush-y:start","".concat(l,"-mask:start"),"".concat(l,"-mask:show")],arg:[null,{maskStyle:o==null?void 0:o.style}]}],processing:[{trigger:"mousemove",isEnable:isPointInView,action:["".concat(l,"-mask:resize")]}],end:[{trigger:"mouseup",isEnable:isPointInView,action:["brush-y:filter","brush-y:end","".concat(l,"-mask:end"),"".concat(l,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["brush-y:reset"]}]};case"brush-y-highlight":return{showEnable:[{trigger:"plot:mouseenter",action:"cursor:crosshair",isEnable:s||function(){return!0}},{trigger:"mask:mouseenter",action:"cursor:move",isEnable:s||function(){return!0}},{trigger:"plot:mouseleave",action:"cursor:default"},{trigger:"mask:mouseleave",action:"cursor:crosshair"}],start:[{trigger:"plot:mousedown",isEnable:s||function(c){return!c.isInShape("mask")},action:["".concat(l,"-mask:start"),"".concat(l,"-mask:show")],arg:[{maskStyle:o==null?void 0:o.style}]},{trigger:"mask:dragstart",action:["".concat(l,"-mask:moveStart")]}],processing:[{trigger:"plot:mousemove",action:["".concat(l,"-mask:resize")]},{trigger:"mask:drag",action:["".concat(l,"-mask:move")]},{trigger:"mask:change",action:["element-range-highlight:highlight"]}],end:[{trigger:"plot:mouseup",action:["".concat(l,"-mask:end")]},{trigger:"mask:dragend",action:["".concat(l,"-mask:moveEnd")]},{trigger:"document:mouseup",isEnable:function(c){return!c.isInPlot()},action:["element-range-highlight:clear","".concat(l,"-mask:end"),"".concat(l,"-mask:hide")]}],rollback:[{trigger:"dblclick",action:["element-range-highlight:clear","".concat(l,"-mask:hide")]}]};default:return{}}}registerInteraction("brush",getInteractionCfg("brush"));registerInteraction("brush-highlight",getInteractionCfg("brush-highlight"));registerInteraction("brush-x",getInteractionCfg("brush-x","x-rect"));registerInteraction("brush-y",getInteractionCfg("brush-y","y-rect"));registerInteraction("brush-x-highlight",getInteractionCfg("brush-x-highlight","x-rect"));registerInteraction("brush-y-highlight",getInteractionCfg("brush-y-highlight","y-rect"));var BRUSH_TYPES=["brush","brush-x","brush-y","brush-highlight","brush-x-highlight","brush-y-highlight"];function brushInteraction(a){var r=a.options,e=r.brush,n=filter(r.interactions||[],function(o){return BRUSH_TYPES.indexOf(o.type)===-1});return e!=null&&e.enabled&&(BRUSH_TYPES.forEach(function(o){var s=!1;switch(e.type){case"x-rect":s=o===(e.action==="highlight"?"brush-x-highlight":"brush-x");break;case"y-rect":s=o===(e.action==="highlight"?"brush-y-highlight":"brush-y");break;default:s=o===(e.action==="highlight"?"brush-highlight":"brush");break}var l={type:o,enable:s};e&&(l.cfg=getInteractionCfg(o,e.type,e)),n.push(l)}),(e==null?void 0:e.action)!=="highlight"&&n.push({type:"filter-action",cfg:{buttonConfig:e.button}})),deepAssign({},a,{options:{interactions:n}})}var INTERACTION_MAP={hover:"__interval-connected-area-hover__",click:"__interval-connected-area-click__"},getStartStages=function(a,r){return a==="hover"?[{trigger:"interval:mouseenter",action:["element-highlight-by-color:highlight","element-link-by-color:link"],arg:[null,{style:r}]}]:[{trigger:"interval:click",action:["element-highlight-by-color:clear","element-highlight-by-color:highlight","element-link-by-color:clear","element-link-by-color:unlink","element-link-by-color:link"],arg:[null,null,null,null,{style:r}]}]};registerInteraction(INTERACTION_MAP.hover,{start:getStartStages(INTERACTION_MAP.hover),end:[{trigger:"interval:mouseleave",action:["element-highlight-by-color:reset","element-link-by-color:unlink"]}]});registerInteraction(INTERACTION_MAP.click,{start:getStartStages(INTERACTION_MAP.click),end:[{trigger:"document:mousedown",action:["element-highlight-by-color:clear","element-link-by-color:clear"]}]});function connectedArea(a){return a===void 0&&(a=!1),function(r){var e=r.chart,n=r.options,o=n.connectedArea,s=function(){e.removeInteraction(INTERACTION_MAP.hover),e.removeInteraction(INTERACTION_MAP.click)};if(!a&&o){var l=o.trigger||"hover";s(),e.interaction(INTERACTION_MAP[l],{start:getStartStages(l,o.style)})}else s();return r}}function conversionTagFormatter(a,r){return!isNumber$2(a)||!isNumber$2(r)||a===0&&r===0?"-":a===r?"100%":a===0?"∞":"".concat((100*r/a).toFixed(2),"%")}function getConversionTagOptionsWithDefaults(a,r){return deepAssign({size:r?32:80,spacing:r?8:12,offset:r?32:0,arrow:a.arrow!==!1&&{headSize:12,style:{fill:"rgba(0, 0, 0, 0.05)"}},text:a.text!==!1&&{style:{fontSize:12,fill:"rgba(0, 0, 0, 0.85)",textAlign:"center",textBaseline:"middle"},formatter:conversionTagFormatter}},a)}function parsePoints(a,r){return map$2(r.getModel().points,function(e){return a.convertPoint(e)})}function renderArrowTag(a,r,e){var n=a.view,o=a.geometry,s=a.group,l=a.options,c=a.horizontal,u=l.offset,f=l.size,d=l.arrow,g=n.getCoordinate(),p=parsePoints(g,r)[3],v=parsePoints(g,e)[0],m=v.y-p.y,y=v.x-p.x;if(typeof d!="boolean"){var x=d.headSize,_=l.spacing,E;c?(y-x)/2<_?(_=Math.max(1,(y-x)/2),E=[[p.x+_,p.y-u],[p.x+_,p.y-u-f],[v.x-_,v.y-u-f/2]]):E=[[p.x+_,p.y-u],[p.x+_,p.y-u-f],[v.x-_-x,v.y-u-f],[v.x-_,v.y-u-f/2],[v.x-_-x,v.y-u]]:(m-x)/2<_?(_=Math.max(1,(m-x)/2),E=[[p.x+u,p.y+_],[p.x+u+f,p.y+_],[v.x+u+f/2,v.y-_]]):E=[[p.x+u,p.y+_],[p.x+u+f,p.y+_],[v.x+u+f,v.y-_-x],[v.x+u+f/2,v.y-_],[v.x+u,v.y-_-x]],s.addShape("polygon",{id:"".concat(n.id,"-conversion-tag-arrow-").concat(o.getElementId(r.getModel().mappingData)),name:"conversion-tag-arrow",origin:{element:r,nextElement:e},attrs:__assign$8(__assign$8({},d.style||{}),{points:E})})}}function renderTextTag(a,r,e){var n,o,s,l=a.view,c=a.geometry,u=a.group,f=a.options,d=a.field,g=a.horizontal,p=f.offset,v=f.size;if(typeof f.text!="boolean"){var m=l.getCoordinate(),y=((n=f.text)===null||n===void 0?void 0:n.formatter)&&((o=f.text)===null||o===void 0?void 0:o.formatter(r.getData()[d],e.getData()[d])),x=parsePoints(m,r)[g?3:0],_=parsePoints(m,e)[g?0:3],E=u.addShape("text",{id:"".concat(l.id,"-conversion-tag-text-").concat(c.getElementId(r.getModel().mappingData)),name:"conversion-tag-text",origin:{element:r,nextElement:e},attrs:__assign$8(__assign$8({},((s=f.text)===null||s===void 0?void 0:s.style)||{}),{text:y,x:g?(x.x+_.x)/2:x.x+p+v/2,y:g?x.y-p-v/2:(x.y+_.y)/2})});if(g){var S=_.x-x.x,A=E.getBBox().width;if(A>S){var T=A/y.length,b=Math.max(1,Math.ceil(S/T)-1),C="".concat(y.slice(0,b),"...");E.attr("text",C)}}}}function renderTag(a,r,e){renderArrowTag(a,r,e),renderTextTag(a,r,e)}function conversionTag$3(a,r,e){return r===void 0&&(r=!0),e===void 0&&(e=!1),function(n){var o=n.options,s=n.chart,l=o.conversionTag,c=o.theme;return l&&!e&&(s.theme(deepAssign({},isObject$1(c)?c:getTheme(c),{columnWidthRatio:1/3})),s.annotation().shape({render:function(u,f){var d=u.addGroup({id:"".concat(s.id,"-conversion-tag-group"),name:"conversion-tag-group"}),g=find$2(s.geometries,function(m){return m.type==="interval"}),p={view:f,geometry:g,group:d,field:a,horizontal:r,options:getConversionTagOptionsWithDefaults(l,r)},v=g.elements;each$1(v,function(m,y){y>0&&renderTag(p,v[y-1],m)})}})),n}}function defaultOptions$6(a){var r=a.options,e=r.legend,n=r.seriesField,o=r.isStack;return n?e!==!1&&(e=__assign$8({position:o?"right-top":"top-left"},e)):e=!1,a.options.legend=e,a}function geometry$u(a){var r=a.chart,e=a.options,n=e.data,o=e.columnStyle,s=e.color,l=e.columnWidthRatio,c=e.isPercent,u=e.isGroup,f=e.isStack,d=e.xField,g=e.yField,p=e.seriesField,v=e.groupField,m=e.tooltip,y=e.shape,x=c&&u&&f?getDeepPercent(n,g,[d,v],g):getDataWhetherPercentage(n,g,d,g,c),_=[];f&&p&&!u?x.forEach(function(A){var T=_.find(function(b){return b[d]===A[d]&&b[p]===A[p]});T?T[g]+=A[g]||0:_.push(__assign$8({},A))}):_=x,r.data(_);var E=c?__assign$8({formatter:function(A){var T;return{name:u&&f?"".concat(A[p]," - ").concat(A[v]):(T=A[p])!==null&&T!==void 0?T:A[d],value:(Number(A[g])*100).toFixed(2)+"%"}}},m):m,S=deepAssign({},a,{options:{data:_,widthRatio:l,tooltip:E,interval:{shape:y,style:o,color:s}}});return interval(S),S}function meta$k(a){var r,e,n=a.options,o=n.xAxis,s=n.yAxis,l=n.xField,c=n.yField,u=n.data,f=n.isPercent,d=f?{max:1,min:0,minLimit:0,maxLimit:1}:{};return flow(scale$2((r={},r[l]=o,r[c]=s,r),(e={},e[l]={type:"cat"},e[c]=__assign$8(__assign$8({},adjustYMetaByZero(u,c)),d),e)))(a)}function axis$j(a){var r=a.chart,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField,l=e.yField;return n===!1?r.axis(s,!1):r.axis(s,n),o===!1?r.axis(l,!1):r.axis(l,o),a}function legend$e(a){var r=a.chart,e=a.options,n=e.legend,o=e.seriesField;return n&&o?r.legend(o,n):n===!1&&r.legend(!1),a}function label$d(a){var r=a.chart,e=a.options,n=e.label,o=e.yField,s=e.isRange,l=findGeometry(r,"interval");if(!n)l.label(!1);else{var c=n.callback,u=__rest$1(n,["callback"]);l.label({fields:[o],callback:c,cfg:__assign$8({layout:u!=null&&u.position?void 0:[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"},{type:"limit-in-plot",cfg:{action:"hide"}}]},transformLabel(s?__assign$8({content:function(f){var d;return(d=f[o])===null||d===void 0?void 0:d.join("-")}},u):u))})}return a}function columnTooltip(a){var r=a.chart,e=a.options,n=e.tooltip,o=e.isGroup,s=e.isStack,l=e.groupField,c=e.data,u=e.xField,f=e.yField,d=e.seriesField;if(n===!1)r.tooltip(!1);else{var g=n;if(o&&s){var p=g.customItems,v=(g==null?void 0:g.formatter)||function(m){return{name:"".concat(m[d]," - ").concat(m[l]),value:m[f]}};g=__assign$8(__assign$8({},g),{customItems:function(m){var y=[];return each$1(m,function(x){var _=filter(c,function(E){return isMatch(E,pick(x.data,[u,d]))});_.forEach(function(E){y.push(__assign$8(__assign$8(__assign$8({},x),{value:E[f],data:E,mappingData:{_origin:E}}),v(E)))})}),p?p(y):y}})}r.tooltip(g)}return a}function adaptor$w(a,r){r===void 0&&(r=!1);var e=a.options,n=e.seriesField;return flow(defaultOptions$6,theme$2,pattern("columnStyle"),state,transformations("rect"),geometry$u,meta$k,axis$j,legend$e,columnTooltip,slider$2,scrollbar,label$d,brushInteraction,interaction$8,animation$5,annotation$2(),conversionTag$3(e.yField,!r,!!n),connectedArea(!e.isStack),limitInPlot$2)(a)}function defaultOptions$5(a){var r=a.options,e=r.xField,n=r.yField,o=r.xAxis,s=r.yAxis,l={left:"bottom",right:"top",top:"left",bottom:"right"},c=s!==!1?__assign$8({position:l[(s==null?void 0:s.position)||"left"]},s):!1,u=o!==!1?__assign$8({position:l[(o==null?void 0:o.position)||"bottom"]},o):!1;return __assign$8(__assign$8({},a),{options:__assign$8(__assign$8({},r),{xField:n,yField:e,xAxis:c,yAxis:u})})}function label$c(a){var r=a.options,e=r.label;return e&&!e.position&&(e.position="left",e.layout||(e.layout=[{type:"interval-adjust-position"},{type:"interval-hide-overlap"},{type:"adjust-color"},{type:"limit-in-plot",cfg:{action:"hide"}}])),deepAssign({},a,{options:{label:e}})}function legend$d(a){var r=a.options,e=r.seriesField,n=r.isStack,o=r.legend;return e?o!==!1&&(o=__assign$8({position:n?"top-left":"right-top"},o||{})):o=!1,deepAssign({},a,{options:{legend:o}})}function coordinate$8(a){var r=a.options,e=[{type:"transpose"},{type:"reflectY"}].concat(r.coordinate||[]);return deepAssign({},a,{options:{coordinate:e}})}function geometry$t(a){var r=a.chart,e=a.options,n=e.barStyle,o=e.barWidthRatio,s=e.minBarWidth,l=e.maxBarWidth,c=e.barBackground;return adaptor$w({chart:r,options:__assign$8(__assign$8({},e),{columnStyle:n,columnWidthRatio:o,minColumnWidth:s,maxColumnWidth:l,columnBackground:c})},!0)}function adaptor$v(a){return flow(defaultOptions$5,label$c,legend$d,tooltip$9,coordinate$8,geometry$t)(a)}var DEFAULT_OPTIONS$y=deepAssign({},Plot.getDefaultOptions(),{barWidthRatio:.6,marginRatio:1/32,tooltip:{shared:!0,showMarkers:!1,offset:20},legend:{radio:{}},interactions:[{type:"active-region"}]}),Bar=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="bar",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$y},r.prototype.changeData=function(e){var n,o;this.updateOption({data:e});var s=this,l=s.chart,c=s.options,u=c.isPercent,f=c.xField,d=c.yField,g=c.xAxis,p=c.yAxis;n=[d,f],f=n[0],d=n[1],o=[p,g],g=o[0],p=o[1];var v=__assign$8(__assign$8({},c),{xField:f,yField:d,yAxis:p,xAxis:g});meta$k({chart:l,options:v}),l.changeData(getDataWhetherPercentage(e,f,d,f,u))},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$v},r}(Plot),DEFAULT_OPTIONS$x=deepAssign({},Plot.getDefaultOptions(),{columnWidthRatio:.6,marginRatio:1/32,tooltip:{shared:!0,showMarkers:!1,offset:20},legend:{radio:{}},interactions:[{type:"active-region"}]}),Column=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="column",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$x},r.prototype.changeData=function(e){this.updateOption({data:e});var n=this.options,o=n.yField,s=n.xField,l=n.isPercent,c=this,u=c.chart,f=c.options;meta$k({chart:u,options:f}),this.chart.changeData(getDataWhetherPercentage(e,o,s,o,l))},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$w},r}(Plot),_a$2,FUNNEL_PERCENT="$$percentage$$",FUNNEL_MAPPING_VALUE="$$mappingValue$$",FUNNEL_CONVERSATION="$$conversion$$",FUNNEL_TOTAL_PERCENT="$$totalPercentage$$",PLOYGON_X="$$x$$",PLOYGON_Y="$$y$$",DEFAULT_OPTIONS$w={appendPadding:[0,80],minSize:0,maxSize:1,meta:(_a$2={},_a$2[FUNNEL_MAPPING_VALUE]={min:0,max:1,nice:!1},_a$2),label:{style:{fill:"#fff",fontSize:12}},tooltip:{showTitle:!1,showMarkers:!1,shared:!1},conversionTag:{offsetX:10,offsetY:0,style:{fontSize:12,fill:"rgba(0,0,0,0.45)"}}},CONVERSION_TAG_NAME="CONVERSION_TAG_NAME";function transformData$8(a,r,e){var n=[],o=e.yField,s=e.maxSize,l=e.minSize,c=get(maxBy(r,o),[o]),u=isNumber$2(s)?s:1,f=isNumber$2(l)?l:0;return n=map$2(a,function(d,g){var p=(d[o]||0)/c;return d[FUNNEL_PERCENT]=p,d[FUNNEL_MAPPING_VALUE]=(u-f)*p+f,d[FUNNEL_CONVERSATION]=[get(a,[g-1,o]),d[o]],d}),n}function conversionTagComponent(a){return function(r){var e=r.chart,n=r.options,o=n.conversionTag,s=n.filteredData,l=s||e.getOptions().data;if(o){var c=o.formatter;l.forEach(function(u,f){if(!(f<=0||Number.isNaN(u[FUNNEL_MAPPING_VALUE]))){var d=a(u,f,l,{top:!0,name:CONVERSION_TAG_NAME,text:{content:isFunction$1(c)?c(u,l):c,offsetX:o.offsetX,offsetY:o.offsetY,position:"end",autoRotate:!1,style:__assign$8({textAlign:"start",textBaseline:"middle"},o.style)}});e.annotation().line(d)}})}return r}}function field$4(a){var r=a.chart,e=a.options,n=e.data,o=n===void 0?[]:n,s=e.yField,l=e.maxSize,c=e.minSize,u=transformData$8(o,o,{yField:s,maxSize:l,minSize:c});return r.data(u),a}function geometry$s(a){var r=a.chart,e=a.options,n=e.xField,o=e.yField,s=e.color,l=e.tooltip,c=e.label,u=e.shape,f=u===void 0?"funnel":u,d=e.funnelStyle,g=e.state,p=getTooltipMapping(l,[n,o]),v=p.fields,m=p.formatter;geometry$x({chart:r,options:{type:"interval",xField:n,yField:FUNNEL_MAPPING_VALUE,colorField:n,tooltipFields:isArray$4(v)&&v.concat([FUNNEL_PERCENT,FUNNEL_CONVERSATION]),mapping:{shape:f,tooltip:m,color:s,style:d},label:c,state:g}});var y=findGeometry(a.chart,"interval");return y.adjust("symmetric"),a}function transpose$2(a){var r=a.chart,e=a.options,n=e.isTransposed;return r.coordinate({type:"rect",actions:n?[]:[["transpose"],["scale",1,-1]]}),a}function conversionTag$2(a){var r=a.options,e=a.chart,n=r.maxSize,o=get(e,["geometries","0","dataArray"],[]),s=get(e,["options","data","length"]),l=map$2(o,function(u){return get(u,["0","nextPoints","0","x"])*s-.5}),c=function(u,f,d,g){var p=n-(n-u[FUNNEL_MAPPING_VALUE])/2;return __assign$8(__assign$8({},g),{start:[l[f-1]||f-.5,p],end:[l[f-1]||f-.5,p+.05]})};return conversionTagComponent(c)(a),a}function basicFunnel(a){return flow(field$4,geometry$s,transpose$2,conversionTag$2)(a)}function field$3(a){var r,e=a.chart,n=a.options,o=n.data,s=o===void 0?[]:o,l=n.yField;return e.data(s),e.scale((r={},r[l]={sync:!0},r)),a}function geometry$r(a){var r=a.chart,e=a.options,n=e.data,o=e.xField,s=e.yField,l=e.color,c=e.compareField,u=e.isTransposed,f=e.tooltip,d=e.maxSize,g=e.minSize,p=e.label,v=e.funnelStyle,m=e.state,y=e.showFacetTitle;return r.facet("mirror",{fields:[c],transpose:!u,padding:u?0:[32,0,0,0],showTitle:y,eachView:function(x,_){var E=u?_.rowIndex:_.columnIndex;u||x.coordinate({type:"rect",actions:[["transpose"],["scale",E===0?-1:1,-1]]});var S=transformData$8(_.data,n,{yField:s,maxSize:d,minSize:g});x.data(S);var A=getTooltipMapping(f,[o,s,c]),T=A.fields,b=A.formatter,C=u?{offset:E===0?10:-23,position:E===0?"bottom":"top"}:{offset:10,position:"left",style:{textAlign:E===0?"end":"start"}};geometry$x({chart:x,options:{type:"interval",xField:o,yField:FUNNEL_MAPPING_VALUE,colorField:o,tooltipFields:isArray$4(T)&&T.concat([FUNNEL_PERCENT,FUNNEL_CONVERSATION]),mapping:{shape:"funnel",tooltip:b,color:l,style:v},label:p===!1?!1:deepAssign({},C,p),state:m}})}}),a}function compareConversionTag(a){var r=a.chart,e=a.index,n=a.options,o=n.conversionTag,s=n.isTransposed;(isNumber$2(e)?[r]:r.views).forEach(function(l,c){var u=get(l,["geometries","0","dataArray"],[]),f=get(l,["options","data","length"]),d=map$2(u,function(p){return get(p,["0","nextPoints","0","x"])*f-.5}),g=function(p,v,m,y){var x=(e||c)===0?-1:1;return deepAssign({},y,{start:[d[v-1]||v-.5,p[FUNNEL_MAPPING_VALUE]],end:[d[v-1]||v-.5,p[FUNNEL_MAPPING_VALUE]+.05],text:s?{style:{textAlign:"start"}}:{offsetX:o!==!1?x*o.offsetX:0,style:{textAlign:(e||c)===0?"end":"start"}}})};conversionTagComponent(g)(deepAssign({},{chart:l,options:n}))})}function conversionTag$1(a){var r=a.chart;return r.once("beforepaint",function(){return compareConversionTag(a)}),a}function compareFunnel(a){return flow(field$3,geometry$r,conversionTag$1)(a)}function field$2(a){var r=a.chart,e=a.options,n=e.data,o=n===void 0?[]:n,s=e.yField,l=reduce(o,function(f,d){return f+(d[s]||0)},0),c=maxBy(o,s)[s],u=map$2(o,function(f,d){var g=[],p=[];if(f[FUNNEL_TOTAL_PERCENT]=(f[s]||0)/l,d){var v=o[d-1][PLOYGON_X],m=o[d-1][PLOYGON_Y];g[0]=v[3],p[0]=m[3],g[1]=v[2],p[1]=m[2]}else g[0]=-.5,p[0]=1,g[1]=.5,p[1]=1;return p[2]=p[1]-f[FUNNEL_TOTAL_PERCENT],g[2]=(p[2]+1)/4,p[3]=p[2],g[3]=-g[2],f[PLOYGON_X]=g,f[PLOYGON_Y]=p,f[FUNNEL_PERCENT]=(f[s]||0)/c,f[FUNNEL_CONVERSATION]=[get(o,[d-1,s]),f[s]],f});return r.data(u),a}function geometry$q(a){var r=a.chart,e=a.options,n=e.xField,o=e.yField,s=e.color,l=e.tooltip,c=e.label,u=e.funnelStyle,f=e.state,d=getTooltipMapping(l,[n,o]),g=d.fields,p=d.formatter;return geometry$x({chart:r,options:{type:"polygon",xField:PLOYGON_X,yField:PLOYGON_Y,colorField:n,tooltipFields:isArray$4(g)&&g.concat([FUNNEL_PERCENT,FUNNEL_CONVERSATION]),label:c,state:f,mapping:{tooltip:p,color:s,style:u}}}),a}function transpose$1(a){var r=a.chart,e=a.options,n=e.isTransposed;return r.coordinate({type:"rect",actions:n?[["transpose"],["reflect","x"]]:[]}),a}function conversionTag(a){var r=function(e,n,o,s){return __assign$8(__assign$8({},s),{start:[e[PLOYGON_X][1],e[PLOYGON_Y][1]],end:[e[PLOYGON_X][1]+.05,e[PLOYGON_Y][1]]})};return conversionTagComponent(r)(a),a}function dynamicHeightFunnel(a){return flow(field$2,geometry$q,transpose$1,conversionTag)(a)}function field$1(a){var r,e=a.chart,n=a.options,o=n.data,s=o===void 0?[]:o,l=n.yField;return e.data(s),e.scale((r={},r[l]={sync:!0},r)),a}function geometry$p(a){var r=a.chart,e=a.options,n=e.seriesField,o=e.isTransposed,s=e.showFacetTitle;return r.facet("rect",{fields:[n],padding:[o?0:32,10,0,10],showTitle:s,eachView:function(l,c){basicFunnel(deepAssign({},a,{chart:l,options:{data:c.data}}))}}),a}function facetFunnel(a){return flow(field$1,geometry$p)(a)}var ConversionTagAction=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.rendering=!1,e}return r.prototype.change=function(e){var n=this;if(!this.rendering){var o=e.seriesField,s=e.compareField,l=s?compareConversionTag:conversionTag$2,c=this.context.view,u=o||s?c.views:[c];map$2(u,function(f,d){var g=f.getController("annotation"),p=filter(get(g,["option"],[]),function(m){var y=m.name;return y!==CONVERSION_TAG_NAME});g.clear(!0),each$1(p,function(m){typeof m=="object"&&f.annotation()[m.type](m)});var v=get(f,["filteredData"],f.getOptions().data);l({chart:f,index:d,options:__assign$8(__assign$8({},e),{filteredData:transformData$8(v,v,e)})}),f.filterData(v),n.rendering=!0,f.render(!0)})}this.rendering=!1},r}(Action),FUNNEL_CONVERSION_TAG="funnel-conversion-tag",FUNNEL_LEGEND_FILTER="funnel-afterrender",interactionStart={trigger:"afterrender",action:"".concat(FUNNEL_CONVERSION_TAG,":change")};registerAction(FUNNEL_CONVERSION_TAG,ConversionTagAction);registerInteraction(FUNNEL_LEGEND_FILTER,{start:[interactionStart]});function defaultOptions$4(a){var r=a.options,e=r.compareField,n=r.xField,o=r.yField,s=r.locale,l=r.funnelStyle,c=r.data,u=getLocale(s),f={label:e?{fields:[n,o,e,FUNNEL_PERCENT,FUNNEL_CONVERSATION],formatter:function(g){return"".concat(g[o])}}:{fields:[n,o,FUNNEL_PERCENT,FUNNEL_CONVERSATION],offset:0,position:"middle",formatter:function(g){return"".concat(g[n]," ").concat(g[o])}},tooltip:{title:n,formatter:function(g){return{name:g[n],value:g[o]}}},conversionTag:{formatter:function(g){return"".concat(u.get(["conversionTag","label"]),": ").concat(conversionTagFormatter.apply(void 0,g[FUNNEL_CONVERSATION]))}}},d;return(e||l)&&(d=function(g){return deepAssign({},e&&{lineWidth:1,stroke:"#fff"},isFunction$1(l)?l(g):l)}),deepAssign({options:f},a,{options:{funnelStyle:d,data:clone(c)}})}function geometry$o(a){var r=a.options,e=r.compareField,n=r.dynamicHeight,o=r.seriesField;return o?facetFunnel(a):e?compareFunnel(a):n?dynamicHeightFunnel(a):basicFunnel(a)}function meta$j(a){var r,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField,l=e.yField;return flow(scale$2((r={},r[s]=n,r[l]=o,r)))(a)}function axis$i(a){var r=a.chart;return r.axis(!1),a}function legend$c(a){var r=a.chart,e=a.options,n=e.legend;return n===!1?r.legend(!1):r.legend(n),a}function interaction$7(a){var r=a.chart,e=a.options,n=e.interactions,o=e.dynamicHeight;return each$1(n,function(s){s.enable===!1?r.removeInteraction(s.type):r.interaction(s.type,s.cfg||{})}),o?r.removeInteraction(FUNNEL_LEGEND_FILTER):r.interaction(FUNNEL_LEGEND_FILTER,{start:[__assign$8(__assign$8({},interactionStart),{arg:e})]}),a}function adaptor$u(a){return flow(defaultOptions$4,geometry$o,meta$j,axis$i,tooltip$9,interaction$7,legend$c,animation$5,theme$2,annotation$2())(a)}var Funnel=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="funnel",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$w},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$u},r.prototype.setState=function(e,n,o){o===void 0&&(o=!0);var s=getAllElementsRecursively(this.chart);each$1(s,function(l){n(l.getData())&&l.setState(e,o)})},r.prototype.getStates=function(){var e=getAllElementsRecursively(this.chart),n=[];return each$1(e,function(o){var s=o.getData(),l=o.getStates();each$1(l,function(c){n.push({data:s,state:c,geometry:o.geometry,element:o})})}),n},r.CONVERSATION_FIELD=FUNNEL_CONVERSATION,r.PERCENT_FIELD=FUNNEL_PERCENT,r.TOTAL_PERCENT_FIELD=FUNNEL_TOTAL_PERCENT,r}(Plot),_a$1,RANGE_VALUE="range",RANGE_TYPE="type",PERCENT="percent",DEFAULT_COLOR$1="#f0f0f0",INDICATEOR_VIEW_ID="indicator-view",RANGE_VIEW_ID="range-view",DEFAULT_OPTIONS$v={percent:0,range:{ticks:[]},innerRadius:.9,radius:.95,startAngle:-7/6*Math.PI,endAngle:1/6*Math.PI,syncViewPadding:!0,axis:{line:null,label:{offset:-24,style:{textAlign:"center",textBaseline:"middle"}},subTickLine:{length:-8},tickLine:{length:-12},grid:null},indicator:{pointer:{style:{lineWidth:5,lineCap:"round"}},pin:{style:{r:9.75,lineWidth:4.5,fill:"#fff"}}},statistic:{title:!1},meta:(_a$1={},_a$1[RANGE_VALUE]={sync:"v"},_a$1[PERCENT]={sync:"v",tickCount:5,tickInterval:.2},_a$1),animation:!1};function processRangeData(a,r){return a.map(function(e,n){var o;return o={},o[RANGE_VALUE]=e-(a[n-1]||0),o[RANGE_TYPE]="".concat(n),o[PERCENT]=r,o})}function getIndicatorData(a){var r;return[(r={},r[PERCENT]=clamp(a,0,1),r)]}function getRangeData(a,r){var e=get(r,["ticks"],[]),n=size(e)?uniq$2(e):[0,clamp(a,0,1),1];return n[0]||n.shift(),processRangeData(n,a)}function geometry$n(a){var r=a.chart,e=a.options,n=e.percent,o=e.range,s=e.radius,l=e.innerRadius,c=e.startAngle,u=e.endAngle,f=e.axis,d=e.indicator,g=e.gaugeStyle,p=e.type,v=e.meter,m=o.color,y=o.width;if(d){var x=getIndicatorData(n),_=r.createView({id:INDICATEOR_VIEW_ID});_.data(x),_.point().position("".concat(PERCENT,"*1")).shape(d.shape||"gauge-indicator").customInfo({defaultColor:r.getTheme().defaultColor,indicator:d}),_.coordinate("polar",{startAngle:c,endAngle:u,radius:l*s}),_.axis(PERCENT,f),_.scale(PERCENT,pick(f,AXIS_META_CONFIG_KEYS))}var E=getRangeData(n,e.range),S=r.createView({id:RANGE_VIEW_ID});S.data(E);var A=isString$1(m)?[m,DEFAULT_COLOR$1]:m,T=interval({chart:S,options:{xField:"1",yField:RANGE_VALUE,seriesField:RANGE_TYPE,rawFields:[PERCENT],isStack:!0,interval:{color:A,style:g,shape:p==="meter"?"meter-gauge":null},args:{zIndexReversed:!0,sortZIndex:!0},minColumnWidth:y,maxColumnWidth:y}}).ext,b=T.geometry;return b.customInfo({meter:v}),S.coordinate("polar",{innerRadius:l,radius:s,startAngle:c,endAngle:u}).transpose(),a}function meta$i(a){var r;return flow(scale$2((r={range:{min:0,max:1,maxLimit:1,minLimit:0}},r[PERCENT]={},r)))(a)}function statistic$2(a,r){var e=a.chart,n=a.options,o=n.statistic,s=n.percent;if(e.getController("annotation").clear(!0),o){var l=o.content,c=void 0;l&&(c=deepAssign({},{content:"".concat((s*100).toFixed(2),"%"),style:{opacity:.75,fontSize:"30px",lineHeight:1,textAlign:"center",color:"rgba(44,53,66,0.85)"}},l)),renderGaugeStatistic(e,{statistic:__assign$8(__assign$8({},o),{content:c})},{percent:s})}return r&&e.render(!0),a}function tooltip$8(a){var r=a.chart,e=a.options,n=e.tooltip;return n?r.tooltip(deepAssign({showTitle:!1,showMarkers:!1,containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',domStyles:{"g2-tooltip":{padding:"4px 8px",fontSize:"10px"}},customContent:function(o,s){var l=get(s,[0,"data",PERCENT],0);return"".concat((l*100).toFixed(2),"%")}},n)):r.tooltip(!1),a}function other(a){var r=a.chart;return r.legend(!1),a}function adaptor$t(a){return flow(theme$2,animation$5,geometry$n,meta$i,tooltip$8,statistic$2,interaction$8,annotation$2(),other)(a)}registerShape("point","gauge-indicator",{draw:function(a,r){var e=a.customInfo,n=e.indicator,o=e.defaultColor,s=n,l=s.pointer,c=s.pin,u=r.addGroup(),f=this.parsePoint({x:0,y:0});return l&&u.addShape("line",{name:"pointer",attrs:__assign$8({x1:f.x,y1:f.y,x2:a.x,y2:a.y,stroke:o},l.style)}),c&&u.addShape("circle",{name:"pin",attrs:__assign$8({x:f.x,y:f.y,stroke:o},c.style)}),u}});registerShape("interval","meter-gauge",{draw:function(a,r){var e=a.customInfo.meter,n=e===void 0?{}:e,o=n.steps,s=o===void 0?50:o,l=n.stepRatio,c=l===void 0?.5:l;s=s<1?1:s,c=clamp(c,0,1);var u=this.coordinate,f=u.startAngle,d=u.endAngle,g=0;if(c>0&&c<1){var p=d-f;g=p/s/(c/(1-c)+1-1/s)}for(var v=g/(1-c)*c,m=r.addGroup(),y=this.coordinate.getCenter(),x=this.coordinate.getRadius(),_=Util.getAngle(a,this.coordinate),E=_.startAngle,S=_.endAngle,A=E;A<S;){var T=void 0,b=(A-f)%(v+g);b<v?T=A+(v-b):(A+=v+g-b,T=A+v);var C=Util.getSectorPath(y.x,y.y,x,A,Math.min(T,S),x*this.coordinate.innerRadius);m.addShape("path",{name:"meter-gauge",attrs:{path:C,fill:a.color,stroke:a.color,lineWidth:.5}}),A=T+g}return m}});var Gauge=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="gauge",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$v},r.prototype.changeData=function(e){this.chart.emit(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,Event$1.fromData(this.chart,VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:e});var n=this.chart.views.find(function(s){return s.id===INDICATEOR_VIEW_ID});n&&n.data(getIndicatorData(e));var o=this.chart.views.find(function(s){return s.id===RANGE_VIEW_ID});o&&o.data(getRangeData(e,this.options.range)),statistic$2({chart:this.chart,options:this.options},!0),this.chart.emit(VIEW_LIFE_CIRCLE.AFTER_CHANGE_DATA,Event$1.fromData(this.chart,VIEW_LIFE_CIRCLE.AFTER_CHANGE_DATA,null))},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$t},r}(Plot);function getBinKey(a,r,e){if(e===1)return[0,r];var n=Math.floor(a/r);return[r*n,r*(n+1)]}function sturges(a){return Math.ceil(Math.log(a.length)/Math.LN2)+1}function binHistogram(a,r,e,n,o){var s=clone(a);sortBy(s,r);var l=valuesOfKey(s,r),c=getRange(l),u=c.max-c.min,f=e;if(!e&&n&&(f=n>1?u/(n-1):c.max),!e&&!n){var d=sturges(l);f=u/d}var g={},p=groupBy(s,o);isEmpty(p)?each$1(s,function(m){var y=m[r],x=getBinKey(y,f,n),_="".concat(x[0],"-").concat(x[1]);has(g,_)||(g[_]={range:x,count:0}),g[_].count+=1}):Object.keys(p).forEach(function(m){each$1(p[m],function(y){var x=y[r],_=getBinKey(x,f,n),E="".concat(_[0],"-").concat(_[1]),S="".concat(E,"-").concat(m);has(g,S)||(g[S]={range:_,count:0},g[S][o]=m),g[S].count+=1})});var v=[];return each$1(g,function(m){v.push(m)}),v}var HISTOGRAM_X_FIELD="range",HISTOGRAM_Y_FIELD="count",DEFAULT_OPTIONS$u=deepAssign({},Plot.getDefaultOptions(),{columnStyle:{stroke:"#FFFFFF"},tooltip:{shared:!0,showMarkers:!1},interactions:[{type:"active-region"}]});function geometry$m(a){var r=a.chart,e=a.options,n=e.data,o=e.binField,s=e.binNumber,l=e.binWidth,c=e.color,u=e.stackField,f=e.legend,d=e.columnStyle,g=binHistogram(n,o,l,s,u);r.data(g);var p=deepAssign({},a,{options:{xField:HISTOGRAM_X_FIELD,yField:HISTOGRAM_Y_FIELD,seriesField:u,isStack:!0,interval:{color:c,style:d}}});return interval(p),f&&u?r.legend(u,f):r.legend(!1),a}function meta$h(a){var r,e=a.options,n=e.xAxis,o=e.yAxis;return flow(scale$2((r={},r[HISTOGRAM_X_FIELD]=n,r[HISTOGRAM_Y_FIELD]=o,r)))(a)}function axis$h(a){var r=a.chart,e=a.options,n=e.xAxis,o=e.yAxis;return n===!1?r.axis(HISTOGRAM_X_FIELD,!1):r.axis(HISTOGRAM_X_FIELD,n),o===!1?r.axis(HISTOGRAM_Y_FIELD,!1):r.axis(HISTOGRAM_Y_FIELD,o),a}function label$b(a){var r=a.chart,e=a.options,n=e.label,o=findGeometry(r,"interval");if(!n)o.label(!1);else{var s=n.callback,l=__rest$1(n,["callback"]);o.label({fields:[HISTOGRAM_Y_FIELD],callback:s,cfg:transformLabel(l)})}return a}function adaptor$s(a){return flow(theme$2,pattern("columnStyle"),geometry$m,meta$h,axis$h,state,label$b,tooltip$9,interaction$8,animation$5)(a)}var Histogram=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="histogram",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$u},r.prototype.changeData=function(e){this.updateOption({data:e});var n=this.options,o=n.binField,s=n.binNumber,l=n.binWidth,c=n.stackField;this.chart.changeData(binHistogram(e,o,l,s,c))},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$s},r}(Plot),DEFAULT_OPTIONS$t=deepAssign({},Plot.getDefaultOptions(),{tooltip:{shared:!0,showMarkers:!0,showCrosshairs:!0,crosshairs:{type:"x"}},legend:{position:"top-left",radio:{}},isStack:!1}),MarkerActiveAction=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.active=function(){var e=this.getView(),n=this.context.event;if(n.data){var o=n.data.items,s=e.geometries.filter(function(l){return l.type==="point"});each$1(s,function(l){each$1(l.elements,function(c){var u=findIndex$1(o,function(f){return f.data===c.data})!==-1;c.setState("active",u)})})}},r.prototype.reset=function(){var e=this.getView(),n=e.geometries.filter(function(o){return o.type==="point"});each$1(n,function(o){each$1(o.elements,function(s){s.setState("active",!1)})})},r.prototype.getView=function(){return this.context.view},r}(Action);registerAction("marker-active",MarkerActiveAction);registerInteraction("marker-active",{start:[{trigger:"tooltip:show",action:"marker-active:active"}],end:[{trigger:"tooltip:hide",action:"marker-active:reset"}]});var Line=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="line",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$t},r.prototype.changeData=function(e){this.updateOption({data:e});var n=this,o=n.chart,s=n.options;meta$l({chart:o,options:s}),this.chart.changeData(e)},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$y},r}(Plot),DEFAULT_OPTIONS$s=deepAssign({},Plot.getDefaultOptions(),{legend:{position:"right",radio:{}},tooltip:{shared:!1,showTitle:!1,showMarkers:!1},label:{layout:{type:"limit-in-plot",cfg:{action:"ellipsis"}}},pieStyle:{stroke:"white",lineWidth:1},statistic:{title:{style:{fontWeight:300,color:"#4B535E",textAlign:"center",fontSize:"20px",lineHeight:1}},content:{style:{fontWeight:"bold",color:"rgba(44,53,66,0.85)",textAlign:"center",fontSize:"32px",lineHeight:1}}},theme:{components:{annotation:{text:{animate:!1}}}}}),ORIGIN_MATRIX=[1,0,0,0,1,0,0,0,1];function transform$2(a,r){var e=r?__spreadArray$2([],r,!0):__spreadArray$2([],ORIGIN_MATRIX,!0);return Util.transform(e,a)}var PieLegendAction=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getActiveElements=function(){var e=Util.getDelegationObject(this.context);if(e){var n=this.context.view,o=e.component,s=e.item,l=o.get("field");if(l){var c=n.geometries[0].elements;return c.filter(function(u){return u.getModel().data[l]===s.value})}}return[]},r.prototype.getActiveElementLabels=function(){var e=this.context.view,n=this.getActiveElements(),o=e.geometries[0].labelsContainer.getChildren();return o.filter(function(s){return n.find(function(l){return isEqual$1(l.getData(),s.get("data"))})})},r.prototype.transfrom=function(e){e===void 0&&(e=7.5);var n=this.getActiveElements(),o=this.getActiveElementLabels();n.forEach(function(s,l){var c=o[l],u=s.geometry.coordinate;if(u.isPolar&&u.isTransposed){var f=Util.getAngle(s.getModel(),u),d=f.startAngle,g=f.endAngle,p=(d+g)/2,v=e,m=v*Math.cos(p),y=v*Math.sin(p);s.shape.setMatrix(transform$2([["t",m,y]])),c.setMatrix(transform$2([["t",m,y]]))}})},r.prototype.active=function(){this.transfrom()},r.prototype.reset=function(){this.transfrom(0)},r}(Action);function getCurrentElement(a){var r=a.event,e,n=r.target;return n&&(e=n.get("element")),e}var StatisticAction=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getAnnotations=function(e){var n=e||this.context.view;return n.getController("annotation").option},r.prototype.getInitialAnnotation=function(){return this.initialAnnotation},r.prototype.init=function(){var e=this,n=this.context.view;n.removeInteraction("tooltip"),n.on("afterchangesize",function(){var o=e.getAnnotations(n);e.initialAnnotation=o})},r.prototype.change=function(e){var n=this.context,o=n.view,s=n.event;this.initialAnnotation||(this.initialAnnotation=this.getAnnotations());var l=get(s,["data","data"]);if(s.type.match("legend-item")){var c=Util.getDelegationObject(this.context),u=o.getGroupedFields()[0];if(c&&u){var f=c.item;l=o.getData().find(function(v){return v[u]===f.value})}}if(l){var d=get(e,"annotations",[]),g=get(e,"statistic",{});o.getController("annotation").clear(!0),each$1(d,function(v){typeof v=="object"&&o.annotation()[v.type](v)}),renderStatistic(o,{statistic:g,plotType:"pie"},l),o.render(!0)}var p=getCurrentElement(this.context);p&&p.shape.toFront()},r.prototype.reset=function(){var e=this.context.view,n=e.getController("annotation");n.clear(!0);var o=this.getInitialAnnotation();each$1(o,function(s){e.annotation()[s.type](s)}),e.render(!0)},r}(Action),PIE_STATISTIC="pie-statistic";registerAction(PIE_STATISTIC,StatisticAction);registerInteraction("pie-statistic-active",{start:[{trigger:"element:mouseenter",action:"pie-statistic:change"}],end:[{trigger:"element:mouseleave",action:"pie-statistic:reset"}]});registerAction("pie-legend",PieLegendAction);registerInteraction("pie-legend-active",{start:[{trigger:"legend-item:mouseenter",action:"pie-legend:active"}],end:[{trigger:"legend-item:mouseleave",action:"pie-legend:reset"}]});function getTotalValue(a,r){var e=null;return each$1(a,function(n){typeof n[r]=="number"&&(e+=n[r])}),e}function adaptOffset(a,r){var e;switch(a){case"inner":return e="-30%",isString$1(r)&&r.endsWith("%")?parseFloat(r)*.01>0?e:r:r<0?r:e;case"outer":return e=12,isString$1(r)&&r.endsWith("%")?parseFloat(r)*.01<0?e:r:r>0?r:e;default:return r}}function isAllZero(a,r){return every(processIllegalData(a,r),function(e){return e[r]===0})}function geometry$l(a){var r=a.chart,e=a.options,n=e.data,o=e.angleField,s=e.colorField,l=e.color,c=e.pieStyle,u=e.shape,f=processIllegalData(n,o);if(isAllZero(f,o)){var d="$$percentage$$";f=f.map(function(p){var v;return __assign$8(__assign$8({},p),(v={},v[d]=1/f.length,v))}),r.data(f);var g=deepAssign({},a,{options:{xField:"1",yField:d,seriesField:s,isStack:!0,interval:{color:l,shape:u,style:c},args:{zIndexReversed:!0,sortZIndex:!0}}});interval(g)}else{r.data(f);var g=deepAssign({},a,{options:{xField:"1",yField:o,seriesField:s,isStack:!0,interval:{color:l,shape:u,style:c},args:{zIndexReversed:!0,sortZIndex:!0}}});interval(g)}return a}function meta$g(a){var r,e=a.chart,n=a.options,o=n.meta,s=n.colorField,l=deepAssign({},o);return e.scale(l,(r={},r[s]={type:"cat"},r)),a}function coordinate$7(a){var r=a.chart,e=a.options,n=e.radius,o=e.innerRadius,s=e.startAngle,l=e.endAngle;return r.coordinate({type:"theta",cfg:{radius:n,innerRadius:o,startAngle:s,endAngle:l}}),a}function label$a(a){var r=a.chart,e=a.options,n=e.label,o=e.colorField,s=e.angleField,l=r.geometries[0];if(!n)l.label(!1);else{var c=n.callback,u=__rest$1(n,["callback"]),f=transformLabel(u);if(f.content){var d=f.content;f.content=function(m,y,x){var _=m[o],E=m[s],S=r.getScaleByField(s),A=S==null?void 0:S.scale(E);return isFunction$1(d)?d(__assign$8(__assign$8({},m),{percent:A}),y,x):isString$1(d)?template(d,{value:E,name:_,percentage:isNumber$2(A)&&!isNil(E)?"".concat((A*100).toFixed(2),"%"):null}):d}}var g={inner:"",outer:"pie-outer",spider:"pie-spider"},p=f.type?g[f.type]:"pie-outer",v=f.layout?isArray$4(f.layout)?f.layout:[f.layout]:[];f.layout=(p?[{type:p}]:[]).concat(v),l.label({fields:o?[s,o]:[s],callback:c,cfg:__assign$8(__assign$8({},f),{offset:adaptOffset(f.type,f.offset),type:"pie"})})}return a}function transformStatisticOptions(a){var r=a.innerRadius,e=a.statistic,n=a.angleField,o=a.colorField,s=a.meta,l=a.locale,c=getLocale(l);if(r&&e){var u=deepAssign({},DEFAULT_OPTIONS$s.statistic,e),f=u.title,d=u.content;return f!==!1&&(f=deepAssign({},{formatter:function(g){var p=g?g[o]:isNil(f.content)?c.get(["statistic","total"]):f.content,v=get(s,[o,"formatter"])||function(m){return m};return v(p)}},f)),d!==!1&&(d=deepAssign({},{formatter:function(g,p){var v=g?g[n]:getTotalValue(p,n),m=get(s,[n,"formatter"])||function(y){return y};return g||isNil(d.content)?m(v):d.content}},d)),deepAssign({},{statistic:{title:f,content:d}},a)}return a}function pieAnnotation(a){var r=a.chart,e=a.options,n=transformStatisticOptions(e),o=n.innerRadius,s=n.statistic;return r.getController("annotation").clear(!0),flow(annotation$2())(a),o&&s&&renderStatistic(r,{statistic:s,plotType:"pie"}),a}function tooltip$7(a){var r=a.chart,e=a.options,n=e.tooltip,o=e.colorField,s=e.angleField,l=e.data;if(n===!1)r.tooltip(n);else if(r.tooltip(deepAssign({},n,{shared:!1})),isAllZero(l,s)){var c=get(n,"fields"),u=get(n,"formatter");isEmpty(get(n,"fields"))&&(c=[o,s],u=u||function(f){return{name:f[o],value:toString$2(f[s])}}),r.geometries[0].tooltip(c.join("*"),getMappingFunction(c,u))}return a}function interaction$6(a){var r=a.chart,e=a.options,n=transformStatisticOptions(e),o=n.interactions,s=n.statistic,l=n.annotations;return each$1(o,function(c){var u,f;if(c.enable===!1)r.removeInteraction(c.type);else if(c.type==="pie-statistic-active"){var d=[];!((u=c.cfg)===null||u===void 0)&&u.start||(d=[{trigger:"element:mouseenter",action:"".concat(PIE_STATISTIC,":change"),arg:{statistic:s,annotations:l}}]),each$1((f=c.cfg)===null||f===void 0?void 0:f.start,function(g){d.push(__assign$8(__assign$8({},g),{arg:{statistic:s,annotations:l}}))}),r.interaction(c.type,deepAssign({},c.cfg,{start:d}))}else r.interaction(c.type,c.cfg||{})}),a}function adaptor$r(a){return flow(pattern("pieStyle"),geometry$l,meta$g,theme$2,coordinate$7,legend$g,tooltip$7,label$a,state,pieAnnotation,interaction$6,animation$5)(a)}var Pie=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="pie",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$s},r.prototype.changeData=function(e){this.chart.emit(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,Event$1.fromData(this.chart,VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,null));var n=this.options,o=this.options.angleField,s=processIllegalData(n.data,o),l=processIllegalData(e,o);isAllZero(s,o)||isAllZero(l,o)?this.update({data:e}):(this.updateOption({data:e}),this.chart.data(l),pieAnnotation({chart:this.chart,options:this.options}),this.chart.render(!0)),this.chart.emit(VIEW_LIFE_CIRCLE.AFTER_CHANGE_DATA,Event$1.fromData(this.chart,VIEW_LIFE_CIRCLE.AFTER_CHANGE_DATA,null))},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$r},r}(Plot),DEFAULT_COLOR=["#FAAD14","#E8EDF3"],DEFAULT_OPTIONS$r={percent:.2,color:DEFAULT_COLOR,animation:{}};function getProgressData(a){var r=clamp(isRealNumber(a)?a:0,0,1);return[{current:"".concat(r),type:"current",percent:r},{current:"".concat(r),type:"target",percent:1}]}function geometry$k(a){var r=a.chart,e=a.options,n=e.percent,o=e.progressStyle,s=e.color,l=e.barWidthRatio;r.data(getProgressData(n));var c=deepAssign({},a,{options:{xField:"current",yField:"percent",seriesField:"type",widthRatio:l,interval:{style:o,color:isString$1(s)?[s,DEFAULT_COLOR[1]]:s},args:{zIndexReversed:!0,sortZIndex:!0}}});return interval(c),r.tooltip(!1),r.axis(!1),r.legend(!1),a}function coordinate$6(a){var r=a.chart;return r.coordinate("rect").transpose(),a}function adaptor$q(a){return flow(geometry$k,scale$2({}),coordinate$6,animation$5,theme$2,annotation$2())(a)}var Progress=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="process",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$r},r.prototype.changeData=function(e){this.updateOption({percent:e}),this.chart.changeData(getProgressData(e))},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$q},r}(Plot);function coordinate$5(a){var r=a.chart,e=a.options,n=e.innerRadius,o=e.radius;return r.coordinate("theta",{innerRadius:n,radius:o}),a}function statistic$1(a,r){var e=a.chart,n=a.options,o=n.innerRadius,s=n.statistic,l=n.percent,c=n.meta;if(e.getController("annotation").clear(!0),o&&s){var u=get(c,["percent","formatter"])||function(d){return"".concat((d*100).toFixed(2),"%")},f=s.content;f&&(f=deepAssign({},f,{content:isNil(f.content)?u(l):f.content})),renderStatistic(e,{statistic:__assign$8(__assign$8({},s),{content:f}),plotType:"ring-progress"},{percent:l})}return r&&e.render(!0),a}function adaptor$p(a){return flow(geometry$k,scale$2({}),coordinate$5,statistic$1,animation$5,theme$2,annotation$2())(a)}var DEFAULT_OPTIONS$q={percent:.2,innerRadius:.8,radius:.98,color:["#FAAD14","#E8EDF3"],statistic:{title:!1,content:{style:{fontSize:"14px",fontWeight:300,fill:"#4D4D4D",textAlign:"center",textBaseline:"middle"}}},animation:{}},RingProgress=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="ring-process",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$q},r.prototype.changeData=function(e){this.chart.emit(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,Event$1.fromData(this.chart,VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:e}),this.chart.data(getProgressData(e)),statistic$1({chart:this.chart,options:this.options},!0),this.chart.emit(VIEW_LIFE_CIRCLE.AFTER_CHANGE_DATA,Event$1.fromData(this.chart,VIEW_LIFE_CIRCLE.AFTER_CHANGE_DATA,null))},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$p},r}(Plot);function _slicedToArray(a,r){return _arrayWithHoles(a)||_iterableToArrayLimit(a,r)||_nonIterableRest()}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _iterableToArrayLimit(a,r){var e=[],n=!0,o=!1,s=void 0;try{for(var l=a[Symbol.iterator](),c;!(n=(c=l.next()).done)&&(e.push(c.value),!(r&&e.length===r));n=!0);}catch(u){o=!0,s=u}finally{try{!n&&l.return!=null&&l.return()}finally{if(o)throw s}}return e}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function points(a,r,e,n){a=a.filter(function(m,y){var x=r(m,y),_=e(m,y);return x!=null&&isFinite(x)&&_!=null&&isFinite(_)}),n&&a.sort(function(m,y){return r(m)-r(y)});for(var o=a.length,s=new Float64Array(o),l=new Float64Array(o),c=0,u=0,f,d,g,p=0;p<o;)g=a[p],s[p]=f=+r(g,p,a),l[p]=d=+e(g,p,a),++p,c+=(f-c)/p,u+=(d-u)/p;for(var v=0;v<o;++v)s[v]-=c,l[v]-=u;return[s,l,c,u]}function visitPoints(a,r,e,n){for(var o=0,s=0,l=a.length;s<l;s++){var c=a[s],u=+r(c,s,a),f=+e(c,s,a);u!=null&&isFinite(u)&&f!=null&&isFinite(f)&&n(u,f,o++)}}function determination(a,r,e,n,o){var s=0,l=0;return visitPoints(a,r,e,function(c,u){var f=u-o(c),d=u-n;s+=f*f,l+=d*d}),1-s/l}function angle(a){return Math.atan2(a[1][1]-a[0][1],a[1][0]-a[0][0])*180/Math.PI}function midpoint(a){return[(a[0][0]+a[1][0])/2,(a[0][1]+a[1][1])/2]}function interpose(a,r,e){for(var n=Math.log(r-a)*Math.LOG10E+1|0,o=1*Math.pow(10,-n/2-1),s=1e4,l=[u(a),u(r)],c=0;f(l)&&c<s;);return l;function u(d){return[d,e(d)]}function f(d){c++;for(var g=d.length,p=!1,v=0;v<g-1;v++){var m=d[v],y=d[v+1],x=midpoint([m,y]),_=u(x[0]),E=angle([m,x]),S=angle([m,_]),A=Math.abs(E-S);A>o&&(d.splice(v+1,0,_),p=!0)}return p}}function ols(a,r,e,n){var o=n-a*a,s=Math.abs(o)<1e-24?0:(e-a*r)/o,l=r-s*a;return[l,s]}function exponential(){var a=function(s){return s[0]},r=function(s){return s[1]},e;function n(o){var s=0,l=0,c=0,u=0,f=0,d=0,g=e?+e[0]:1/0,p=e?+e[1]:-1/0;visitPoints(o,a,r,function(S,A){var T=Math.log(A),b=S*A;++s,l+=(A-l)/s,u+=(b-u)/s,d+=(S*b-d)/s,c+=(A*T-c)/s,f+=(b*T-f)/s,e||(S<g&&(g=S),S>p&&(p=S))});var v=ols(u/l,c/l,f/l,d/l),m=_slicedToArray(v,2),y=m[0],x=m[1];y=Math.exp(y);var _=function(A){return y*Math.exp(x*A)},E=interpose(g,p,_);return E.a=y,E.b=x,E.predict=_,E.rSquared=determination(o,a,r,l,_),E}return n.domain=function(o){return arguments.length?(e=o,n):e},n.x=function(o){return arguments.length?(a=o,n):a},n.y=function(o){return arguments.length?(r=o,n):r},n}function linear(){var a=function(s){return s[0]},r=function(s){return s[1]},e;function n(o){var s=0,l=0,c=0,u=0,f=0,d=e?+e[0]:1/0,g=e?+e[1]:-1/0;visitPoints(o,a,r,function(E,S){++s,l+=(E-l)/s,c+=(S-c)/s,u+=(E*S-u)/s,f+=(E*E-f)/s,e||(E<d&&(d=E),E>g&&(g=E))});var p=ols(l,c,u,f),v=_slicedToArray(p,2),m=v[0],y=v[1],x=function(S){return y*S+m},_=[[d,x(d)],[g,x(g)]];return _.a=y,_.b=m,_.predict=x,_.rSquared=determination(o,a,r,c,x),_}return n.domain=function(o){return arguments.length?(e=o,n):e},n.x=function(o){return arguments.length?(a=o,n):a},n.y=function(o){return arguments.length?(r=o,n):r},n}function median(a){a.sort(function(e,n){return e-n});var r=a.length/2;return r%1===0?(a[r-1]+a[r])/2:a[Math.floor(r)]}var maxiters=2,epsilon=1e-12;function loess(){var a=function(s){return s[0]},r=function(s){return s[1]},e=.3;function n(o){for(var s=points(o,a,r,!0),l=_slicedToArray(s,4),c=l[0],u=l[1],f=l[2],d=l[3],g=c.length,p=Math.max(2,~~(e*g)),v=new Float64Array(g),m=new Float64Array(g),y=new Float64Array(g).fill(1),x=-1;++x<=maxiters;){for(var _=[0,p-1],E=0;E<g;++E){for(var S=c[E],A=_[0],T=_[1],b=S-c[A]>c[T]-S?A:T,C=0,L=0,R=0,I=0,w=0,M=1/Math.abs(c[b]-S||1),D=A;D<=T;++D){var O=c[D],F=u[D],k=tricube(Math.abs(S-O)*M)*y[D],$=O*k;C+=k,L+=$,R+=F*k,I+=F*$,w+=O*$}var V=ols(L/C,R/C,I/C,w/C),N=_slicedToArray(V,2),B=N[0],G=N[1];v[E]=B+G*S,m[E]=Math.abs(u[E]-v[E]),updateInterval(c,E+1,_)}if(x===maxiters)break;var z=median(m);if(Math.abs(z)<epsilon)break;for(var H=0,W,Y;H<g;++H)W=m[H]/(6*z),y[H]=W>=1?epsilon:(Y=1-W*W)*Y}return output(c,v,f,d)}return n.bandwidth=function(o){return arguments.length?(e=o,n):e},n.x=function(o){return arguments.length?(a=o,n):a},n.y=function(o){return arguments.length?(r=o,n):r},n}function tricube(a){return(a=1-a*a*a)*a*a}function updateInterval(a,r,e){var n=a[r],o=e[0],s=e[1]+1;if(!(s>=a.length))for(;r>o&&a[s]-n<=n-a[o];)e[0]=++o,e[1]=s,++s}function output(a,r,e,n){for(var o=a.length,s=[],l=0,c=0,u=[],f;l<o;++l)f=a[l]+e,u[0]===f?u[1]+=(r[l]-u[1])/++c:(c=0,u[1]+=n,u=[f,r[l]],s.push(u));return u[1]+=n,s}function logarithmic(){var a=function(l){return l[0]},r=function(l){return l[1]},e=Math.E,n;function o(s){var l=0,c=0,u=0,f=0,d=0,g=n?+n[0]:1/0,p=n?+n[1]:-1/0,v=Math.log(e);visitPoints(s,a,r,function(A,T){var b=Math.log(A)/v;++l,c+=(b-c)/l,u+=(T-u)/l,f+=(b*T-f)/l,d+=(b*b-d)/l,n||(A<g&&(g=A),A>p&&(p=A))});var m=ols(c,u,f,d),y=_slicedToArray(m,2),x=y[0],_=y[1],E=function(T){return _*Math.log(T)/v+x},S=interpose(g,p,E);return S.a=_,S.b=x,S.predict=E,S.rSquared=determination(s,a,r,u,E),S}return o.domain=function(s){return arguments.length?(n=s,o):n},o.x=function(s){return arguments.length?(a=s,o):a},o.y=function(s){return arguments.length?(r=s,o):r},o.base=function(s){return arguments.length?(e=s,o):e},o}function quad(){var a=function(s){return s[0]},r=function(s){return s[1]},e;function n(o){var s=points(o,a,r),l=_slicedToArray(s,4),c=l[0],u=l[1],f=l[2],d=l[3],g=c.length,p=0,v=0,m=0,y=0,x=0,_,E,S,A;for(_=0;_<g;)E=c[_],S=u[_++],A=E*E,p+=(A-p)/_,v+=(A*E-v)/_,m+=(A*A-m)/_,y+=(E*S-y)/_,x+=(A*S-x)/_;var T=0,b=0,C=e?+e[0]:1/0,L=e?+e[1]:-1/0;visitPoints(o,a,r,function(k,$){b++,T+=($-T)/b,e||(k<C&&(C=k),k>L&&(L=k))});var R=m-p*p,I=p*R-v*v,w=(x*p-y*v)/I,M=(y*R-x*v)/I,D=-w*p,O=function($){return $=$-f,w*$*$+M*$+D+d},F=interpose(C,L,O);return F.a=w,F.b=M-2*w*f,F.c=D-M*f+w*f*f+d,F.predict=O,F.rSquared=determination(o,a,r,T,O),F}return n.domain=function(o){return arguments.length?(e=o,n):e},n.x=function(o){return arguments.length?(a=o,n):a},n.y=function(o){return arguments.length?(r=o,n):r},n}function polynomial(){var a=function(l){return l[0]},r=function(l){return l[1]},e=3,n;function o(s){if(e===1){var l=linear().x(a).y(r).domain(n)(s);return l.coefficients=[l.b,l.a],delete l.a,delete l.b,l}if(e===2){var c=quad().x(a).y(r).domain(n)(s);return c.coefficients=[c.c,c.b,c.a],delete c.a,delete c.b,delete c.c,c}var u=points(s,a,r),f=_slicedToArray(u,4),d=f[0],g=f[1],p=f[2],v=f[3],m=d.length,y=[],x=[],_=e+1,E=0,S=0,A=n?+n[0]:1/0,T=n?+n[1]:-1/0;visitPoints(s,a,r,function(O,F){++S,E+=(F-E)/S,n||(O<A&&(A=O),O>T&&(T=O))});var b,C,L,R,I;for(b=0;b<_;++b){for(L=0,R=0;L<m;++L)R+=Math.pow(d[L],b)*g[L];for(y.push(R),I=new Float64Array(_),C=0;C<_;++C){for(L=0,R=0;L<m;++L)R+=Math.pow(d[L],b+C);I[C]=R}x.push(I)}x.push(y);var w=gaussianElimination(x),M=function(F){F-=p;var k=v+w[0]+w[1]*F+w[2]*F*F;for(b=3;b<_;++b)k+=w[b]*Math.pow(F,b);return k},D=interpose(A,T,M);return D.coefficients=uncenter(_,w,-p,v),D.predict=M,D.rSquared=determination(s,a,r,E,M),D}return o.domain=function(s){return arguments.length?(n=s,o):n},o.x=function(s){return arguments.length?(a=s,o):a},o.y=function(s){return arguments.length?(r=s,o):r},o.order=function(s){return arguments.length?(e=s,o):e},o}function uncenter(a,r,e,n){var o=Array(a),s,l,c,u;for(s=0;s<a;++s)o[s]=0;for(s=a-1;s>=0;--s)for(c=r[s],u=1,o[s]+=c,l=1;l<=s;++l)u*=(s+1-l)/l,o[s-l]+=c*Math.pow(e,l)*u;return o[0]+=n,o}function gaussianElimination(a){var r=a.length-1,e=[],n,o,s,l,c;for(n=0;n<r;++n){for(l=n,o=n+1;o<r;++o)Math.abs(a[n][o])>Math.abs(a[n][l])&&(l=o);for(s=n;s<r+1;++s)c=a[s][n],a[s][n]=a[s][l],a[s][l]=c;for(o=n+1;o<r;++o)for(s=r;s>=n;s--)a[s][o]-=a[s][n]*a[n][o]/a[n][n]}for(o=r-1;o>=0;--o){for(c=0,s=o+1;s<r;++s)c+=a[s][o]*e[s];e[o]=(a[r][o]-c)/a[o][o]}return e}function power(){var a=function(s){return s[0]},r=function(s){return s[1]},e;function n(o){var s=0,l=0,c=0,u=0,f=0,d=0,g=e?+e[0]:1/0,p=e?+e[1]:-1/0;visitPoints(o,a,r,function(S,A){var T=Math.log(S),b=Math.log(A);++s,l+=(T-l)/s,c+=(b-c)/s,u+=(T*b-u)/s,f+=(T*T-f)/s,d+=(A-d)/s,e||(S<g&&(g=S),S>p&&(p=S))});var v=ols(l,c,u,f),m=_slicedToArray(v,2),y=m[0],x=m[1];y=Math.exp(y);var _=function(A){return y*Math.pow(A,x)},E=interpose(g,p,_);return E.a=y,E.b=x,E.predict=_,E.rSquared=determination(o,a,r,d,_),E}return n.domain=function(o){return arguments.length?(e=o,n):e},n.x=function(o){return arguments.length?(a=o,n):a},n.y=function(o){return arguments.length?(r=o,n):r},n}var REGRESSION_MAP={exp:exponential,linear,loess,log:logarithmic,poly:polynomial,pow:power,quad};function getQuadrantDefaultConfig(a,r){var e=10,n={regionStyle:[{position:{start:[a,"max"],end:["max",r]},style:{fill:"#d8d0c0",opacity:.4}},{position:{start:["min","max"],end:[a,r]},style:{fill:"#a3dda1",opacity:.4}},{position:{start:["min",r],end:[a,"min"]},style:{fill:"#d8d0c0",opacity:.4}},{position:{start:[a,r],end:["max","min"]},style:{fill:"#a3dda1",opacity:.4}}],lineStyle:{stroke:"#9ba29a",lineWidth:1},labelStyle:[{position:["max",r],offsetX:-e,offsetY:-e,style:{textAlign:"right",textBaseline:"bottom",fontSize:14,fill:"#ccc"}},{position:["min",r],offsetX:e,offsetY:-e,style:{textAlign:"left",textBaseline:"bottom",fontSize:14,fill:"#ccc"}},{position:["min",r],offsetX:e,offsetY:e,style:{textAlign:"left",textBaseline:"top",fontSize:14,fill:"#ccc"}},{position:["max",r],offsetX:-e,offsetY:e,style:{textAlign:"right",textBaseline:"top",fontSize:14,fill:"#ccc"}}]};return n}var splinePath=function(a,r){var e=r.view,n=r.options,o=n.xField,s=n.yField,l=e.getScaleByField(o),c=e.getScaleByField(s),u=a.map(function(f){return e.getCoordinate().convert({x:l.scale(f[0]),y:c.scale(f[1])})});return getSplinePath(u,!1)},getPath=function(a){var r=a.options,e=r.xField,n=r.yField,o=r.data,s=r.regressionLine,l=s.type,c=l===void 0?"linear":l,u=s.algorithm,f=s.equation,d,g=null;if(u)d=isArray$4(u)?u:u(o),g=f;else{var p=REGRESSION_MAP[c]().x(function(v){return v[e]}).y(function(v){return v[n]});d=p(o),g=getRegressionEquation(c,d)}return[splinePath(d,a),g]},getMeta=function(a){var r,e=a.meta,n=e===void 0?{}:e,o=a.xField,s=a.yField,l=a.data,c=l[0][o],u=l[0][s],f=c>0,d=u>0;function g(p,v){var m=get(n,[p]);function y(_){return get(m,_)}var x={};return v==="x"?(isNumber$2(c)&&(isNumber$2(y("min"))||(x.min=f?0:c*2),isNumber$2(y("max"))||(x.max=f?c*2:0)),x):(isNumber$2(u)&&(isNumber$2(y("min"))||(x.min=d?0:u*2),isNumber$2(y("max"))||(x.max=d?u*2:0)),x)}return __assign$8(__assign$8({},n),(r={},r[o]=__assign$8(__assign$8({},n[o]),g(o,"x")),r[s]=__assign$8(__assign$8({},n[s]),g(s,"y")),r))};function getRegressionEquation(a,r){var e,n,o,s=function(f,d){return d===void 0&&(d=4),Math.round(f*Math.pow(10,d))/Math.pow(10,d)},l=function(f){return Number.isFinite(f)?s(f):"?"};switch(a){case"linear":return"y = ".concat(l(r.a),"x + ").concat(l(r.b),", R^2 = ").concat(l(r.rSquared));case"exp":return"y = ".concat(l(r.a),"e^(").concat(l(r.b),"x), R^2 = ").concat(l(r.rSquared));case"log":return"y = ".concat(l(r.a),"ln(x) + ").concat(l(r.b),", R^2 = ").concat(l(r.rSquared));case"quad":return"y = ".concat(l(r.a),"x^2 + ").concat(l(r.b),"x + ").concat(l(r.c),", R^2 = ").concat(l(r.rSquared));case"poly":for(var c="y = ".concat(l((e=r.coefficients)===null||e===void 0?void 0:e[0])," + ").concat(l((n=r.coefficients)===null||n===void 0?void 0:n[1]),"x + ").concat(l((o=r.coefficients)===null||o===void 0?void 0:o[2]),"x^2"),u=3;u<r.coefficients.length;++u)c+=" + ".concat(l(r.coefficients[u]),"x^").concat(u);return"".concat(c,", R^2 = ").concat(l(r.rSquared));case"pow":return"y = ".concat(l(r.a),"x^").concat(l(r.b),", R^2 = ").concat(l(r.rSquared))}return null}function transformOptions$1(a){var r=a.data,e=r===void 0?[]:r,n=a.xField,o=a.yField;if(e.length){for(var s=!0,l=!0,c=e[0],u=void 0,f=1;f<e.length&&(u=e[f],c[n]!==u[n]&&(s=!1),c[o]!==u[o]&&(l=!1),!(!s&&!l));f++)c=u;var d=[];s&&d.push(n),l&&d.push(o);var g=pick(getMeta(a),d);return deepAssign({},a,{meta:g})}return a}function geometry$j(a){var r=a.chart,e=a.options,n=e.data,o=e.type,s=e.color,l=e.shape,c=e.pointStyle,u=e.shapeField,f=e.colorField,d=e.xField,g=e.yField,p=e.sizeField,v=e.size,m=e.tooltip;p&&(v||(v=[2,8]),isNumber$2(v)&&(v=[v,v])),m&&!m.fields&&(m=__assign$8(__assign$8({},m),{fields:[d,g,f,p,u]})),r.data(n),point(deepAssign({},a,{options:{seriesField:f,point:{color:s,shape:l,size:v,style:c},tooltip:m}}));var y=findGeometry(r,"point");return o&&y.adjust(o),a}function meta$f(a){var r,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField,l=e.yField,c=transformOptions$1(e);return flow(scale$2((r={},r[s]=n,r[l]=o,r)))(deepAssign({},a,{options:c}))}function axis$g(a){var r=a.chart,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField,l=e.yField;return r.axis(s,n),r.axis(l,o),a}function legend$b(a){var r=a.chart,e=a.options,n=e.legend,o=e.colorField,s=e.shapeField,l=e.sizeField,c=e.shapeLegend,u=e.sizeLegend,f=n!==!1;return o&&r.legend(o,f?n:!1),s&&(c?r.legend(s,c):r.legend(s,c===!1?!1:n)),l&&r.legend(l,u||!1),!f&&!c&&!u&&r.legend(!1),a}function label$9(a){var r=a.chart,e=a.options,n=e.label,o=e.yField,s=findGeometry(r,"point");if(!n)s.label(!1);else{var l=n.callback,c=__rest$1(n,["callback"]);s.label({fields:[o],callback:l,cfg:transformLabel(c)})}return a}function scatterAnnotation(a){var r=a.options,e=r.quadrant,n=[];if(e){var o=e.xBaseline,s=o===void 0?0:o,l=e.yBaseline,c=l===void 0?0:l,u=e.labels,f=e.regionStyle,d=e.lineStyle,g=getQuadrantDefaultConfig(s,c),p=new Array(4).join(",").split(",");p.forEach(function(v,m){n.push(__assign$8(__assign$8({type:"region",top:!1},g.regionStyle[m].position),{style:deepAssign({},g.regionStyle[m].style,f==null?void 0:f[m])}),__assign$8({type:"text",top:!0},deepAssign({},g.labelStyle[m],u==null?void 0:u[m])))}),n.push({type:"line",top:!1,start:["min",c],end:["max",c],style:deepAssign({},g.lineStyle,d)},{type:"line",top:!1,start:[s,"min"],end:[s,"max"],style:deepAssign({},g.lineStyle,d)})}return flow(annotation$2(n))(a)}function regressionLine(a){var r=a.options,e=a.chart,n=r.regressionLine;if(n){var o=n.style,s=n.equationStyle,l=s===void 0?{}:s,c=n.top,u=c===void 0?!1:c,f=n.showEquation,d=f===void 0?!1:f,g={stroke:"#9ba29a",lineWidth:2,opacity:.5},p={x:20,y:20,textAlign:"left",textBaseline:"middle",fontSize:14,fillOpacity:.5};e.annotation().shape({top:u,render:function(v,m){var y=v.addGroup({id:"".concat(e.id,"-regression-line"),name:"regression-line-group"}),x=getPath({view:m,options:r}),_=x[0],E=x[1];y.addShape("path",{name:"regression-line",attrs:__assign$8(__assign$8({path:_},g),o)}),d&&y.addShape("text",{name:"regression-equation",attrs:__assign$8(__assign$8(__assign$8({},p),l),{text:E})})}})}return a}function tooltip$6(a){var r=a.chart,e=a.options,n=e.tooltip;return n?r.tooltip(n):n===!1&&r.tooltip(!1),a}function adaptor$o(a){return flow(geometry$j,meta$f,axis$g,legend$b,tooltip$6,label$9,brushInteraction,slider$2,scrollbar,interaction$8,scatterAnnotation,animation$5,theme$2,regressionLine)(a)}var DEFAULT_OPTIONS$p=deepAssign({},Plot.getDefaultOptions(),{size:4,tooltip:{showTitle:!1,showMarkers:!1,showCrosshairs:!0,crosshairs:{type:"xy"}}});registerInteraction("drag-move",{start:[{trigger:"plot:mousedown",action:"scale-translate:start"}],processing:[{trigger:"plot:mousemove",action:"scale-translate:translate",throttle:{wait:100,leading:!0,trailing:!1}}],end:[{trigger:"plot:mouseup",action:"scale-translate:end"}]});var Scatter=function(a){__extends$7(r,a);function r(e,n){var o=a.call(this,e,n)||this;return o.type="scatter",o.on(VIEW_LIFE_CIRCLE.BEFORE_RENDER,function(s){var l,c,u=o,f=u.options,d=u.chart;if(((l=s.data)===null||l===void 0?void 0:l.source)===EVENTS$1.FILTER){var g=o.chart.filterData(o.chart.getData());meta$f({chart:d,options:__assign$8(__assign$8({},f),{data:g})})}((c=s.data)===null||c===void 0?void 0:c.source)===EVENTS$1.RESET&&meta$f({chart:d,options:f})}),o}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$p},r.prototype.changeData=function(e){this.updateOption(transformOptions$1(deepAssign({},this.options,{data:e})));var n=this,o=n.options,s=n.chart;meta$f({chart:s,options:o}),this.chart.changeData(e)},r.prototype.getSchemaAdaptor=function(){return adaptor$o},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r}(Plot),Y_FIELD$4="$$stock-range$$",TREND_FIELD="trend",TREND_UP="up",TREND_DOWN="down",DEFAULT_TOOLTIP_OPTIONS$2={showMarkers:!1,showCrosshairs:!0,shared:!0,crosshairs:{type:"xy",follow:!0,text:function(a,r,e){var n;if(a==="x"){var o=e[0];n=o?o.title:r}else n=r;return{position:a==="y"?"start":"end",content:n,style:{fill:"#dfdfdf"}}},textBackground:{padding:[2,4],style:{fill:"#666"}}}},DEFAULT_OPTIONS$o=deepAssign({},Plot.getDefaultOptions(),{tooltip:DEFAULT_TOOLTIP_OPTIONS$2,interactions:[{type:"tooltip"}],legend:{position:"top-left"},risingFill:"#ef5350",fallingFill:"#26a69a"});function getStockData(a,r){return map$2(a,function(e){var n=e&&__assign$8({},e);if(isArray$4(r)&&n){var o=r[0],s=r[1],l=r[2],c=r[3];n[TREND_FIELD]=n[o]<=n[s]?TREND_UP:TREND_DOWN,n[Y_FIELD$4]=[n[o],n[s],n[l],n[c]]}return n})}function geometry$i(a){var r=a.chart,e=a.options,n=e.yField,o=e.data,s=e.risingFill,l=e.fallingFill,c=e.tooltip,u=e.stockStyle;r.data(getStockData(o,n));var f=c;return f!==!1&&(f=deepAssign({},{fields:n},f)),schema(deepAssign({},a,{options:{schema:{shape:"candle",color:[s,l],style:u},yField:Y_FIELD$4,seriesField:TREND_FIELD,rawFields:n,tooltip:f}})),a}function meta$e(a){var r,e,n=a.chart,o=a.options,s=o.meta,l=o.xAxis,c=o.yAxis,u=o.xField,f=(r={},r[u]={type:"timeCat",tickCount:6},r[TREND_FIELD]={values:[TREND_UP,TREND_DOWN]},r),d=deepAssign(f,s,(e={},e[u]=pick(l,AXIS_META_CONFIG_KEYS),e[Y_FIELD$4]=pick(c,AXIS_META_CONFIG_KEYS),e));return n.scale(d),a}function axis$f(a){var r=a.chart,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField;return n===!1?r.axis(s,!1):r.axis(s,n),o===!1?r.axis(Y_FIELD$4,!1):r.axis(Y_FIELD$4,o),a}function tooltip$5(a){var r=a.chart,e=a.options,n=e.tooltip;return n!==!1?r.tooltip(n):r.tooltip(!1),a}function legend$a(a){var r=a.chart,e=a.options,n=e.legend;return n?r.legend(TREND_FIELD,n):n===!1&&r.legend(!1),a}function adaptor$n(a){flow(theme$2,geometry$i,meta$e,axis$f,tooltip$5,legend$a,interaction$8,animation$5,annotation$2(),slider$2)(a)}var Stock=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="stock",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$o},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$n},r.prototype.changeData=function(e){this.updateOption({data:e});var n=this.options.yField;this.chart.changeData(getStockData(e,n))},r}(Plot);function getTinyData(a){return map$2(a||[],function(r,e){return{x:"".concat(e),y:r}})}var X_FIELD$3="x",Y_FIELD$3="y",DEFAULT_TOOLTIP_OPTIONS$1={showTitle:!1,shared:!0,showMarkers:!1,customContent:function(a,r){return"".concat(get(r,[0,"data","y"],0))},containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',itemTpl:"<span>{value}</span>",domStyles:{"g2-tooltip":{padding:"2px 4px",fontSize:"10px"}},showCrosshairs:!0,crosshairs:{type:"x"}},DEFAULT_OPTIONS$n={appendPadding:2,tooltip:__assign$8({},DEFAULT_TOOLTIP_OPTIONS$1),animation:{}};function geometry$h(a){var r=a.chart,e=a.options,n=e.data,o=e.color,s=e.areaStyle,l=e.point,c=e.line,u=l==null?void 0:l.state,f=getTinyData(n);r.data(f);var d=deepAssign({},a,{options:{xField:X_FIELD$3,yField:Y_FIELD$3,area:{color:o,style:s},line:c,point:l}}),g=deepAssign({},d,{options:{tooltip:!1}}),p=deepAssign({},d,{options:{tooltip:!1,state:u}});return area(d),line(g),point(p),r.axis(!1),r.legend(!1),a}function meta$d(a){var r,e,n=a.options,o=n.xAxis,s=n.yAxis,l=n.data,c=getTinyData(l);return flow(scale$2((r={},r[X_FIELD$3]=o,r[Y_FIELD$3]=s,r),(e={},e[X_FIELD$3]={type:"cat"},e[Y_FIELD$3]=adjustYMetaByZero(c,Y_FIELD$3),e)))(a)}function adaptor$m(a){return flow(pattern("areaStyle"),geometry$h,meta$d,tooltip$9,theme$2,animation$5,annotation$2())(a)}var DEFAULT_OPTIONS$m={appendPadding:2,tooltip:__assign$8({},DEFAULT_TOOLTIP_OPTIONS$1),color:"l(90) 0:#E5EDFE 1:#ffffff",areaStyle:{fillOpacity:.6},line:{size:1,color:"#5B8FF9"},animation:{}},TinyArea=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="tiny-area",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$m},r.prototype.changeData=function(e){this.updateOption({data:e});var n=this,o=n.chart,s=n.options;meta$d({chart:o,options:s}),o.changeData(getTinyData(e))},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$m},r}(Plot);function geometry$g(a){var r=a.chart,e=a.options,n=e.data,o=e.color,s=e.columnStyle,l=e.columnWidthRatio,c=getTinyData(n);r.data(c);var u=deepAssign({},a,{options:{xField:X_FIELD$3,yField:Y_FIELD$3,widthRatio:l,interval:{style:s,color:o}}});return interval(u),r.axis(!1),r.legend(!1),r.interaction("element-active"),a}function adaptor$l(a){return flow(theme$2,pattern("columnStyle"),geometry$g,meta$d,tooltip$9,animation$5,annotation$2())(a)}var DEFAULT_TOOLTIP_OPTIONS={showTitle:!1,shared:!0,showMarkers:!1,customContent:function(a,r){return"".concat(get(r,[0,"data","y"],0))},containerTpl:'<div class="g2-tooltip"><div class="g2-tooltip-list"></div></div>',itemTpl:"<span>{value}</span>",domStyles:{"g2-tooltip":{padding:"2px 4px",fontSize:"10px"}}},DEFAULT_OPTIONS$l={appendPadding:2,tooltip:__assign$8({},DEFAULT_TOOLTIP_OPTIONS),animation:{}},TinyColumn=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="tiny-column",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$l},r.prototype.changeData=function(e){this.updateOption({data:e});var n=this,o=n.chart,s=n.options;meta$d({chart:o,options:s}),o.changeData(getTinyData(e))},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$l},r}(Plot);function geometry$f(a){var r=a.chart,e=a.options,n=e.data,o=e.color,s=e.lineStyle,l=e.point,c=l==null?void 0:l.state,u=getTinyData(n);r.data(u);var f=deepAssign({},a,{options:{xField:X_FIELD$3,yField:Y_FIELD$3,line:{color:o,style:s},point:l}}),d=deepAssign({},f,{options:{tooltip:!1,state:c}});return line(f),point(d),r.axis(!1),r.legend(!1),a}function adaptor$k(a){return flow(geometry$f,meta$d,theme$2,tooltip$9,animation$5,annotation$2())(a)}var TinyLine=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="tiny-line",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$n},r.prototype.changeData=function(e){this.updateOption({data:e});var n=this,o=n.chart,s=n.options;meta$d({chart:o,options:s}),o.changeData(getTinyData(e))},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$k},r}(Plot),PLOT_ADAPTORS={line:adaptor$y,pie:adaptor$r,column:adaptor$w,bar:adaptor$v,area:adaptor$x,gauge:adaptor$t,"tiny-line":adaptor$k,"tiny-column":adaptor$l,"tiny-area":adaptor$m,"ring-progress":adaptor$p,progress:adaptor$q,scatter:adaptor$o,histogram:adaptor$s,funnel:adaptor$u,stock:adaptor$n},PLOT_CONSTRUCTOR={line:Line,pie:Pie,column:Column,bar:Bar,area:Area,gauge:Gauge,"tiny-line":TinyLine,"tiny-column":TinyColumn,"tiny-area":TinyArea,"ring-progress":RingProgress,progress:Progress,scatter:Scatter,histogram:Histogram,funnel:Funnel,stock:Stock},DEFAULT_OPTIONS_MAP={pie:{label:!1},column:{tooltip:{showMarkers:!1}},bar:{tooltip:{showMarkers:!1}}};function execPlotAdaptor(a,r,e){var n=PLOT_CONSTRUCTOR[a];if(!n){console.error("could not find ".concat(a," plot"));return}var o=PLOT_ADAPTORS[a];o({chart:r,options:deepAssign({},n.getDefaultOptions(),get(DEFAULT_OPTIONS_MAP,a,{}),e)})}function multiView(a){var r=a.chart,e=a.options,n=e.views,o=e.legend;return each$1(n,function(s){var l=s.region,c=s.data,u=s.meta,f=s.axes,d=s.coordinate,g=s.interactions,p=s.annotations,v=s.tooltip,m=s.geometries,y=r.createView({region:l});y.data(c);var x={};f&&each$1(f,function(_,E){x[E]=pick(_,AXIS_META_CONFIG_KEYS)}),x=deepAssign({},u,x),y.scale(x),f?each$1(f,function(_,E){y.axis(E,_)}):y.axis(!1),y.coordinate(d),each$1(m,function(_){var E=geometry$x({chart:y,options:_}).ext,S=_.adjust;S&&E.geometry.adjust(S)}),each$1(g,function(_){_.enable===!1?y.removeInteraction(_.type):y.interaction(_.type,_.cfg)}),each$1(p,function(_){y.annotation()[_.type](__assign$8({},_))}),typeof s.animation=="boolean"?y.animate(!1):(y.animate(!0),each$1(y.geometries,function(_){_.animate(s.animation)})),v&&(y.interaction("tooltip"),y.tooltip(v))}),o?each$1(o,function(s,l){r.legend(l,s)}):r.legend(!1),r.tooltip(e.tooltip),a}function multiPlot(a){var r=a.chart,e=a.options,n=e.plots,o=e.data,s=o===void 0?[]:o;return each$1(n,function(l){var c=l.type,u=l.region,f=l.options,d=f===void 0?{}:f,g=l.top,p=d.tooltip;if(g){execPlotAdaptor(c,r,__assign$8(__assign$8({},d),{data:s}));return}var v=r.createView(__assign$8({region:u},pick(d,PLOT_CONTAINER_OPTIONS)));p&&v.interaction("tooltip"),execPlotAdaptor(c,v,__assign$8({data:s},d))}),a}function slider$1(a){var r=a.chart,e=a.options;return r.option("slider",e.slider),a}function adaptor$j(a){return flow(animation$5,multiView,multiPlot,interaction$8,animation$5,theme$2,tooltip$9,slider$1,annotation$2())(a)}function getElementValue(a,r){var e=a.getModel(),n=e.data,o;return isArray$4(n)?o=n[0][r]:o=n[r],o}function clearHighlight(a){var r=getAllElements(a);each$1(r,function(e){e.hasState("active")&&e.setState("active",!1),e.hasState("selected")&&e.setState("selected",!1),e.hasState("inactive")&&e.setState("inactive",!1)})}var Association=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getAssociationItems=function(e,n){var o,s=this.context.event,l=n||{},c=l.linkField,u=l.dim,f=[];if(!((o=s.data)===null||o===void 0)&&o.data){var d=s.data.data;each$1(e,function(g){var p,v,m=c;if(u==="x"?m=g.getXScale().field:u==="y"?m=(p=g.getYScales().find(function(x){return x.field===m}))===null||p===void 0?void 0:p.field:m||(m=(v=g.getGroupScales()[0])===null||v===void 0?void 0:v.field),!!m){var y=map$2(getAllElements(g),function(x){var _=!1,E=!1,S=isArray$4(d)?get(d[0],m):get(d,m);return getElementValue(x,m)===S?_=!0:E=!0,{element:x,view:g,active:_,inactive:E}});f.push.apply(f,y)}})}return f},r.prototype.showTooltip=function(e){var n=getSiblingViews(this.context.view),o=this.getAssociationItems(n,e);each$1(o,function(s){if(s.active){var l=s.element.shape.getCanvasBBox();s.view.showTooltip({x:l.minX+l.width/2,y:l.minY+l.height/2})}})},r.prototype.hideTooltip=function(){var e=getSiblingViews(this.context.view);each$1(e,function(n){n.hideTooltip()})},r.prototype.active=function(e){var n=getViews(this.context.view),o=this.getAssociationItems(n,e);each$1(o,function(s){var l=s.active,c=s.element;l&&c.setState("active",!0)})},r.prototype.selected=function(e){var n=getViews(this.context.view),o=this.getAssociationItems(n,e);each$1(o,function(s){var l=s.active,c=s.element;l&&c.setState("selected",!0)})},r.prototype.highlight=function(e){var n=getViews(this.context.view),o=this.getAssociationItems(n,e);each$1(o,function(s){var l=s.inactive,c=s.element;l&&c.setState("inactive",!0)})},r.prototype.reset=function(){var e=getViews(this.context.view);each$1(e,function(n){clearHighlight(n)})},r}(Action);registerAction("association",Association);registerInteraction("association-active",{start:[{trigger:"element:mouseenter",action:"association:active"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});registerInteraction("association-selected",{start:[{trigger:"element:mouseenter",action:"association:selected"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});registerInteraction("association-highlight",{start:[{trigger:"element:mouseenter",action:"association:highlight"}],end:[{trigger:"element:mouseleave",action:"association:reset"}]});registerInteraction("association-tooltip",{start:[{trigger:"element:mousemove",action:"association:showTooltip"}],end:[{trigger:"element:mouseleave",action:"association:hideTooltip"}]});var Mix=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="mix",e}return r.prototype.getSchemaAdaptor=function(){return adaptor$j},r}(Plot),Stage;(function(a){a.DEV="DEV",a.BETA="BETA",a.STABLE="STABLE"})(Stage||(Stage={}));function notice(a,r){console.warn(a===Stage.DEV?"Plot '".concat(r,"' is in DEV stage, just give us issues."):a===Stage.BETA?"Plot '".concat(r,"' is in BETA stage, DO NOT use it in production env."):a===Stage.STABLE?"Plot '".concat(r,`' is in STABLE stage, import it by "import { `).concat(r,` } from '@antv/g2plot'".`):"invalid Stage type.")}var Lab=function(){function a(){}return Object.defineProperty(a,"MultiView",{get:function(){return notice(Stage.STABLE,"MultiView"),Mix},enumerable:!1,configurable:!0}),a}(),FIRST_AXES_VIEW="first-axes-view",SECOND_AXES_VIEW="second-axes-view",SERIES_FIELD_KEY="series-field-key";function transformData$7(a,r,e,n,o){var s=[];r.forEach(function(g){n.forEach(function(p){var v,m=(v={},v[a]=p[a],v[e]=g,v[g]=p[g],v);s.push(m)})});var l=Object.values(groupBy(s,e)),c=l[0],u=c===void 0?[]:c,f=l[1],d=f===void 0?[]:f;return o?[u.reverse(),d.reverse()]:[u,d]}function isHorizontal(a){return a!=="vertical"}function syncViewPadding(a,r,e){var n=r[0],o=r[1],s=n.autoPadding,l=o.autoPadding,c=a.__axisPosition,u=c.layout,f=c.position;if(isHorizontal(u)&&f==="top"&&(n.autoPadding=e.instance(s.top,0,s.bottom,s.left),o.autoPadding=e.instance(l.top,s.left,l.bottom,0)),isHorizontal(u)&&f==="bottom"&&(n.autoPadding=e.instance(s.top,s.right/2+5,s.bottom,s.left),o.autoPadding=e.instance(l.top,l.right,l.bottom,s.right/2+5)),!isHorizontal(u)&&f==="bottom"){var d=s.left>=l.left?s.left:l.left;n.autoPadding=e.instance(s.top,s.right,s.bottom/2+5,d),o.autoPadding=e.instance(s.bottom/2+5,l.right,l.bottom,d)}if(!isHorizontal(u)&&f==="top"){var d=s.left>=l.left?s.left:l.left;n.autoPadding=e.instance(s.top,s.right,0,d),o.autoPadding=e.instance(0,l.right,s.top,d)}}function geometry$e(a){var r=a.chart,e=a.options,n=e.data,o=e.xField,s=e.yField,l=e.color,c=e.barStyle,u=e.widthRatio,f=e.legend,d=e.layout,g=transformData$7(o,s,SERIES_FIELD_KEY,n,isHorizontal(d));f?r.legend(SERIES_FIELD_KEY,f):f===!1&&r.legend(!1);var p,v,m=g[0],y=g[1];isHorizontal(d)?(p=r.createView({region:{start:{x:0,y:0},end:{x:.5,y:1}},id:FIRST_AXES_VIEW}),p.coordinate().transpose().reflect("x"),v=r.createView({region:{start:{x:.5,y:0},end:{x:1,y:1}},id:SECOND_AXES_VIEW}),v.coordinate().transpose(),p.data(m),v.data(y)):(p=r.createView({region:{start:{x:0,y:0},end:{x:1,y:.5}},id:FIRST_AXES_VIEW}),v=r.createView({region:{start:{x:0,y:.5},end:{x:1,y:1}},id:SECOND_AXES_VIEW}),v.coordinate().reflect("y"),p.data(m),v.data(y));var x=deepAssign({},a,{chart:p,options:{widthRatio:u,xField:o,yField:s[0],seriesField:SERIES_FIELD_KEY,interval:{color:l,style:c}}});interval(x);var _=deepAssign({},a,{chart:v,options:{xField:o,yField:s[1],seriesField:SERIES_FIELD_KEY,widthRatio:u,interval:{color:l,style:c}}});return interval(_),a}function meta$c(a){var r,e,n,o=a.options,s=a.chart,l=o.xAxis,c=o.yAxis,u=o.xField,f=o.yField,d=findViewById(s,FIRST_AXES_VIEW),g=findViewById(s,SECOND_AXES_VIEW),p={};return keys((o==null?void 0:o.meta)||{}).map(function(v){get(o==null?void 0:o.meta,[v,"alias"])&&(p[v]=o.meta[v].alias)}),s.scale((r={},r[SERIES_FIELD_KEY]={sync:!0,formatter:function(v){return get(p,v,v)}},r)),scale$2((e={},e[u]=l,e[f[0]]=c[f[0]],e))(deepAssign({},a,{chart:d})),scale$2((n={},n[u]=l,n[f[1]]=c[f[1]],n))(deepAssign({},a,{chart:g})),a}function axis$e(a){var r=a.chart,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField,l=e.yField,c=e.layout,u=findViewById(r,FIRST_AXES_VIEW),f=findViewById(r,SECOND_AXES_VIEW);return(n==null?void 0:n.position)==="bottom"?f.axis(s,__assign$8(__assign$8({},n),{label:{formatter:function(){return""}}})):f.axis(s,!1),n===!1?u.axis(s,!1):u.axis(s,__assign$8({position:isHorizontal(c)?"top":"bottom"},n)),o===!1?(u.axis(l[0],!1),f.axis(l[1],!1)):(u.axis(l[0],o[l[0]]),f.axis(l[1],o[l[1]])),r.__axisPosition={position:u.getOptions().axes[s].position,layout:c},a}function interaction$5(a){var r=a.chart;return interaction$8(deepAssign({},a,{chart:findViewById(r,FIRST_AXES_VIEW)})),interaction$8(deepAssign({},a,{chart:findViewById(r,SECOND_AXES_VIEW)})),a}function limitInPlot$1(a){var r=a.chart,e=a.options,n=e.yField,o=e.yAxis;return limitInPlot$2(deepAssign({},a,{chart:findViewById(r,FIRST_AXES_VIEW),options:{yAxis:o[n[0]]}})),limitInPlot$2(deepAssign({},a,{chart:findViewById(r,SECOND_AXES_VIEW),options:{yAxis:o[n[1]]}})),a}function theme$1(a){var r=a.chart;return theme$2(deepAssign({},a,{chart:findViewById(r,FIRST_AXES_VIEW)})),theme$2(deepAssign({},a,{chart:findViewById(r,SECOND_AXES_VIEW)})),theme$2(a),a}function animation$4(a){var r=a.chart;return animation$5(deepAssign({},a,{chart:findViewById(r,FIRST_AXES_VIEW)})),animation$5(deepAssign({},a,{chart:findViewById(r,SECOND_AXES_VIEW)})),a}function label$8(a){var r=this,e,n,o=a.chart,s=a.options,l=s.label,c=s.yField,u=s.layout,f=findViewById(o,FIRST_AXES_VIEW),d=findViewById(o,SECOND_AXES_VIEW),g=findGeometry(f,"interval"),p=findGeometry(d,"interval");if(!l)g.label(!1),p.label(!1);else{var v=l.callback,m=__rest$1(l,["callback"]);m.position||(m.position="middle"),m.offset===void 0&&(m.offset=2);var y=__assign$8({},m);if(isHorizontal(u)){var x=((e=y.style)===null||e===void 0?void 0:e.textAlign)||(m.position==="middle"?"center":"left");m.style=deepAssign({},m.style,{textAlign:x});var _={left:"right",right:"left",center:"center"};y.style=deepAssign({},y.style,{textAlign:_[x]})}else{var E={top:"bottom",bottom:"top",middle:"middle"};typeof m.position=="string"?m.position=E[m.position]:typeof m.position=="function"&&(m.position=function(){for(var T=[],b=0;b<arguments.length;b++)T[b]=arguments[b];return E[m.position.apply(r,T)]});var S=((n=y.style)===null||n===void 0?void 0:n.textBaseline)||"bottom";y.style=deepAssign({},y.style,{textBaseline:S});var A={top:"bottom",bottom:"top",middle:"middle"};m.style=deepAssign({},m.style,{textBaseline:A[S]})}g.label({fields:[c[0]],callback:v,cfg:transformLabel(y)}),p.label({fields:[c[1]],callback:v,cfg:transformLabel(m)})}return a}function adaptor$i(a){return flow(geometry$e,meta$c,axis$e,limitInPlot$1,theme$1,label$8,tooltip$9,interaction$5,animation$4)(a)}var BidirectionalBar=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="bidirectional-bar",e}return r.getDefaultOptions=function(){return deepAssign({},a.getDefaultOptions.call(this),{syncViewPadding})},r.prototype.changeData=function(e){e===void 0&&(e=[]),this.chart.emit(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,Event$1.fromData(this.chart,VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,null)),this.updateOption({data:e});var n=this.options,o=n.xField,s=n.yField,l=n.layout,c=transformData$7(o,s,SERIES_FIELD_KEY,e,isHorizontal(l)),u=c[0],f=c[1],d=findViewById(this.chart,FIRST_AXES_VIEW),g=findViewById(this.chart,SECOND_AXES_VIEW);d.data(u),g.data(f),this.chart.render(!0),this.chart.emit(VIEW_LIFE_CIRCLE.AFTER_CHANGE_DATA,Event$1.fromData(this.chart,VIEW_LIFE_CIRCLE.AFTER_CHANGE_DATA,null))},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$i},r.SERIES_FIELD_KEY=SERIES_FIELD_KEY,r}(Plot),_a,BOX_RANGE="$$range$$",BOX_RANGE_ALIAS="low-q1-median-q3-high",BOX_SYNC_NAME="$$y_outliers$$",OUTLIERS_VIEW_ID="outliers_view",DEFAULT_OPTIONS$k=deepAssign({},Plot.getDefaultOptions(),{meta:(_a={},_a[BOX_RANGE]={min:0,alias:BOX_RANGE_ALIAS},_a),interactions:[{type:"active-region"}],tooltip:{showMarkers:!1,shared:!0},boxStyle:{lineWidth:1}}),transformData$6=function(a,r){var e=a;if(Array.isArray(r)){var n=r[0],o=r[1],s=r[2],l=r[3],c=r[4];e=map$2(a,function(u){return u[BOX_RANGE]=[u[n],u[o],u[s],u[l],u[c]],u})}return e};function field(a){var r=a.chart,e=a.options,n=e.xField,o=e.yField,s=e.groupField,l=e.color,c=e.tooltip,u=e.boxStyle;r.data(transformData$6(e.data,o));var f=isArray$4(o)?BOX_RANGE:o,d=o?isArray$4(o)?o:[o]:[],g=c;g!==!1&&(g=deepAssign({},{fields:isArray$4(o)?o:[]},g));var p=schema(deepAssign({},a,{options:{xField:n,yField:f,seriesField:s,tooltip:g,rawFields:d,label:!1,schema:{shape:"box",color:l,style:u}}})).ext;return s&&p.geometry.adjust("dodge"),a}function outliersPoint(a){var r=a.chart,e=a.options,n=e.xField,o=e.data,s=e.outliersField,l=e.outliersStyle,c=e.padding,u=e.label;if(!s)return a;var f=r.createView({padding:c,id:OUTLIERS_VIEW_ID}),d=o.reduce(function(g,p){var v=p[s];return v.forEach(function(m){var y;return g.push(__assign$8(__assign$8({},p),(y={},y[s]=m,y)))}),g},[]);return f.data(d),point({chart:f,options:{xField:n,yField:s,point:{shape:"circle",style:l},label:u}}),f.axis(!1),a}function meta$b(a){var r,e,n=a.chart,o=a.options,s=o.meta,l=o.xAxis,c=o.yAxis,u=o.xField,f=o.yField,d=o.outliersField,g=Array.isArray(f)?BOX_RANGE:f,p={};if(d){var v=BOX_SYNC_NAME;p=(r={},r[d]={sync:v,nice:!0},r[g]={sync:v,nice:!0},r)}var m=deepAssign(p,s,(e={},e[u]=pick(l,AXIS_META_CONFIG_KEYS),e[g]=pick(c,AXIS_META_CONFIG_KEYS),e));return n.scale(m),a}function axis$d(a){var r=a.chart,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField,l=e.yField,c=Array.isArray(l)?BOX_RANGE:l;return n===!1?r.axis(s,!1):r.axis(s,n),o===!1?r.axis(BOX_RANGE,!1):r.axis(c,o),a}function legend$9(a){var r=a.chart,e=a.options,n=e.legend,o=e.groupField;return o?n?r.legend(o,n):r.legend(o,{position:"bottom"}):r.legend(!1),a}function adaptor$h(a){return flow(field,outliersPoint,meta$b,axis$d,legend$9,tooltip$9,annotation$2(),interaction$8,animation$5,theme$2)(a)}var Box=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="box",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$k},r.prototype.changeData=function(e){this.updateOption({data:e});var n=this.options.yField,o=this.chart.views.find(function(s){return s.id===OUTLIERS_VIEW_ID});o&&o.data(e),this.chart.changeData(transformData$6(e,n))},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$h},r}(Plot);function getSeriesFieldKey(a,r,e){return a.length>1?"".concat(r,"_").concat(e):"".concat(r)}function transformData$5(a){var r=a.data,e=a.xField,n=a.measureField,o=a.rangeField,s=a.targetField,l=a.layout,c=[],u=[];r.forEach(function(g,p){var v=[g[o]].flat();v.sort(function(x,_){return x-_}),v.forEach(function(x,_){var E,S=_===0?x:v[_]-v[_-1];c.push((E={rKey:"".concat(o,"_").concat(_)},E[e]=e?g[e]:String(p),E[o]=S,E))});var m=[g[n]].flat();m.forEach(function(x,_){var E;c.push((E={mKey:getSeriesFieldKey(m,n,_)},E[e]=e?g[e]:String(p),E[n]=x,E))});var y=[g[s]].flat();y.forEach(function(x,_){var E;c.push((E={tKey:getSeriesFieldKey(y,s,_)},E[e]=e?g[e]:String(p),E[s]=x,E))}),u.push(g[o],g[n],g[s])});var f=Math.min.apply(Math,u.flat(1/0)),d=Math.max.apply(Math,u.flat(1/0));return f=f>0?0:f,l==="vertical"&&c.reverse(),{min:f,max:d,ds:c}}function geometry$d(a){var r=a.chart,e=a.options,n=e.bulletStyle,o=e.targetField,s=e.rangeField,l=e.measureField,c=e.xField,u=e.color,f=e.layout,d=e.size,g=e.label,p=transformData$5(e),v=p.min,m=p.max,y=p.ds;r.data(y);var x=deepAssign({},a,{options:{xField:c,yField:s,seriesField:"rKey",isStack:!0,label:get(g,"range"),interval:{color:get(u,"range"),style:get(n,"range"),size:get(d,"range")}}});interval(x),r.geometries[0].tooltip(!1);var _=deepAssign({},a,{options:{xField:c,yField:l,seriesField:"mKey",isStack:!0,label:get(g,"measure"),interval:{color:get(u,"measure"),style:get(n,"measure"),size:get(d,"measure")}}});interval(_);var E=deepAssign({},a,{options:{xField:c,yField:o,seriesField:"tKey",label:get(g,"target"),point:{color:get(u,"target"),style:get(n,"target"),size:isFunction$1(get(d,"target"))?function(S){return get(d,"target")(S)/2}:get(d,"target")/2,shape:f==="horizontal"?"line":"hyphen"}}});return point(E),f==="horizontal"&&r.coordinate().transpose(),__assign$8(__assign$8({},a),{ext:{data:{min:v,max:m}}})}function meta$a(a){var r,e,n=a.options,o=a.ext,s=n.xAxis,l=n.yAxis,c=n.targetField,u=n.rangeField,f=n.measureField,d=n.xField,g=o.data;return flow(scale$2((r={},r[d]=s,r[f]=l,r),(e={},e[f]={min:g==null?void 0:g.min,max:g==null?void 0:g.max,sync:!0},e[c]={sync:"".concat(f)},e[u]={sync:"".concat(f)},e)))(a)}function axis$c(a){var r=a.chart,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField,l=e.measureField,c=e.rangeField,u=e.targetField;return r.axis("".concat(c),!1),r.axis("".concat(u),!1),n===!1?r.axis("".concat(s),!1):r.axis("".concat(s),n),o===!1?r.axis("".concat(l),!1):r.axis("".concat(l),o),a}function legend$8(a){var r=a.chart,e=a.options,n=e.legend;return r.removeInteraction("legend-filter"),r.legend(n),r.legend("rKey",!1),r.legend("mKey",!1),r.legend("tKey",!1),a}function label$7(a){var r=a.chart,e=a.options,n=e.label,o=e.measureField,s=e.targetField,l=e.rangeField,c=r.geometries,u=c[0],f=c[1],d=c[2];return get(n,"range")?u.label("".concat(l),__assign$8({layout:[{type:"limit-in-plot"}]},transformLabel(n.range))):u.label(!1),get(n,"measure")?f.label("".concat(o),__assign$8({layout:[{type:"limit-in-plot"}]},transformLabel(n.measure))):f.label(!1),get(n,"target")?d.label("".concat(s),__assign$8({layout:[{type:"limit-in-plot"}]},transformLabel(n.target))):d.label(!1),a}function adaptor$g(a){flow(geometry$d,meta$a,axis$c,legend$8,theme$2,label$7,tooltip$9,interaction$8,animation$5)(a)}var DEFAULT_OPTIONS$j=deepAssign({},Plot.getDefaultOptions(),{layout:"horizontal",size:{range:30,measure:20,target:20},xAxis:{tickLine:!1,line:null},bulletStyle:{range:{fillOpacity:.5}},label:{measure:{position:"right"}},tooltip:{showMarkers:!1}}),Bullet=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="bullet",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$j},r.prototype.changeData=function(e){this.updateOption({data:e});var n=transformData$5(this.options),o=n.min,s=n.max,l=n.ds;meta$a({options:this.options,ext:{data:{min:o,max:s}},chart:this.chart}),this.chart.changeData(l)},r.prototype.getSchemaAdaptor=function(){return adaptor$g},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r}(Plot),DEFAULT_OPTIONS$i={y:0,nodeWidthRatio:.05,weight:!1,nodePaddingRatio:.1,id:function(a){return a.id},source:function(a){return a.source},target:function(a){return a.target},sourceWeight:function(a){return a.value||1},targetWeight:function(a){return a.value||1},sortBy:null};function processGraph(a,r,e){each$1(a,function(n,o){n.inEdges=r.filter(function(s){return"".concat(e.target(s))==="".concat(o)}),n.outEdges=r.filter(function(s){return"".concat(e.source(s))==="".concat(o)}),n.edges=n.outEdges.concat(n.inEdges),n.frequency=n.edges.length,n.value=0,n.inEdges.forEach(function(s){n.value+=e.targetWeight(s)}),n.outEdges.forEach(function(s){n.value+=e.sourceWeight(s)})})}function sortNodes(a,r){var e={weight:function(o,s){return s.value-o.value},frequency:function(o,s){return s.frequency-o.frequency},id:function(o,s){return"".concat(r.id(o)).localeCompare("".concat(r.id(s)))}},n=e[r.sortBy];!n&&isFunction$1(r.sortBy)&&(n=r.sortBy),n&&a.sort(n)}function layoutNodes(a,r){var e=a.length;if(!e)throw new TypeError("Invalid nodes: it's empty!");if(r.weight){var n=r.nodePaddingRatio;if(n<0||n>=1)throw new TypeError("Invalid nodePaddingRatio: it must be in range [0, 1)!");var o=n/(2*e),s=r.nodeWidthRatio;if(s<=0||s>=1)throw new TypeError("Invalid nodeWidthRatio: it must be in range (0, 1)!");var l=0;a.forEach(function(u){l+=u.value}),a.forEach(function(u){u.weight=u.value/l,u.width=u.weight*(1-n),u.height=s}),a.forEach(function(u,f){for(var d=0,g=f-1;g>=0;g--)d+=a[g].width+2*o;var p=u.minX=o+d,v=u.maxX=u.minX+u.width,m=u.minY=r.y-s/2,y=u.maxY=m+s;u.x=[p,v,v,p],u.y=[m,m,y,y]})}else{var c=1/e;a.forEach(function(u,f){u.x=(f+.5)*c,u.y=r.y})}return a}function locatingEdges(a,r,e){if(e.weight){var n={};each$1(a,function(o,s){n[s]=o.value}),r.forEach(function(o){var s=e.source(o),l=e.target(o),c=a[s],u=a[l];if(c&&u){var f=n[s],d=e.sourceWeight(o),g=c.minX+(c.value-f)/c.value*c.width,p=g+d/c.value*c.width;n[s]-=d;var v=n[l],m=e.targetWeight(o),y=u.minX+(u.value-v)/u.value*u.width,x=y+m/u.value*u.width;n[l]-=m;var _=e.y;o.x=[g,p,y,x],o.y=[_,_,_,_],o.source=c,o.target=u}})}else r.forEach(function(o){var s=a[e.source(o)],l=a[e.target(o)];s&&l&&(o.x=[s.x,l.x],o.y=[s.y,l.y],o.source=s,o.target=l)});return r}function getDefaultOptions$1(a){return mix({},DEFAULT_OPTIONS$i,a)}function chordLayout(a,r){var e=getDefaultOptions$1(a),n={},o=r.nodes,s=r.links;o.forEach(function(u){var f=e.id(u);n[f]=u}),processGraph(n,s,e),sortNodes(o,e);var l=layoutNodes(o,e),c=locatingEdges(n,s,e);return{nodes:l,links:c}}var X_FIELD$2="x",Y_FIELD$2="y",NODE_COLOR_FIELD="name",EDGE_COLOR_FIELD="source",DEFAULT_OPTIONS$h={nodeStyle:{opacity:1,fillOpacity:1,lineWidth:1},edgeStyle:{opacity:.5,lineWidth:2},label:{fields:["x","name"],callback:function(a,r){var e=(a[0]+a[1])/2,n=e>.5?-4:4;return{offsetX:n,content:r}},labelEmit:!0,style:{fill:"#8c8c8c"}},tooltip:{showTitle:!1,showMarkers:!1,fields:["source","target","value","isNode"],showContent:function(a){return!get(a,[0,"data","isNode"])},formatter:function(a){var r=a.source,e=a.target,n=a.value;return{name:"".concat(r," -> ").concat(e),value:n}}},interactions:[{type:"element-active"}],weight:!0,nodePaddingRatio:.1,nodeWidthRatio:.05};function transformData$4(a){var r=a.options,e=r.data,n=r.sourceField,o=r.targetField,s=r.weightField,l=r.nodePaddingRatio,c=r.nodeWidthRatio,u=r.rawFields,f=u===void 0?[]:u,d=transformDataToNodeLinkData(e,n,o,s),g=chordLayout({weight:!0,nodePaddingRatio:l,nodeWidthRatio:c},d),p=g.nodes,v=g.links,m=p.map(function(x){return __assign$8(__assign$8({},pick(x,__spreadArray$2(["id","x","y","name"],f,!0))),{isNode:!0})}),y=v.map(function(x){return __assign$8(__assign$8({source:x.source.name,target:x.target.name,name:x.source.name||x.target.name},pick(x,__spreadArray$2(["x","y","value"],f,!0))),{isNode:!1})});return __assign$8(__assign$8({},a),{ext:__assign$8(__assign$8({},a.ext),{chordData:{nodesData:m,edgesData:y}})})}function scale$1(a){var r,e=a.chart;return e.scale((r={x:{sync:!0,nice:!0},y:{sync:!0,nice:!0,max:1}},r[NODE_COLOR_FIELD]={sync:"color"},r[EDGE_COLOR_FIELD]={sync:"color"},r)),a}function axis$b(a){var r=a.chart;return r.axis(!1),a}function legend$7(a){var r=a.chart;return r.legend(!1),a}function tooltip$4(a){var r=a.chart,e=a.options,n=e.tooltip;return r.tooltip(n),a}function coordinate$4(a){var r=a.chart;return r.coordinate("polar").reflect("y"),a}function nodeGeometry(a){var r=a.chart,e=a.options,n=a.ext.chordData.nodesData,o=e.nodeStyle,s=e.label,l=e.tooltip,c=r.createView();return c.data(n),polygon({chart:c,options:{xField:X_FIELD$2,yField:Y_FIELD$2,seriesField:NODE_COLOR_FIELD,polygon:{style:o},label:s,tooltip:l}}),a}function edgeGeometry(a){var r=a.chart,e=a.options,n=a.ext.chordData.edgesData,o=e.edgeStyle,s=e.tooltip,l=r.createView();l.data(n);var c={xField:X_FIELD$2,yField:Y_FIELD$2,seriesField:EDGE_COLOR_FIELD,edge:{style:o,shape:"arc"},tooltip:s};return edge({chart:l,options:c}),a}function animation$3(a){var r=a.chart,e=a.options,n=e.animation;return addViewAnimation(r,n,getAllGeometriesRecursively(r)),a}function adaptor$f(a){return flow(theme$2,transformData$4,coordinate$4,scale$1,axis$b,legend$7,tooltip$4,edgeGeometry,nodeGeometry,interaction$8,state,animation$3)(a)}var Chord=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="chord",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$h},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$f},r}(Plot),RAW_FIELDS$1=["x","y","r","name","value","path","depth"],DEFAULT_OPTIONS$g={colorField:"name",autoFit:!0,pointStyle:{lineWidth:0,stroke:"#fff"},legend:!1,hierarchyConfig:{size:[1,1],padding:0},label:{fields:["name"],layout:{type:"limit-in-shape"}},tooltip:{showMarkers:!1,showTitle:!1},drilldown:{enabled:!1}},PADDING=4,PADDING_LEFT=0,PADDING_TOP=5,BREAD_CRUMB_NAME="drilldown-bread-crumb",DEFAULT_BREAD_CRUMB_CONFIG={position:"top-left",dividerText:"/",textStyle:{fontSize:12,fill:"rgba(0, 0, 0, 0.65)",cursor:"pointer"},activeTextStyle:{fill:"#87B5FF"}},HIERARCHY_DATA_TRANSFORM_PARAMS="hierarchy-data-transform-params",DrillDownAction=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.name="drill-down",e.historyCache=[],e.breadCrumbGroup=null,e.breadCrumbCfg=DEFAULT_BREAD_CRUMB_CONFIG,e}return r.prototype.click=function(){var e=get(this.context,["event","data","data"]);if(!e)return!1;this.drill(e),this.drawBreadCrumb()},r.prototype.resetPosition=function(){if(this.breadCrumbGroup){var e=this.context.view.getCoordinate(),n=this.breadCrumbGroup,o=n.getBBox(),s=this.getButtonCfg().position,l={x:e.start.x,y:e.end.y-(o.height+PADDING_TOP*2)};e.isPolar&&(l={x:0,y:0}),s==="bottom-left"&&(l={x:e.start.x,y:e.start.y});var c=Util.transform(null,[["t",l.x+PADDING_LEFT,l.y+o.height+PADDING_TOP]]);n.setMatrix(c)}},r.prototype.back=function(){size(this.historyCache)&&this.backTo(this.historyCache.slice(0,-1))},r.prototype.reset=function(){this.historyCache[0]&&this.backTo(this.historyCache.slice(0,1)),this.historyCache=[],this.hideCrumbGroup()},r.prototype.drill=function(e){var n=this.context.view,o=get(n,["interactions","drill-down","cfg","transformData"],function(f){return f}),s=o(__assign$8({data:e.data},e[HIERARCHY_DATA_TRANSFORM_PARAMS]));n.changeData(s);for(var l=[],c=e;c;){var u=c.data;l.unshift({id:"".concat(u.name,"_").concat(c.height,"_").concat(c.depth),name:u.name,children:o(__assign$8({data:u},e[HIERARCHY_DATA_TRANSFORM_PARAMS]))}),c=c.parent}this.historyCache=(this.historyCache||[]).slice(0,-1).concat(l)},r.prototype.backTo=function(e){if(!(!e||e.length<=0)){var n=this.context.view,o=last(e).children;n.changeData(o),e.length>1?(this.historyCache=e,this.drawBreadCrumb()):(this.historyCache=[],this.hideCrumbGroup())}},r.prototype.getButtonCfg=function(){var e=this.context.view,n=get(e,["interactions","drill-down","cfg","drillDownConfig"]);return deepAssign(this.breadCrumbCfg,n==null?void 0:n.breadCrumb,this.cfg)},r.prototype.drawBreadCrumb=function(){this.drawBreadCrumbGroup(),this.resetPosition(),this.breadCrumbGroup.show()},r.prototype.drawBreadCrumbGroup=function(){var e=this,n=this.getButtonCfg(),o=this.historyCache;this.breadCrumbGroup?this.breadCrumbGroup.clear():this.breadCrumbGroup=this.context.view.foregroundGroup.addGroup({name:BREAD_CRUMB_NAME});var s=0;o.forEach(function(l,c){var u=e.breadCrumbGroup.addShape({type:"text",id:l.id,name:"".concat(BREAD_CRUMB_NAME,"_").concat(l.name,"_text"),attrs:__assign$8(__assign$8({text:c===0&&!isNil(n.rootText)?n.rootText:l.name},n.textStyle),{x:s,y:0})}),f=u.getBBox();if(s+=f.width+PADDING,u.on("click",function(p){var v,m=p.target.get("id");if(m!==((v=last(o))===null||v===void 0?void 0:v.id)){var y=o.slice(0,o.findIndex(function(x){return x.id===m})+1);e.backTo(y)}}),u.on("mouseenter",function(p){var v,m=p.target.get("id");m!==((v=last(o))===null||v===void 0?void 0:v.id)?u.attr(n.activeTextStyle):u.attr({cursor:"default"})}),u.on("mouseleave",function(){u.attr(n.textStyle)}),c<o.length-1){var d=e.breadCrumbGroup.addShape({type:"text",name:"".concat(n.name,"_").concat(l.name,"_divider"),attrs:__assign$8(__assign$8({text:n.dividerText},n.textStyle),{x:s,y:0})}),g=d.getBBox();s+=g.width+PADDING}})},r.prototype.hideCrumbGroup=function(){this.breadCrumbGroup&&this.breadCrumbGroup.hide()},r.prototype.destroy=function(){this.breadCrumbGroup&&this.breadCrumbGroup.remove(),a.prototype.destroy.call(this)},r}(Action);function defaultSeparation$1(a,r){return a.parent===r.parent?1:2}function meanX(a){return a.reduce(meanXReduce,0)/a.length}function meanXReduce(a,r){return a+r.x}function maxY(a){return 1+a.reduce(maxYReduce,0)}function maxYReduce(a,r){return Math.max(a,r.y)}function leafLeft(a){for(var r;r=a.children;)a=r[0];return a}function leafRight(a){for(var r;r=a.children;)a=r[r.length-1];return a}function cluster(){var a=defaultSeparation$1,r=1,e=1,n=!1;function o(s){var l,c=0;s.eachAfter(function(p){var v=p.children;v?(p.x=meanX(v),p.y=maxY(v)):(p.x=l?c+=a(p,l):0,p.y=0,l=p)});var u=leafLeft(s),f=leafRight(s),d=u.x-a(u,f)/2,g=f.x+a(f,u)/2;return s.eachAfter(n?function(p){p.x=(p.x-s.x)*r,p.y=(s.y-p.y)*e}:function(p){p.x=(p.x-d)/(g-d)*r,p.y=(1-(s.y?p.y/s.y:1))*e})}return o.separation=function(s){return arguments.length?(a=s,o):a},o.size=function(s){return arguments.length?(n=!1,r=+s[0],e=+s[1],o):n?null:[r,e]},o.nodeSize=function(s){return arguments.length?(n=!0,r=+s[0],e=+s[1],o):n?[r,e]:null},o}function count(a){var r=0,e=a.children,n=e&&e.length;if(!n)r=1;else for(;--n>=0;)r+=e[n].value;a.value=r}function node_count(){return this.eachAfter(count)}function node_each(a,r){let e=-1;for(const n of this)a.call(r,n,++e,this);return this}function node_eachBefore(a,r){for(var e=this,n=[e],o,s,l=-1;e=n.pop();)if(a.call(r,e,++l,this),o=e.children)for(s=o.length-1;s>=0;--s)n.push(o[s]);return this}function node_eachAfter(a,r){for(var e=this,n=[e],o=[],s,l,c,u=-1;e=n.pop();)if(o.push(e),s=e.children)for(l=0,c=s.length;l<c;++l)n.push(s[l]);for(;e=o.pop();)a.call(r,e,++u,this);return this}function node_find(a,r){let e=-1;for(const n of this)if(a.call(r,n,++e,this))return n}function node_sum(a){return this.eachAfter(function(r){for(var e=+a(r.data)||0,n=r.children,o=n&&n.length;--o>=0;)e+=n[o].value;r.value=e})}function node_sort(a){return this.eachBefore(function(r){r.children&&r.children.sort(a)})}function node_path(a){for(var r=this,e=leastCommonAncestor(r,a),n=[r];r!==e;)r=r.parent,n.push(r);for(var o=n.length;a!==e;)n.splice(o,0,a),a=a.parent;return n}function leastCommonAncestor(a,r){if(a===r)return a;var e=a.ancestors(),n=r.ancestors(),o=null;for(a=e.pop(),r=n.pop();a===r;)o=a,a=e.pop(),r=n.pop();return o}function node_ancestors(){for(var a=this,r=[a];a=a.parent;)r.push(a);return r}function node_descendants(){return Array.from(this)}function node_leaves(){var a=[];return this.eachBefore(function(r){r.children||a.push(r)}),a}function node_links(){var a=this,r=[];return a.each(function(e){e!==a&&r.push({source:e.parent,target:e})}),r}function*node_iterator(){var a=this,r,e=[a],n,o,s;do for(r=e.reverse(),e=[];a=r.pop();)if(yield a,n=a.children)for(o=0,s=n.length;o<s;++o)e.push(n[o]);while(e.length)}function hierarchy(a,r){a instanceof Map?(a=[void 0,a],r===void 0&&(r=mapChildren)):r===void 0&&(r=objectChildren);for(var e=new Node$1(a),n,o=[e],s,l,c,u;n=o.pop();)if((l=r(n.data))&&(u=(l=Array.from(l)).length))for(n.children=l,c=u-1;c>=0;--c)o.push(s=l[c]=new Node$1(l[c])),s.parent=n,s.depth=n.depth+1;return e.eachBefore(computeHeight)}function node_copy(){return hierarchy(this).eachBefore(copyData)}function objectChildren(a){return a.children}function mapChildren(a){return Array.isArray(a)?a[1]:null}function copyData(a){a.data.value!==void 0&&(a.value=a.data.value),a.data=a.data.data}function computeHeight(a){var r=0;do a.height=r;while((a=a.parent)&&a.height<++r)}function Node$1(a){this.data=a,this.depth=this.height=0,this.parent=null}Node$1.prototype=hierarchy.prototype={constructor:Node$1,count:node_count,each:node_each,eachAfter:node_eachAfter,eachBefore:node_eachBefore,find:node_find,sum:node_sum,sort:node_sort,path:node_path,ancestors:node_ancestors,descendants:node_descendants,leaves:node_leaves,links:node_links,copy:node_copy,[Symbol.iterator]:node_iterator};function array(a){return typeof a=="object"&&"length"in a?a:Array.from(a)}function shuffle(a){for(var r=a.length,e,n;r;)n=Math.random()*r--|0,e=a[r],a[r]=a[n],a[n]=e;return a}function enclose(a){for(var r=0,e=(a=shuffle(Array.from(a))).length,n=[],o,s;r<e;)o=a[r],s&&enclosesWeak(s,o)?++r:(s=encloseBasis(n=extendBasis(n,o)),r=0);return s}function extendBasis(a,r){var e,n;if(enclosesWeakAll(r,a))return[r];for(e=0;e<a.length;++e)if(enclosesNot(r,a[e])&&enclosesWeakAll(encloseBasis2(a[e],r),a))return[a[e],r];for(e=0;e<a.length-1;++e)for(n=e+1;n<a.length;++n)if(enclosesNot(encloseBasis2(a[e],a[n]),r)&&enclosesNot(encloseBasis2(a[e],r),a[n])&&enclosesNot(encloseBasis2(a[n],r),a[e])&&enclosesWeakAll(encloseBasis3(a[e],a[n],r),a))return[a[e],a[n],r];throw new Error}function enclosesNot(a,r){var e=a.r-r.r,n=r.x-a.x,o=r.y-a.y;return e<0||e*e<n*n+o*o}function enclosesWeak(a,r){var e=a.r-r.r+Math.max(a.r,r.r,1)*1e-9,n=r.x-a.x,o=r.y-a.y;return e>0&&e*e>n*n+o*o}function enclosesWeakAll(a,r){for(var e=0;e<r.length;++e)if(!enclosesWeak(a,r[e]))return!1;return!0}function encloseBasis(a){switch(a.length){case 1:return encloseBasis1(a[0]);case 2:return encloseBasis2(a[0],a[1]);case 3:return encloseBasis3(a[0],a[1],a[2])}}function encloseBasis1(a){return{x:a.x,y:a.y,r:a.r}}function encloseBasis2(a,r){var e=a.x,n=a.y,o=a.r,s=r.x,l=r.y,c=r.r,u=s-e,f=l-n,d=c-o,g=Math.sqrt(u*u+f*f);return{x:(e+s+u/g*d)/2,y:(n+l+f/g*d)/2,r:(g+o+c)/2}}function encloseBasis3(a,r,e){var n=a.x,o=a.y,s=a.r,l=r.x,c=r.y,u=r.r,f=e.x,d=e.y,g=e.r,p=n-l,v=n-f,m=o-c,y=o-d,x=u-s,_=g-s,E=n*n+o*o-s*s,S=E-l*l-c*c+u*u,A=E-f*f-d*d+g*g,T=v*m-p*y,b=(m*A-y*S)/(T*2)-n,C=(y*x-m*_)/T,L=(v*S-p*A)/(T*2)-o,R=(p*_-v*x)/T,I=C*C+R*R-1,w=2*(s+b*C+L*R),M=b*b+L*L-s*s,D=-(I?(w+Math.sqrt(w*w-4*I*M))/(2*I):M/w);return{x:n+b+C*D,y:o+L+R*D,r:D}}function place(a,r,e){var n=a.x-r.x,o,s,l=a.y-r.y,c,u,f=n*n+l*l;f?(s=r.r+e.r,s*=s,u=a.r+e.r,u*=u,s>u?(o=(f+u-s)/(2*f),c=Math.sqrt(Math.max(0,u/f-o*o)),e.x=a.x-o*n-c*l,e.y=a.y-o*l+c*n):(o=(f+s-u)/(2*f),c=Math.sqrt(Math.max(0,s/f-o*o)),e.x=r.x+o*n-c*l,e.y=r.y+o*l+c*n)):(e.x=r.x+e.r,e.y=r.y)}function intersects(a,r){var e=a.r+r.r-1e-6,n=r.x-a.x,o=r.y-a.y;return e>0&&e*e>n*n+o*o}function score(a){var r=a._,e=a.next._,n=r.r+e.r,o=(r.x*e.r+e.x*r.r)/n,s=(r.y*e.r+e.y*r.r)/n;return o*o+s*s}function Node(a){this._=a,this.next=null,this.previous=null}function packEnclose(a){if(!(o=(a=array(a)).length))return 0;var r,e,n,o,s,l,c,u,f,d,g;if(r=a[0],r.x=0,r.y=0,!(o>1))return r.r;if(e=a[1],r.x=-e.r,e.x=r.r,e.y=0,!(o>2))return r.r+e.r;place(e,r,n=a[2]),r=new Node(r),e=new Node(e),n=new Node(n),r.next=n.previous=e,e.next=r.previous=n,n.next=e.previous=r;t:for(c=3;c<o;++c){place(r._,e._,n=a[c]),n=new Node(n),u=e.next,f=r.previous,d=e._.r,g=r._.r;do if(d<=g){if(intersects(u._,n._)){e=u,r.next=e,e.previous=r,--c;continue t}d+=u._.r,u=u.next}else{if(intersects(f._,n._)){r=f,r.next=e,e.previous=r,--c;continue t}g+=f._.r,f=f.previous}while(u!==f.next);for(n.previous=r,n.next=e,r.next=e.previous=e=n,s=score(r);(n=n.next)!==e;)(l=score(n))<s&&(r=n,s=l);e=r.next}for(r=[e._],n=e;(n=n.next)!==e;)r.push(n._);for(n=enclose(r),c=0;c<o;++c)r=a[c],r.x-=n.x,r.y-=n.y;return n.r}function siblings(a){return packEnclose(a),a}function optional(a){return a==null?null:required(a)}function required(a){if(typeof a!="function")throw new Error;return a}function constantZero(){return 0}function constant$1(a){return function(){return a}}function defaultRadius(a){return Math.sqrt(a.value)}function index$1(){var a=null,r=1,e=1,n=constantZero;function o(s){return s.x=r/2,s.y=e/2,a?s.eachBefore(radiusLeaf(a)).eachAfter(packChildren(n,.5)).eachBefore(translateChild(1)):s.eachBefore(radiusLeaf(defaultRadius)).eachAfter(packChildren(constantZero,1)).eachAfter(packChildren(n,s.r/Math.min(r,e))).eachBefore(translateChild(Math.min(r,e)/(2*s.r))),s}return o.radius=function(s){return arguments.length?(a=optional(s),o):a},o.size=function(s){return arguments.length?(r=+s[0],e=+s[1],o):[r,e]},o.padding=function(s){return arguments.length?(n=typeof s=="function"?s:constant$1(+s),o):n},o}function radiusLeaf(a){return function(r){r.children||(r.r=Math.max(0,+a(r)||0))}}function packChildren(a,r){return function(e){if(n=e.children){var n,o,s=n.length,l=a(e)*r||0,c;if(l)for(o=0;o<s;++o)n[o].r+=l;if(c=packEnclose(n),l)for(o=0;o<s;++o)n[o].r-=l;e.r=c+l}}}function translateChild(a){return function(r){var e=r.parent;r.r*=a,e&&(r.x=e.x+a*r.x,r.y=e.y+a*r.y)}}function roundNode(a){a.x0=Math.round(a.x0),a.y0=Math.round(a.y0),a.x1=Math.round(a.x1),a.y1=Math.round(a.y1)}function treemapDice(a,r,e,n,o){for(var s=a.children,l,c=-1,u=s.length,f=a.value&&(n-r)/a.value;++c<u;)l=s[c],l.y0=e,l.y1=o,l.x0=r,l.x1=r+=l.value*f}function partition$1(){var a=1,r=1,e=0,n=!1;function o(l){var c=l.height+1;return l.x0=l.y0=e,l.x1=a,l.y1=r/c,l.eachBefore(s(r,c)),n&&l.eachBefore(roundNode),l}function s(l,c){return function(u){u.children&&treemapDice(u,u.x0,l*(u.depth+1)/c,u.x1,l*(u.depth+2)/c);var f=u.x0,d=u.y0,g=u.x1-e,p=u.y1-e;g<f&&(f=g=(f+g)/2),p<d&&(d=p=(d+p)/2),u.x0=f,u.y0=d,u.x1=g,u.y1=p}}return o.round=function(l){return arguments.length?(n=!!l,o):n},o.size=function(l){return arguments.length?(a=+l[0],r=+l[1],o):[a,r]},o.padding=function(l){return arguments.length?(e=+l,o):e},o}var preroot={depth:-1},ambiguous={};function defaultId$1(a){return a.id}function defaultParentId(a){return a.parentId}function stratify(){var a=defaultId$1,r=defaultParentId;function e(n){var o=Array.from(n),s=o.length,l,c,u,f,d,g,p,v=new Map;for(c=0;c<s;++c)l=o[c],d=o[c]=new Node$1(l),(g=a(l,c,n))!=null&&(g+="")&&(p=d.id=g,v.set(p,v.has(p)?ambiguous:d)),(g=r(l,c,n))!=null&&(g+="")&&(d.parent=g);for(c=0;c<s;++c)if(d=o[c],g=d.parent){if(f=v.get(g),!f)throw new Error("missing: "+g);if(f===ambiguous)throw new Error("ambiguous: "+g);f.children?f.children.push(d):f.children=[d],d.parent=f}else{if(u)throw new Error("multiple roots");u=d}if(!u)throw new Error("no root");if(u.parent=preroot,u.eachBefore(function(m){m.depth=m.parent.depth+1,--s}).eachBefore(computeHeight),u.parent=null,s>0)throw new Error("cycle");return u}return e.id=function(n){return arguments.length?(a=required(n),e):a},e.parentId=function(n){return arguments.length?(r=required(n),e):r},e}function defaultSeparation(a,r){return a.parent===r.parent?1:2}function nextLeft(a){var r=a.children;return r?r[0]:a.t}function nextRight(a){var r=a.children;return r?r[r.length-1]:a.t}function moveSubtree(a,r,e){var n=e/(r.i-a.i);r.c-=n,r.s+=e,a.c+=n,r.z+=e,r.m+=e}function executeShifts(a){for(var r=0,e=0,n=a.children,o=n.length,s;--o>=0;)s=n[o],s.z+=r,s.m+=r,r+=s.s+(e+=s.c)}function nextAncestor(a,r,e){return a.a.parent===r.parent?a.a:e}function TreeNode(a,r){this._=a,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=r}TreeNode.prototype=Object.create(Node$1.prototype);function treeRoot(a){for(var r=new TreeNode(a,0),e,n=[r],o,s,l,c;e=n.pop();)if(s=e._.children)for(e.children=new Array(c=s.length),l=c-1;l>=0;--l)n.push(o=e.children[l]=new TreeNode(s[l],l)),o.parent=e;return(r.parent=new TreeNode(null,0)).children=[r],r}function tree(){var a=defaultSeparation,r=1,e=1,n=null;function o(f){var d=treeRoot(f);if(d.eachAfter(s),d.parent.m=-d.z,d.eachBefore(l),n)f.eachBefore(u);else{var g=f,p=f,v=f;f.eachBefore(function(E){E.x<g.x&&(g=E),E.x>p.x&&(p=E),E.depth>v.depth&&(v=E)});var m=g===p?1:a(g,p)/2,y=m-g.x,x=r/(p.x+m+y),_=e/(v.depth||1);f.eachBefore(function(E){E.x=(E.x+y)*x,E.y=E.depth*_})}return f}function s(f){var d=f.children,g=f.parent.children,p=f.i?g[f.i-1]:null;if(d){executeShifts(f);var v=(d[0].z+d[d.length-1].z)/2;p?(f.z=p.z+a(f._,p._),f.m=f.z-v):f.z=v}else p&&(f.z=p.z+a(f._,p._));f.parent.A=c(f,p,f.parent.A||g[0])}function l(f){f._.x=f.z+f.parent.m,f.m+=f.parent.m}function c(f,d,g){if(d){for(var p=f,v=f,m=d,y=p.parent.children[0],x=p.m,_=v.m,E=m.m,S=y.m,A;m=nextRight(m),p=nextLeft(p),m&&p;)y=nextLeft(y),v=nextRight(v),v.a=f,A=m.z+E-p.z-x+a(m._,p._),A>0&&(moveSubtree(nextAncestor(m,f,g),f,A),x+=A,_+=A),E+=m.m,x+=p.m,S+=y.m,_+=v.m;m&&!nextRight(v)&&(v.t=m,v.m+=E-_),p&&!nextLeft(y)&&(y.t=p,y.m+=x-S,g=f)}return g}function u(f){f.x*=r,f.y=f.depth*e}return o.separation=function(f){return arguments.length?(a=f,o):a},o.size=function(f){return arguments.length?(n=!1,r=+f[0],e=+f[1],o):n?null:[r,e]},o.nodeSize=function(f){return arguments.length?(n=!0,r=+f[0],e=+f[1],o):n?[r,e]:null},o}function treemapSlice(a,r,e,n,o){for(var s=a.children,l,c=-1,u=s.length,f=a.value&&(o-e)/a.value;++c<u;)l=s[c],l.x0=r,l.x1=n,l.y0=e,l.y1=e+=l.value*f}var phi=(1+Math.sqrt(5))/2;function squarifyRatio(a,r,e,n,o,s){for(var l=[],c=r.children,u,f,d=0,g=0,p=c.length,v,m,y=r.value,x,_,E,S,A,T,b;d<p;){v=o-e,m=s-n;do x=c[g++].value;while(!x&&g<p);for(_=E=x,T=Math.max(m/v,v/m)/(y*a),b=x*x*T,A=Math.max(E/b,b/_);g<p;++g){if(x+=f=c[g].value,f<_&&(_=f),f>E&&(E=f),b=x*x*T,S=Math.max(E/b,b/_),S>A){x-=f;break}A=S}l.push(u={value:x,dice:v<m,children:c.slice(d,g)}),u.dice?treemapDice(u,e,n,o,y?n+=m*x/y:s):treemapSlice(u,e,n,y?e+=v*x/y:o,s),y-=x,d=g}return l}const squarify=function a(r){function e(n,o,s,l,c){squarifyRatio(r,n,o,s,l,c)}return e.ratio=function(n){return a((n=+n)>1?n:1)},e}(phi);function index(){var a=squarify,r=!1,e=1,n=1,o=[0],s=constantZero,l=constantZero,c=constantZero,u=constantZero,f=constantZero;function d(p){return p.x0=p.y0=0,p.x1=e,p.y1=n,p.eachBefore(g),o=[0],r&&p.eachBefore(roundNode),p}function g(p){var v=o[p.depth],m=p.x0+v,y=p.y0+v,x=p.x1-v,_=p.y1-v;x<m&&(m=x=(m+x)/2),_<y&&(y=_=(y+_)/2),p.x0=m,p.y0=y,p.x1=x,p.y1=_,p.children&&(v=o[p.depth+1]=s(p)/2,m+=f(p)-v,y+=l(p)-v,x-=c(p)-v,_-=u(p)-v,x<m&&(m=x=(m+x)/2),_<y&&(y=_=(y+_)/2),a(p,m,y,x,_))}return d.round=function(p){return arguments.length?(r=!!p,d):r},d.size=function(p){return arguments.length?(e=+p[0],n=+p[1],d):[e,n]},d.tile=function(p){return arguments.length?(a=required(p),d):a},d.padding=function(p){return arguments.length?d.paddingInner(p).paddingOuter(p):d.paddingInner()},d.paddingInner=function(p){return arguments.length?(s=typeof p=="function"?p:constant$1(+p),d):s},d.paddingOuter=function(p){return arguments.length?d.paddingTop(p).paddingRight(p).paddingBottom(p).paddingLeft(p):d.paddingTop()},d.paddingTop=function(p){return arguments.length?(l=typeof p=="function"?p:constant$1(+p),d):l},d.paddingRight=function(p){return arguments.length?(c=typeof p=="function"?p:constant$1(+p),d):c},d.paddingBottom=function(p){return arguments.length?(u=typeof p=="function"?p:constant$1(+p),d):u},d.paddingLeft=function(p){return arguments.length?(f=typeof p=="function"?p:constant$1(+p),d):f},d}function binary(a,r,e,n,o){var s=a.children,l,c=s.length,u,f=new Array(c+1);for(f[0]=u=l=0;l<c;++l)f[l+1]=u+=s[l].value;d(0,c,a.value,r,e,n,o);function d(g,p,v,m,y,x,_){if(g>=p-1){var E=s[g];E.x0=m,E.y0=y,E.x1=x,E.y1=_;return}for(var S=f[g],A=v/2+S,T=g+1,b=p-1;T<b;){var C=T+b>>>1;f[C]<A?T=C+1:b=C}A-f[T-1]<f[T]-A&&g+1<T&&--T;var L=f[T]-S,R=v-L;if(x-m>_-y){var I=v?(m*R+x*L)/v:x;d(g,T,L,m,y,I,_),d(T,p,R,I,y,x,_)}else{var w=v?(y*R+_*L)/v:_;d(g,T,L,m,y,x,w),d(T,p,R,m,w,x,_)}}}function sliceDice(a,r,e,n,o){(a.depth&1?treemapSlice:treemapDice)(a,r,e,n,o)}const resquarify=function a(r){function e(n,o,s,l,c){if((u=n._squarify)&&u.ratio===r)for(var u,f,d,g,p=-1,v,m=u.length,y=n.value;++p<m;){for(f=u[p],d=f.children,g=f.value=0,v=d.length;g<v;++g)f.value+=d[g].value;f.dice?treemapDice(f,o,s,l,y?s+=(c-s)*f.value/y:c):treemapSlice(f,o,s,y?o+=(l-o)*f.value/y:l,c),y-=f.value}else n._squarify=u=squarifyRatio(r,n,o,s,l,c),u.ratio=r}return e.ratio=function(n){return a((n=+n)>1?n:1)},e}(phi),d3Hierarchy=Object.freeze(Object.defineProperty({__proto__:null,cluster,hierarchy,pack:index$1,packEnclose:enclose,packSiblings:siblings,partition:partition$1,stratify,tree,treemap:index,treemapBinary:binary,treemapDice,treemapResquarify:resquarify,treemapSlice,treemapSliceDice:sliceDice,treemapSquarify:squarify},Symbol.toStringTag,{value:"Module"}));var NODE_INDEX_FIELD="nodeIndex",CHILD_NODE_COUNT="childNodeCount",NODE_ANCESTORS_FIELD="nodeAncestor",INVALID_FIELD_ERR_MSG="Invalid field: it must be a string!";function getField(a,r){var e=a.field,n=a.fields;if(isString$1(e))return e;if(isArray$4(e))return console.warn(INVALID_FIELD_ERR_MSG),e[0];if(console.warn("".concat(INVALID_FIELD_ERR_MSG," will try to get fields instead.")),isString$1(n))return n;if(isArray$4(n)&&n.length)return n[0];if(r)return r;throw new TypeError(INVALID_FIELD_ERR_MSG)}function getAllNodes(a){var r=[];if(a&&a.each){var e,n;a.each(function(o){var s,l;o.parent!==e?(e=o.parent,n=0):n+=1;var c=filter((((s=o.ancestors)===null||s===void 0?void 0:s.call(o))||[]).map(function(u){return r.find(function(f){return f.name===u.name})||u}),function(u){var f=u.depth;return f>0&&f<o.depth});o[NODE_ANCESTORS_FIELD]=c,o[CHILD_NODE_COUNT]=((l=o.children)===null||l===void 0?void 0:l.length)||0,o[NODE_INDEX_FIELD]=n,r.push(o)})}else a&&a.eachNode&&a.eachNode(function(o){r.push(o)});return r}var DEFAULT_OPTIONS$f={field:"value",as:["x","y","r"],sort:function(a,r){return r.value-a.value}};function pack(a,r){r=mix({},DEFAULT_OPTIONS$f,r);var e=r.as;if(!isArray$4(e)||e.length!==3)throw new TypeError('Invalid as: it must be an array with 3 strings (e.g. [ "x", "y", "r" ])!');var n;try{n=getField(r)}catch(f){console.warn(f)}var o=function(f){return index$1().size(r.size).padding(r.padding)(hierarchy(f).sum(function(d){return d[n]}).sort(r.sort))},s=o(a),l=e[0],c=e[1],u=e[2];return s.each(function(f){f[l]=f.x,f[c]=f.y,f[u]=f.r}),getAllNodes(s)}function transformData$3(a){var r=a.data,e=a.hierarchyConfig,n=a.rawFields,o=n===void 0?[]:n,s=a.enableDrillDown,l=pack(r,__assign$8(__assign$8({},e),{field:"value",as:["x","y","r"]})),c=[];return l.forEach(function(u){for(var f,d=u.data.name,g=__assign$8({},u);g.depth>1;)d="".concat((f=g.parent.data)===null||f===void 0?void 0:f.name," / ").concat(d),g=g.parent;if(s&&u.depth>2)return null;var p=deepAssign({},u.data,__assign$8(__assign$8(__assign$8({},pick(u.data,o)),{path:d}),u));p.ext=e,p[HIERARCHY_DATA_TRANSFORM_PARAMS]={hierarchyConfig:e,rawFields:o,enableDrillDown:s},c.push(p)}),c}function resolvePaddingForCircle(a,r,e){var n=resolveAllPadding([a,r]),o=n[0],s=n[1],l=n[2],c=n[3],u=e.width,f=e.height,d=u-(c+s),g=f-(o+l),p=Math.min(d,g),v=(d-p)/2,m=(g-p)/2,y=o+m,x=s+v,_=l+m,E=c+v,S=[y,x,_,E],A=p<0?0:p;return{finalPadding:S,finalSize:A}}function defaultOptions$3(a){var r=a.chart,e=Math.min(r.viewBBox.width,r.viewBBox.height);return deepAssign({options:{size:function(n){var o=n.r;return o*e}}},a)}function padding$1(a){var r=a.options,e=a.chart,n=e.viewBBox,o=r.padding,s=r.appendPadding,l=r.drilldown,c=s;if(l!=null&&l.enabled){var u=getAdjustAppendPadding(e.appendPadding,get(l,["breadCrumb","position"]));c=resolveAllPadding([u,s])}var f=resolvePaddingForCircle(o,c,n).finalPadding;return e.padding=f,e.appendPadding=0,a}function geometry$c(a){var r=a.chart,e=a.options,n=r.padding,o=r.appendPadding,s=e.color,l=e.colorField,c=e.pointStyle,u=e.hierarchyConfig,f=e.sizeField,d=e.rawFields,g=d===void 0?[]:d,p=e.drilldown,v=transformData$3({data:e.data,hierarchyConfig:u,enableDrillDown:p==null?void 0:p.enabled,rawFields:g});r.data(v);var m=r.viewBBox,y=resolvePaddingForCircle(n,o,m).finalSize,x=function(_){var E=_.r;return E*y};return f&&(x=function(_){return _[f]*y}),point(deepAssign({},a,{options:{xField:"x",yField:"y",seriesField:l,sizeField:f,rawFields:__spreadArray$2(__spreadArray$2([],RAW_FIELDS$1,!0),g,!0),point:{color:s,style:c,shape:"circle",size:x}}})),a}function meta$9(a){return flow(scale$2({},{x:{min:0,max:1,minLimit:0,maxLimit:1,nice:!0},y:{min:0,max:1,minLimit:0,maxLimit:1,nice:!0}}))(a)}function tooltip$3(a){var r=a.chart,e=a.options,n=e.tooltip;if(n===!1)r.tooltip(!1);else{var o=n;get(n,"fields")||(o=deepAssign({},{customItems:function(s){return s.map(function(l){var c=get(r.getOptions(),"scales"),u=get(c,["name","formatter"],function(d){return d}),f=get(c,["value","formatter"],function(d){return d});return __assign$8(__assign$8({},l),{name:u(l.data.name),value:f(l.data.value)})})}},o)),r.tooltip(o)}return a}function axis$a(a){var r=a.chart;return r.axis(!1),a}function adaptorInteraction$2(a){var r=a.drilldown,e=a.interactions,n=e===void 0?[]:e;return r!=null&&r.enabled?deepAssign({},a,{interactions:__spreadArray$2(__spreadArray$2([],n,!0),[{type:"drill-down",cfg:{drillDownConfig:r,transformData:transformData$3,enableDrillDown:!0}}],!1)}):a}function interaction$4(a){var r=a.chart,e=a.options;return interaction$8({chart:r,options:adaptorInteraction$2(e)}),a}function adaptor$e(a){return flow(pattern("pointStyle"),defaultOptions$3,padding$1,theme$2,meta$9,geometry$c,axis$a,legend$g,tooltip$3,interaction$4,animation$5,annotation$2())(a)}function isParentNode(a){var r=get(a,["event","data","data"],{});return isArray$4(r.children)&&r.children.length>0}function inCenter(a){var r=a.view.getCoordinate(),e=r.innerRadius;if(e){var n=a.event,o=n.x,s=n.y,l=r.center,c=l.x,u=l.y,f=r.getRadius()*e,d=Math.sqrt(Math.pow(c-o,2)+Math.pow(u-s,2));return d<f}return!1}registerAction("drill-down-action",DrillDownAction);registerInteraction("drill-down",{showEnable:[{trigger:"element:mouseenter",action:"cursor:pointer",isEnable:isParentNode},{trigger:"element:mouseleave",action:"cursor:default"},{trigger:"element:mouseleave",action:"cursor:pointer",isEnable:inCenter}],start:[{trigger:"element:click",isEnable:isParentNode,action:["drill-down-action:click"]},{trigger:"afterchangesize",action:["drill-down-action:resetPosition"]},{trigger:"click",isEnable:inCenter,action:["drill-down-action:back"]}]});var CirclePacking=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="circle-packing",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$g},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$e},r.prototype.triggerResize=function(){this.chart.destroyed||(this.chart.forceFit(),this.chart.clear(),this.execAdaptor(),this.chart.render(!0))},r}(Plot),LEFT_AXES_VIEW="left-axes-view",RIGHT_AXES_VIEW="right-axes-view",DEFAULT_YAXIS_CONFIG={nice:!0,label:{autoHide:!0,autoRotate:!1}},DEFAULT_LEFT_YAXIS_CONFIG=__assign$8(__assign$8({},DEFAULT_YAXIS_CONFIG),{position:"left"}),DEFAULT_RIGHT_YAXIS_CONFIG=__assign$8(__assign$8({},DEFAULT_YAXIS_CONFIG),{position:"right",grid:null}),AxisType;(function(a){a.Left="Left",a.Right="Right"})(AxisType||(AxisType={}));var DualAxesGeometry;(function(a){a.Line="line",a.Column="column"})(DualAxesGeometry||(DualAxesGeometry={}));function isLine(a){return get(a,"geometry")===DualAxesGeometry.Line}function isColumn(a){return get(a,"geometry")===DualAxesGeometry.Column}function getGeometryOption(a,r,e){return isColumn(e)?deepAssign({},{geometry:DualAxesGeometry.Column,label:e.label&&e.isRange?{content:function(n){var o;return(o=n[r])===null||o===void 0?void 0:o.join("-")}}:void 0},e):__assign$8({geometry:DualAxesGeometry.Line},e)}function transformObjectToArray(a,r){var e=a[0],n=a[1];if(isArray$4(r)){var o=r[0],s=r[1];return[o,s]}var l=get(r,e),c=get(r,n);return[l,c]}function getYAxisWithDefault(a,r){return r===AxisType.Left?a===!1?!1:deepAssign({},DEFAULT_LEFT_YAXIS_CONFIG,a):r===AxisType.Right?a===!1?!1:deepAssign({},DEFAULT_RIGHT_YAXIS_CONFIG,a):a}function drawSingleGeometry(a){var r=a.options,e=a.chart,n=r.geometryOption,o=n.isStack,s=n.color,l=n.seriesField,c=n.groupField,u=n.isGroup,f=["xField","yField"];if(isLine(n)){line(deepAssign({},a,{options:__assign$8(__assign$8(__assign$8({},pick(r,f)),n),{line:{color:n.color,style:n.lineStyle}})})),point(deepAssign({},a,{options:__assign$8(__assign$8(__assign$8({},pick(r,f)),n),{point:n.point&&__assign$8({color:s,shape:"circle"},n.point)})}));var d=[];u&&d.push({type:"dodge",dodgeBy:c||l,customOffset:0}),o&&d.push({type:"stack"}),d.length&&each$1(e.geometries,function(g){g.adjust(d)})}return isColumn(n)&&adaptor$w(deepAssign({},a,{options:__assign$8(__assign$8(__assign$8({},pick(r,f)),n),{widthRatio:n.columnWidthRatio,interval:__assign$8(__assign$8({},pick(n,["color"])),{style:n.columnStyle})})})),a}function getViewLegendItems(a){var r=a.view,e=a.geometryOption,n=a.yField,o=a.legend,s=get(o,"marker"),l=findGeometry(r,isLine(e)?"line":"interval");if(!e.seriesField){var c=get(r,"options.scales.".concat(n,".alias"))||n,u=l.getAttribute("color"),f=r.getTheme().defaultColor;u&&(f=Util.getMappingValue(u,c,get(u,["values",0],f)));var d=(isFunction$1(s)?s:!isEmpty(s)&&deepAssign({},{style:{stroke:f,fill:f}},s))||(isLine(e)?{symbol:function(p,v,m){return[["M",p-m,v],["L",p+m,v]]},style:{lineWidth:2,r:6,stroke:f}}:{symbol:"square",style:{fill:f}});return[{value:n,name:c,marker:d,isGeometry:!0,viewId:r.id}]}var g=l.getGroupAttributes();return reduce(g,function(p,v){var m=Util.getLegendItems(r,l,v,r.getTheme(),s);return p.concat(m)},[])}var doSliderFilter=function(a,r){var e=r[0],n=r[1],o=a.getOptions().data,s=a.getXScale(),l=size(o);if(!(!s||!l)){var c=valuesOfKey(o,s.field),u=c,f=size(u),d=Math.floor(e*(f-1)),g=Math.floor(n*(f-1));a.filter(s.field,function(p){var v=u.indexOf(p);return v>-1?isBetween(v,d,g):!0}),a.getRootView().render(!0)}};function transformOptions(a){var r,e=a.options,n=e.geometryOptions,o=n===void 0?[]:n,s=e.xField,l=e.yField,c=every(o,function(u){var f=u.geometry;return f===DualAxesGeometry.Line||f===void 0});return deepAssign({},{options:{geometryOptions:[],meta:(r={},r[s]={type:"cat",sync:!0,range:c?[0,1]:void 0},r),tooltip:{showMarkers:c,showCrosshairs:c,shared:!0,crosshairs:{type:"x"}},interactions:c?[{type:"legend-visible-filter"}]:[{type:"legend-visible-filter"},{type:"active-region"}],legend:{position:"top-left"}}},a,{options:{yAxis:transformObjectToArray(l,e.yAxis),geometryOptions:[getGeometryOption(s,l[0],o[0]),getGeometryOption(s,l[1],o[1])],annotations:transformObjectToArray(l,e.annotations)}})}function createViews(a){var r,e,n=a.chart,o=a.options,s=o.geometryOptions,l={line:0,column:1},c=[{type:(r=s[0])===null||r===void 0?void 0:r.geometry,id:LEFT_AXES_VIEW},{type:(e=s[1])===null||e===void 0?void 0:e.geometry,id:RIGHT_AXES_VIEW}];return c.sort(function(u,f){return-l[u.type]+l[f.type]}).forEach(function(u){return n.createView({id:u.id})}),a}function geometry$b(a){var r=a.chart,e=a.options,n=e.xField,o=e.yField,s=e.geometryOptions,l=e.data,c=e.tooltip,u=[__assign$8(__assign$8({},s[0]),{id:LEFT_AXES_VIEW,data:l[0],yField:o[0]}),__assign$8(__assign$8({},s[1]),{id:RIGHT_AXES_VIEW,data:l[1],yField:o[1]})];return u.forEach(function(f){var d=f.id,g=f.data,p=f.yField,v=isColumn(f)&&f.isPercent,m=v?percent(g,p,n,p):g,y=findViewById(r,d).data(m),x=v?__assign$8({formatter:function(_){return{name:_[f.seriesField]||p,value:(Number(_[p])*100).toFixed(2)+"%"}}},c):c;drawSingleGeometry({chart:y,options:{xField:n,yField:p,tooltip:x,geometryOption:f}})}),a}function color(a){var r,e=a.chart,n=a.options,o=n.geometryOptions,s=((r=e.getTheme())===null||r===void 0?void 0:r.colors10)||[],l=0;return e.once("beforepaint",function(){each$1(o,function(c,u){var f=findViewById(e,u===0?LEFT_AXES_VIEW:RIGHT_AXES_VIEW);if(!c.color){var d=f.getGroupScales(),g=get(d,[0,"values","length"],1),p=s.slice(l,l+g).concat(u===0?[]:s);f.geometries.forEach(function(v){c.seriesField?v.color(c.seriesField,p):v.color(p[0])}),l+=g}}),e.render(!0)}),a}function meta$8(a){var r,e,n=a.chart,o=a.options,s=o.xAxis,l=o.yAxis,c=o.xField,u=o.yField;return scale$2((r={},r[c]=s,r[u[0]]=l[0],r))(deepAssign({},a,{chart:findViewById(n,LEFT_AXES_VIEW)})),scale$2((e={},e[c]=s,e[u[1]]=l[1],e))(deepAssign({},a,{chart:findViewById(n,RIGHT_AXES_VIEW)})),a}function axis$9(a){var r=a.chart,e=a.options,n=findViewById(r,LEFT_AXES_VIEW),o=findViewById(r,RIGHT_AXES_VIEW),s=e.xField,l=e.yField,c=e.xAxis,u=e.yAxis;return r.axis(s,!1),r.axis(l[0],!1),r.axis(l[1],!1),n.axis(s,c),n.axis(l[0],getYAxisWithDefault(u[0],AxisType.Left)),o.axis(s,!1),o.axis(l[1],getYAxisWithDefault(u[1],AxisType.Right)),a}function tooltip$2(a){var r=a.chart,e=a.options,n=e.tooltip,o=findViewById(r,LEFT_AXES_VIEW),s=findViewById(r,RIGHT_AXES_VIEW);return r.tooltip(n),o.tooltip({shared:!0}),s.tooltip({shared:!0}),a}function interaction$3(a){var r=a.chart;return interaction$8(deepAssign({},a,{chart:findViewById(r,LEFT_AXES_VIEW)})),interaction$8(deepAssign({},a,{chart:findViewById(r,RIGHT_AXES_VIEW)})),a}function annotation$1(a){var r=a.chart,e=a.options,n=e.annotations,o=get(n,[0]),s=get(n,[1]);return annotation$2(o)(deepAssign({},a,{chart:findViewById(r,LEFT_AXES_VIEW),options:{annotations:o}})),annotation$2(s)(deepAssign({},a,{chart:findViewById(r,RIGHT_AXES_VIEW),options:{annotations:s}})),a}function theme(a){var r=a.chart;return theme$2(deepAssign({},a,{chart:findViewById(r,LEFT_AXES_VIEW)})),theme$2(deepAssign({},a,{chart:findViewById(r,RIGHT_AXES_VIEW)})),theme$2(a),a}function animation$2(a){var r=a.chart;return animation$5(deepAssign({},a,{chart:findViewById(r,LEFT_AXES_VIEW)})),animation$5(deepAssign({},a,{chart:findViewById(r,RIGHT_AXES_VIEW)})),a}function limitInPlot(a){var r=a.chart,e=a.options,n=e.yAxis;return limitInPlot$2(deepAssign({},a,{chart:findViewById(r,LEFT_AXES_VIEW),options:{yAxis:n[0]}})),limitInPlot$2(deepAssign({},a,{chart:findViewById(r,RIGHT_AXES_VIEW),options:{yAxis:n[1]}})),a}function legend$6(a){var r=a.chart,e=a.options,n=e.legend,o=e.geometryOptions,s=e.yField,l=e.data,c=findViewById(r,LEFT_AXES_VIEW),u=findViewById(r,RIGHT_AXES_VIEW);if(n===!1)r.legend(!1);else if(isObject$1(n)&&n.custom===!0)r.legend(n);else{var f=get(o,[0,"legend"],n),d=get(o,[1,"legend"],n);r.once("beforepaint",function(){var g=l[0].length?getViewLegendItems({view:c,geometryOption:o[0],yField:s[0],legend:f}):[],p=l[1].length?getViewLegendItems({view:u,geometryOption:o[1],yField:s[1],legend:d}):[];r.legend(deepAssign({},n,{custom:!0,items:g.concat(p)}))}),o[0].seriesField&&c.legend(o[0].seriesField,f),o[1].seriesField&&u.legend(o[1].seriesField,d),r.on("legend-item:click",function(g){var p=get(g,"gEvent.delegateObject",{});if(p&&p.item){var v=p.item,m=v.value,y=v.isGeometry,x=v.viewId;if(y){var _=findIndex$1(s,function(A){return A===m});if(_>-1){var E=get(findViewById(r,x),"geometries");each$1(E,function(A){A.changeVisible(!p.item.unchecked)})}}else{var S=get(r.getController("legend"),"option.items",[]);each$1(r.views,function(A){var T=A.getGroupScales();each$1(T,function(b){b.values&&b.values.indexOf(m)>-1&&A.filter(b.field,function(C){var L=find$2(S,function(R){return R.value===C});return!L.unchecked})}),r.render(!0)})}}})}return a}function slider(a){var r=a.chart,e=a.options,n=e.slider,o=findViewById(r,LEFT_AXES_VIEW),s=findViewById(r,RIGHT_AXES_VIEW);return n&&(o.option("slider",n),o.on("slider:valuechanged",function(l){var c=l.event,u=c.value,f=c.originValue;isEqual$1(u,f)||doSliderFilter(s,u)}),r.once("afterpaint",function(){if(!isBoolean(n)){var l=n.start,c=n.end;(l||c)&&doSliderFilter(s,[l,c])}})),a}function adaptor$d(a){return flow(transformOptions,createViews,theme,geometry$b,meta$8,axis$9,limitInPlot,tooltip$2,interaction$3,annotation$1,animation$2,color,legend$6,slider)(a)}var DualAxes=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="dual-axes",e}return r.prototype.getDefaultOptions=function(){return deepAssign({},a.prototype.getDefaultOptions.call(this),{yAxis:[],syncViewPadding:!0})},r.prototype.getSchemaAdaptor=function(){return adaptor$d},r}(Plot);function execViewAdaptor(a,r){var e=r.data,n=r.coordinate,o=r.interactions,s=r.annotations,l=r.animation,c=r.tooltip,u=r.axes,f=r.meta,d=r.geometries;e&&a.data(e);var g={};u&&each$1(u,function(p,v){g[v]=pick(p,AXIS_META_CONFIG_KEYS)}),g=deepAssign({},f,g),a.scale(g),n&&a.coordinate(n),u===!1?a.axis(!1):each$1(u,function(p,v){a.axis(v,p)}),each$1(d,function(p){var v=geometry$x({chart:a,options:p}).ext,m=p.adjust;m&&v.geometry.adjust(m)}),each$1(o,function(p){p.enable===!1?a.removeInteraction(p.type):a.interaction(p.type,p.cfg)}),each$1(s,function(p){a.annotation()[p.type](__assign$8({},p))}),addViewAnimation(a,l),c?(a.interaction("tooltip"),a.tooltip(c)):c===!1&&a.removeInteraction("tooltip")}function facetAdaptor(a){var r=a.chart,e=a.options,n=e.type,o=e.data,s=e.fields,l=e.eachView,c=omit$1(e,["type","data","fields","eachView","axes","meta","tooltip","coordinate","theme","legend","interactions","annotations"]);return r.data(o),r.facet(n,__assign$8(__assign$8({},c),{fields:s,eachView:function(u,f){var d=l(u,f);if(d.geometries)execViewAdaptor(u,d);else{var g=d,p=g.options;p.tooltip&&u.interaction("tooltip"),execPlotAdaptor(g.type,u,p)}}})),a}function component(a){var r=a.chart,e=a.options,n=e.axes,o=e.meta,s=e.tooltip,l=e.coordinate,c=e.theme,u=e.legend,f=e.interactions,d=e.annotations,g={};return n&&each$1(n,function(p,v){g[v]=pick(p,AXIS_META_CONFIG_KEYS)}),g=deepAssign({},o,g),r.scale(g),r.coordinate(l),n?each$1(n,function(p,v){r.axis(v,p)}):r.axis(!1),s?(r.interaction("tooltip"),r.tooltip(s)):s===!1&&r.removeInteraction("tooltip"),r.legend(u),c&&r.theme(c),each$1(f,function(p){p.enable===!1?r.removeInteraction(p.type):r.interaction(p.type,p.cfg)}),each$1(d,function(p){r.annotation()[p.type](__assign$8({},p))}),a}function adaptor$c(a){return flow(theme$2,facetAdaptor,component)(a)}var DEFAULT_OPTIONS$e={title:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}},rowTitle:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}},columnTitle:{style:{fontSize:12,fill:"rgba(0,0,0,0.65)"}}},Facet=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="area",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$e},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$c},r}(Plot);function geometry$a(a){var r=a.chart,e=a.options,n=e.data,o=e.type,s=e.xField,l=e.yField,c=e.colorField,u=e.sizeField,f=e.sizeRatio,d=e.shape,g=e.color,p=e.tooltip,v=e.heatmapStyle,m=e.meta;r.data(n);var y="polygon";o==="density"&&(y="heatmap");var x=getTooltipMapping(p,[s,l,c]),_=x.fields,E=x.formatter,S=1;return(f||f===0)&&(!d&&!u?console.warn("sizeRatio is not in effect: Must define shape or sizeField first"):f<0||f>1?console.warn("sizeRatio is not in effect: It must be a number in [0,1]"):S=f),geometry$x(deepAssign({},a,{options:{type:y,colorField:c,tooltipFields:_,shapeField:u||"",label:void 0,mapping:{tooltip:E,shape:d&&(u?function(A){var T=n.map(function(R){return R[u]}),b=(m==null?void 0:m[u])||{},C=b.min,L=b.max;return C=isNumber$2(C)?C:Math.min.apply(Math,T),L=isNumber$2(L)?L:Math.max.apply(Math,T),[d,(get(A,u)-C)/(L-C),S]}:function(){return[d,1,S]}),color:g||c&&r.getTheme().sequenceColors.join("-"),style:v}}})),a}function meta$7(a){var r,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField,l=e.yField;return flow(scale$2((r={},r[s]=n,r[l]=o,r)))(a)}function axis$8(a){var r=a.chart,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField,l=e.yField;return n===!1?r.axis(s,!1):r.axis(s,n),o===!1?r.axis(l,!1):r.axis(l,o),a}function legend$5(a){var r=a.chart,e=a.options,n=e.legend,o=e.colorField,s=e.sizeField,l=e.sizeLegend,c=n!==!1;return o&&r.legend(o,c?n:!1),s&&r.legend(s,l===void 0?n:l),!c&&!l&&r.legend(!1),a}function label$6(a){var r=a.chart,e=a.options,n=e.label,o=e.colorField,s=e.type,l=findGeometry(r,s==="density"?"heatmap":"polygon");if(!n)l.label(!1);else if(o){var c=n.callback,u=__rest$1(n,["callback"]);l.label({fields:[o],callback:c,cfg:transformLabel(u)})}return a}function coordinate$3(a){var r,e,n=a.chart,o=a.options,s=o.coordinate,l=o.reflect,c=deepAssign({actions:[]},s??{type:"rect"});return l&&((e=(r=c.actions)===null||r===void 0?void 0:r.push)===null||e===void 0||e.call(r,["reflect",l])),n.coordinate(c),a}function adaptor$b(a){return flow(theme$2,pattern("heatmapStyle"),meta$7,coordinate$3,geometry$a,axis$8,legend$5,tooltip$9,label$6,annotation$2(),interaction$8,animation$5,state)(a)}var DEFAULT_OPTIONS$d=deepAssign({},Plot.getDefaultOptions(),{type:"polygon",legend:!1,coordinate:{type:"rect"},xAxis:{tickLine:null,line:null,grid:{alignTick:!1,line:{style:{lineWidth:1,lineDash:null,stroke:"#f0f0f0"}}}},yAxis:{grid:{alignTick:!1,line:{style:{lineWidth:1,lineDash:null,stroke:"#f0f0f0"}}}}});registerShape("polygon","circle",{draw:function(a,r){var e,n,o=a.x,s=a.y,l=this.parsePoints(a.points),c=Math.abs(l[2].x-l[1].x),u=Math.abs(l[1].y-l[0].y),f=Math.min(c,u)/2,d=Number(a.shape[1]),g=Number(a.shape[2]),p=Math.sqrt(g),v=f*p*Math.sqrt(d),m=((e=a.style)===null||e===void 0?void 0:e.fill)||a.color||((n=a.defaultStyle)===null||n===void 0?void 0:n.fill),y=r.addShape("circle",{attrs:__assign$8(__assign$8(__assign$8({x:o,y:s,r:v},a.defaultStyle),a.style),{fill:m})});return y}});registerShape("polygon","square",{draw:function(a,r){var e,n,o=a.x,s=a.y,l=this.parsePoints(a.points),c=Math.abs(l[2].x-l[1].x),u=Math.abs(l[1].y-l[0].y),f=Math.min(c,u),d=Number(a.shape[1]),g=Number(a.shape[2]),p=Math.sqrt(g),v=f*p*Math.sqrt(d),m=((e=a.style)===null||e===void 0?void 0:e.fill)||a.color||((n=a.defaultStyle)===null||n===void 0?void 0:n.fill),y=r.addShape("rect",{attrs:__assign$8(__assign$8(__assign$8({x:o-v/2,y:s-v/2,width:v,height:v},a.defaultStyle),a.style),{fill:m})});return y}});var Heatmap=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="heatmap",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$d},r.prototype.getSchemaAdaptor=function(){return adaptor$b},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r}(Plot),CAT_VALUE="liquid";function getLiquidData(a){return[{percent:a,type:CAT_VALUE}]}function geometry$9(a){var r=a.chart,e=a.options,n=e.percent,o=e.liquidStyle,s=e.radius,l=e.outline,c=e.wave,u=e.shape,f=e.shapeStyle,d=e.animation;r.scale({percent:{min:0,max:1}}),r.data(getLiquidData(n));var g=e.color||r.getTheme().defaultColor,p=deepAssign({},a,{options:{xField:"type",yField:"percent",widthRatio:s,interval:{color:g,style:o,shape:"liquid-fill-gauge"}}}),v=interval(p).ext,m=v.geometry,y=r.getTheme().background,x={percent:n,radius:s,outline:l,wave:c,shape:u,shapeStyle:f,background:y,animation:d};return m.customInfo(x),r.legend(!1),r.axis(!1),r.tooltip(!1),a}function statistic(a,r){var e=a.chart,n=a.options,o=n.statistic,s=n.percent,l=n.meta;e.getController("annotation").clear(!0);var c=get(l,["percent","formatter"])||function(f){return"".concat((f*100).toFixed(2),"%")},u=o.content;return u&&(u=deepAssign({},u,{content:isNil(u.content)?c(s):u.content})),renderStatistic(e,{statistic:__assign$8(__assign$8({},o),{content:u}),plotType:"liquid"},{percent:s}),r&&e.render(!0),a}function adaptor$a(a){return flow(theme$2,pattern("liquidStyle"),geometry$9,statistic,scale$2({}),animation$5,interaction$8)(a)}var DEFAULT_OPTIONS$c={radius:.9,statistic:{title:!1,content:{style:{opacity:.75,fontSize:"30px",lineHeight:"30px",textAlign:"center"}}},outline:{border:2,distance:0},wave:{count:3,length:192},shape:"circle"},DURATION=5e3;function lerp(a,r,e){return a+(r-a)*e}function getFillAttrs$2(a){var r=__assign$8({opacity:1},a.style);return a.color&&!r.fill&&(r.fill=a.color),r}function getLineAttrs(a){var r={fill:"#fff",fillOpacity:0,lineWidth:4},e=mix({},r,a.style);return a.color&&!e.stroke&&(e.stroke=a.color),isNumber$2(a.opacity)&&(e.opacity=e.strokeOpacity=a.opacity),e}function getWaterWavePositions(a,r,e,n){return r===0?[[a+1/2*e/Math.PI/2,n/2],[a+1/2*e/Math.PI,n],[a+e/4,n]]:r===1?[[a+1/2*e/Math.PI/2*(Math.PI-2),n],[a+1/2*e/Math.PI/2*(Math.PI-1),n/2],[a+e/4,0]]:r===2?[[a+1/2*e/Math.PI/2,-n/2],[a+1/2*e/Math.PI,-n],[a+e/4,-n]]:[[a+1/2*e/Math.PI/2*(Math.PI-2),-n],[a+1/2*e/Math.PI/2*(Math.PI-1),-n/2],[a+e/4,0]]}function getWaterWavePath(a,r,e,n,o,s,l){for(var c=Math.ceil(2*a/e*4)*4,u=[],f=n;f<-Math.PI*2;)f+=Math.PI*2;for(;f>0;)f-=Math.PI*2;f=f/Math.PI/2*e;var d=s-a+f-a*2;u.push(["M",d,r]);for(var g=0,p=0;p<c;++p){var v=p%4,m=getWaterWavePositions(p*e/4,v,e,o);u.push(["C",m[0][0]+d,-m[0][1]+r,m[1][0]+d,-m[1][1]+r,m[2][0]+d,-m[2][1]+r]),p===c-1&&(g=m[2][0])}return u.push(["L",g+d,l+a]),u.push(["L",d,l+a]),u.push(["Z"]),u}function addWaterWave(a,r,e,n,o,s,l,c,u,f){for(var d=o.fill,g=o.opacity,p=l.getBBox(),v=p.maxX-p.minX,m=p.maxY-p.minY,y=0;y<n;y++){var x=n<=1?1:y/(n-1),_=s.addShape("path",{name:"waterwave-path",attrs:{path:getWaterWavePath(c,p.minY+m*e,u,0,v/32,a,r),fill:d,opacity:lerp(.2,.9,x)*g}});try{if(f===!1)return;var E=transform$2([["t",u,0]]);_.stopAnimate(),_.animate({matrix:E},{duration:lerp(.5*DURATION,DURATION,x),repeat:!0})}catch{console.warn("off-screen group animate error!")}}}function pin(a,r,e,n){var o=e*2/3,s=Math.max(o,n),l=o/2,c=a,u=l+r-s/2,f=Math.asin(l/((s-l)*.85)),d=Math.sin(f)*l,g=Math.cos(f)*l,p=c-g,v=u+d,m=a,y=u+l/Math.sin(f);return`
      M `.concat(p," ").concat(v,`
      A `).concat(l," ").concat(l," 0 1 1 ").concat(p+g*2," ").concat(v,`
      Q `).concat(m," ").concat(y," ").concat(a," ").concat(r+s/2,`
      Q `).concat(m," ").concat(y," ").concat(p," ").concat(v,`
      Z 
    `)}function circle(a,r,e,n){var o=e/2,s=n/2;return`
      M `.concat(a," ").concat(r-s,` 
      a `).concat(o," ").concat(s," 0 1 0 0 ").concat(s*2,`
      a `).concat(o," ").concat(s," 0 1 0 0 ").concat(-s*2,`
      Z
    `)}function diamond(a,r,e,n){var o=n/2,s=e/2;return`
      M `.concat(a," ").concat(r-o,`
      L `).concat(a+s," ").concat(r,`
      L `).concat(a," ").concat(r+o,`
      L `).concat(a-s," ").concat(r,`
      Z
    `)}function triangle(a,r,e,n){var o=n/2,s=e/2;return`
      M `.concat(a," ").concat(r-o,`
      L `).concat(a+s," ").concat(r+o,`
      L `).concat(a-s," ").concat(r+o,`
      Z
    `)}function rect(a,r,e,n){var o=.618,s=n/2,l=e/2*o;return`
      M `.concat(a-l," ").concat(r-s,`
      L `).concat(a+l," ").concat(r-s,`
      L `).concat(a+l," ").concat(r+s,`
      L `).concat(a-l," ").concat(r+s,`
      Z
    `)}var builtInShapeByName={pin,circle,diamond,triangle,rect};registerShape("interval","liquid-fill-gauge",{draw:function(a,r){var e=.5,n=.5,o=a.customInfo,s=o,l=s.percent,c=s.radius,u=s.shape,f=s.shapeStyle,d=s.background,g=s.animation,p=o.outline,v=o.wave,m=p.border,y=p.distance,x=v.count,_=v.length,E=reduce(a.points,function(O,F){return Math.min(O,F.x)},1/0),S=this.parsePoint({x:e,y:n}),A=this.parsePoint({x:E,y:n}),T=S.x-A.x,b=Math.min(T,A.y*c),C=getFillAttrs$2(a),L=getLineAttrs(mix({},a,p)),R=b-m/2,I=typeof u=="function"?u:builtInShapeByName[u]||builtInShapeByName.circle,w=I(S.x,S.y,R*2,R*2);if(f&&r.addShape("path",{name:"shape",attrs:__assign$8({path:w},f)}),l>0){var M=r.addGroup({name:"waves"}),D=M.setClip({type:"path",attrs:{path:w}});addWaterWave(S.x,S.y,1-a.points[1].y,x,C,M,D,b*2,_,g)}return r.addShape("path",{name:"distance",attrs:{path:w,fill:"transparent",lineWidth:m+y*2,stroke:d==="transparent"?"#fff":d}}),r.addShape("path",{name:"wrap",attrs:mix(L,{path:w,fill:"transparent",lineWidth:m})}),r}});var Liquid=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="liquid",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$c},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.changeData=function(e){this.chart.emit(VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,Event$1.fromData(this.chart,VIEW_LIFE_CIRCLE.BEFORE_CHANGE_DATA,null)),this.updateOption({percent:e}),this.chart.data(getLiquidData(e)),statistic({chart:this.chart,options:this.options},!0),this.chart.emit(VIEW_LIFE_CIRCLE.AFTER_CHANGE_DATA,Event$1.fromData(this.chart,VIEW_LIFE_CIRCLE.AFTER_CHANGE_DATA,null))},r.prototype.getSchemaAdaptor=function(){return adaptor$a},r}(Plot);function geometry$8(a){var r=a.chart,e=a.options,n=e.data,o=e.lineStyle,s=e.color,l=e.point,c=e.area;r.data(n);var u=deepAssign({},a,{options:{line:{style:o,color:s},point:l&&__assign$8({color:s},l),area:c&&__assign$8({color:s},c),label:void 0}}),f=deepAssign({},u,{options:{tooltip:!1}}),d=(l==null?void 0:l.state)||e.state,g=deepAssign({},u,{options:{tooltip:!1,state:d}});return line(u),point(g),area(f),a}function meta$6(a){var r,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField,l=e.yField;return flow(scale$2((r={},r[s]=n,r[l]=o,r)))(a)}function coord(a){var r=a.chart,e=a.options,n=e.radius,o=e.startAngle,s=e.endAngle;return r.coordinate("polar",{radius:n,startAngle:o,endAngle:s}),a}function axis$7(a){var r=a.chart,e=a.options,n=e.xField,o=e.xAxis,s=e.yField,l=e.yAxis;return r.axis(n,o),r.axis(s,l),a}function label$5(a){var r=a.chart,e=a.options,n=e.label,o=e.yField,s=findGeometry(r,"line");if(!n)s.label(!1);else{var l=n.callback,c=__rest$1(n,["callback"]);s.label({fields:[o],callback:l,cfg:transformLabel(c)})}return a}function adaptor$9(a){return flow(geometry$8,meta$6,theme$2,coord,axis$7,legend$g,tooltip$9,label$5,interaction$8,animation$5,annotation$2())(a)}var RadarTooltipController=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return Object.defineProperty(r.prototype,"name",{get:function(){return"radar-tooltip"},enumerable:!1,configurable:!0}),r.prototype.getTooltipItems=function(e){var n=this.getTooltipCfg(),o=n.shared,s=n.title,l=a.prototype.getTooltipItems.call(this,e);if(l.length>0){var c=this.view.geometries[0],u=c.dataArray,f=l[0].name,d=[];return u.forEach(function(g){g.forEach(function(p){var v=Util.getTooltipItems(p,c),m=v[0];if(!o&&m&&m.name===f){var y=isNil(s)?f:s;d.push(__assign$8(__assign$8({},m),{name:m.title,title:y}))}else if(o&&m){var y=isNil(s)?m.name||f:s;d.push(__assign$8(__assign$8({},m),{name:m.title,title:y}))}})}),d}return[]},r}(Tooltip);registerComponentController("radar-tooltip",RadarTooltipController);var RadarTooltipAction=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.init=function(){var e=this.context.view;e.removeInteraction("tooltip")},r.prototype.show=function(){var e=this.context.event,n=this.getTooltipController();n.showTooltip({x:e.x,y:e.y})},r.prototype.hide=function(){var e=this.getTooltipController();e.hideTooltip()},r.prototype.getTooltipController=function(){var e=this.context.view;return e.getController("radar-tooltip")},r}(Action);registerAction("radar-tooltip",RadarTooltipAction);registerInteraction("radar-tooltip",{start:[{trigger:"plot:mousemove",action:"radar-tooltip:show"}],end:[{trigger:"plot:mouseleave",action:"radar-tooltip:hide"}]});var Radar=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="radar",e}return r.prototype.changeData=function(e){this.updateOption({data:e}),this.chart.changeData(e)},r.prototype.getDefaultOptions=function(){return deepAssign({},a.prototype.getDefaultOptions.call(this),{xAxis:{label:{offset:15},grid:{line:{type:"line"}}},yAxis:{grid:{line:{type:"circle"}}},legend:{position:"top"},tooltip:{shared:!0,showCrosshairs:!0,showMarkers:!0,crosshairs:{type:"xy",line:{style:{stroke:"#565656",lineDash:[4]}},follow:!0}}})},r.prototype.getSchemaAdaptor=function(){return adaptor$9},r}(Plot);function getScaleMax(a,r,e){var n=e.map(function(l){return l[r]}).filter(function(l){return l!==void 0}),o=n.length>0?Math.max.apply(Math,n):0,s=Math.abs(a)%360;return s?o*360/s:o}function getStackedData(a,r,e){var n=[];return a.forEach(function(o){var s=n.find(function(l){return l[r]===o[r]});s?s[e]+=o[e]||null:n.push(__assign$8({},o))}),n}function geometry$7(a){var r=a.chart,e=a.options,n=e.barStyle,o=e.color,s=e.tooltip,l=e.colorField,c=e.type,u=e.xField,f=e.yField,d=e.data,g=e.shape,p=processIllegalData(d,f);r.data(p);var v=deepAssign({},a,{options:{tooltip:s,seriesField:l,interval:{style:n,color:o,shape:g||(c==="line"?"line":"intervel")},minColumnWidth:e.minBarWidth,maxColumnWidth:e.maxBarWidth,columnBackground:e.barBackground}});return interval(v),c==="line"&&point({chart:r,options:{xField:u,yField:f,seriesField:l,point:{shape:"circle",color:o}}}),a}function meta$5(a){var r,e=a.options,n=e.yField,o=e.xField,s=e.data,l=e.isStack,c=e.isGroup,u=e.colorField,f=e.maxAngle,d=l&&!c&&u?getStackedData(s,o,n):s,g=processIllegalData(d,n);return flow(scale$2((r={},r[n]={min:0,max:getScaleMax(f,n,g)},r)))(a)}function coordinate$2(a){var r=a.chart,e=a.options,n=e.radius,o=e.innerRadius,s=e.startAngle,l=e.endAngle;return r.coordinate({type:"polar",cfg:{radius:n,innerRadius:o,startAngle:s,endAngle:l}}).transpose(),a}function axis$6(a){var r=a.chart,e=a.options,n=e.xField,o=e.xAxis;return r.axis(n,o),a}function label$4(a){var r=a.chart,e=a.options,n=e.label,o=e.yField,s=findGeometry(r,"interval");if(!n)s.label(!1);else{var l=n.callback,c=__rest$1(n,["callback"]);s.label({fields:[o],callback:l,cfg:__assign$8(__assign$8({},transformLabel(c)),{type:"polar"})})}return a}function adaptor$8(a){return flow(pattern("barStyle"),geometry$7,meta$5,axis$6,coordinate$2,interaction$8,animation$5,theme$2,tooltip$9,legend$g,annotation$2(),label$4)(a)}var DEFAULT_OPTIONS$b=deepAssign({},Plot.getDefaultOptions(),{interactions:[{type:"element-active"}],legend:!1,tooltip:{showMarkers:!1},xAxis:{grid:null,tickLine:null,line:null},maxAngle:240}),RadialBar=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="radial-bar",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$b},r.prototype.changeData=function(e){this.updateOption({data:e}),meta$5({chart:this.chart,options:this.options}),this.chart.changeData(e)},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$8},r}(Plot);function geometry$6(a){var r=a.chart,e=a.options,n=e.data,o=e.sectorStyle,s=e.shape,l=e.color;return r.data(n),flow(interval)(deepAssign({},a,{options:{marginRatio:1,interval:{style:o,color:l,shape:s}}})),a}function label$3(a){var r=a.chart,e=a.options,n=e.label,o=e.xField,s=findGeometry(r,"interval");if(n===!1)s.label(!1);else if(isObject$1(n)){var l=n.callback,c=n.fields,u=__rest$1(n,["callback","fields"]),f=u.offset,d=u.layout;(f===void 0||f>=0)&&(d=d?isArray$4(d)?d:[d]:[],u.layout=filter(d,function(g){return g.type!=="limit-in-shape"}),u.layout.length||delete u.layout),s.label({fields:c||[o],callback:l,cfg:transformLabel(u)})}else log(LEVEL.WARN,n===null,"the label option must be an Object."),s.label({fields:[o]});return a}function legend$4(a){var r=a.chart,e=a.options,n=e.legend,o=e.seriesField;return n===!1?r.legend(!1):o&&r.legend(o,n),a}function coordinate$1(a){var r=a.chart,e=a.options,n=e.radius,o=e.innerRadius,s=e.startAngle,l=e.endAngle;return r.coordinate({type:"polar",cfg:{radius:n,innerRadius:o,startAngle:s,endAngle:l}}),a}function meta$4(a){var r,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField,l=e.yField;return flow(scale$2((r={},r[s]=n,r[l]=o,r)))(a)}function axis$5(a){var r=a.chart,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField,l=e.yField;return n?r.axis(s,n):r.axis(s,!1),o?r.axis(l,o):r.axis(l,!1),a}function adaptor$7(a){flow(pattern("sectorStyle"),geometry$6,meta$4,label$3,coordinate$1,axis$5,legend$4,tooltip$9,interaction$8,animation$5,theme$2,annotation$2(),state)(a)}var DEFAULT_OPTIONS$a=deepAssign({},Plot.getDefaultOptions(),{xAxis:!1,yAxis:!1,legend:{position:"right",radio:{}},sectorStyle:{stroke:"#fff",lineWidth:1},label:{layout:{type:"limit-in-shape"}},tooltip:{shared:!0,showMarkers:!1},interactions:[{type:"active-region"}]}),Rose=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="rose",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$a},r.prototype.changeData=function(e){this.updateOption({data:e}),this.chart.changeData(e)},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$7},r}(Plot),X_FIELD$1="x",Y_FIELD$1="y",COLOR_FIELD="name",NODES_VIEW_ID="nodes",EDGES_VIEW_ID="edges";function getNodes(a,r,e){var n=[];return a.forEach(function(o){var s=o[r],l=o[e];n.includes(s)||n.push(s),n.includes(l)||n.push(l)}),n}function getMatrix(a,r,e,n){var o={};return r.forEach(function(s){o[s]={},r.forEach(function(l){o[s][l]=0})}),a.forEach(function(s){o[s[e]][s[n]]=1}),o}function cutoffCircle(a,r,e){if(!isArray$4(a))return[];var n=[],o=getNodes(a,r,e),s=getMatrix(a,o,r,e),l={};o.forEach(function(u){l[u]=0});function c(u){l[u]=1,o.forEach(function(f){if(s[u][f]!=0)if(l[f]==1)n.push("".concat(u,"_").concat(f));else{if(l[f]==-1)return;c(f)}}),l[u]=-1}return o.forEach(function(u){l[u]!=-1&&c(u)}),n.length!==0&&console.warn("sankey data contains circle, ".concat(n.length," records removed."),n),a.filter(function(u){return n.findIndex(function(f){return f==="".concat(u[r],"_").concat(u[e])})<0})}function targetDepth(a){return a.target.depth}function left(a){return a.depth}function right(a,r){return r-1-a.height}function justify(a,r){return a.sourceLinks.length?a.depth:r-1}function center$1(a){return a.targetLinks.length?a.depth:a.sourceLinks.length?minBy(a.sourceLinks,targetDepth)-1:0}function constant(a){return function(){return a}}function sumBy(a,r){for(var e=0,n=0;n<a.length;n++)e+=r(a[n]);return e}function maxValueBy(a,r){for(var e=-1/0,n=0;n<a.length;n++)e=Math.max(r(a[n]),e);return e}function minValueBy(a,r){for(var e=1/0,n=0;n<a.length;n++)e=Math.min(r(a[n]),e);return e}function ascendingSourceBreadth(a,r){return ascendingBreadth(a.source,r.source)||a.index-r.index}function ascendingTargetBreadth(a,r){return ascendingBreadth(a.target,r.target)||a.index-r.index}function ascendingBreadth(a,r){return a.y0-r.y0}function value(a){return a.value}function defaultId(a){return a.index}function defaultNodes(a){return a.nodes}function defaultLinks(a){return a.links}function find$1(a,r){var e=a.get(r);if(!e)throw new Error("missing: "+r);return e}function computeLinkBreadths(a){for(var r=a.nodes,e=0,n=r;e<n.length;e++){for(var o=n[e],s=o.y0,l=s,c=0,u=o.sourceLinks;c<u.length;c++){var f=u[c];f.y0=s+f.width/2,s+=f.width}for(var d=0,g=o.targetLinks;d<g.length;d++){var f=g[d];f.y1=l+f.width/2,l+=f.width}}}function Sankey$1(){var a=0,r=0,e=1,n=1,o=24,s=8,l,c=defaultId,u=justify,f,d,g,p=defaultNodes,v=defaultLinks,m=6;function y(k){var $={nodes:p(k),links:v(k)};return x($),_($),E($),S($),b($),computeLinkBreadths($),$}y.update=function(k){return computeLinkBreadths(k),k},y.nodeId=function(k){return arguments.length?(c=typeof k=="function"?k:constant(k),y):c},y.nodeAlign=function(k){return arguments.length?(u=typeof k=="function"?k:constant(k),y):u},y.nodeDepth=function(k){return arguments.length?(f=k,y):f},y.nodeSort=function(k){return arguments.length?(d=k,y):d},y.nodeWidth=function(k){return arguments.length?(o=+k,y):o},y.nodePadding=function(k){return arguments.length?(s=l=+k,y):s},y.nodes=function(k){return arguments.length?(p=typeof k=="function"?k:constant(k),y):p},y.links=function(k){return arguments.length?(v=typeof k=="function"?k:constant(k),y):v},y.linkSort=function(k){return arguments.length?(g=k,y):g},y.size=function(k){return arguments.length?(a=r=0,e=+k[0],n=+k[1],y):[e-a,n-r]},y.extent=function(k){return arguments.length?(a=+k[0][0],e=+k[1][0],r=+k[0][1],n=+k[1][1],y):[[a,r],[e,n]]},y.iterations=function(k){return arguments.length?(m=+k,y):m};function x(k){var $=k.nodes,V=k.links;$.forEach(function(Y,K){Y.index=K,Y.sourceLinks=[],Y.targetLinks=[]});var N=new Map($.map(function(Y){return[c(Y),Y]}));if(V.forEach(function(Y,K){Y.index=K;var Z=Y.source,tt=Y.target;typeof Z!="object"&&(Z=Y.source=find$1(N,Z)),typeof tt!="object"&&(tt=Y.target=find$1(N,tt)),Z.sourceLinks.push(Y),tt.targetLinks.push(Y)}),g!=null)for(var B=0,G=$;B<G.length;B++){var z=G[B],H=z.sourceLinks,W=z.targetLinks;H.sort(g),W.sort(g)}}function _(k){for(var $=k.nodes,V=0,N=$;V<N.length;V++){var B=N[V];B.value=B.fixedValue===void 0?Math.max(sumBy(B.sourceLinks,value),sumBy(B.targetLinks,value)):B.fixedValue}}function E(k){for(var $=k.nodes,V=$.length,N=new Set($),B=new Set,G=0;N.size;){if(N.forEach(function(Y){Y.depth=G;for(var K=0,Z=Y.sourceLinks;K<Z.length;K++){var tt=Z[K].target;B.add(tt)}}),++G>V)throw new Error("circular link");N=B,B=new Set}if(f)for(var z=Math.max(maxValueBy($,function(Y){return Y.depth})+1,0),H=void 0,W=0;W<$.length;W++)H=$[W],H.depth=f.call(null,H,z)}function S(k){for(var $=k.nodes,V=$.length,N=new Set($),B=new Set,G=0;N.size;){if(N.forEach(function(z){z.height=G;for(var H=0,W=z.targetLinks;H<W.length;H++){var Y=W[H].source;B.add(Y)}}),++G>V)throw new Error("circular link");N=B,B=new Set}}function A(k){for(var $=k.nodes,V=Math.max(maxValueBy($,function(tt){return tt.depth})+1,0),N=(e-a-o)/(V-1),B=new Array(V).fill(0).map(function(){return[]}),G=0,z=$;G<z.length;G++){var H=z[G],W=Math.max(0,Math.min(V-1,Math.floor(u.call(null,H,V))));H.layer=W,H.x0=a+W*N,H.x1=H.x0+o,B[W]?B[W].push(H):B[W]=[H]}if(d)for(var Y=0,K=B;Y<K.length;Y++){var Z=K[Y];Z.sort(d)}return B}function T(k){for(var $=minValueBy(k,function(et){return(n-r-(et.length-1)*l)/sumBy(et,value)}),V=0,N=k;V<N.length;V++){for(var B=N[V],G=r,z=0,H=B;z<H.length;z++){var W=H[z];W.y0=G,W.y1=G+W.value*$,G=W.y1+l;for(var Y=0,K=W.sourceLinks;Y<K.length;Y++){var Z=K[Y];Z.width=Z.value*$}}G=(n-G+l)/(B.length+1);for(var tt=0;tt<B.length;++tt){var W=B[tt];W.y0+=G*(tt+1),W.y1+=G*(tt+1)}D(B)}}function b(k){var $=A(k);l=Math.min(s,(n-r)/(maxValueBy($,function(G){return G.length})-1)),T($);for(var V=0;V<m;++V){var N=Math.pow(.99,V),B=Math.max(1-N,(V+1)/m);L($,N,B),C($,N,B)}}function C(k,$,V){for(var N=1,B=k.length;N<B;++N){for(var G=k[N],z=0,H=G;z<H.length;z++){for(var W=H[z],Y=0,K=0,Z=0,tt=W.targetLinks;Z<tt.length;Z++){var et=tt[Z],at=et.source,ot=et.value,nt=ot*(W.layer-at.layer);Y+=O(at,W)*nt,K+=nt}if(K>0){var Q=(Y/K-W.y0)*$;W.y0+=Q,W.y1+=Q,M(W)}}d===void 0&&G.sort(ascendingBreadth),G.length&&R(G,V)}}function L(k,$,V){for(var N=k.length,B=N-2;B>=0;--B){for(var G=k[B],z=0,H=G;z<H.length;z++){for(var W=H[z],Y=0,K=0,Z=0,tt=W.sourceLinks;Z<tt.length;Z++){var et=tt[Z],at=et.target,ot=et.value,nt=ot*(at.layer-W.layer);Y+=F(W,at)*nt,K+=nt}if(K>0){var Q=(Y/K-W.y0)*$;W.y0+=Q,W.y1+=Q,M(W)}}d===void 0&&G.sort(ascendingBreadth),G.length&&R(G,V)}}function R(k,$){var V=k.length>>1,N=k[V];w(k,N.y0-l,V-1,$),I(k,N.y1+l,V+1,$),w(k,n,k.length-1,$),I(k,r,0,$)}function I(k,$,V,N){for(;V<k.length;++V){var B=k[V],G=($-B.y0)*N;G>1e-6&&(B.y0+=G,B.y1+=G),$=B.y1+l}}function w(k,$,V,N){for(;V>=0;--V){var B=k[V],G=(B.y1-$)*N;G>1e-6&&(B.y0-=G,B.y1-=G),$=B.y0-l}}function M(k){var $=k.sourceLinks,V=k.targetLinks;if(g===void 0){for(var N=0,B=V;N<B.length;N++){var G=B[N].source.sourceLinks;G.sort(ascendingTargetBreadth)}for(var z=0,H=$;z<H.length;z++){var W=H[z].target.targetLinks;W.sort(ascendingSourceBreadth)}}}function D(k){if(g===void 0)for(var $=0,V=k;$<V.length;$++){var N=V[$],B=N.sourceLinks,G=N.targetLinks;B.sort(ascendingTargetBreadth),G.sort(ascendingSourceBreadth)}}function O(k,$){for(var V=k.y0-(k.sourceLinks.length-1)*l/2,N=0,B=k.sourceLinks;N<B.length;N++){var G=B[N],z=G.target,H=G.width;if(z===$)break;V+=H+l}for(var W=0,Y=$.targetLinks;W<Y.length;W++){var K=Y[W],z=K.source,H=K.width;if(z===k)break;V-=H}return V}function F(k,$){for(var V=$.y0-($.targetLinks.length-1)*l/2,N=0,B=$.targetLinks;N<B.length;N++){var G=B[N],z=G.source,H=G.width;if(z===k)break;V+=H+l}for(var W=0,Y=k.sourceLinks;W<Y.length;W++){var K=Y[W],z=K.target,H=K.width;if(z===$)break;V-=H}return V}return y}var ALIGN_METHOD={left,right,center:center$1,justify},DEFAULT_OPTIONS$9={nodeId:function(a){return a.index},nodeAlign:"justify",nodeWidth:.008,nodePadding:.03,nodeSort:void 0};function getNodeAlignFunction(a){var r=isString$1(a)?ALIGN_METHOD[a]:isFunction$1(a)?a:null;return r||justify}function getDefaultOptions(a){return mix({},DEFAULT_OPTIONS$9,a)}function sankeyLayout(a,r){var e=getDefaultOptions(a),n=e.nodeId,o=e.nodeSort,s=e.nodeAlign,l=e.nodeWidth,c=e.nodePadding,u=e.nodeDepth,f=Sankey$1().nodeSort(o).nodeWidth(l).nodePadding(c).nodeDepth(u).nodeAlign(getNodeAlignFunction(s)).extent([[0,0],[1,1]]).nodeId(n),d=f(r),g=d.nodes.map(function(v){var m=v.x0,y=v.x1,x=v.y0,_=v.y1;return v.x=[m,y,y,m],v.y=[x,x,_,_],v}).filter(function(v){return v.name!==null}),p=d.links.map(function(v){var m=v.source,y=v.target,x=m.x1,_=y.x0;v.x=[x,x,_,_];var E=v.width/2;return v.y=[v.y0+E,v.y0-E,v.y1+E,v.y1-E],v}).filter(function(v){var m=v.source,y=v.target;return m.name!==null&&y.name!==null});return{nodes:g,links:p}}function isNodeLink(a){return a==="node-link"}function getNodeWidthRatio(a,r,e){return isRealNumber(a)?a/e:r}function getNodePaddingRatio(a,r,e){return isRealNumber(a)?a/e:r}function transformToViewsData(a,r,e){var n=a.dataType,o=a.data,s=a.sourceField,l=a.targetField,c=a.weightField,u=a.nodeAlign,f=a.nodeSort,d=a.nodePadding,g=a.nodePaddingRatio,p=a.nodeWidth,v=a.nodeWidthRatio,m=a.nodeDepth,y=a.rawFields,x=y===void 0?[]:y,_;isNodeLink(n)?_=o:_=transformDataToNodeLinkData(cutoffCircle(o,s,l),s,l,c,x);var E=sankeyLayout({nodeAlign:u,nodePadding:getNodePaddingRatio(d,g,e),nodeWidth:getNodeWidthRatio(p,v,r),nodeSort:f,nodeDepth:m},_),S=E.nodes,A=E.links;return{nodes:S.map(function(T){return __assign$8(__assign$8({},pick(T,__spreadArray$2(["x","y","name"],x,!0))),{isNode:!0})}),edges:A.map(function(T){return __assign$8(__assign$8({source:T.source.name,target:T.target.name,name:T.source.name||T.target.name},pick(T,__spreadArray$2(["x","y","value"],x,!0))),{isNode:!1})})}}function defaultOptions$2(a){var r=a.options,e=r.rawFields,n=e===void 0?[]:e;return deepAssign({},{options:{tooltip:{fields:uniq$2(__spreadArray$2(["name","source","target","value","isNode"],n,!0))},label:{fields:uniq$2(__spreadArray$2(["x","name"],n,!0))}}},a)}function geometry$5(a){var r=a.chart,e=a.options,n=e.color,o=e.nodeStyle,s=e.edgeStyle,l=e.label,c=e.tooltip,u=e.nodeState,f=e.edgeState,d=e.rawFields,g=d===void 0?[]:d;r.legend(!1),r.tooltip(c),r.axis(!1),r.coordinate().reflect("y");var p=transformToViewsData(e,r.width,r.height),v=p.nodes,m=p.edges,y=r.createView({id:EDGES_VIEW_ID});y.data(m),edge({chart:y,options:{xField:X_FIELD$1,yField:Y_FIELD$1,seriesField:COLOR_FIELD,rawFields:__spreadArray$2(["source","target"],g,!0),edge:{color:n,style:s,shape:"arc"},tooltip:c,state:f}});var x=r.createView({id:NODES_VIEW_ID});return x.data(v),polygon({chart:x,options:{xField:X_FIELD$1,yField:Y_FIELD$1,seriesField:COLOR_FIELD,polygon:{color:n,style:o},label:l,tooltip:c,state:u}}),r.interaction("element-active"),r.scale({x:{sync:!0,nice:!0,min:0,max:1,minLimit:0,maxLimit:1},y:{sync:!0,nice:!0,min:0,max:1,minLimit:0,maxLimit:1},name:{sync:"color",type:"cat"}}),a}function animation$1(a){var r=a.chart,e=a.options,n=e.animation,o=__spreadArray$2(__spreadArray$2([],r.views[0].geometries,!0),r.views[1].geometries,!0);return addViewAnimation(r,n,o),a}function nodeDraggable(a){var r=a.chart,e=a.options,n=e.nodeDraggable,o="sankey-node-draggable";return n?r.interaction(o):r.removeInteraction(o),a}function interaction$2(a){var r=a.chart,e=a.options,n=e.interactions,o=n===void 0?[]:n,s=[].concat(o,e.nodeInteractions||[]),l=[].concat(o,e.edgeInteractions||[]),c=findViewById(r,NODES_VIEW_ID),u=findViewById(r,EDGES_VIEW_ID);return s.forEach(function(f){(f==null?void 0:f.enable)===!1?c.removeInteraction(f.type):c.interaction(f.type,f.cfg||{})}),l.forEach(function(f){(f==null?void 0:f.enable)===!1?u.removeInteraction(f.type):u.interaction(f.type,f.cfg||{})}),a}function adaptor$6(a){return flow(defaultOptions$2,geometry$5,interaction$2,nodeDraggable,animation$1,theme$2)(a)}var SankeyNodeDragAction=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.isDragging=!1,e}return r.prototype.isNodeElement=function(){var e=get(this.context,"event.target");if(e){var n=e.get("element");return n&&n.getModel().data.isNode}return!1},r.prototype.getNodeView=function(){return findViewById(this.context.view,NODES_VIEW_ID)},r.prototype.getEdgeView=function(){return findViewById(this.context.view,EDGES_VIEW_ID)},r.prototype.getCurrentDatumIdx=function(e){return this.getNodeView().geometries[0].elements.indexOf(e)},r.prototype.start=function(){if(this.isNodeElement()){this.prevPoint={x:get(this.context,"event.x"),y:get(this.context,"event.y")};var e=this.context.event.target.get("element"),n=this.getCurrentDatumIdx(e);if(n===-1)return;this.currentElementIdx=n,this.context.isDragging=!0,this.isDragging=!0,this.prevNodeAnimateCfg=this.getNodeView().getOptions().animate,this.prevEdgeAnimateCfg=this.getEdgeView().getOptions().animate,this.getNodeView().animate(!1),this.getEdgeView().animate(!1)}},r.prototype.translate=function(){if(this.isDragging){var e=this.context.view,n={x:get(this.context,"event.x"),y:get(this.context,"event.y")},o=n.x-this.prevPoint.x,s=n.y-this.prevPoint.y,l=this.getNodeView(),c=l.geometries[0].elements[this.currentElementIdx];if(c&&c.getModel()){var u=c.getModel().data,f=l.getOptions().data,d=l.getCoordinate(),g={x:o/d.getWidth(),y:s/d.getHeight()},p=__assign$8(__assign$8({},u),{x:u.x.map(function(_){return _+=g.x}),y:u.y.map(function(_){return _+=g.y})}),v=__spreadArray$2([],f,!0);v[this.currentElementIdx]=p,l.data(v);var m=u.name,y=this.getEdgeView(),x=y.getOptions().data;x.forEach(function(_){_.source===m&&(_.x[0]+=g.x,_.x[1]+=g.x,_.y[0]+=g.y,_.y[1]+=g.y),_.target===m&&(_.x[2]+=g.x,_.x[3]+=g.x,_.y[2]+=g.y,_.y[3]+=g.y)}),y.data(x),this.prevPoint=n,e.render(!0)}}},r.prototype.end=function(){this.isDragging=!1,this.context.isDragging=!1,this.prevPoint=null,this.currentElementIdx=null,this.getNodeView().animate(this.prevNodeAnimateCfg),this.getEdgeView().animate(this.prevEdgeAnimateCfg)},r}(Action);registerAction("sankey-node-drag",SankeyNodeDragAction);registerInteraction("sankey-node-draggable",{showEnable:[{trigger:"polygon:mouseenter",action:"cursor:pointer"},{trigger:"polygon:mouseleave",action:"cursor:default"}],start:[{trigger:"polygon:mousedown",action:"sankey-node-drag:start"}],processing:[{trigger:"plot:mousemove",action:"sankey-node-drag:translate"},{isEnable:function(a){return a.isDragging},trigger:"plot:mousemove",action:"cursor:move"}],end:[{trigger:"plot:mouseup",action:"sankey-node-drag:end"}]});var Sankey=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="sankey",e}return r.getDefaultOptions=function(){return{appendPadding:8,syncViewPadding:!0,nodeStyle:{opacity:1,fillOpacity:1,lineWidth:1},edgeStyle:{opacity:.3,lineWidth:0},edgeState:{active:{style:{opacity:.8,lineWidth:0}}},label:{formatter:function(e){var n=e.name;return n},callback:function(e){var n=e[1]===1;return{style:{fill:"#545454",textAlign:n?"end":"start"},offsetX:n?-8:8}},layout:[{type:"hide-overlap"}]},tooltip:{showTitle:!1,showMarkers:!1,shared:!1,showContent:function(e){return!get(e,[0,"data","isNode"])},formatter:function(e){var n=e.source,o=e.target,s=e.value;return{name:n+" -> "+o,value:s}}},nodeWidthRatio:.008,nodePaddingRatio:.01,animation:{appear:{animation:"wave-in"},enter:{animation:"wave-in"}}}},r.prototype.changeData=function(e){this.updateOption({data:e});var n=transformToViewsData(this.options,this.chart.width,this.chart.height),o=n.nodes,s=n.edges,l=findViewById(this.chart,NODES_VIEW_ID),c=findViewById(this.chart,EDGES_VIEW_ID);l.changeData(o),c.changeData(s)},r.prototype.getSchemaAdaptor=function(){return adaptor$6},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r}(Plot),SUNBURST_ANCESTOR_FIELD="ancestor-node",SUNBURST_Y_FIELD="value",SUNBURST_PATH_FIELD="path",RAW_FIELDS=[SUNBURST_PATH_FIELD,NODE_INDEX_FIELD,NODE_ANCESTORS_FIELD,CHILD_NODE_COUNT,"name","depth","height"],DEFAULT_OPTIONS$8=deepAssign({},Plot.getDefaultOptions(),{innerRadius:0,radius:.85,hierarchyConfig:{field:"value"},tooltip:{shared:!0,showMarkers:!1,offset:20,showTitle:!1},legend:!1,sunburstStyle:{lineWidth:.5,stroke:"#FFF"},drilldown:{enabled:!0}}),DEFAULT_OPTIONS$7={field:"value",size:[1,1],round:!1,padding:0,sort:function(a,r){return r.value-a.value},as:["x","y"],ignoreParentValue:!0};function partition(a,r){r=mix({},DEFAULT_OPTIONS$7,r);var e=r.as;if(!isArray$4(e)||e.length!==2)throw new TypeError('Invalid as: it must be an array with 2 strings (e.g. [ "x", "y" ])!');var n;try{n=getField(r)}catch(u){console.warn(u)}var o=function(u){return partition$1().size(r.size).round(r.round).padding(r.padding)(hierarchy(u).sum(function(f){return size(f.children)?r.ignoreParentValue?0:f[n]-reduce(f.children,function(d,g){return d+g[n]},0):f[n]}).sort(r.sort))},s=o(a),l=e[0],c=e[1];return s.each(function(u){var f,d;u[l]=[u.x0,u.x1,u.x1,u.x0],u[c]=[u.y1,u.y1,u.y0,u.y0],u.name=u.name||((f=u.data)===null||f===void 0?void 0:f.name)||((d=u.data)===null||d===void 0?void 0:d.label),u.data.name=u.name,["x0","x1","y0","y1"].forEach(function(g){e.indexOf(g)===-1&&delete u[g]})}),getAllNodes(s)}var DEFAULT_OPTIONS$6={field:"value",tile:"treemapSquarify",size:[1,1],round:!1,ignoreParentValue:!0,padding:0,paddingInner:0,paddingOuter:0,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,as:["x","y"],sort:function(a,r){return r.value-a.value},ratio:.5*(1+Math.sqrt(5))};function getTileMethod(a,r){return a==="treemapSquarify"?d3Hierarchy[a].ratio(r):d3Hierarchy[a]}function treemap(a,r){r=mix({},DEFAULT_OPTIONS$6,r);var e=r.as;if(!isArray$4(e)||e.length!==2)throw new TypeError('Invalid as: it must be an array with 2 strings (e.g. [ "x", "y" ])!');var n;try{n=getField(r)}catch(f){console.warn(f)}var o=getTileMethod(r.tile,r.ratio),s=function(f){return index().tile(o).size(r.size).round(r.round).padding(r.padding).paddingInner(r.paddingInner).paddingOuter(r.paddingOuter).paddingTop(r.paddingTop).paddingRight(r.paddingRight).paddingBottom(r.paddingBottom).paddingLeft(r.paddingLeft)(hierarchy(f).sum(function(d){return r.ignoreParentValue&&d.children?0:d[n]}).sort(r.sort))},l=s(a),c=e[0],u=e[1];return l.each(function(f){f[c]=[f.x0,f.x1,f.x1,f.x0],f[u]=[f.y1,f.y1,f.y0,f.y0],["x0","x1","y0","y1"].forEach(function(d){e.indexOf(d)===-1&&delete f[d]})}),getAllNodes(l)}function transformData$2(a){var r=a.data,e=a.colorField,n=a.rawFields,o=a.hierarchyConfig,s=o===void 0?{}:o,l=s.activeDepth,c={partition,treemap},u=a.seriesField,f=a.type||"partition",d=c[f](r,__assign$8(__assign$8({field:u||"value"},omit$1(s,["activeDepth"])),{type:"hierarchy.".concat(f),as:["x","y"]})),g=[];return d.forEach(function(p){var v,m,y,x,_,E;if(p.depth===0||l>0&&p.depth>l)return null;for(var S=p.data.name,A=__assign$8({},p);A.depth>1;)S="".concat((m=A.parent.data)===null||m===void 0?void 0:m.name," / ").concat(S),A=A.parent;var T=__assign$8(__assign$8(__assign$8({},pick(p.data,__spreadArray$2(__spreadArray$2([],n||[],!0),[s.field],!1))),(v={},v[SUNBURST_PATH_FIELD]=S,v[SUNBURST_ANCESTOR_FIELD]=A.data.name,v)),p);u&&(T[u]=p.data[u]||((x=(y=p.parent)===null||y===void 0?void 0:y.data)===null||x===void 0?void 0:x[u])),e&&(T[e]=p.data[e]||((E=(_=p.parent)===null||_===void 0?void 0:_.data)===null||E===void 0?void 0:E[e])),T.ext=s,T[HIERARCHY_DATA_TRANSFORM_PARAMS]={hierarchyConfig:s,colorField:e,rawFields:n},g.push(T)}),g}function geometry$4(a){var r=a.chart,e=a.options,n=e.color,o=e.colorField,s=o===void 0?SUNBURST_ANCESTOR_FIELD:o,l=e.sunburstStyle,c=e.rawFields,u=c===void 0?[]:c,f=e.shape,d=transformData$2(e);r.data(d);var g;return l&&(g=function(p){return deepAssign({},{fillOpacity:Math.pow(.85,p.depth)},isFunction$1(l)?l(p):l)}),polygon(deepAssign({},a,{options:{xField:"x",yField:"y",seriesField:s,rawFields:uniq$2(__spreadArray$2(__spreadArray$2([],RAW_FIELDS,!0),u,!0)),polygon:{color:n,style:g,shape:f}}})),a}function axis$4(a){var r=a.chart;return r.axis(!1),a}function label$2(a){var r=a.chart,e=a.options,n=e.label,o=findGeometry(r,"polygon");if(!n)o.label(!1);else{var s=n.fields,l=s===void 0?["name"]:s,c=n.callback,u=__rest$1(n,["fields","callback"]);o.label({fields:l,callback:c,cfg:transformLabel(u)})}return a}function coordinate(a){var r=a.chart,e=a.options,n=e.innerRadius,o=e.radius,s=e.reflect,l=r.coordinate({type:"polar",cfg:{innerRadius:n,radius:o}});return s&&l.reflect(s),a}function meta$3(a){var r,e=a.options,n=e.hierarchyConfig,o=e.meta;return flow(scale$2({},(r={},r[SUNBURST_Y_FIELD]=get(o,get(n,["field"],"value")),r)))(a)}function tooltip$1(a){var r=a.chart,e=a.options,n=e.tooltip;if(n===!1)r.tooltip(!1);else{var o=n;get(n,"fields")||(o=deepAssign({},{customItems:function(s){return s.map(function(l){var c=get(r.getOptions(),"scales"),u=get(c,[SUNBURST_PATH_FIELD,"formatter"],function(d){return d}),f=get(c,[SUNBURST_Y_FIELD,"formatter"],function(d){return d});return __assign$8(__assign$8({},l),{name:u(l.data[SUNBURST_PATH_FIELD]),value:f(l.data.value)})})}},o)),r.tooltip(o)}return a}function adaptorInteraction$1(a){var r=a.drilldown,e=a.interactions,n=e===void 0?[]:e;return r!=null&&r.enabled?deepAssign({},a,{interactions:__spreadArray$2(__spreadArray$2([],n,!0),[{type:"drill-down",cfg:{drillDownConfig:r,transformData:transformData$2}}],!1)}):a}function interaction$1(a){var r=a.chart,e=a.options,n=e.drilldown;return interaction$8({chart:r,options:adaptorInteraction$1(e)}),n!=null&&n.enabled&&(r.appendPadding=getAdjustAppendPadding(r.appendPadding,get(n,["breadCrumb","position"]))),a}function adaptor$5(a){return flow(theme$2,pattern("sunburstStyle"),geometry$4,axis$4,meta$3,legend$g,coordinate,tooltip$1,label$2,interaction$1,animation$5,annotation$2())(a)}var Sunburst=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="sunburst",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$8},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$5},r.SUNBURST_ANCESTOR_FIELD=SUNBURST_ANCESTOR_FIELD,r.SUNBURST_PATH_FIELD=SUNBURST_PATH_FIELD,r.NODE_ANCESTORS_FIELD=NODE_ANCESTORS_FIELD,r}(Plot);function findInteraction(a,r){if(isArray$4(a))return a.find(function(e){return e.type===r})}function enableInteraction(a,r){var e=findInteraction(a,r);return e&&e.enable!==!1}function enableDrillInteraction(a){var r=a.interactions,e=a.drilldown;return get(e,"enabled")||enableInteraction(r,"treemap-drill-down")}function resetDrillDown(a){var r=a.interactions["drill-down"];if(r){var e=r.context.actions.find(function(n){return n.name==="drill-down-action"});e.reset()}}function transformData$1(a){var r=a.data,e=a.colorField,n=a.enableDrillDown,o=a.hierarchyConfig,s=treemap(r,__assign$8(__assign$8({},o),{type:"hierarchy.treemap",field:"value",as:["x","y"]})),l=[];return s.forEach(function(c){if(c.depth===0||n&&c.depth!==1||!n&&c.children)return null;var u=c.ancestors().map(function(p){return{data:p.data,height:p.height,value:p.value}}),f=n&&isArray$4(r.path)?u.concat(r.path.slice(1)):u,d=Object.assign({},c.data,__assign$8({x:c.x,y:c.y,depth:c.depth,value:c.value,path:f},c));if(!c.data[e]&&c.parent){var g=c.ancestors().find(function(p){return p.data[e]});d[e]=g==null?void 0:g.data[e]}else d[e]=c.data[e];d[HIERARCHY_DATA_TRANSFORM_PARAMS]={hierarchyConfig:o,colorField:e,enableDrillDown:n},l.push(d)}),l}function defaultOptions$1(a){var r=a.options,e=r.colorField;return deepAssign({options:{rawFields:["value"],tooltip:{fields:["name","value",e,"path"],formatter:function(n){return{name:n.name,value:n.value}}}}},a)}function geometry$3(a){var r=a.chart,e=a.options,n=e.color,o=e.colorField,s=e.rectStyle,l=e.hierarchyConfig,c=e.rawFields,u=transformData$1({data:e.data,colorField:e.colorField,enableDrillDown:enableDrillInteraction(e),hierarchyConfig:l});return r.data(u),polygon(deepAssign({},a,{options:{xField:"x",yField:"y",seriesField:o,rawFields:c,polygon:{color:n,style:s}}})),r.coordinate().reflect("y"),a}function axis$3(a){var r=a.chart;return r.axis(!1),a}function adaptorInteraction(a){var r=a.drilldown,e=a.interactions,n=e===void 0?[]:e,o=enableDrillInteraction(a);return o?deepAssign({},a,{interactions:__spreadArray$2(__spreadArray$2([],n,!0),[{type:"drill-down",cfg:{drillDownConfig:r,transformData:transformData$1}}],!1)}):a}function interaction(a){var r=a.chart,e=a.options,n=e.interactions,o=e.drilldown;interaction$8({chart:r,options:adaptorInteraction(e)});var s=findInteraction(n,"view-zoom");s&&(s.enable!==!1?r.getCanvas().on("mousewheel",function(c){c.preventDefault()}):r.getCanvas().off("mousewheel"));var l=enableDrillInteraction(e);return l&&(r.appendPadding=getAdjustAppendPadding(r.appendPadding,get(o,["breadCrumb","position"]))),a}function adaptor$4(a){return flow(defaultOptions$1,theme$2,pattern("rectStyle"),geometry$3,axis$3,legend$g,tooltip$9,interaction,animation$5,annotation$2())(a)}var DEFAULT_OPTIONS$5={colorField:"name",rectStyle:{lineWidth:1,stroke:"#fff"},hierarchyConfig:{tile:"treemapSquarify"},label:{fields:["name"],layout:{type:"limit-in-shape"}},tooltip:{showMarkers:!1,showTitle:!1},drilldown:{enabled:!1,breadCrumb:{position:"bottom-left",rootText:"初始",dividerText:"/",textStyle:{fontSize:12,fill:"rgba(0, 0, 0, 0.65)",cursor:"pointer"},activeTextStyle:{fill:"#87B5FF"}}}},Treemap=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="treemap",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$5},r.prototype.changeData=function(e){var n=this.options,o=n.colorField,s=n.interactions,l=n.hierarchyConfig;this.updateOption({data:e});var c=transformData$1({data:e,colorField:o,enableDrillDown:enableInteraction(s,"treemap-drill-down"),hierarchyConfig:l});this.chart.changeData(c),resetDrillDown(this.chart)},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$4},r}(Plot),ID_FIELD="id",PATH_FIELD="path",DEFAULT_OPTIONS$4={appendPadding:[10,0,20,0],blendMode:"multiply",tooltip:{showTitle:!1,showMarkers:!1,fields:["id","size"],formatter:function(a){return{name:a.id,value:a.size}}},legend:{position:"top-left"},label:{style:{textAlign:"center",fill:"#fff"}},interactions:[{type:"legend-filter",enable:!1}],state:{active:{style:{stroke:"#000"}},selected:{style:{stroke:"#000",lineWidth:2}},inactive:{style:{fillOpacity:.3,strokeOpacity:.3}}},defaultInteractions:["tooltip","venn-legend-active"]};function placeElementsOrdered(a){if(a){var r=a.geometries[0].elements;r.forEach(function(e){e.shape.toFront()})}}var ElementActiveAction=getActionClass("element-active"),VennElementActive=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.syncElementsPos=function(){placeElementsOrdered(this.context.view)},r.prototype.active=function(){a.prototype.active.call(this),this.syncElementsPos()},r.prototype.toggle=function(){a.prototype.toggle.call(this),this.syncElementsPos()},r.prototype.reset=function(){a.prototype.reset.call(this),this.syncElementsPos()},r}(ElementActiveAction),ElementHighlightAction=getActionClass("element-highlight"),VennElementHighlight=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.syncElementsPos=function(){placeElementsOrdered(this.context.view)},r.prototype.highlight=function(){a.prototype.highlight.call(this),this.syncElementsPos()},r.prototype.toggle=function(){a.prototype.toggle.call(this),this.syncElementsPos()},r.prototype.clear=function(){a.prototype.clear.call(this),this.syncElementsPos()},r.prototype.reset=function(){a.prototype.reset.call(this),this.syncElementsPos()},r}(ElementHighlightAction),ElementSelectedAction=getActionClass("element-selected"),ElementSingleSelectedAction=getActionClass("element-single-selected"),VennElementSelected=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.syncElementsPos=function(){placeElementsOrdered(this.context.view)},r.prototype.selected=function(){a.prototype.selected.call(this),this.syncElementsPos()},r.prototype.toggle=function(){a.prototype.toggle.call(this),this.syncElementsPos()},r.prototype.reset=function(){a.prototype.reset.call(this),this.syncElementsPos()},r}(ElementSelectedAction),VennElementSingleSelected=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.syncElementsPos=function(){placeElementsOrdered(this.context.view)},r.prototype.selected=function(){a.prototype.selected.call(this),this.syncElementsPos()},r.prototype.toggle=function(){a.prototype.toggle.call(this),this.syncElementsPos()},r.prototype.reset=function(){a.prototype.reset.call(this),this.syncElementsPos()},r}(ElementSingleSelectedAction);registerAction("venn-element-active",VennElementActive);registerAction("venn-element-highlight",VennElementHighlight);registerAction("venn-element-selected",VennElementSelected);registerAction("venn-element-single-selected",VennElementSingleSelected);registerInteraction("venn-element-active",{start:[{trigger:"element:mouseenter",action:"venn-element-active:active"}],end:[{trigger:"element:mouseleave",action:"venn-element-active:reset"}]});registerInteraction("venn-element-highlight",{start:[{trigger:"element:mouseenter",action:"venn-element-highlight:highlight"}],end:[{trigger:"element:mouseleave",action:"venn-element-highlight:reset"}]});registerInteraction("venn-element-selected",{start:[{trigger:"element:click",action:"venn-element-selected:toggle"}],rollback:[{trigger:"dblclick",action:["venn-element-selected:reset"]}]});registerInteraction("venn-element-single-selected",{start:[{trigger:"element:click",action:"venn-element-single-selected:toggle"}],rollback:[{trigger:"dblclick",action:["venn-element-single-selected:reset"]}]});registerInteraction("venn-legend-active",{start:[{trigger:"legend-item:mouseenter",action:["list-active:active","venn-element-active:active"]}],end:[{trigger:"legend-item:mouseleave",action:["list-active:reset","venn-element-active:reset"]}]});registerInteraction("venn-legend-highlight",{start:[{trigger:"legend-item:mouseenter",action:["legend-item-highlight:highlight","venn-element-highlight:highlight"]}],end:[{trigger:"legend-item:mouseleave",action:["legend-item-highlight:reset","venn-element-highlight:reset"]}]});var VennLabel=function(a){__extends$7(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r.prototype.getLabelPoint=function(e,n,o){var s=e.data,l=s.x,c=s.y,u=e.customLabelInfo,f=u.offsetX,d=u.offsetY;return{content:e.content[o],x:l+f,y:c+d}},r}(GeometryLabel);registerGeometryLabel("venn",VennLabel);var isArray$1=Array.isArray;const isArray$2=isArray$1;var SPACES=`	
\v\f\r   ᠎             　\u2028\u2029`,PATH_COMMAND=new RegExp("([a-z])["+SPACES+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+SPACES+"]*,?["+SPACES+"]*)+)","ig"),PATH_VALUES=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+SPACES+"]*,?["+SPACES+"]*","ig");function parsePathString(a){if(!a)return null;if(isArray$2(a))return a;var r={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},e=[];return String(a).replace(PATH_COMMAND,function(n,o,s){var l=[],c=o.toLowerCase();if(s.replace(PATH_VALUES,function(u,f){f&&l.push(+f)}),c==="m"&&l.length>2&&(e.push([o].concat(l.splice(0,2))),c="l",o=o==="m"?"l":"L"),c==="o"&&l.length===1&&e.push([o,l[0]]),c==="r")e.push([o].concat(l));else for(;l.length>=r[c]&&(e.push([o].concat(l.splice(0,r[c]))),!!r[c]););return""}),e}function getFillAttrs$1(a){return deepAssign({},a.defaultStyle,{fill:a.color},a.style)}registerShape("schema","venn",{draw:function(a,r){var e=a.data,n=parsePathString(e[PATH_FIELD]),o=getFillAttrs$1(a),s=r.addGroup({name:"venn-shape"});s.addShape("path",{attrs:__assign$8(__assign$8({},o),{path:n}),name:"venn-path"});var l=a.customInfo,c=l.offsetX,u=l.offsetY,f=Util.transform(null,[["t",c,u]]);return s.setMatrix(f),s},getMarker:function(a){var r=a.color;return{symbol:"circle",style:{lineWidth:0,stroke:r,fill:r,r:4}}}});var each=function(a){return function(r,e){var n=[];return n[0]=a(r[0],e[0]),n[1]=a(r[1],e[1]),n[2]=a(r[2],e[2]),n}},blendObject={normal:function(a){return a},multiply:function(a,r){return a*r/255},screen:function(a,r){return 255*(1-(1-a/255)*(1-r/255))},overlay:function(a,r){return r<128?2*a*r/255:255*(1-2*(1-a/255)*(1-r/255))},darken:function(a,r){return a>r?r:a},lighten:function(a,r){return a>r?a:r},dodge:function(a,r){return a===255?255:(a=255*(r/255)/(1-a/255),a>255?255:a)},burn:function(a,r){return r===255?255:a===0?0:255*(1-Math.min(1,(1-r/255)/(a/255)))}},innerBlend=function(a){if(!blendObject[a])throw new Error("unknown blend mode "+a);return blendObject[a]};function blend(a,r,e){e===void 0&&(e="normal");var n=each(innerBlend(e))(colorToArr(a),colorToArr(r)),o=colorToArr(a),s=o[0],l=o[1],c=o[2],u=o[3],f=colorToArr(r),d=f[0],g=f[1],p=f[2],v=f[3],m=Number((u+v*(1-u)).toFixed(2)),y=Math.round((u*(1-v)*(s/255)+u*v*(n[0]/255)+(1-u)*v*(d/255))/m*255),x=Math.round((u*(1-v)*(l/255)+u*v*(n[1]/255)+(1-u)*v*(g/255))/m*255),_=Math.round((u*(1-v)*(c/255)+u*v*(n[2]/255)+(1-u)*v*(p/255))/m*255);return"rgba(".concat(y,", ").concat(x,", ").concat(_,", ").concat(m,")")}function colorToArr(a){var r=a.replace("/s+/g",""),e;return typeof r=="string"&&!r.startsWith("rgba")&&!r.startsWith("#")?e=colorUtil.rgb2arr(colorUtil.toRGB(r)).concat([1]):(r.startsWith("rgba")&&(e=r.replace("rgba(","").replace(")","").split(",")),r.startsWith("#")&&(e=colorUtil.rgb2arr(r).concat([1])),e.map(function(n,o){return o===3?Number(n):n|0}))}function bisect(a,r,e,n){n=n||{};var o=n.maxIterations||100,s=n.tolerance||1e-10,l=a(r),c=a(e),u=e-r;if(l*c>0)throw"Initial bisect points must have opposite signs";if(l===0)return r;if(c===0)return e;for(var f=0;f<o;++f){u/=2;var d=r+u,g=a(d);if(g*l>=0&&(r=d),Math.abs(u)<s||g===0)return d}return r+u}function zeros(a){for(var r=new Array(a),e=0;e<a;++e)r[e]=0;return r}function zerosM(a,r){return zeros(a).map(function(){return zeros(r)})}function dot$1(a,r){for(var e=0,n=0;n<a.length;++n)e+=a[n]*r[n];return e}function norm2(a){return Math.sqrt(dot$1(a,a))}function scale(a,r,e){for(var n=0;n<r.length;++n)a[n]=r[n]*e}function weightedSum(a,r,e,n,o){for(var s=0;s<a.length;++s)a[s]=r*e[s]+n*o[s]}function nelderMead(a,r,e){e=e||{};var n=e.maxIterations||r.length*200,o=e.nonZeroDelta||1.05,s=e.zeroDelta||.001,l=e.minErrorDelta||1e-6,c=e.minErrorDelta||1e-5,u=e.rho!==void 0?e.rho:1,f=e.chi!==void 0?e.chi:2,d=e.psi!==void 0?e.psi:-.5,g=e.sigma!==void 0?e.sigma:.5,p,v=r.length,m=new Array(v+1);m[0]=r,m[0].fx=a(r),m[0].id=0;for(var y=0;y<v;++y){var x=r.slice();x[y]=x[y]?x[y]*o:s,m[y+1]=x,m[y+1].fx=a(x),m[y+1].id=y+1}function _(M){for(var D=0;D<M.length;D++)m[v][D]=M[D];m[v].fx=M.fx}for(var E=function(M,D){return M.fx-D.fx},S=r.slice(),A=r.slice(),T=r.slice(),b=r.slice(),C=0;C<n;++C){if(m.sort(E),e.history){var L=m.map(function(M){var D=M.slice();return D.fx=M.fx,D.id=M.id,D});L.sort(function(M,D){return M.id-D.id}),e.history.push({x:m[0].slice(),fx:m[0].fx,simplex:L})}for(p=0,y=0;y<v;++y)p=Math.max(p,Math.abs(m[0][y]-m[1][y]));if(Math.abs(m[0].fx-m[v].fx)<l&&p<c)break;for(y=0;y<v;++y){S[y]=0;for(var R=0;R<v;++R)S[y]+=m[R][y];S[y]/=v}var I=m[v];if(weightedSum(A,1+u,S,-u,I),A.fx=a(A),A.fx<m[0].fx)weightedSum(b,1+f,S,-f,I),b.fx=a(b),b.fx<A.fx?_(b):_(A);else if(A.fx>=m[v-1].fx){var w=!1;if(A.fx>I.fx?(weightedSum(T,1+d,S,-d,I),T.fx=a(T),T.fx<I.fx?_(T):w=!0):(weightedSum(T,1-d*u,S,d*u,I),T.fx=a(T),T.fx<A.fx?_(T):w=!0),w){if(g>=1)break;for(y=1;y<m.length;++y)weightedSum(m[y],1-g,m[0],g,m[y]),m[y].fx=a(m[y])}}else _(A)}return m.sort(E),{fx:m[0].fx,x:m[0]}}function wolfeLineSearch(a,r,e,n,o,s,l){var c=e.fx,u=dot$1(e.fxprime,r),f=c,d=c,g=u,p=0;o=o||1,s=s||1e-6,l=l||.1;function v(y,x,_){for(var E=0;E<16;++E)if(o=(y+x)/2,weightedSum(n.x,1,e.x,o,r),f=n.fx=a(n.x,n.fxprime),g=dot$1(n.fxprime,r),f>c+s*o*u||f>=_)x=o;else{if(Math.abs(g)<=-l*u)return o;g*(x-y)>=0&&(x=y),y=o,_=f}return 0}for(var m=0;m<10;++m){if(weightedSum(n.x,1,e.x,o,r),f=n.fx=a(n.x,n.fxprime),g=dot$1(n.fxprime,r),f>c+s*o*u||m&&f>=d)return v(p,o,d);if(Math.abs(g)<=-l*u)return o;if(g>=0)return v(o,p,f);d=f,p=o,o*=2}return o}function conjugateGradient(a,r,e){var n={x:r.slice(),fx:0,fxprime:r.slice()},o={x:r.slice(),fx:0,fxprime:r.slice()},s=r.slice(),l,c,u=1,f;e=e||{},f=e.maxIterations||r.length*20,n.fx=a(n.x,n.fxprime),l=n.fxprime.slice(),scale(l,n.fxprime,-1);for(var d=0;d<f;++d){if(u=wolfeLineSearch(a,l,n,o,u),e.history&&e.history.push({x:n.x.slice(),fx:n.fx,fxprime:n.fxprime.slice(),alpha:u}),!u)scale(l,n.fxprime,-1);else{weightedSum(s,1,o.fxprime,-1,n.fxprime);var g=dot$1(n.fxprime,n.fxprime),p=Math.max(0,dot$1(s,o.fxprime)/g);weightedSum(l,p,l,-1,o.fxprime),c=n,n=o,o=c}if(norm2(n.fxprime)<=1e-5)break}return e.history&&e.history.push({x:n.x.slice(),fx:n.fx,fxprime:n.fxprime.slice(),alpha:u}),n}var SMALL$1=1e-10;function intersectionArea(a,r){var e=getIntersectionPoints(a),n=e.filter(function(C){return containedInCircles(C,a)}),o=0,s=0,l,c=[];if(n.length>1){var u=getCenter(n);for(l=0;l<n.length;++l){var f=n[l];f.angle=Math.atan2(f.x-u.x,f.y-u.y)}n.sort(function(C,L){return L.angle-C.angle});var d=n[n.length-1];for(l=0;l<n.length;++l){var g=n[l];s+=(d.x+g.x)*(g.y-d.y);for(var p={x:(g.x+d.x)/2,y:(g.y+d.y)/2},v=null,m=0;m<g.parentIndex.length;++m)if(d.parentIndex.indexOf(g.parentIndex[m])>-1){var y=a[g.parentIndex[m]],x=Math.atan2(g.x-y.x,g.y-y.y),_=Math.atan2(d.x-y.x,d.y-y.y),E=_-x;E<0&&(E+=2*Math.PI);var S=_-E/2,A=distance(p,{x:y.x+y.radius*Math.sin(S),y:y.y+y.radius*Math.cos(S)});A>y.radius*2&&(A=y.radius*2),(v===null||v.width>A)&&(v={circle:y,width:A,p1:g,p2:d})}v!==null&&(c.push(v),o+=circleArea(v.circle.radius,v.width),d=g)}}else{var T=a[0];for(l=1;l<a.length;++l)a[l].radius<T.radius&&(T=a[l]);var b=!1;for(l=0;l<a.length;++l)if(distance(a[l],T)>Math.abs(T.radius-a[l].radius)){b=!0;break}b?o=s=0:(o=T.radius*T.radius*Math.PI,c.push({circle:T,p1:{x:T.x,y:T.y+T.radius},p2:{x:T.x-SMALL$1,y:T.y+T.radius},width:T.radius*2}))}return s/=2,r&&(r.area=o+s,r.arcArea=o,r.polygonArea=s,r.arcs=c,r.innerPoints=n,r.intersectionPoints=e),o+s}function containedInCircles(a,r){for(var e=0;e<r.length;++e)if(distance(a,r[e])>r[e].radius+SMALL$1)return!1;return!0}function getIntersectionPoints(a){for(var r=[],e=0;e<a.length;++e)for(var n=e+1;n<a.length;++n)for(var o=circleCircleIntersection(a[e],a[n]),s=0;s<o.length;++s){var l=o[s];l.parentIndex=[e,n],r.push(l)}return r}function circleArea(a,r){return a*a*Math.acos(1-r/a)-(a-r)*Math.sqrt(r*(2*a-r))}function distance(a,r){return Math.sqrt((a.x-r.x)*(a.x-r.x)+(a.y-r.y)*(a.y-r.y))}function circleOverlap(a,r,e){if(e>=a+r)return 0;if(e<=Math.abs(a-r))return Math.PI*Math.min(a,r)*Math.min(a,r);var n=a-(e*e-r*r+a*a)/(2*e),o=r-(e*e-a*a+r*r)/(2*e);return circleArea(a,n)+circleArea(r,o)}function circleCircleIntersection(a,r){var e=distance(a,r),n=a.radius,o=r.radius;if(e>=n+o||e<=Math.abs(n-o))return[];var s=(n*n-o*o+e*e)/(2*e),l=Math.sqrt(n*n-s*s),c=a.x+s*(r.x-a.x)/e,u=a.y+s*(r.y-a.y)/e,f=-(r.y-a.y)*(l/e),d=-(r.x-a.x)*(l/e);return[{x:c+f,y:u-d},{x:c-f,y:u+d}]}function getCenter(a){for(var r={x:0,y:0},e=0;e<a.length;++e)r.x+=a[e].x,r.y+=a[e].y;return r.x/=a.length,r.y/=a.length,r}function circleMargin(a,r,e){var n=r[0].radius-distance(r[0],a),o,s;for(o=1;o<r.length;++o)s=r[o].radius-distance(r[o],a),s<=n&&(n=s);for(o=0;o<e.length;++o)s=distance(e[o],a)-e[o].radius,s<=n&&(n=s);return n}function computeTextCentre(a,r){var e=[],n;for(n=0;n<a.length;++n){var o=a[n];e.push({x:o.x,y:o.y}),e.push({x:o.x+o.radius/2,y:o.y}),e.push({x:o.x-o.radius/2,y:o.y}),e.push({x:o.x,y:o.y+o.radius/2}),e.push({x:o.x,y:o.y-o.radius/2})}var s=e[0],l=circleMargin(e[0],a,r);for(n=1;n<e.length;++n){var c=circleMargin(e[n],a,r);c>=l&&(s=e[n],l=c)}var u=nelderMead(function(p){return-1*circleMargin({x:p[0],y:p[1]},a,r)},[s.x,s.y],{maxIterations:500,minErrorDelta:1e-10}).x,f={x:u[0],y:u[1]},d=!0;for(n=0;n<a.length;++n)if(distance(f,a[n])>a[n].radius){d=!1;break}for(n=0;n<r.length;++n)if(distance(f,r[n])<r[n].radius){d=!1;break}if(!d)if(a.length==1)f={x:a[0].x,y:a[0].y};else{var g={};intersectionArea(a,g),g.arcs.length===0?f={x:0,y:-1e3,disjoint:!0}:g.arcs.length==1?f={x:g.arcs[0].circle.x,y:g.arcs[0].circle.y}:r.length?f=computeTextCentre(a,[]):f=getCenter(g.arcs.map(function(p){return p.p1}))}return f}function getOverlappingCircles(a){var r={},e=[];for(var n in a)e.push(n),r[n]=[];for(var o=0;o<e.length;o++)for(var s=a[e[o]],l=o+1;l<e.length;++l){var c=a[e[l]],u=distance(s,c);u+c.radius<=s.radius+1e-10?r[e[l]].push(e[o]):u+s.radius<=c.radius+1e-10&&r[e[o]].push(e[l])}return r}function computeTextCentres(a,r){for(var e={},n=getOverlappingCircles(a),o=0;o<r.length;++o){for(var s=r[o].sets,l={},c={},u=0;u<s.length;++u){l[s[u]]=!0;for(var f=n[s[u]],d=0;d<f.length;++d)c[f[d]]=!0}var g=[],p=[];for(var v in a)v in l?g.push(a[v]):v in c||p.push(a[v]);var m=computeTextCentre(g,p);e[s]=m,m.disjoint&&r[o].size>0&&console.log("WARNING: area "+s+" not represented on screen")}return e}function circlePath(a,r,e){var n=[],o=a-e,s=r;return n.push("M",o,s),n.push("A",e,e,0,1,0,o+2*e,s),n.push("A",e,e,0,1,0,o,s),n.join(" ")}function intersectionAreaPath(a){var r={};intersectionArea(a,r);var e=r.arcs;if(e.length===0)return"M 0 0";if(e.length==1){var n=e[0].circle;return circlePath(n.x,n.y,n.radius)}else{for(var o=[`
M`,e[0].p2.x,e[0].p2.y],s=0;s<e.length;++s){var l=e[s],c=l.circle.radius,u=l.width>c;o.push(`
A`,c,c,0,u?1:0,1,l.p1.x,l.p1.y)}return o.join(" ")}}function venn(a,r){r=r||{},r.maxIterations=r.maxIterations||500;var e=r.initialLayout||bestInitialLayout,n=r.lossFunction||lossFunction;a=addMissingAreas(a);var o=e(a,r),s=[],l=[],c;for(c in o)o.hasOwnProperty(c)&&(s.push(o[c].x),s.push(o[c].y),l.push(c));for(var u=nelderMead(function(g){for(var p={},v=0;v<l.length;++v){var m=l[v];p[m]={x:g[2*v],y:g[2*v+1],radius:o[m].radius}}return n(p,a)},s,r),f=u.x,d=0;d<l.length;++d)c=l[d],o[c].x=f[2*d],o[c].y=f[2*d+1];return o}var SMALL=1e-10;function distanceFromIntersectArea(a,r,e){return Math.min(a,r)*Math.min(a,r)*Math.PI<=e+SMALL?Math.abs(a-r):bisect(function(n){return circleOverlap(a,r,n)-e},0,a+r)}function addMissingAreas(a){a=a.slice();var r=[],e={},n,o,s,l;for(n=0;n<a.length;++n){var c=a[n];c.sets.length==1?r.push(c.sets[0]):c.sets.length==2&&(s=c.sets[0],l=c.sets[1],e[[s,l]]=!0,e[[l,s]]=!0)}for(r.sort(function(u,f){return u>f?1:-1}),n=0;n<r.length;++n)for(s=r[n],o=n+1;o<r.length;++o)l=r[o],[s,l]in e||a.push({sets:[s,l],size:0});return a}function getDistanceMatrices(a,r,e){var n=zerosM(r.length,r.length),o=zerosM(r.length,r.length);return a.filter(function(s){return s.sets.length==2}).map(function(s){var l=e[s.sets[0]],c=e[s.sets[1]],u=Math.sqrt(r[l].size/Math.PI),f=Math.sqrt(r[c].size/Math.PI),d=distanceFromIntersectArea(u,f,s.size);n[l][c]=n[c][l]=d;var g=0;s.size+1e-10>=Math.min(r[l].size,r[c].size)?g=1:s.size<=1e-10&&(g=-1),o[l][c]=o[c][l]=g}),{distances:n,constraints:o}}function constrainedMDSGradient(a,r,e,n){var o=0,s;for(s=0;s<r.length;++s)r[s]=0;for(s=0;s<e.length;++s)for(var l=a[2*s],c=a[2*s+1],u=s+1;u<e.length;++u){var f=a[2*u],d=a[2*u+1],g=e[s][u],p=n[s][u],v=(f-l)*(f-l)+(d-c)*(d-c),m=Math.sqrt(v),y=v-g*g;p>0&&m<=g||p<0&&m>=g||(o+=2*y*y,r[2*s]+=4*y*(l-f),r[2*s+1]+=4*y*(c-d),r[2*u]+=4*y*(f-l),r[2*u+1]+=4*y*(d-c))}return o}function bestInitialLayout(a,r){var e=greedyLayout(a,r),n=r.lossFunction||lossFunction;if(a.length>=8){var o=constrainedMDSLayout(a,r),s=n(o,a),l=n(e,a);s+1e-8<l&&(e=o)}return e}function constrainedMDSLayout(a,r){r=r||{};var e=r.restarts||10,n=[],o={},s;for(s=0;s<a.length;++s){var l=a[s];l.sets.length==1&&(o[l.sets[0]]=n.length,n.push(l))}var c=getDistanceMatrices(a,n,o),u=c.distances,f=c.constraints,d=norm2(u.map(norm2))/u.length;u=u.map(function(E){return E.map(function(S){return S/d})});var g=function(E,S){return constrainedMDSGradient(E,S,u,f)},p,v;for(s=0;s<e;++s){var m=zeros(u.length*2).map(Math.random);v=conjugateGradient(g,m,r),(!p||v.fx<p.fx)&&(p=v)}var y=p.x,x={};for(s=0;s<n.length;++s){var _=n[s];x[_.sets[0]]={x:y[2*s]*d,y:y[2*s+1]*d,radius:Math.sqrt(_.size/Math.PI)}}if(r.history)for(s=0;s<r.history.length;++s)scale(r.history[s].x,d);return x}function greedyLayout(a,r){for(var e=r&&r.lossFunction?r.lossFunction:lossFunction,n={},o={},s,l=0;l<a.length;++l){var c=a[l];c.sets.length==1&&(s=c.sets[0],n[s]={x:1e10,y:1e10,rowid:Object.keys(n).length,size:c.size,radius:Math.sqrt(c.size/Math.PI)},o[s]=[])}a=a.filter(function(k){return k.sets.length==2});for(var l=0;l<a.length;++l){var u=a[l],f=u.hasOwnProperty("weight")?u.weight:1,d=u.sets[0],g=u.sets[1];u.size+SMALL>=Math.min(n[d].size,n[g].size)&&(f=0),o[d].push({set:g,size:u.size,weight:f}),o[g].push({set:d,size:u.size,weight:f})}var p=[];for(s in o)if(o.hasOwnProperty(s)){for(var v=0,l=0;l<o[s].length;++l)v+=o[s][l].size*o[s][l].weight;p.push({set:s,size:v})}function m(k,$){return $.size-k.size}p.sort(m);var y={};function x(k){return k.set in y}function _(k,$){n[$].x=k.x,n[$].y=k.y,y[$]=!0}_({x:0,y:0},p[0].set);for(var l=1;l<p.length;++l){var E=p[l].set,S=o[E].filter(x);if(s=n[E],S.sort(m),S.length===0)throw"ERROR: missing pairwise overlap information";for(var A=[],T=0;T<S.length;++T){var b=n[S[T].set],C=distanceFromIntersectArea(s.radius,b.radius,S[T].size);A.push({x:b.x+C,y:b.y}),A.push({x:b.x-C,y:b.y}),A.push({y:b.y+C,x:b.x}),A.push({y:b.y-C,x:b.x});for(var L=T+1;L<S.length;++L)for(var R=n[S[L].set],I=distanceFromIntersectArea(s.radius,R.radius,S[L].size),w=circleCircleIntersection({x:b.x,y:b.y,radius:C},{x:R.x,y:R.y,radius:I}),M=0;M<w.length;++M)A.push(w[M])}for(var D=1e50,O=A[0],T=0;T<A.length;++T){n[E].x=A[T].x,n[E].y=A[T].y;var F=e(n,a);F<D&&(D=F,O=A[T])}_(O,E)}return n}function lossFunction(a,r){var e=0;function n(d){return d.map(function(g){return a[g]})}for(var o=0;o<r.length;++o){var s=r[o],l=void 0;if(s.sets.length!=1){if(s.sets.length==2){var c=a[s.sets[0]],u=a[s.sets[1]];l=circleOverlap(c.radius,u.radius,distance(c,u))}else l=intersectionArea(n(s.sets));var f=s.hasOwnProperty("weight")?s.weight:1;e+=f*(l-s.size)*(l-s.size)}}return e}function getBoundingBox(a){var r=function(e){var n=Math.max.apply(null,a.map(function(s){return s[e]+s.radius})),o=Math.min.apply(null,a.map(function(s){return s[e]-s.radius}));return{max:n,min:o}};return{xRange:r("x"),yRange:r("y")}}function scaleSolution(a,r,e,n){var o=[],s=[];for(var l in a)a.hasOwnProperty(l)&&(s.push(l),o.push(a[l]));r-=2*n,e-=2*n;var c=getBoundingBox(o),u=c.xRange,f=c.yRange;if(u.max==u.min||f.max==f.min)return console.log("not scaling solution: zero size detected"),a;for(var d=r/(u.max-u.min),g=e/(f.max-f.min),p=Math.min(g,d),v=(r-(u.max-u.min)*p)/2,m=(e-(f.max-f.min)*p)/2,y={},x=0;x<o.length;++x){var _=o[x];y[s[x]]={radius:p*_.radius,x:n+v+(_.x-u.min)*p,y:n+m+(_.y-f.min)*p}}return y}var getColorMap=memoize(function(a,r,e,n){var o=new Map,s=a.length;return r.forEach(function(l,c){if(l[n].length===1)o.set(l[ID_FIELD],a[(c+s)%s]);else{var u=l[n].map(function(f){return o.get(f)});o.set(l[ID_FIELD],u.slice(1).reduce(function(f,d){return blend(f,d,e)},u[0]))}}),o},function(){for(var a=[],r=0;r<arguments.length;r++)a[r]=arguments[r];return JSON.stringify(a)});function layoutVennData(a,r,e,n){n===void 0&&(n=0);var o=a.data,s=a.setsField,l=a.sizeField;if(o.length===0)return log(LEVEL.WARN,!1,"warn: %s","数据不能为空"),[];var c=o.map(function(g){var p;return __assign$8(__assign$8({},g),(p={sets:g[s]||[],size:g[l]},p[PATH_FIELD]="",p[ID_FIELD]="",p))});c.sort(function(g,p){return g.sets.length-p.sets.length});var u=venn(c),f=scaleSolution(u,r,e,n),d=computeTextCentres(f,c);return c.forEach(function(g){var p=g.sets,v=p.join(",");g[ID_FIELD]=v;var m=p.map(function(_){return f[_]}),y=intersectionAreaPath(m);/[zZ]$/.test(y)||(y+=" Z"),g[PATH_FIELD]=y;var x=d[v]||{x:0,y:0};mix(g,x)}),c}function islegalSets(a,r){for(var e=0;e<r.length;e++)if(!a.includes(r[e]))return!1;return!0}var LEGEND_SPACE=40;function colorMap(a,r,e){var n=a.chart,o=a.options,s=o.blendMode,l=o.setsField,c=n.getTheme(),u=c.colors10,f=c.colors20,d=e;isArray$4(d)||(d=r.filter(function(p){return p[l].length===1}).length<=10?u:f);var g=getColorMap(d,r,s,l);return function(p){return g.get(p)||d[0]}}function transformColor(a,r){var e=a.options,n=e.color;if(typeof n!="function"){var o=typeof n=="string"?[n]:n,s=colorMap(a,r,o);return function(l){return s(l[ID_FIELD])}}return n}function padding(a){var r=a.chart,e=a.options,n=e.legend,o=e.appendPadding,s=e.padding,l=normalPadding(o);return n!==!1&&(l=getAdjustAppendPadding(o,get(n,"position"),LEGEND_SPACE)),r.appendPadding=resolveAllPadding([l,s]),a}function data$1(a){var r=a.options,e=r.data;e||(log(LEVEL.WARN,!1,"warn: %s","数据不能为空"),e=[]);var n=e.filter(function(s){return s.sets.length===1}).map(function(s){return s.sets[0]}),o=e.filter(function(s){var l=s.sets;return islegalSets(n,l)});return isEqual$1(o,e)||log(LEVEL.WARN,!1,"warn: %s","交集中不能出现不存在的集合, 请输入合法数据"),deepMix({},a,{options:{data:o}})}function geometry$2(a){var r=a.chart,e=a.options,n=e.pointStyle,o=e.setsField,s=e.sizeField,l=normalPadding(r.appendPadding),c=l[0],u=l[1],f=l[2],d=l[3],g={offsetX:d,offsetY:c},p=r.viewBBox,v=p.width,m=p.height,y=layoutVennData(e,Math.max(v-(u+d),0),Math.max(m-(c+f),0),0);r.data(y);var x=schema(deepAssign({},a,{options:{xField:"x",yField:"y",sizeField:s,seriesField:ID_FIELD,rawFields:[o,s],schema:{shape:"venn",style:n}}})).ext,_=x.geometry;_.customInfo(g);var E=transformColor(a,y);return typeof E=="function"&&_.color(ID_FIELD,function(S){var A=y.find(function(b){return b[ID_FIELD]===S}),T=colorMap(a,y)(S);return E(A,T)}),a}function label$1(a){var r=a.chart,e=a.options,n=e.label,o=normalPadding(r.appendPadding),s=o[0],l=o[3],c={offsetX:l,offsetY:s},u=findGeometry(r,"schema");if(!n)u.label(!1);else{var f=n.callback,d=__rest$1(n,["callback"]);u.label({fields:["id"],callback:f,cfg:deepMix({},transformLabel(d),{type:"venn",customLabelInfo:c})})}return a}function legend$3(a){var r=a.chart,e=a.options,n=e.legend,o=e.sizeField;return r.legend(ID_FIELD,n),r.legend(o,!1),a}function axis$2(a){var r=a.chart;return r.axis(!1),a}function vennInteraction(a){var r=a.options,e=a.chart,n=r.interactions;if(n){var o={"legend-active":"venn-legend-active","legend-highlight":"venn-legend-highlight"};interaction$8(deepAssign({},a,{options:{interactions:n.map(function(s){return __assign$8(__assign$8({},s),{type:o[s.type]||s.type})})}}))}return e.removeInteraction("legend-active"),e.removeInteraction("legend-highlight"),a}function adaptor$3(a){return flow(padding,theme$2,data$1,geometry$2,label$1,scale$2({}),legend$3,axis$2,tooltip$9,vennInteraction,animation$5)(a)}var Venn=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="venn",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$4},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$3},r.prototype.triggerResize=function(){this.chart.destroyed||(this.chart.forceFit(),this.chart.clear(),this.execAdaptor(),this.chart.render(!0))},r}(Plot),X_FIELD="x",VIOLIN_Y_FIELD="violinY",VIOLIN_SIZE_FIELD="violinSize",MIN_MAX_FIELD="minMax",QUANTILE_FIELD="quantile",MEDIAN_FIELD="median",VIOLIN_VIEW_ID="violin_view",MIN_MAX_VIEW_ID="min_max_view",QUANTILE_VIEW_ID="quantile_view",MEDIAN_VIEW_ID="median_view",DEFAULT_OPTIONS$3=deepAssign({},Plot.getDefaultOptions(),{syncViewPadding:!0,kde:{type:"triangular",sampleSize:32,width:3},violinStyle:{lineWidth:1,fillOpacity:.3,strokeOpacity:.75},xAxis:{grid:{line:null},tickLine:{alignTick:!1}},yAxis:{grid:{line:{style:{lineWidth:.5,lineDash:[4,4]}}}},legend:{position:"top-left"},tooltip:{showMarkers:!1}}),src={exports:{}},helper={exports:{}};(function(a){var r=a.exports;a.exports.isNumber=function(e){return typeof e=="number"},a.exports.findMin=function(e){if(e.length===0)return 1/0;for(var n=e[0],o=1;o<e.length;o++)n=Math.min(n,e[o]);return n},a.exports.findMax=function(e){if(e.length===0)return-1/0;for(var n=e[0],o=1;o<e.length;o++)n=Math.max(n,e[o]);return n},a.exports.findMinMulti=function(e){for(var n=r.findMin(e[0]),o=1;o<e.length;o++)n=Math.min(n,r.findMin(e[o]));return n},a.exports.findMaxMulti=function(e){for(var n=r.findMax(e[0]),o=1;o<e.length;o++)n=Math.max(n,r.findMax(e[o]));return n},a.exports.inside=function(e,n,o){return e<=o&&o<=n}})(helper);var helperExports=helper.exports;(function(a){var r=50,e=2,n=Math.log(2),o=a.exports,s=helperExports;function l(u){return 1-Math.abs(u)}a.exports.getUnifiedMinMax=function(u,f){return o.getUnifiedMinMaxMulti([u],f)},a.exports.getUnifiedMinMaxMulti=function(u,f){f=f||{};var d=!1,g=!1,p=s.isNumber(f.width)?f.width:e,v=s.isNumber(f.size)?f.size:r,m=s.isNumber(f.min)?f.min:(d=!0,s.findMinMulti(u)),y=s.isNumber(f.max)?f.max:(g=!0,s.findMaxMulti(u)),x=y-m,_=x/(v-1);return d&&(m=m-2*p*_),g&&(y=y+2*p*_),{min:m,max:y}},a.exports.create=function(u,f){if(f=f||{},!u||u.length===0)return[];var d=s.isNumber(f.size)?f.size:r,g=s.isNumber(f.width)?f.width:e,p=o.getUnifiedMinMax(u,{size:d,width:g,min:f.min,max:f.max}),v=p.min,m=p.max,y=m-v,x=y/(d-1);if(y===0)return[{x:v,y:1}];for(var _=[],E=0;E<d;E++)_.push({x:v+E*x,y:0});var S=function(w){return Math.floor((w-v)/x)},A=c(l,g),T=A[g],b=A[g-1]-A[g-2],C=0;u.forEach(function(w){var M=S(w);if(!(M+g<0||M-g>=_.length)){var D=Math.max(M-g,0),O=M,F=Math.min(M+g,_.length-1),k=D-(M-g),$=M+g-F,V=A[-g-1+k]||0,N=A[-g-1+$]||0,B=T/(T-V-N);k>0&&(C+=B*(k-1)*b);var G=Math.max(0,M-g+1);s.inside(0,_.length-1,G)&&(_[G].y+=B*1*b),s.inside(0,_.length-1,O+1)&&(_[O+1].y-=B*2*b),s.inside(0,_.length-1,F+1)&&(_[F+1].y+=B*1*b)}});var L=C,R=0,I=0;return _.forEach(function(w){R+=w.y,L+=R,w.y=L,I+=L}),I>0&&_.forEach(function(w){w.y/=I}),_};function c(u,f){for(var d={},g=0,p=-f;p<=f;p++)g+=u(p/f),d[p]=g;return d}a.exports.getExpectedValueFromPdf=function(u){if(!(!u||u.length===0)){var f=0;return u.forEach(function(d){f+=d.x*d.y}),f}},a.exports.getXWithLeftTailArea=function(u,f){if(!(!u||u.length===0)){for(var d=0,g=0,p=0;p<u.length&&(g=p,d+=u[p].y,!(d>=f));p++);return u[g].x}},a.exports.getPerplexity=function(u){if(!(!u||u.length===0)){var f=0;return u.forEach(function(d){var g=Math.log(d.y);isFinite(g)&&(f+=d.y*g)}),f=-f/n,Math.pow(2,f)}}})(src);var srcExports=src.exports;const pdf=getDefaultExportFromCjs$1(srcExports);function quantileSorted(a,r){var e=a.length*r;if(a.length===0)throw new Error("quantile requires at least one data point.");if(r<0||r>1)throw new Error("quantiles must be between 0 and 1");return r===1?a[a.length-1]:r===0?a[0]:e%1!==0?a[Math.ceil(e)-1]:a.length%2===0?(a[e-1]+a[e])/2:a[e]}function swap$1(a,r,e){var n=a[r];a[r]=a[e],a[e]=n}function quickselect(a,r,e,n){for(e=e||0,n=n||a.length-1;n>e;){if(n-e>600){var o=n-e+1,s=r-e+1,l=Math.log(o),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(o-c)/o);s-o/2<0&&(u*=-1);var f=Math.max(e,Math.floor(r-s*c/o+u)),d=Math.min(n,Math.floor(r+(o-s)*c/o+u));quickselect(a,r,f,d)}var g=a[r],p=e,v=n;for(swap$1(a,e,r),a[n]>g&&swap$1(a,e,n);p<v;){for(swap$1(a,p,v),p++,v--;a[p]<g;)p++;for(;a[v]>g;)v--}a[e]===g?swap$1(a,e,v):(v++,swap$1(a,v,n)),v<=r&&(e=v+1),r<=v&&(n=v-1)}}function quantile(a,r){var e=a.slice();if(Array.isArray(r)){multiQuantileSelect(e,r);for(var n=[],o=0;o<r.length;o++)n[o]=quantileSorted(e,r[o]);return n}else{var s=quantileIndex(e.length,r);return quantileSelect(e,s,0,e.length-1),quantileSorted(e,r)}}function quantileSelect(a,r,e,n){r%1===0?quickselect(a,r,e,n):(r=Math.floor(r),quickselect(a,r,e,n),quickselect(a,r+1,r+1,n))}function multiQuantileSelect(a,r){for(var e=[0],n=0;n<r.length;n++)e.push(quantileIndex(a.length,r[n]));e.push(a.length-1),e.sort(compare);for(var o=[0,e.length-1];o.length;){var s=Math.ceil(o.pop()),l=Math.floor(o.pop());if(!(s-l<=1)){var c=Math.floor((l+s)/2);quantileSelect(a,e[c],Math.floor(e[l]),Math.ceil(e[s])),o.push(l,c,c,s)}}}function compare(a,r){return a-r}function quantileIndex(a,r){var e=a*r;return r===1?a-1:r===0?0:e%1!==0?Math.ceil(e)-1:a%2===0?e-.5:e}var toBoxValue=function(a){return{low:min$2(a),high:max$2(a),q1:quantile(a,.25),q3:quantile(a,.75),median:quantile(a,[.5]),minMax:[min$2(a),max$2(a)],quantile:[quantile(a,.25),quantile(a,.75)]}},toViolinValue=function(a,r){var e=pdf.create(a,r);return{violinSize:e.map(function(n){return n.y}),violinY:e.map(function(n){return n.x})}},transformViolinData=function(a){var r=a.xField,e=a.yField,n=a.seriesField,o=a.data,s=a.kde,l={min:s.min,max:s.max,size:s.sampleSize,width:s.width};if(!n){var c=groupBy(o,r);return Object.keys(c).map(function(d){var g=c[d],p=g.map(function(v){return v[e]});return __assign$8(__assign$8({x:d},toViolinValue(p,l)),toBoxValue(p))})}var u=[],f=groupBy(o,n);return Object.keys(f).forEach(function(d){var g=groupBy(f[d],r);return Object.keys(g).forEach(function(p){var v,m=g[p],y=m.map(function(x){return x[e]});u.push(__assign$8(__assign$8((v={x:p},v[n]=d,v),toViolinValue(y,l)),toBoxValue(y)))})}),u},TOOLTIP_FIELDS=["low","high","q1","q3","median"],adjustCfg=[{type:"dodge",marginRatio:1/32}];function data(a){var r=a.chart,e=a.options;return r.data(transformViolinData(e)),a}function violinView(a){var r=a.chart,e=a.options,n=e.seriesField,o=e.color,s=e.shape,l=s===void 0?"violin":s,c=e.violinStyle,u=e.tooltip,f=e.state,d=r.createView({id:VIOLIN_VIEW_ID});return violin({chart:d,options:{xField:X_FIELD,yField:VIOLIN_Y_FIELD,seriesField:n||X_FIELD,sizeField:VIOLIN_SIZE_FIELD,tooltip:__assign$8({fields:TOOLTIP_FIELDS},u),violin:{style:c,color:o,shape:l},state:f}}),d.geometries[0].adjust(adjustCfg),a}function boxView(a){var r=a.chart,e=a.options,n=e.seriesField,o=e.color,s=e.tooltip,l=e.box;if(l===!1)return a;var c=r.createView({id:MIN_MAX_VIEW_ID});interval({chart:c,options:{xField:X_FIELD,yField:MIN_MAX_FIELD,seriesField:n||X_FIELD,tooltip:__assign$8({fields:TOOLTIP_FIELDS},s),state:typeof l=="object"?l.state:{},interval:{color:o,size:1,style:{lineWidth:0}}}}),c.geometries[0].adjust(adjustCfg);var u=r.createView({id:QUANTILE_VIEW_ID});interval({chart:u,options:{xField:X_FIELD,yField:QUANTILE_FIELD,seriesField:n||X_FIELD,tooltip:__assign$8({fields:TOOLTIP_FIELDS},s),state:typeof l=="object"?l.state:{},interval:{color:o,size:8,style:{fillOpacity:1}}}}),u.geometries[0].adjust(adjustCfg);var f=r.createView({id:MEDIAN_VIEW_ID});return point({chart:f,options:{xField:X_FIELD,yField:MEDIAN_FIELD,seriesField:n||X_FIELD,tooltip:__assign$8({fields:TOOLTIP_FIELDS},s),state:typeof l=="object"?l.state:{},point:{color:o,size:1,style:{fill:"white",lineWidth:0}}}}),f.geometries[0].adjust(adjustCfg),u.axis(!1),c.axis(!1),f.axis(!1),f.legend(!1),c.legend(!1),u.legend(!1),a}function meta$2(a){var r,e=a.chart,n=a.options,o=n.meta,s=n.xAxis,l=n.yAxis,c={},u=deepAssign(c,o,(r={},r[X_FIELD]=__assign$8(__assign$8({sync:!0},pick(s,AXIS_META_CONFIG_KEYS)),{type:"cat"}),r[VIOLIN_Y_FIELD]=__assign$8({sync:!0},pick(l,AXIS_META_CONFIG_KEYS)),r[MIN_MAX_FIELD]=__assign$8({sync:VIOLIN_Y_FIELD},pick(l,AXIS_META_CONFIG_KEYS)),r[QUANTILE_FIELD]=__assign$8({sync:VIOLIN_Y_FIELD},pick(l,AXIS_META_CONFIG_KEYS)),r[MEDIAN_FIELD]=__assign$8({sync:VIOLIN_Y_FIELD},pick(l,AXIS_META_CONFIG_KEYS)),r));return e.scale(u),a}function axis$1(a){var r=a.chart,e=a.options,n=e.xAxis,o=e.yAxis,s=findViewById(r,VIOLIN_VIEW_ID);return n===!1?s.axis(X_FIELD,!1):s.axis(X_FIELD,n),o===!1?s.axis(VIOLIN_Y_FIELD,!1):s.axis(VIOLIN_Y_FIELD,o),r.axis(!1),a}function legend$2(a){var r=a.chart,e=a.options,n=e.legend,o=e.seriesField,s=e.shape;if(n===!1)r.legend(!1);else{var l=o||X_FIELD,c=omit$1(n,["selected"]);(!s||!s.startsWith("hollow"))&&(get(c,["marker","style","lineWidth"])||set(c,["marker","style","lineWidth"],0)),r.legend(l,c),get(n,"selected")&&each$1(r.views,function(u){return u.legend(l,n)})}return a}function annotation(a){var r=a.chart,e=findViewById(r,VIOLIN_VIEW_ID);return annotation$2()(__assign$8(__assign$8({},a),{chart:e})),a}function animation(a){var r=a.chart,e=a.options,n=e.animation;return each$1(r.views,function(o){addViewAnimation(o,n)}),a}function adaptor$2(a){return flow(theme$2,data,violinView,boxView,meta$2,tooltip$9,axis$1,legend$2,interaction$8,annotation,animation)(a)}var Violin=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="violin",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$3},r.prototype.changeData=function(e){this.updateOption({data:e}),this.chart.changeData(transformViolinData(this.options))},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.getSchemaAdaptor=function(){return adaptor$2},r}(Plot),Y_FIELD="$$yField$$",DIFF_FIELD="$$diffField$$",ABSOLUTE_FIELD="$$absoluteField$$",IS_TOTAL="$$isTotal$$",DEFAULT_OPTIONS$2={label:{},leaderLine:{style:{lineWidth:1,stroke:"#8c8c8c",lineDash:[4,2]}},total:{style:{fill:"rgba(0, 0, 0, 0.25)"}},interactions:[{type:"element-active"}],risingFill:"#f4664a",fallingFill:"#30bf78",waterfallStyle:{fill:"rgba(0, 0, 0, 0.25)"},yAxis:{grid:{line:{style:{lineDash:[4,2]}}}}};function getRectPath(a){for(var r=[],e=0;e<a.length;e++){var n=a[e];if(n){var o=e===0?"M":"L";r.push([o,n.x,n.y])}}var s=a[0];return r.push(["L",s.x,s.y]),r.push(["z"]),r}function getFillAttrs(a){return deepAssign({},a.defaultStyle,a.style,{fill:a.color})}registerShape("interval","waterfall",{draw:function(a,r){var e=a.customInfo,n=a.points,o=a.nextPoints,s=r.addGroup(),l=this.parsePath(getRectPath(n)),c=getFillAttrs(a);s.addShape("path",{attrs:__assign$8(__assign$8({},c),{path:l})});var u=get(e,"leaderLine");if(u&&o){var f=[["M",n[2].x,n[2].y],["L",o[0].x,o[0].y]];n[2].y===o[1].y&&(f[1]=["L",o[1].x,o[1].y]),f=this.parsePath(f),s.addShape("path",{attrs:__assign$8({path:f},u.style||{})})}return s}});function processData(a,r,e,n,o){var s,l=[];if(reduce(a,function(u,f){var d;log(LEVEL.WARN,isNumber$2(f[e]),"".concat(f[e]," is not a valid number"));var g=isUndefined$1(f[e])?null:f[e];return l.push(__assign$8(__assign$8({},f),(d={},d[n]=[u,u+g],d))),u+g},0),l.length&&o){var c=get(l,[[a.length-1],n,[1]]);l.push((s={},s[r]=o.label,s[e]=c,s[n]=[0,c],s))}return l}function transformData(a,r,e,n){var o=processData(a,r,e,Y_FIELD,n);return o.map(function(s,l){var c;return isObject$1(s)?__assign$8(__assign$8({},s),(c={},c[ABSOLUTE_FIELD]=s[Y_FIELD][1],c[DIFF_FIELD]=s[Y_FIELD][1]-s[Y_FIELD][0],c[IS_TOTAL]=l===a.length,c)):s})}function defaultOptions(a){var r=a.options,e=r.locale,n=r.total,o=getLocale(e).get(["waterfall","total"]);return n&&typeof n.label!="string"&&o&&(a.options.total.label=o),a}function geometry$1(a){var r=a.chart,e=a.options,n=e.data,o=e.xField,s=e.yField,l=e.total,c=e.leaderLine,u=e.columnWidthRatio,f=e.waterfallStyle,d=e.risingFill,g=e.fallingFill,p=e.color,v=e.shape,m=e.customInfo;r.data(transformData(n,o,s,l));var y=p||function(S){return get(S,[IS_TOTAL])?get(l,["style","fill"],""):get(S,[Y_FIELD,1])-get(S,[Y_FIELD,0])>0?d:g},x=deepAssign({},a,{options:{xField:o,yField:Y_FIELD,seriesField:o,rawFields:[s,DIFF_FIELD,IS_TOTAL,Y_FIELD],widthRatio:u,interval:{style:f,shape:v||"waterfall",color:y}}}),_=interval(x).ext,E=_.geometry;return E.customInfo(__assign$8(__assign$8({},m),{leaderLine:c})),a}function meta$1(a){var r,e,n=a.options,o=n.xAxis,s=n.yAxis,l=n.xField,c=n.yField,u=n.meta,f=deepAssign({},{alias:c},get(u,c));return flow(scale$2((r={},r[l]=o,r[c]=s,r[Y_FIELD]=s,r),deepAssign({},u,(e={},e[Y_FIELD]=f,e[DIFF_FIELD]=f,e[ABSOLUTE_FIELD]=f,e))))(a)}function axis(a){var r=a.chart,e=a.options,n=e.xAxis,o=e.yAxis,s=e.xField,l=e.yField;return n===!1?r.axis(s,!1):r.axis(s,n),o===!1?(r.axis(l,!1),r.axis(Y_FIELD,!1)):(r.axis(l,o),r.axis(Y_FIELD,o)),a}function legend$1(a){var r=a.chart,e=a.options,n=e.legend,o=e.total,s=e.risingFill,l=e.fallingFill,c=e.locale,u=getLocale(c);if(n===!1)r.legend(!1);else{var f=[{name:u.get(["general","increase"]),value:"increase",marker:{symbol:"square",style:{r:5,fill:s}}},{name:u.get(["general","decrease"]),value:"decrease",marker:{symbol:"square",style:{r:5,fill:l}}}];o&&f.push({name:o.label||"",value:"total",marker:{symbol:"square",style:deepAssign({},{r:5},get(o,"style"))}}),r.legend(deepAssign({},{custom:!0,position:"top",items:f},n)),r.removeInteraction("legend-filter")}return a}function label(a){var r=a.chart,e=a.options,n=e.label,o=e.labelMode,s=e.xField,l=findGeometry(r,"interval");if(!n)l.label(!1);else{var c=n.callback,u=__rest$1(n,["callback"]);l.label({fields:o==="absolute"?[ABSOLUTE_FIELD,s]:[DIFF_FIELD,s],callback:c,cfg:transformLabel(u)})}return a}function tooltip(a){var r=a.chart,e=a.options,n=e.tooltip,o=e.xField,s=e.yField;if(n!==!1){r.tooltip(__assign$8({showCrosshairs:!1,showMarkers:!1,shared:!0,fields:[s]},n));var l=r.geometries[0];n!=null&&n.formatter?l.tooltip("".concat(o,"*").concat(s),n.formatter):l.tooltip(s)}else r.tooltip(!1);return a}function adaptor$1(a){return flow(defaultOptions,theme$2,geometry$1,meta$1,axis,legend$1,tooltip,label,state,interaction$8,animation$5,annotation$2())(a)}var Waterfall=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="waterfall",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$2},r.prototype.changeData=function(e){var n=this.options,o=n.xField,s=n.yField,l=n.total;this.updateOption({data:e}),this.chart.changeData(transformData(e,o,s,l))},r.prototype.getSchemaAdaptor=function(){return adaptor$1},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r}(Plot),WORD_CLOUD_COLOR_FIELD="color",DEFAULT_OPTIONS$1=deepAssign({},Plot.getDefaultOptions(),{timeInterval:2e3,legend:!1,tooltip:{showTitle:!1,showMarkers:!1,showCrosshairs:!1,fields:["text","value",WORD_CLOUD_COLOR_FIELD],formatter:function(a){return{name:a.text,value:a.value}}},wordStyle:{fontFamily:"Verdana",fontWeight:"normal",padding:1,fontSize:[12,60],rotation:[0,90],rotationSteps:2,rotateRatio:.5}}),DEFAULT_OPTIONS={font:function(){return"serif"},padding:1,size:[500,500],spiral:"archimedean",timeInterval:3e3};function wordCloud(a,r){return r=mix({},DEFAULT_OPTIONS,r),transform$1(a,r)}function transform$1(a,r){var e=tagCloud();["font","fontSize","fontWeight","padding","rotate","size","spiral","timeInterval","random"].forEach(function(u){isNil(r[u])||e[u](r[u])}),e.words(a),r.imageMask&&e.createMask(r.imageMask);var n=e.start(),o=n._tags;o.forEach(function(u){u.x+=r.size[0]/2,u.y+=r.size[1]/2});var s=r.size,l=s[0],c=s[1];return o.push({text:"",value:0,x:0,y:0,opacity:0}),o.push({text:"",value:0,x:l,y:c,opacity:0}),o}var cloudRadians=Math.PI/180,cw=64,ch=2048;function cloudText(a){return a.text}function cloudFont(){return"serif"}function cloudFontNormal(){return"normal"}function cloudFontSize(a){return a.value}function cloudRotate(){return~~(Math.random()*2)*90}function cloudPadding(){return 1}function cloudSprite(a,r,e,n){if(!r.sprite){var o=a.context,s=a.ratio;o.clearRect(0,0,(cw<<5)/s,ch/s);var l=0,c=0,u=0,f=e.length;for(--n;++n<f;){r=e[n],o.save(),o.font=r.style+" "+r.weight+" "+~~((r.size+1)/s)+"px "+r.font;var d=o.measureText(r.text+"m").width*s,g=r.size<<1;if(r.rotate){var p=Math.sin(r.rotate*cloudRadians),v=Math.cos(r.rotate*cloudRadians),m=d*v,y=d*p,x=g*v,_=g*p;d=Math.max(Math.abs(m+_),Math.abs(m-_))+31>>5<<5,g=~~Math.max(Math.abs(y+x),Math.abs(y-x))}else d=d+31>>5<<5;if(g>u&&(u=g),l+d>=cw<<5&&(l=0,c+=u,u=0),c+g>=ch)break;o.translate((l+(d>>1))/s,(c+(g>>1))/s),r.rotate&&o.rotate(r.rotate*cloudRadians),o.fillText(r.text,0,0),r.padding&&(o.lineWidth=2*r.padding,o.strokeText(r.text,0,0)),o.restore(),r.width=d,r.height=g,r.xoff=l,r.yoff=c,r.x1=d>>1,r.y1=g>>1,r.x0=-r.x1,r.y0=-r.y1,r.hasText=!0,l+=d}for(var E=o.getImageData(0,0,(cw<<5)/s,ch/s).data,S=[];--n>=0;)if(r=e[n],!!r.hasText){for(var d=r.width,A=d>>5,g=r.y1-r.y0,T=0;T<g*A;T++)S[T]=0;if(l=r.xoff,l==null)return;c=r.yoff;for(var b=0,C=-1,L=0;L<g;L++){for(var T=0;T<d;T++){var R=A*L+(T>>5),I=E[(c+L)*(cw<<5)+(l+T)<<2]?1<<31-T%32:0;S[R]|=I,b|=I}b?C=L:(r.y0++,g--,L--,c++)}r.y1=r.y0+C,r.sprite=S.slice(0,(r.y1-r.y0)*A)}}}function cloudCollide(a,r,e){e>>=5;for(var n=a.sprite,o=a.width>>5,s=a.x-(o<<4),l=s&127,c=32-l,u=a.y1-a.y0,f=(a.y+a.y0)*e+(s>>5),d,g=0;g<u;g++){d=0;for(var p=0;p<=o;p++)if((d<<c|(p<o?(d=n[g*o+p])>>>l:0))&r[f+p])return!0;f+=e}return!1}function cloudBounds(a,r){var e=a[0],n=a[1];r.x+r.x0<e.x&&(e.x=r.x+r.x0),r.y+r.y0<e.y&&(e.y=r.y+r.y0),r.x+r.x1>n.x&&(n.x=r.x+r.x1),r.y+r.y1>n.y&&(n.y=r.y+r.y1)}function collideRects(a,r){return a.x+a.x1>r[0].x&&a.x+a.x0<r[1].x&&a.y+a.y1>r[0].y&&a.y+a.y0<r[1].y}function archimedeanSpiral(a){var r=a[0]/a[1];return function(e){return[r*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function rectangularSpiral(a){var r=4,e=r*a[0]/a[1],n=0,o=0;return function(s){var l=s<0?-1:1;switch(Math.sqrt(1+4*l*s)-l&3){case 0:n+=e;break;case 1:o+=r;break;case 2:n-=e;break;default:o-=r;break}return[n,o]}}function zeroArray(a){for(var r=[],e=-1;++e<a;)r[e]=0;return r}function cloudCanvas(){return document.createElement("canvas")}function functor(a){return isFunction$1(a)?a:function(){return a}}var spirals={archimedean:archimedeanSpiral,rectangular:rectangularSpiral};function tagCloud(){var a=[256,256],r=cloudFont,e=cloudFontSize,n=cloudFontNormal,o=cloudRotate,s=cloudPadding,l=archimedeanSpiral,c=Math.random,u=[],f=1/0,d=cloudText,g=cloudFontNormal,p=cloudCanvas,v={};v.start=function(){var x=a[0],_=a[1],E=m(p()),S=v.board?v.board:zeroArray((a[0]>>5)*a[1]),A=u.length,T=[],b=u.map(function(I,w,M){return I.text=d.call(this,I,w,M),I.font=r.call(this,I,w,M),I.style=g.call(this,I,w,M),I.weight=n.call(this,I,w,M),I.rotate=o.call(this,I,w,M),I.size=~~e.call(this,I,w,M),I.padding=s.call(this,I,w,M),I}).sort(function(I,w){return w.size-I.size}),C=-1,L=v.board?[{x:0,y:0},{x,y:_}]:null;R();function R(){for(var I=Date.now();Date.now()-I<f&&++C<A;){var w=b[C];w.x=x*(c()+.5)>>1,w.y=_*(c()+.5)>>1,cloudSprite(E,w,b,C),w.hasText&&y(S,w,L)&&(T.push(w),L?v.hasImage||cloudBounds(L,w):L=[{x:w.x+w.x0,y:w.y+w.y0},{x:w.x+w.x1,y:w.y+w.y1}],w.x-=a[0]>>1,w.y-=a[1]>>1)}v._tags=T,v._bounds=L}return v};function m(x){x.width=x.height=1;var _=Math.sqrt(x.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,1,1).data.length>>2);x.width=(cw<<5)/_,x.height=ch/_;var E=x.getContext("2d",{willReadFrequently:!0});return E.fillStyle=E.strokeStyle="red",E.textAlign="center",{context:E,ratio:_}}function y(x,_,E){for(var S=_.x,A=_.y,T=Math.sqrt(a[0]*a[0]+a[1]*a[1]),b=l(a),C=c()<.5?1:-1,L,R=-C,I,w;(L=b(R+=C))&&(I=~~L[0],w=~~L[1],!(Math.min(Math.abs(I),Math.abs(w))>=T));)if(_.x=S+I,_.y=A+w,!(_.x+_.x0<0||_.y+_.y0<0||_.x+_.x1>a[0]||_.y+_.y1>a[1])&&(!E||!cloudCollide(_,x,a[0]))&&(!E||collideRects(_,E))){for(var M=_.sprite,D=_.width>>5,O=a[0]>>5,F=_.x-(D<<4),k=F&127,$=32-k,V=_.y1-_.y0,N=void 0,B=(_.y+_.y0)*O+(F>>5),G=0;G<V;G++){N=0;for(var z=0;z<=D;z++)x[B+z]|=N<<$|(z<D?(N=M[G*D+z])>>>k:0);B+=O}return delete _.sprite,!0}return!1}return v.createMask=function(x){var _=document.createElement("canvas"),E=a[0],S=a[1];if(!(!E||!S)){var A=E>>5,T=zeroArray((E>>5)*S);_.width=E,_.height=S;var b=_.getContext("2d");b.drawImage(x,0,0,x.width,x.height,0,0,E,S);for(var C=b.getImageData(0,0,E,S).data,L=0;L<S;L++)for(var R=0;R<E;R++){var I=A*L+(R>>5),w=L*E+R<<2,M=C[w]>=250&&C[w+1]>=250&&C[w+2]>=250,D=M?1<<31-R%32:0;T[I]|=D}v.board=T,v.hasImage=!0}},v.timeInterval=function(x){f=x??1/0},v.words=function(x){u=x},v.size=function(x){a=[+x[0],+x[1]]},v.font=function(x){r=functor(x)},v.fontWeight=function(x){n=functor(x)},v.rotate=function(x){o=functor(x)},v.spiral=function(x){l=spirals[x]||x},v.fontSize=function(x){e=functor(x)},v.padding=function(x){s=functor(x)},v.random=function(x){c=functor(x)},v}function transform(a){var r=a.options,e=a.chart,n=e,o=n.width,s=n.height,l=n.padding,c=n.appendPadding,u=n.ele,f=r.data,d=r.imageMask,g=r.wordField,p=r.weightField,v=r.colorField,m=r.wordStyle,y=r.timeInterval,x=r.random,_=r.spiral,E=r.autoFit,S=E===void 0?!0:E,A=r.placementStrategy;if(!f||!f.length)return[];var T=m.fontFamily,b=m.fontWeight,C=m.padding,L=m.fontSize,R=getSingleKeyValues(f,p),I=[min(R),max(R)],w=f.map(function(O){return{text:O[g],value:O[p],color:O[v],datum:O}}),M={imageMask:d,font:T,fontSize:getFontSizeMapping(L,I),fontWeight:b,size:getSize({width:o,height:s,padding:l,appendPadding:c,autoFit:S,container:u}),padding:C,timeInterval:y,random:x,spiral:_,rotate:getRotate(r)};if(isFunction$1(A)){var D=w.map(function(O,F,k){return __assign$8(__assign$8(__assign$8({},O),{hasText:!!O.text,font:functor(M.font)(O,F,k),weight:functor(M.fontWeight)(O,F,k),rotate:functor(M.rotate)(O,F,k),size:functor(M.fontSize)(O,F,k),style:"normal"}),A.call(e,O,F,k))});return D.push({text:"",value:0,x:0,y:0,opacity:0}),D.push({text:"",value:0,x:M.size[0],y:M.size[1],opacity:0}),D}return wordCloud(w,M)}function getSize(a){var r=a.width,e=a.height,n=a.container,o=a.autoFit,s=a.padding,l=a.appendPadding;if(o){var c=getContainerSize(n);r=c.width,e=c.height}r=r||400,e=e||400;var u=resolvePadding({padding:s,appendPadding:l}),f=u[0],d=u[1],g=u[2],p=u[3],v=[r-(p+d),e-(f+g)];return v}function resolvePadding(a){var r=normalPadding(a.padding),e=normalPadding(a.appendPadding),n=r[0]+e[0],o=r[1]+e[1],s=r[2]+e[2],l=r[3]+e[3];return[n,o,s,l]}function processImageMask(a){return new Promise(function(r,e){if(a instanceof HTMLImageElement){r(a);return}if(isString$1(a)){var n=new Image;n.crossOrigin="anonymous",n.src=a,n.onload=function(){r(n)},n.onerror=function(){log(LEVEL.ERROR,!1,"image %s load failed !!!",a),e()};return}log(LEVEL.WARN,a===void 0,"The type of imageMask option must be String or HTMLImageElement."),e()})}function getFontSizeMapping(a,r){if(isFunction$1(a))return a;if(isArray$4(a)){var e=a[0],n=a[1];if(!r)return function(){return(n+e)/2};var o=r[0],s=r[1];return s===o?function(){return(n+e)/2}:function(c){var u=c.value;return(n-e)/(s-o)*(u-o)+e}}return function(){return a}}function getSingleKeyValues(a,r){return a.map(function(e){return e[r]}).filter(function(e){return typeof e=="number"&&!isNaN(e)})}function getRotate(a){var r=resolveRotate(a),e=r.rotation,n=r.rotationSteps;if(!isArray$4(e))return e;var o=e[0],s=e[1],l=n===1?0:(s-o)/(n-1);return function(){return s===o?s:Math.floor(Math.random()*n)*l}}function resolveRotate(a){var r=a.wordStyle.rotationSteps;return r<1&&(log(LEVEL.WARN,!1,"The rotationSteps option must be greater than or equal to 1."),r=1),{rotation:a.wordStyle.rotation,rotationSteps:r}}function min(a){return Math.min.apply(Math,a)}function max(a){return Math.max.apply(Math,a)}function geometry(a){var r=a.chart,e=a.options,n=e.colorField,o=e.color,s=transform(a);r.data(s);var l=deepAssign({},a,{options:{xField:"x",yField:"y",seriesField:n&&WORD_CLOUD_COLOR_FIELD,rawFields:isFunction$1(o)&&__spreadArray$2(__spreadArray$2([],get(e,"rawFields",[]),!0),["datum"],!1),point:{color:o,shape:"word-cloud"}}}),c=point(l).ext;return c.geometry.label(!1),r.coordinate().reflect("y"),r.axis(!1),a}function meta(a){return flow(scale$2({x:{nice:!1},y:{nice:!1}}))(a)}function legend(a){var r=a.chart,e=a.options,n=e.legend,o=e.colorField;return n===!1?r.legend(!1):o&&r.legend(WORD_CLOUD_COLOR_FIELD,n),a}function adaptor(a){flow(geometry,meta,tooltip$9,legend,interaction$8,animation$5,theme$2,state)(a)}registerShape("point","word-cloud",{draw:function(a,r){var e=a.x,n=a.y,o=r.addShape("text",{attrs:__assign$8(__assign$8({},getTextAttrs(a)),{x:e,y:n})}),s=a.data.rotate;return typeof s=="number"&&Util.rotate(o,s*Math.PI/180),o}});function getTextAttrs(a){return{fontSize:a.data.size,text:a.data.text,textAlign:"center",fontFamily:a.data.font,fontWeight:a.data.weight,fill:a.color||a.defaultStyle.stroke,textBaseline:"alphabetic"}}var WordCloud=function(a){__extends$7(r,a);function r(){var e=a!==null&&a.apply(this,arguments)||this;return e.type="word-cloud",e}return r.getDefaultOptions=function(){return DEFAULT_OPTIONS$1},r.prototype.changeData=function(e){this.updateOption({data:e}),this.options.imageMask?this.render():this.chart.changeData(transform({chart:this.chart,options:this.options}))},r.prototype.getDefaultOptions=function(){return r.getDefaultOptions()},r.prototype.render=function(){var e=this;return new Promise(function(n){var o=e.options.imageMask;if(!o){a.prototype.render.call(e),n();return}var s=function(l){e.options=__assign$8(__assign$8({},e.options),{imageMask:l||null}),a.prototype.render.call(e),n()};processImageMask(o).then(s).catch(s)})},r.prototype.getSchemaAdaptor=function(){return adaptor},r.prototype.triggerResize=function(){var e=this;this.chart.destroyed||(this.execAdaptor(),window.setTimeout(function(){a.prototype.triggerResize.call(e)}))},r}(Plot),P=function(a){__extends$7(r,a);function r(e,n,o,s){var l=a.call(this,e,deepAssign({},s,n))||this;return l.type="g2-plot",l.defaultOptions=s,l.adaptor=o,l}return r.prototype.getDefaultOptions=function(){return this.defaultOptions},r.prototype.getSchemaAdaptor=function(){return this.adaptor},r}(Plot),version="2.4.31";registerLocale("en-US",EN_US_LOCALE);registerLocale("zh-CN",ZH_CN_LOCALE);var adaptors={scale:scale$2,legend:legend$g,tooltip:tooltip$9,annotation:annotation$2,interaction:interaction$8,theme:theme$2,animation:animation$5};const G2Plot=Object.freeze(Object.defineProperty({__proto__:null,Area,Bar,BidirectionalBar,Box,Bullet,Chord,CirclePacking,Column,DualAxes,FUNNEL_CONVERSATION_FIELD:FUNNEL_CONVERSATION,Facet,Funnel,G2:index$2,Gauge,Heatmap,Histogram,Lab,Line,Liquid,Mix,MultiView:Mix,P,Pie,Plot,Progress,Radar,RadialBar,RingProgress,Rose,Sankey,Scatter,Stock,Sunburst,TinyArea,TinyColumn,TinyLine,Treemap,Venn,Violin,Waterfall,WordCloud,adaptors,addWaterWave,area,flow,getCanvasPattern,interval,line,measureTextWidth,point,polygon,registerLocale,schema,setGlobal,version},Symbol.toStringTag,{value:"Module"}));class AntdCommonAreaController extends AntdBaseDesignerController{async create(r,e){super.commonCreate(r,Area,e)}destroy(){this.instance.destroy(),this.instance=null,this.config=null,this.interval&&clearInterval(this.interval)}getConfig(){return this.config}update(r,e){super.commonUpdate(r,Area,e)}updateTheme(r){var f,d,g,p,v,m,y,x,_,E,S,A,T,b,C,L,R,I,w,M,D,O,F,k,$,V,N,B,G;const{type:e}=(f=this.config)==null?void 0:f.base;if(!r)return;const n=(d=this.config)==null?void 0:d.style,{colors:{main:o,mainText:s,subText:l,supplementFirst:c,supplementSecond:u}}=r;n!=null&&n.color&&(e==="AntdBaseArea"?n.color=o:n.color=[o,c,u]),n!=null&&n.point&&((g=n==null?void 0:n.point)!=null&&g.style)&&(n.point.style.fill=o),n!=null&&n.line&&((p=n==null?void 0:n.line)!=null&&p.style)&&(n.line.style.stroke=o),n.legend&&((v=n.legend.itemName)!=null&&v.style)&&(n.legend.itemName.style.fill=s),n!=null&&n.xAxis&&((y=(m=n==null?void 0:n.xAxis)==null?void 0:m.label)!=null&&y.style)&&(n.xAxis.label.style.fill=l),n!=null&&n.xAxis&&((x=n==null?void 0:n.xAxis)!=null&&x.title)&&(n.xAxis.title.style.fill=s),n!=null&&n.xAxis&&((E=(_=n==null?void 0:n.xAxis)==null?void 0:_.line)!=null&&E.style)&&(n.xAxis.line.style.stroke=c),n!=null&&n.xAxis&&((T=(A=(S=n==null?void 0:n.xAxis)==null?void 0:S.grid)==null?void 0:A.line)!=null&&T.style)&&(n.xAxis.grid.line.style.stroke=c),n!=null&&n.xAxis&&((C=(b=n==null?void 0:n.xAxis)==null?void 0:b.tickLine)!=null&&C.style)&&(n.xAxis.tickLine.style.stroke=u),n!=null&&n.xAxis&&((R=(L=n==null?void 0:n.xAxis)==null?void 0:L.subTickLine)!=null&&R.style)&&(n.xAxis.subTickLine.style.stroke=u),n!=null&&n.yAxis&&((w=(I=n==null?void 0:n.yAxis)==null?void 0:I.label)!=null&&w.style)&&(n.yAxis.label.style.fill=l),n!=null&&n.yAxis&&((M=n==null?void 0:n.yAxis)!=null&&M.title)&&(n.yAxis.title.style.fill=s),n!=null&&n.yAxis&&((O=(D=n==null?void 0:n.yAxis)==null?void 0:D.line)!=null&&O.style)&&(n.yAxis.line.style.stroke=c),n!=null&&n.yAxis&&(($=(k=(F=n==null?void 0:n.yAxis)==null?void 0:F.grid)==null?void 0:k.line)!=null&&$.style)&&(n.yAxis.grid.line.style.stroke=c),n!=null&&n.yAxis&&((N=(V=n==null?void 0:n.yAxis)==null?void 0:V.tickLine)!=null&&N.style)&&(n.yAxis.tickLine.style.stroke=u),n!=null&&n.yAxis&&((G=(B=n==null?void 0:n.yAxis)==null?void 0:B.subTickLine)!=null&&G.style)&&(n.yAxis.subTickLine.style.stroke=u),this.update({style:n},{reRender:!0})}}const __vite_glob_0_4=Object.freeze(Object.defineProperty({__proto__:null,default:AntdCommonAreaController},Symbol.toStringTag,{value:"Module"})),AnimationConfig$f=React.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),AntdAreaCommonStyleConfig=React.lazy(()=>__vitePreload(()=>import("./AntdAreaCommonConfig-W73kWJpq.js"),__vite__mapDeps([4,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdAreaCommonStyleConfig}))),AntdAreaCommonFieldMapping=React.lazy(()=>__vitePreload(()=>import("./AntdAreaCommonConfig-W73kWJpq.js"),__vite__mapDeps([4,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdAreaCommonFieldMapping}))),ThemeConfig$e=React.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),BaseInfo$m=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),DataConfig$c=React.lazy(()=>__vitePreload(()=>import("./DataConfig-11-GlHR8.js"),__vite__mapDeps([50,1,2,6,7,8,9,10,11,12,14,5,13,15,16,51]))),FilterConfig$c=React.lazy(()=>__vitePreload(()=>import("./FilterConfig-NGULEsf_.js"),__vite__mapDeps([52,1,2,6,7,8,9,10,11,12,5,13,14,15,16,53])));class AbstractAreaDefinition extends AntdCommonDefinition{getController(){return AntdCommonAreaController}getMenuList(){return getDefaultMenuList()}getMenuToConfigContentMap(){return{base:BaseInfo$m,data:DataConfig$c,style:AntdAreaCommonStyleConfig,animation:AnimationConfig$f,theme:ThemeConfig$e,mapping:AntdAreaCommonFieldMapping,filter:FilterConfig$c}}}const __vite_glob_0_3=Object.freeze(Object.defineProperty({__proto__:null,default:AbstractAreaDefinition},Symbol.toStringTag,{value:"Module"}));class AntdCommonBarController extends AntdBaseDesignerController{async create(r,e){super.commonCreate(r,Bar,e)}destroy(){this.instance.destroy(),this.instance=null,this.config=null,this.interval&&clearInterval(this.interval)}getConfig(){return this.config}update(r,e){super.commonUpdate(r,Bar,e)}updateTheme(r){var u,f,d,g,p,v,m,y,x,_,E,S,A,T,b,C,L,R,I,w,M,D,O,F,k,$;if(!r)return;const e=(u=this.config)==null?void 0:u.style,{colors:{main:n,mainText:o,supplementSecond:s,supplementFirst:l,subText:c}}=r;e!=null&&e.color&&(e.barStyle={fill:void 0},e.color=[n,l,s]),e.legend&&((f=e.legend.itemName)!=null&&f.style)&&(e.legend.itemName.style.fill=o),e!=null&&e.xAxis&&((g=(d=e==null?void 0:e.xAxis)==null?void 0:d.label)!=null&&g.style)&&(e.xAxis.label.style.fill=c),e!=null&&e.xAxis&&((p=e==null?void 0:e.xAxis)!=null&&p.title)&&(e.xAxis.title.style.fill=o),e!=null&&e.xAxis&&((m=(v=e==null?void 0:e.xAxis)==null?void 0:v.line)!=null&&m.style)&&(e.xAxis.line.style.stroke=l),e!=null&&e.xAxis&&((_=(x=(y=e==null?void 0:e.xAxis)==null?void 0:y.grid)==null?void 0:x.line)!=null&&_.style)&&(e.xAxis.grid.line.style.stroke=l),e!=null&&e.xAxis&&((S=(E=e==null?void 0:e.xAxis)==null?void 0:E.tickLine)!=null&&S.style)&&(e.xAxis.tickLine.style.stroke=l),e!=null&&e.xAxis&&((T=(A=e==null?void 0:e.xAxis)==null?void 0:A.subTickLine)!=null&&T.style)&&(e.xAxis.subTickLine.style.stroke=s),e!=null&&e.yAxis&&((C=(b=e==null?void 0:e.yAxis)==null?void 0:b.label)!=null&&C.style)&&(e.yAxis.label.style.fill=c),e!=null&&e.yAxis&&((L=e==null?void 0:e.yAxis)!=null&&L.title)&&(e.yAxis.title.style.fill=o),e!=null&&e.yAxis&&((I=(R=e==null?void 0:e.yAxis)==null?void 0:R.line)!=null&&I.style)&&(e.yAxis.line.style.stroke=l),e!=null&&e.yAxis&&((D=(M=(w=e==null?void 0:e.yAxis)==null?void 0:w.grid)==null?void 0:M.line)!=null&&D.style)&&(e.yAxis.grid.line.style.stroke=l),e!=null&&e.yAxis&&((F=(O=e==null?void 0:e.yAxis)==null?void 0:O.tickLine)!=null&&F.style)&&(e.yAxis.tickLine.style.stroke=l),e!=null&&e.yAxis&&(($=(k=e==null?void 0:e.yAxis)==null?void 0:k.subTickLine)!=null&&$.style)&&(e.yAxis.subTickLine.style.stroke=s),this.update({style:e},{reRender:!0})}}const __vite_glob_0_6=Object.freeze(Object.defineProperty({__proto__:null,default:AntdCommonBarController},Symbol.toStringTag,{value:"Module"})),AnimationConfig$e=React.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),AntdBarCommonStyleConfig=React.lazy(()=>__vitePreload(()=>import("./AntdBarCommonConfig-9BKZvCwA.js"),__vite__mapDeps([54,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdBarCommonStyleConfig}))),AntdBarFieldMapping=React.lazy(()=>__vitePreload(()=>import("./AntdBarCommonConfig-9BKZvCwA.js"),__vite__mapDeps([54,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdBarFieldMapping}))),ThemeConfig$d=React.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),BaseInfo$l=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),DataConfig$b=React.lazy(()=>__vitePreload(()=>import("./DataConfig-11-GlHR8.js"),__vite__mapDeps([50,1,2,6,7,8,9,10,11,12,14,5,13,15,16,51]))),FilterConfig$b=React.lazy(()=>__vitePreload(()=>import("./FilterConfig-NGULEsf_.js"),__vite__mapDeps([52,1,2,6,7,8,9,10,11,12,5,13,14,15,16,53])));class AbstractBarDefinition extends AntdCommonDefinition{getController(){return AntdCommonBarController}getMenuList(){return getDefaultMenuList()}getMenuToConfigContentMap(){return{base:BaseInfo$l,data:DataConfig$b,style:AntdBarCommonStyleConfig,animation:AnimationConfig$e,theme:ThemeConfig$d,mapping:AntdBarFieldMapping,filter:FilterConfig$b}}}const __vite_glob_0_5=Object.freeze(Object.defineProperty({__proto__:null,default:AbstractBarDefinition},Symbol.toStringTag,{value:"Module"}));class AntdCommonColumnController extends AntdBaseDesignerController{async create(r,e){super.commonCreate(r,Column,e)}destroy(){this.instance.destroy(),this.instance=null,this.config=null,this.interval&&clearInterval(this.interval)}getConfig(){return this.config}update(r,e){super.commonUpdate(r,Column,e)}updateTheme(r){var u,f,d,g,p,v,m,y,x,_,E,S,A,T,b,C,L,R,I,w,M,D,O,F,k,$,V;if(!r)return;const e=(u=this.config)==null?void 0:u.style,{colors:{main:n,mainText:o,supplementSecond:s,supplementFirst:l,subText:c}}=r;e!=null&&e.color&&(e.columnStyle={fill:void 0},e.color=[n,l,s]),e.legend&&((f=e.legend.itemName)!=null&&f.style)&&(e.legend.itemName.style.fill=o),e!=null&&e.xAxis&&((p=(g=(d=e==null?void 0:e.xAxis)==null?void 0:d.label)==null?void 0:g.style)!=null&&p.fill)&&(e.xAxis.label.style.fill=c),e!=null&&e.xAxis&&((v=e==null?void 0:e.xAxis)!=null&&v.title)&&(e.xAxis.title.style.fill=o),e!=null&&e.xAxis&&((y=(m=e==null?void 0:e.xAxis)==null?void 0:m.line)!=null&&y.style)&&(e.xAxis.line.style.stroke=l),e!=null&&e.xAxis&&((E=(_=(x=e==null?void 0:e.xAxis)==null?void 0:x.grid)==null?void 0:_.line)!=null&&E.style)&&(e.xAxis.grid.line.style.stroke=l),e!=null&&e.xAxis&&((A=(S=e==null?void 0:e.xAxis)==null?void 0:S.tickLine)!=null&&A.style)&&(e.xAxis.tickLine.style.stroke=l),e!=null&&e.xAxis&&((b=(T=e==null?void 0:e.xAxis)==null?void 0:T.subTickLine)!=null&&b.style)&&(e.xAxis.subTickLine.style.stroke=s),e!=null&&e.yAxis&&((L=(C=e==null?void 0:e.yAxis)==null?void 0:C.label)!=null&&L.style)&&(e.yAxis.label.style.fill=o),e!=null&&e.yAxis&&((R=e==null?void 0:e.yAxis)!=null&&R.title)&&(e.yAxis.title.style.fill=o),e!=null&&e.yAxis&&((w=(I=e==null?void 0:e.yAxis)==null?void 0:I.line)!=null&&w.style)&&(e.yAxis.line.style.stroke=l),e!=null&&e.yAxis&&((O=(D=(M=e==null?void 0:e.yAxis)==null?void 0:M.grid)==null?void 0:D.line)!=null&&O.style)&&(e.yAxis.grid.line.style.stroke=l),e!=null&&e.yAxis&&((k=(F=e==null?void 0:e.yAxis)==null?void 0:F.tickLine)!=null&&k.style)&&(e.yAxis.tickLine.style.stroke=l),e!=null&&e.yAxis&&((V=($=e==null?void 0:e.yAxis)==null?void 0:$.subTickLine)!=null&&V.style)&&(e.yAxis.subTickLine.style.stroke=s),this.update({style:e},{reRender:!0})}}const __vite_glob_0_8=Object.freeze(Object.defineProperty({__proto__:null,default:AntdCommonColumnController},Symbol.toStringTag,{value:"Module"})),AnimationConfig$d=React.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),AntdColumnCommonStyleConfig=React.lazy(()=>__vitePreload(()=>import("./AntdColumnCommonConfig-0rl6HQTY.js"),__vite__mapDeps([55,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdColumnCommonStyleConfig}))),AntdColumnCommonFieldMapping=React.lazy(()=>__vitePreload(()=>import("./AntdColumnCommonConfig-0rl6HQTY.js"),__vite__mapDeps([55,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdColumnCommonFieldMapping}))),ThemeConfig$c=React.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),BaseInfo$k=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),DataConfig$a=React.lazy(()=>__vitePreload(()=>import("./DataConfig-11-GlHR8.js"),__vite__mapDeps([50,1,2,6,7,8,9,10,11,12,14,5,13,15,16,51])));class AbstractColumnDefinition extends AntdCommonDefinition{getController(){return AntdCommonColumnController}getMenuList(){return getDefaultMenuList()}getMenuToConfigContentMap(){return{base:BaseInfo$k,data:DataConfig$a,style:AntdColumnCommonStyleConfig,animation:AnimationConfig$d,theme:ThemeConfig$c,mapping:AntdColumnCommonFieldMapping}}}const __vite_glob_0_7=Object.freeze(Object.defineProperty({__proto__:null,default:AbstractColumnDefinition},Symbol.toStringTag,{value:"Module"}));class AntdCommonLineController extends AntdBaseDesignerController{async create(r,e){super.commonCreate(r,Line,e)}destroy(){this.instance.destroy(),this.instance=null,this.config=null,this.interval&&clearInterval(this.interval)}getConfig(){return this.config}update(r,e){super.commonUpdate(r,Line,e)}updateTheme(r){var f,d,g,p,v,m,y,x,_,E,S,A,T,b,C,L,R,I,w,M,D,O,F,k,$,V,N,B,G,z,H,W,Y,K,Z,tt,et,at,ot,nt,Q;if(!r)return;const{type:e}=(f=this.config)==null?void 0:f.base,n=(d=this.config)==null?void 0:d.style,{colors:{main:o,mainText:s,supplementSecond:l,supplementFirst:c,subText:u}}=r;n!=null&&n.color&&(e==="AntdMultiLine"?n.color=[o,c,l]:n.color=o),n!=null&&n.point&&((g=n==null?void 0:n.point)!=null&&g.style)&&(n.point.style.fill=void 0),n.legend&&((v=(p=n.legend.itemName)==null?void 0:p.style)!=null&&v.fill)&&(n.legend.itemName.style.fill=s),n!=null&&n.xAxis&&((x=(y=(m=n==null?void 0:n.xAxis)==null?void 0:m.label)==null?void 0:y.style)!=null&&x.fill)&&(n.xAxis.label.style.fill=s),n!=null&&n.xAxis&&((E=(_=n==null?void 0:n.xAxis)==null?void 0:_.title)!=null&&E.fill)&&(n.xAxis.title.style.fill=s),n!=null&&n.xAxis&&((T=(A=(S=n==null?void 0:n.xAxis)==null?void 0:S.line)==null?void 0:A.style)!=null&&T.stroke)&&(n.xAxis.line.style.stroke=l),n!=null&&n.xAxis&&((R=(L=(C=(b=n==null?void 0:n.xAxis)==null?void 0:b.grid)==null?void 0:C.line)==null?void 0:L.style)!=null&&R.stroke)&&(n.xAxis.grid.line.style.stroke=u),n!=null&&n.xAxis&&((M=(w=(I=n==null?void 0:n.xAxis)==null?void 0:I.tickLine)==null?void 0:w.style)!=null&&M.stroke)&&(n.xAxis.tickLine.style.stroke=c),n!=null&&n.xAxis&&((F=(O=(D=n==null?void 0:n.xAxis)==null?void 0:D.subTickLine)==null?void 0:O.style)!=null&&F.stroke)&&(n.xAxis.subTickLine.style.stroke=u),n!=null&&n.yAxis&&((V=($=(k=n==null?void 0:n.yAxis)==null?void 0:k.label)==null?void 0:$.style)!=null&&V.fill)&&(n.yAxis.label.style.fill=s),n!=null&&n.yAxis&&((B=(N=n==null?void 0:n.yAxis)==null?void 0:N.title)!=null&&B.fill)&&(n.yAxis.title.style.fill=s),n!=null&&n.yAxis&&((H=(z=(G=n==null?void 0:n.yAxis)==null?void 0:G.line)==null?void 0:z.style)!=null&&H.stroke)&&(n.yAxis.line.style.stroke=l),n!=null&&n.yAxis&&((Z=(K=(Y=(W=n==null?void 0:n.yAxis)==null?void 0:W.grid)==null?void 0:Y.line)==null?void 0:K.style)!=null&&Z.stroke)&&(n.yAxis.grid.line.style.stroke=u),n!=null&&n.yAxis&&((at=(et=(tt=n==null?void 0:n.yAxis)==null?void 0:tt.tickLine)==null?void 0:et.style)!=null&&at.stroke)&&(n.yAxis.tickLine.style.stroke=c),n!=null&&n.yAxis&&((Q=(nt=(ot=n==null?void 0:n.yAxis)==null?void 0:ot.subTickLine)==null?void 0:nt.style)!=null&&Q.stroke)&&(n.yAxis.subTickLine.style.stroke=u),this.update({style:n},{reRender:!0})}}const __vite_glob_0_10=Object.freeze(Object.defineProperty({__proto__:null,default:AntdCommonLineController},Symbol.toStringTag,{value:"Module"})),AnimationConfig$c=React.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),AntdLineCommonStyleConfig=React.lazy(()=>__vitePreload(()=>import("./AntdLineCommonConfig-0syqEiE0.js"),__vite__mapDeps([56,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdLineCommonStyleConfig}))),AntdLineCommonFieldMapping=React.lazy(()=>__vitePreload(()=>import("./AntdLineCommonConfig-0syqEiE0.js"),__vite__mapDeps([56,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdLineCommonFieldMapping}))),ThemeConfig$b=React.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),BaseInfo$j=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),DataConfig$9=React.lazy(()=>__vitePreload(()=>import("./DataConfig-11-GlHR8.js"),__vite__mapDeps([50,1,2,6,7,8,9,10,11,12,14,5,13,15,16,51])));class AbstractLineDefinition extends AntdCommonDefinition{getController(){return AntdCommonLineController}getMenuList(){return getDefaultMenuList()}getMenuToConfigContentMap(){return{base:BaseInfo$j,data:DataConfig$9,style:AntdLineCommonStyleConfig,animation:AnimationConfig$c,theme:ThemeConfig$b,mapping:AntdLineCommonFieldMapping}}}const __vite_glob_0_9=Object.freeze(Object.defineProperty({__proto__:null,default:AbstractLineDefinition},Symbol.toStringTag,{value:"Module"}));class AntdCommonRoseController extends AntdBaseDesignerController{async create(r,e){super.commonCreate(r,Rose,e)}destroy(){this.instance.destroy(),this.instance=null,this.config=null,this.interval&&clearInterval(this.interval)}getConfig(){return this.config}update(r,e){super.commonUpdate(r,Rose,e)}updateTheme(r){var f,d,g,p;if(!r)return;const e=(f=this.config)==null?void 0:f.style,{colors:{main:n,mainText:o,supplementSecond:s,background:l,supplementFirst:c,subText:u}}=r;e!=null&&e.color&&(e.color=[n,o,u,c,s]),e.legend&&((g=(d=e.legend.itemName)==null?void 0:d.style)!=null&&g.fill)&&(e.legend.itemName.style.fill=o),e!=null&&e.sectorStyle&&(e!=null&&e.sectorStyle)&&(e.sectorStyle.stroke=l),e!=null&&e.label&&((p=e==null?void 0:e.label)!=null&&p.style)&&(e.label.style.fill=o),this.update({style:e},{reRender:!0})}}const __vite_glob_0_12=Object.freeze(Object.defineProperty({__proto__:null,default:AntdCommonRoseController},Symbol.toStringTag,{value:"Module"})),AnimationConfig$b=React.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),AntdRoseCommonStyleConfig=React.lazy(()=>__vitePreload(()=>import("./AntdRoseCommonConfig-r6NfKbkY.js"),__vite__mapDeps([57,1,2,5,6,7,8,9,10,11,12,13,14,15,16]))),AntdRoseFieldMapping=React.lazy(()=>__vitePreload(()=>import("./AntdRoseCommonConfig-r6NfKbkY.js"),__vite__mapDeps([57,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdRoseFieldMapping}))),ThemeConfig$a=React.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),BaseInfo$i=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),DataConfig$8=React.lazy(()=>__vitePreload(()=>import("./DataConfig-11-GlHR8.js"),__vite__mapDeps([50,1,2,6,7,8,9,10,11,12,14,5,13,15,16,51])));class AbstractRoseDefinition extends AntdCommonDefinition{getController(){return AntdCommonRoseController}getMenuList(){return getDefaultMenuList()}getMenuToConfigContentMap(){return{base:BaseInfo$i,data:DataConfig$8,style:AntdRoseCommonStyleConfig,animation:AnimationConfig$b,theme:ThemeConfig$a,mapping:AntdRoseFieldMapping}}}const __vite_glob_0_11=Object.freeze(Object.defineProperty({__proto__:null,default:AbstractRoseDefinition},Symbol.toStringTag,{value:"Module"}));class AntdCommonScatterController extends AntdBaseDesignerController{async create(r,e){super.commonCreate(r,Scatter,e)}destroy(){this.instance.destroy(),this.instance=null,this.config=null,this.interval&&clearInterval(this.interval)}getConfig(){return this.config}update(r,e){super.commonUpdate(r,Scatter,e)}updateTheme(r){var u,f,d,g,p,v,m,y,x,_,E,S,A,T,b,C,L,R,I,w,M,D,O,F,k,$;if(!r)return;const e=(u=this.config)==null?void 0:u.style,{colors:{main:n,mainText:o,supplementSecond:s,supplementFirst:l,subText:c}}=r;e!=null&&e.color&&(e.color=[n,o,c,l,s]),e.legend&&((f=e.legend.itemName)!=null&&f.style)&&(e.legend.itemName.style.fill=o),e!=null&&e.xAxis&&((g=(d=e==null?void 0:e.xAxis)==null?void 0:d.label)!=null&&g.style)&&(e.xAxis.label.style.fill=c),e!=null&&e.xAxis&&((p=e==null?void 0:e.xAxis)!=null&&p.title)&&(e.xAxis.title.style.fill=o),e!=null&&e.xAxis&&((m=(v=e==null?void 0:e.xAxis)==null?void 0:v.line)!=null&&m.style)&&(e.xAxis.line.style.stroke=l),e!=null&&e.xAxis&&((_=(x=(y=e==null?void 0:e.xAxis)==null?void 0:y.grid)==null?void 0:x.line)!=null&&_.style)&&(e.xAxis.grid.line.style.stroke=l),e!=null&&e.xAxis&&((S=(E=e==null?void 0:e.xAxis)==null?void 0:E.tickLine)!=null&&S.style)&&(e.xAxis.tickLine.style.stroke=l),e!=null&&e.xAxis&&((T=(A=e==null?void 0:e.xAxis)==null?void 0:A.subTickLine)!=null&&T.style)&&(e.xAxis.subTickLine.style.stroke=s),e!=null&&e.yAxis&&((C=(b=e==null?void 0:e.yAxis)==null?void 0:b.label)!=null&&C.style)&&(e.yAxis.label.style.fill=c),e!=null&&e.yAxis&&((L=e==null?void 0:e.yAxis)!=null&&L.title)&&(e.yAxis.title.style.fill=o),e!=null&&e.yAxis&&((I=(R=e==null?void 0:e.yAxis)==null?void 0:R.line)!=null&&I.style)&&(e.yAxis.line.style.stroke=l),e!=null&&e.yAxis&&((D=(M=(w=e==null?void 0:e.yAxis)==null?void 0:w.grid)==null?void 0:M.line)!=null&&D.style)&&(e.yAxis.grid.line.style.stroke=l),e!=null&&e.yAxis&&((F=(O=e==null?void 0:e.yAxis)==null?void 0:O.tickLine)!=null&&F.style)&&(e.yAxis.tickLine.style.stroke=l),e!=null&&e.yAxis&&(($=(k=e==null?void 0:e.yAxis)==null?void 0:k.subTickLine)!=null&&$.style)&&(e.yAxis.subTickLine.style.stroke=s),this.update({style:e},{reRender:!0})}}const __vite_glob_0_14=Object.freeze(Object.defineProperty({__proto__:null,default:AntdCommonScatterController},Symbol.toStringTag,{value:"Module"})),AnimationConfig$a=React.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),AntdScatterCommonStyleConfig=React.lazy(()=>__vitePreload(()=>import("./AntdScatterCommonConfig-paCNXN1Q.js"),__vite__mapDeps([58,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdScatterCommonStyleConfig}))),AntdScatterFieldMapping=React.lazy(()=>__vitePreload(()=>import("./AntdScatterCommonConfig-paCNXN1Q.js"),__vite__mapDeps([58,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdScatterFieldMapping}))),ThemeConfig$9=React.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),BaseInfo$h=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),DataConfig$7=React.lazy(()=>__vitePreload(()=>import("./DataConfig-11-GlHR8.js"),__vite__mapDeps([50,1,2,6,7,8,9,10,11,12,14,5,13,15,16,51])));class AbstractScatterDefinition extends AntdCommonDefinition{getController(){return AntdCommonScatterController}getMenuList(){return getDefaultMenuList()}getMenuToConfigContentMap(){return{base:BaseInfo$h,data:DataConfig$7,style:AntdScatterCommonStyleConfig,animation:AnimationConfig$a,theme:ThemeConfig$9,mapping:AntdScatterFieldMapping}}}const __vite_glob_0_13=Object.freeze(Object.defineProperty({__proto__:null,default:AbstractScatterDefinition},Symbol.toStringTag,{value:"Module"})),__vite_glob_0_15=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),baseAreaImg="/light-chaser-app/assets/base-area-rTZyFFIu.png",AntdBaseAreaStyleConfig=React.lazy(()=>__vitePreload(()=>import("./AntdBaseAreaConfig-ESg51AhN.js"),__vite__mapDeps([59,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdBaseAreaStyleConfig}))),AntdBaseAreaFieldMapping=React.lazy(()=>__vitePreload(()=>import("./AntdBaseAreaConfig-ESg51AhN.js"),__vite__mapDeps([59,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdBaseAreaFieldMapping})));class AntdBaseAreaDefinition extends AbstractAreaDefinition{getBaseInfo(){return{compName:"Antd基础面积图",compKey:"AntdBaseArea",categorize:"chart",subCategorize:"area"}}getChartImg(){return baseAreaImg}getMenuToConfigContentMap(){const r=super.getMenuToConfigContentMap();return r.style=AntdBaseAreaStyleConfig,r.mapping=AntdBaseAreaFieldMapping,r}getInitConfig(){const r=[{name:"Q1",value:140},{name:"Q2",value:205},{name:"Q3",value:186},{name:"Q4",value:220}];return{base:{id:"",name:"基础面积图",type:"AntdBaseArea"},style:{data:r,xField:"name",yField:"value",smooth:!1,supportCSSTransform:!0,isStack:!1,startOnZero:!1,point:{size:4,style:{fill:"#00ddffff",stroke:"#ffffff",lineWidth:0}},line:{size:0},areaStyle:{fillOpacity:1,fill:"#00DAFF72"},xAxis:{range:[0,1],grid:null,label:{style:{fill:"#adadadff",fontSize:10}},line:{style:{stroke:"#c7c7c76e",lineWidth:1}},tickLine:null,subTickLine:null,title:null,position:"bottom"},yAxis:{grid:null,label:{style:{fill:"#9a9a9aff",fontSize:10}},line:null,tickLine:null,subTickLine:null,title:null},legend:{position:"right-top",layout:"vertical",itemName:{style:{fill:"#00f0ffff",fontSize:12}}},animation:{appear:{animation:"wave-in",duration:3e3}}},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_16=Object.freeze(Object.defineProperty({__proto__:null,default:AntdBaseAreaDefinition},Symbol.toStringTag,{value:"Module"})),percentAreaImg="/light-chaser-app/assets/percent-area-ximgswaD.png";class AntdPercentAreaDefinition extends AbstractAreaDefinition{getBaseInfo(){return{compName:"Antd百分比面积图",compKey:"AntdPercentArea",categorize:"chart",subCategorize:"area"}}getChartImg(){return percentAreaImg}getInitConfig(){const r=[{country:"Asia",year:"1750",value:502},{country:"Asia",year:"1800",value:635},{country:"Asia",year:"1850",value:809},{country:"Asia",year:"1900",value:947},{country:"Asia",year:"1950",value:1402},{country:"Asia",year:"1999",value:3634},{country:"Asia",year:"2050",value:5268},{country:"Africa",year:"1750",value:106},{country:"Africa",year:"1800",value:107},{country:"Africa",year:"1850",value:111},{country:"Africa",year:"1900",value:133},{country:"Africa",year:"1950",value:221},{country:"Africa",year:"1999",value:767},{country:"Africa",year:"2050",value:1766},{country:"Europe",year:"1750",value:163},{country:"Europe",year:"1800",value:203},{country:"Europe",year:"1850",value:276},{country:"Europe",year:"1900",value:408},{country:"Europe",year:"1950",value:547},{country:"Europe",year:"1999",value:729},{country:"Europe",year:"2050",value:628}];return{base:{id:"",name:"百分比面积图",type:"AntdPercentArea"},style:{data:r,xField:"year",yField:"value",seriesField:"country",isPercent:!0,smooth:!0,supportCSSTransform:!0,color:["#4fa3ff67","#009aff67","#006d7f67"],point:{size:3,color:["#4fa3ff67","#009aff67","#006d7f67"],style:{stroke:"#ffffff",lineWidth:0},shape:"circle"},line:{style:{lineWidth:0},color:["#4fa3ff","#009aff","#006d7f"]},areaStyle:{fillOpacity:1},xAxis:{position:"bottom",range:[0,1],grid:null,label:{style:{fill:"#aaaaaaff",fontSize:8}},line:null,tickLine:null,subTickLine:null,title:null},yAxis:{position:"left",grid:null,label:{style:{fill:"#afafafff",fontSize:8}},line:{style:{stroke:"#545454c7",lineWidth:1}},tickLine:null,subTickLine:null,title:null},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#b1b1b1ff",fontSize:12}}},animation:{appear:{animation:"wave-in",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_17=Object.freeze(Object.defineProperty({__proto__:null,default:AntdPercentAreaDefinition},Symbol.toStringTag,{value:"Module"})),stackAreaImg="/light-chaser-app/assets/stack-area-uyWAS6Z-.png";class AntdStackAreaDefinition extends AbstractAreaDefinition{getBaseInfo(){return{compName:"Antd堆叠面积图",compKey:"AntdStackArea",categorize:"chart",subCategorize:"area"}}getChartImg(){return stackAreaImg}getInitConfig(){const r=[{country:"北美",year:1965,value:1390.5},{country:"北美",year:1966,value:1469.5},{country:"北美",year:1967,value:1521.7},{country:"北美",year:1968,value:1615.9},{country:"北美",year:1969,value:1703.7},{country:"中南美",year:1965,value:1109.2},{country:"中南美",year:1966,value:615.7},{country:"中南美",year:1967,value:720.5},{country:"中南美",year:1968,value:1128},{country:"中南美",year:1969,value:434.4},{country:"欧洲",year:1965,value:1058.1},{country:"欧洲",year:1966,value:1089.7},{country:"欧洲",year:1967,value:1121.7},{country:"欧洲",year:1968,value:1196.6},{country:"欧洲",year:1969,value:1285.5}];return{base:{id:"",name:"堆叠面积图",type:"AntdStackArea"},style:{data:r,xField:"year",yField:"value",seriesField:"country",smooth:!1,supportCSSTransform:!0,color:["#4ebfff67","#00a3ff67","#0060b167"],point:{size:3,color:["#4fa3ff67","#009aff67","#006d7f67"],style:{stroke:"#ffffff",lineWidth:0},shape:"circle"},line:{style:{lineWidth:0},color:["#4fa3ff","#009aff","#006d7f"]},areaStyle:{fillOpacity:1},xAxis:{grid:null,label:{style:{fill:"#8c8c8cff",fontSize:10}},line:null,tickLine:null,subTickLine:null,title:null,position:"bottom"},yAxis:{grid:null,label:{style:{fill:"#a8a8a8ff",fontSize:10}},line:{style:{stroke:"#9e9e9e6e",lineWidth:1}},tickLine:null,subTickLine:null,title:null,position:"left"},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#a4a4a4ff",fontSize:10}}},animation:{appear:{animation:"wave-in",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_18=Object.freeze(Object.defineProperty({__proto__:null,default:AntdStackAreaDefinition},Symbol.toStringTag,{value:"Module"})),baseBarImg="/light-chaser-app/assets/base-bar-o8Kakkm6.png";class AntdBaseBarDefinition extends AbstractBarDefinition{getBaseInfo(){return{compName:"Antd基础条形图",compKey:"AntdBaseBar",categorize:"chart",subCategorize:"bar"}}getChartImg(){return baseBarImg}getInitConfig(){const r=[{name:"1951 年",value:48},{name:"1952 年",value:52},{name:"1956 年",value:22}];return{base:{id:"",name:"基础条形图",type:"AntdBaseBar"},style:{data:r,xField:"value",yField:"name",seriesField:"name",maxBarWidth:8,color:["#005d71ff","#00d0e4ff","#5bf0ffff"],barStyle:{radius:0},supportCSSTransform:!0,xAxis:{grid:null,label:{style:{fill:"#878787ff",fontSize:10}},line:{style:{stroke:"#6f6f6f91",lineWidth:1}},tickLine:null,subTickLine:null,position:"right",title:null},yAxis:{grid:null,label:{style:{fill:"#6b6b6bff",fontSize:10},offset:9},line:null,tickLine:null,subTickLine:null,position:"bottom",title:null},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#989898ff",fontSize:10}}},animation:{appear:{animation:"scale-in-x",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_19=Object.freeze(Object.defineProperty({__proto__:null,default:AntdBaseBarDefinition},Symbol.toStringTag,{value:"Module"})),groupBarImg="/light-chaser-app/assets/group-bar-yoW9hgxO.png";class AntdGroupBarDefinition extends AbstractBarDefinition{getBaseInfo(){return{compName:"Antd分组条形图",compKey:"AntdGroupBar",categorize:"chart",subCategorize:"bar"}}getChartImg(){return groupBarImg}getInitConfig(){const r=[{label:"Mon.",type:"series1",value:2800},{label:"Mon.",type:"series2",value:2260},{label:"Tues.",type:"series1",value:1800},{label:"Tues.",type:"series2",value:1300},{label:"Wed.",type:"series1",value:950},{label:"Wed.",type:"series2",value:900}];return{base:{id:"",name:"Antd分组条形图",type:"AntdGroupBar"},style:{data:r,isGroup:!0,xField:"value",yField:"label",seriesField:"type",color:["#00a6ffff","#5dd1ffff"],barStyle:{radius:0},xAxis:{grid:null,label:{style:{fill:"#929292ff",fontSize:10}},line:{style:{stroke:"#a2a2a273",lineWidth:1}},tickLine:null,subTickLine:null,position:"right",title:null},yAxis:{grid:null,label:{style:{fill:"#9c9c9cff",fontSize:10}},line:null,tickLine:null,subTickLine:null,position:"bottom",title:null},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#adadadff",fontSize:12}}},maxBarWidth:8,supportCSSTransform:!0,animation:{appear:{animation:"scale-in-x",duration:3e3}}},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_20=Object.freeze(Object.defineProperty({__proto__:null,default:AntdGroupBarDefinition},Symbol.toStringTag,{value:"Module"})),percentBarImg="/light-chaser-app/assets/percent-bar-dd_G1Ngg.png";class AntdPercentBarDefinition extends AbstractBarDefinition{getBaseInfo(){return{compName:"Antd百分比条形图",compKey:"AntdPercentBar",categorize:"chart",subCategorize:"bar"}}getChartImg(){return percentBarImg}getInitConfig(){const r=[{country:"Asia",year:"1750",value:502},{country:"Asia",year:"1800",value:635},{country:"Asia",year:"1850",value:809},{country:"Africa",year:"1750",value:106},{country:"Africa",year:"1800",value:107},{country:"Africa",year:"1850",value:111},{country:"Europe",year:"1750",value:163},{country:"Europe",year:"1800",value:203},{country:"Europe",year:"1850",value:276}];return{base:{id:"",name:"Antd百分比条形图",type:"AntdPercentBar"},style:{data:r,xField:"value",yField:"year",seriesField:"country",isPercent:!0,isStack:!0,color:["#59bfff","#298aff","#004294"],barStyle:{radius:0},xAxis:{grid:null,label:{style:{fill:"#b7b7b7ff",fontSize:10}},line:{style:{stroke:"#a4a4a473",lineWidth:1}},tickLine:null,subTickLine:null,position:"right",title:null},yAxis:{grid:null,label:{style:{fill:"#9e9e9eff",fontSize:10}},line:null,tickLine:null,subTickLine:null,position:"bottom",title:null},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#989898ff",fontSize:12}}},maxBarWidth:8,supportCSSTransform:!0,animation:{appear:{animation:"scale-in-x",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_21=Object.freeze(Object.defineProperty({__proto__:null,default:AntdPercentBarDefinition},Symbol.toStringTag,{value:"Module"})),rangeBarImg="/light-chaser-app/assets/range-bar-2Igv1w3w.png";class AntdRangeBarDefinition extends AbstractBarDefinition{getBaseInfo(){return{compName:"Antd区间条形图",compKey:"AntdRangeBar",categorize:"chart",subCategorize:"bar"}}getChartImg(){return rangeBarImg}getInitConfig(){const r=[{type:"sort1",values:[36,130]},{type:"sort2",values:[60,95]},{type:"sort3",values:[50,110]},{type:"sort4",values:[20,135]}];return{base:{id:"",name:"Antd区间条形图",type:"AntdRangeBar"},style:{data:r,xField:"values",yField:"type",seriesField:"type",isRange:!0,color:["#2ea4ffff","#7cdaffff","#6cc2ffff"],barStyle:{radius:0},xAxis:{grid:null,label:{style:{fill:"#9c9c9cff",fontSize:11}},line:{style:{stroke:"#b9b9b975",lineWidth:1}},tickLine:null,subTickLine:null,position:"right",title:null},yAxis:{grid:null,label:{style:{fill:"#9c9c9cff",fontSize:11}},line:null,tickLine:null,subTickLine:null,position:"bottom",title:null},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#9e9e9eff",fontSize:12}}},maxBarWidth:8,supportCSSTransform:!0,animation:{appear:{animation:"scale-in-x",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_22=Object.freeze(Object.defineProperty({__proto__:null,default:AntdRangeBarDefinition},Symbol.toStringTag,{value:"Module"})),stackBarImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ8AAACqCAIAAAA8612AAAALlElEQVR4Xu3dfUzU9x3AcRDrdF02bedS5e7gDjge6gR8qJHalhaBAlLKxIoNihQrWqEi1lauBXk2VYklCipQqEEKrS3MZp1Z1izLtibNknZdky5Ln/fg1gezZuvWJU328PG+eIWftfl4Oe8Q36984u5+dz92vfu9fw9//cJsAHTCrAsAXAS1AFrUAmhRC6BFLYAWtQBa1AJoXXW1RDpdkbFxlrG+yWt+ckrEu59Yl04Odmec3RlvGeubvK6rqAz/6+cRvz8TfvaLOdt3WV/Gpbjqarm28XDYz9+3TGS00/q+yV1LvOe9xH3/s4z1TV5Sy8wf/lQe3JC2YsbLv7W+jEtBLdpa5icmTX/jfZlpH3z6raPHZcl39rRd2zs4/fV3wj/8fLan4cs1L79LrSXS5Zp5+hfXl5TJknmpiyPe+eiaV98K/8u/zNFmxi9/882hU2Gf/te6MiaiFm0ts07+eG7BavM4/Mw/5y1ZKrXMPHVutx0ZExvxzse+dwbBJdUy7Y9/v+blN+S/5Tv1rbIk4u0Pb1i23Lw67Q+fRrrjZ/zqdfMSvh61aGu55rW3IuMTzOMZP/v13B+skVpmexrNEtkife8MgkuqxZyJiWl//kekKyb8o3/7Xp3+2tvzFi+RY8v3snN9C3Ex1KKtZdboT3zHlmlnPpv//YVXXC3hZz6zORwR73785bHl3U8iY2LO1ZKV8+U6uAhq+bpawv72HwlD5hsvvSLXLRG/+9P0Nz6Qs5dvN++zea9brohaws9+If8JcnE1p2qnzXvdMu29s3LdIguvLy23ea9bqEXjqqtlbmb+nNJKy8ge1/q+yS36jm2unFrLWN+EQLvqagH8Ri2AFrUAWtQCaFELoEUtgBa1AFrUAmhRC6BFLYAWtQBa1AJoUQugRS2AFrUAWtQCaFELoEUtgBa1AFrUAmhRC6BFLYAWtQBa1AJoUQugRS2AFrUAWmO1FBUVJSYmyoPY2Ni9e/c2NDT4lh88eDA9Pd23QnV1te+xxXVrNjJmvlu8zXkHMzZ29yLrtnJlCnM6ncPDw319fQsXLpTnPT09EkxSUtIjjzySkZFh2uju7na5XHl5eQMDA729vZY/4RNx6tXw028yMjMHXklo+Ywx40jOsG4rV6axY0tbW5uppbOzU/6Nioo6duxYRUVFWlqaPC0rK8vKyjLvlHLGVr0AtfiGWsbPlK2lubnZ4/Hs27dPjiFut3toaEia6e/vz8kZu78HtWiGWsbPlK3FkPOuxsax+/iI+vr6hISxm8hRi2aoZfxM2Vrksl4OI3Jln5KSEhMTU1hYWFpa2tTU5FuBWjRDLeNnqtUSHR1tt9vNA4nEcf5eWS4v37uF0/kVN50zqMU31DJ+plotAXF90QbGzNw1W5x3bGXM2N2p1m3lyhTIWoCpjVoALWoBtKgF0KIWQItaAC1qAbSoBdCiFkCLWgAtagG0qAXQohZAi1oALWoBtKgF0KIWQItaAC1qAbSoBdCiFkCLWgAtagG0qAXQohZAi1oALWoBtKgF0KIWQItaAC1qAbSoBdCiFkCLWgAtagG0ztUSGxvb0tJi7mm8cuXKI0eOPPnkk8nJyfK0sbGxs7OzurpaHt99991dXV09PT2pqV99G8HZZVWzN9Uwl3XmF+5wrWpgLus4c+usG7dXWExMTHt7+4EDB0wt3d3dDodD+mltbS0uLpZCZGFDQ8OCBQsSEhLkcUpKSnNzs+WvGNzTOAgzr/6lC28azAR4Gs9aN26vsTOxtrY2U4scOux2e3R0dF9fX3l5eV5eniysqqrKz88378zIyNi0adP51SegliAMtQRjlLWsXbtWgjl06JCcdEVFRclpWEdHR1NTk0QirxYUFMhxRpaP/xM+1BKEoZZgjLIWIy4urqamxvf0iSeekNMzOdRkZ2f7Fl6IWoIw1BKMUdbi8Xh2797d29srBxC32y1HFUll3bp18pIs3OVlLvovRC1BGGoJxnx9LQFBLUEYagnGBKGWSFcMc7nHFi0Ty1z2+SqBrAWY2qgF0KIWQItaAC1qAbSoBdCiFkCLWgAtagG0qAXQohZAi1oALWoBtKgF0KIWQItaAC1qAbSoBdCiFkCLWgAtagG0qAXQohZAi1oALWoBtKgF0KIWQItaAC1qAbSoBdCiFkCLWgAtagG0qAXQohZA61wtdru9oqLC3NM4MTFxcHCwr6/P4XDIU1k+MjJy1113yeN77713dHT08OHD0dHRE//ImFn7+mftZy555taPxG3+EePH2N0p1q3wcgpzuVy9vb1dXV2mlu7ubqfTmZCQUFdXl5eXV15eLgsPHjzodrvNCpmZmaWlpeP/hA/3NPZv5nS/ab2nLqObYNdi/qetrc3UcvToUfk3Kiqqp6dHDiy33XabPL3//vtzc3PNO6WiZcuWja09EbX4N9Ti94S4loceeqi9vV2akYOMnHENDw8/+uij8jQ7O1uOOevWrZOjUEZGxoS/cR61+DfU4veEuBYjNjbW4/H4nra2tsoS81hOyTo6OnwvjUct/g21+D0hrqWysnL9+vUnTpyI83rggQcee+yxmpoaeam2tlYu9Ds7O1euXDn+T/hQi39DLX5PaGoJCGrxb6jF77mCa5mXvJjxY+anLHckLmP8GFv02AVCcASyFmBqoxZAi1oALWoBtKgF0KIWQItaAC1qAbSoBdCiFkCLWgAtagG0qAXQohZAi1oALWoBtKgF0ApkLSUlJRuBK9+GDRusG7dXIGsBpjZqAbSoBdCiFkCLWgAtagG0qAXQCkwtycnJx48f37NnT319vfW1SWPRokVdXV21tbVPPfWUPN25c2dzc3N3d/fy5cujoqKGh4crKiqefvppu91uXTOkHA7HyZMnU1NT5cHAwMDmzZufffZZ+cApKSm9vb0tLS27du2yrhNSWVlZsjFs3br19ttvly9TPvz27dvNd15XVycbSX9/v2ww1tVCSj7ktm3bTp06JR84Jyfn2LFjjz/++Pr1623ee7Rs2bJF3uB2uwNTS09Pj7lhmPz/WV+bfF544QXZ8szvl5CQcOTIkezs7HvuucfmvVON/MbWFUKqurpaqpZapOr77rtPlqxZs2bVqlUStvnOn3/+ees6oSMZd3Z2+vY48uFvvfVWm/eGWbK3Mt95UlKSvGf8WiHX1tZm/pUPeeLECbNwZGRk8eLFZmckuwCJJzC1jI6Omgey24iLi5v44uSydOlSyWPBggX79+83S4aGhqqqqlasWCGPc3NzZVsc//7QyszMfPDBBysrK6WWkpKSO++8UxbefPPNks3p06fNe2QT9N0vJORk7yMHwKamJtnm0tPT5ehn7ionu2fZH+3du9e8TQ6PE1YLNTnjkGOI+XiyPZiF8iElkrVr19q8m83u3bsDU8tzzz1nHsgv53Q6J744ieTn55u9iPyo7e3tNu89N+XXlUOKuQua7LMLCgosa4WK7IPlRFE6efjhhyWbwsJCc4e2W265Rcp58cUXzdvkO7/YnUCD78YbbzS7IXlw4MABOYaYWiT4vLw8Ob2xeb/zwcFBy4ohJMcT2V3azt8DTw7aZrnUIicaxcXF8vimm26qqakJTC3yLcgxS05v5OBlfW3SkFMCuTIxj+UHk3NreZCWliYXMHKSIz+nPJXLgMlzSi1HjHQvOd2XVORCRXaBNu/92+THO3TokCyR73xSbXnSrRQun0p2xvI5i4qKzL5Zdkkul8tsiPJfJBcJ1jVDR3aR5hR39erVshuSi5ZYL7m+8MW/ceNGKScwtcjZqpyDPfPMM/Hx8dbXJg0pQc4YR7zkW5B9tjzt6OiQn1bikWbkAmBSnYb5mDMx2/lbTJeVldm826UcVYaHh3030J0k5JxWronlizVHPDm9kS9W9kfyeMmSJfKdy1Hd3DF78vB4PPLFtra2ygeTTmRLlp2puaaQ2uWlHTt2yEYSmFqAqwG1AFr/B72o7yOp7VkjAAAAAElFTkSuQmCC";class AntdStackBarDefinition extends AbstractBarDefinition{getBaseInfo(){return{compName:"Antd堆叠条形图",compKey:"AntdStackBar",categorize:"chart",subCategorize:"bar"}}getChartImg(){return stackBarImg}getInitConfig(){const r=[{year:"1991",value:300,type:"Lon"},{year:"1992",value:400,type:"Lon"},{year:"1993",value:350,type:"Lon"},{year:"1991",value:300,type:"Bor"},{year:"1992",value:400,type:"Bor"},{year:"1993",value:350,type:"Bor"}];return{base:{id:"",name:"Antd堆叠条形图",type:"AntdStackBar"},style:{data:r,xField:"value",yField:"year",seriesField:"type",isStack:!0,maxBarWidth:8,supportCSSTransform:!0,color:["#00c0df","#298aff"],barStyle:{radius:0},xAxis:{grid:null,label:{style:{fill:"#b9b9b9ff",fontSize:10}},line:{style:{stroke:"#b9b9b980",lineWidth:1}},tickLine:null,subTickLine:null,position:"right",title:null},yAxis:{grid:null,label:{style:{fill:"#b3b3b3ff",fontSize:10}},line:null,tickLine:null,subTickLine:null,position:"bottom",title:null},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#00f0ffff",fontSize:12}}},animation:{appear:{animation:"scale-in-x",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_23=Object.freeze(Object.defineProperty({__proto__:null,default:AntdStackBarDefinition},Symbol.toStringTag,{value:"Module"})),baseColumnImg="/light-chaser-app/assets/base-column-wb9fa2bU.png";class AntdBaseColumnDefinition extends AbstractColumnDefinition{getBaseInfo(){return{compName:"Antd基础柱状图",compKey:"AntdBaseColumn",categorize:"chart",subCategorize:"column"}}getChartImg(){return baseColumnImg}getInitConfig(){const r=[{name:"1951 年",value:48},{name:"1952 年",value:52},{name:"1956 年",value:22}];return{base:{id:"",name:"基础条形图",type:"AntdBaseBar"},style:{data:r,xField:"name",yField:"value",seriesField:"name",maxColumnWidth:8,supportCSSTransform:!0,color:["#00dbffff"],columnStyle:{fill:void 0,radius:0},xAxis:{grid:null,label:{style:{fill:"#afafafff",fontSize:10}},line:null,tickLine:null,subTickLine:null,position:"left",title:null},yAxis:{grid:null,label:{style:{fill:"#a8a8a8ff",fontSize:10}},line:{style:{stroke:"#9898987a",lineWidth:1}},tickLine:null,subTickLine:null,position:"bottom",title:null},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#a6a6a6ff",fontSize:10}}},animation:{appear:{animation:"scale-in-y",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_24=Object.freeze(Object.defineProperty({__proto__:null,default:AntdBaseColumnDefinition},Symbol.toStringTag,{value:"Module"})),groupColumnImg="/light-chaser-app/assets/group-column-PnUC7N0s.png";class AntdGroupColumnDefinition extends AbstractColumnDefinition{getBaseInfo(){return{compName:"Antd分组柱状图",compKey:"AntdGroupColumn",categorize:"chart",subCategorize:"column"}}getChartImg(){return groupColumnImg}getInitConfig(){const r=[{label:"Mon.",type:"series1",value:2800},{label:"Mon.",type:"series2",value:2260},{label:"Tues.",type:"series1",value:1800},{label:"Tues.",type:"series2",value:1300},{label:"Wed.",type:"series1",value:950},{label:"Wed.",type:"series2",value:900}];return{base:{id:"",name:"Antd分组柱状图",type:"AntdGroupColumn"},style:{data:r,isGroup:!0,xField:"label",yField:"value",seriesField:"type",maxColumnWidth:8,supportCSSTransform:!0,color:["#00c0df","#298aff"],columnStyle:{radius:0},xAxis:{grid:null,label:{style:{fill:"#949494ff",fontSize:10}},line:null,tickLine:null,subTickLine:null,position:"left",title:null},yAxis:{grid:null,label:{style:{fill:"#b1b1b1ff",fontSize:10}},line:{style:{stroke:"#b3b3b37d",lineWidth:1}},tickLine:null,subTickLine:null,position:"bottom",title:null},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#a8a8a8ff",fontSize:10}}},animation:{appear:{animation:"scale-in-y",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_25=Object.freeze(Object.defineProperty({__proto__:null,default:AntdGroupColumnDefinition},Symbol.toStringTag,{value:"Module"})),percentColumnImg="/light-chaser-app/assets/percent-column-gPdW4L9g.png";class AntdPercentColumnDefinition extends AbstractColumnDefinition{getBaseInfo(){return{compName:"Antd百分比柱状图",compKey:"AntdPercentColumn",categorize:"chart",subCategorize:"column"}}getChartImg(){return percentColumnImg}getInitConfig(){const r=[{country:"Asia",year:"1750",value:502},{country:"Asia",year:"1800",value:635},{country:"Asia",year:"1850",value:809},{country:"Africa",year:"1750",value:106},{country:"Africa",year:"1800",value:107},{country:"Africa",year:"1850",value:111},{country:"Europe",year:"1750",value:163},{country:"Europe",year:"1800",value:203},{country:"Europe",year:"1850",value:276}];return{base:{id:"",name:"Antd百分比柱状图",type:"AntdPercentColumn"},style:{data:r,xField:"year",yField:"value",seriesField:"country",isPercent:!0,isStack:!0,maxColumnWidth:8,supportCSSTransform:!0,color:["#59bfff","#298aff","#004294"],columnStyle:{radius:0},xAxis:{grid:null,label:{style:{fill:"#a2a2a2ff",fontSize:10}},line:null,tickLine:null,subTickLine:null,position:"left",title:null},yAxis:{grid:null,label:{style:{fill:"#b3b3b3ff",fontSize:10}},line:{style:{stroke:"#92929278",lineWidth:1}},tickLine:null,subTickLine:null,position:"bottom",title:null},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#00f0ffff",fontSize:12}}},animation:{appear:{animation:"scale-in-y",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_26=Object.freeze(Object.defineProperty({__proto__:null,default:AntdPercentColumnDefinition},Symbol.toStringTag,{value:"Module"})),rangeColumnImg="/light-chaser-app/assets/range-column-VnDciZC_.png";class AntdRangeColumnDefinition extends AbstractColumnDefinition{getBaseInfo(){return{compName:"Antd区间柱状图",compKey:"AntdRangeColumn",categorize:"chart",subCategorize:"column"}}getChartImg(){return rangeColumnImg}getInitConfig(){const r=[{type:"sort1",values:[76,100]},{type:"sort2",values:[56,108]},{type:"sort3",values:[38,129]},{type:"sort4",values:[38,129]}];return{base:{id:"",name:"Antd区间柱状图",type:"AntdRangeColumn"},style:{data:r,xField:"type",yField:"values",seriesField:"type",isRange:!0,maxColumnWidth:8,supportCSSTransform:!0,color:["#00dbffff"],columnStyle:{radius:0},xAxis:{grid:null,label:{style:{fill:"#a6a6a6ff",fontSize:11}},line:null,tickLine:null,subTickLine:null,position:"left",title:null},yAxis:{grid:null,label:{style:{fill:"#d0d0d0ff",fontSize:11}},line:{style:{stroke:"#9e9e9e91",lineWidth:1}},tickLine:null,subTickLine:null,position:"bottom",title:null},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#969696ff",fontSize:12}}},animation:{appear:{animation:"scale-in-y",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_27=Object.freeze(Object.defineProperty({__proto__:null,default:AntdRangeColumnDefinition},Symbol.toStringTag,{value:"Module"})),stackColumnImg="/light-chaser-app/assets/stack-column-vyea8mUD.png";class AntdStackColumnDefinition extends AbstractColumnDefinition{getBaseInfo(){return{compName:"Antd堆叠柱状图",compKey:"AntdStackColumn",categorize:"chart",subCategorize:"column"}}getChartImg(){return stackColumnImg}getInitConfig(){const r=[{year:"1991",value:3,type:"Lon"},{year:"1992",value:4,type:"Lon"},{year:"1993",value:3.5,type:"Lon"},{year:"1991",value:3,type:"Bor"},{year:"1992",value:4,type:"Bor"},{year:"1993",value:3.5,type:"Bor"}];return{base:{id:"",name:"Antd堆叠柱状图",type:"AntdStackColumn"},style:{data:r,xField:"year",yField:"value",seriesField:"type",isStack:!0,maxColumnWidth:8,supportCSSTransform:!0,color:["#00c0df","#298aff"],columnStyle:{},xAxis:{grid:null,label:{style:{fill:"#c7c7c7ff",fontSize:10}},line:null,tickLine:null,subTickLine:null,position:"left",title:null},yAxis:{grid:null,label:{style:{fill:"#b7b7b7ff"}},line:{style:{stroke:"#9e9e9e75",lineWidth:1}},tickLine:null,subTickLine:null,position:"bottom",title:null},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#aaaaaaff",fontSize:12}}},animation:{appear:{animation:"scale-in-y",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_28=Object.freeze(Object.defineProperty({__proto__:null,default:AntdStackColumnDefinition},Symbol.toStringTag,{value:"Module"}));class G2PlotCustomController extends AntdBaseDesignerController{async create(container,config){var a,r;this.container=container,this.config=config;const customCode=(a=config.style)==null?void 0:a.customCode;if(!customCode||customCode==="")return;const func=eval(`(${customCode})`);typeof func=="function"&&(this.instance=func(container,G2Plot,(r=config.data)==null?void 0:r.staticData))}destroy(){this.instance.destroy(),this.instance=null,this.config=null,this.interval&&clearInterval(this.interval)}getConfig(){return this.config}changeData(a){var r;(r=this.instance)==null||r.changeData(a)}update(config,upOp){var a,r,e,n,o;if(this.config=ObjectUtil.merge(this.config,config),upOp=upOp||{reRender:!0},upOp.reRender){try{(a=this.instance)==null||a.destroy()}catch(s){for(;(r=this.container)!=null&&r.firstChild;)this.container.removeChild(this.container.firstChild)}const customCode=(e=config.style)==null?void 0:e.customCode;if(!customCode||customCode==="")return;const func=eval(`(${customCode})`);if(typeof func!="function")return;this.instance=func(this.container,G2Plot,(o=(n=this.config)==null?void 0:n.data)==null?void 0:o.staticData)}}}const __vite_glob_0_29=Object.freeze(Object.defineProperty({__proto__:null,default:G2PlotCustomController},Symbol.toStringTag,{value:"Module"})),pieImg$1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN8AAACMCAIAAABzgesiAAANq0lEQVR4Xu2bv08i6xrHzx+yIAoGfwQ3E6NeWF3c1avEn2RDFlxZNjHRghgazLWYgsRQYEGBhYkUhtiQ3MbiJnZ0NDeho6SjpKOjO3feGWbmfWcGxCOc85zc7ydPhTPDMO/3fX6Ov30AgCq/WT8AgAxQJ6AL1AnoAnUCukCdgC5QJ6AL1AnoAnUCukCdgC5QJ6AL1AnoAnUCukCdgC5QJ6AL1AnoAnUCukCdgC5QJ6AL1AnoAnUCukCdgC5QJ6AL1AnoAnUCukCdgC5QJ6AL1AnoAnUCukCdgC5QJ6AL1AnoAnUCukCdgC5QJ6AL1AnoAnUCukCdgC5QJ6AL1AnoAnUCukCdgC5QJ6AL1AnoAnUCukCdgC5QJ6AL1AnoAnUCukCdgC5QJ6AL1AnoAnUCukCdgC5QJ6AL1AnoAnUCuvw16vR5nwsnvz/9YvYYqYXdXusRbyMoLdYLB53SYad00JY/yh7rAW8iKPmfM6HG9afGdaieXrzyWQ8AfxJ/iToj4eX2oyrNp1+9gvROMTF8vpfi6bjk7p3z10up/tWeDuq77gXrIX9H3Jdb8w/RRdX8csD1nkf0J/FXqNN9k97T1/57KzmzaT1gGPFwoCZvt4uapzQs2tXlzqwcFf960Cl8baQDN3PWq0mB+Vp+r1M6YocV1qurLvVj923mUL/az07GHzfPmLrNGn/61ZUXz80/WXBf7QZeFB8sf2kVIuptHImmfOOG9o2b0vxLdqOZ22zlt9vKwcW9TnG7eR2snS3eSta94fX5nnMR29X0a5b22oWvTTn4Ep055s8Stly0sT/1N9hyf4I6vb6Zh8y2oJ7hVj5sZZzjaSQstUa/jt2Ka3cWgXqmK7mYfsBpOz2rrejx7lrHOKsUNM6SpMVm2big4lYd19h9FVtrlX5Yv91u5a+aOlOxz137X/t20smtPEimq5OkAHcPQyzVzUnGhhTOeoy8hLR9+AdwXcWW6yzt+dTIrr3sT7/JubyNyatT8ZQR24N71RKtM7tPdV2d7diOfJMd2cN0KrphKqO0dqsup9c3WysmubM0FSo3sN0zDi4sy/Yt5PHcZSLmMcPt/pOq+xF+Vyn0EOh/A58XvWq93McrNXESzipvViTzlt+GZ7qaj+vX/9E+89qWaXxMXJ2sABrBi9isK8+nrNeaerj+ph/wrS2r2/d122jd6ympqk5LvrUwN1+/t4c8flOlutn5OJOsn5NsrJmYDoqXYnE/PbI0FStq+nbfZo+sf7LaSfvCF1G/I77/abCjtRv7RZLlrFLw1r6vRoRP8ZWHEPPYHsL4mLQ6vXPzjfv+Q+nlApdDC6DNkBG4FUHw2Z6KZ8as9O83DF/yCvxef9x5dohoSpZ5YCxnL7ek3aTgbBQnF3BdJjbtXpbH5tWirexyNea/WZ2yOJjgnOcqPHsT8qifu2UlVmZWXs6WKlH/TWg65XOnQv5KepNPh5TyUfWCrsvkV3MDKLch6MwVX519uNjomCdqT1I86x2V6ELAXNDfnw7rW9bdPk4mrc6gtDRMcCLHu0F9+R1ChprX/+w/l+LKzYi7n+113eGVnTXN7QrF9mpbavT3zFRlrfg47BTDz/uL5rc/fWvGnBwnVzApO6G2y5zWO+DLR0OIwoe9fD9wi3geZCPIMKdwbjlLXhTjEivgntPBRk4pN9UisrjTyoUbmaVbvbRP7Ur1rBqL5B3Oc39v59b1GBWsJbx8HTYGJq3OyNaKXl787MpSpd/RcLaqmbEpy++xLq1nSo4uN82N+1b70U77bdmCxtTdddQ40snHi9lzYdm+N4TNo3zXhe/dS6U4PC7N7W9IQXnda3v+84HdrRANFs+Fs1gXQr831/n+SuveSFds9hip7Suxe+ouaz6fQablP+Nk0uoUao432EHNKWSwsDJSuepow9ooovuMNqJCOnW8tcKF7CMtk7OgXME85l1FsYG4Z7TuFZ/ePJ0ayagIr0U1ZClxIJ/QP0noXTzXeTRktiYGWXn7eWPm3/nv1s+tpmxIr9PNvIMJq1Mscke3x2299SgQXP34jo5S5CXscE2dqTvO37Aukp4DLMwpxZBR2KW68qLNszJSsc/mL+0X4+9B8Wpr3Jb43kqw3o3ioWumh2Yf2hIMMZlRc6QdH3/Wt0aU7S5JyCCHWKr7r6X/mpXQIJtAhTRhdSohxkjFTnv39u4xb1FuddcdV3fBN32zbww8OItJDePpKwlfwnZAdP5h33fupCoDdbWMJfzZvVZV6JupyFxQu19/sLtNhku+EEK/XnYotdR626EVr9he86LfXrUQDMxWs3x6x8K6VoRJAb7h6tAg+6B5evPcaH136rNw1l4trGSTLvlsh3McsXZWugt7lPuRlIccW26WODmW/vGfA+2xB17yRntYyXpXquYT9l85Ldm7mLA6PRVZ/zGvVdlCi7HokNjpuOWzsLreh51C8EFi7lDI+f54u8R1LnTFE+30YvWac6hKicqSMEecorD6+eBukUNcjqzO13KH1mhz/1mJJFqesxni2gK2FkRE8t2dhdplo0HWHyUIZ5W/VJWHxvyrERCSnaw1fz2PhR2chcfDDy86tvsfM5NVp4drdr5WZS9w+1stMwfAJ16KEDWPwo9wShvPMbvvHG1ne6YfOJGJdqIUVQOzfqFHzQ0/2SxqUMYmxmXlqzO8M+tfqptf4wdFXFtjFIu3zlguGN8NmWfdhxSpiUOvQ3sbWJiWGZ7F5+WanQPyijEyUXUKs91ypGntk4tmtip+Duk98aFNrUYZQkXibHsjvhqiZplG2WGYkm7aC3kOoUd90jYGXcLnFjPjstfnq+Zsu6K0+bI/LTonJU/4YlPwIEt25Y9qt188Sx1xRcJGL8V5dBSPrgvNXdWzeMXJxYBB7viYqDpHnghbzKHZaZAyZx6mCISN7mjlryycjYatqf6rV+infYNg+9BcNqXssLXDVIQrG3HZ562a4VL9utKXWmI25bAZxOx2iD0eNM9m9R0unKVt6fg+Lz57LiSUs728Ngj4EJQCZlU6nr7EUCaqTrYY9gf3un1rDlhdNb0zeiVm12noWxSqqeFsFCKri/Wi0Xwxb6l1MdCdf7C2uvrDQzvxfS7Clj+r4dItX/AB/aSTde4JqAjZ7e+P37pmjaW+nZQPNzLL1eisWP/xZ2lZh9hJ7U+heIThqtFVVTyuuaBOHnfMTFSdwmyXvdVmr1tN6z4avodNaxyjsDhGYy+wqQvJ3qLQn3X8jydDnqmb5Do3A7TYaec64PDah4roO7nILuAwhFTyP+4X/ehkrNWJAMtujZ2T7OhvVL2CcJZ2b6I3zfeHtybC2xHmzxE9rmWIOgEmqU5+MZx7HxzcNGJAs1O9oCXrirWSStbPj0aGtdyHkNr62CgaZY1mqR7f5FJNCfF3jhmCUi7wL7sUg5VV+++1DyGVjFDU61AHz9oaJaORmWglR9qH4llaXHJdXXBvRXGvCGqk9oNcpmS8zW3ZXf2SdIJMUp3cYth6H1bY/tZr2wGt7AVhVGhYrJVerJqjkb2hLXcH2Ju/8oGt1FAu6z/3uOVk2JozPO41kj5blBdeJVEt2StuszhrNBBiS7WCuQHUcMl13Fi6+dVaKWqWXamEmdb5tsbo+1A8q58OCQ2jp9NubkW7z0pCqgmTdP5FQXEvKUlIfsO4w6p6h2Nmkurk5mmPkbpDh5yzmGR2wvvvlVkQJt29e3PWLBiTju3ifZt/2J3hVXUcmn+5FldCs/K2OlzWcF1Gg7aGQKonNno+ONVSQ+20k/YdCW+RDrG+EMXWxPDRl4kwpNXjkji5HWLCUHdw9TnqVnkbE1SnMBF+gxl9Ip74LjfpLocrqzMVoU8+khmvdxyHl+oFWweHWbKbW74NWFf9OCw1zTGSblYn6r5Kvlacmcaahf8UvNoQ6wcEQRwjFyVi59IYwnnurgeNCQw7aWeE92a8Pt9LwV4yTqx+n5w6xYnw6Gb5Px6G2oM0uob9DjN7Cz29PbIafrFgrRdMygVfCrYmuUN/0WRhzleVbfvhcae2JZTn8XCgnj+y5Ql2Y83CA36EM8S06Y4lHDu0gZwRzuJmIl7fTMUyL+WttF2PObwRJ83NPst71h848lZ5G5NTpzgRHt0cCt5Nyf+c3Wzfs13by0t83O//qST0C51NX2MNXqBKwld37i9aUKL8WkufE/ZY6eP8n40LnqnLsP8hIb1kguxfcLLBWnr5ORmoROdvt3xX0tSx+l3qP7tp/5o8zIz/Wo5vfaxpL1leh+pn/hFumMGfVUsYTdA+m4HZytlK/93NbLCelqpRvyy5h4vN65mS9wPP6bX+S9P7XlsiPg4mp85JEAlMX86NLYIwN5BZe94d6C8dYU40u9kc8H95YJz8vdQJ/r+AOgFdoE5AF6gT0AXqBHSBOgFdoE5AF6gT0AXqBHSBOgFdoE5AF6gT0AXqBHSBOgFdoE5AF6gT0AXqBHSBOgFdoE5AF6gT0AXqBHSBOgFdoE5AF6gT0AXqBHSBOgFdoE5AF6gT0AXqBHSBOgFdoE5AF6gT0AXqBHSBOgFdoE5AF6gT0AXqBHSBOgFdoE5AF6gT0AXqBHSBOgFdoE5AF6gT0AXqBHSBOgFdoE5AF6gT0AXqBHSBOgFdoE5AF6gT0AXqBHSBOgFdoE5AF6gT0AXqBHSBOgFd/gfTas4w/JP/oQAAAABJRU5ErkJggg==",G2PlotCustomConfig=React.lazy(()=>__vitePreload(()=>import("./G2PlotCustomConfig-9wv-7wkT.js"),__vite__mapDeps([60,1,2,5,6,7,8,9,10,11,12,13,14,15,16]))),BaseInfo$g=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),DataConfig$6=React.lazy(()=>__vitePreload(()=>import("./DataConfig-11-GlHR8.js"),__vite__mapDeps([50,1,2,6,7,8,9,10,11,12,14,5,13,15,16,51])));class G2PlotCustomDefinition extends AntdCommonDefinition{getController(){return G2PlotCustomController}getMenuList(){return[{icon:SettingOne,name:"基础",key:"base"},{icon:Optimize,name:"自定义",key:"custom"},{icon:Data,name:"数据",key:"data"}]}getMenuToConfigContentMap(){return{base:BaseInfo$g,data:DataConfig$6,custom:G2PlotCustomConfig}}getBaseInfo(){return{compName:"G2Plot自定义图表",compKey:"G2PlotCustom",categorize:"other"}}getChartImg(){return pieImg$1}getInitConfig(){return{base:{id:"",name:"G2Plot自定义图表",type:"G2PlotCustom"},style:{customCode:`function renderG2Plot(container, G2Plot, data) {
    const g2plot = new G2Plot.BidirectionalBar(container, {
        data: data,
        layout: 'vertical',
        xField: 'country',
        yField: ['2016年耕地总面积', '2016年转基因种植面积'],
        legend: false,
        appendPadding: [20, 0],
        barStyle: {
            lineWidth: 4
        },
        yAxis: {
            '2016年耕地总面积': {
                grid: null,
                label: {
                    style: {
                        fill: "#fff",
                        fontSize: 10,
                    },
                },

            },
            '2016年转基因种植面积': {
                grid: null,
                label: {
                    style: {
                        fill: "#fff",
                        fontSize: 10,
                    },
                },
            },
        },
        xAxis: {
            grid: null,
            label: {
                style: {
                    fill: "#fff",
                    fontSize: 10,
                },
            },
            line: {
                style: {
                    stroke: "#6f6f6f91",
                    lineWidth: 1,
                },
            },
            tickLine: null,
            subTickLine: null,
            title: null,
        },
        label: {
            position: 'top',
            style: {
                fill: '#fff'
            }
        },
    });
    g2plot.render();
    return g2plot;
}`},data:{sourceType:"static",staticData:[{country:"乌拉圭","2016年耕地总面积":13.4,"2016年转基因种植面积":12.3},{country:"巴拉圭","2016年耕地总面积":14.4,"2016年转基因种植面积":6.3},{country:"南非","2016年耕地总面积":18.4,"2016年转基因种植面积":8.3},{country:"巴基斯坦","2016年耕地总面积":34.4,"2016年转基因种植面积":13.8},{country:"阿根廷","2016年耕地总面积":44.4,"2016年转基因种植面积":19.5},{country:"巴西","2016年耕地总面积":24.4,"2016年转基因种植面积":18.8},{country:"加拿大","2016年耕地总面积":54.4,"2016年转基因种植面积":24.7},{country:"中国","2016年耕地总面积":104.4,"2016年转基因种植面积":5.3},{country:"美国","2016年耕地总面积":165.2,"2016年转基因种植面积":72.9}]}}}}const __vite_glob_0_30=Object.freeze(Object.defineProperty({__proto__:null,default:G2PlotCustomDefinition},Symbol.toStringTag,{value:"Module"}));class AntdGaugeController extends AntdBaseDesignerController{async create(r,e){super.commonCreate(r,Gauge,e)}destroy(){this.instance.destroy(),this.instance=null,this.config=null,this.interval&&clearInterval(this.interval)}getConfig(){return this.config}changeData(r){var e;this.config.data.staticData=r,this.config.style.percent=r,(e=this.instance)==null||e.changeData(r)}update(r,e){super.commonUpdate(r,Gauge,e)}updateTheme(r){}}const __vite_glob_0_31=Object.freeze(Object.defineProperty({__proto__:null,default:AntdGaugeController},Symbol.toStringTag,{value:"Module"})),gaugeImg="/light-chaser-app/assets/gauge-2HjQIWKp.png",AnimationConfig$9=reactExports.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),ThemeConfig$8=reactExports.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),BaseInfo$f=reactExports.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),DataConfig$5=reactExports.lazy(()=>__vitePreload(()=>import("./DataConfig-11-GlHR8.js"),__vite__mapDeps([50,1,2,6,7,8,9,10,11,12,14,5,13,15,16,51]))),FilterConfig$a=reactExports.lazy(()=>__vitePreload(()=>import("./FilterConfig-NGULEsf_.js"),__vite__mapDeps([52,1,2,6,7,8,9,10,11,12,5,13,14,15,16,53])));class AbstractDesignerDefinition extends AbstractDefinition{getMenuList(){return[{icon:SettingOne,name:"基础",key:"base"},{icon:Optimize,name:"样式",key:"style"},{icon:Data,name:"数据",key:"data"},{icon:ColorFilter,name:"滤镜",key:"filter"},{icon:Theme$1,name:"主题",key:"theme"}]}getMenuToConfigContentMap(){return{base:BaseInfo$f,data:DataConfig$5,animation:AnimationConfig$9,theme:ThemeConfig$8,filter:FilterConfig$a}}}const AntdGaugeConfig=React.lazy(()=>__vitePreload(()=>import("./AntdGaugeConfig-z_m7t2CT.js"),__vite__mapDeps([61,1,2,5,6,7,8,9,10,11,12,13,14,15,16])));class AntdGaugeDefinition extends AbstractDesignerDefinition{getController(){return AntdGaugeController}getMenuToConfigContentMap(){const r=super.getMenuToConfigContentMap();return r.style=AntdGaugeConfig,r}getBaseInfo(){return{compName:"Antd仪表盘",compKey:"AntdGauge",categorize:"chart",subCategorize:"progress"}}getChartImg(){return gaugeImg}getInitConfig(){return{base:{id:"",name:"Antd仪表盘",type:"AntdGauge"},style:{percent:.75,radius:.75,innerRadius:.95,startAngle:-7/6*Math.PI,endAngle:1/6*Math.PI,range:{color:["#6bc2ff","#5d9eff59"]},indicator:{pointer:{style:{stroke:"#37b3ff",lineWidth:2}},pin:{style:{stroke:"#37b3ff",fill:"#053b5d",r:2,lineWidth:2}}},axis:{tickLine:{style:{stroke:"#89d2ff",lineWidth:1},length:-4},subTickLine:{count:11,style:{stroke:"#2caaff",lineWidth:1},length:-2},label:{style:{fill:"#69c6ff",fontSize:12,textAlign:"center",textBaseline:"middle"}}},statistic:{content:{style:{color:"#49c1ff",fontSize:"11px"}}},animation:{appear:{animation:"grow-in-x",duration:3e3},update:{animation:"grow-in-x",duration:3e3}}},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0},data:{sourceType:"static",staticData:.75}}}}const __vite_glob_0_32=Object.freeze(Object.defineProperty({__proto__:null,default:AntdGaugeDefinition},Symbol.toStringTag,{value:"Module"})),baseLineImg="/light-chaser-app/assets/base-line-OYaftkGE.png";class AntdBaseLineDefinition extends AbstractLineDefinition{getBaseInfo(){return{compName:"Antd基础折线图",compKey:"AntdBaseLine",categorize:"chart",subCategorize:"line"}}getChartImg(){return baseLineImg}getInitConfig(){const r=[{name:"1990",value:525},{name:"1991",value:459},{name:"1992",value:357},{name:"1993",value:414},{name:"1994",value:234},{name:"1995",value:250},{name:"1996",value:156}];return{base:{id:"",name:"基础折线图",type:"AntdBaseLine"},style:{data:r,xField:"name",yField:"value",smooth:!1,supportCSSTransform:!0,color:"#00d7ff",point:{size:4,color:"#00d7ff",shape:"circle",style:{lineWidth:0,stroke:"#00d7ff"}},lineStyle:{lineWidth:2},xAxis:{grid:null,label:{style:{fill:"#969696ff",fontSize:10}},line:null,tickLine:null,subTickLine:null,position:"bottom",title:null},yAxis:{grid:null,label:{style:{fill:"#b1b1b1ff",fontSize:9}},line:{style:{stroke:"#9e9e9e7d",lineWidth:1}},tickLine:null,subTickLine:null,position:"left",title:null},animation:{appear:{animation:"wave-in",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_33=Object.freeze(Object.defineProperty({__proto__:null,default:AntdBaseLineDefinition},Symbol.toStringTag,{value:"Module"})),multiLineImg="/light-chaser-app/assets/multi-line-sQL9gk6w.png";class LCGUIUtil{static updateSchema(r,e,n){const o=e.shift(),{key:s,index:l}=o;s&&s in r&&(e.length===0?r.value=n:l!==void 0?this.updateSchema(r[s][l],e,n):this.updateSchema(r[s],e,n))}static createObjectFromArray(r,e){const n={};let o=n;for(let s=0;s<r.length;s++){const l=r[s];o[l]=s===r.length-1?e:{},o=o[l]}return n}static schemaStructureAssignment(r,e){return typeof r!="object"?{}:(Object.keys(r).forEach(n=>{if(typeof r[n]!="object")e.key===n?e.value=r[n]:e.children&&e.children.forEach(o=>{LCGUIUtil.schemaStructureAssignment({[n]:r[n]},o)});else{const o=LCGUIUtil.findChildSchemaByKey(n,e);o&&LCGUIUtil.schemaStructureAssignment(r[n],o)}}),e)}static findChildSchemaByKey(r,e){if(e.key===r)return e;if(e.children)for(let n=0;n<e.children.length;n++){const o=this.findChildSchemaByKey(r,e.children[n]);if(o)return o}return{}}static parseSchemaData(r){const e={};if(r.children){let n={};return r.children.forEach(o=>{n={...n,...LCGUIUtil.parseSchemaData(o)}}),r.key?(e[r.key]=n,e):n}else return r.key&&(e[r.key]=r.value||void 0),e}}const Accordion$1=React.lazy(()=>__vitePreload(()=>import("./Accordion-Kjxp7g3P.js"),__vite__mapDeps([62,1,2,63,22,23,8,24,25,10,12,13,26,27,64,65,66]))),Button=React.lazy(()=>__vitePreload(()=>import("./Button-Tm3IfQtm.js"),__vite__mapDeps([44,1,2,45]))),MonacoEditor$2=React.lazy(()=>__vitePreload(()=>import("./MonacoEditor-AmRPsGTx.js").then(a=>a.a),__vite__mapDeps([67,1,2,68]))),ColorPicker=React.lazy(()=>__vitePreload(()=>import("./ColorPicker-pyjWXEAx.js"),__vite__mapDeps([21,1,2,22,23,8,24,25,10,12,13,26,27,28,9,29,30,31,32,33,34,11,35,36,37]))),ColorsPicker=React.lazy(()=>__vitePreload(()=>import("./ColorsPicker-Kr5YMVnt.js"),__vite__mapDeps([69,1,2,21,22,23,8,24,25,10,12,13,26,27,28,9,29,30,31,32,33,34,11,35,36,37,70]))),Grid=React.lazy(()=>__vitePreload(()=>import("./Grid-qWvRWUZo.js"),__vite__mapDeps([42,1,2,22,23,8,24,25,10,12,13,26,27,43])).then(({Grid:a})=>({default:a}))),Input=React.lazy(()=>__vitePreload(()=>import("./Input-Fu5_43az.js"),__vite__mapDeps([40,1,2,22,23,8,24,25,10,12,13,26,27,41]))),Radio$1=React.lazy(()=>__vitePreload(()=>import("./Radio-kbTZ0tv0.js"),__vite__mapDeps([71,1,2,22,23,8,24,25,10,12,13,26,27,72]))),Select=React.lazy(()=>__vitePreload(()=>import("./Select-wGR39UQA.js"),__vite__mapDeps([73,1,2,22,23,8,24,25,10,12,13,26,27,74]))),Switch=React.lazy(()=>__vitePreload(()=>import("./Switch-Xw0MHp-o.js"),__vite__mapDeps([63,1,2,22,23,8,24,25,10,12,13,26,27,64]))),Slider=React.lazy(()=>__vitePreload(()=>import("./Slider-EMpULmm8.js"),__vite__mapDeps([75,1,2,22,23,8,24,25,10,12,13,26,27,76])).then(({Slider:a})=>({default:a}))),RangeSlider=React.lazy(()=>__vitePreload(()=>import("./Slider-EMpULmm8.js"),__vite__mapDeps([75,1,2,22,23,8,24,25,10,12,13,26,27,76])).then(({RangeSlider:a})=>({default:a}))),ImageUpload=React.lazy(()=>__vitePreload(()=>import("./ImageUpload-HUfmpvv0.js"),__vite__mapDeps([77,1,2,22,23,8,24,25,10,12,13,26,27,16,6,7,9,11,14,78,31,36,79,80,33,29,34,81])).then(({ImageUpload:a})=>({default:a}))),ColorMode=React.lazy(()=>__vitePreload(()=>import("./ColorMode-EbPIiyM4.js"),__vite__mapDeps([82,1,2,21,22,23,8,24,25,10,12,13,26,27,28,9,29,30,31,32,33,34,11,35,36,37,73,74,69,70,83]))),TextOnly=React.lazy(()=>__vitePreload(()=>import("./TextOnly-OJHDw4sQ.js"),__vite__mapDeps([84,1,2,22,23,8,24,25,10,12,13,26,27])).then(({TextOnly:a})=>({default:a}))),TextArea=React.lazy(()=>__vitePreload(()=>import("./TextArea-xY6JAMVn.js"),__vite__mapDeps([85,1,2,22,23,8,24,25,10,12,13,26,27,86]))),GroupButton=React.lazy(()=>__vitePreload(()=>import("./GroupButton-XoXQi5qk.js"),__vite__mapDeps([87,1,2,22,23,8,24,25,10,12,13,26,27,88])).then(({GroupButton:a})=>({default:a}))),CardPanel=React.lazy(()=>__vitePreload(()=>import("./CardPanel-GnLi4EHp.js"),__vite__mapDeps([38,1,2,23,8,24,25,10,12,13,26,39])).then(({CardPanel:a})=>({default:a}))),NumberInput=React.lazy(()=>__vitePreload(()=>import("./NumberInput-WrPaUvHm.js"),__vite__mapDeps([89,1,2,22,23,8,24,25,10,12,13,26,27,90]))),ControlGroup=React.lazy(()=>__vitePreload(()=>import("./ControlGroup-7bzhDJ_v.js"),__vite__mapDeps([91,1,2,6,7,8,9,10,11,12,13,92,65,5,14,15,16,93]))),CheckBox=React.lazy(()=>__vitePreload(()=>import("./CheckBox-Ja7rXRna.js"),__vite__mapDeps([94,1,2,22,23,8,24,25,10,12,13,26,27,95]))),UIMap=new Map;UIMap.set("accordion",Accordion$1);UIMap.set("button",Button);UIMap.set("grid",Grid);UIMap.set("input",Input);UIMap.set("radio",Radio$1);UIMap.set("select",Select);UIMap.set("switch",Switch);UIMap.set("code-editor",MonacoEditor$2);UIMap.set("color-picker",ColorPicker);UIMap.set("colors-picker",ColorsPicker);UIMap.set("color-mode",ColorMode);UIMap.set("card-panel",CardPanel);UIMap.set("slider",Slider);UIMap.set("range-slider",RangeSlider);UIMap.set("image-upload",ImageUpload);UIMap.set("text-only",TextOnly);UIMap.set("text-area",TextArea);UIMap.set("group-button",GroupButton);UIMap.set("control-group",ControlGroup);UIMap.set("number-input",NumberInput);UIMap.set("checkbox",CheckBox);class SchemaPathNode{constructor(r,e){U(this,"key","");U(this,"index",0);this.key=r,this.index=e}}class LCGUI extends React.Component{constructor(){super(...arguments);U(this,"onControlChange",(r,e,n,o,s)=>{const{onFieldChange:l}=this.props,c=LCGUIUtil.createObjectFromArray(n,r);l&&l({id:s,data:r,reRender:o,schemaKeyPath:[...e],dataKeyPath:n,dataFragment:c})});U(this,"analyzeRules",(rules,control)=>{const regex=/{([^}]+)}/g,variable=[];let match;for(;(match=regex.exec(rules))!==null;)variable.push(match[1]);const analyze=(r,e,n)=>{if(e.length===0)return n;const{parent:o}=r;if(o&&"children"in o){const{children:s}=o;for(let l=0;l<s.length&&e.length!==0;l++){const c=s[l],u=e.indexOf(c.key);c.key&&u!==-1&&(n=n.replaceAll(`{${c.key}}`,`'${c.value}'`),e.splice(u,1))}}if(e.length>0&&o){const s=e.indexOf(o.key);if(o.key&&o.value&&s!==-1&&(n=n.replace(`{${o.key}}`,`'${o.value}'`),e.splice(s,1)),e.length>0)return analyze(o,e,n)}return n};return eval(analyze(control,variable,rules))});U(this,"buildConfigUI",(r,e,n,o)=>{const s=[];if(!r)return s;if("children"in r){const l=[],{children:c}=r,u=new SchemaPathNode("children"),{type:f,rules:d}=r;if(d&&!this.analyzeRules(d,r))return s;if(e.push(u),r.key&&n.push(r.key),c&&c.forEach((g,p)=>{u.index=p,g.parent=r,l.push(this.buildConfigUI(g,JSON.parse(JSON.stringify(e)),[...n],p))}),!f)s.push([...l]);else{const{type:g,config:p,value:v,id:m,reRender:y,label:x,tip:_}=r,E=UIMap.get(g);e.pop(),e.push({key:"value"});const A={...p,...y?{value:v}:{defaultValue:v},label:x,tip:_,onChange:T=>this.onControlChange(T,e,n,y,m)};s.push(jsxRuntimeExports.jsx(E,{...A,children:l},o))}}else{const{label:l,type:c,tip:u,config:f,value:d,rules:g,id:p,reRender:v}=r;if(!c)return[];if(g&&!this.analyzeRules(g,r))return s;e.push({key:"value"}),n.push(r.key);const y={...f,...v?{value:d}:{defaultValue:d},label:l,tip:u,onChange:_=>this.onControlChange(_,e,n,v,p)},x=UIMap.get(c);if(!x)return[];s.push(jsxRuntimeExports.jsx(x,{...y},o))}return s});U(this,"init",()=>{const r=[];let{schema:e}=this.props;return e=Array.isArray(e)?e:[e],e.forEach(n=>{r.push(this.buildConfigUI(n,[],[],0))}),r})}render(){return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:this.init()})}}const Accordion=reactExports.lazy(()=>__vitePreload(()=>import("./Accordion-Kjxp7g3P.js"),__vite__mapDeps([62,1,2,63,22,23,8,24,25,10,12,13,26,27,64,65,66]))),Radio=reactExports.lazy(()=>__vitePreload(()=>import("./Radio-kbTZ0tv0.js"),__vite__mapDeps([71,1,2,22,23,8,24,25,10,12,13,26,27,72])));class AxisConfig extends reactExports.Component{constructor(e){super(e);U(this,"defaultData",{label:{style:{fill:"#00FFEAFF"}},line:{style:{stroke:"#00dbffff",lineWidth:1}}});U(this,"oldData");U(this,"emptyData",{grid:null,line:null,title:null,label:null,tickLine:null,subTickLine:null});this.oldData={...e==null?void 0:e.config}}render(){const{config:e,title:n="坐标轴",onChange:o}=this.props,{grid:s,line:l,label:c,title:u,tickLine:f,subTickLine:d}=e||{},g=!!(s||l||c||u||f||d);return jsxRuntimeExports.jsxs(Accordion,{label:n,showSwitch:!0,defaultValue:g,onChange:p=>{o(p?lodashExports.isEqual(this.oldData,this.emptyData)?this.defaultData:this.oldData:this.emptyData)},children:[jsxRuntimeExports.jsx(Radio,{label:"位置",defaultValue:(e==null?void 0:e.position)||"right",containerStyle:{marginBottom:10},onChange:p=>o({position:p}),options:[{label:"上",value:"top"},{label:"下",value:"bottom"},{label:"左",value:"left"},{label:"右",value:"right"}]}),jsxRuntimeExports.jsx(AxisText,{config:e==null?void 0:e.label,onChange:p=>o({label:p})}),jsxRuntimeExports.jsx(AxisTitle,{config:e==null?void 0:e.title,onChange:p=>o({title:p})}),jsxRuntimeExports.jsx(AxisLine,{config:e==null?void 0:e.line,onChange:p=>o({line:p})}),jsxRuntimeExports.jsx(AxisGridLine,{config:e==null?void 0:e.grid,onChange:p=>o({grid:p})}),jsxRuntimeExports.jsx(AxisTickLine,{config:e==null?void 0:e.tickLine,onChange:p=>o({tickLine:p})}),jsxRuntimeExports.jsx(AxisSubTickLine,{config:e==null?void 0:e.subTickLine,onChange:p=>o({subTickLine:p})})]})}}const AxisSubTickLine=({config:a,onChange:r})=>{var l,c;const[e,n]=reactExports.useState(a),o=u=>{const{id:f,data:d}=u;if(f==="subTickLineSwitch")if(d){const g={count:5,length:1,style:{stroke:"#6e6e6e",lineWidth:1}};r(g),n(g)}else r(null),n(null);else r(u.dataFragment)},s={type:"card-panel",label:"子刻度",children:[{type:"grid",config:{columns:2},children:[{key:"subTickLineSwitch",id:"subTickLineSwitch",type:"switch",label:"开启",value:!!e},{rules:"{subTickLineSwitch}==='true'",key:"count",type:"number-input",label:"数量",value:e==null?void 0:e.count,config:{min:0,max:100}},{rules:"{subTickLineSwitch}==='true'",key:"length",type:"number-input",label:"长度",value:e==null?void 0:e.length,config:{min:0,max:10}},{rules:"{subTickLineSwitch}==='true'",key:"style",children:[{key:"lineWidth",type:"number-input",label:"宽度",value:(l=e==null?void 0:e.style)==null?void 0:l.lineWidth,config:{min:0,max:10}},{key:"stroke",type:"color-picker",label:"颜色",value:(c=e==null?void 0:e.style)==null?void 0:c.stroke,config:{showText:!0}}]}]}]};return jsxRuntimeExports.jsx(LCGUI,{schema:s,onFieldChange:o})},AxisTickLine=({config:a,onChange:r})=>{var l,c;const[e,n]=reactExports.useState(a),o=u=>{const{id:f,data:d}=u;if(f==="tickLineSwitch")if(d){const g={alignTick:!0,length:1,style:{stroke:"#6e6e6e",lineWidth:1}};r(g),n(g)}else r(null),n(null);else r(u.dataFragment)},s={type:"card-panel",label:"刻度线",children:[{type:"grid",config:{columns:2},children:[{key:"tickLineSwitch",id:"tickLineSwitch",type:"switch",label:"开启",value:!!e},{key:"alignTick",rules:"{tickLineSwitch}==='true'",type:"switch",label:"对齐",value:e==null?void 0:e.alignTick},{key:"length",rules:"{tickLineSwitch}==='true'",type:"number-input",label:"长度",value:e==null?void 0:e.length,config:{min:0,max:10}},{key:"style",rules:"{tickLineSwitch}==='true'",children:[{key:"lineWidth",type:"number-input",label:"宽度",value:(l=e==null?void 0:e.style)==null?void 0:l.lineWidth,config:{min:0,max:10}},{key:"stroke",type:"color-picker",label:"颜色",value:(c=e==null?void 0:e.style)==null?void 0:c.stroke,config:{showText:!0}}]}]}]};return jsxRuntimeExports.jsx(LCGUI,{schema:s,onFieldChange:o})},AxisGridLine=({config:a,onChange:r})=>{var l,c,u,f;const[e,n]=reactExports.useState(a),o=d=>{const{id:g,data:p}=d;if(g==="gridLineSwitch")if(p){const v={alignTick:!0,line:{style:{stroke:"#5c5c5c",lineWidth:1},type:"line"}};r(v),n(v)}else r(null),n(null);else r(d.dataFragment)},s={type:"card-panel",label:"网格线",children:[{type:"grid",config:{columns:2},children:[{key:"gridLineSwitch",id:"gridLineSwitch",type:"switch",label:"开启",value:!!e},{rules:"{gridLineSwitch} === 'true'",key:"alignTick",type:"switch",label:"对齐",value:e==null?void 0:e.alignTick},{rules:"{gridLineSwitch} === 'true'",key:"line",children:[{key:"style",children:[{key:"lineWidth",type:"number-input",label:"宽度",value:(c=(l=e==null?void 0:e.line)==null?void 0:l.style)==null?void 0:c.lineWidth,config:{min:0,max:10}},{key:"stroke",type:"color-picker",label:"颜色",value:(f=(u=e==null?void 0:e.line)==null?void 0:u.style)==null?void 0:f.stroke,config:{showText:!0}}]}]}]}]};return jsxRuntimeExports.jsx(LCGUI,{schema:s,onFieldChange:o})},AxisLine=({config:a,onChange:r})=>{var l,c;const[e,n]=reactExports.useState(a),o=u=>{const{id:f,data:d}=u;f==="lineSwitch"?d?(r({style:{stroke:"#595959",lineWidth:1}}),n({style:{stroke:"#595959",lineWidth:1}})):(r(null),n(null)):r(u.dataFragment)},s={type:"card-panel",label:"轴线",children:[{type:"grid",config:{columns:2},children:[{key:"lineSwitch",id:"lineSwitch",type:"switch",label:"开启",value:!!e},{key:"style",rules:"{lineSwitch} === 'true'",children:[{key:"lineWidth",type:"number-input",label:"宽度",value:((l=e==null?void 0:e.style)==null?void 0:l.lineWidth)||1,config:{min:0,max:10}},{key:"stroke",type:"color-picker",label:"颜色",value:((c=e==null?void 0:e.style)==null?void 0:c.stroke)||"#595959",config:{showText:!0}}]}]}]};return jsxRuntimeExports.jsx(LCGUI,{schema:s,onFieldChange:o})},AxisTitle=({config:a,onChange:r})=>{const[e,n]=reactExports.useState(a),o=l=>{const{id:c,data:u}=l;c==="titleSwitch"?u?(r({text:"标题",offset:0,style:{fill:"#d2d2d2",fontSize:12}}),n({text:"标题",offset:0,style:{fill:"#d2d2d2",fontSize:12}})):(r(null),n(null)):r(l.dataFragment)},s={type:"card-panel",label:"标题",children:[{type:"grid",config:{columns:2},children:[{key:"titleSwitch",id:"titleSwitch",type:"switch",label:"开启",reRender:!0,value:!!e},{rules:"{titleSwitch} === 'true'",children:[{key:"position",type:"select",label:"位置",value:(e==null?void 0:e.position)||"center",config:{options:[{value:"start",label:"前"},{value:"center",label:"中"},{value:"end",label:"后"}]}},{key:"text",type:"input",label:"内容",value:(e==null?void 0:e.text)||"标题"},{key:"offset",type:"number-input",label:"偏移",value:(e==null?void 0:e.offset)||0},{key:"style",children:[{key:"fontSize",type:"number-input",label:"字号",value:12,config:{min:1,max:50}},{key:"fill",type:"color-picker",label:"颜色",value:"#1c1c1c",config:{showText:!0}}]}]}]}]};return jsxRuntimeExports.jsx(LCGUI,{schema:s,onFieldChange:o})},AxisText=({config:a,onChange:r})=>{const{offset:e,style:n,rotate:o}=a||{},s=c=>{r(c.dataFragment)},l={type:"card-panel",label:"文本",children:[{type:"grid",config:{columns:2},children:[{key:"rotate",type:"number-input",label:"角度",value:o||0,config:{min:0,step:.1,max:360}},{key:"offset",type:"number-input",label:"偏移",value:e||0},{key:"style",children:[{key:"fontSize",type:"number-input",label:"字号",value:(n==null?void 0:n.fontSize)||12,config:{min:1,max:50}},{key:"fill",type:"color-picker",label:"颜色",value:(n==null?void 0:n.fill)||"#1c1c1c",config:{showText:!0}}]}]}]};return jsxRuntimeExports.jsx(LCGUI,{schema:l,onFieldChange:s})},AntdCartesianCoordinateSys=({config:a,onChange:r})=>{const e=o=>{r({xAxis:o})},n=o=>{r({yAxis:o})};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AxisConfig,{title:"X轴",config:a==null?void 0:a.xAxis,onChange:e}),jsxRuntimeExports.jsx(AxisConfig,{title:"Y轴",config:a==null?void 0:a.yAxis,onChange:n})]})},AntdLegend=a=>{const{controller:r}=a,{legend:e}=r.getConfig().style,n=s=>{const{id:l,data:c,dataFragment:u}=s;l==="legendSwitch"?c?r.update({style:{legend:e}}):r.update({style:{legend:!1}}):r.update(u)},o={key:"style",id:"legendSwitch",type:"accordion",label:"图例",config:{showSwitch:!0},value:!!e,children:[{key:"legend",type:"grid",config:{columns:2},children:[{key:"position",type:"select",label:"位置",value:"left-top",config:{options:[{value:"left-top",label:"左上"},{value:"left",label:"正左"},{value:"left-bottom",label:"左下"},{value:"top-left",label:"上左"},{value:"top",label:"正上"},{value:"top-right",label:"上右"},{value:"right-top",label:"右上"},{value:"right",label:"正右"},{value:"right-bottom",label:"右下"},{value:"bottom-left",label:"下左"},{value:"bottom",label:"正下"},{value:"bottom-right",label:"下右"}]}},{key:"layout",type:"select",label:"方向",value:"horizontal",config:{options:[{value:"horizontal",label:"水平"},{value:"vertical",label:"垂直"}]}},{key:"itemName",children:[{key:"style",children:[{key:"fontSize",type:"number-input",label:"字号",value:12,config:{min:0,max:100}},{key:"fill",type:"color-picker",label:"颜色",value:"#1c1c1c",config:{showText:!0}}]}]}]}]};return jsxRuntimeExports.jsx(LCGUI,{schema:o,onFieldChange:n})};function AntdMultiLineStyleConfig(a){const{controller:r}=a,e=r.getConfig().style,n=o=>{r.update({style:o})};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AntdMultiLineGraphics,{controller:r}),jsxRuntimeExports.jsx(AntdLegend,{controller:r}),jsxRuntimeExports.jsx(AntdCartesianCoordinateSys,{onChange:n,config:e})]})}const AntdMultiLineGraphics=a=>{var s,l,c,u,f,d,g,p;const{controller:r}=a,e=r.getConfig().style,n=v=>{const{dataFragment:m}=v;r.update(m)},o={type:"accordion",label:"图形",key:"style",config:{bodyStyle:{marginTop:10}},children:[{type:"card-panel",label:"线条",children:[{type:"grid",config:{columns:2},children:[{key:"smooth",type:"switch",label:"平滑",value:e==null?void 0:e.smooth},{key:"lineStyle",children:[{key:"lineWidth",type:"number-input",label:"宽度",value:(s=e==null?void 0:e.lineStyle)==null?void 0:s.lineWidth,config:{min:0,max:10}}]},{key:"color",type:"color-mode",label:"颜色",value:e==null?void 0:e.color,config:{containerStyle:{gridColumn:"1/3"}}}]}]},{type:"card-panel",label:"数据点",children:[{key:"point",type:"grid",config:{columns:2},children:[{key:"size",type:"number-input",label:"尺寸",value:(l=e==null?void 0:e.point)==null?void 0:l.size,config:{min:0,max:10}},{key:"color",type:"color-mode",label:"颜色",value:(c=e==null?void 0:e.point)==null?void 0:c.color,config:{containerStyle:{gridColumn:"1/3"}}},{key:"style",children:[{key:"lineWidth",type:"number-input",label:"描边宽",value:(f=(u=e==null?void 0:e.point)==null?void 0:u.style)==null?void 0:f.lineWidth,config:{min:0}},{key:"stroke",type:"color-picker",label:"描边色",value:(g=(d=e==null?void 0:e.point)==null?void 0:d.style)==null?void 0:g.stroke,config:{showText:!0}}]},{key:"shape",type:"select",label:"形状",value:(p=e==null?void 0:e.point)==null?void 0:p.shape,config:{options:[{value:"circle",label:"圈形"},{value:"square",label:"方形"},{value:"bowtie",label:"领结"},{value:"diamond",label:"钻石"},{value:"hexagon",label:"六角形"},{value:"triangle",label:"三角形"}]}}]}]}]};return jsxRuntimeExports.jsx(LCGUI,{schema:o,onFieldChange:n})},AntdMultiLineFieldMapping=({controller:a})=>{var c;const r=AntdCommonUtil.getDataFieldOptions(a),{xField:e,yField:n,seriesField:o}=(c=a.getConfig())==null?void 0:c.style,s={type:"grid",key:"style",config:{columns:2},children:[{key:"xField",value:e,type:"select",label:"X字段",config:{options:r}},{value:n,key:"yField",type:"select",label:"Y字段",config:{options:r}},{value:o,key:"seriesField",type:"select",label:"分组字段",config:{options:r}}]},l=u=>{const{dataFragment:f}=u;a.update(f)};return jsxRuntimeExports.jsx(LCGUI,{schema:s,onFieldChange:l})};class AntdMultiLineDefinition extends AbstractLineDefinition{getBaseInfo(){return{compName:"Antd多折线图",compKey:"AntdMultiLine",categorize:"chart",subCategorize:"line"}}getChartImg(){return multiLineImg}getMenuToConfigContentMap(){const r=super.getMenuToConfigContentMap();return r.style=AntdMultiLineStyleConfig,r.mapping=AntdMultiLineFieldMapping,r}getInitConfig(){const r=[{year:"2007",value:1706,category:"sort1"},{year:"2007",value:448,category:"sort2"},{year:"2008",value:1361,category:"sort1"},{year:"2008",value:779,category:"sort2"},{year:"2009",value:1722,category:"sort1"},{year:"2009",value:430,category:"sort2"},{year:"2010",value:1626,category:"sort1"},{year:"2010",value:555,category:"sort2"}];return{base:{id:"",name:"多折线图",type:"AntdMultiLine"},style:{data:r,xField:"year",yField:"value",seriesField:"category",supportCSSTransform:!0,color:["#00a8ff","#00ffc9"],point:{color:["#00a8ff","#00ffc9"],size:3,shape:"circle",style:{stroke:"#00a8ff",lineWidth:0}},lineStyle:{lineWidth:2},xAxis:{grid:null,label:{style:{fill:"#969696ff",fontSize:11}},line:null,tickLine:null,subTickLine:null,position:"left",title:null},yAxis:{grid:null,label:{style:{fill:"#a0a0a0ff",fontSize:10}},line:{style:{stroke:"#adadad75",lineWidth:1}},tickLine:null,subTickLine:null,position:"bottom",title:null},smooth:!1,legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#a0a0a0ff",fontSize:12}}},animation:{appear:{animation:"wave-in",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_34=Object.freeze(Object.defineProperty({__proto__:null,default:AntdMultiLineDefinition},Symbol.toStringTag,{value:"Module"})),stepLineImg="/light-chaser-app/assets/step-line-ZsCy2NyX.png";class AntdStepLineDefinition extends AbstractLineDefinition{getBaseInfo(){return{compName:"Antd阶梯折线图",compKey:"AntdStepLine",categorize:"chart",subCategorize:"line"}}getChartImg(){return stepLineImg}getInitConfig(){const r=[{year:"1991",value:3},{year:"1992",value:4},{year:"1993",value:3.5},{year:"1994",value:5},{year:"1995",value:4.9},{year:"1996",value:6},{year:"1997",value:7},{year:"1998",value:9},{year:"1999",value:13},{year:"1999",value:8}];return{base:{id:"",name:"多折线图",type:"AntdStepLine"},style:{data:r,xField:"year",yField:"value",stepType:"vh",color:"#00d7ff",smooth:!0,supportCSSTransform:!0,point:{size:3,color:"#00d7ff",shape:"bowtie",style:{lineWidth:0,stroke:"#00d7ff"}},lineStyle:{stroke:void 0,lineWidth:1},xAxis:{grid:null,label:{style:{fill:"#989898ff",fontSize:10}},line:null,tickLine:null,subTickLine:null,position:"left",title:null},yAxis:{grid:null,label:{style:{fill:"#a6a6a6ff"}},line:{style:{stroke:"#9a9a9a8c",lineWidth:1}},tickLine:null,subTickLine:null,position:"bottom",title:null},legend:{position:"right-top",layout:"vertical",itemName:{style:{fill:"#00f0ffff",fontSize:12}}},animation:{appear:{animation:"wave-in",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_35=Object.freeze(Object.defineProperty({__proto__:null,default:AntdStepLineDefinition},Symbol.toStringTag,{value:"Module"}));class AntdLiquidController extends AntdBaseDesignerController{async create(r,e){super.commonCreate(r,Liquid,e)}destroy(){this.instance.destroy(),this.instance=null,this.config=null,this.interval&&clearInterval(this.interval)}getConfig(){return this.config}changeData(r){var e;this.config.data.staticData=r,this.config.style.percent=r,(e=this.instance)==null||e.changeData(r)}update(r,e){super.commonUpdate(r,Liquid,e)}updateTheme(r){}}const __vite_glob_0_36=Object.freeze(Object.defineProperty({__proto__:null,default:AntdLiquidController},Symbol.toStringTag,{value:"Module"})),liquidImg="/light-chaser-app/assets/liquid-J6eQe4sd.png",AntdLiquidConfig=React.lazy(()=>__vitePreload(()=>import("./AntdLiquidConfig-nizAhSti.js"),__vite__mapDeps([96,1,2,5,6,7,8,9,10,11,12,13,14,15,16]))),ThemeConfig$7=React.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),BaseInfo$e=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),DataConfig$4=React.lazy(()=>__vitePreload(()=>import("./DataConfig-11-GlHR8.js"),__vite__mapDeps([50,1,2,6,7,8,9,10,11,12,14,5,13,15,16,51]))),FilterConfig$9=React.lazy(()=>__vitePreload(()=>import("./FilterConfig-NGULEsf_.js"),__vite__mapDeps([52,1,2,6,7,8,9,10,11,12,5,13,14,15,16,53])));class AntdLiquidDefinition extends AbstractDesignerDefinition{getController(){return AntdLiquidController}getMenuList(){return super.getMenuList().filter(r=>r.key!=="mapping")}getMenuToConfigContentMap(){return{base:BaseInfo$e,data:DataConfig$4,style:AntdLiquidConfig,theme:ThemeConfig$7,filter:FilterConfig$9}}getBaseInfo(){return{compName:"Antd水波图",compKey:"AntdLiquid",categorize:"chart",subCategorize:"progress"}}getChartImg(){return liquidImg}getInitConfig(){return{base:{id:"",name:"Antd水波图",type:"AntdLiquid"},style:{shape:"circle",percent:.65,radius:.9,liquidStyle:{fill:"#2399ffea",stroke:"#1a75c8d6"},shapeStyle:{fill:"#00fff716"},outline:{border:0,distance:0,style:{stroke:"#2B7DD35F"}},wave:{length:150,count:5},statistic:{content:{style:{fill:"#7de0ff",fontSize:"20",color:"#81d8ff"}},title:{content:"指标1",style:{fontSize:"22",color:"#61a0f9c2",fontWeight:900},offsetY:-10}},animation:{appear:{animation:"wave-in",duration:3e3}}},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0},data:{sourceType:"static",staticData:.65}}}}const __vite_glob_0_37=Object.freeze(Object.defineProperty({__proto__:null,default:AntdLiquidDefinition},Symbol.toStringTag,{value:"Module"}));class AntdPieController extends AntdBaseDesignerController{async create(r,e){super.commonCreate(r,Pie,e)}destroy(){this.instance.destroy(),this.instance=null,this.config=null,this.interval&&clearInterval(this.interval)}getConfig(){return this.config}update(r,e){super.commonUpdate(r,Pie,e)}updateTheme(r){var f,d,g,p,v,m;if(!r)return;const e=(f=this.config)==null?void 0:f.style,{colors:{main:n,mainText:o,supplementSecond:s,background:l,supplementFirst:c,subText:u}}=r;e!=null&&e.color&&(e.color=[n,o,u,c,s]),e.legend&&((g=(d=e.legend.itemName)==null?void 0:d.style)!=null&&g.fill)&&(e.legend.itemName.style.fill=o),e!=null&&e.pieStyle&&(e!=null&&e.pieStyle)&&(e.pieStyle.stroke=l),e!=null&&e.label&&((p=e==null?void 0:e.label)!=null&&p.style)&&(e.label.style.fill=o),e!=null&&e.statistic&&((v=e==null?void 0:e.statistic)!=null&&v.title)&&e.statistic.title.style&&(e.statistic.title.style.color=o),e!=null&&e.statistic&&((m=e==null?void 0:e.statistic)!=null&&m.content)&&e.statistic.content.style&&(e.statistic.content.style.color=u),this.update({style:e},{reRender:!0})}}const __vite_glob_0_38=Object.freeze(Object.defineProperty({__proto__:null,default:AntdPieController},Symbol.toStringTag,{value:"Module"})),pieImg="/light-chaser-app/assets/pie-kQBx5-oT.png",AnimationConfig$8=React.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),AntdPieConfig=React.lazy(()=>__vitePreload(()=>import("./AntdPieStyleConfig-dVrl03af.js"),__vite__mapDeps([97,1,2,5,6,7,8,9,10,11,12,13,14,15,16]))),AntdPieFieldMapping=React.lazy(()=>__vitePreload(()=>import("./AntdPieStyleConfig-dVrl03af.js"),__vite__mapDeps([97,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdPieFieldMapping}))),ThemeConfig$6=React.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),BaseInfo$d=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),DataConfig$3=React.lazy(()=>__vitePreload(()=>import("./DataConfig-11-GlHR8.js"),__vite__mapDeps([50,1,2,6,7,8,9,10,11,12,14,5,13,15,16,51])));class AntdPieDefinition extends AntdCommonDefinition{getController(){return AntdPieController}getMenuList(){return getDefaultMenuList()}getMenuToConfigContentMap(){return{base:BaseInfo$d,data:DataConfig$3,style:AntdPieConfig,animation:AnimationConfig$8,theme:ThemeConfig$6,mapping:AntdPieFieldMapping}}getBaseInfo(){return{compName:"Antd饼图",compKey:"AntdPie",categorize:"chart",subCategorize:"pie"}}getChartImg(){return pieImg}getInitConfig(){const r=[{type:"sort1",value:30},{type:"sort2",value:25},{type:"sort3",value:20},{type:"sort4",value:25}];return{base:{id:"",name:"Antd饼图",type:"AntdPie"},style:{data:r,angleField:"value",colorField:"type",radius:.7,innerRadius:.6,startAngle:0,endAngle:Math.PI*2,pieStyle:{stroke:"#fff",lineWidth:0},label:{type:"outer",offset:27,content:"{name} {percentage}",autoRotate:!0,rotate:0,style:{textAlign:"center",fontSize:10,fontWeight:400,fill:"#cececeff"}},legend:{position:"right",layout:"vertical",itemName:{style:{fill:"#adadadff",fontSize:12}}},interactions:[{type:"element-selected"},{type:"element-active"}],statistic:{title:{style:{fontSize:"10px",color:"#b9b9b9ff",fontWeight:300},content:"总计",offsetY:-6},content:{style:{fontSize:"16px",color:"#c5c5c5ff"},content:"100",offsetY:2,offsetX:-2}},animation:{appear:{animation:"wave-in",duration:3e3}},color:["#0087ffff","#339effff","#87c5ffff","#4687c3ff"]},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_39=Object.freeze(Object.defineProperty({__proto__:null,default:AntdPieDefinition},Symbol.toStringTag,{value:"Module"}));class AntdRadarController extends AntdBaseDesignerController{async create(r,e){super.commonCreate(r,Radar,e)}destroy(){this.instance.destroy(),this.instance=null,this.config=null,this.interval&&clearInterval(this.interval)}getConfig(){return this.config}changeData(r){var e;this.config.data.staticData=r,this.config.style.data=r,(e=this.instance)==null||e.changeData(r)}update(r,e){super.commonUpdate(r,Radar,e)}updateTheme(r){}}const __vite_glob_0_40=Object.freeze(Object.defineProperty({__proto__:null,default:AntdRadarController},Symbol.toStringTag,{value:"Module"})),radarImg="/light-chaser-app/assets/radar-dpKzdvXL.png",AnimationConfig$7=React.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),AntdRadarStyleConfig=React.lazy(()=>__vitePreload(()=>import("./AntdRadarStyleConfig-Ou7aatmw.js"),__vite__mapDeps([98,1,2,5,6,7,8,9,10,11,12,13,14,15,16]))),ThemeConfig$5=React.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),BaseInfo$c=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),DataConfig$2=React.lazy(()=>__vitePreload(()=>import("./DataConfig-11-GlHR8.js"),__vite__mapDeps([50,1,2,6,7,8,9,10,11,12,14,5,13,15,16,51]))),AntdRadarFieldMapping=React.lazy(()=>__vitePreload(()=>import("./AntdRadarStyleConfig-Ou7aatmw.js"),__vite__mapDeps([98,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdRadarFieldMapping})));class AntdRadarDefinition extends AntdCommonDefinition{getController(){return AntdRadarController}getMenuList(){return getDefaultMenuList()}getMenuToConfigContentMap(){return{base:BaseInfo$c,data:DataConfig$2,style:AntdRadarStyleConfig,animation:AnimationConfig$7,theme:ThemeConfig$5,mapping:AntdRadarFieldMapping}}getBaseInfo(){return{compName:"Antd雷达图",compKey:"AntdRadar",categorize:"chart",subCategorize:"radar"}}getChartImg(){return radarImg}getInitConfig(){const r=[{name:"G2",star:10371},{name:"G6",star:7380},{name:"F2",star:7414},{name:"L7",star:2140},{name:"X6",star:6601},{name:"AVA",star:8851},{name:"G2Plot",star:1626}];return{base:{id:"",name:"Antd雷达图",type:"AntdRadar"},style:{data:r,xField:"name",yField:"star",radius:1,smooth:!0,lineStyle:{stroke:"#8fe0ff",lineWidth:2,opacity:.5},point:{size:3,shape:"circle",style:{fill:"#4c9cff",stroke:"#64d6ff",lineWidth:1}},area:{style:{fill:"#3991ff",fillOpacity:.6}},xAxis:{line:null,tickLine:null,grid:{alignTick:!0,line:{style:{stroke:"#42cdffbb",lineWidth:1},type:"line"}},label:{style:{fill:"#41bbff"}}},yAxis:{line:{style:{stroke:"#595959",lineWidth:1}},tickLine:null,grid:{alignTick:!0,line:{style:{stroke:"#7ee5ff95",lineWidth:1},type:"line"}},label:{style:{fill:"#78b3fa"}}},animation:{appear:{animation:"wave-in",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_41=Object.freeze(Object.defineProperty({__proto__:null,default:AntdRadarDefinition},Symbol.toStringTag,{value:"Module"}));class AntdBaseRadialBarController extends AntdBaseDesignerController{async create(r,e){super.commonCreate(r,RadialBar,e)}destroy(){this.instance.destroy(),this.instance=null,this.config=null,this.interval&&clearInterval(this.interval)}getConfig(){return this.config}update(r,e){super.commonUpdate(r,RadialBar,e)}updateTheme(r){}}const __vite_glob_0_42=Object.freeze(Object.defineProperty({__proto__:null,default:AntdBaseRadialBarController},Symbol.toStringTag,{value:"Module"})),baseRadialBarImg="/light-chaser-app/assets/base-radial-bar-_o3Hp62W.png",AnimationConfig$6=React.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),AntdRadialBarConfig=React.lazy(()=>__vitePreload(()=>import("./AntdBaseRadialBarStyleConfig-u5wJSNkr.js"),__vite__mapDeps([99,1,2,5,6,7,8,9,10,11,12,13,14,15,16]))),AntdRadialBarFieldMapping=React.lazy(()=>__vitePreload(()=>import("./AntdBaseRadialBarStyleConfig-u5wJSNkr.js"),__vite__mapDeps([99,1,2,5,6,7,8,9,10,11,12,13,14,15,16])).then(a=>({default:a.AntdRadialBarFieldMapping}))),ThemeConfig$4=React.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),BaseInfo$b=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),DataConfig$1=React.lazy(()=>__vitePreload(()=>import("./DataConfig-11-GlHR8.js"),__vite__mapDeps([50,1,2,6,7,8,9,10,11,12,14,5,13,15,16,51])));class AntdBaseRadialBarDefinition extends AntdCommonDefinition{getController(){return AntdBaseRadialBarController}getMenuList(){return getDefaultMenuList()}getMenuToConfigContentMap(){return{base:BaseInfo$b,data:DataConfig$1,style:AntdRadialBarConfig,animation:AnimationConfig$6,theme:ThemeConfig$4,mapping:AntdRadialBarFieldMapping}}getBaseInfo(){return{compName:"Antd基础玉珏图",compKey:"AntdBaseRadialBar",categorize:"chart",subCategorize:"radial"}}getChartImg(){return baseRadialBarImg}getInitConfig(){const r=[{name:"X6",star:297},{name:"G",star:506},{name:"AVA",star:805},{name:"G2Plot",star:1478},{name:"L7",star:2029},{name:"G6",star:7100},{name:"F2",star:7346},{name:"G2",star:10178}];return{base:{id:"",name:"Antd基础玉珏图",type:"AntdBaseRadialBar"},style:{data:r,xField:"name",yField:"star",maxAngle:270,startAngle:-Math.PI/2,endAngle:Math.PI/2*3,radius:.8,innerRadius:.2,colorField:"star",type:"",supportCSSTransform:!0,maxBarWidth:20,barStyle:{lineCap:"round"},xAxis:{label:{style:{fill:"#ffdede",fontSize:10}}},animation:{appear:{animation:"wave-in",duration:3e3}},color:["#0089FF","#F2FF00"]},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_43=Object.freeze(Object.defineProperty({__proto__:null,default:AntdBaseRadialBarDefinition},Symbol.toStringTag,{value:"Module"}));class AntdRingProgressController extends AntdBaseDesignerController{async create(r,e){super.commonCreate(r,RingProgress,e)}destroy(){this.instance.destroy(),this.instance=null,this.config=null,this.interval&&clearInterval(this.interval)}getConfig(){return this.config}update(r,e){var n;super.commonUpdate(r,RingProgress,e),console.log((n=this.config)==null?void 0:n.style)}updateTheme(r){var c,u,f;if(!r)return;const e=(c=this.config)==null?void 0:c.style,{colors:{main:n,mainText:o,supplementFirst:s,subText:l}}=r;e!=null&&e.color&&(e.color=[n,s]),e!=null&&e.statistic&&((u=e==null?void 0:e.statistic)!=null&&u.title)&&e.statistic.title.style&&(e.statistic.title.style.color=o),e!=null&&e.statistic&&((f=e==null?void 0:e.statistic)!=null&&f.content)&&e.statistic.content.style&&(e.statistic.content.style.color=l),this.update({style:e},{reRender:!0})}}const __vite_glob_0_44=Object.freeze(Object.defineProperty({__proto__:null,default:AntdRingProgressController},Symbol.toStringTag,{value:"Module"})),ringProgressImg="/light-chaser-app/assets/ring-progress-eDw8Jasc.png",AnimationConfig$5=React.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),DataConfig=React.lazy(()=>__vitePreload(()=>import("./DataConfig-11-GlHR8.js"),__vite__mapDeps([50,1,2,6,7,8,9,10,11,12,14,5,13,15,16,51]))),AntdRingProgressStyleConfig=React.lazy(()=>__vitePreload(()=>import("./AntdRingProgressConfig-n38fmxqG.js"),__vite__mapDeps([100,1,2,6,7,8,9,10,11,12,5,13,14,15,16])).then(a=>({default:a.AntdRingProgressStyleConfig}))),ThemeConfig$3=React.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),BaseInfo$a=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49])));class AntdRingProgressDefinition extends AntdCommonDefinition{getController(){return AntdRingProgressController}getMenuList(){return getDefaultMenuList().filter(r=>r.key!=="mapping")}getMenuToConfigContentMap(){return{base:BaseInfo$a,data:DataConfig,style:AntdRingProgressStyleConfig,animation:AnimationConfig$5,theme:ThemeConfig$3}}getBaseInfo(){return{compName:"Antd迷你环图",compKey:"AntdRingProgress",categorize:"chart",subCategorize:"progress"}}getChartImg(){return ringProgressImg}getInitConfig(){return{base:{id:"",name:"Antd迷你环图",type:"AntdRingProgress"},style:{percent:.7,color:["#3cc2f8bd","#66d2ff3e"],statistic:{content:{style:{fill:"#fff",fontSize:"24",fontWeight:900,color:"#57c6ff"},offsetY:7,offsetX:0},title:{style:{fontSize:"21",fontWeight:900,color:"#6ad1ff"},content:"指标1",offsetY:-11}},animation:{appear:{animation:"wave-in",duration:3e3}},progressStyle:{}},data:{sourceType:"static",staticData:.7}}}}const __vite_glob_0_45=Object.freeze(Object.defineProperty({__proto__:null,default:AntdRingProgressDefinition},Symbol.toStringTag,{value:"Module"})),baseRoseImg="/light-chaser-app/assets/base-rose-Q2gpgR7-.png";class AntdBaseRoseDefinition extends AbstractRoseDefinition{getBaseInfo(){return{compName:"Antd基础玫瑰图",compKey:"AntdBaseRose",categorize:"chart",subCategorize:"rose"}}getChartImg(){return baseRoseImg}getInitConfig(){const r=[{type:"sort1",value:27},{type:"sort2",value:25},{type:"sort3",value:18},{type:"sort4",value:15}];return{base:{id:"",name:"Antd基础玫瑰图",type:"AntdBaseRose"},style:{data:r,xField:"type",yField:"value",seriesField:"type",radius:.8,innerRadius:0,padding:[50,0,0,0],supportCSSTransform:!0,sectorStyle:{stroke:"#fff",lineWidth:0},label:{style:{fill:"#b5b5b5ff",fontSize:13},autoRotate:!0},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#a6a6a6ff",fontSize:12}}},animation:{appear:{animation:"grow-in-xy",duration:3e3}},color:["#0091ffff","#68beffff","#b4e0ffff","#408ec9ff"]},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_46=Object.freeze(Object.defineProperty({__proto__:null,default:AntdBaseRoseDefinition},Symbol.toStringTag,{value:"Module"})),groupRoseImg="/light-chaser-app/assets/group-rose-vO5lvahu.png";class AntdGroupRoseDefinition extends AbstractRoseDefinition{getBaseInfo(){return{compName:"Antd分组玫瑰图",compKey:"AntdGroupRose",categorize:"chart",subCategorize:"rose"}}getChartImg(){return groupRoseImg}getInitConfig(){const r=[{type:"sort1",value:27,user:"user1"},{type:"sort2",value:25,user:"user2"},{type:"sort3",value:18,user:"user1"},{type:"sort4",value:15,user:"user2"},{type:"sort5",value:18,user:"user1"},{type:"sort6",value:20,user:"user2"}];return{base:{id:"",name:"Antd基础玫瑰图",type:"AntdBaseRose"},style:{data:r,xField:"type",yField:"value",isGroup:!0,seriesField:"user",padding:[60,0,0,0],radius:.8,innerRadius:0,startAngle:0,endAngle:2*Math.PI,label:{offset:14,style:{fill:"#aaaaaaff"}},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#a8a8a8ff",fontSize:12}}},supportCSSTransform:!0,animation:{appear:{animation:"grow-in-xy",duration:3e3}},color:["#00b7ffff","#81dbffff"],sectorStyle:{lineWidth:0}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_47=Object.freeze(Object.defineProperty({__proto__:null,default:AntdGroupRoseDefinition},Symbol.toStringTag,{value:"Module"})),stackRoseImg="/light-chaser-app/assets/stack-rose-UAs5DTM4.png";class AntdStackRoseDefinition extends AbstractRoseDefinition{getBaseInfo(){return{compName:"Antd堆叠玫瑰图",compKey:"AntdStackRose",categorize:"chart",subCategorize:"rose"}}getChartImg(){return stackRoseImg}getInitConfig(){const r=[{type:"sort1",value:27,user:"user1"},{type:"sort2",value:25,user:"user1"},{type:"sort3",value:18,user:"user1"},{type:"sort4",value:15,user:"user1"},{type:"sort5",value:10,user:"user1"},{type:"sort1",value:7,user:"user2"},{type:"sort2",value:5,user:"user2"},{type:"sort3",value:28,user:"user2"},{type:"sort4",value:15,user:"user2"},{type:"sort5",value:20,user:"user2"}];return{base:{id:"",name:"Antd堆叠玫瑰图",type:"AntdStackRose"},style:{data:r,xField:"type",yField:"value",isStack:!0,seriesField:"user",color:["#00b7ffff","#8ed2ffff"],radius:1,innerRadius:0,supportCSSTransform:!0,sectorStyle:{stroke:"#fff",lineWidth:0},label:{offset:-12,style:{fill:"#ffffffff",fontSize:9,fontWeight:700}},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#b9b9b9ff",fontSize:12}}},animation:{appear:{animation:"wave-in",duration:3e3}}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_48=Object.freeze(Object.defineProperty({__proto__:null,default:AntdStackRoseDefinition},Symbol.toStringTag,{value:"Module"})),scatterBubble="/light-chaser-app/assets/scatter-bubble-3905Y8Ct.png";class AntdScatterBubbleDefinition extends AbstractScatterDefinition{getBaseInfo(){return{compName:"Antd气泡图",compKey:"AntdScatterBubble",categorize:"chart",subCategorize:"scatter"}}getChartImg(){return scatterBubble}getInitConfig(){const r=[{x:42,y:38,size:20,genre:"female"},{x:6,y:18,size:1,genre:"female"},{x:58,y:24,size:20,genre:"male"},{x:78,y:37,size:34,genre:"male"},{x:55,y:56,size:53,genre:"male"},{x:18,y:45,size:70,genre:"male"},{x:42,y:44,size:28,genre:"male"},{x:3,y:52,size:59,genre:"male"},{x:31,y:18,size:97,genre:"male"},{x:79,y:91,size:63,genre:"male"},{x:93,y:23,size:23,genre:"male"},{x:44,y:83,size:22,genre:"male"}];return{base:{id:"",name:"Antd气泡图",type:"AntdScatterBubble"},style:{data:r,xField:"x",yField:"y",colorField:"genre",sizeField:"size",size:[5,20],shape:"circle",xAxis:{grid:null,label:{style:{fill:"#9a9a9aff",fontSize:10},offset:16},line:null,tickLine:null,subTickLine:null,position:"left",title:null},yAxis:{grid:null,label:{style:{fill:"#a0a0a0ff",fontSize:10},offset:5},line:{style:{stroke:"#a2a2a275",lineWidth:1}},tickLine:null,subTickLine:null,position:"bottom",title:null},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#a0a0a0ff",fontSize:10}}},supportCSSTransform:!0,animation:{appear:{animation:"fade-in",duration:3e3}},color:["#116BA2","#58c1ffff"],pointStyle:{lineWidth:0}},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_49=Object.freeze(Object.defineProperty({__proto__:null,default:AntdScatterBubbleDefinition},Symbol.toStringTag,{value:"Module"})),scatterPoint="/light-chaser-app/assets/scatter-point-pdQO4Bno.png";class AntdScatterPointDefinition extends AbstractScatterDefinition{getBaseInfo(){return{compName:"Antd散点图",compKey:"AntdScatterPoint",categorize:"chart",subCategorize:"scatter"}}getChartImg(){return scatterPoint}getInitConfig(){const r=[{x:1,y:23,type:"one"},{x:2,y:15,type:"two"},{x:3,y:17,type:"three"},{x:4,y:48,type:"four"},{x:5,y:8,type:"five"}];return{base:{id:"",name:"Antd散点图",type:"AntdScatterPoint"},style:{data:r,xField:"x",yField:"y",colorField:"type",sizeField:"y",size:6,shape:"circle",pointStyle:{fillOpacity:1,lineWidth:0},xAxis:{grid:null,label:{style:{fill:"#a8a8a8ff",fontSize:10}},line:{style:{stroke:"#a4a4a470",lineWidth:1}},tickLine:null,subTickLine:null,position:"bottom",title:null},yAxis:{grid:null,label:{style:{fill:"#a0a0a0ff",fontSize:10}},line:null,tickLine:null,subTickLine:null,position:"left",title:null},legend:{position:"top",layout:"horizontal",itemName:{style:{fill:"#969696ff",fontSize:10}}},supportCSSTransform:!0,animation:{appear:{animation:"fade-in",duration:3e3}},color:["#00b7ffff","#006d98ff"]},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_50=Object.freeze(Object.defineProperty({__proto__:null,default:AntdScatterPointDefinition},Symbol.toStringTag,{value:"Module"}));class AntdWordCloudController extends AntdBaseDesignerController{async create(r,e){super.commonCreate(r,WordCloud,e)}destroy(){this.instance.destroy(),this.instance=null,this.config=null,this.interval&&clearInterval(this.interval)}getConfig(){return this.config}update(r,e){super.commonUpdate(r,WordCloud,e)}updateTheme(r){var u,f,d,g;if(!r)return;const e=(u=this.config)==null?void 0:u.style,{colors:{main:n,mainText:o,supplementSecond:s,supplementFirst:l,subText:c}}=r;e!=null&&e.color&&(e.color=[n,o,c,l,s]),e.legend&&((d=(f=e.legend.itemName)==null?void 0:f.style)!=null&&d.fill)&&(e.legend.itemName.style.fill=o),e!=null&&e.label&&((g=e==null?void 0:e.label)!=null&&g.style)&&(e.label.style.fill=o),this.update({style:e},{reRender:!0})}}const __vite_glob_0_51=Object.freeze(Object.defineProperty({__proto__:null,default:AntdWordCloudController},Symbol.toStringTag,{value:"Module"})),baseWordCloudImg="/light-chaser-app/assets/word-cloud-XRdg6nIQ.png",AntdWordCloudStyle=a=>{var s,l,c,u;const{controller:r}=a,{style:e}=r.getConfig(),n={type:"grid",key:"style",config:{columns:2},children:[{type:"input",label:"遮罩",key:"imageMask",value:e==null?void 0:e.imageMask,config:{containerStyle:{gridColumn:"1/3",marginBottom:"10px"}}},{type:"color-mode",key:"color",label:"颜色",value:e==null?void 0:e.color,config:{containerStyle:{gridColumn:"1/3"}}},{id:"randomPosition",type:"switch",key:"random",label:"随机",tip:"开启后词云图每次更新数据，词语位置随机展示",value:typeof(e==null?void 0:e.random)!="number"},{key:"spiral",type:"select",label:"形状",value:e==null?void 0:e.spiral,config:{options:[{label:"椭圆",value:"archimedean"},{label:"矩形",value:"rectangular"}]}},{key:"wordStyle",children:[{type:"select",key:"fontFamily",label:"字体",value:(s=e==null?void 0:e.wordStyle)==null?void 0:s.fontFamily,config:{options:[{label:"钉钉进步体",value:"DingTalk JinBuTi"},{label:"抖音美好体",value:"DouyinSansBold"},{label:"优设标题黑",value:"优设标题黑"},{label:"庞门正道标题",value:"庞门正道标题体免费版"}]}},{key:"fontWeight",type:"number-input",label:"粗细",value:((l=e==null?void 0:e.wordStyle)==null?void 0:l.fontWeight)||500,config:{min:100,max:900,step:100}},{key:"fontSize",type:"range-slider",label:"字号",value:(c=e==null?void 0:e.wordStyle)==null?void 0:c.fontSize,config:{min:0}},{key:"padding",type:"number-input",label:"间距",value:(u=e==null?void 0:e.wordStyle)==null?void 0:u.padding,config:{min:0}}]}]},o=f=>{const{dataFragment:d,data:g,id:p}=f;if(p==="randomPosition"){const v=g?void 0:.5;r.update({style:{random:v}})}else r.update(d)};return jsxRuntimeExports.jsx(LCGUI,{schema:n,onFieldChange:o})},AntdWordCloudFieldMapping=a=>{const{controller:r}=a,e=AntdCommonUtil.getDataFieldOptions(r),{style:n}=r.getConfig(),o={type:"grid",key:"style",config:{columns:2},children:[{type:"select",label:"颜色字段",key:"colorField",value:n==null?void 0:n.colorField,config:{options:e}},{type:"select",label:"权重字段",key:"weightField",value:n==null?void 0:n.weightField,config:{options:e}},{type:"select",label:"内容字段",key:"wordField",value:n==null?void 0:n.wordField,config:{options:e}}]},s=l=>{const{dataFragment:c}=l;r.update(c)};return jsxRuntimeExports.jsx(LCGUI,{schema:o,onFieldChange:s})};class AntdWordCloudDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"Antd词云图",compKey:"AntdWordCloud",categorize:"chart",subCategorize:"wordCloud"}}getController(){return AntdWordCloudController}getMenuList(){const r=super.getMenuList();return r.splice(3,0,{icon:Deeplink,name:"映射",key:"mapping"}),r}getChartImg(){return baseWordCloudImg}getMenuToConfigContentMap(){const r=super.getMenuToConfigContentMap();return r.style=AntdWordCloudStyle,r.mapping=AntdWordCloudFieldMapping,r}getInitConfig(){const r=[{value:9,name:"AntV"},{value:8,name:"F2"},{value:8,name:"G2"},{value:8,name:"G6"},{value:8,name:"DataSet"},{value:8,name:"墨者学院"},{value:6,name:"Analysis"},{value:6,name:"Data Mining"},{value:6,name:"Data Vis"},{value:6,name:"Design"},{value:6,name:"Grammar"},{value:6,name:"Graphics"},{value:6,name:"Graph"},{value:6,name:"Hierarchy"},{value:6,name:"Labeling"},{value:6,name:"Layout"},{value:6,name:"Quantitative"}];return{base:{id:"",name:"基础面积图",type:"AntdBaseWordCloud"},style:{data:r,wordField:"name",weightField:"value",colorField:"name",supportCSSTransform:!0,spiral:"rectangular",wordStyle:{fontFamily:"优设标题黑",fontWeight:500,fontSize:[8,32],rotation:0,padding:1}},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0},data:{sourceType:"static",staticData:r}}}}const __vite_glob_0_52=Object.freeze(Object.defineProperty({__proto__:null,default:AntdWordCloudDefinition},Symbol.toStringTag,{value:"Module"})),__vite_glob_0_53=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class RightStore{constructor(){U(this,"activeElem",{});U(this,"menus",[]);U(this,"activeMenu","");U(this,"visible",!1);U(this,"setActiveMenu",r=>this.activeMenu=r);U(this,"setContentVisible",r=>this.visible=r);U(this,"activeConfig",(r,e)=>{var n;if(!r||!e){this.activeMenu="",this.activeElem={},this.menus=[],this.visible&&(this.visible=!1);return}if(this.activeElem={id:r,type:e},this.menus=((n=editorDesignerLoader$1==null?void 0:editorDesignerLoader$1.definitionMap[e])==null?void 0:n.getMenuList())||[],this.menus.length>0){let o=!0;for(let s=0;s<this.menus.length;s++)if(this.menus[s].key===this.activeMenu){o=!1;break}o&&this.visible?this.activeMenu=this.menus[0].key:this.activeMenu===""&&(this.activeMenu="style")}if(this.visible){this.visible=!1;const o=setTimeout(()=>{runInAction(()=>this.visible=!0),clearTimeout(o)},0)}else this.visible=!0});makeObservable(this,{menus:observable,activeMenu:observable,visible:observable,setActiveMenu:action,setContentVisible:action,activeConfig:action})}}const rightStore=new RightStore;class BaseInfoStore{constructor(){U(this,"baseConfigRef",null);U(this,"setBaseConfigRef",r=>this.baseConfigRef=r);U(this,"updateBaseConfig",r=>{var n;const{activeElem:{id:e}}=rightStore;e===(r==null?void 0:r.id)&&((n=this.baseConfigRef)==null||n.setState(r))})}}const baseInfoStore=new BaseInfoStore,__vite_glob_0_54=Object.freeze(Object.defineProperty({__proto__:null,default:baseInfoStore},Symbol.toStringTag,{value:"Module"}));class GroupLayerController extends AbstractDesignerController{constructor(r,e,n){super(),this.container=r,this.config=e,this.instance=n}async create(r,e){}getConfig(){return this.config}update(r,e){}show(){var r;(r=this.instance)==null||r.setState({load:!0})}hide(){var r;(r=this.instance)==null||r.setState({load:!1})}}const __vite_glob_0_55=Object.freeze(Object.defineProperty({__proto__:null,default:GroupLayerController},Symbol.toStringTag,{value:"Module"})),BaseInfo$9=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49])));class GroupLayerDefinition extends AbstractDefinition{getBaseInfo(){return{compName:"",compKey:"group"}}getChartImg(){return null}getController(){return null}getInitConfig(){return{base:{id:"",name:"分组图层",type:"group"}}}getMenuList(){return[{icon:SettingOne,key:"base",name:"基础"}]}getMenuToConfigContentMap(){return{base:BaseInfo$9}}getActionList(){return[{name:"显示",id:"show",handler:r=>{r.show()}},{name:"隐藏",id:"hide",handler:r=>{r.hide()}}]}}const __vite_glob_0_56=Object.freeze(Object.defineProperty({__proto__:null,default:GroupLayerDefinition},Symbol.toStringTag,{value:"Module"})),BaseColorBlockComponent=React.forwardRef((a,r)=>{const[e,n]=reactExports.useState({...a}),o=reactExports.useRef({});reactExports.useImperativeHandle(r,()=>({updateConfig:c=>n({...c}),setEventHandler:c=>o.current=c}));const s=()=>{"click"in o.current&&o.current.click()},{style:l}=e;return jsxRuntimeExports.jsx("div",{style:{height:"100%",display:"flex",...l},onClick:s})});class BaseColorBlockController extends AbstractDesignerController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,BaseColorBlockComponent,e)}destroy(){this.instance=null,this.config=null}getConfig(){return this.config}update(r,e){var n;this.config=ObjectUtil.merge(this.config,r),e=e||{reRender:!0},e.reRender&&((n=this.instance)==null||n.updateConfig(this.config))}updateTheme(r){}registerEvent(){var e,n,o;const r=(n=(e=this.config)==null?void 0:e.base)==null?void 0:n.id;(o=this.instance)==null||o.setEventHandler({click:()=>BPExecutor.triggerComponentEvent(r,"click",this.config)})}}const __vite_glob_0_57=Object.freeze(Object.defineProperty({__proto__:null,BaseColorBlockController},Symbol.toStringTag,{value:"Module"})),baseColorBlockImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZoAAAEFCAIAAABVVLaiAAAF10lEQVR4Xu3UsaoWBADH0W/Oq7uDi+QNmuSCDermkCgOQoOJXpcKQeSCgpPQJkpDQ0GTTrb3iL3E9/9NB84znMP5kzPIPHxy54enP549fwBHd3jz8vTzpxNovPj4/dU/H1/+5xkcnc5I6YwdnZHSGTs6I6UzdnRGSmfs6IyUztjRGSmdsaMzUjpjR2ekdMaOzkjpjB2dkdIZOzojpTN2dEZKZ+zojJTO2NEZKZ2xozNSOmNHZ6R0xo7OSOmMHZ2R0hk7OiOlM3Z0Rkpn7OiMlM7Y0RkpnbGjM1I6Y0dnpHTGjs5I6YwdnZHSGTs6I6UzdnRGSmfs6IyUztjRGSmdsaMzUjpjR2ekdMaOzkjpjB2dkdIZOzojpTN2dEZKZ+zojJTO2NEZKZ2xozNSOmNHZ6R0xo7OSOmMHZ2R0hk7OiOlM3Z0Rkpn7OiMlM7Y0RkpnbGjM1I6Y0dnpHTGjs5I6YwdnZHSGTs6I6UzdnRGSmfs6IyUztjRGSmdsaMzUjpjR2ekdMaOzkjpjB2dkdIZOzojpTN2dEZKZ+zojJTO2NEZKZ2xozNSOmNHZ6R0xo7OSOmMHZ2R0hk7OiOlM3Z0Rkpn7OiMlM7Y0RkpnbGjM1I6Y0dnpHTGjs5I6YwdnZHSGTs6I6UzdnRGSmfs6IyUztjRGSmdsaMzUjpjR2ekdMaOzkjpjB2dkdIZOzojpTN2dEZKZ+zojJTO2NEZKZ2xozNSOmNHZ6R0xo7OSOmMHZ2R0hk7OiOlM3Z0Rkpn7OiMlM7Y0RkpnbGjM1I6Y0dnpHTGjs5I6YwdnZHSGTs6I6UzdnRGSmfs6IyUztjRGSmdsaMzUjpjR2ekdMaOzkjpjB2dkdIZOzojpTN2dEZKZ+zojJTO2NEZKZ2xozNSOmNHZ6R0xo7OSOmMHZ2R0hk7OiOlM3Z0Rkpn7OiMlM7Y0RkpnbGjM1I6Y0dnpHTGjs5I6YwdnZHSGTs6I6UzdnRGSmfs6IyUztjRGSmdsaMzUjpjR2ekdMbO4e356Zd3J9D45f3Nax9eXP7jFRzd4d39038fXYLGxfO7377+/eTibzi6w/v7N/579A003v50+/qvHy5dfIWj0xkpnbGjM1I6Y0dnpHTGjs5I6YwdnZHSGTs6I6UzdnRGSmfs6IyUztjRGSmdsaMzUjpjR2ekdMaOzkjpjB2dkdIZOzojpTN2dEZKZ+zojJTO2NEZKZ2xozNSOmNHZ6R0xo7OSOmMHZ2R0hk7OiOlM3Z0Rkpn7OiMlM7Y0RkpnbGjM1I6Y0dnpHTGjs5I6YwdnZHSGTs6I6UzdnRGSmfs6IyUztjRGSmdsaMzUjpjR2ekdMaOzkjpjB2dkdIZOzojpTN2dEZKZ+zojJTO2NEZKZ2xozNSOmNHZ6R0xo7OSOmMHZ2R0hk7OiOlM3Z0Rkpn7OiMlM7Y0RkpnbGjM1I6Y0dnpHTGjs5I6YwdnZHSGTs6I6UzdnRGSmfs6IyUztjRGSmdsaMzUjpjR2ekdMaOzkjpjB2dkdIZOzojpTN2dEZKZ+zojJTO2NEZKZ2xozNSOmNHZ6R0xo7OSOmMHZ2R0hk7OiOlM3Z0Rkpn7OiMlM7Y0RkpnbGjM1I6Y0dnpHTGjs5I6YwdnZHSGTs6I6UzdnRGSmfs6IyUztjRGSmdsaMzUjpjR2ekdMaOzkjpjB2dkdIZOzojpTN2dEZKZ+zojJTO2NEZKZ2xozNSOmNHZ6R0xo7OSOmMHZ2R0hk7OiOlM3Z0Rkpn7OiMlM7Y0RkpnbGjM1I6Y0dnpHTGjs5I6YwdnZHSGTs6I6UzdnRGSmfs6IyUztjRGSmdsaMzUjpjR2ekdMaOzkjpjB2dkdIZOzojpTN2dEZKZ+zojJTO2NEZKZ2xozNSOmNHZ6R0xo7OSOmMHZ2R0hk7OiOlM3Z0Rkpn7OiMlM7Y0RkpnbGjM1I6Y0dnpHTGjs5I6YwdnZHSGTs6I6UzdnRGSmfsHF7f++6ve1eg8dvDWzd+fnPl/BMc3f+ZJNyrpdScRwAAAABJRU5ErkJggg==",BaseColorBlockConfig=({controller:a})=>{var u;const{background:r,borderWidth:e,borderColor:n,borderStyle:o,borderRadius:s}=(u=a.getConfig())==null?void 0:u.style,l=f=>{const{dataFragment:d}=f;a.update(d)},c={key:"style",type:"grid",config:{columns:2},children:[{key:"background",type:"color-picker",label:"背景色",value:r,config:{showText:!0}},{key:"borderWidth",type:"number-input",label:"边框宽",value:e,config:{min:0,max:10,step:1}},{key:"borderColor",type:"color-picker",label:"边框色",value:n,config:{showText:!0}},{key:"borderStyle",type:"select",label:"样式",value:o,config:{options:[{label:"实线",value:"solid"},{label:"虚线",value:"dashed"},{label:"点线",value:"dotted"},{label:"双线",value:"double"},{label:"3D凹槽",value:"groove"},{label:"3D垄状",value:"ridge"},{label:"3D内嵌",value:"inset"},{label:"3D外嵌",value:"outset"},{label:"无边框",value:"none"}]}},{key:"borderRadius",type:"number-input",label:"圆角",value:s,config:{min:0}}]};return jsxRuntimeExports.jsx(LCGUI,{schema:c,onFieldChange:l})},BaseInfo$8=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),ThemeConfig$2=React.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),AnimationConfig$4=React.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),FilterConfig$8=React.lazy(()=>__vitePreload(()=>import("./FilterConfig-NGULEsf_.js"),__vite__mapDeps([52,1,2,6,7,8,9,10,11,12,5,13,14,15,16,53])));class BaseColorBlockDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"基础色块",compKey:"BaseColorBlock",categorize:"ornament"}}getChartImg(){return baseColorBlockImg}getController(){return BaseColorBlockController}getInitConfig(){return{base:{id:"",name:"基础色块",type:"BaseColorBlock"},style:{background:"#009DFF33",borderRadius:0,borderWidth:0,borderColor:"#74747400",borderStyle:"none"},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0}}}getMenuList(){return super.getMenuList().filter(r=>r.key!=="theme"&&r.key!=="data"&&r.key!=="mapping")}getMenuToConfigContentMap(){return{base:BaseInfo$8,style:BaseColorBlockConfig,animation:AnimationConfig$4,theme:ThemeConfig$2,filter:FilterConfig$8}}getEventList(){return super.getEventList().concat([{id:"click",name:"点击时"}])}}const __vite_glob_0_58=Object.freeze(Object.defineProperty({__proto__:null,default:BaseColorBlockDefinition},Symbol.toStringTag,{value:"Module"}));class BaseIframeComponent extends reactExports.Component{constructor(e){super(e);U(this,"eventHandlerMap",{});U(this,"onLoad",()=>{"load"in this.eventHandlerMap&&this.eventHandlerMap.load()});this.state={...e}}render(){const{src:e}=this.state.style;return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:e===""?jsxRuntimeExports.jsx("div",{style:{color:"#9a9a9a",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:jsxRuntimeExports.jsx("div",{children:"请设置iframe地址"})}):jsxRuntimeExports.jsx("div",{style:{height:"100%",display:"flex"},children:jsxRuntimeExports.jsx("iframe",{title:"lc标准iframe组件",src:e,onLoad:this.onLoad,style:{width:"100%",height:"100%",border:"none"}})})})}}class BaseIframeController extends AbstractDesignerController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,BaseIframeComponent,e)}destroy(){this.instance=null,this.config=null}getConfig(){return this.config}update(r,e){var n;this.config=ObjectUtil.merge(this.config,r),e=e||{reRender:!0},e.reRender&&((n=this.instance)==null||n.setState(this.config))}registerEvent(){var r,e;if(this.instance){const n=(e=(r=this.config)==null?void 0:r.base)==null?void 0:e.id;this.instance.eventHandlerMap={load:()=>BPExecutor.triggerComponentEvent(n,"load",this.config)}}}}const __vite_glob_0_59=Object.freeze(Object.defineProperty({__proto__:null,BaseIframeController},Symbol.toStringTag,{value:"Module"})),baseIframeImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPwAAACeCAIAAACZ9fBhAAAHQElEQVR4Xu3b72vaeADH8ftDfBDoYMjtZMhYB9mDHsi4spWjlrPggzA492BgjvrEHpajUB8YaPZAhqVIwYKF/ptnYn4ZbZvUbov7vF9PRk1M7HwnfvM1/eUlIOaXFy9elAAlRA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RA85RJ+BUakdWtZhrWKkl2ATEf2DjPp/09u5c6ucXloy3jQ6g9EkWGU6/Gym10DBaEf/2h7dXXPItC+C5m8vO6miK83+JFw4Nz4i+qKTjr52PC92enpw38ClctAb39ze3ox7B5XFJXu96yh2t9u2WkeO0yb6ohOO3qifzsckV91aelk2bzvjIHn3nk8KFI1u9OWP7jzYUXs7vSyjKPqlYQ+KTDb6bfvr2idpot9Mmx298XzHOhud/pV+/GHvuuFwvn7fcN5nHgVtRxep0SNLnKa/QnOQ+NnYbp6N/JHUyA4PDuPVbuvYHV2Fsz6zV3I57H1amhVdPK4M0+p/DZ4yHbudP8PVt0zrZDieL7iZjgb23svVv5ZhJuea/J1a5upVV3pru+ed+qsczyigjY3ef5vn4Qah5RFewk6679KLlq0XfaU5iMIed976iw/64SNp00Fz4WI5Ef1e04k2FJrOtl/6relE19OR634j/Qlm1I6CyaoUb6cZMw5fz/ju46r4NjD6LbNx7MYThRO39Ta9ygOiS9ivdpbh/HL05Z2GNdN2gpcxcWzv55ndqr9CHP1psCtfGH3Tmf0wvfAmfBrvTfN9wz6ZfxR43I+JWqPop1NvhUun88myj11vNil43HG+eP+OB52WZXe/xEfj5Hjh+tz8Jyz+Ztxv12tVc9fqDsOjZfRPtgFatXF6Ge5gttOzVm0D09+o6Leq9SN3Er3fV273MM9Hcyi6hF3I627L0QfuHtNH0XsmTmvn2cLrPLC70cgkYOz+Gx7Ig2a8KJ4gur0d2tvhAuOPXvL7AfdTtLXEdi6iwVSp9PrzMHh01Pk9sef4cSex1/sZlXet/kU8LhudWTvPsz65CDYk+lTul469X33sf3N4CZtlOO9bL/rh59eLy+4SdZzcWhz9pPdHYuVSNao1PeUaHw/xuC/6FSYne6mDzf/U8fTzXRoZz3asRPqT4YllbqVXKqbCR29U9tpO/Gl+2W+9yzr+XC28hE19+t9jreiTp+1Fxq+1utXq/Nfvn48mV4lB0Oro01cu0S4m/+4uLCi3gg+y+Cnllj8E8g70/YV1S/f8dpl46feCa6tbb6x53Ch++kWPPr5kvHY+r5m7JxrOj+yMJ+B7ssgQffopPuNloxefI5esjD7HLqJzdxS92UkMxO+ytJ0cDLN5Gv1Gg/wTC99X0aMv73fj88h01P+0W13nRFK2grPgfTfbpK0Tffr8PFNu9KPJlqth/6hlHe6a1cqz31dtLcMu0q/qO0c/O9cfdpxo+zdj5+OjtvMdFT16n2Eedt2r6N2ZDR8fOWmw3Z7PYDxws03K00YfDcb96caEbxl9eM/cpLdfvUsl78Xoltk4cuJZJ++UtPQ9QyFtRPRzRnXfjs8oXvs9KzUr8oBad37k5LzZ5mmjjxa5fy982JT/DofiTx99Kbo7+vH3XCQYr+r2IK7dn0bL9078WBsU/Vzqysn7H884T28chMP5nG/8N4p+YSIl+QXTN4i+9KEXNDp1W2/WyLNcX7gaWWsa7YfZuOgDhtnongfpL4e1Stk6n6+e+2abp40+Mdc4HZ34X2q1/aP42v/6KbW1DLtIv6qV0ZeSXwxPR943WaF21xmOhxm/nApfz/Ri7Wm0H2dTo5/z7mDJeO9N+PcimWfnY08bfcnY6UR/lRK5dpofVm0twy7Sr2p19N5+w3vsVljayB28e2+6jcd8JVggmx19drlutkl54uhL/o1DZ+FdX9H9YSu3tvJBX+7oPYZ52HHCW9Y808nkq9tt14s/uf6ENKLPebMNfm4S0ee92QY/N4Xoc99sg5+bQvTAAqKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHHKKHnP8B1pcLr7NqN7oAAAAASUVORK5CYII=",BaseIframeStyleConfig=({controller:a})=>{var o;const{src:r}=(o=a.getConfig())==null?void 0:o.style,e=s=>{const{dataFragment:l}=s;a.update(l)},n={key:"style",type:"grid",children:[{key:"src",type:"input",label:"地址",value:r}]};return jsxRuntimeExports.jsx(LCGUI,{schema:n,onFieldChange:e})},BaseInfo$7=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),FilterConfig$7=React.lazy(()=>__vitePreload(()=>import("./FilterConfig-NGULEsf_.js"),__vite__mapDeps([52,1,2,6,7,8,9,10,11,12,5,13,14,15,16,53])));class BaseIframeDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"基础iframe",compKey:"BaseIframe",categorize:"web"}}getChartImg(){return baseIframeImg}getController(){return BaseIframeController}getInitConfig(){return{base:{id:"",name:"基础iframe",type:"BaseIframe"},style:{src:""}}}getMenuList(){return super.getMenuList().filter(r=>r.key!=="data"&&r.key!=="theme")}getMenuToConfigContentMap(){return{base:BaseInfo$7,style:BaseIframeStyleConfig,filter:FilterConfig$7}}getEventList(){return super.getEventList().concat([{id:"load",name:"iframe加载完成时"}])}}const __vite_glob_0_60=Object.freeze(Object.defineProperty({__proto__:null,default:BaseIframeDefinition},Symbol.toStringTag,{value:"Module"}));class BaseImageComponent extends reactExports.Component{constructor(e){super(e);U(this,"eventHandlerMap",{});U(this,"onClick",()=>{"click"in this.eventHandlerMap&&this.eventHandlerMap.click()});this.state={...e}}render(){const{type:e,onLineUrl:n,localUrl:o,opacity:s}=this.state,l=e==="online"?n:o;return jsxRuntimeExports.jsx("div",{style:{width:"100%",height:"100%"},onClick:this.onClick,children:l?jsxRuntimeExports.jsx("img",{alt:"图片组件",style:{opacity:s},width:"100%",height:"100%",src:l}):jsxRuntimeExports.jsx("div",{style:{color:"#9a9a9a",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:jsxRuntimeExports.jsx("div",{children:"请配置图片连接或上传图片"})})})}}class BaseImageController extends AbstractDesignerController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,BaseImageComponent,e.style)}destroy(){this.instance=null,this.config=null}getConfig(){return this.config}update(r,e){var n,o;this.config=ObjectUtil.merge(this.config,r),e=e||{reRender:!0},e.reRender&&((o=this.instance)==null||o.setState((n=this.config)==null?void 0:n.style))}updateTheme(r){}registerEvent(){var r,e;if(this.instance){const n=(e=(r=this.config)==null?void 0:r.base)==null?void 0:e.id;this.instance.eventHandlerMap={click:()=>BPExecutor.triggerComponentEvent(n,"click",this.config)}}}}const __vite_glob_0_61=Object.freeze(Object.defineProperty({__proto__:null,default:BaseImageController},Symbol.toStringTag,{value:"Module"}));class AbstractConvert{}class BaseImageConvert extends AbstractConvert{getKey(){return"BaseImage"}convert(r){}async convertBack(r){const{hash:e,type:n}=r.style;if(n==="local"){const o=await imageSourceCache.getCache(e);if(!o)return;r.style.localUrl=o.url}}}const __vite_glob_0_62=Object.freeze(Object.defineProperty({__proto__:null,default:BaseImageConvert},Symbol.toStringTag,{value:"Module"})),baseImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZoAAAEFCAIAAABVVLaiAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAy4SURBVHic7d29b1vnFQfgm7ZoFl4CRVogIggUTRER4Cho0JTAQ40CdjVpCJAtf1i2ABk8Gc6iRXAmDYI6tCBAeSWozKSWZOrwmteqRF5RFHk/jp9nMCSTpq9E6Kdz3o/7ftL7Yj8DaL/f1X0BANshzoAgxBkQhDgDghBnQBDiDAhCnAFBiDMgCHEGBCHOgCDEGRCEOAOCEGdAEOIMCEKcAUGIMyAIcQYEIc6AIMQZEIQ4A4IQZ0AQ4gwIQpwBQYgzIAhxBgQhzoAgxBkQhDgDghBnQBDiDAhCnAFBiDMgCHEGBCHOgCDEGRCEOAOCEGdAEOIMCEKcAUGIMyAIcQYEIc6AIMQZEIQ4A4IQZ0AQ4gwIQpwBQYgzIAhxBgTxh7ovgP/TzTtZlg0H++mDbp4v/j6v87I+SrP5PP05mf6y+OC67ouijOoMCOKT3hf7dV8D2dHhQXarKKOZZvObLMtG46vzi8u6r4UlxFmd+r29LMueP/tairVLyrXTs7faz0bRbAJBqM5qMxzsP3/2Vd1XweZm85vR+CrLMr1nQ5jZrEFKseHAL5J26+adNOiZSbRm0GwCQajOqjYc7K9Tl6XBZmud6tLNO2mtX5quKadGawhxVp3FPGbZeFkKr1evf6romlhDsba5iK370q+oyfTar58aaTaBIMxsVufk+EW2onmxjqkVUgl2dHiwap3gbH7z/Q8/VntRfKDZrMhwsF8yCuNnoBXSsozJdHpy/DJbNKG3dfNOirz0TCqm2QSC+H3+p8/qvoaPwr/++Y9PP/3j0odevf4pNZu0wq+//fbrb79Nptd//9tf7z/6lz9/1u/t/fs//63+wtBsVmTpaEsaKTNe1jqpl+z3Pr+/5ia90f3enre1eppNIAjV2c6VLJo9PXtb5ZWwXecXl6veXNVZLcTZzvV7n696yJBZq5W8fe74VAvNJhCEOKuNpUkBrNrV5GyHWmg2d67f69V9CexKyrL7C6TFWS1UZ0AQ4qw25gFguzSbMRX3tEmf9nt7Rftz5/jIyXQqWIlBdQYEoToLJRVlR4cHJWt3F0ui9ornuD0RMYizOI4OD0pul1oiBdzJ8Yu0duT07OctXxlUQrMJBKE6a71u3nn+7OtsvUM6yqX2s9/rvXr9JjP3StuIsxZLTeJ3336z9ZdNd1t99fqNRKNFNJtAEKqzFks9Zrn753WmnrS8M11MDrx0iAEtIs7a6vmzr0oiaZ21F0VmrbqbTTfvpFNBzXXSCppNIAjVWfvc2cB032h8tU49lSq4V6/fFMdH3n/O4pi1d1bY0nzirH1K1sqm0HlUbzib35xfXJa/8tHhwavXPz3mGqEGmk0gCNVZ+6xqM2fzm6fUUKPx1apJTzcjpBVUZy1TMmRW9Iybmc1vTs/eLj1cqpt3+r29p+86gJ0SZ0AQms2WKTnxbDKdPvHFS7Y0DQdfZg5sp9lUZy1TEmfb2l+56mgiI2g0nDgDgtBsRrDdIzsn02uj/rSROGuZpR3fdtvAkn4WmkyzCQShOmuZpZ3gdquzpce2p+PsuE0Z2zTiLIL0c9XNO1uZ3PzIf0qLL79Ysbz49uaLT/OP/FvUWJpNIAjVWcuMxler7nsxHOw/cZ9TyQ6qdGR6MN28k2quYguXyqvVxFnLzOY3aZnr/RG04WA/PbTZ2v3i3rNLbXctSF2KW8Wtc4dxWkezCQShOmuf0fhdtvw2Pu8P3NzsvJKSg1RaXZoVjeRmR8TTIuKsfdJW89n85v4oT3Hy5vrn/q5z6vATh+QqVnSU8utjo9kEglCdtU+quc4vLleN3BfHmI/GV6smB7p5p+TEk0Kqy5p/Fnrx5QwH+9udmpzNb9IS4tl8XnwfitNL032TSmaEqZI4a6vR+Cr93C7NozsPFT+T2WOm8ybT64a3mWuG8oOK70+R+5Pp9ToTxOZGG0WzCQShOmuxNOG4zl38u3nnUS3Y4gjOhh5G9/SiLH2BJc04bSTOWiz9TJ6evd1Kw1WYTK+bGWQbp5jw+khoNoEgVGetd/sY81S8bDa1N5vfpO61gcP/qRzbuChr4FfELoizOM4vLlMePWpPYpNTLOXyyfHL9QO6+HJG46vmry9huzSbQBCqs1CKFbbp027eSbeWvT2zWdQsqYppYAmzwS6lJteYVEacRVb8kLdIv7d3cvxizSdLMW7TbAJBqM5oivWnLxVlLCXOqFkaKXv+7Ot15mFTfkkxltJsAkGozqjTmgP/xXYu+5MoIc6oxzojZZb18yiaTSAI1Rk1ODl+8eDAf2Nv7EFjiTOqs84xK5npSzal2QSCUJ1RhXUWl5m+5InEGTvXzTvffftN+XNm85v1zwaFpTSbQBCqM3YotZblC2VTa2kSk6cTZ+xKN+88uOJ/NL46Pfu5mushPM0mEITqjO0r7vFf8hyLy9g6ccb2pbWyJeeVnJ793Lrb5NJ8mk0gCNUZW1a+HzPNYFooyy6IM7YmzWOWZNn5xaUgY3c0m0AQqjO24+jwoKQuc1IJFRBnPFVKsZL7yk6m19bKUgHNJhCE6ownKd/JZD8mVRJnPElaMbvUbH4jyKiSZhMIQnXGhtLYf8ls5unZ2wovB8QZG+n39kqmMi39pxaaTSAI1RmbKF9lpi6jFuKMxxkO9rMVQ2bp1BKzmdRFswkEoTprn3RbxG6eLz7N7zxhNp/P5vNsB4e8dfPO82dfrXrUVCb1EmdNl9q6fm+v+GD9f1vE2WQ6nUx/yRZbwTdWsmh2NL4yZEa9NJtAEKqzJurmnTTiXjKBuObrpA+Gg/3iBVMfOpleP+p2PQ/Whu6ZQe3EWYMcHR6k0Ck5NOSJunknvXi/t5f+r9H4ap1ce3DRLNROswkEoTqrXzfvpCH2Rw3zb+X/zW6VhCVl2nCwv+raLJqlOcRZbbp5J3VwTxwgyxYzmBu3qHdy7dXrN3dWeAwHX676t+6XTXNoNoEgVGe1SaXQ+lLFVCzvms3n91fJFgVaWlvbzfN+7/P1/6/0z0+OXxYnlZRsaUrP0WnSHOKs0c4vLosUW+f5RcAtPri+c4RSsWKjpDMtuuDyENRm0jSaTSAI1VkTTabXaf/jtjZdFq9zfnGZ6rXhYP/BKYiSCm40vtr6hlB4InHWIFtPsaXSiz8q1+7TadJAmk0gCNVZI6Rip+KS506ZdnL8cp2Va+nJOk0aSJzVKYXC6dnbepc7LO4i+2adCc3R+F1FlwWPpNkEglCd1WY2v/n+hx/rvooPZvOb1O3O5jerJgfs0KTJxFltnnhj2F1IXWfJuJhOkybTbAJBiDPuSts8l2pgRQkFzSZ3LZ3ZFGQ0n+oMCEJ1xgclK87SuXbQZOKMD4ya0WqaTSAI1Rkf9Hu9pX+vNKMVxBnv9Xt7q7agGzijFTSbQBDijPfSaSlLTabTKq8ENqPZ5L2l05qLU6Pc3YwWUJ0BQajOeG/ptOZsPq/+SmAz4oz3lk5rmtOkRTSbQBCqM8q3aprTpDXEGSu3as7mN+Y0aRHNJhCEOGMlnSbtotlk5c5zaBfVGRCE6ozlK84yi85oG9UZK9kSQLuIMyAIzebOpRpnVUNXu35vb9VDqrMHrXpbfetqoTqrTUmOVKnkNmfW0G5MnNVCnAFBaDZ3bvGL+m4tVlIWVWlpu6QuW5Mle42iOtu5yfSXpSseunmn39trSMvJZrp5x42VmkOcAUFoNneuZOfjcPBltrgff6MYyV7HyfGLVQ/Z7loLcbZzaRxqMr2+31emG41Npr/UeC5vY1eQNFl6K5cOFDgspkaaTSAI1VlFRuN3q0b9jw4PUm/SnF/pms0S3bxT0maOxu+qvBhuE2cVGY2v0kjZ/VDr5p2T45fpOecXlzVcHOtJ713pkNl1jeMGaDaBIFRn1UmV19Lf7Wk8/ujwIH0wGr+rbLqzIat5myy9Kc+fff3gIkHFdb0+6X2x8hQfdmE42H/+7KsHn5bG0WbzeRrG2t2w2tKlvClMG7iCpEol05f3nZ79nGWZTrNemk0gCNVZDY4OD4o/CWA0vkrVGfUydlaDYoRForWdHrNRNJtAEJrNOq0/ZUajpJmZ07O3H/lsSdOIs0ZImzeHgy/lWpOlFLPaubE0m0AQqrNmSe1nv9fr9z7Pbq1xtdi1eosVf/NUlKnImk+cAUFoNoEgxBkQhDgDghBnQBDiDAhCnAFBiDMgCHEGBCHOgCDEGRCEOAOCEGdAEOIMCEKcAUGIMyAIcQYEIc6AIMQZEIQ4A4IQZ0AQ4gwIQpwBQYgzIAhxBgQhzoAgxBkQhDgDghBnQBDiDAhCnAFBiDMgCHEGBCHOgCDEGRCEOAOCEGdAEOIMCEKcAUGIMyAIcQYEIc6AIMQZEMT/AEj3mqGP6JRpAAAAAElFTkSuQmCC",BaseImageStyleConfig=({controller:a})=>{const{style:r}=a.getConfig(),{type:e,onLineUrl:n,localUrl:o,opacity:s}=r,[,l]=reactExports.useState(0),c=f=>{const{id:d,data:g,dataFragment:p,reRender:v}=f;if(d==="localUrl"){const{hash:m,url:y}=g;a.update({style:{localUrl:y,hash:m}})}else a.update(p);v&&l(m=>m+1)},u={key:"style",type:"grid",config:{columns:2},children:[{key:"type",type:"radio",label:"来源",value:e,reRender:!0,config:{options:[{label:"本地",value:"local"},{label:"在线",value:"online"}],containerStyle:{gridColumn:"1/3"}}},{key:"onLineUrl",rules:"{type} === 'online'",type:"input",label:"链接",value:n,config:{containerStyle:{gridColumn:"1/3"}}},{id:"localUrl",key:"localUrl",rules:"{type} === 'local'",type:"image-upload",label:"上传",value:o,config:{accept:"image/*",size:3,containerStyle:{gridColumn:"1/3"}}},{key:"opacity",type:"number-input",label:"透明度",value:s,config:{min:0,max:1,step:.1}}]};return jsxRuntimeExports.jsx(LCGUI,{schema:u,onFieldChange:c})},BaseInfo$6=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),FilterConfig$6=React.lazy(()=>__vitePreload(()=>import("./FilterConfig-NGULEsf_.js"),__vite__mapDeps([52,1,2,6,7,8,9,10,11,12,5,13,14,15,16,53])));class BaseImageDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"基础图片",compKey:"BaseImage",categorize:"media"}}getChartImg(){return baseImage}getController(){return BaseImageController}getInitConfig(){return{base:{id:"",name:"基础图片",type:"BaseImage"},style:{type:"online",localUrl:"",onLineUrl:"",opacity:1},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0}}}getMenuList(){return super.getMenuList().filter(r=>r.key!=="theme"&&r.key!=="data")}getMenuToConfigContentMap(){return{base:BaseInfo$6,style:BaseImageStyleConfig,filter:FilterConfig$6}}getEventList(){return super.getEventList().concat([{id:"click",name:"点击时"}])}}const __vite_glob_0_63=Object.freeze(Object.defineProperty({__proto__:null,default:BaseImageDefinition},Symbol.toStringTag,{value:"Module"})),BaseTableComponent=reactExports.forwardRef((a,r)=>{const[e,n]=reactExports.useState({...a}),o=reactExports.useRef(null),s=reactExports.useRef(null),l=reactExports.useRef(null),c=reactExports.useRef(null),u=reactExports.useRef(null),f=reactExports.useRef({}),d=reactExports.useRef(0);reactExports.useImperativeHandle(r,()=>({updateConfig:C=>n({...C}),setEventHandler:C=>f.current=C,destroy:p}));const g=()=>{"click"in f.current&&f.current.click()},p=()=>{var C;o&&(o.current=null),s&&(s.current=null),l&&(l.current=null),c&&(c.current=null),u&&((C=u.current)==null||C.disconnect()),u.current=null},v=()=>{var L;const{pageSize:C=0}=e.style.body;if(C){const R=((L=o.current)==null?void 0:L.getElementsByClassName("base-table-tr"))||[],I=d.current/C;for(let w=0;w<R.length;w++)R[w].style.height=`${I}px`}};reactExports.useEffect(()=>{o.current&&(d.current=o.current.clientHeight-s.current.clientHeight,u.current=new ResizeObserver(lodashExports.debounce(C=>{for(const L of C){const{height:R}=L.contentRect;d.current=R-s.current.clientHeight,l.current&&(l.current.style.height=`${d.current}px`),c.current&&(c.current.style.height=`${d.current}px`)}v()},100)),u.current.observe(o.current),v())},[]);const{columns:m,data:y,header:x,body:_}=e.style,{enableCarousel:E,carouselSpeed:S=3,pageSize:A,...T}=_,b=E?`scroll ${S}s linear infinite`:"none";return A&&v(),jsxRuntimeExports.jsx("div",{className:"base-table",ref:o,onClick:g,children:jsxRuntimeExports.jsxs("table",{children:[jsxRuntimeExports.jsx("thead",{style:{...x},ref:s,children:jsxRuntimeExports.jsx("tr",{children:m&&m.map((C,L)=>jsxRuntimeExports.jsx("th",{style:{width:C.width,fontWeight:x==null?void 0:x.fontWeight,textAlign:C.textAlign},children:C.label},L))})}),jsxRuntimeExports.jsx("tbody",{style:{...T,animation:b},className:"scroll-body",ref:l,children:y&&y.map((C,L)=>jsxRuntimeExports.jsx("tr",{className:"base-table-tr",children:m&&m.map((R,I)=>jsxRuntimeExports.jsx("td",{style:{textAlign:R.textAlign},children:C[R.key]},I))},L))}),jsxRuntimeExports.jsx("tbody",{style:{...T,animation:b},className:"scroll-body",ref:c,children:y&&y.map((C,L)=>jsxRuntimeExports.jsx("tr",{className:"base-table-tr",children:m&&m.map((R,I)=>jsxRuntimeExports.jsx("td",{style:{textAlign:R.textAlign},children:C[R.key]},I))},L))})]})})});class BaseTableController extends AbstractDesignerController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,BaseTableComponent,e)}destroy(){var r;(r=this.instance)==null||r.destroy(),this.instance=null,this.config=null}getConfig(){return this.config}changeData(r){var e;this.config=ObjectUtil.merge(this.config,{style:{data:r},data:{staticData:r}}),(e=this.instance)==null||e.updateConfig(this.config)}update(r,e){var n;this.config=ObjectUtil.merge(this.config,r),e=e||{reRender:!0},e.reRender&&((n=this.instance)==null||n.updateConfig(this.config))}}const __vite_glob_0_64=Object.freeze(Object.defineProperty({__proto__:null,BaseTableController},Symbol.toStringTag,{value:"Module"})),baseTableImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAI8AAABZCAIAAACIZuD2AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEXRFWHRTb2Z0d2FyZQBTbmlwYXN0ZV0Xzt0AAAi1SURBVHic7Z1bUFP5Hcd/hhPMyeWQeIAkco1glPtFUEFwNax4ic5sdHULebBTnc507E6nXV+6sy/t6OPah9pxH9idMg5k2B1Fq1Anu6Zd2PVYZdEoBD3LAhIxCRgJIXCAnGb7gBdqO3U4YXLyn/4/b2EOv/lOPjn/c/vN76xKqXh7wvxbiA+kk4/DmnSxU7xCOuUNJ+nETvGc1L/8ngAAWLVK7CRLiKswEF95JGIHwCwDbAslsC2UwLZQghD6j9oLh1WHvhj9YLveoFfdaOtrBQBKf+FoJgxOegBg0v/Lm/6Vy/kGDh4qP8mHehcWP3Gdf41U1yWp5b4WZtq8t1B2vffkk5hlgcZdufDlpL46qTpDcqhtEABOHCjdp4xA4kInMzUXUuQVDJ78UkhlgbZMNfoyndRlVXp0inJCcuhXldXME82GlMnbD47fDJ+wbNxH+oRVFkKm8RiMVV/2Nb5XWN7WdxIAko0frE30zskM2SllQX+gNreqbZCJTZjcLFOyJt+qlKmlagI6GooHBu6BEm7cHoOqNEMWbfDNDQutLdCWI7DAuCYhW8N9/e2dnMLetj5Hvrb6MqvZW+TZNN/ytz6za0FopGWjIyaGZcbrDVoyVSFrKO6Ym/rYOd35KKIH8pCB61xQ5N2fM5UD0xuTNFmr9cHJC7xEdmWqfK9qcd/aRywcK5Jd+N5/R6U5FkVtoSuhDHTpdOCJH9YXl6cqqhvy62Yl2TvX5fNc77NIXkm+qyyY3zIURbDlMAsyybzjH2NQlWG4PXYRgNNr9Clyk4yYjATyQrzhLcpzLkZZ4DrbsisXJiJWc1peakJHQ/4NZtSrSjSkJplTEz1DfDS1hZ5lsJ6ByGqDkj9lu+fwTp+1uY5d7qtjp28wd822e2abZ4CP6fnLRcZ959/+ICmTTP3paQIsEHq1bG5w+HQs0wDA3UGzbeyOd9Jsc50eCXVw/MB9V0eAh0f+zqfCqwo9bm1KCXzNlK/J7WgoliVK8hryDYzrNA/69cazaQBA6GFOeKhl4vVOdgIAgLpISw76OwFgNpGhVGXKfwaesSd8xlPJ4ZiFAQDgI+W7i61rQJYo6WgoDrg5SJvtDRQf40MfyRUf79S4hB5CV6VUvD2x/8MVDSsc6TN3eE2G2CleIQ14wmq92Cmek3r5d/h6CyWwLZTAtlAC20IJAgDIke/EjvGcyGpF/IQBgEiinAzE8J7Vm1iVnh5Hz2ox/xu8EqIEtoUS2BZKYFsogW2hBLaFEtgWSmBbKCHw+Ra92bJ/Ax0e7Ye1ZKutq6Cm9KkzaKzKJl9uMTvCfMNOr1DK5UCQSuBCPKGkaXLWP8FF9bA2KgyWX+ynQkFKTQUDQUoZvHquXXBHxiICbfmdX117tGOPiQwTugM/Pz5/ramfk/LOqVflIkEuumSCMB742TvruS/O2NKtP4FrwxusgaZm8e5kkTIphECaKAUAqYx84/ZvROhKuG1vHX2r60GSLpmaHx2CjVVGkqDXl7zEqCHE+FGzVz7r8QIAuDzzG+qywkNR/phXgvDCij25FrhvkVNh+aYjlT9c9XoLQaMYsNndQJAPnVMv7PMzYuxaL8muywy0N31b3bhNC1di2Cu3FJXU3d9HQiaVNOLxzXt8vtmoSwrct7jv2pvsj8MyAEI1Nk69855RpkyilhQjFEmk4M7S6PF7IGt3/a40mIhdB+rrTLPddscYDSOXrtjt9u/pgoKoSwq9B280Ha1JZi89TN4lv3WJ4XMKUn5ck5mxdGnmRphuUU4z4oU1pqPvJg/ZL3YHSy3mAjrEtrUzUX4f+IkJSuDrLZTAtlAC20IJbAslsC2UwLZQAttCCWwLJbAtlMC2UALbQglsCyWwLZTAtlAC20IJbAslhD6NJ0iapgjI2LwZbt1yQyTol1RYD5dSr7Z47Djb3r8iGZcVK4WWc35/XHSoAQCozMcPDDS1rtCclwSKot681X8ikcrp3J3m7QZdVq56ZtTtDSq25IU/dUhyw3/nEsKfOiTl6X33Y91xpC0qTQ6l7j5ouC/fbKEnNLsPJPU4PTEO8QKj6ei+7TUb0ySUoaCisrKkSD3rHI6uTUTgSkhutRwuI/s7r153XO14CKX1lioKAIAK8+K1rQD4nD0u/+wMx2UaCB8zfI0NGw2ihWEdzZeeeR80f3K+uWsm+PDPzQ422pJCe56+af2kvbv/sQfSK6rSgl3nW7uDINVativd/TPTVNnxKnFmB9O11iNyx8WexU8E8HPRt4VFkWZbtm6eJFNMdYnuFZngJnAlVBlrd2zamJNTtDVPOTr+49qctQlzSTqivfnCKD/D9jC9IUORJvYrYY31XaVnSq1L+OHZ2h3V2YU6vrubDcY4xCu4wd4+ct+Jo0ZuqG94aIKLRFswmp6nisaP9uv6m88sdndnW47Xzoy+6LRU5CR7z7XGaCRgfFJkeX+L9G7XFYblIKXiYD3FtDjc0ZXEHWooga+3UALbQglsCyWwLZTAtlAC20IJbAslsC2UwLZQAttCCWwLJbAtlMC2UALbQglsCyWwLZTAtlBCaD+hylj72ny78fSDWzJgtVQ6Hw4DALiZ89E3+SyXJf2Eai0Nfl9AxHbCuJl4B9Nst50FMP3m13DmDw4AAGCbWTA1NA7bWkUbXKYtKKC90q1W4rMubiP4dXuO3G3+fESsNCs/8U74O1lL6ku0kEmpoL6egAmnfaLk/Z9WZyjksznreInc+9WHTTeij7dMfM4eH1FSxElhuOcm0HsqOVEnuS0i/sQ7AP+Q0+mF1YVF4HQ6Yd4PAfsfT3GNDb5WGwvrGhuzVyrhsqBrrbt5++cMEEazdcNwi1jT7gDiaeIdAD/t8/l8MxCZ8fl8zw8P2mR+PFZv9vyv1Fgq+aeqsipj/kFTmmc+3VQi4ovp4mfi3WsnGQDc+DikpuKJd0vAE+/+z8HXWyiBbaEEtoUS2BZKYFsogW2hBLaFEtgWSvwLmSM+VkgCs7QAAAAASUVORK5CYII=",BaseTableStyleConfig=({controller:a})=>{var c;const{columns:r,header:e,body:n}=((c=a.getConfig())==null?void 0:c.style)||{},[,o]=React.useState(0),s={key:"style",children:[{key:"header",type:"accordion",label:"表头",children:[{type:"grid",config:{columns:2},children:[{key:"height",type:"number-input",label:"高度",value:e==null?void 0:e.height,config:{min:0}},{key:"background",type:"color-picker",label:"背景",value:e==null?void 0:e.background,config:{showText:!0}},{key:"color",type:"color-picker",label:"字色",value:e==null?void 0:e.color,config:{showText:!0}},{key:"fontSize",type:"number-input",label:"字号",value:e==null?void 0:e.fontSize,config:{min:0}},{key:"fontWeight",type:"number-input",label:"加粗",value:e==null?void 0:e.fontWeight,config:{min:0,max:900,step:100}}]}]},{key:"body",type:"accordion",label:"表体",children:[{type:"grid",config:{columns:2},children:[{key:"background",type:"color-picker",label:"背景",value:n==null?void 0:n.background,config:{showText:!0}},{key:"color",type:"color-picker",label:"字色",value:n==null?void 0:n.color,config:{showText:!0}},{key:"fontSize",type:"number-input",label:"字号",value:n==null?void 0:n.fontSize,config:{min:0}},{key:"fontWeight",type:"number-input",label:"加粗",value:n==null?void 0:n.fontWeight,config:{min:0,max:900,step:100}},{type:"switch",label:"轮播",key:"enableCarousel",reRender:!0,value:n==null?void 0:n.enableCarousel},{rules:"{enableCarousel}==='true'",type:"number-input",label:"速度",key:"carouselSpeed",value:n==null?void 0:n.carouselSpeed,config:{min:0,max:100,step:.1}},{type:"number-input",label:"页行数",key:"pageSize",value:n==null?void 0:n.pageSize,config:{min:0,max:100}}]}]},{key:"columns",type:"control-group",label:"表格列",value:r,config:{itemName:"列",template:{type:"grid",config:{columns:2},children:[{key:"key",type:"input",label:"列字段名",value:"newColumn"},{key:"width",type:"number-input",label:"列宽",config:{min:0}},{key:"label",type:"input",label:"列显示名",value:"新建字段"},{key:"textAlign",type:"select",label:"对齐",value:"center",config:{options:[{label:"左对齐",value:"left"},{label:"居中",value:"center"},{label:"右对齐",value:"right"}]}}]}}}]},l=u=>{const{dataFragment:f,reRender:d}=u;a.update(f),d&&o(g=>g+1)};return jsxRuntimeExports.jsx(LCGUI,{schema:s,onFieldChange:l})};class BaseTableDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"基础表格",compKey:"LcBaseTable",categorize:"web"}}getChartImg(){return baseTableImg}getController(){return BaseTableController}getInitConfig(){const r=[{name:"张三",age:18,sex:"男"},{name:"李四",age:20,sex:"女"},{name:"王五",age:22,sex:"男"}];return{base:{id:"",name:"基础表格",type:"LcBaseTable"},style:{columns:[{key:"name",label:"姓名",width:void 0,textAlign:"center"},{key:"age",label:"年龄",width:void 0,textAlign:"center"},{key:"sex",label:"性别",width:void 0,textAlign:"center"}],data:r,header:{height:40,background:"#0080be",color:"#fff",fontSize:14,fontWeight:900},body:{background:"#141414",color:"#acacac",fontSize:14,fontWeight:500,enableCarousel:!1,carouselSpeed:3}},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0},data:{sourceType:"static",staticData:r}}}getMenuList(){return super.getMenuList().filter(r=>r.key!=="theme")}getMenuToConfigContentMap(){const r=super.getMenuToConfigContentMap();return r.style=BaseTableStyleConfig,r}getEventList(){const r=super.getEventList();return r.push({id:"dataChange",name:"数据变更时"}),r}}const __vite_glob_0_65=Object.freeze(Object.defineProperty({__proto__:null,default:BaseTableDefinition},Symbol.toStringTag,{value:"Module"}));class DesignerLeftStore{constructor(){U(this,"menu","components");U(this,"setMenu",r=>this.menu=r);U(this,"designerLeftRef",null);U(this,"setDesignerLeftRef",r=>this.designerLeftRef=r);makeObservable(this,{menu:observable,setMenu:action})}}const designerLeftStore=new DesignerLeftStore;class EventOperateStore{constructor(){U(this,"movableRef",null);U(this,"selectorRef",null);U(this,"rulerRef",null);U(this,"dsContentRef",null);U(this,"targets",[]);U(this,"targetIds",[]);U(this,"pointerTarget",null);U(this,"groupCoordinate",{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0});U(this,"backoff",!1);U(this,"addRecordCompId",null);U(this,"scale",1);U(this,"ratio",1);U(this,"setDsContentRef",r=>this.dsContentRef=r);U(this,"setRuleRef",r=>this.rulerRef=r);U(this,"setRatio",r=>this.ratio=r);U(this,"setScale",r=>this.scale=r);U(this,"setAddRecordCompId",r=>this.addRecordCompId=r);U(this,"setBackoff",r=>this.backoff=r);U(this,"setMovableRef",r=>this.movableRef=r);U(this,"setSelectorRef",r=>this.selectorRef=r);U(this,"setTargetIds",r=>{const e=[...this.targetIds];this.targetIds=r;const n=[];r.forEach(l=>{const c=document.getElementById(l);c&&n.push(c)}),this.targets=n;const{layerInstances:o}=layerListStore$1,{menu:s}=designerLeftStore;if(s==="layer-list"&&(e.forEach(l=>{const c=o[l];c&&c.setState({selected:!1})}),this.targetIds.forEach(l=>{const c=o[l];c&&c.setState({selected:!0})})),this.targets.length>1){const{calculateGroupCoordinate:l}=eventOperateStore;l(this.targets)}});U(this,"setPointerTarget",r=>this.pointerTarget=r);U(this,"setGroupCoordinate",r=>{this.groupCoordinate=ObjectUtil.merge(this.groupCoordinate,r)});U(this,"calculateGroupCoordinate",r=>{const{layerConfigs:e}=layerManager,n={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};r.forEach(o=>{const s=e[o.id],{x:l=0,y:c=0,width:u,height:f}=s;l<n.minX&&(n.minX=l),c<n.minY&&(n.minY=c),l+u>n.maxX&&(n.maxX=l+u),c+f>n.maxY&&(n.maxY=c+f)}),n.groupWidth=n.maxX-n.minX,n.groupHeight=n.maxY-n.minY,this.setGroupCoordinate(n)});U(this,"focusDesignerCanvas",()=>{const r=document.querySelector(".lc-ruler-content");this.setPointerTarget(r)});makeObservable(this,{targets:observable,scale:observable,setScale:action,setTargetIds:action})}}const eventOperateStore=new EventOperateStore;var FUNCTION="function",OBJECT="object",STRING$1="string",NUMBER="number",UNDEFINED="undefined",IS_WINDOW=typeof window!==UNDEFINED,doc=typeof document!==UNDEFINED&&document,OPEN_CLOSED_CHARACTERS=[{open:"(",close:")"},{open:'"',close:'"'},{open:"'",close:"'"},{open:'\\"',close:'\\"'},{open:"\\'",close:"\\'"}],TINY_NUM=1e-7,DEFAULT_UNIT_PRESETS={cm:function(a){return a*96/2.54},mm:function(a){return a*96/254},in:function(a){return a*96},pt:function(a){return a*96/72},pc:function(a){return a*96/6},"%":function(a,r){return a*r/100},vw:function(a,r){return r===void 0&&(r=window.innerWidth),a/100*r},vh:function(a,r){return r===void 0&&(r=window.innerHeight),a/100*r},vmax:function(a,r){return r===void 0&&(r=Math.max(window.innerWidth,window.innerHeight)),a/100*r},vmin:function(a,r){return r===void 0&&(r=Math.min(window.innerWidth,window.innerHeight)),a/100*r}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function __spreadArrays$2(){for(var a=0,r=0,e=arguments.length;r<e;r++)a+=arguments[r].length;for(var n=Array(a),o=0,r=0;r<e;r++)for(var s=arguments[r],l=0,c=s.length;l<c;l++,o++)n[o]=s[l];return n}function dot(a,r,e,n){return(a*n+r*e)/(e+n)}function isUndefined(a){return typeof a===UNDEFINED}function isObject(a){return a&&typeof a===OBJECT}function isArray(a){return Array.isArray(a)}function isString(a){return typeof a===STRING$1}function isNumber(a){return typeof a===NUMBER}function isFunction(a){return typeof a===FUNCTION}function isEqualSeparator(a,r){var e=a===""||a==" ",n=r===""||r==" ";return n&&e||a===r}function findOpen(a,r,e,n,o){var s=findIgnore(a,r,e);return s?e:findClose(a,r,e+1,n,o)}function findIgnore(a,r,e){if(!a.ignore)return null;var n=r.slice(Math.max(e-3,0),e+3).join("");return new RegExp(a.ignore).exec(n)}function findClose(a,r,e,n,o){for(var s=function(f){var d=r[f].trim();if(d===a.close&&!findIgnore(a,r,f))return{value:f};var g=f,p=find(o,function(v){var m=v.open;return m===d});if(p&&(g=findOpen(p,r,f,n,o)),g===-1)return l=f,"break";f=g,l=f},l,c=e;c<n;++c){var u=s(c);if(c=l,typeof u=="object")return u.value;if(u==="break")break}return-1}function splitText(a,r){var e=isString(r)?{separator:r}:r,n=e.separator,o=n===void 0?",":n,s=e.isSeparateFirst,l=e.isSeparateOnlyOpenClose,c=e.isSeparateOpenClose,u=c===void 0?l:c,f=e.openCloseCharacters,d=f===void 0?OPEN_CLOSED_CHARACTERS:f,g=d.map(function(C){var L=C.open,R=C.close;return L===R?L:L+"|"+R}).join("|"),p="(\\s*"+o+"\\s*|"+g+"|\\s+)",v=new RegExp(p,"g"),m=a.split(v).filter(function(C){return C&&C!=="undefined"}),y=m.length,x=[],_=[];function E(){return _.length?(x.push(_.join("")),_=[],!0):!1}for(var S=function(C){var L=m[C].trim(),R=C,I=find(d,function(D){var O=D.open;return O===L}),w=find(d,function(D){var O=D.close;return O===L});if(I){if(R=findOpen(I,m,C,y,d),R!==-1&&u)return E()&&s||(x.push(m.slice(C,R+1).join("")),C=R,s)?(A=C,"break"):(A=C,"continue")}else if(w&&!findIgnore(w,m,C)){var M=__spreadArrays$2(d);return M.splice(d.indexOf(w),1),{value:splitText(a,{separator:o,isSeparateFirst:s,isSeparateOnlyOpenClose:l,isSeparateOpenClose:u,openCloseCharacters:M})}}else if(isEqualSeparator(L,o)&&!l)return E(),s?(A=C,"break"):(A=C,"continue");R===-1&&(R=y-1),_.push(m.slice(C,R+1).join("")),C=R,A=C},A,T=0;T<y;++T){var b=S(T);if(T=A,typeof b=="object")return b.value;if(b==="break")break}return _.length&&x.push(_.join("")),x}function splitSpace(a){return splitText(a,"")}function splitComma(a){return splitText(a,",")}function splitBracket(a){var r=/([^(]*)\(([\s\S]*)\)([\s\S]*)/g.exec(a);return!r||r.length<4?{}:{prefix:r[1],value:r[2],suffix:r[3]}}function splitUnit(a){var r=/^([^\d|e|\-|\+]*)((?:\d|\.|-|e-|e\+)+)(\S*)$/g.exec(a);if(!r)return{prefix:"",unit:"",value:NaN};var e=r[1],n=r[2],o=r[3];return{prefix:e,unit:o,value:parseFloat(n)}}function camelize(a){return a.replace(/[\s-_]+([^\s-_])/g,function(r,e){return e.toUpperCase()})}function decamelize(a,r){return r===void 0&&(r="-"),a.replace(/([a-z])([A-Z])/g,function(e,n,o){return""+n+r+o.toLowerCase()})}function now$1(){return Date.now?Date.now():new Date().getTime()}function findIndex(a,r,e){e===void 0&&(e=-1);for(var n=a.length,o=0;o<n;++o)if(r(a[o],o,a))return o;return e}function findLastIndex(a,r,e){e===void 0&&(e=-1);for(var n=a.length,o=n-1;o>=0;--o)if(r(a[o],o,a))return o;return e}function findLast(a,r,e){var n=findLastIndex(a,r);return n>-1?a[n]:e}function find(a,r,e){var n=findIndex(a,r);return n>-1?a[n]:e}var requestAnimationFrame$1=function(){var a=now$1(),r=IS_WINDOW&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame);return r?r.bind(window):function(e){var n=now$1(),o=setTimeout(function(){e(n-a)},1e3/60);return o}}(),cancelAnimationFrame$1=function(){var a=IS_WINDOW&&(window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame);return a?a.bind(window):function(r){clearTimeout(r)}}();function getKeys(a){return Object.keys(a)}function convertUnitSize(a,r){var e=splitUnit(a),n=e.value,o=e.unit;if(isObject(r)){var s=r[o];if(s){if(isFunction(s))return s(n);if(DEFAULT_UNIT_PRESETS[o])return DEFAULT_UNIT_PRESETS[o](n,s)}}else if(o==="%")return n*r/100;return DEFAULT_UNIT_PRESETS[o]?DEFAULT_UNIT_PRESETS[o](n):n}function between(a,r,e){return Math.max(r,Math.min(a,e))}function checkBoundSize(a,r,e,n){return n===void 0&&(n=a[0]/a[1]),[[throttle(r[0],TINY_NUM),throttle(r[0]/n,TINY_NUM)],[throttle(r[1]*n,TINY_NUM),throttle(r[1],TINY_NUM)]].filter(function(o){return o.every(function(s,l){var c=r[l],u=throttle(c,TINY_NUM);return e?s<=c||s<=u:s>=c||s>=u})})[0]||a}function calculateBoundSize(a,r,e,n){if(!n)return a.map(function(v,m){return between(v,r[m],e[m])});var o=a[0],s=a[1],l=n===!0?o/s:n,c=checkBoundSize(a,r,!1,l),u=c[0],f=c[1],d=checkBoundSize(a,e,!0,l),g=d[0],p=d[1];return o<u||s<f?(o=u,s=f):(o>g||s>p)&&(o=g,s=p),[o,s]}function sum(a){for(var r=a.length,e=0,n=r-1;n>=0;--n)e+=a[n];return e}function average(a){for(var r=a.length,e=0,n=r-1;n>=0;--n)e+=a[n];return r?e/r:0}function getRad$1(a,r){var e=r[0]-a[0],n=r[1]-a[1],o=Math.atan2(n,e);return o>=0?o:o+Math.PI*2}function getCenterPoint(a){return[0,1].map(function(r){return average(a.map(function(e){return e[r]}))})}function getShapeDirection(a){var r=getCenterPoint(a),e=getRad$1(r,a[0]),n=getRad$1(r,a[1]);return e<n&&n-e<Math.PI||e>n&&n-e<-Math.PI?1:-1}function getDist$1(a,r){return Math.sqrt(Math.pow((r?r[0]:0)-a[0],2)+Math.pow((r?r[1]:0)-a[1],2))}function throttle(a,r){if(!r)return a;var e=1/r;return Math.round(a/r)/e}function throttleArray(a,r){return a.forEach(function(e,n){a[n]=throttle(a[n],r)}),a}function counter(a){for(var r=[],e=0;e<a;++e)r.push(e);return r}function hasClass(a,r){return a.classList?a.classList.contains(r):!!a.className.match(new RegExp("(\\s|^)"+r+"(\\s|$)"))}function addClass(a,r){a.classList?a.classList.add(r):a.className+=" "+r}function removeClass(a,r){if(a.classList)a.classList.remove(r);else{var e=new RegExp("(\\s|^)"+r+"(\\s|$)");a.className=a.className.replace(e," ")}}function addEvent(a,r,e,n){a.addEventListener(r,e,n)}function removeEvent(a,r,e,n){a.removeEventListener(r,e,n)}function getDocument(a){return(a==null?void 0:a.ownerDocument)||doc}function getDocumentElement(a){return getDocument(a).documentElement}function getDocumentBody(a){return getDocument(a).body}function getWindow(a){var r;return((r=a==null?void 0:a.ownerDocument)===null||r===void 0?void 0:r.defaultView)||window}function isWindow(a){return a&&"postMessage"in a&&"blur"in a&&"self"in a}function isNode(a){return isObject(a)&&a.nodeName&&a.nodeType&&"ownerDocument"in a}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var __assign$6=function(){return __assign$6=Object.assign||function(r){for(var e,n=1,o=arguments.length;n<o;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=e[s])}return r},__assign$6.apply(this,arguments)};function __spreadArrays$1(){for(var a=0,r=0,e=arguments.length;r<e;r++)a+=arguments[r].length;for(var n=Array(a),o=0,r=0;r<e;r++)for(var s=arguments[r],l=0,c=s.length;l<c;l++,o++)n[o]=s[l];return n}var EventEmitter$1=function(){function a(){this._events={}}var r=a.prototype;return r.on=function(e,n){if(isObject(e))for(var o in e)this.on(o,e[o]);else this._addEvent(e,n,{});return this},r.off=function(e,n){if(!e)this._events={};else if(isObject(e))for(var o in e)this.off(o);else if(!n)this._events[e]=[];else{var s=this._events[e];if(s){var l=findIndex(s,function(c){return c.listener===n});l>-1&&s.splice(l,1)}}return this},r.once=function(e,n){var o=this;return n&&this._addEvent(e,n,{once:!0}),new Promise(function(s){o._addEvent(e,s,{once:!0})})},r.emit=function(e,n){var o=this;n===void 0&&(n={});var s=this._events[e];if(!e||!s)return!0;var l=!1;return n.eventType=e,n.stop=function(){l=!0},n.currentTarget=this,__spreadArrays$1(s).forEach(function(c){c.listener(n),c.once&&o.off(e,c.listener)}),!l},r.trigger=function(e,n){return n===void 0&&(n={}),this.emit(e,n)},r._addEvent=function(e,n,o){var s=this._events;s[e]=s[e]||[];var l=s[e];l.push(__assign$6({listener:n},o))},a}();const EventEmitter$2=EventEmitter$1;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$5=function(a,r){return extendStatics$5=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])},extendStatics$5(a,r)};function __extends$5(a,r){extendStatics$5(a,r);function e(){this.constructor=a}a.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}var __assign$5=function(){return __assign$5=Object.assign||function(r){for(var e,n=1,o=arguments.length;n<o;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=e[s])}return r},__assign$5.apply(this,arguments)};function getRad(a,r){var e=r[0]-a[0],n=r[1]-a[1],o=Math.atan2(n,e);return o>=0?o:o+Math.PI*2}function getRotatiion(a){return getRad([a[0].clientX,a[0].clientY],[a[1].clientX,a[1].clientY])/Math.PI*180}function isMultiTouch(a){return a.touches&&a.touches.length>=2}function getEventClients(a){return a?a.touches?getClients(a.touches):[getClient$1(a)]:[]}function isMouseEvent(a){return a&&(a.type.indexOf("mouse")>-1||"button"in a)}function getPosition(a,r,e){var n=e.length,o=getAverageClient(a,n),s=o.clientX,l=o.clientY,c=o.originalClientX,u=o.originalClientY,f=getAverageClient(r,n),d=f.clientX,g=f.clientY,p=getAverageClient(e,n),v=p.clientX,m=p.clientY,y=s-d,x=l-g,_=s-v,E=l-m;return{clientX:c,clientY:u,deltaX:y,deltaY:x,distX:_,distY:E}}function getDist(a){return Math.sqrt(Math.pow(a[0].clientX-a[1].clientX,2)+Math.pow(a[0].clientY-a[1].clientY,2))}function getClients(a){for(var r=Math.min(a.length,2),e=[],n=0;n<r;++n)e.push(getClient$1(a[n]));return e}function getClient$1(a){return{clientX:a.clientX,clientY:a.clientY}}function getAverageClient(a,r){r===void 0&&(r=a.length);for(var e={clientX:0,clientY:0,originalClientX:0,originalClientY:0},n=Math.min(a.length,r),o=0;o<n;++o){var s=a[o];e.originalClientX+="originalClientX"in s?s.originalClientX:s.clientX,e.originalClientY+="originalClientY"in s?s.originalClientY:s.clientY,e.clientX+=s.clientX,e.clientY+=s.clientY}return r?{clientX:e.clientX/r,clientY:e.clientY/r,originalClientX:e.originalClientX/r,originalClientY:e.originalClientY/r}:e}var ClientStore=function(){function a(r){this.prevClients=[],this.startClients=[],this.movement=0,this.length=0,this.startClients=r,this.prevClients=r,this.length=r.length}return a.prototype.getAngle=function(r){return r===void 0&&(r=this.prevClients),getRotatiion(r)},a.prototype.getRotation=function(r){return r===void 0&&(r=this.prevClients),getRotatiion(r)-getRotatiion(this.startClients)},a.prototype.getPosition=function(r,e){r===void 0&&(r=this.prevClients);var n=getPosition(r||this.prevClients,this.prevClients,this.startClients),o=n.deltaX,s=n.deltaY;return this.movement+=Math.sqrt(o*o+s*s),this.prevClients=r,n},a.prototype.getPositions=function(r){r===void 0&&(r=this.prevClients);for(var e=this.prevClients,n=this.startClients,o=Math.min(this.length,e.length),s=[],l=0;l<o;++l)s[l]=getPosition([r[l]],[e[l]],[n[l]]);return s},a.prototype.getMovement=function(r){var e=this.movement;if(!r)return e;var n=getAverageClient(r,this.length),o=getAverageClient(this.prevClients,this.length),s=n.clientX-o.clientX,l=n.clientY-o.clientY;return Math.sqrt(s*s+l*l)+e},a.prototype.getDistance=function(r){return r===void 0&&(r=this.prevClients),getDist(r)},a.prototype.getScale=function(r){return r===void 0&&(r=this.prevClients),getDist(r)/getDist(this.startClients)},a.prototype.move=function(r,e){this.startClients.forEach(function(n){n.clientX-=r,n.clientY-=e}),this.prevClients.forEach(function(n){n.clientX-=r,n.clientY-=e})},a}(),INPUT_TAGNAMES=["textarea","input"],Gesto=function(a){__extends$5(r,a);function r(e,n){n===void 0&&(n={});var o=a.call(this)||this;o.options={},o.flag=!1,o.pinchFlag=!1,o.data={},o.isDrag=!1,o.isPinch=!1,o.clientStores=[],o.targets=[],o.prevTime=0,o.doubleFlag=!1,o._useMouse=!1,o._useTouch=!1,o._useDrag=!1,o._dragFlag=!1,o._isTrusted=!1,o._isMouseEvent=!1,o._isSecondaryButton=!1,o._preventMouseEvent=!1,o._prevInputEvent=null,o._isDragAPI=!1,o._isIdle=!0,o._window=window,o.onDragStart=function(p,v){if(v===void 0&&(v=!0),!(!o.flag&&p.cancelable===!1)){var m=p.type.indexOf("drag")>=-1;if(!(o.flag&&m)){o._isDragAPI=!0;var y=o.options,x=y.container,_=y.pinchOutside,E=y.preventWheelClick,S=y.preventRightClick,A=y.preventDefault,T=y.checkInput,b=y.dragFocusedInput,C=y.preventClickEventOnDragStart,L=y.preventClickEventOnDrag,R=y.preventClickEventByCondition,I=o._useTouch,w=!o.flag;if(o._isSecondaryButton=p.which===3||p.button===2,E&&(p.which===2||p.button===1)||S&&(p.which===3||p.button===2))return o.stop(),!1;if(w){var M=o._window.document.activeElement,D=p.target;if(D){var O=D.tagName.toLowerCase(),F=INPUT_TAGNAMES.indexOf(O)>-1,k=D.isContentEditable;if(F||k){if(T||!b&&M===D)return!1;if(M&&(M===D||k&&M.isContentEditable&&M.contains(D)))if(b)D.blur();else return!1}else if((A||p.type==="touchstart")&&M){var $=M.tagName.toLowerCase();(M.isContentEditable||INPUT_TAGNAMES.indexOf($)>-1)&&M.blur()}(C||L||R)&&addEvent(o._window,"click",o._onClick,!0)}o.clientStores=[new ClientStore(getEventClients(p))],o._isIdle=!1,o.flag=!0,o.isDrag=!1,o._isTrusted=v,o._dragFlag=!0,o._prevInputEvent=p,o.data={},o.doubleFlag=now$1()-o.prevTime<200,o._isMouseEvent=isMouseEvent(p),!o._isMouseEvent&&o._preventMouseEvent&&(o._preventMouseEvent=!1);var V=o._preventMouseEvent||o.emit("dragStart",__assign$5(__assign$5({data:o.data,datas:o.data,inputEvent:p,isMouseEvent:o._isMouseEvent,isSecondaryButton:o._isSecondaryButton,isTrusted:v,isDouble:o.doubleFlag},o.getCurrentStore().getPosition()),{preventDefault:function(){p.preventDefault()},preventDrag:function(){o._dragFlag=!1}}));V===!1&&o.stop(),o._isMouseEvent&&o.flag&&A&&p.preventDefault()}if(!o.flag)return!1;var N=0;if(w?(o._attchDragEvent(),I&&_&&(N=setTimeout(function(){addEvent(x,"touchstart",o.onDragStart,{passive:!1})}))):I&&_&&removeEvent(x,"touchstart",o.onDragStart),o.flag&&isMultiTouch(p)){if(clearTimeout(N),w&&p.touches.length!==p.changedTouches.length)return;o.pinchFlag||o.onPinchStart(p)}}}},o.onDrag=function(p,v){if(o.flag){var m=o.options.preventDefault;!o._isMouseEvent&&m&&p.preventDefault(),o._prevInputEvent=p;var y=getEventClients(p),x=o.moveClients(y,p,!1);if(o._dragFlag){if(o.pinchFlag||x.deltaX||x.deltaY){var _=o._preventMouseEvent||o.emit("drag",__assign$5(__assign$5({},x),{isScroll:!!v,inputEvent:p}));if(_===!1){o.stop();return}}o.pinchFlag&&o.onPinch(p,y)}o.getCurrentStore().getPosition(y,!0)}},o.onDragEnd=function(p){if(o.flag){var v=o.options,m=v.pinchOutside,y=v.container,x=v.preventClickEventOnDrag,_=v.preventClickEventOnDragStart,E=v.preventClickEventByCondition,S=o.isDrag;(x||_||E)&&requestAnimationFrame(function(){o._allowClickEvent()}),!E&&!_&&x&&!S&&o._allowClickEvent(),o._useTouch&&m&&removeEvent(y,"touchstart",o.onDragStart),o.pinchFlag&&o.onPinchEnd(p);var A=p!=null&&p.touches?getEventClients(p):[],T=A.length;T===0||!o.options.keepDragging?o.flag=!1:o._addStore(new ClientStore(A));var b=o._getPosition(),C=now$1(),L=!S&&o.doubleFlag;o._prevInputEvent=null,o.prevTime=S||L?0:C,o.flag||(o._dettachDragEvent(),o._preventMouseEvent||o.emit("dragEnd",__assign$5({data:o.data,datas:o.data,isDouble:L,isDrag:S,isClick:!S,isMouseEvent:o._isMouseEvent,isSecondaryButton:o._isSecondaryButton,inputEvent:p,isTrusted:o._isTrusted},b)),o.clientStores=[],o._isMouseEvent||(o._preventMouseEvent=!0,requestAnimationFrame(function(){requestAnimationFrame(function(){o._preventMouseEvent=!1})})),o._isIdle=!0)}},o.onBlur=function(){o.onDragEnd()},o._allowClickEvent=function(){removeEvent(o._window,"click",o._onClick,!0)},o._onClick=function(p){o._allowClickEvent(),o._preventMouseEvent=!1;var v=o.options.preventClickEventByCondition;v!=null&&v(p)||(p.stopPropagation(),p.preventDefault())},o._onContextMenu=function(p){var v=o.options;v.preventRightClick?o.onDragEnd(p):p.preventDefault()},o._passCallback=function(){};var s=[].concat(e),l=s[0];o._window=isWindow(l)?l:getWindow(l),o.options=__assign$5({checkInput:!1,container:l&&!("document"in l)?getWindow(l):l,preventRightClick:!0,preventWheelClick:!0,preventClickEventOnDragStart:!1,preventClickEventOnDrag:!1,preventClickEventByCondition:null,preventDefault:!0,checkWindowBlur:!1,keepDragging:!1,pinchThreshold:0,events:["touch","mouse"]},n);var c=o.options,u=c.container,f=c.events,d=c.checkWindowBlur;if(o._useDrag=f.indexOf("drag")>-1,o._useTouch=f.indexOf("touch")>-1,o._useMouse=f.indexOf("mouse")>-1,o.targets=s,o._useDrag&&s.forEach(function(p){addEvent(p,"dragstart",o.onDragStart)}),o._useMouse&&(s.forEach(function(p){addEvent(p,"mousedown",o.onDragStart),addEvent(p,"mousemove",o._passCallback)}),addEvent(u,"contextmenu",o._onContextMenu)),d&&addEvent(getWindow(),"blur",o.onBlur),o._useTouch){var g={passive:!1};s.forEach(function(p){addEvent(p,"touchstart",o.onDragStart,g),addEvent(p,"touchmove",o._passCallback,g)})}return o}return r.prototype.stop=function(){this.isDrag=!1,this.data={},this.clientStores=[],this.pinchFlag=!1,this.doubleFlag=!1,this.prevTime=0,this.flag=!1,this._isIdle=!0,this._allowClickEvent(),this._dettachDragEvent(),this._isDragAPI=!1},r.prototype.getMovement=function(e){return this.getCurrentStore().getMovement(e)+this.clientStores.slice(1).reduce(function(n,o){return n+o.movement},0)},r.prototype.isDragging=function(){return this.isDrag},r.prototype.isIdle=function(){return this._isIdle},r.prototype.isFlag=function(){return this.flag},r.prototype.isPinchFlag=function(){return this.pinchFlag},r.prototype.isDoubleFlag=function(){return this.doubleFlag},r.prototype.isPinching=function(){return this.isPinch},r.prototype.scrollBy=function(e,n,o,s){s===void 0&&(s=!0),this.flag&&(this.clientStores[0].move(e,n),s&&this.onDrag(o,!0))},r.prototype.move=function(e,n){var o=e[0],s=e[1],l=this.getCurrentStore(),c=l.prevClients;return this.moveClients(c.map(function(u){var f=u.clientX,d=u.clientY;return{clientX:f+o,clientY:d+s,originalClientX:f,originalClientY:d}}),n,!0)},r.prototype.triggerDragStart=function(e){this.onDragStart(e,!1)},r.prototype.setEventData=function(e){var n=this.data;for(var o in e)n[o]=e[o];return this},r.prototype.setEventDatas=function(e){return this.setEventData(e)},r.prototype.getCurrentEvent=function(e){return e===void 0&&(e=this._prevInputEvent),__assign$5(__assign$5({data:this.data,datas:this.data},this._getPosition()),{movement:this.getMovement(),isDrag:this.isDrag,isPinch:this.isPinch,isScroll:!1,inputEvent:e})},r.prototype.getEventData=function(){return this.data},r.prototype.getEventDatas=function(){return this.data},r.prototype.unset=function(){var e=this,n=this.targets,o=this.options.container;this.off(),removeEvent(this._window,"blur",this.onBlur),this._useDrag&&n.forEach(function(s){removeEvent(s,"dragstart",e.onDragStart)}),this._useMouse&&(n.forEach(function(s){removeEvent(s,"mousedown",e.onDragStart)}),removeEvent(o,"contextmenu",this._onContextMenu)),this._useTouch&&(n.forEach(function(s){removeEvent(s,"touchstart",e.onDragStart)}),removeEvent(o,"touchstart",this.onDragStart)),this._prevInputEvent=null,this._allowClickEvent(),this._dettachDragEvent()},r.prototype.onPinchStart=function(e){var n=this,o=this.options.pinchThreshold;if(!(this.isDrag&&this.getMovement()>o)){var s=new ClientStore(getEventClients(e));this.pinchFlag=!0,this._addStore(s);var l=this.emit("pinchStart",__assign$5(__assign$5({data:this.data,datas:this.data,angle:s.getAngle(),touches:this.getCurrentStore().getPositions()},s.getPosition()),{inputEvent:e,isTrusted:this._isTrusted,preventDefault:function(){e.preventDefault()},preventDrag:function(){n._dragFlag=!1}}));l===!1&&(this.pinchFlag=!1)}},r.prototype.onPinch=function(e,n){if(!(!this.flag||!this.pinchFlag||n.length<2)){var o=this.getCurrentStore();this.isPinch=!0,this.emit("pinch",__assign$5(__assign$5({data:this.data,datas:this.data,movement:this.getMovement(n),angle:o.getAngle(n),rotation:o.getRotation(n),touches:o.getPositions(n),scale:o.getScale(n),distance:o.getDistance(n)},o.getPosition(n)),{inputEvent:e,isTrusted:this._isTrusted}))}},r.prototype.onPinchEnd=function(e){if(this.pinchFlag){var n=this.isPinch;this.isPinch=!1,this.pinchFlag=!1;var o=this.getCurrentStore();this.emit("pinchEnd",__assign$5(__assign$5({data:this.data,datas:this.data,isPinch:n,touches:o.getPositions()},o.getPosition()),{inputEvent:e}))}},r.prototype.getCurrentStore=function(){return this.clientStores[0]},r.prototype.moveClients=function(e,n,o){var s=this._getPosition(e,o),l=this.isDrag;(s.deltaX||s.deltaY)&&(this.isDrag=!0);var c=!1;return!l&&this.isDrag&&(c=!0),__assign$5(__assign$5({data:this.data,datas:this.data},s),{movement:this.getMovement(e),isDrag:this.isDrag,isPinch:this.isPinch,isScroll:!1,isMouseEvent:this._isMouseEvent,isSecondaryButton:this._isSecondaryButton,inputEvent:n,isTrusted:this._isTrusted,isFirstDrag:c})},r.prototype._addStore=function(e){this.clientStores.splice(0,0,e)},r.prototype._getPosition=function(e,n){var o=this.getCurrentStore(),s=o.getPosition(e,n),l=this.clientStores.slice(1).reduce(function(f,d){var g=d.getPosition();return f.distX+=g.distX,f.distY+=g.distY,f},s),c=l.distX,u=l.distY;return __assign$5(__assign$5({},s),{distX:c,distY:u})},r.prototype._attchDragEvent=function(){var e=this._window,n=this.options.container,o={passive:!1};this._isDragAPI&&(addEvent(n,"dragover",this.onDrag,o),addEvent(e,"dragend",this.onDragEnd)),this._useMouse&&(addEvent(n,"mousemove",this.onDrag),addEvent(e,"mouseup",this.onDragEnd)),this._useTouch&&(addEvent(n,"touchmove",this.onDrag,o),addEvent(e,"touchend",this.onDragEnd,o),addEvent(e,"touchcancel",this.onDragEnd,o))},r.prototype._dettachDragEvent=function(){var e=this._window,n=this.options.container;this._isDragAPI&&(removeEvent(n,"dragover",this.onDrag),removeEvent(e,"dragend",this.onDragEnd)),this._useMouse&&(removeEvent(n,"mousemove",this.onDrag),removeEvent(e,"mouseup",this.onDragEnd)),this._useTouch&&(removeEvent(n,"touchstart",this.onDragStart),removeEvent(n,"touchmove",this.onDrag),removeEvent(e,"touchend",this.onDragEnd),removeEvent(e,"touchcancel",this.onDragEnd))},r}(EventEmitter$2);function prefixNames(a){for(var r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];return r.map(function(n){return n.split(" ").map(function(o){return o?""+a+o:""}).join(" ")}).join(" ")}function prefixCSS(a,r){return r.replace(/([^}{]*){/gm,function(e,n){return n.replace(/\.([^{,\s\d.]+)/g,"."+a+"$1")+"{"})}function ref(a,r){return function(e){e&&(a[r]=e)}}function refs(a,r,e){return function(n){n&&(a[r][e]=n)}}function Properties(a,r){return function(e){var n=e.prototype;a.forEach(function(o){r(n,o)})}}function withMethods(a,r){return r===void 0&&(r={}),function(e,n){a.forEach(function(o){var s=r[o]||o;s in e||(e[s]=function(){for(var l,c=[],u=0;u<arguments.length;u++)c[u]=arguments[u];var f=(l=this[n])[o].apply(l,c);return f===this[n]?this:f})})}}var PolyMap=function(){function a(){this.keys=[],this.values=[]}var r=a.prototype;return r.get=function(e){return this.values[this.keys.indexOf(e)]},r.set=function(e,n){var o=this.keys,s=this.values,l=o.indexOf(e),c=l===-1?o.length:l;o[c]=e,s[c]=n},a}(),HashMap=function(){function a(){this.object={}}var r=a.prototype;return r.get=function(e){return this.object[e]},r.set=function(e,n){this.object[e]=n},a}(),SUPPORT_MAP=typeof Map=="function",Link=function(){function a(){}var r=a.prototype;return r.connect=function(e,n){this.prev=e,this.next=n,e&&(e.next=this),n&&(n.prev=this)},r.disconnect=function(){var e=this.prev,n=this.next;e&&(e.next=n),n&&(n.prev=e)},r.getIndex=function(){for(var e=this,n=-1;e;)e=e.prev,++n;return n},a}();function orderChanged(a,r){var e=[],n=[];return a.forEach(function(o){var s=o[0],l=o[1],c=new Link;e[s]=c,n[l]=c}),e.forEach(function(o,s){o.connect(e[s-1])}),a.filter(function(o,s){return!r[s]}).map(function(o,s){var l=o[0],c=o[1];if(l===c)return[0,0];var u=e[l],f=n[c-1],d=u.getIndex();u.disconnect(),f?u.connect(f,f.next):u.connect(void 0,e[0]);var g=u.getIndex();return[d,g]})}var Result=function(){function a(e,n,o,s,l,c,u,f){this.prevList=e,this.list=n,this.added=o,this.removed=s,this.changed=l,this.maintained=c,this.changedBeforeAdded=u,this.fixed=f}var r=a.prototype;return Object.defineProperty(r,"ordered",{get:function(){return this.cacheOrdered||this.caculateOrdered(),this.cacheOrdered},enumerable:!0,configurable:!0}),Object.defineProperty(r,"pureChanged",{get:function(){return this.cachePureChanged||this.caculateOrdered(),this.cachePureChanged},enumerable:!0,configurable:!0}),r.caculateOrdered=function(){var e=orderChanged(this.changedBeforeAdded,this.fixed),n=this.changed,o=[];this.cacheOrdered=e.filter(function(s,l){var c=s[0],u=s[1],f=n[l],d=f[0],g=f[1];if(c!==u)return o.push([d,g]),!0}),this.cachePureChanged=o},a}();function diff$1(a,r,e){var n=SUPPORT_MAP?Map:e?HashMap:PolyMap,o=e||function(E){return E},s=[],l=[],c=[],u=a.map(o),f=r.map(o),d=new n,g=new n,p=[],v=[],m={},y=[],x=0,_=0;return u.forEach(function(E,S){d.set(E,S)}),f.forEach(function(E,S){g.set(E,S)}),u.forEach(function(E,S){var A=g.get(E);typeof A>"u"?(++_,l.push(S)):m[A]=_}),f.forEach(function(E,S){var A=d.get(E);typeof A>"u"?(s.push(S),++x):(c.push([A,S]),_=m[S]||0,p.push([A-_,S-x]),v.push(S===A),A!==S&&y.push([A,S]))}),l.reverse(),new Result(a,r,s,l,y,c,p,v)}var ListDiffer=function(){function a(e,n){e===void 0&&(e=[]),this.findKeyCallback=n,this.list=[].slice.call(e)}var r=a.prototype;return r.update=function(e){var n=[].slice.call(e),o=diff$1(this.list,n,this.findKeyCallback);return this.list=n,o},a}();/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var extendStatics$4=function(a,r){return extendStatics$4=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])},extendStatics$4(a,r)};function __extends$4(a,r){extendStatics$4(a,r);function e(){this.constructor=a}a.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}var findKeyCallback=typeof Map=="function"?void 0:function(){var a=0;return function(r){return r.__DIFF_KEY__||(r.__DIFF_KEY__=++a)}}(),ChildrenDiffer=function(a){__extends$4(r,a);function r(e){return e===void 0&&(e=[]),a.call(this,e,findKeyCallback)||this}return r}(ListDiffer);function diff(a,r){return diff$1(a,r,findKeyCallback)}const ChildrenDiffer$1=ChildrenDiffer;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var extendStatics$3=function(a,r){return extendStatics$3=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)n.hasOwnProperty(o)&&(e[o]=n[o])},extendStatics$3(a,r)};function __extends$3(a,r){extendStatics$3(a,r);function e(){this.constructor=a}a.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}var __assign$4=function(){return __assign$4=Object.assign||function(r){for(var e,n=1,o=arguments.length;n<o;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=e[s])}return r},__assign$4.apply(this,arguments)};function getDefaultScrollPosition(a){var r=a.container;return r===document.body?[r.scrollLeft||document.documentElement.scrollLeft,r.scrollTop||document.documentElement.scrollTop]:[r.scrollLeft,r.scrollTop]}function checkDefaultScrollEvent(a,r){return a.addEventListener("scroll",r),function(){a.removeEventListener("scroll",r)}}function getContainerElement(a){if(a){if(isString(a))return document.querySelector(a)}else return null;if(isFunction(a))return a();if(a instanceof Element)return a;if("current"in a)return a.current;if("value"in a)return a.value}var DragScroll=function(a){__extends$3(r,a);function r(){var n=a!==null&&a.apply(this,arguments)||this;return n._startRect=null,n._startPos=[],n._prevTime=0,n._timer=0,n._prevScrollPos=[0,0],n._isWait=!1,n._flag=!1,n._currentOptions=null,n._lock=!1,n._unregister=null,n._onScroll=function(){var o=n._currentOptions;n._lock||!o||n.emit("scrollDrag",{next:function(s){n.checkScroll({container:o.container,inputEvent:s})}})},n}var e=r.prototype;return e.dragStart=function(n,o){var s=getContainerElement(o.container);if(!s){this._flag=!1;return}var l=0,c=0,u=0,f=0;if(s===document.body)u=window.innerWidth,f=window.innerHeight;else{var d=s.getBoundingClientRect();l=d.top,c=d.left,u=d.width,f=d.height}this._flag=!0,this._startPos=[n.clientX,n.clientY],this._startRect={top:l,left:c,width:u,height:f},this._prevScrollPos=this._getScrollPosition([0,0],o),this._currentOptions=o,this._registerScrollEvent(o)},e.drag=function(n,o){if(clearTimeout(this._timer),!!this._flag){var s=n.clientX,l=n.clientY,c=o.threshold,u=c===void 0?0:c,f=this,d=f._startRect,g=f._startPos;this._currentOptions=o;var p=[0,0];return d.top>l-u?(g[1]>d.top||l<g[1])&&(p[1]=-1):d.top+d.height<l+u&&(g[1]<d.top+d.height||l>g[1])&&(p[1]=1),d.left>s-u?(g[0]>d.left||s<g[0])&&(p[0]=-1):d.left+d.width<s+u&&(g[0]<d.left+d.width||s>g[0])&&(p[0]=1),!p[0]&&!p[1]?!1:this._continueDrag(__assign$4(__assign$4({},o),{direction:p,inputEvent:n,isDrag:!0}))}},e.checkScroll=function(n){var o=this;if(this._isWait)return!1;var s=n.prevScrollPos,l=s===void 0?this._prevScrollPos:s,c=n.direction,u=n.throttleTime,f=u===void 0?0:u,d=n.inputEvent,g=n.isDrag,p=this._getScrollPosition(c||[0,0],n),v=p[0]-l[0],m=p[1]-l[1],y=c||[v?Math.abs(v)/v:0,m?Math.abs(m)/m:0];return this._prevScrollPos=p,this._lock=!1,!v&&!m?!1:(this.emit("move",{offsetX:y[0]?v:0,offsetY:y[1]?m:0,inputEvent:d}),f&&g&&(clearTimeout(this._timer),this._timer=window.setTimeout(function(){o._continueDrag(n)},f)),!0)},e.dragEnd=function(){this._flag=!1,this._lock=!1,clearTimeout(this._timer),this._unregisterScrollEvent()},e._getScrollPosition=function(n,o){var s=o.container,l=o.getScrollPosition,c=l===void 0?getDefaultScrollPosition:l;return c({container:getContainerElement(s),direction:n})},e._continueDrag=function(n){var o=this,s,l=n.container,c=n.direction,u=n.throttleTime,f=n.useScroll,d=n.isDrag,g=n.inputEvent;if(!(!this._flag||d&&this._isWait)){var p=now$1(),v=Math.max(u+this._prevTime-p,0);if(v>0)return clearTimeout(this._timer),this._timer=window.setTimeout(function(){o._continueDrag(n)},v),!1;this._prevTime=p;var m=this._getScrollPosition(c,n);this._prevScrollPos=m,d&&(this._isWait=!0),f||(this._lock=!0);var y={container:getContainerElement(l),direction:c,inputEvent:g};return(s=n.requestScroll)===null||s===void 0||s.call(n,y),this.emit("scroll",y),this._isWait=!1,f||this.checkScroll(__assign$4(__assign$4({},n),{prevScrollPos:m,direction:c,inputEvent:g}))}},e._registerScrollEvent=function(n){this._unregisterScrollEvent();var o=n.checkScrollEvent;if(o){var s=o===!0?checkDefaultScrollEvent:o,l=getContainerElement(n.container);o===!0&&(l===document.body||l===document.documentElement)?this._unregister=checkDefaultScrollEvent(window,this._onScroll):this._unregister=s(l,this._onScroll)}},e._unregisterScrollEvent=function(){var n;(n=this._unregister)===null||n===void 0||n.call(this),this._unregister=null},r}(EventEmitter$2);const DragScroll$1=DragScroll;var extendStatics$2=function(a,r){return extendStatics$2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},extendStatics$2(a,r)};function __extends$2(a,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");extendStatics$2(a,r);function e(){this.constructor=a}a.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}function createCommonjsModule(a,r){return r={exports:{}},a(r,r.exports),r.exports}var keycode=createCommonjsModule(function(a,r){function e(u){if(u&&typeof u=="object"){var f=u.which||u.keyCode||u.charCode;f&&(u=f)}if(typeof u=="number")return l[u];var d=String(u),g=n[d.toLowerCase()];if(g)return g;var g=o[d.toLowerCase()];if(g)return g;if(d.length===1)return d.charCodeAt(0)}e.isEventKey=function(f,d){if(f&&typeof f=="object"){var g=f.which||f.keyCode||f.charCode;if(g==null)return!1;if(typeof d=="string"){var p=n[d.toLowerCase()];if(p)return p===g;var p=o[d.toLowerCase()];if(p)return p===g}else if(typeof d=="number")return d===g;return!1}},r=a.exports=e;var n=r.code=r.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},o=r.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,spacebar:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};/*!
 * Programatically add the following
 */for(s=97;s<123;s++)n[String.fromCharCode(s)]=s-32;for(var s=48;s<58;s++)n[s-48]=s;for(s=1;s<13;s++)n["f"+s]=s+111;for(s=0;s<10;s++)n["numpad "+s]=s+96;var l=r.names=r.title={};for(s in n)l[n[s]]=s;for(var c in o)n[c]=o[c]});keycode.code;keycode.codes;keycode.aliases;var keycode_4=keycode.names;keycode.title;var codeData={"+":"plus","left command":"meta","right command":"meta"},keysSort={shift:1,ctrl:2,alt:3,meta:4};function getKey(a,r){var e=(keycode_4[a]||r||"").toLowerCase();for(var n in codeData)e=e.replace(n,codeData[n]);return e.replace(/\s/g,"")}function getCombi(a,r){r===void 0&&(r=getKey(a.keyCode,a.key));var e=getModifierCombi(a);return e.indexOf(r)===-1&&e.push(r),e.filter(Boolean)}function getModifierCombi(a){var r=[a.shiftKey&&"shift",a.ctrlKey&&"ctrl",a.altKey&&"alt",a.metaKey&&"meta"];return r.filter(Boolean)}function getArrangeCombi(a){var r=a.slice();return r.sort(function(e,n){var o=keysSort[e]||5,s=keysSort[n]||5;return o-s}),r}var globalKeyController,KeyController=function(a){__extends$2(r,a);function r(n){n===void 0&&(n=window);var o=a.call(this)||this;return o.container=n,o.ctrlKey=!1,o.altKey=!1,o.shiftKey=!1,o.metaKey=!1,o.clear=function(){return o.ctrlKey=!1,o.altKey=!1,o.shiftKey=!1,o.metaKey=!1,o},o.keydownEvent=function(s){o.triggerEvent("keydown",s)},o.keyupEvent=function(s){o.triggerEvent("keyup",s)},o.blur=function(){o.clear(),o.trigger("blur")},addEvent(n,"blur",o.blur),addEvent(n,"keydown",o.keydownEvent),addEvent(n,"keyup",o.keyupEvent),o}var e=r.prototype;return Object.defineProperty(r,"global",{get:function(){return globalKeyController||(globalKeyController=new r)},enumerable:!1,configurable:!0}),r.setGlobal=function(){return this.global},e.destroy=function(){var n=this.container;this.clear(),this.off(),removeEvent(n,"blur",this.blur),removeEvent(n,"keydown",this.keydownEvent),removeEvent(n,"keyup",this.keyupEvent)},e.keydown=function(n,o){return this.addEvent("keydown",n,o)},e.offKeydown=function(n,o){return this.removeEvent("keydown",n,o)},e.offKeyup=function(n,o){return this.removeEvent("keyup",n,o)},e.keyup=function(n,o){return this.addEvent("keyup",n,o)},e.addEvent=function(n,o,s){return isArray(o)?this.on("".concat(n,".").concat(getArrangeCombi(o).join(".")),s):isString(o)?this.on("".concat(n,".").concat(o),s):this.on(n,o),this},e.removeEvent=function(n,o,s){return isArray(o)?this.off("".concat(n,".").concat(getArrangeCombi(o).join(".")),s):isString(o)?this.off("".concat(n,".").concat(o),s):this.off(n,o),this},e.triggerEvent=function(n,o){this.ctrlKey=o.ctrlKey,this.shiftKey=o.shiftKey,this.altKey=o.altKey,this.metaKey=o.metaKey;var s=getKey(o.keyCode,o.key),l=s==="ctrl"||s==="shift"||s==="meta"||s==="alt",c={key:s,isToggle:l,inputEvent:o,keyCode:o.keyCode,ctrlKey:o.ctrlKey,altKey:o.altKey,shiftKey:o.shiftKey,metaKey:o.metaKey};this.trigger(n,c),this.trigger("".concat(n,".").concat(s),c);var u=getCombi(o,s);u.length>1&&this.trigger("".concat(n,".").concat(u.join(".")),c)},r}(EventEmitter$2);const KeyController$1=KeyController;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function __spreadArrays(){for(var a=0,r=0,e=arguments.length;r<e;r++)a+=arguments[r].length;for(var n=Array(a),o=0,r=0;r<e;r++)for(var s=arguments[r],l=0,c=s.length;l<c;l++,o++)n[o]=s[l];return n}function tinyThrottle(a){return throttle(a,TINY_NUM)}function isSameConstants(a,r){return a.every(function(e,n){return tinyThrottle(e-r[n])===0})}function isSamePoint(a,r){return!tinyThrottle(a[0]-r[0])&&!tinyThrottle(a[1]-r[1])}function getAreaSize(a){return a.length<3?0:Math.abs(sum(a.map(function(r,e){var n=a[e+1]||a[0];return r[0]*n[1]-n[0]*r[1]})))/2}function fitPoints(a,r){var e=r.width,n=r.height,o=r.left,s=r.top,l=getMinMaxs(a),c=l.minX,u=l.minY,f=l.maxX,d=l.maxY,g=e/(f-c),p=n/(d-u);return a.map(function(v){return[o+(v[0]-c)*g,s+(v[1]-u)*p]})}function getMinMaxs(a){var r=a.map(function(n){return n[0]}),e=a.map(function(n){return n[1]});return{minX:Math.min.apply(Math,r),minY:Math.min.apply(Math,e),maxX:Math.max.apply(Math,r),maxY:Math.max.apply(Math,e)}}function isInside(a,r,e){var n=a[0],o=a[1],s=getMinMaxs(r),l=s.minX,c=s.maxX,u=[[l,o],[c,o]],f=getLinearConstants(u[0],u[1]),d=convertLines(r),g=[];if(d.forEach(function(m){var y=getLinearConstants(m[0],m[1]),x=m[0];if(isSameConstants(f,y))g.push({pos:a,line:m,type:"line"});else{var _=getPointsOnLines(getIntersectionPointsByConstants(f,y),[u,m]);_.forEach(function(E){m.some(function(S){return isSamePoint(S,E)})?g.push({pos:E,line:m,type:"point"}):tinyThrottle(x[1]-o)!==0&&g.push({pos:E,line:m,type:"intersection"})})}}),!e&&find(g,function(m){return m[0]===n}))return!0;var p=0,v={};return g.forEach(function(m){var y=m.pos,x=m.type,_=m.line;if(!(y[0]>n))if(x==="intersection")++p;else{if(x==="line")return;if(x==="point"){var E=find(_,function(T){return T[1]!==o}),S=v[y[0]],A=E[1]>o?1:-1;S?S!==A&&++p:v[y[0]]=A}}}),p%2===1}function getLinearConstants(a,r){var e=a[0],n=a[1],o=r[0],s=r[1],l=o-e,c=s-n;Math.abs(l)<TINY_NUM&&(l=0),Math.abs(c)<TINY_NUM&&(c=0);var u=0,f=0,d=0;return l?c?(u=-c/l,f=1,d=-u*e-n):(f=1,d=-n):c&&(u=-1,d=e),[u,f,d]}function getIntersectionPointsByConstants(a,r){var e=a[0],n=a[1],o=a[2],s=r[0],l=r[1],c=r[2],u=e===0&&s===0,f=n===0&&l===0,d=[];if(u&&f)return[];if(u){var g=-o/n,p=-c/l;return g!==p?[]:[[-1/0,g],[1/0,g]]}else if(f){var v=-o/e,m=-c/s;return v!==m?[]:[[v,-1/0],[v,1/0]]}else if(e===0){var y=-o/n,x=-(l*y+c)/s;d=[[x,y]]}else if(s===0){var y=-c/l,x=-(n*y+o)/e;d=[[x,y]]}else if(n===0){var x=-o/e,y=-(s*x+c)/l;d=[[x,y]]}else if(l===0){var x=-c/s,y=-(e*x+o)/n;d=[[x,y]]}else{var x=(n*c-l*o)/(l*e-n*s),y=-(e*x+o)/n;d=[[x,y]]}return d.map(function(_){return[_[0],_[1]]})}function getPointsOnLines(a,r){var e=r.map(function(g){return[0,1].map(function(p){return[Math.min(g[0][p],g[1][p]),Math.max(g[0][p],g[1][p])]})}),n=[];if(a.length===2){var o=a[0],s=o[0],l=o[1];if(tinyThrottle(s-a[1][0])){if(!tinyThrottle(l-a[1][1])){var f=Math.max.apply(Math,e.map(function(g){return g[0][0]})),d=Math.min.apply(Math,e.map(function(g){return g[0][1]}));if(tinyThrottle(f-d)>0)return[];n=[[f,l],[d,l]]}}else{var c=Math.max.apply(Math,e.map(function(g){return g[1][0]})),u=Math.min.apply(Math,e.map(function(g){return g[1][1]}));if(tinyThrottle(c-u)>0)return[];n=[[s,c],[s,u]]}}return n.length||(n=a.filter(function(g){var p=g[0],v=g[1];return e.every(function(m){return 0<=tinyThrottle(p-m[0][0])&&0<=tinyThrottle(m[0][1]-p)&&0<=tinyThrottle(v-m[1][0])&&0<=tinyThrottle(m[1][1]-v)})})),n.map(function(g){return[tinyThrottle(g[0]),tinyThrottle(g[1])]})}function convertLines(a){return __spreadArrays(a.slice(1),[a[0]]).map(function(r,e){return[a[e],r]})}function getOverlapPointInfos(a,r){var e=a.slice(),n=r.slice();getShapeDirection(e)===-1&&e.reverse(),getShapeDirection(n)===-1&&n.reverse();var o=convertLines(e),s=convertLines(n),l=o.map(function(d){return getLinearConstants(d[0],d[1])}),c=s.map(function(d){return getLinearConstants(d[0],d[1])}),u=[];l.forEach(function(d,g){var p=o[g],v=[];c.forEach(function(m,y){var x=getIntersectionPointsByConstants(d,m),_=getPointsOnLines(x,[p,s[y]]);v.push.apply(v,_.map(function(E){return{index1:g,index2:y,pos:E,type:"intersection"}}))}),v.sort(function(m,y){return getDist$1(p[0],m.pos)-getDist$1(p[0],y.pos)}),u.push.apply(u,v),isInside(p[1],n)&&u.push({index1:g,index2:-1,pos:p[1],type:"inside"})}),s.forEach(function(d,g){if(isInside(d[1],e)){var p=!1,v=findIndex(u,function(m){var y=m.index2;return y===g?(p=!0,!1):!!p});v===-1&&(p=!1,v=findIndex(u,function(m){var y=m.index1,x=m.index2;return y===-1&&x+1===g?(p=!0,!1):!!p})),v===-1?u.push({index1:-1,index2:g,pos:d[1],type:"inside"}):u.splice(v,0,{index1:-1,index2:g,pos:d[1],type:"inside"})}});var f={};return u.filter(function(d){var g=d.pos,p=g[0]+"x"+g[1];return f[p]?!1:(f[p]=!0,!0)})}function getOverlapPoints(a,r){var e=getOverlapPointInfos(a,r);return e.map(function(n){var o=n.pos;return o})}function getOverlapSize(a,r){var e=getOverlapPoints(a,r);return getAreaSize(e)}function add(a,r,e,n,o,s){for(var l=0;l<o;++l){var c=e+l*o,u=n+l*o;a[c]+=a[u]*s,r[c]+=r[u]*s}}function swap(a,r,e,n,o){for(var s=0;s<o;++s){var l=e+s*o,c=n+s*o,u=a[l],f=r[l];a[l]=a[c],a[c]=u,r[l]=r[c],r[c]=f}}function divide(a,r,e,n,o){for(var s=0;s<n;++s){var l=e+s*n;a[l]/=o,r[l]/=o}}function ignoreDimension(a,r,e){e===void 0&&(e=Math.sqrt(a.length));for(var n=a.slice(),o=0;o<e;++o)n[o*e+r-1]=0,n[(r-1)*e+o]=0;return n[(r-1)*(e+1)]=1,n}function invert(a,r){r===void 0&&(r=Math.sqrt(a.length));for(var e=a.slice(),n=createIdentityMatrix(r),o=0;o<r;++o){var s=r*o+o;if(!throttle(e[s],TINY_NUM)){for(var l=o+1;l<r;++l)if(e[r*o+l]){swap(e,n,o,l,r);break}}if(!throttle(e[s],TINY_NUM))return[];divide(e,n,o,r,e[s]);for(var l=0;l<r;++l){var c=l,u=l+o*r,f=e[u];!throttle(f,TINY_NUM)||o===l||add(e,n,c,o,r,-f)}}return n}function transpose(a,r){r===void 0&&(r=Math.sqrt(a.length));for(var e=[],n=0;n<r;++n)for(var o=0;o<r;++o)e[o*r+n]=a[r*n+o];return e}function getOrigin(a,r){r===void 0&&(r=Math.sqrt(a.length));for(var e=[],n=a[r*r-1],o=0;o<r-1;++o)e[o]=a[r*(r-1)+o]/n;return e[r-1]=0,e}function fromTranslation(a,r){for(var e=createIdentityMatrix(r),n=0;n<r-1;++n)e[r*(r-1)+n]=a[n]||0;return e}function convertPositionMatrix(a,r){for(var e=a.slice(),n=a.length;n<r-1;++n)e[n]=0;return e[r-1]=1,e}function convertDimension(a,r,e){if(r===void 0&&(r=Math.sqrt(a.length)),r===e)return a;for(var n=createIdentityMatrix(e),o=Math.min(r,e),s=0;s<o-1;++s){for(var l=0;l<o-1;++l)n[s*e+l]=a[s*r+l];n[(s+1)*e-1]=a[(s+1)*r-1],n[(e-1)*e+s]=a[(r-1)*r+s]}return n[e*e-1]=a[r*r-1],n}function multiplies(a){for(var r=[],e=1;e<arguments.length;e++)r[e-1]=arguments[e];var n=createIdentityMatrix(a);return r.forEach(function(o){n=multiply(n,o,a)}),n}function multiply(a,r,e){e===void 0&&(e=Math.sqrt(a.length));var n=[],o=a.length/e,s=r.length/o;if(o){if(!s)return a}else return r;for(var l=0;l<e;++l)for(var c=0;c<s;++c){n[c*e+l]=0;for(var u=0;u<o;++u)n[c*e+l]+=a[u*e+l]*r[c*o+u]}return n}function plus(a,r){for(var e=Math.min(a.length,r.length),n=a.slice(),o=0;o<e;++o)n[o]=n[o]+r[o];return n}function minus(a,r){for(var e=Math.min(a.length,r.length),n=a.slice(),o=0;o<e;++o)n[o]=n[o]-r[o];return n}function convertCSStoMatrix(a,r){return r===void 0&&(r=a.length===6),r?[a[0],a[1],0,a[2],a[3],0,a[4],a[5],1]:a}function convertMatrixtoCSS(a,r){return r===void 0&&(r=a.length===9),r?[a[0],a[1],a[3],a[4],a[6],a[7]]:a}function calculate(a,r,e){e===void 0&&(e=r.length);var n=multiply(a,r,e),o=n[e-1];return n.map(function(s){return s/o})}function rotateX3d(a,r){return multiply(a,[1,0,0,0,0,Math.cos(r),Math.sin(r),0,0,-Math.sin(r),Math.cos(r),0,0,0,0,1],4)}function rotateY3d(a,r){return multiply(a,[Math.cos(r),0,-Math.sin(r),0,0,1,0,0,Math.sin(r),0,Math.cos(r),0,0,0,0,1],4)}function rotateZ3d(a,r){return multiply(a,createRotateMatrix(r,4))}function scale3d(a,r){var e=r[0],n=e===void 0?1:e,o=r[1],s=o===void 0?1:o,l=r[2],c=l===void 0?1:l;return multiply(a,[n,0,0,0,0,s,0,0,0,0,c,0,0,0,0,1],4)}function rotate(a,r){return calculate(createRotateMatrix(r,3),convertPositionMatrix(a,3))}function translate3d(a,r){var e=r[0],n=e===void 0?0:e,o=r[1],s=o===void 0?0:o,l=r[2],c=l===void 0?0:l;return multiply(a,[1,0,0,0,0,1,0,0,0,0,1,0,n,s,c,1],4)}function matrix3d(a,r){return multiply(a,r,4)}function createRotateMatrix(a,r){var e=Math.cos(a),n=Math.sin(a),o=createIdentityMatrix(r);return o[0]=e,o[1]=n,o[r]=-n,o[r+1]=e,o}function createIdentityMatrix(a){for(var r=a*a,e=[],n=0;n<r;++n)e[n]=n%(a+1)?0:1;return e}function createScaleMatrix(a,r){for(var e=createIdentityMatrix(r),n=Math.min(a.length,r-1),o=0;o<n;++o)e[(r+1)*o]=a[o];return e}function createOriginMatrix(a,r){for(var e=createIdentityMatrix(r),n=Math.min(a.length,r-1),o=0;o<n;++o)e[r*(r-1)+o]=a[o];return e}function createWarpMatrix(a,r,e,n,o,s,l,c){var u=a[0],f=a[1],d=r[0],g=r[1],p=e[0],v=e[1],m=n[0],y=n[1],x=o[0],_=o[1],E=s[0],S=s[1],A=l[0],T=l[1],b=c[0],C=c[1],L=[u,0,d,0,p,0,m,0,f,0,g,0,v,0,y,0,1,0,1,0,1,0,1,0,0,u,0,d,0,p,0,m,0,f,0,g,0,v,0,y,0,1,0,1,0,1,0,1,-x*u,-_*u,-E*d,-S*d,-A*p,-T*p,-b*m,-C*m,-x*f,-_*f,-E*g,-S*g,-A*v,-T*v,-b*y,-C*y],R=invert(L,8);if(!R.length)return[];var I=multiply(R,[x,_,E,S,A,T,b,C],8);return I[8]=1,convertDimension(transpose(I),3,4)}var __assign$3=function(){return __assign$3=Object.assign||function(r){for(var e,n=1,o=arguments.length;n<o;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=e[s])}return r},__assign$3.apply(this,arguments)};function createMatrix(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function parseMat(a,r){return r===void 0&&(r=0),toMat(parse(a,r))}function calculateMatrixDist(a,r){var e=calculate(a,[r[0],r[1]||0,r[2]||0,1],4),n=e[3]||1;return[e[0]/n,e[1]/n,e[2]/n]}function getDistElementMatrix(a,r){r===void 0&&(r=document.body);for(var e=a,n=createMatrix();e;){var o=getComputedStyle(e).transform;if(n=matrix3d(parseMat(o),n),e===r)break;e=e.parentElement}return n=invert(n,4),n[12]=0,n[13]=0,n[14]=0,n}function toMat(a){var r=createMatrix();return a.forEach(function(e){var n=e.matrixFunction,o=e.functionValue;n&&(r=n(r,o))}),r}function parse(a,r){r===void 0&&(r=0);var e=isArray(a)?a:splitSpace(a);return e.map(function(n){var o=splitBracket(n),s=o.prefix,l=o.value,c=null,u=s,f="";if(s==="translate"||s==="translateX"||s==="translate3d"){var d=isObject(r)?__assign$3(__assign$3({},r),{"o%":r["%"]}):{"%":r,"o%":r},g=splitComma(l).map(function(D,O){return O===0&&"x%"in d?d["%"]=r["x%"]:O===1&&"y%"in d?d["%"]=r["y%"]:d["%"]=r["o%"],convertUnitSize(D,d)}),p=g[0],v=g[1],m=v===void 0?0:v,y=g[2],x=y===void 0?0:y;c=translate3d,f=[p,m,x]}else if(s==="translateY"){var _=isObject(r)?__assign$3({"%":r["y%"]},r):{"%":r},m=convertUnitSize(l,_);c=translate3d,f=[0,m,0]}else if(s==="translateZ"){var x=parseFloat(l);c=translate3d,f=[0,0,x]}else if(s==="scale"||s==="scale3d"){var E=splitComma(l).map(function(D){return parseFloat(D)}),S=E[0],A=E[1],T=A===void 0?S:A,b=E[2],C=b===void 0?1:b;c=scale3d,f=[S,T,C]}else if(s==="scaleX"){var S=parseFloat(l);c=scale3d,f=[S,1,1]}else if(s==="scaleY"){var T=parseFloat(l);c=scale3d,f=[1,T,1]}else if(s==="scaleZ"){var C=parseFloat(l);c=scale3d,f=[1,1,C]}else if(s==="rotate"||s==="rotateZ"||s==="rotateX"||s==="rotateY"){var L=splitUnit(l),R=L.unit,I=L.value,w=R==="rad"?I:I*Math.PI/180;s==="rotate"||s==="rotateZ"?(u="rotateZ",c=rotateZ3d):s==="rotateX"?c=rotateX3d:s==="rotateY"&&(c=rotateY3d),f=w}else if(s==="matrix3d")c=matrix3d,f=splitComma(l).map(function(D){return parseFloat(D)});else if(s==="matrix"){var M=splitComma(l).map(function(D){return parseFloat(D)});c=matrix3d,f=[M[0],M[1],0,0,M[2],M[3],0,0,0,0,1,0,M[4],M[5],0,1]}else u="";return{name:s,functionName:u,value:l,matrixFunction:c,functionValue:f}})}function hash$1(a){for(var r=5381,e=a.length;e;)r=r*33^a.charCodeAt(--e);return r>>>0}var stringHash=hash$1;function getHash(a){return stringHash(a).toString(36)}function getShadowRoot(a){if(a&&a.getRootNode){var r=a.getRootNode();if(r.nodeType===11)return r}}function replaceStyle(a,r,e){return e.original?r:r.replace(/([^};{\s}][^};{]*|^\s*){/mg,function(n,o){var s=o.trim();return(s?splitComma(s):[""]).map(function(l){var c=l.trim();return c.indexOf("@")===0?c:c.indexOf(":global")>-1?c.replace(/\:global/g,""):c.indexOf(":host")>-1?"".concat(c.replace(/\:host/g,".".concat(a))):c?".".concat(a," ").concat(c):".".concat(a)}).join(", ")+" {"})}function injectStyle(a,r,e,n,o){var s=getDocument(n),l=s.createElement("style");return l.setAttribute("type","text/css"),l.setAttribute("data-styled-id",a),l.setAttribute("data-styled-count","1"),e.nonce&&l.setAttribute("nonce",e.nonce),l.innerHTML=replaceStyle(a,r,e),(o||s.head||s.body).appendChild(l),l}function styled(a){var r="rCS"+getHash(a);return{className:r,inject:function(e,n){n===void 0&&(n={});var o=getShadowRoot(e),s=(o||e.ownerDocument||document).querySelector('style[data-styled-id="'.concat(r,'"]'));if(!s)s=injectStyle(r,a,n,e,o);else{var l=parseFloat(s.getAttribute("data-styled-count"))||0;s.setAttribute("data-styled-count","".concat(l+1))}return{destroy:function(){var c,u=parseFloat(s.getAttribute("data-styled-count"))||0;u<=1?(s.remove?s.remove():(c=s.parentNode)===null||c===void 0||c.removeChild(s),s=null):s.setAttribute("data-styled-count","".concat(u-1))}}}}}var extendStatics$1=function(a,r){return extendStatics$1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},extendStatics$1(a,r)};function __extends$1(a,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");extendStatics$1(a,r);function e(){this.constructor=a}a.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}var __assign$2=function(){return __assign$2=Object.assign||function(r){for(var e,n=1,o=arguments.length;n<o;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=e[s])}return r},__assign$2.apply(this,arguments)};function __rest(a,r){var e={};for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&r.indexOf(n)<0&&(e[n]=a[n]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(a);o<n.length;o++)r.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(a,n[o])&&(e[n[o]]=a[n[o]]);return e}function __decorate$1(a,r,e,n){var o=arguments.length,s=o<3?r:n===null?n=Object.getOwnPropertyDescriptor(r,e):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,r,e,n);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(s=(o<3?l(s):o>3?l(r,e,s):l(r,e))||s);return o>3&&s&&Object.defineProperty(r,e,s),s}function __spreadArray(a,r,e){if(e||arguments.length===2)for(var n=0,o=r.length,s;n<o;n++)(s||!(n in r))&&(s||(s=Array.prototype.slice.call(r,0,n)),s[n]=r[n]);return a.concat(s||Array.prototype.slice.call(r))}function getClient(a){if("touches"in a){var r=a.touches[0]||a.changedTouches[0];return{clientX:r.clientX,clientY:r.clientY}}else return{clientX:a.clientX,clientY:a.clientY}}function filterDuplicated(a){if(typeof Map>"u")return a.filter(function(e,n){return a.indexOf(e)===n});var r=new Map;return a.filter(function(e){return r.has(e)?!1:(r.set(e,!0),!0)})}function elementFromPoint(a,r,e){var n=getDocument(a);return n.elementFromPoint&&n.elementFromPoint(r,e)||null}function createElement(a,r,e){var n=a.tag,o=a.children,s=a.attributes,l=a.className,c=a.style,u=r||getDocument(e).createElement(n);for(var f in s)u.setAttribute(f,s[f]);var d=u.children;if(o.forEach(function(p,v){createElement(p,d[v],u)}),l&&l.split(" ").forEach(function(p){hasClass(u,p)||addClass(u,p)}),c){var g=u.style;for(var f in c)g[f]=c[f]}return!r&&e&&e.appendChild(u),u}function h(a,r){for(var e=[],n=2;n<arguments.length;n++)e[n-2]=arguments[n];var o=r||{},s=o.className,l=s===void 0?"":s,c=o.style,u=c===void 0?{}:c,f=__rest(o,["className","style"]);return{tag:a,className:l,style:u,attributes:f,children:e}}function diffValue(a,r,e){a!==r&&e(a,r)}function getRect(a,r,e){var n;e===void 0&&(e=a.data.boundArea);var o=a.distX,s=o===void 0?0:o,l=a.distY,c=l===void 0?0:l,u=a.data,f=u.startX,d=u.startY;if(r>0){var g=Math.sqrt((s*s+c*c)/(1+r*r)),p=r*g;s=(s>=0?1:-1)*p,c=(c>=0?1:-1)*g}var v=Math.abs(s),m=Math.abs(c),y=s<0?f-e.left:e.right-f,x=c<0?d-e.top:e.bottom-d;n=calculateBoundSize([v,m],[0,0],[y,x],!!r),v=n[0],m=n[1],s=(s>=0?1:-1)*v,c=(c>=0?1:-1)*m;var _=Math.min(0,s),E=Math.min(0,c),S=f+_,A=d+E;return{left:S,top:A,right:S+v,bottom:A+m,width:v,height:m}}function getDefaultElementRect(a){var r=a.getBoundingClientRect(),e=r.left,n=r.top,o=r.width,s=r.height;return{pos1:[e,n],pos2:[e+o,n],pos3:[e,n+s],pos4:[e+o,n+s]}}function passTargets(a,r,e){var n=diff(a,r),o=n.list,s=n.prevList,l=n.added,c=n.removed,u=n.maintained;return __spreadArray(__spreadArray(__spreadArray([],l.map(function(f){return o[f]}),!0),c.map(function(f){return s[f]}),!0),e?u.map(function(f){var d=f[1];return o[d]}):[],!0)}function getLineSize(a){for(var r=0,e=a.length,n=1;n<e;++n)r=Math.max(getDist$1(a[n],a[n-1]),r);return r}var injector=styled(`
:host {
    position: fixed;
    display: none;
    border: 1px solid #4af;
    background: rgba(68, 170, 255, 0.5);
    pointer-events: none;
    will-change: transform;
    z-index: 100;
}
`),CLASS_NAME="selecto-selection ".concat(injector.className),PROPERTIES=["boundContainer","selectableTargets","selectByClick","selectFromInside","continueSelect","continueSelectWithoutDeselect","toggleContinueSelect","toggleContinueSelectWithoutDeselect","keyContainer","hitRate","scrollOptions","checkInput","preventDefault","ratio","getElementRect","preventDragFromInside","rootContainer","dragCondition","clickBySelectEnd","checkOverflow","innerScrollOptions"],OPTIONS=__spreadArray(["dragContainer","cspNonce","preventClickEventOnDrag","preventClickEventOnDragStart","preventRightClick"],PROPERTIES,!0),EVENTS=["dragStart","drag","dragEnd","selectStart","select","selectEnd","keydown","keyup","scroll","innerScroll"],METHODS=["clickTarget","getSelectableElements","setSelectedTargets","getElementPoints","getSelectedTargets","findSelectableTargets","triggerDragStart","checkScroll","selectTargetsByPoints","setSelectedTargetsByPoints"],Selecto$2=function(a){__extends$1(r,a);function r(n){n===void 0&&(n={});var o=a.call(this)||this;o.selectedTargets=[],o.dragScroll=new DragScroll$1,o._onDragStart=function(c,u){var f=c.data,d=c.clientX,g=c.clientY,p=c.inputEvent,v=o.options,m=v.selectFromInside,y=v.selectByClick,x=v.rootContainer,_=v.boundContainer,E=v.preventDragFromInside,S=E===void 0?!0:E,A=v.clickBySelectEnd,T=v.dragCondition;if(T&&!T(c)){c.stop();return}f.data={};var b=getWindow(o.container);f.innerWidth=b.innerWidth,f.innerHeight=b.innerHeight,o.findSelectableTargets(f),f.startSelectedTargets=o.selectedTargets,f.scaleMatrix=createMatrix(),f.containerX=0,f.containerY=0;var C=o.container,L={left:-1/0,top:-1/0,right:1/0,bottom:1/0};if(x){var R=o.container.getBoundingClientRect();f.containerX=R.left,f.containerY=R.top,f.scaleMatrix=getDistElementMatrix(o.container,x)}if(_){var I=isObject(_)&&"element"in _?__assign$2({left:!0,top:!0,bottom:!0,right:!0},_):{element:_,left:!0,top:!0,bottom:!0,right:!0},w=I.element,M=void 0;if(w){isString(w)?M=getDocument(C).querySelector(w):w===!0?M=o.container:M=w;var D=M.getBoundingClientRect();I.left&&(L.left=D.left),I.top&&(L.top=D.top),I.right&&(L.right=D.right),I.bottom&&(L.bottom=D.bottom)}}f.boundArea=L;var O={left:d,top:g,right:d,bottom:g,width:0,height:0},F=[];if(!m||y&&!A){var k=o._findElement(u||p.target,f.selectableTargets);F=k?[k]:[]}var $=F.length>0,V=!m&&$;if(V&&!y)return c.stop(),!1;var N=p.type,B=N==="mousedown"||N==="touchstart",G=!c.isClick&&B?o.emit("dragStart",__assign$2(__assign$2({},c),{data:f.data})):!0;if(!G)return c.stop(),!1;if(o.continueSelect?(F=passTargets(o.selectedTargets,F,o.continueSelectWithoutDeselect),f.startPassedTargets=o.selectedTargets):f.startPassedTargets=[],o._select(F,O,c,!0),f.startX=d,f.startY=g,f.selectFlag=!1,f.preventDragFromInside=!1,p.target){var z=calculateMatrixDist(f.scaleMatrix,[d-f.containerX,g-f.containerY]);o.target.style.cssText+="position: ".concat(x?"absolute":"fixed",";")+"left:0px;top:0px;"+"transform: translate(".concat(z[0],"px, ").concat(z[1],"px)")}if(V&&y&&!A)p.preventDefault(),S&&(o._selectEnd(f.startSelectedTargets,f.startPassedTargets,O,c),f.preventDragFromInside=!0);else{f.selectFlag=!0;var H=o.options,W=H.scrollOptions,Y=H.innerScrollOptions,K=!1;if(Y){for(var Z=c.inputEvent,tt=Z.target,et=null,at=tt;at&&at!==getDocument(C).body;){var ot=getComputedStyle(at).overflow!=="visible";if(ot){et=at;break}at=at.parentElement}et&&(f.innerScrollOptions=__assign$2({container:et,checkScrollEvent:!0},Y===!0?{}:Y),o.dragScroll.dragStart(c,f.innerScrollOptions),K=!0)}!K&&W&&W.container&&o.dragScroll.dragStart(c,W),A&&(f.selectFlag=!1,c.preventDrag())}return!0},o._onDrag=function(c){if(c.data.selectFlag){var u=o.scrollOptions,f=c.data.innerScrollOptions,d=f||(u==null?void 0:u.container);if(d&&!c.isScroll&&o.dragScroll.drag(c,f||u))return}o._checkSelected(c)},o._onDragEnd=function(c){var u=c.data,f=c.inputEvent,d=getRect(c,o.options.ratio),g=u.selectFlag,p=o.container;if(f&&o.emit("dragEnd",__assign$2(__assign$2({isDouble:!!c.isDouble,isClick:!!c.isClick,isDrag:!1,isSelect:g},c),{data:u.data,rect:d})),o.target.style.cssText+="display: none;",g)u.selectFlag=!1,o.dragScroll.dragEnd();else if(o.selectByClick&&o.clickBySelectEnd){var v=o._findElement((f==null?void 0:f.target)||elementFromPoint(p,c.clientX,c.clientY),u.selectableTargets);o._select(v?[v]:[],d,c)}u.preventDragFromInside||o._selectEnd(u.startSelectedTargets,u.startPassedTargets,d,c)},o._onKeyDown=function(c){var u=o.options,f=!1;if(!o._keydownContinueSelect){var d=o._sameCombiKey(c,u.toggleContinueSelect);o._keydownContinueSelect=d,f||(f=d)}if(!o._keydownContinueSelectWithoutDeselection){var d=o._sameCombiKey(c,u.toggleContinueSelectWithoutDeselect);o._keydownContinueSelectWithoutDeselection=d,f||(f=d)}f&&o.emit("keydown",{keydownContinueSelect:o._keydownContinueSelect,keydownContinueSelectWithoutDeselection:o._keydownContinueSelectWithoutDeselection})},o._onKeyUp=function(c){var u=o.options,f=!1;if(o._keydownContinueSelect){var d=o._sameCombiKey(c,u.toggleContinueSelect,!0);o._keydownContinueSelect=!d,f||(f=d)}if(o._keydownContinueSelectWithoutDeselection){var d=o._sameCombiKey(c,u.toggleContinueSelectWithoutDeselect,!0);o._keydownContinueSelectWithoutDeselection=!d,f||(f=d)}f&&o.emit("keyup",{keydownContinueSelect:o._keydownContinueSelect,keydownContinueSelectWithoutDeselection:o._keydownContinueSelectWithoutDeselection})},o._onBlur=function(){(o._keydownContinueSelect||o._keydownContinueSelectWithoutDeselection)&&(o._keydownContinueSelect=!1,o._keydownContinueSelectWithoutDeselection=!1,o.emit("keyup",{keydownContinueSelect:o._keydownContinueSelect,keydownContinueSelectWithoutDeselection:o._keydownContinueSelectWithoutDeselection}))},o._onDocumentSelectStart=function(c){var u=getDocument(o.container);if(o.gesto.isFlag()){var f=o.dragContainer;f===getWindow(o.container)&&(f=u.documentElement);var d=isNode(f)?[f]:[].slice.call(f),g=c.target;d.some(function(p){if(p===g||p.contains(g))return c.preventDefault(),!0})}},o.target=n.portalContainer;var s=n.container;o.options=__assign$2({portalContainer:null,container:null,dragContainer:null,selectableTargets:[],selectByClick:!0,selectFromInside:!0,clickBySelectEnd:!1,hitRate:100,continueSelect:!1,continueSelectWithoutDeselect:!1,toggleContinueSelect:null,toggleContinueSelectWithoutDeselect:null,keyContainer:null,scrollOptions:void 0,checkInput:!1,preventDefault:!1,boundContainer:!1,preventDragFromInside:!0,dragCondition:null,rootContainer:null,checkOverflow:!1,innerScrollOptions:!1,getElementRect:getDefaultElementRect,cspNonce:"",ratio:0},n);var l=o.options.portalContainer;return l&&(s=l.parentElement),o.container=s||document.body,o.initElement(),o.initDragScroll(),o.setKeyController(),o}var e=r.prototype;return e.setSelectedTargets=function(n){var o=this.selectedTargets,s=diff(o,n),l=s.added,c=s.removed,u=s.prevList,f=s.list;return this.selectedTargets=n,{added:l.map(function(d){return f[d]}),removed:c.map(function(d){return u[d]}),beforeSelected:o,selected:n}},e.setSelectedTargetsByPoints=function(n,o){var s=Math.min(n[0],o[0]),l=Math.min(n[1],o[1]),c=Math.max(n[0],o[0]),u=Math.max(n[1],o[1]),f={left:s,top:l,right:c,bottom:u,width:c-s,height:u-l},d={ignoreClick:!0};this.findSelectableTargets(d);var g=this.hitTest(f,d),p=this.setSelectedTargets(g);return __assign$2(__assign$2({},p),{rect:f})},e.selectTargetsByPoints=function(n,o){var s=new MouseEvent("mousedown",{clientX:n[0],clientY:n[1],cancelable:!0,bubbles:!0}),l=new MouseEvent("mousemove",{clientX:o[0],clientY:o[1],cancelable:!0,bubbles:!0}),c=new MouseEvent("mousemove",{clientX:o[0],clientY:o[1],cancelable:!0,bubbles:!0}),u=this.gesto,f=u.onDragStart(s);f!==!1&&(u.onDrag(l),u.onDragEnd(c))},e.getSelectedTargets=function(){return this.selectedTargets},e.triggerDragStart=function(n){return this.gesto.triggerDragStart(n),this},e.destroy=function(){var n;this.off(),this.keycon&&this.keycon.destroy(),this.gesto.unset(),this.injectResult.destroy(),this.dragScroll.dragEnd(),removeEvent(document,"selectstart",this._onDocumentSelectStart),this.options.portalContainer||(n=this.target.parentElement)===null||n===void 0||n.removeChild(this.target),this.keycon=null,this.gesto=null,this.injectResult=null,this.target=null,this.container=null,this.options=null},e.getElementPoints=function(n){var o=this.getElementRect||getDefaultElementRect,s=o(n),l=[s.pos1,s.pos2,s.pos4,s.pos3];if(o!==getDefaultElementRect){var c=n.getBoundingClientRect();return fitPoints(l,c)}return l},e.getSelectableElements=function(){var n=this.container,o=[];return this.options.selectableTargets.forEach(function(s){if(isFunction(s)){var l=s();l&&o.push.apply(o,[].slice.call(l))}else if(isNode(s))o.push(s);else if(isObject(s))o.push(s.value||s.current);else{var c=[].slice.call(getDocument(n).querySelectorAll(s));o.push.apply(o,c)}}),o},e.checkScroll=function(){if(this.gesto.isFlag()){var n=this.scrollOptions,o=this.gesto.getEventData().innerScrollOptions,s=o||(n==null?void 0:n.container);s&&this.dragScroll.checkScroll(__assign$2({inputEvent:this.gesto.getCurrentEvent()},o||n))}},e.findSelectableTargets=function(n){var o=this;n===void 0&&(n=this.gesto.getEventData());var s=this.getSelectableElements(),l=s.map(function(g){return o.getElementPoints(g)});n.selectableTargets=s,n.selectablePoints=l,n.selectableParentMap=null;var c=this.options,u=c.checkOverflow||c.innerScrollOptions,f=getDocument(this.container);if(u){var d=new Map;n.selectableInnerScrollParentMap=d,n.selectableInnerScrollPathsList=s.map(function(g,p){for(var v=g.parentElement,m=[],y=[],x=function(){var _=d.get(v);if(!_){var E=getComputedStyle(v).overflow!=="visible";if(E){var S=getDefaultElementRect(v);_={parentElement:v,indexes:[],points:[S.pos1,S.pos2,S.pos4,S.pos3],paths:__spreadArray([],y,!0)},m.push(v),m.forEach(function(A){d.set(A,_)}),m=[]}}_?(v=_.parentElement,d.get(v).indexes.push(p),y.push(v)):m.push(v),v=v.parentElement};v&&v!==f.body;)x();return y})}return c.checkOverflow||(n.selectableInners=s.map(function(){return!0})),this._refreshGroups(n),s},e.clickTarget=function(n,o){var s=getClient(n),l=s.clientX,c=s.clientY,u={data:{selectFlag:!1},clientX:l,clientY:c,inputEvent:n,isClick:!0,isTrusted:!1,stop:function(){return!1}};return this._onDragStart(u,o)&&this._onDragEnd(u),this},e.setKeyController=function(){var n=this.options,o=n.keyContainer,s=n.toggleContinueSelect,l=n.toggleContinueSelectWithoutDeselect;this.keycon&&(this.keycon.destroy(),this.keycon=null),(s||l)&&(this.keycon=new KeyController$1(o||getWindow(this.container)),this.keycon.keydown(this._onKeyDown).keyup(this._onKeyUp).on("blur",this._onBlur))},e.setKeyEvent=function(){var n=this.options,o=n.toggleContinueSelect,s=n.toggleContinueSelectWithoutDeselect;!o&&!s||this.keycon||this.setKeyController()},e.setKeyContainer=function(n){var o=this,s=this.options;diffValue(s.keyContainer,n,function(){s.keyContainer=n,o.setKeyController()})},e.getContinueSelect=function(){var n=this.options,o=n.continueSelect,s=n.toggleContinueSelect;return!s||!this._keydownContinueSelect?o:!o},e.getContinueSelectWithoutDeselect=function(){var n=this.options,o=n.continueSelectWithoutDeselect,s=n.toggleContinueSelectWithoutDeselect;return!s||!this._keydownContinueSelectWithoutDeselection?o:!o},e.setToggleContinueSelect=function(n){var o=this,s=this.options;diffValue(s.toggleContinueSelect,n,function(){s.toggleContinueSelect=n,o.setKeyEvent()})},e.setToggleContinueSelectWithoutDeselect=function(n){var o=this,s=this.options;diffValue(s.toggleContinueSelectWithoutDeselect,n,function(){s.toggleContinueSelectWithoutDeselect=n,o.setKeyEvent()})},e.setPreventDefault=function(n){this.gesto.options.preventDefault=n},e.setCheckInput=function(n){this.gesto.options.checkInput=n},e.initElement=function(){var n=this.container;this.target=createElement(h("div",{className:CLASS_NAME}),this.target,n);var o=this.target,s=this.options,l=s.dragContainer,c=s.checkInput,u=s.preventDefault,f=s.preventClickEventOnDragStart,d=s.preventClickEventOnDrag,g=s.preventClickEventByCondition,p=s.preventRightClick,v=p===void 0?!0:p;this.dragContainer=typeof l=="string"?[].slice.call(getDocument(n).querySelectorAll(l)):l||this.target.parentNode,this.gesto=new Gesto(this.dragContainer,{checkWindowBlur:!0,container:getWindow(n),checkInput:c,preventDefault:u,preventClickEventOnDragStart:f,preventClickEventOnDrag:d,preventClickEventByCondition:g,preventRightClick:v}).on({dragStart:this._onDragStart,drag:this._onDrag,dragEnd:this._onDragEnd}),addEvent(document,"selectstart",this._onDocumentSelectStart),this.injectResult=injector.inject(o,{nonce:this.options.cspNonce})},e.hitTest=function(n,o,s){var l=this.options,c=l.hitRate,u=l.selectByClick,f=n.left,d=n.top,g=n.right,p=n.bottom,v=o.innerGroups,m=o.innerWidth,y=o.innerHeight,x=s==null?void 0:s.clientX,_=s==null?void 0:s.clientY,E=o.ignoreClick,S=[[f,d],[g,d],[g,p],[f,p]],A=splitUnit("".concat(c)),T=function(V,N){var B=E?!1:isInside([x,_],V);if(u&&B)return!0;var G=getOverlapPoints(S,V);if(!G.length)return!1;var z=getAreaSize(G),H=0;if(z===0&&getAreaSize(V)===0?(H=getLineSize(V),z=getLineSize(G)):H=getAreaSize(V),A.unit==="px")return z>=A.value;var W=between(Math.round(z/H*100),0,100);return W>=Math.min(100,A.value)},b=o.selectableTargets,C=o.selectablePoints,L=o.selectableInners;if(!v)return b.filter(function(V,N){return L[N]?T(C[N],b[N]):!1});for(var R=[],I=Math.floor(f/m),w=Math.floor(g/m),M=Math.floor(d/y),D=Math.floor(p/y),O=I;O<=w;++O){var F=v[O];if(F)for(var k=M;k<=D;++k){var $=F[k];$&&$.forEach(function(V){var N=C[V],B=L[V],G=b[V];B&&T(N)&&R.push(G)})}}return filterDuplicated(R)},e.initDragScroll=function(){var n=this;this.dragScroll.on("scrollDrag",function(o){var s=o.next;s(n.gesto.getCurrentEvent())}).on("scroll",function(o){var s=o.container,l=o.direction,c=n.gesto.getEventData().innerScrollOptions;c?n.emit("innerScroll",{container:s,direction:l}):n.emit("scroll",{container:s,direction:l})}).on("move",function(o){var s=o.offsetX,l=o.offsetY,c=o.inputEvent,u=n.gesto;if(!(!u||!u.isFlag())){var f=n.gesto.getEventData(),d=f.boundArea;f.startX-=s,f.startY-=l;var g=n.gesto.getEventData().innerScrollOptions,p=g==null?void 0:g.container,v=!1;if(p){var m=f.selectableInnerScrollParentMap,y=m.get(p);y&&(y.paths.forEach(function(x){var _=m.get(x);_.points.forEach(function(E){E[0]-=s,E[1]-=l})}),y.indexes.forEach(function(x){f.selectablePoints[x].forEach(function(_){_[0]-=s,_[1]-=l})}),v=!0)}v||f.selectablePoints.forEach(function(x){x.forEach(function(_){_[0]-=s,_[1]-=l})}),n._refreshGroups(f),d.left-=s,d.right-=s,d.top-=l,d.bottom-=l,n.gesto.scrollBy(s,l,c.inputEvent),n._checkSelected(n.gesto.getCurrentEvent())}})},e._select=function(n,o,s,l){var c=s.inputEvent,u=s.data,f=this.setSelectedTargets(n);l&&this.emit("selectStart",__assign$2(__assign$2({},f),{rect:o,inputEvent:c,data:u.data,isTrusted:s.isTrusted})),(f.added.length||f.removed.length)&&this.emit("select",__assign$2(__assign$2({},f),{rect:o,inputEvent:c,data:u.data,isTrusted:s.isTrusted}))},e._selectEnd=function(n,o,s,l){var c=l.inputEvent,u=l.isDouble,f=l.data,d=diff(n,this.selectedTargets),g=d.added,p=d.removed,v=d.prevList,m=d.list,y=diff(o,this.selectedTargets),x=y.added,_=y.removed,E=y.prevList,S=y.list,A=c&&c.type,T=A==="mousedown"||A==="touchstart";this.emit("selectEnd",{startSelected:n,beforeSelected:o,selected:this.selectedTargets,added:g.map(function(b){return m[b]}),removed:p.map(function(b){return v[b]}),afterAdded:x.map(function(b){return S[b]}),afterRemoved:_.map(function(b){return E[b]}),isDragStart:T,isClick:!!l.isClick,isDouble:!!u,rect:s,inputEvent:c,data:f.data,isTrusted:l.isTrusted})},e._checkSelected=function(n,o){o===void 0&&(o=getRect(n,this.options.ratio));var s=n.data,l=o.top,c=o.left,u=o.width,f=o.height,d=s.selectFlag,g=s.containerX,p=s.containerY,v=s.scaleMatrix,m=calculateMatrixDist(v,[c-g,l-p]),y=calculateMatrixDist(v,[u,f]),x=[];if(d){this.target.style.cssText+="display: block;left:0px;top:0px;"+"transform: translate(".concat(m[0],"px, ").concat(m[1],"px);")+"width:".concat(y[0],"px;height:").concat(y[1],"px;");var _=this.hitTest(o,s,n);x=passTargets(s.startPassedTargets,_,this.continueSelect&&this.continueSelectWithoutDeselect)}var E=this.emit("drag",__assign$2(__assign$2({},n),{data:s.data,isSelect:d,rect:o}));if(E===!1){this.target.style.cssText+="display: none;",n.stop();return}d&&this._select(x,o,n)},e._sameCombiKey=function(n,o,s){if(!o)return!1;var l=getCombi(n.inputEvent,n.key),c=[].concat(o),u=isArray(c[0])?c:[c];if(s){var f=n.key;return u.some(function(d){return d.some(function(g){return g===f})})}return u.some(function(d){return d.every(function(g){return l.indexOf(g)>-1})})},e._findElement=function(n,o){for(var s=n;s&&!(o.indexOf(s)>-1);)s=s.parentElement;return s},e._refreshGroups=function(n){var o,s=n.innerWidth,l=n.innerHeight,c=n.selectablePoints;if(this.options.checkOverflow){var u=(o=this.gesto.getEventData().innerScrollOptions)===null||o===void 0?void 0:o.container,f=n.selectableInnerScrollParentMap,d=n.selectableInnerScrollPathsList;n.selectableInners=d.map(function(v,m){var y=!1;return v.every(function(x){if(y)return!0;if(x===u)return y=!0,!0;var _=f.get(x);if(_){var E=c[m],S=_.points,A=getOverlapPoints(E,S);if(!A.length)return!1}return!0})})}if(!s||!l)n.innerGroups=null;else{var g=n.selectablePoints,p={};g.forEach(function(v,m){var y=1/0,x=-1/0,_=1/0,E=-1/0;v.forEach(function(T){var b=Math.floor(T[0]/s),C=Math.floor(T[1]/l);y=Math.min(b,y),x=Math.max(b,x),_=Math.min(C,_),E=Math.max(C,E)});for(var S=y;S<=x;++S)for(var A=_;A<=E;++A)p[S]=p[S]||{},p[S][A]=p[S][A]||[],p[S][A].push(m)}),n.innerGroups=p}},r=__decorate$1([Properties(PROPERTIES,function(n,o){var s={enumerable:!0,configurable:!0,get:function(){return this.options[o]}},l=camelize("get ".concat(o));n[l]?s.get=function(){return this[l]()}:s.get=function(){return this.options[o]};var c=camelize("set ".concat(o));n[c]?s.set=function(f){this[c](f)}:s.set=function(f){this.options[o]=f},Object.defineProperty(n,o,s)})],r),r}(EventEmitter$2),Selecto$1$1=function(a){__extends$1(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}return r}(Selecto$2);const VanillaSelecto=Selecto$1$1;var extendStatics=function(a,r){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},extendStatics(a,r)};function __extends(a,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");extendStatics(a,r);function e(){this.constructor=a}a.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}var __assign$1=function(){return __assign$1=Object.assign||function(r){for(var e,n=1,o=arguments.length;n<o;n++){e=arguments[n];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=e[s])}return r},__assign$1.apply(this,arguments)};function __decorate(a,r,e,n){var o=arguments.length,s=o<3?r:n===null?n=Object.getOwnPropertyDescriptor(r,e):n,l;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,r,e,n);else for(var c=a.length-1;c>=0;c--)(l=a[c])&&(s=(o<3?l(s):o>3?l(r,e,s):l(r,e))||s);return o>3&&s&&Object.defineProperty(r,e,s),s}var REACT_EVENTS=EVENTS.map(function(a){return camelize("on ".concat(a))}),Selecto=function(a){__extends(r,a);function r(){return a!==null&&a.apply(this,arguments)||this}var e=r.prototype;return e.render=function(){return reactExports.createElement("div",{className:CLASS_NAME,ref:ref(this,"selectionElement")})},e.componentDidMount=function(){var n=this,o=this.props,s={};OPTIONS.forEach(function(l){l in o&&(s[l]=o[l])}),this.selecto=new VanillaSelecto(__assign$1(__assign$1({},s),{portalContainer:this.selectionElement})),EVENTS.forEach(function(l,c){n.selecto.on(l,function(u){var f=n.props,d=f[REACT_EVENTS[c]]&&f[REACT_EVENTS[c]](u);d===!1&&u.stop()})})},e.componentDidUpdate=function(n){var o=this.props,s=this.selecto;PROPERTIES.forEach(function(l){n[l]!==o[l]&&(s[l]=o[l])})},e.componentWillUnmount=function(){this.selecto.destroy()},__decorate([withMethods(METHODS)],r.prototype,"selecto",void 0),r}(reactExports.PureComponent);const Selecto$1=Selecto,pt=class pt{static iterateLayerLink(r,e){const{layerConfigs:n}=layerManager;let o=n[r];if(o){e.push(o.id),o.childHeader&&pt.iterateLayerLink(o.childHeader,e);let s=n[o.next];for(;s;)s.childHeader&&pt.iterateLayerLink(s.childHeader,e),e.push(s.id),s=n[s.next]}}};U(pt,"findTopGroupLayer",(r,e=!1)=>{const n=new Set,{layerConfigs:o}=layerManager;return r.forEach(s=>{var u;let l=s,c=(u=o[s])==null?void 0:u.pid;for(;c;){const{pid:f,id:d}=o[c];c=f,l=d}(e||l!==s)&&n.add(l)}),Array.from(n)}),U(pt,"findAllChildLayerBySubId",(r,e=!1)=>{const n=pt.findTopGroupLayer(r,e);return pt.findAllChildLayer(n)}),U(pt,"findAllChildLayer",(r,e=!0)=>{let n=[];const{layerConfigs:o}=layerManager;return r.forEach(s=>{n.push(s);let l=o[s];l.childHeader&&pt.iterateLayerLink(l.childHeader,n)}),e||(n=n.filter(s=>!r.includes(s))),[...new Set(n)]}),U(pt,"hasSameGroup",r=>{if(r.length<=1)return!1;const{layerConfigs:e}=layerManager;if(r.some(o=>e[o].type!=="group"&&!e[o].pid))return!1;const n=new Set;return r.filter(o=>e[o].type!=="group").forEach(o=>{pt.findTopGroupLayer([o],!0).forEach(s=>n.add(s))}),n.size===1});let LayerUtil=pt;function setControlPointLineColor(a){const{targetIds:r}=eventOperateStore;if(r.length===0)return;const e=document.querySelectorAll(".moveable-control,.moveable-line");e&&(a?e.forEach(n=>{n.style.backgroundColor="#ff4b29"}):e.forEach(n=>{n.style.backgroundColor="#00bbffff"}))}class DesignerSelectable extends reactExports.Component{constructor(){super(...arguments);U(this,"selectorRef",React.createRef());U(this,"onSelectEnd",e=>{var p;const{selected:n}=e,{movableRef:o,setTargetIds:s}=eventOperateStore;if(!o)return;const l=o;if(e.isDragStart){e.inputEvent.preventDefault();const v=setTimeout(()=>{l.dragStart(e.inputEvent),clearTimeout(v)})}const{layerConfigs:c}=layerManager;let u=n.map(v=>v.id),f=!!((p=c[u[0]])!=null&&p.lock);if(u.length===1)e.inputEvent.shiftKey||c[u[0]].pid&&(u=LayerUtil.findAllChildLayerBySubId(u));else if(u.length>1){const v=LayerUtil.findAllChildLayerBySubId(u,!0);for(let m=0;m<v.length;m++){const y=c[v[m]];if(y.lock!==f&&y.type!=="group"){f=!1;break}}u=v.filter(m=>c[m].lock===f)}s(u);const{layerInstances:d}=layerListStore$1,{menu:g}=designerLeftStore;g==="layer-list"&&u.forEach(v=>{var m;(m=d[v])==null||m.setState({selected:!0})}),setControlPointLineColor(f)});U(this,"onDragStart",e=>{const{movableRef:n,targets:o}=eventOperateStore,s=n,l=e.inputEvent.target;(s.isMoveableElement(l)||o.some(c=>c===l||c.contains(l)))&&e.stop()})}componentDidMount(){const{setSelectorRef:e}=eventOperateStore;e(this.selectorRef.current)}render(){return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[this.props.children,jsxRuntimeExports.jsx(Selecto$1,{ref:this.selectorRef,dragContainer:".lc-event-container",selectableTargets:[".lc-comp-item"],hitRate:0,selectByClick:!0,selectFromInside:!1,toggleContinueSelect:["ctrl"],ratio:0,onDragStart:this.onDragStart,onSelectEnd:this.onSelectEnd})]})}}const DesignerSelectable$1=observer(DesignerSelectable),DesignerSelectable$2=Object.freeze(Object.defineProperty({__proto__:null,default:DesignerSelectable$1,setControlPointLineColor},Symbol.toStringTag,{value:"Module"}));var OperateType=(a=>(a[a.DRAG=0]="DRAG",a[a.RESIZE=1]="RESIZE",a[a.ADD=2]="ADD",a[a.DEL=3]="DEL",a[a.UPD_STYLE=4]="UPD_STYLE",a[a.HIDE=5]="HIDE",a[a.ORDER=6]="ORDER",a[a.LOCK=7]="LOCK",a[a.UPDATE_LAYER=8]="UPDATE_LAYER",a))(OperateType||{});class HistoryQueue{constructor(r=10){U(this,"capacity");U(this,"elements");U(this,"front");U(this,"rear");U(this,"size");U(this,"back");U(this,"backAll");U(this,"circulate",!1);U(this,"backCount",0);this.capacity=r,this.elements=new Array(r),this.front=0,this.rear=-1,this.size=0,this.back=this.rear,this.backAll=!1}enqueue(r){this.size===this.capacity&&!this.backAll&&(this.circulate=!0,this.front=(this.front+1)%this.capacity),this.back!==this.rear?(this.rear=(this.back+1)%this.capacity,this.elements[this.rear]=r,this.size-=this.backCount,this.backCount=0):(this.rear=(this.rear+1)%this.capacity,this.elements[this.rear]=r),this.size<this.capacity&&this.size++,this.back=this.rear,this.backAll=!1}getFront(){return this.size===0?null:this.elements[this.front]}getRear(){return this.size===0?null:this.elements[this.rear]}backoff(){if(this.size===0||this.backAll)return null;this.back===this.front&&(this.backAll=!0);const r=this.elements[this.back];return this.back=(this.back-1+this.capacity)%this.capacity,this.backCount++,r}forward(){return this.size===0||this.back===this.rear?null:(this.back=(this.back+1)%this.capacity,this.backAll&&(this.backAll=!1),this.elements[this.back])}getBackPointElem(){return this.elements[this.back]}isEmpty(){return this.size===0}isFull(){return this.size===this.capacity}getSize(){return this.size}getBack(){return this.back}getCirculate(){return this.circulate}}class HistoryOperator{constructor(){U(this,"queue",new HistoryQueue(100))}put(r){this.queue.enqueue(r)}backoff(){return this.queue.backoff()}forward(){return this.queue.forward()}}const historyOperator=new HistoryOperator;class HistoryRecordOperateProxy{doDrag(r){const{layerConfigs:e,updateLayer:n}=layerManager,o=[];let s,l;if(r.length===1){const u=e[r[0].id];s={ids:[r[0].id],x:u.x,y:u.y};const{id:f,x:d=0,y:g=0}=r[0];l={ids:[f],x:d,y:g}}else{const u=[];r.forEach(p=>o.push(p.id)),o.forEach(p=>u.push(e[p]));let f=1/0,d=1/0;u.forEach(p=>{p.x<f&&(f=p.x),p.y<d&&(d=p.y)}),s={ids:o,x:f,y:d};const{groupCoordinate:g}=eventOperateStore;l={ids:o,x:g.minX,y:g.minY}}const c={type:OperateType.DRAG,prev:s,next:l};n(r,!1),historyOperator.put({actions:[c]})}doResize(r,e){const{layerConfigs:n,updateLayer:o}=layerManager,s=[];let l,c;if(r.length===1){const{width:f=0,height:d=0}=n[r[0].id];l={ids:[r[0].id],width:f,height:d,direction:e};const{id:g}=r[0];c={ids:[g],width:r[0].width,height:r[0].height,direction:e}}else{const f=[];r.forEach(_=>s.push(_.id)),s.forEach(_=>f.push(n[_]));let d=1/0,g=1/0,p=-1/0,v=-1/0;f.forEach(_=>{const{x:E=0,y:S=0}=_;E<d&&(d=E),S<g&&(g=S),E+_.width>p&&(p=E+_.width),S+_.height>v&&(v=S+_.height)});const m=p-d,y=v-g;l={ids:s,width:m,height:y,direction:e};const{groupCoordinate:x}=eventOperateStore;c={ids:s,width:x.groupWidth,height:x.groupHeight,direction:e}}const u={type:OperateType.RESIZE,prev:l,next:c};o(r,!1),historyOperator.put({actions:[u]})}doAdd(r){const e=[],n=[],o=[],s=[],{layerConfigs:l,updateLayer:c}=layerManager;if(!layerManager.layerHeader)e.push({layerHeader:void 0,layerTail:void 0}),layerManager.layerHeader=r.id,layerManager.layerTail=r.id;else{e.push({layerHeader:layerManager.layerHeader});const d=l[layerManager.layerHeader];o.push({id:d.id,prev:d.prev}),d.prev=r.id,r.next=d.id,layerManager.layerHeader=r.id,s.push({id:d.id,prev:r.id})}n.push({id:r.id,layerConfig:lodashExports.cloneDeep(r),layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail});const{addRecordCompId:u,setAddRecordCompId:f}=eventOperateStore;u&&u===r.id&&(historyOperator.put({actions:[{type:OperateType.ADD,prev:e,next:n},{type:OperateType.UPDATE_LAYER,prev:o,next:s}]}),f(null)),l[r.id+""]=r,c(s)}doDelete(){let{targetIds:r,setTargetIds:e}=eventOperateStore;if(r.length===0)return;const{setContentVisible:n,activeConfig:o,activeElem:s}=rightStore;r.includes(s.id)&&(n(!1),o(null,""));const{delItem:l,layerConfigs:c,compController:u}=layerManager,f=[],d=[],g=[],p=[],v=new Set;r.forEach(y=>{const x=c[y];if(v.add(y),x.next&&v.add(x.next),x.prev&&v.add(x.prev),x.pid){const _=c[x.pid];_.childHeader===y&&v.add(_.id),_.childTail===y&&v.add(_.id)}});const m=Array.from(v).filter(y=>!r.includes(y));r.forEach(y=>{const x=c[y],_=u[y]&&u[y].getConfig();f.push({id:y,layerConfig:lodashExports.cloneDeep(x),elemConfig:_})}),g.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),m.forEach(y=>{const x=c[y],{next:_,prev:E,childHeader:S,childTail:A,pid:T}=x;g.push({id:y,next:_,prev:E,childHeader:S,childTail:A,pid:T})}),runInAction(()=>{r.forEach(y=>{const x=c[y],_=c[x.prev],E=c[x.next];if(x.id===layerManager.layerHeader&&(layerManager.layerHeader=x.next),x.id===layerManager.layerTail&&(layerManager.layerTail=x.prev),_&&(_.next=x==null?void 0:x.next),E&&(E.prev=x==null?void 0:x.prev),x.pid){const S=c[x.pid];S.childHeader===y&&(S.childHeader=x==null?void 0:x.next),S.childTail===y&&(S.childTail=x==null?void 0:x.prev)}}),l(r)}),m.forEach(y=>{const x=c[y],{next:_,prev:E,childHeader:S,childTail:A,pid:T}=x;p.push({id:y,next:_,prev:E,childHeader:S,childTail:A,pid:T})}),d.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),historyOperator.put({actions:[{type:OperateType.DEL,prev:f,next:d},{type:OperateType.UPDATE_LAYER,prev:g,next:p}]}),e([]),eventOperateStore==null||eventOperateStore.focusDesignerCanvas()}doCopy(r){if(r.length===0)return[];const e=[],n=[],o=[],s=[],l={},c=[],u=[],f=new Set;if(r.forEach(d=>{const g=layerManager.layerConfigs[d];if(f.add(d),g.prev&&f.add(g.prev),g.pid){const p=layerManager.layerConfigs[g.pid];p&&(f.add(p.id),f.add(p.childHeader))}}),o.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),f.forEach(d=>{const g=layerManager.layerConfigs[d],{prev:p,next:v,childHeader:m,childTail:y,pid:x}=g;o.push({id:d,prev:p,next:v,childHeader:m,childTail:y,pid:x})}),runInAction(()=>{const{layerConfigs:d,compController:g,elemConfigs:p}=layerManager;r.forEach(v=>{const m=d[v],y=lodashExports.cloneDeep(m);y.id=IdGenerate.generateId(),y.prev=void 0,y.next=void 0,y.type!=="group"&&(y.x=y.x+10,y.y=y.y+10),d[y.id]=y,l[v]=y.id;const x=g[m.id];if(x){const _=lodashExports.cloneDeep(x.getConfig());_.base.id=y.id,p[y.id]=_}u.push(y.id),c.push(y)}),r.forEach(v=>{const m=d[v],y=d[l[v]];if(m.type==="group"&&(y.childHeader=l[m.childHeader],y.childTail=l[m.childTail]),m.pid)if(m.pid&&r.includes(m.pid))y.prev=l[m.prev],y.next=l[m.next],y.pid=l[m.pid];else{const x=d[m.prev];y.prev=x==null?void 0:x.id,y.next=m==null?void 0:m.id,m&&(m.prev=y.id),x&&(x.next=y.id);const _=d[m.pid];_.childHeader===m.id&&(_.childHeader=y.id)}else{const x=d[m.prev];y.prev=x==null?void 0:x.id,y.next=m==null?void 0:m.id,m&&(m.prev=y.id),x&&(x.next=y.id),m.id===layerManager.layerHeader&&(layerManager.layerHeader=y.id)}})}),s.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),f.forEach(d=>{const g=layerManager.layerConfigs[d],{prev:p,next:v,childHeader:m,childTail:y,pid:x}=g;s.push({id:d,prev:p,next:v,childHeader:m,childTail:y,pid:x})}),u.forEach(d=>{const g=layerManager.layerConfigs[d],p=layerManager.elemConfigs[d];g.type==="group"?n.push({id:d,layerConfig:lodashExports.cloneDeep(g)}):n.push({id:d,layerConfig:lodashExports.cloneDeep(g),elemConfig:p})}),historyOperator.put({actions:[{type:OperateType.ADD,prev:e,next:n},{type:OperateType.UPDATE_LAYER,prev:o,next:s}]}),c.length>1){const{groupCoordinate:d,setGroupCoordinate:g}=eventOperateStore;g({minX:d.minX+10,minY:d.minY+10})}return u}doHideUpd(r){const e=[],n=[],{layerConfigs:o,updateLayer:s}=layerManager;r.forEach(d=>{const{id:g,hide:p}=d;n.push({id:g,hide:p});const v=o[g];e.push({id:g,hide:v.hide})});const l={type:OperateType.HIDE,prev:e,next:n};historyOperator.put({actions:[l]}),s(r);const{setTargetIds:c}=eventOperateStore;c([]);const{layerInstances:u}=layerListStore$1,{menu:f}=designerLeftStore;f==="layer-list"&&r.forEach(d=>{var g;(g=u[d.id])==null||g.setState({hide:d.hide,selected:!1})})}doLockUpd(r){const e=[],n=[],{layerConfigs:o,updateLayer:s}=layerManager;r.forEach(f=>{const{id:d,lock:g}=f;n.push({id:d,lock:g});const p=o[d];e.push({id:d,lock:p.lock})});const l={type:OperateType.LOCK,prev:e,next:n};historyOperator.put({actions:[l]}),s(r);const{layerInstances:c}=layerListStore$1,{menu:u}=designerLeftStore;u==="layer-list"&&r.forEach(f=>{var d;(d=c[f.id])==null||d.setState({lock:f.lock})})}canMoveUp(r){const{layerConfigs:e}=layerManager,n={};r.forEach(o=>{const s=e[o];if(s.pid){const l=e[s.pid];l.childHeader&&(n[l.childHeader]?n[l.childHeader].push(o):n[l.childHeader]=[o])}else n[layerManager.layerHeader]?n[layerManager.layerHeader].push(o):n[layerManager.layerHeader]=[o]});for(const[o,s]of Object.entries(n))if(s.includes(o)){let l=1,c=e[o];for(;c.next&&(c=e[c.next],r.includes(c.id));)l++;l>=s.length&&(r=r.filter(u=>!s.includes(u)))}return r.length!==0}canMoveDown(r){const{layerConfigs:e}=layerManager,n={};r.forEach(o=>{const s=e[o];if(s.pid){const l=e[s.pid];l.childTail&&(n[l.childTail]?n[l.childTail].push(o):n[l.childTail]=[o])}else n[layerManager.layerTail]?n[layerManager.layerTail].push(o):n[layerManager.layerTail]=[o]});for(const[o,s]of Object.entries(n))if(s.includes(o)){let l=1,c=e[o];for(;c.prev&&(c=e[c.prev],r.includes(c.id));)l++;l>=s.length&&(r=r.filter(u=>!s.includes(u)))}return r.length!==0}doLayerToTop(){let{targetIds:r}=eventOperateStore;if(r.length===0||!this.canMoveUp(r))return;const{layerConfigs:e}=layerManager,n=[],o=[];let s=r.filter(c=>{const u=e[c];return!u.pid||u.pid&&!r.includes(u.pid)});const l=new Set;l.add(layerManager.layerHeader),s.forEach(c=>{const u=e[c];l.add(c),u.next&&l.add(u.next),u.prev&&l.add(u.prev),u.pid&&l.add(u.pid)}),n.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),l.forEach(c=>{const{prev:u,next:f,childHeader:d,childTail:g}=e[c];n.push({id:c,prev:u,next:f,childHeader:d,childTail:g})}),s=s.sort((c,u)=>{const f=e[c],d=e[u];return f.order-d.order}),runInAction(()=>{for(let c=0;c<s.length;c++){const u=s[c],f=e[u],d=e[f.prev],g=e[f.next];if(f.pid){const p=e[f.pid];if(p.childHeader===u)continue;const v=e[p.childHeader];f.prev=void 0,f.next=p==null?void 0:p.childHeader,d&&(d.next=g==null?void 0:g.id),g&&(g.prev=d==null?void 0:d.id),v&&(v.prev=u),p.childHeader=u,u===p.childTail&&(p.childTail=d==null?void 0:d.id)}else{if(layerManager.layerHeader===u)continue;f.prev=void 0,f.next=layerManager.layerHeader,d&&(d.next=g==null?void 0:g.id),g&&(g.prev=d==null?void 0:d.id);const p=e[layerManager.layerHeader];p&&(p.prev=u),layerManager.layerHeader=u,u===layerManager.layerTail&&(layerManager.layerTail=d==null?void 0:d.id)}}}),o.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),l.forEach(c=>{const{prev:u,next:f,childHeader:d,childTail:g}=e[c];o.push({id:c,prev:u,next:f,childHeader:d,childTail:g})}),historyOperator.put({actions:[{type:OperateType.UPDATE_LAYER,prev:n,next:o}]}),layerManager.reRenderLayer()}doLayerToBottom(){const{targetIds:r}=eventOperateStore;if(r.length===0||!this.canMoveDown(r))return;const e=[],n=[],{layerConfigs:o}=layerManager;let s=r.filter(c=>{const u=o[c];return!u.pid||u.pid&&!r.includes(u.pid)});const l=new Set;l.add(layerManager.layerTail),s.forEach(c=>{const u=o[c];l.add(c),u.next&&l.add(u.next),u.prev&&l.add(u.prev),u.pid&&l.add(u.pid)}),e.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),l.forEach(c=>{const{prev:u,next:f,childHeader:d,childTail:g}=o[c];e.push({id:c,prev:u,next:f,childHeader:d,childTail:g})}),s=s.sort((c,u)=>{const f=o[c];return o[u].order-f.order}),runInAction(()=>{for(let c=0;c<s.length;c++){const u=s[c],f=o[u],d=o[f.prev],g=o[f.next];if(f.pid){const p=o[f.pid];if(u===p.childTail)continue;const v=o[p.childTail];f.prev=p.childTail,f.next=void 0,d&&(d.next=g==null?void 0:g.id),g&&(g.prev=d==null?void 0:d.id),v&&(v.next=u),p.childTail=u,u===p.childHeader&&(p.childHeader=g==null?void 0:g.id)}else{if(layerManager.layerTail===u)continue;f.prev=layerManager.layerTail,f.next=void 0,d&&(d.next=g==null?void 0:g.id),g&&(g.prev=d==null?void 0:d.id);const p=o[layerManager.layerTail];p&&(p.next=u),layerManager.layerTail=u,u===layerManager.layerHeader&&(layerManager.layerHeader=g==null?void 0:g.id)}}}),n.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),l.forEach(c=>{const{prev:u,next:f,childHeader:d,childTail:g}=o[c];n.push({id:c,prev:u,next:f,childHeader:d,childTail:g})}),historyOperator.put({actions:[{type:OperateType.UPDATE_LAYER,prev:e,next:n}]}),layerManager.reRenderLayer()}doLayerMoveUp(){let{targetIds:r}=eventOperateStore;if(r.length===0||!this.canMoveUp(r))return;const{layerConfigs:e}=layerManager,n=[],o=[],s=new Set;r.forEach(l=>{const c=e[l],u=e[c.prev];s.add(l),c&&c.next&&s.add(c.next),c&&c.prev&&s.add(c.prev),u&&u.prev&&s.add(u.prev)}),r=r.sort((l,c)=>{const u=e[l];return e[c].order-u.order}),n.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),s.forEach(l=>{const c=e[l],{childTail:u,childHeader:f}=c;n.push({id:l,prev:c.prev,next:c.next,childHeader:f,childTail:u})}),runInAction(()=>{r.forEach(l=>{const c=e[l],u=e[c.prev],f=e[u==null?void 0:u.prev],d=e[c.next];if(c.pid){const g=e[c.pid];l!==g.childHeader&&(c.prev===g.childHeader&&(g.childHeader=l),l===g.childTail&&(g.childTail=c.prev),c.prev=f==null?void 0:f.id,c.next=u==null?void 0:u.id,u&&(u.prev=c.id,u.next=d==null?void 0:d.id),f&&(f.next=c.id),d&&(d.prev=u==null?void 0:u.id))}else l!==layerManager.layerHeader&&(c.prev===layerManager.layerHeader&&(layerManager.layerHeader=l),l===layerManager.layerTail&&(layerManager.layerTail=c.prev),c.prev=f==null?void 0:f.id,c.next=u==null?void 0:u.id,u&&(u.prev=c.id,u.next=d==null?void 0:d.id),f&&(f.next=c.id),d&&(d.prev=u==null?void 0:u.id))})}),o.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),s.forEach(l=>{const c=e[l],{childTail:u,childHeader:f}=c;o.push({id:l,prev:c.prev,next:c.next,childHeader:f,childTail:u})}),historyOperator.put({actions:[{type:OperateType.UPDATE_LAYER,prev:n,next:o}]}),layerManager.reRenderLayer()}doLayerMoveDown(){let{targetIds:r}=eventOperateStore;if(r.length===0||!this.canMoveDown(r))return;const{layerConfigs:e}=layerManager,n=[],o=[],s=new Set;r.forEach(l=>{const c=e[l],u=e[c.next];s.add(l),c&&c.next&&s.add(c.next),c&&c.prev&&s.add(c.prev),u&&u.next&&s.add(u.next)}),r=r.sort((l,c)=>{const u=e[l],f=e[c];return u.order-f.order}),n.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),s.forEach(l=>{const c=e[l],{childTail:u,childHeader:f}=c;n.push({id:l,prev:c.prev,next:c.next,childHeader:f,childTail:u})}),runInAction(()=>{r.forEach(l=>{const c=e[l],u=e[c.prev],f=e[c.next],d=e[f==null?void 0:f.next];if(c.pid){const g=e[c.pid];l!==g.childTail&&(c.next===g.childTail&&(g.childTail=l),l===g.childHeader&&(g.childHeader=c.next),c.prev=f==null?void 0:f.id,c.next=d==null?void 0:d.id,f&&(f.prev=u==null?void 0:u.id,f.next=c.id),u&&(u.next=f==null?void 0:f.id),d&&(d.prev=c==null?void 0:c.id))}else l!==layerManager.layerTail&&(c.next===layerManager.layerTail&&(layerManager.layerTail=l),l===layerManager.layerHeader&&(layerManager.layerHeader=c.next),c.prev=f==null?void 0:f.id,c.next=d==null?void 0:d.id,f&&(f.prev=u==null?void 0:u.id,f.next=c.id),u&&(u.next=f==null?void 0:f.id),d&&(d.prev=c==null?void 0:c.id))})}),o.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),s.forEach(l=>{const c=e[l],{childTail:u,childHeader:f}=c;o.push({id:l,prev:c.prev,next:c.next,childHeader:f,childTail:u})}),historyOperator.put({actions:[{type:OperateType.UPDATE_LAYER,prev:n,next:o}]}),layerManager.reRenderLayer()}doStyleUpd(r,e){const{activeElem:{id:n}}=rightStore,o={type:OperateType.UPD_STYLE,prev:{id:n,data:e},next:{id:n,data:r}};historyOperator.put({actions:[o]})}doGrouping(){const{targetIds:r,setTargetIds:e}=eventOperateStore;if(!r||r.length<=1||LayerUtil.hasSameGroup(r))return;let n=LayerUtil.findTopGroupLayer(r,!0);const{layerConfigs:o,addItem:s}=layerManager,l=IdGenerate.generateId();let c=o[n[0]].lock;for(let _=1;_<n.length;_++)if(c!==o[n[_]].lock){c=!1;break}const u={id:l,type:"group",name:"新建分组",hide:!1,lock:c},f=new Set;f.add(layerManager.layerHeader),n.forEach(_=>{const E=o[_];f.add(_),E.next&&f.add(E.next),E.prev&&f.add(E.prev)});const d=[],g=[],p=[];d.push({layerHeader:layerManager.layerHeader}),f.forEach(_=>{const E=o[_];d.push({id:_,pid:E.pid,prev:E.prev,next:E.next})});let v="",m="";runInAction(()=>{n=n.sort((_,E)=>{const S=o[_],A=o[E];return S.order-A.order}),n.forEach(_=>{const E=o[_],S=o[E.prev],A=o[E.next];if(layerManager.layerHeader===_&&(layerManager.layerHeader=E.next),layerManager.layerTail===_&&(layerManager.layerTail=E.prev||u.id),E.pid=l,S&&(S.next=E.next),A&&(A.prev=E.prev),E.prev=void 0,E.next=void 0,v){const T=o[v];T.prev=_,E.next=v}else m=_;v=_})}),u.childHeader=v,u.childTail=m,u.next=layerManager.layerHeader;const y=o[layerManager.layerHeader];y&&(y.prev=l),s(u),layerManager.layerHeader=l,g.push({layerHeader:l}),f.forEach(_=>{const E=o[_];g.push({id:_,pid:E.pid,prev:E.prev,next:E.next})}),p.push({id:l,layerConfig:u});const x=[{type:OperateType.ADD,prev:null,next:p},{type:OperateType.UPDATE_LAYER,prev:d,next:g}];if(historyOperator.put({actions:x}),e([]),c){const{layerInstances:_}=layerListStore$1,E=setTimeout(()=>{_[l].setState({lock:!0}),clearTimeout(E)},10)}}doUnGrouping(){const{targetIds:r,setTargetIds:e}=eventOperateStore;if(r.length===0)return;let n=LayerUtil.findTopGroupLayer(r,!0);const{layerConfigs:o,delLayout:s}=layerManager;n=n.filter(m=>o[m].type==="group");const l=[],c=[],u=[],f=new Set;n.forEach(m=>{const y=o[m];if(y.next&&f.add(y.next),y.prev&&f.add(y.prev),y.childHeader){let x=o[y.childHeader];for(x&&f.add(x.id);x!=null&&x.next;)x=o[x.next],x&&f.add(x.id)}}),l.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),f.forEach(m=>{const y=o[m],{prev:x,next:_,pid:E,childHeader:S,childTail:A}=y;l.push({id:m,prev:x,next:_,pid:E,childHeader:S,childTail:A})}),n.forEach(m=>{u.push({id:m,layerConfig:lodashExports.cloneDeep(o[m])})}),runInAction(()=>{n.forEach(m=>{const y=o[m],x=o[y.prev],_=o[y.next],E=o[y.childHeader],S=o[y.childTail];E&&(E.prev=x==null?void 0:x.id),S&&(S.next=_==null?void 0:_.id),x&&(x.next=y==null?void 0:y.childHeader),_&&(_.prev=y==null?void 0:y.childTail);let A=y.childHeader;for(;A;){const T=o[A];T&&(T.pid=void 0),A=T==null?void 0:T.next}m===layerManager.layerHeader&&(layerManager.layerHeader=y.childHeader),m===layerManager.layerTail&&(layerManager.layerTail=y.childTail)}),s(n)}),c.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),f.forEach(m=>{const y=o[m],{prev:x,next:_,pid:E,childHeader:S,childTail:A}=y;c.push({id:m,prev:x,next:_,pid:E,childHeader:S,childTail:A})});const d=[{type:OperateType.UPDATE_LAYER,prev:l,next:c},{type:OperateType.DEL,prev:u,next:null}];historyOperator.put({actions:d}),e([]);const{activeElem:g,activeConfig:p,setContentVisible:v}=rightStore;g&&n.includes(g.id)&&(v(!1),p(null,""))}doRemoveFromGroup(){let{targetIds:r}=eventOperateStore;if(r.length===0)return;const{layerConfigs:e}=layerManager,n=r.filter(c=>{const u=e[c];return u.pid&&!r.includes(u.pid)}),o=[],s=[],l=new Set;l.add(layerManager.layerHeader),n.forEach(c=>{const u=e[c],f=e[u.pid];l.add(u.id),u.prev&&l.add(u.prev),u.next&&l.add(u.next),(f.childHeader===c||f.childTail===c)&&l.add(f.id)}),o.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),l.forEach(c=>{const u=e[c],{prev:f,next:d,pid:g,childHeader:p,childTail:v}=u;o.push({id:c,prev:f,next:d,pid:g,childHeader:p,childTail:v})}),runInAction(()=>{n.forEach(c=>{const u=e[c],f=e[u.prev],d=e[u.next],g=e[u.pid],p=e[layerManager.layerHeader];g.childHeader===c&&(g.childHeader=d==null?void 0:d.id),g.childTail===c&&(g.childTail=f==null?void 0:f.id),u.pid=void 0,u.prev=void 0,u.next=layerManager.layerHeader,p.prev=u.id,layerManager.layerHeader=u.id,f&&(f.next=d==null?void 0:d.id),d&&(d.prev=f==null?void 0:f.id)})}),s.push({layerHeader:layerManager.layerHeader,layerTail:layerManager.layerTail}),l.forEach(c=>{const u=e[c],{prev:f,next:d,pid:g,childHeader:p,childTail:v}=u;s.push({id:c,prev:f,next:d,pid:g,childHeader:p,childTail:v})}),historyOperator.put({actions:[{type:OperateType.UPDATE_LAYER,prev:o,next:s}]}),layerManager.reRenderLayer()}}const historyRecordOperateProxy=new HistoryRecordOperateProxy;class LayerListStore{constructor(){U(this,"layerInstances",{});U(this,"searchLayer",!1);U(this,"setSearchLayer",r=>this.searchLayer=r);U(this,"lockChange",(r,e)=>{const n=[],{layerConfigs:o}=layerManager,{type:s}=o[r];s==="group"?LayerUtil.findAllChildLayer([r]).forEach(l=>n.push({id:l,lock:e})):n.push({id:r,lock:e}),historyRecordOperateProxy.doLockUpd(n)});U(this,"selectedChange",(r,e)=>{var v;const{targetIds:n,setTargetIds:o}=eventOperateStore,{layerConfigs:s}=layerManager,{type:l,lock:c}=s[r];if(!l)return;const u=l==="group";let f=[];if(e.ctrlKey)if(n.includes(r))if(u){const m=LayerUtil.findAllChildLayer([r]);f=n.filter(y=>!m.includes(y))}else f=n.filter(m=>m!==r);else if(n.length===0)u?f=LayerUtil.findAllChildLayer([r]):f=[r];else{const m=s[n[0]].lock;c!==m?u?f=[...n,...LayerUtil.findAllChildLayer([r])].filter(y=>!s[y].lock):f=[...n,r].filter(y=>!s[y].lock):u?f=[...n,...LayerUtil.findAllChildLayer([r])]:f=[...n,r],f=[...new Set(f)]}else if(e.shiftKey){if(n.length===1){const m=s[n[0]],y=s[r];let x,_;m.order>y.order?(x=n[0],_=r):(x=r,_=n[0]);let E=!1;const S=(T,b,C)=>{if(!(!b||E)){if(b.type==="group"){T.push(b.id);const L=s[b.childHeader];if(!L)return;S(f,L,C)}else T.push(b.id);if(b.id===C){E=!0;return}if(b.pid&&!b.next){let L=0,R=s[b.pid],I=s[R.next];for(;!I&&L<1e3;)R=s[R.pid],I=s[R.next],L++;S(T,I,C)}else S(T,s[b.next],C)}},A=s[x];if(f.push(x),A.type==="group")S(f,s[A.childHeader],_);else if(A.pid&&!A.next){let T=0,b=s[A.pid],C=s[b.next];for(;!C&&T<1e3;)b=s[b.pid],C=s[b.next],T++;S(f,C,_)}else S(f,s[A.next],_)}}else u?f=LayerUtil.findAllChildLayer([r]):f=[r];const d=setTimeout(()=>{o(f),clearTimeout(d)},0),g=(v=s[f[0]])==null?void 0:v.lock,p=setTimeout(()=>{setControlPointLineColor(g),clearTimeout(p)},0)});U(this,"hideChange",(r,e)=>{const n=[],{layerConfigs:o}=layerManager,{type:s}=o[r];s==="group"?LayerUtil.findAllChildLayer([r]).forEach(l=>n.push({id:l,hide:e})):n.push({id:r,hide:e}),historyRecordOperateProxy.doHideUpd(n)});makeObservable(this,{searchLayer:observable,setSearchLayer:action})}}const layerListStore=new LayerListStore,layerListStore$1=layerListStore,BaseTextComponent=reactExports.forwardRef((a,r)=>{const[e,n]=reactExports.useState({...a}),{style:o,data:s}=e,[l,c]=reactExports.useState(!1),u=reactExports.useRef({}),f=reactExports.useRef(null);reactExports.useImperativeHandle(r,()=>({updateConfig:v=>n({...v}),setEventHandler:v=>u.current=v}));const d=()=>{"click"in u.current&&u.current.click()},g={WebkitTextStrokeWidth:o==null?void 0:o.strokeWidth,WebkitTextStrokeColor:o==null?void 0:o.strokeColor},p=v=>{var x,_;s.staticData=v.target.value,layerManager.layerConfigs[(x=e.base)==null?void 0:x.id].name=v.target.value;const{layerInstances:m}=layerListStore$1,y=m[(_=e.base)==null?void 0:_.id];y&&y.setState({name:v.target.value})};return jsxRuntimeExports.jsx("div",{onDoubleClick:()=>c(!0),ref:f,className:"base-text-component",style:{...o,...g},onKeyDown:v=>v.stopPropagation(),onClick:d,children:l?jsxRuntimeExports.jsx("input",{ref:v=>v==null?void 0:v.select(),onChange:p,onBlur:()=>c(!1),autoFocus:!0,type:"text",defaultValue:s==null?void 0:s.staticData}):s==null?void 0:s.staticData})});class BaseTextController extends AbstractDesignerController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,BaseTextComponent,e);const{mode:n}=URLUtil.parseUrlParams();n===DesignerMode.EDIT&&(this.container.style.pointerEvents="auto")}destroy(){this.instance=null,this.config=null}getConfig(){return this.config}update(r,e){var n;this.config=ObjectUtil.merge(this.config,r),e=e||{reRender:!0},e.reRender&&((n=this.instance)==null||n.updateConfig(this.config))}registerEvent(){var r,e;if(this.instance){const n=(e=(r=this.config)==null?void 0:r.base)==null?void 0:e.id;this.instance.setEventHandler({click:()=>BPExecutor.triggerComponentEvent(n,"click",this.config)})}}}const __vite_glob_0_66=Object.freeze(Object.defineProperty({__proto__:null,BaseTextController},Symbol.toStringTag,{value:"Module"})),baseTextImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARAAAACqCAIAAADqToflAAAGs0lEQVR4Xu3bXWsTWQCHcT9ILwYsLGVpVoJYIb2IEMSgZTHFCkGCYEQCWjoiUQISMBeZixTJRUoJQgpT6NfceZ/JvP9bd9mL50cv2sx0OoV5es6ZSe89fvz4LwD13HOC2QFQD8EAAoIBBAQDCAgGEBAMICAYQEAwgIBgAAHBAAKCAQQEAwgIBhAQDCAgGEBAMICAYAABwQACggEEBAMICAYQEAwgIBhAQDCAgGAAAcEAAoIBBAQDCAgGEBAMICAYQEAwgIBgAAHBAAKCAQQEAwgIBhAQDCAgGEBAMICAYAABwQACggEEBAMICAYQEAwgIBhAQDCAgGAAAcEAAoIBBAQDCAgGEBAMICAYQEAwgIBgAAHBAAKCAQQEAwgIBhAQDCAgGEBAMICAYAABwQACggEEBAMICAYQEAwgIBhAQDCAgGAAAcEAAoIBBARTV+fDbPbD+Rh10lscnZG7aTb7kLexTPPki/SNxl6z0xt8GuefRqXwPL+cNNObUAvB1NWf33isfnqLo2/5G+fbG+/vNTMafxiJPVrmZd43FupNbf8n2dPj5HFqCs/z0mylN6EWgqnQOlv715hkfeZdkOH1ub2p2341cHQfuodPBrPXPnE3PC/769/7HhTjfIteDMHcFcFU+BeC6fuReEPVVjDBz/I+b74eezPAzMfPTXSkRXbrj9n4tdfb8XTza5P5CGO7sTOb3I/pceI3Rx6Cqes2UzJPMCaszXbwQhBJeTC3C/WmtNVKub8bkgimrjCYUjnBdCfekLD51g1f+U+CyRth7OvEftc5gwwjTCWCqSsMZrPMzIJmP5bBPCkbzNOxt8mevoxeqhVMLDhC3sLDiO4B3Cze7qU2ph1+WgX7+pajR+ldUIlg6gqDWU3chXnKJLgW08HEV7Qd/BWf9sJINj+d0qyVv/3X0gnPuvC+SB+kM/7lH2Mzeba1zt97u/A3OD32yu8AGG3zItg3dmG2y78LGQRT122mZI9Gy/QezrgSjipF0sHsHHwMx4bzYSN+OT7O5mv5U5lGfx4t9z227X9tz/uJA6IawdSlL/obfSu8TNeTo+bQ28cNZnSeWFf4OyRXFN97iYN49gbRUDJ7FUy9Gu/C124Ww/3t/bcY7bOgt/VnM7qt3P8crJFWZwwzAoIpd6ubTS4njGgq5S8//EOleqv74DK+B3Bl9fd3jCdmtCAJVvn5jPZoGTTpTsASz2ESk7TVWYdmaiKYcncJJjGVSgbTGi3ckWQxcq/z7WCCW1vTzBDjLUKiidzFYnkVfV6yDjE64djiRGE+MdIPLveH0SC1/n7SKDwOYgRTz/3W0PJvVtmWO+0P3wPmvSmr0Z/52zbn5lFydnQ4Mi1vFZMM5tD0Bou1ebiTDia4nnNnfVujSsjPII9xEJ7wTXjOO+lgnDM/nsZ3ry8nJw8KjoYQwVQxdtuD2Tp4gmEvRm3vHWFHE/9Ccxcnrva7cL1yvbY+HsV/rf1L9HcE45xK99vWw5nV54LRZTc8Pc/6W+8geCObv46KT9s98/fRSss5+cWgbDkEgim3P4ivpqvgzlIhe72OZkq2FVx5vycYr9q8e2vOmNZ7mK0mXuivToN34hSa9xtv/N8yGohQiGAqtE7dK8+ba/WmiYfiYTyJu1vno9b+kXnuToRWp+FC3G/AXlnBw001GKP5fDjzn89Erjab5DN792HqZPi8ud1Noz9fL94dGPXuYjdejGenBeMVEgimUrPzNLseDq/C7NP3HaPxtBO/3zh91yAOZvIiMbWzhu706H0cjPGwO/y6CB5rJqxng9Z9Z+gLytxyvVnOx6NnqTc7G7sPwulX3pSs+Wfml0MxgqlU9Rc6K1lR4QhTwgsmu8S/nA3au4mr22j8bS5S1Xg3nYulF/1QEUyl3xGM+4r/346jTr1gkusQ+8L69DI144oYrdemFZxh/FizAMHcFcH8n6Sewxjt4VfzpFVQyjZ3CvemW7Ur/6J8VwQDCAgGEBAMICAYQEAwgIBgAAHBAAKCAQQEAwgIBhAQDCAgGEBAMICAYAABwQACggEEBAMICAYQEAwgIBhAQDCAgGAAAcEAAoIBBAQDCAgGEBAMICAYQEAwgIBgAAHBAAKCAQQEAwgIBhAQDCAgGEBAMICAYAABwQACggEEBAMICAYQEAwgIBhAQDCAgGAAAcEAAoIBBAQDCAgGEBAMICAYQEAwgIBgAAHBAAKCAQQEAwgIBhAQDCAgGEBAMICAYAABwQACggEEBAMICAYQEAwgIBhAQDCAgGAAAcEAAoIBBAQDCAgGEPwDp7rmXPlnA2sAAAAASUVORK5CYII=",BaseTextStyleConfig=({controller:a})=>{const{data:r,style:e,base:n}=a.getConfig(),o=c=>{a.update({data:{staticData:c}}),layerManager.layerConfigs[n==null?void 0:n.id].name=c;const{layerInstances:u}=layerListStore$1,f=u[n==null?void 0:n.id];f&&f.setState({name:c})},s=c=>{const{dataFragment:u,id:f,data:d}=c;f==="baseTextContent"?o(d):a.update(u)},l={type:"grid",config:{columns:2},children:[{key:"data",children:[{id:"baseTextContent",key:"staticData",type:"text-area",label:"内容",value:r==null?void 0:r.staticData,config:{containerStyle:{gridColumn:"1 / 3"}}}]},{key:"style",children:[{key:"fontSize",type:"number-input",label:"字号",value:e==null?void 0:e.fontSize,config:{min:1}},{key:"fontWeight",type:"number-input",label:"加粗",value:(e==null?void 0:e.fontWeight)||400,config:{min:100,max:900,step:100}},{key:"color",type:"color-picker",label:"颜色",value:e==null?void 0:e.color,config:{showText:!0}},{key:"fontFamily",type:"select",label:"字体",value:e==null?void 0:e.fontFamily,config:{options:[{label:"钉钉进步体",value:"DingTalk JinBuTi"},{label:"抖音美好体",value:"DouyinSansBold"},{label:"优设标题黑",value:"优设标题黑"},{label:"庞门正道标题",value:"庞门正道标题体免费版"}]}},{key:"letterSpacing",type:"number-input",label:"字距",value:e==null?void 0:e.letterSpacing,config:{min:0,max:10,step:1}},{key:"lineHeight",type:"number-input",label:"行距",value:e==null?void 0:e.lineHeight,config:{min:0,max:10,step:.1}},{type:"grid",label:"对齐",config:{columns:2,containerStyle:{gridColumn:"1/3"}},children:[{type:"group-button",key:"justifyContent",value:e==null?void 0:e.justifyContent,config:{items:[{value:"flex-start",content:jsxRuntimeExports.jsx(AlignLeftTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"center",content:jsxRuntimeExports.jsx(AlignHorizontalCenterTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"flex-end",content:jsxRuntimeExports.jsx(AlignRightTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})}]}},{type:"group-button",key:"alignItems",value:e==null?void 0:e.alignItems,config:{items:[{value:"flex-start",content:jsxRuntimeExports.jsx(AlignTopTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"center",content:jsxRuntimeExports.jsx(AlignVerticalCenterTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"flex-end",content:jsxRuntimeExports.jsx(AlignBottomTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})}]}}]},{type:"grid",label:"描边",config:{columns:2,containerStyle:{gridColumn:"1/3"}},children:[{key:"strokeColor",type:"color-picker",label:"颜色",value:e==null?void 0:e.strokeColor,config:{showText:!0}},{key:"strokeWidth",type:"number-input",label:"宽度",value:e==null?void 0:e.strokeWidth,config:{min:0,max:10,step:1}}]}]}]};return jsxRuntimeExports.jsx(LCGUI,{schema:l,onFieldChange:s})},BaseInfo$5=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),ThemeConfig$1=React.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),AnimationConfig$3=React.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),FilterConfig$5=React.lazy(()=>__vitePreload(()=>import("./FilterConfig-NGULEsf_.js"),__vite__mapDeps([52,1,2,6,7,8,9,10,11,12,5,13,14,15,16,53])));class BaseTextDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"基础文本",compKey:"BaseText",categorize:"info",width:64,height:26}}getChartImg(){return baseTextImg}getController(){return BaseTextController}getInitConfig(){return{base:{id:"",name:"基础文本",type:"BaseText"},style:{color:"#a7a7a7",fontSize:16,alignItems:"center",justifyContent:"center",strokeColor:"#ffffff",strokeWidth:0,lineHeight:1,letterSpacing:0},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0},data:{sourceType:"static",staticData:"基础文本"}}}getMenuList(){return super.getMenuList().filter(r=>r.key!=="theme"&&r.key!=="data")}getMenuToConfigContentMap(){return{base:BaseInfo$5,style:BaseTextStyleConfig,animation:AnimationConfig$3,theme:ThemeConfig$1,filter:FilterConfig$5}}getEventList(){return super.getEventList().concat([{id:"click",name:"点击时"}])}}const __vite_glob_0_67=Object.freeze(Object.defineProperty({__proto__:null,default:BaseTextDefinition},Symbol.toStringTag,{value:"Module"})),BaseVideoComponent=reactExports.forwardRef((a,r)=>{var s,l,c,u;const[e,n]=reactExports.useState({...a}),o=reactExports.useRef({});return reactExports.useImperativeHandle(r,()=>({updateConfig:f=>n({...f}),setEventHandler:f=>o.current=f})),jsxRuntimeExports.jsx("div",{style:{width:"100%",height:"100%"},children:(s=e==null?void 0:e.style)!=null&&s.src?jsxRuntimeExports.jsxs("video",{width:"100%",height:"100%",controls:!0,autoPlay:!0,children:[jsxRuntimeExports.jsx("source",{src:(l=e==null?void 0:e.style)==null?void 0:l.src,type:"video/mp4"}),jsxRuntimeExports.jsx("source",{src:(c=e==null?void 0:e.style)==null?void 0:c.src,type:"video/webm"}),jsxRuntimeExports.jsx("source",{src:(u=e==null?void 0:e.style)==null?void 0:u.src,type:"video/ogg"}),"您的浏览器不支持 video 标签。"]}):jsxRuntimeExports.jsx("div",{style:{color:"#9a9a9a",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:jsxRuntimeExports.jsx("div",{children:"请配置视频连接..."})})})});class BaseVideoController extends AbstractDesignerController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,BaseVideoComponent,e)}destroy(){this.instance=null,this.config=null}getConfig(){return this.config}update(r,e){var n;this.config=ObjectUtil.merge(this.config,r),e=e||{reRender:!0},e.reRender&&((n=this.instance)==null||n.updateConfig(this.config))}updateTheme(r){}registerEvent(){var r,e;if(this.instance){const n=(e=(r=this.config)==null?void 0:r.base)==null?void 0:e.id;this.instance.setEventHandler({click:()=>BPExecutor.triggerComponentEvent(n,"click",this.config)})}}}const __vite_glob_0_68=Object.freeze(Object.defineProperty({__proto__:null,default:BaseVideoController},Symbol.toStringTag,{value:"Module"})),baseVideo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAT0AAADFCAIAAACpT7IKAAAJ2ElEQVR4Xu3dMW8TaRCA4fshVrqIJpYosUWDUliO0yAUiyJVJDqQOySiSFCiKBKgCAuU8F9vzjPmnGHXrJ3EuzPf+xRXHLt449k3/r44If/0AETzj/8fADqPboF46BaIh26BeOgWiIdugXjoFoiHboF46BaIh26BeOgWiIdugXjoFoiHboF46BaIh26BeOgWiIdugXjoFoiHbmv1+/3hcDgajSbYOXnaB4OBjMBPBQt0e8fe3t54PJ7NZvP5/BYdIIOQcchQZDR+WgWj2/9Np9Pr62t/46AbZDQyID+zUtHtfw4PDy8vL/2dgu6RMcmw/PzKQ7e9k5MTf3eg22RkfoqFKb3bs7Mzf1MgAhmcn2VJiu6WV9rQSn7VLbdb2Sb5GwHRFLvXLbfbhl+Ims/nV6368eOHv6alm5ubL1+++BMe37dv3/ylrPj+/bs/YXMN34eTIfq5lqHQbqfTqb8F7jo/P59MJvv7+/7M3To9PfVXtuLVq1f+hMf35MmTNd1+/vz5od5olSdfRiCD8I9xV5lvDpXYrdxYa96nlRexo6Mjf04bnj175i9uxfv37/0JO/Hu3Tt/KStevHjhT7g3GYcMxT/SkozyoT5TBFJit+Px2A9/Se6PwWDgT2jJx48f/fUt/fz58+nTp/6ExycJ+UtZ8ebNG3/CA5GhrElXBupPyK7EbmezmZ/8UkdeaXtlr5ArrfmUIQP1R2dXYrd1X/OQrZQ/tCWskCvV7XVloP7Q7Irrtt/v+7EvTSYTf3RLWCFXkgH5B14q7SeHiutWdkp+5kutf/VYsUKuIwPyj700HA790akV1+1oNPIzX+jIWosV8np1exwZqz80teK6rVtrXV1d+UPbwAp5PRmTv4KF7uxxdoNuTRe6ZYX8V3Sr6Na03i0r5CboVtGtab1bVshN0K2iW9Nut6yQG6JbRbemxW5ZITdHt4puTYvdskJujm4V3Zq2umWFvBG6VXRrWumWFfKm6FbRrWmlW1bIm6JbRbdm992yQt4C3Sq6NTvulhXyduhW0a3ZcbeskLdDt4puzS67ZYW8NbpVdGt21i0r5PugW0W3ZmfdskK+D7pVdGt20y0r5HuiW0W3ZgfdskK+P7pVdGt20C0r5PujW0W35rG7ZYX8IOhW0a35+vXr80fz8uVL/3grPn365E/YiQ8fPvhLWfH69Wt/QgfImPyFLtBtcnXdtmXNr89Ac3SbXNe6xYOg2+ToNiW6Ta473XZkhdyRy7gnuk2u9W5zdNI1dJtc693++vXL/69uCP0JhW6Ta73bzursJ5Qm6DY5uk2JbpOr6/axv18KD4Lvl1J0a+g2BLpVdGvoNgS6VXRr6DYEulV0a+g2BLpVdGvoNgS6VXRr6DYEulV0a+g2BLpVdGvoNgS6VXRr6DYEulV0a+g2BLpVdGvoNgS6VXRr6DYEulV0a+g2BLpVdGvoNgS6VXRr6DYEulV0a+g2BLpVdGvoNgS6VXRr6DYEulV0a+g2BLpVdGvoNgS6VXRrAnV7enoqVyv/9X9QALpVdGtCdPv8+fPVG7fAeulW0a3peLcHBwcXFxf+ohfkyqVnf0JSdKvo1nS52+PjY3+5f3j79q207c9Mh24V3ZoudytN+sutUsKymW4V3ZoE3arc9dKtoluTpluVddNLt4puTbJuVb5NL90qujUpu71Nt2ymW0W3Jmu3Kk29dKvo1kTstu4mrpNg01v3IdNtcpm61e2rvJD6P6inL7xxN710q+jWBO1WD5AO627oSnGXzXUfJt0ml7Lb3iLdjV54bxcf8vHx8crjBEC3im5N9G7VFvVeXFwEWjbTraJbk6NbteaHECoFWjbTraJbk6lbJWvguru8Uoh66z4iuk2unG57Wy2br7r9XhHdKro1KbtVW9Sr7zD5v6gD6FbRrUncrcqx6aVbRbcmfbcq+qa37uLpNrnCu+1ttWzuzqaXbhXdmnK6VVvU24VNL90qujWldavCbXrpVtGtKbPb3vKFt66HSi3WW3eddJsc3VbadNnc1tNFt4puTVs3YhM76FZJvXWP5bT1dNGtolvT1o3YRF1LD96tOmjwU4FtPV11F0a3ydFtE39Nt62nq+6q6DY5uv0r91uIKrX1dNVdGN0mR7drNH9bqK2ni24V3Zq2bsQmdtAtX0+OhW5NWzdiE4/d7UbF3i6eq7a+7ZFuFd2aMrttvjD+ra3vuFB0q+jWlNZt87dqf7vPwz0UulV0a4rqNtDC2KFbRbemkG4lP/+3rHXV3rciV6JbRbcmfbfhtrKV6FbRrUnc7abv8dx2+B9VpltFtyZrt5sW252tbCW6VXRr8nXb5NsVV3VtK1up7iOi2+RK6DbHVrYS3Sq6NTm6zbSVrUS3im5Ngm43LbbjW9lKdKvo1oTuNuVWtlLdh0m3ySXrNvFWthLdKro1Ebutu4nryPGBtrKV6j5kuk0uU7fNXQX81fKV6FbRrUncbeiFsUO3im5Nym7/fKMoOrpVdGuSdXsV8D2eJuhW0a1J0+1V2Pd4mqBbRbcmR7eJi1V0q+jWdLnb4+Njf7l/iPXtilujW0W3psvd9tb+c1BZt7KV6FbRrel4t+rg7q//yL2VrUS3im5NiG57Kz/xU1qxim4V3Zoo3RaObhXdGroNgW4V3Rq6DYFuFd0aug2BbhXdGroNgW4V3Rq6DYFuFd0aug2BbhXdGroNgW4V3Rq6DYFuFd0aug2BbhXdGroNgW4V3Rq6DYFuFd0aug2BbhXdGroNgW4V3Rq6DYFuFd0aug2BbhXdGroNgW5Vcd2ORiM/84X5fO4PRffImPzkFmSs/tDUiut2OBz6mS/t7+/7o9ElMiA/s6XBYOCPTq24bvv9vp/5UmlrrXDq9jhCxuqPTq24bnv1a63z83N/KLpEBuRntlDgHqfEbmezmZ/80tHRkT8a3SCj8dNakoH6o7MrsdvxeOwnv3Rzc1PaTikEGYqMxk9rSQbqT8iuxG739vaur6/98Jfk/uBVt1NkHGuilVHKQP052ZXYrZhOp37+d8lWajKZ8BXmFsmTLyOo29P+JqP0Zxag0G7F5eWlvwWqzOfzK+xc3dcOHRmin2sZyu328PDQ3wWIRobo51qGcrsVJycn/kZAHDI+P9FiFN2tODs787cDIpDB+VmWpPRue7zqBlTyK62i2//INqnhl6nQLhlTsXvaVXT7v+l0uuZ9XbRLRlPmWz6V6PaOvb298Xg8m80avg+BxyaDkHHIUAr85oo16LZWv98fDAaj0WiCnZOnfTgclvZTPs3RLRAP3QLx0C0QD90C8dAtEA/dAvHQLRAP3QLx0C0QD90C8dAtEA/dAvHQLRAP3QLx0C0QD90C8dAtEA/dAvHQLRDPvxiRu31YyvmoAAAAAElFTkSuQmCC",BaseVideoStyleConfig=({controller:a})=>{var o;const r=(o=a.getConfig())==null?void 0:o.style,e=s=>{const{dataFragment:l}=s;a.update(l)},n={type:"grid",key:"style",children:[{type:"input",label:"视频地址",key:"src",value:r==null?void 0:r.src}]};return jsxRuntimeExports.jsx(LCGUI,{schema:n,onFieldChange:e})},BaseInfo$4=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),FilterConfig$4=React.lazy(()=>__vitePreload(()=>import("./FilterConfig-NGULEsf_.js"),__vite__mapDeps([52,1,2,6,7,8,9,10,11,12,5,13,14,15,16,53])));class BaseVideoDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"视频",compKey:"BaseVideo",categorize:"media"}}getChartImg(){return baseVideo}getController(){return BaseVideoController}getInitConfig(){return{base:{id:"",name:"视频",type:"BaseVideo"},style:{src:void 0},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0}}}getMenuList(){return super.getMenuList().filter(r=>r.key!=="theme"&&r.key!=="data")}getMenuToConfigContentMap(){return{base:BaseInfo$4,style:BaseVideoStyleConfig,filter:FilterConfig$4}}getEventList(){return super.getEventList().concat([{id:"click",name:"点击时"}])}}const __vite_glob_0_69=Object.freeze(Object.defineProperty({__proto__:null,default:BaseVideoDefinition},Symbol.toStringTag,{value:"Module"})),carouselImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALkAAAB0CAIAAABWuQRhAAACEUlEQVR4Xu3Su0lDYQCA0VsqNheygBJSOJOCjx0MARGboAgJOISkso2II7iUtn/xjXDgjHCm+ebp9OWL0WJzOL/fr662jKazx8P0/cdofv9dPnxebo6MXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmuJFeCK8mV4EpyJbiSXAmupGm+fT55+2G0WH9c3O1W16+M/gF8lQkeh5ge1AAAAABJRU5ErkJggg==",CarouselComponent=React.forwardRef((a,r)=>{var l;const[e,n]=reactExports.useState({...a}),o=reactExports.useRef({});reactExports.useImperativeHandle(r,()=>({updateConfig:c=>n({...c}),setEventHandler:c=>o.current=c}));const s=((l=e==null?void 0:e.data)==null?void 0:l.staticData)||[carouselImg,carouselImg];return jsxRuntimeExports.jsx("div",{style:{width:"100%",height:"100%",overflow:"hidden"},className:"antd-carousel",children:jsxRuntimeExports.jsx(Carousel$1,{...e.style,children:s.map((c,u)=>jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("img",{alt:"轮播图"+u,src:c})},u))})})});class CarouselController extends AbstractDesignerController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,CarouselComponent,e)}destroy(){this.instance=null,this.config=null}getConfig(){return this.config}changeData(r){var e;this.config.data.staticData=r,(e=this.instance)==null||e.updateConfig(this.config)}update(r,e){var n;this.config=ObjectUtil.merge(this.config,r),e=e||{reRender:!0},e.reRender&&((n=this.instance)==null||n.updateConfig(this.config))}updateTheme(r){}registerEvent(){var e,n,o;const r=(n=(e=this.config)==null?void 0:e.base)==null?void 0:n.id;(o=this.instance)==null||o.setEventHandler({click:()=>BPExecutor.triggerComponentEvent(r,"click",this.config)})}}const __vite_glob_0_70=Object.freeze(Object.defineProperty({__proto__:null,CarouselController},Symbol.toStringTag,{value:"Module"})),CarouselConfig=({controller:a})=>{var o;const r=(o=a.getConfig())==null?void 0:o.style,e=s=>{const{dataFragment:l}=s;a.update(l)},n={key:"style",type:"grid",config:{columns:2},children:[{type:"switch",key:"autoplay",label:"自动播放",value:r.autoplay},{type:"number-input",key:"autoplaySpeed",label:"播放速度",value:r.autoplaySpeed},{type:"switch",key:"dots",label:"显示按钮",value:r.dots},{type:"switch",key:"fade",label:"淡入淡出",value:r.fade},{type:"number-input",key:"speed",label:"动效速度",value:r.speed}]};return jsxRuntimeExports.jsx(LCGUI,{schema:n,onFieldChange:e})};class CarouselDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"轮播图",compKey:"carousel",categorize:"web"}}getChartImg(){return carouselImg}getController(){return CarouselController}getInitConfig(){return{base:{id:"",name:"轮播图",type:"carousel"},style:{autoplay:!0,autoplaySpeed:3e3,dots:!0,fade:!1,speed:500},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0},data:{sourceType:"static",staticData:[carouselImg,carouselImg]}}}getMenuList(){return super.getMenuList().filter(r=>r.key!=="theme")}getMenuToConfigContentMap(){const r=super.getMenuToConfigContentMap();return r.style=CarouselConfig,r}getEventList(){return super.getEventList().concat([{id:"click",name:"点击时"}])}}const __vite_glob_0_71=Object.freeze(Object.defineProperty({__proto__:null,default:CarouselDefinition},Symbol.toStringTag,{value:"Module"}));var FormatType=(a=>(a.DASH="0",a.SLASH="1",a.CN="2",a))(FormatType||{});function formatDateTime(a){const r=new Date,e=r.getFullYear(),n=(r.getMonth()+1).toString().padStart(2,"0"),o=r.getDate().toString().padStart(2,"0"),s=r.getHours().toString().padStart(2,"0"),l=r.getMinutes().toString().padStart(2,"0"),c=r.getSeconds().toString().padStart(2,"0");switch(a){case"1":return`${e}/${n}/${o} ${s}:${l}:${c}`;case"2":return`${e}年${n}月${o}日 ${s}时${l}分${c}秒`;default:return`${e}-${n}-${o} ${s}:${l}:${c}`}}const DateTimeComponent=React.forwardRef((a,r)=>{const[e,n]=reactExports.useState({...a}),{formatType:o="2",...s}=e==null?void 0:e.style,[l,c]=reactExports.useState(formatDateTime(o)),u=reactExports.useRef(null),f=reactExports.useRef({});return reactExports.useEffect(()=>{u.current=setInterval(()=>{c(()=>{var d;return formatDateTime((d=e.style)==null?void 0:d.formatType)})},1e3)},[]),reactExports.useImperativeHandle(r,()=>({updateConfig:d=>n({...d}),setEventHandler:d=>f.current=d,destroy:()=>{u.current&&clearInterval(u.current),u.current=null}})),jsxRuntimeExports.jsx("div",{className:"date-time-component",style:{...s},children:l})});class DateTimeController extends AbstractDesignerController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,DateTimeComponent,e)}destroy(){var r;(r=this.instance)==null||r.destroy(),this.instance=null,this.config=null}getConfig(){return this.config}update(r,e){var n;this.config=ObjectUtil.merge(this.config,r),e=e||{reRender:!0},e.reRender&&((n=this.instance)==null||n.updateConfig(this.config))}updateTheme(r){}registerEvent(){var e,n,o;const r=(n=(e=this.config)==null?void 0:e.base)==null?void 0:n.id;(o=this.instance)==null||o.setEventHandler({click:()=>BPExecutor.triggerComponentEvent(r,"click",this.config)})}}const __vite_glob_0_72=Object.freeze(Object.defineProperty({__proto__:null,DateTimeController},Symbol.toStringTag,{value:"Module"})),DateTimeImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJwAAABhCAIAAACs1l/dAAAFiUlEQVR4Xu2WT2vjRhTA94Poiwj8AUIuvdXkIvBhTysIGFMIZikRptT4EryHVDkEsxCES1iFGrQQkA+pnEIqL5jxwTAUw7j4MOCDIAcf+0b/IilpsjSGto/3w2B7PJ55834zb/RGI9DxptpA/P8hqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQghqQj5t6X2PP/0m2rjMxxYg0vXfXj1W9UeZfYN89Asvoz9apevwHQ+O2a18RE1a3De0g4d96xe/ekxtfrbw26/o3qaF55zWP39NexMqn7kspWUS+Z1dK3WdqdCrrn6rBn2mEspxGRgpH3rzlz47+MPiyiSiih9l/yqpTVsfyHkKhw0YPF9f8E5vO7itB4HYmrnhrwld6AR+sMMKxGcG9XphlxOC5tgKvkwD1mhdwJ23c6+pYFZEyEXXGxkcJy0WwEPLC2e6CGw4hrVSPCv8ERXnZdhvxa3Ffv0PLWK+BX+dutPuZwNzMae0Wx1Jzzota2jZJwdsCupdXcpPLXUAVsHP18Ldg5qbbYKrF4oZzbE2xpLfqG6GkMmNgLyZQy5uE5OWpa1GBsy24QMeoI7kHR+kyf9aandO8lO1Qy+5E5luiEvWSx/bYHyTSQn6cx5YNYkgGGtCRezRIOI7iNx5/iFwL4vrlHT2yPYRlaqtxPIddDd18xSn5iaFayY/UPfhZ3H/UFnEHLfBqmdfrjwX6g6X82upGY0fblUAftxPXF4fJIUuj2XYQ8y4rCZo5ZxrJudtjtLTmi03W6To8qvRoFktvqLMv1xJLZrAYeGX7ZVykAq9/OTF8p8fE3lTobdynSwb0aF8jsSRalwSvaOA55IfQgMdLLw0vW5CM6SWprsOasY2JfCGn+9gmPndAtFvtXzRMT/+LOah9YYAqjDpWCNZTS1354EbNyy4kmNqzD4MQ3slexSqn7kiQ13GrAG4dZUS7YYw55KeQMb2XDnzDlQhyCpbFmH4kmF8pV8jqV27G5DjeCthHugpPJJv1p+NVUYQymDtBLm071cfuMBYbZSYNYk9A5NeyrUAVLBZFILgX0pr7HeGbhXTK6CeKJ0sz3KAxzZ5DjW3cU22kZ8PIDVxZMa7p1fqEivYmdS85qjqcIF6YB304dSoxlwcfJLM85314svFbHZRrPb2zsu77cyr2/p3fnL78skFyoFo89h/BChu8t415clpclrOHzD3Xep0cJ01Xpb/arlUouBOZ+y8guCW6d2u5ZIhRgeAvtUWmPMScivk8cph81VWzkPmnbGklKvQ8854xO71dzT1Iaw4erlw+yR49XsSircZ1vJsyeapiskD2dSjC39nG0jkTwgeL20d35SM0p3qv4hlCsWcsku6urzmsFQcmrXNX0w597Bw9/iEwCN22iVXH7eT5Xpni2/irz8xmQnVcJdEN1XH5SKgWmFNaoutba/jmtJccxyn/ZN+lShNdvtTtpHf2cHK8k+ZrtwF+xK6ispSf1bvvPFXD0EKc4hvyJa+y/868Xy+xTmhdNVB6hvHWj9GxFBoZxm8z7Je7h3hN/b0449oR4MhFfask+hxDveUoqZa3373Nj/gP+IVGKXkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSEkFSE/AURoO8QAA0d8AAAAABJRU5ErkJggg==",DateTimeConfig=({controller:a})=>{var o;const r=(o=a.getConfig())==null?void 0:o.style,e=s=>{const{dataFragment:l}=s;a.update(l)},n={type:"grid",config:{columns:2},children:[{key:"style",children:[{key:"fontSize",type:"number-input",label:"字号",value:r==null?void 0:r.fontSize,config:{min:1}},{key:"fontWeight",type:"number-input",label:"加粗",value:(r==null?void 0:r.fontWeight)||400,config:{min:100,max:900,step:100}},{key:"color",type:"color-picker",label:"颜色",value:r==null?void 0:r.color,config:{showText:!0}},{key:"fontFamily",type:"select",label:"字体",value:r==null?void 0:r.fontFamily,config:{options:[{label:"钉钉进步体",value:"DingTalk JinBuTi"},{label:"抖音美好体",value:"DouyinSansBold"},{label:"优设标题黑",value:"优设标题黑"},{label:"庞门正道标题",value:"庞门正道标题体免费版"}]}},{key:"letterSpacing",type:"number-input",label:"字距",value:r==null?void 0:r.letterSpacing,config:{step:.1}},{type:"select",label:"模板",key:"formatType",value:r==null?void 0:r.formatType,config:{options:[{label:"-",value:"0"},{label:"/",value:"1"},{label:"CN",value:"2"}]}},{type:"grid",label:"对齐",config:{columns:2,containerStyle:{gridColumn:"1/3"}},children:[{type:"group-button",key:"justifyContent",value:r==null?void 0:r.justifyContent,config:{items:[{value:"flex-start",content:jsxRuntimeExports.jsx(AlignLeftTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"center",content:jsxRuntimeExports.jsx(AlignHorizontalCenterTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"flex-end",content:jsxRuntimeExports.jsx(AlignRightTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})}]}},{type:"group-button",key:"alignItems",value:r==null?void 0:r.alignItems,config:{items:[{value:"flex-start",content:jsxRuntimeExports.jsx(AlignTopTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"center",content:jsxRuntimeExports.jsx(AlignVerticalCenterTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"flex-end",content:jsxRuntimeExports.jsx(AlignBottomTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})}]}}]}]}]};return jsxRuntimeExports.jsx(LCGUI,{schema:n,onFieldChange:e})};class DateTimeDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"当前时间",compKey:"DateTime",categorize:"info",subCategorize:"text",width:320,height:26}}getChartImg(){return DateTimeImg}getController(){return DateTimeController}getInitConfig(){return{base:{id:"",name:"当前时间",type:"DateTime"},style:{fontSize:16,fontWeight:500,color:"#fff",fontFamily:"Arial",alignItems:"center",justifyContent:"center",letterSpacing:"1",formatType:FormatType.CN},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0}}}getMenuList(){return super.getMenuList().filter(r=>r.key!=="theme"&&r.key!=="data")}getMenuToConfigContentMap(){const r=super.getMenuToConfigContentMap();return r.style=DateTimeConfig,r}getEventList(){return super.getEventList().concat([{id:"click",name:"点击时"}])}}const __vite_glob_0_73=Object.freeze(Object.defineProperty({__proto__:null,default:DateTimeDefinition},Symbol.toStringTag,{value:"Module"}));var t=function(){return t=Object.assign||function(a){for(var r,e=1,n=arguments.length;e<n;e++)for(var o in r=arguments[e])Object.prototype.hasOwnProperty.call(r,o)&&(a[o]=r[o]);return a},t.apply(this,arguments)},i=function(){function a(r,e,n){var o=this;this.endVal=e,this.options=n,this.version="2.8.0",this.defaults={startVal:0,decimalPlaces:0,duration:2,useEasing:!0,useGrouping:!0,useIndianSeparators:!1,smartEasingThreshold:999,smartEasingAmount:333,separator:",",decimal:".",prefix:"",suffix:"",enableScrollSpy:!1,scrollSpyDelay:200,scrollSpyOnce:!1},this.finalEndVal=null,this.useEasing=!0,this.countDown=!1,this.error="",this.startVal=0,this.paused=!0,this.once=!1,this.count=function(s){o.startTime||(o.startTime=s);var l=s-o.startTime;o.remaining=o.duration-l,o.useEasing?o.countDown?o.frameVal=o.startVal-o.easingFn(l,0,o.startVal-o.endVal,o.duration):o.frameVal=o.easingFn(l,o.startVal,o.endVal-o.startVal,o.duration):o.frameVal=o.startVal+(o.endVal-o.startVal)*(l/o.duration);var c=o.countDown?o.frameVal<o.endVal:o.frameVal>o.endVal;o.frameVal=c?o.endVal:o.frameVal,o.frameVal=Number(o.frameVal.toFixed(o.options.decimalPlaces)),o.printValue(o.frameVal),l<o.duration?o.rAF=requestAnimationFrame(o.count):o.finalEndVal!==null?o.update(o.finalEndVal):o.options.onCompleteCallback&&o.options.onCompleteCallback()},this.formatNumber=function(s){var l,c,u,f,d=s<0?"-":"";l=Math.abs(s).toFixed(o.options.decimalPlaces);var g=(l+="").split(".");if(c=g[0],u=g.length>1?o.options.decimal+g[1]:"",o.options.useGrouping){f="";for(var p=3,v=0,m=0,y=c.length;m<y;++m)o.options.useIndianSeparators&&m===4&&(p=2,v=1),m!==0&&v%p==0&&(f=o.options.separator+f),v++,f=c[y-m-1]+f;c=f}return o.options.numerals&&o.options.numerals.length&&(c=c.replace(/[0-9]/g,function(x){return o.options.numerals[+x]}),u=u.replace(/[0-9]/g,function(x){return o.options.numerals[+x]})),d+o.options.prefix+c+u+o.options.suffix},this.easeOutExpo=function(s,l,c,u){return c*(1-Math.pow(2,-10*s/u))*1024/1023+l},this.options=t(t({},this.defaults),n),this.formattingFn=this.options.formattingFn?this.options.formattingFn:this.formatNumber,this.easingFn=this.options.easingFn?this.options.easingFn:this.easeOutExpo,this.startVal=this.validateValue(this.options.startVal),this.frameVal=this.startVal,this.endVal=this.validateValue(e),this.options.decimalPlaces=Math.max(this.options.decimalPlaces),this.resetDuration(),this.options.separator=String(this.options.separator),this.useEasing=this.options.useEasing,this.options.separator===""&&(this.options.useGrouping=!1),this.el=typeof r=="string"?document.getElementById(r):r,this.el?this.printValue(this.startVal):this.error="[CountUp] target is null or undefined",typeof window<"u"&&this.options.enableScrollSpy&&(this.error?console.error(this.error,r):(window.onScrollFns=window.onScrollFns||[],window.onScrollFns.push(function(){return o.handleScroll(o)}),window.onscroll=function(){window.onScrollFns.forEach(function(s){return s()})},this.handleScroll(this)))}return a.prototype.handleScroll=function(r){if(r&&window&&!r.once){var e=window.innerHeight+window.scrollY,n=r.el.getBoundingClientRect(),o=n.top+window.pageYOffset,s=n.top+n.height+window.pageYOffset;s<e&&s>window.scrollY&&r.paused?(r.paused=!1,setTimeout(function(){return r.start()},r.options.scrollSpyDelay),r.options.scrollSpyOnce&&(r.once=!0)):(window.scrollY>s||o>e)&&!r.paused&&r.reset()}},a.prototype.determineDirectionAndSmartEasing=function(){var r=this.finalEndVal?this.finalEndVal:this.endVal;this.countDown=this.startVal>r;var e=r-this.startVal;if(Math.abs(e)>this.options.smartEasingThreshold&&this.options.useEasing){this.finalEndVal=r;var n=this.countDown?1:-1;this.endVal=r+n*this.options.smartEasingAmount,this.duration=this.duration/2}else this.endVal=r,this.finalEndVal=null;this.finalEndVal!==null?this.useEasing=!1:this.useEasing=this.options.useEasing},a.prototype.start=function(r){this.error||(this.options.onStartCallback&&this.options.onStartCallback(),r&&(this.options.onCompleteCallback=r),this.duration>0?(this.determineDirectionAndSmartEasing(),this.paused=!1,this.rAF=requestAnimationFrame(this.count)):this.printValue(this.endVal))},a.prototype.pauseResume=function(){this.paused?(this.startTime=null,this.duration=this.remaining,this.startVal=this.frameVal,this.determineDirectionAndSmartEasing(),this.rAF=requestAnimationFrame(this.count)):cancelAnimationFrame(this.rAF),this.paused=!this.paused},a.prototype.reset=function(){cancelAnimationFrame(this.rAF),this.paused=!0,this.resetDuration(),this.startVal=this.validateValue(this.options.startVal),this.frameVal=this.startVal,this.printValue(this.startVal)},a.prototype.update=function(r){cancelAnimationFrame(this.rAF),this.startTime=null,this.endVal=this.validateValue(r),this.endVal!==this.frameVal&&(this.startVal=this.frameVal,this.finalEndVal==null&&this.resetDuration(),this.finalEndVal=null,this.determineDirectionAndSmartEasing(),this.rAF=requestAnimationFrame(this.count))},a.prototype.printValue=function(r){var e;if(this.el){var n=this.formattingFn(r);!((e=this.options.plugin)===null||e===void 0)&&e.render?this.options.plugin.render(this.el,n):this.el.tagName==="INPUT"?this.el.value=n:this.el.tagName==="text"||this.el.tagName==="tspan"?this.el.textContent=n:this.el.innerHTML=n}},a.prototype.ensureNumber=function(r){return typeof r=="number"&&!isNaN(r)},a.prototype.validateValue=function(r){var e=Number(r);return this.ensureNumber(e)?e:(this.error="[CountUp] invalid start or end value: ".concat(r),null)},a.prototype.resetDuration=function(){this.startTime=null,this.duration=1e3*Number(this.options.duration),this.remaining=this.duration},a}(),__assign=function(){return(__assign=Object.assign||function(a){for(var r,e=1,n=arguments.length;e<n;e++)for(var o in r=arguments[e])Object.prototype.hasOwnProperty.call(r,o)&&(a[o]=r[o]);return a}).apply(this,arguments)},rAF=window.requestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},Odometer=function(){function a(r){this.version="1.0",this.defaults={duration:.8,lastDigitDelay:.25},this.cell_digits=null,this.options=__assign(__assign({},this.defaults),r),this.cell_digits=null}return a.prototype.render=function(r,e){for(var n,o=this.options,s=!1,l=(this.cell_digits||(s=!0,document.querySelector("style[odometer]")||((n=document.createElement("style")).setAttribute("odometer","odometer"),n.innerHTML=".odometer-numbers{display:inline-flex;line-height:100%;overflow-y:hidden}.odometer-numbers>span{display:flex;flex-direction:column;justify-content:start;align-items:center;height:1em;will-change:transform;transform:translateY(0)}",document.head.appendChild(n)),r.innerHTML='<div class="odometer-numbers"></div>',this.cell_digits=[]),'<span style="color:transparent">0</span>'),c="transform ".concat(o.duration,"s ease-out"),u=this.cell_digits.length;u<e.length;u++){var f=document.createElement("span");f.style.transition=c,f.innerHTML=s?"":l,r.firstChild&&r.firstChild.appendChild(f),this.cell_digits.push({container:f,current:void 0,position:s?1:0,new:!0})}function d(x,_){x.position--,x.container.appendChild(_),x.lastTimeAdd=+new Date,x.new?(x.new=!1,rAF(function(){x.container.style.transform="translateY(".concat(x.position,"em)")})):x.container.style.transform="translateY(".concat(x.position,"em)")}function g(){p=u<e.length?e.charAt(u):null;var x,_,E,S,A=y.cell_digits[u];A.current!=p&&(A.current=p,(v=document.createElement("span")).innerHTML=p===null?l:p,A.container.children.length<4?d(A,v):(_=v,(x=A).nextToAdd&&(d(x,x.nextToAdd),clearTimeout(x.lastTimer),x.nextToAdd=null),E=+new Date,S=1e3*o.lastDigitDelay-(E-x.lastTimeAdd),o.lastDigitDelay<=0||E-x.lastTimeAdd>=1.05*S?(d(x,_),x.nextToAdd=null):(x.nextToAdd=_,x.lastTimer=setTimeout(function(){d(x,x.nextToAdd),x.nextToAdd=null},1e3*o.duration))),clearTimeout(A.timerClean),A.timerClean=setTimeout(function(){A.timerClean=null,A.container.children.length<3||(A.container.style.transition="none",rAF(function(){for(A.position=-1;1<A.container.children.length;)A.container.removeChild(A.container.firstChild);var T=document.createElement("span");T.innerHTML=l,A.container.insertBefore(T,A.container.firstChild),A.container.style.transform="translateY(".concat(A.position,"em)"),rAF(function(){A.container.style.transition=c})}))},1e3*((o.duration||.8)+(o.duration||.25))+2500))}for(var p,v,m=Math.max(e.length,this.cell_digits.length),y=this,u=0;u<m;u++)g()},a}();const DigitalFlipperComponent=React.forwardRef((a,r)=>{const[e,n]=reactExports.useState({...a}),o=reactExports.useRef({}),s=reactExports.useRef(null);let l;reactExports.useEffect(()=>{var f,d;l=new i(s.current,(f=e.data)==null?void 0:f.staticData,{plugin:((d=e.style)==null?void 0:d.type)==="slide"?new Odometer({duration:1,lastDigitDelay:0}):void 0,duration:1}),l.error?console.error(l.error):l.start()},[]),reactExports.useImperativeHandle(r,()=>({updateConfig:f=>n({...f}),changeData:f=>l.update(f),setEventHandler:f=>o.current=f}));const c=()=>{"click"in o.current&&o.current.click()},{style:u}=e;return jsxRuntimeExports.jsx("div",{ref:s,style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",...u},onClick:c})});class DigitalFlipperController extends AbstractDesignerController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,DigitalFlipperComponent,e)}destroy(){this.instance=null,this.config=null}getConfig(){return this.config}changeData(r){var n,o,s;this.config.data.staticData=r,(n=this.instance)==null||n.changeData(r);const e=(s=(o=this.config)==null?void 0:o.base)==null?void 0:s.id;BPExecutor.triggerComponentEvent(e,"dataChange",r)}update(r,e){var n;this.config=ObjectUtil.merge(this.config,r),e=e||{reRender:!0},e.reRender&&((n=this.instance)==null||n.updateConfig(this.config))}updateTheme(r){}registerEvent(){var e,n,o;const r=(n=(e=this.config)==null?void 0:e.base)==null?void 0:n.id;(o=this.instance)==null||o.setEventHandler({click:()=>BPExecutor.triggerComponentEvent(r,"click",this.config)})}}const __vite_glob_0_74=Object.freeze(Object.defineProperty({__proto__:null,DigitalFlipperController},Symbol.toStringTag,{value:"Module"})),digitalFlipperImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAJ4AAABeCAIAAABdDzqYAAAGWElEQVR4Xu2Y20uVWRTA+0OOmdLFW2pFF6MysybpBtmp9CHtbmXRQw9dICMqu5CFFUUEURZlQZC+iCIV2c1yEmsI7EJpZUWOXayjVCPzm2/j7vPLbBiYc3Sxfk/HdfbZ57R/a629vvr5FKH08wYUKahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasahasYRM7fz582/fvl1WVmYjCxYsqK+v//z5c3t7+4MHD+bOnUswNjb2ypUrnz59Ivj27dtt27b179//+y4/Yffu3a9fv/b7/ebPs2fP/tlJQ0NDVFSUiU+ZMuXOnTtszpc+e/YsJibm+xYuoqOjHz58aHcw5Obm8tbixYvZMBAIfPz48eLFi2bnAQMGHD16tKWlpa2trba2dsaMGd4dg0Jo1GKL0+SAysvLbXDPnj1bt27lXMaMGXP37t1Hjx4NHjwYtZs2bRo4cCDxkydPcoJxcXGunbphxIgRz58/JxUyMzNNpLq6urS09DeHyZMnh4eHExw5cmRjY+OlS5d4weZz5syJiIjoslEnJNOkSZPMx2Hv3r388tGjRw8fPvzVq1fkzZAhQ0gjvnHNmjVsfvjw4Q8fPmRkZPDj/3CIjIz0bvr/Exq1BQUFiYmJV69edat1s2XLlnfv3g0dOtQdXLRoEXWQkJDgDnpAUmVl5c2bN9+/f2/V3rt3j+PuuvCfymYNP8MT7xnygH5AFvJ64sSJra2tycnJPqeyyacjR47worm5mSw06ylZ1mRnZ7s3CQ6hUQtkdw9qi4uLOSnbOW2Qtkkpu4MeqBuOcu3atVYtsh8/frxr166pU6e6V16/fp0fQBFv3749KyvL/VYP7Ny5s6mpCX+8HjRo0I0bN6h7/ly6dOmXL1+mT5/Ob6a1HDx40KynXsnRDRs2dNklKPRGtbRlxGzcuNH8uXDhQsqOHoih2bNnd13bhdTUVEqKD9I2rVr689OnT0mUVoeioiLTeLkj79+/zyWKHuKY9mTSj9BgmQZoAGFhYSbCV3CzfP369du3b1VVVaQdmcT9zU+lpvFaWFjIu9wpXTYKCr1LLR341KlTpDlFZoNcrrS1vLw8LuCXL1+OGjXKnqwbzh1JFRUVmHOrdbNv3z5qa9myZVyfXLQvXrwwN3dOTk5HR8e8efM86z2sX7+eUS4pKcn8iTwK9Pz58/Hx8UuWLOF+pcmjlmuYyv7LgTZDf7ZpGkx6kdphw4Y9efKEwZIjcy38ztixYzlK7mmOz/uez3fhwgUK6HeHuro6FFLr5lK08BWU9YkTJ9iBQz937pyJM7gxBPUsgHziCid1bIROjjY71lGg9AaahM9Jx1QHk2QM//ZTQaMXqT1z5gzt0RxNt6CWYzKV4X3PeZLJ7ITyosfu2LEjJSXFvcbUGfclO/DcxSMW9yVxllFhjGnuxR4odE/95efn83vsWHfs2DHUkj12AdnApUvn98yDwaEXqaWMbt26ldfJ5s2bzXhy+vRpGuaKFSuQ8ebNm/Hjx9uGfOjQIXcZWdwNOS0t7fjx4+ywatUqrkOqlimXHZhambcPHDjAW4xCtFA7LSOeul+5cqV7z+XLl9MVZs2aZSM8EdGES0pKeLplPuDd/fv381nmtfT0dEp29erVBPmHuLYJHqFUy7VKptvI5cuXzVOggXaKg5kzZ9bU1DQ4MOngya7nEOm92LURy4QJE8gSo4GKrK2tNTuQTGSGXYY8xiLi165dc3cLxGB63LhxNuJzhjsyw/OwNG3aNIYmdmBu4smH52+CVDajE5d3IBBYt26de30wCZnafw8VFuHgmZ4YRynBX84+PqeXdruDz8kP4p7/4eI6pxn8uLhbzM/z3BExMTE0amM6VPQBtT+D06Rd//KJ5T/g9/tp6d5oX6MPq1V6RtWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWKRdWK5W/9sJBzPMhZ0gAAAABJRU5ErkJggg==",DigitalFlipperConfig=({controller:a})=>{var o,s,l,c,u,f,d;const r=a.getConfig(),e=g=>{const{dataFragment:p}=g;a.update(p)},n={type:"grid",key:"style",config:{columns:2},children:[{key:"fontSize",type:"number-input",label:"字号",value:(o=r==null?void 0:r.style)==null?void 0:o.fontSize,config:{min:0}},{key:"fontWeight",type:"number-input",label:"粗细",value:(s=r==null?void 0:r.style)==null?void 0:s.fontWeight,config:{min:0,max:900,step:100}},{key:"color",type:"color-picker",label:"颜色",value:(l=r==null?void 0:r.style)==null?void 0:l.color,config:{showText:!0}},{key:"type",type:"select",label:"类型",tip:"该设置项效果请刷新预览界面查看",value:(c=r==null?void 0:r.style)==null?void 0:c.type,config:{options:[{label:"滑动",value:"slide"},{label:"跳动",value:"caper"}]}},{key:"fontFamily",type:"select",label:"字体",value:(u=r==null?void 0:r.style)==null?void 0:u.fontFamily,config:{options:[{label:"钉钉进步体",value:"DingTalk JinBuTi"},{label:"抖音美好体",value:"DouyinSansBold"},{label:"优设标题黑",value:"优设标题黑"},{label:"庞门正道标题",value:"庞门正道标题体免费版"}]}},{type:"grid",label:"对齐",config:{columns:2,containerStyle:{gridColumn:"1/3"}},children:[{type:"group-button",key:"justifyContent",value:(f=r==null?void 0:r.style)==null?void 0:f.justifyContent,config:{items:[{value:"flex-start",content:jsxRuntimeExports.jsx(AlignLeftTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"center",content:jsxRuntimeExports.jsx(AlignHorizontalCenterTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"flex-end",content:jsxRuntimeExports.jsx(AlignRightTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})}]}},{type:"group-button",key:"alignItems",value:(d=r==null?void 0:r.style)==null?void 0:d.alignItems,config:{items:[{value:"flex-start",content:jsxRuntimeExports.jsx(AlignTopTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"center",content:jsxRuntimeExports.jsx(AlignVerticalCenterTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"flex-end",content:jsxRuntimeExports.jsx(AlignBottomTwo,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})}]}}]}]};return jsxRuntimeExports.jsx(LCGUI,{schema:n,onFieldChange:e})};class DigitalFlipperDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"数字翻牌器",compKey:"DigitalFlipper",categorize:"info",width:200,height:50}}getChartImg(){return digitalFlipperImg}getController(){return DigitalFlipperController}getInitConfig(){return{base:{id:"",name:"数字翻牌器",type:"DigitalFlipper"},style:{fontSize:20,fontWeight:500,fontFamily:"Microsoft YaHei",color:"#ffffff",type:"caper",justifyContent:"center",alignItems:"center"},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0},data:{sourceType:"static",staticData:123456789}}}getMenuList(){return super.getMenuList().filter(r=>r.key!=="theme")}getMenuToConfigContentMap(){const r=super.getMenuToConfigContentMap();return r.style=DigitalFlipperConfig,r}getEventList(){return super.getEventList().concat([{id:"click",name:"点击时"},{id:"dataChange",name:"数据变化时"}])}}const __vite_glob_0_75=Object.freeze(Object.defineProperty({__proto__:null,default:DigitalFlipperDefinition},Symbol.toStringTag,{value:"Module"}));var flv={exports:{}};(function(a,r){(function(n,o){a.exports=o()})(self,function(){return function(){var e={"./node_modules/es6-promise/dist/es6-promise.js":function(l,c,u){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(f,d){l.exports=d()})(this,function(){function f(j){var X=typeof j;return j!==null&&(X==="object"||X==="function")}function d(j){return typeof j=="function"}var g=void 0;Array.isArray?g=Array.isArray:g=function(j){return Object.prototype.toString.call(j)==="[object Array]"};var p=g,v=0,m=void 0,y=void 0,x=function(X,q){D[v]=X,D[v+1]=q,v+=2,v===2&&(y?y(O):k())};function _(j){y=j}function E(j){x=j}var S=typeof window<"u"?window:void 0,A=S||{},T=A.MutationObserver||A.WebKitMutationObserver,b=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",C=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function L(){return function(){return process.nextTick(O)}}function R(){return typeof m<"u"?function(){m(O)}:M()}function I(){var j=0,X=new T(O),q=document.createTextNode("");return X.observe(q,{characterData:!0}),function(){q.data=j=++j%2}}function w(){var j=new MessageChannel;return j.port1.onmessage=O,function(){return j.port2.postMessage(0)}}function M(){var j=setTimeout;return function(){return j(O,1)}}var D=new Array(1e3);function O(){for(var j=0;j<v;j+=2){var X=D[j],q=D[j+1];X(q),D[j]=void 0,D[j+1]=void 0}v=0}function F(){try{var j=Function("return this")().require("vertx");return m=j.runOnLoop||j.runOnContext,R()}catch{return M()}}var k=void 0;b?k=L():T?k=I():C?k=w():S===void 0?k=F():k=M();function $(j,X){var q=this,J=new this.constructor(B);J[N]===void 0&&xt(J);var rt=q._state;if(rt){var it=arguments[rt-1];x(function(){return lt(rt,J,it,q._result)})}else st(q,J,j,X);return J}function V(j){var X=this;if(j&&typeof j=="object"&&j.constructor===X)return j;var q=new X(B);return at(q,j),q}var N=Math.random().toString(36).substring(2);function B(){}var G=void 0,z=1,H=2;function W(){return new TypeError("You cannot resolve a promise with itself")}function Y(){return new TypeError("A promises callback cannot return that same promise.")}function K(j,X,q,J){try{j.call(X,q,J)}catch(rt){return rt}}function Z(j,X,q){x(function(J){var rt=!1,it=K(q,X,function(ct){rt||(rt=!0,X!==ct?at(J,ct):nt(J,ct))},function(ct){rt||(rt=!0,Q(J,ct))},"Settle: "+(J._label||" unknown promise"));!rt&&it&&(rt=!0,Q(J,it))},j)}function tt(j,X){X._state===z?nt(j,X._result):X._state===H?Q(j,X._result):st(X,void 0,function(q){return at(j,q)},function(q){return Q(j,q)})}function et(j,X,q){X.constructor===j.constructor&&q===$&&X.constructor.resolve===V?tt(j,X):q===void 0?nt(j,X):d(q)?Z(j,X,q):nt(j,X)}function at(j,X){if(j===X)Q(j,W());else if(f(X)){var q=void 0;try{q=X.then}catch(J){Q(j,J);return}et(j,X,q)}else nt(j,X)}function ot(j){j._onerror&&j._onerror(j._result),dt(j)}function nt(j,X){j._state===G&&(j._result=X,j._state=z,j._subscribers.length!==0&&x(dt,j))}function Q(j,X){j._state===G&&(j._state=H,j._result=X,x(ot,j))}function st(j,X,q,J){var rt=j._subscribers,it=rt.length;j._onerror=null,rt[it]=X,rt[it+z]=q,rt[it+H]=J,it===0&&j._state&&x(dt,j)}function dt(j){var X=j._subscribers,q=j._state;if(X.length!==0){for(var J=void 0,rt=void 0,it=j._result,ct=0;ct<X.length;ct+=3)J=X[ct],rt=X[ct+q],J?lt(q,J,rt,it):rt(it);j._subscribers.length=0}}function lt(j,X,q,J){var rt=d(q),it=void 0,ct=void 0,_t=!0;if(rt){try{it=q(J)}catch(At){_t=!1,ct=At}if(X===it){Q(X,Y());return}}else it=J;X._state!==G||(rt&&_t?at(X,it):_t===!1?Q(X,ct):j===z?nt(X,it):j===H&&Q(X,it))}function ut(j,X){try{X(function(J){at(j,J)},function(J){Q(j,J)})}catch(q){Q(j,q)}}var mt=0;function yt(){return mt++}function xt(j){j[N]=mt++,j._state=void 0,j._result=void 0,j._subscribers=[]}function vt(){return new Error("Array Methods must be provided an Array")}var gt=function(){function j(X,q){this._instanceConstructor=X,this.promise=new X(B),this.promise[N]||xt(this.promise),p(q)?(this.length=q.length,this._remaining=q.length,this._result=new Array(this.length),this.length===0?nt(this.promise,this._result):(this.length=this.length||0,this._enumerate(q),this._remaining===0&&nt(this.promise,this._result))):Q(this.promise,vt())}return j.prototype._enumerate=function(q){for(var J=0;this._state===G&&J<q.length;J++)this._eachEntry(q[J],J)},j.prototype._eachEntry=function(q,J){var rt=this._instanceConstructor,it=rt.resolve;if(it===V){var ct=void 0,_t=void 0,At=!1;try{ct=q.then}catch(bt){At=!0,_t=bt}if(ct===$&&q._state!==G)this._settledAt(q._state,J,q._result);else if(typeof ct!="function")this._remaining--,this._result[J]=q;else if(rt===ht){var Tt=new rt(B);At?Q(Tt,_t):et(Tt,q,ct),this._willSettleAt(Tt,J)}else this._willSettleAt(new rt(function(bt){return bt(q)}),J)}else this._willSettleAt(it(q),J)},j.prototype._settledAt=function(q,J,rt){var it=this.promise;it._state===G&&(this._remaining--,q===H?Q(it,rt):this._result[J]=rt),this._remaining===0&&nt(it,this._result)},j.prototype._willSettleAt=function(q,J){var rt=this;st(q,void 0,function(it){return rt._settledAt(z,J,it)},function(it){return rt._settledAt(H,J,it)})},j}();function Et(j){return new gt(this,j).promise}function St(j){var X=this;return p(j)?new X(function(q,J){for(var rt=j.length,it=0;it<rt;it++)X.resolve(j[it]).then(q,J)}):new X(function(q,J){return J(new TypeError("You must pass an array to race."))})}function Ct(j){var X=this,q=new X(B);return Q(q,j),q}function Lt(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function It(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var ht=function(){function j(X){this[N]=yt(),this._result=this._state=void 0,this._subscribers=[],B!==X&&(typeof X!="function"&&Lt(),this instanceof j?ut(this,X):It())}return j.prototype.catch=function(q){return this.then(null,q)},j.prototype.finally=function(q){var J=this,rt=J.constructor;return d(q)?J.then(function(it){return rt.resolve(q()).then(function(){return it})},function(it){return rt.resolve(q()).then(function(){throw it})}):J.then(q,q)},j}();ht.prototype.then=$,ht.all=Et,ht.race=St,ht.resolve=V,ht.reject=Ct,ht._setScheduler=_,ht._setAsap=E,ht._asap=x;function Rt(){var j=void 0;if(typeof u.g<"u")j=u.g;else if(typeof self<"u")j=self;else try{j=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var X=j.Promise;if(X){var q=null;try{q=Object.prototype.toString.call(X.resolve())}catch{}if(q==="[object Promise]"&&!X.cast)return}j.Promise=ht}return ht.polyfill=Rt,ht.Promise=ht,ht})},"./node_modules/events/events.js":function(l){var c=typeof Reflect=="object"?Reflect:null,u=c&&typeof c.apply=="function"?c.apply:function(M,D,O){return Function.prototype.apply.call(M,D,O)},f;c&&typeof c.ownKeys=="function"?f=c.ownKeys:Object.getOwnPropertySymbols?f=function(M){return Object.getOwnPropertyNames(M).concat(Object.getOwnPropertySymbols(M))}:f=function(M){return Object.getOwnPropertyNames(M)};function d(w){console&&console.warn&&console.warn(w)}var g=Number.isNaN||function(M){return M!==M};function p(){p.init.call(this)}l.exports=p,l.exports.once=L,p.EventEmitter=p,p.prototype._events=void 0,p.prototype._eventsCount=0,p.prototype._maxListeners=void 0;var v=10;function m(w){if(typeof w!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof w)}Object.defineProperty(p,"defaultMaxListeners",{enumerable:!0,get:function(){return v},set:function(w){if(typeof w!="number"||w<0||g(w))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+w+".");v=w}}),p.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},p.prototype.setMaxListeners=function(M){if(typeof M!="number"||M<0||g(M))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+M+".");return this._maxListeners=M,this};function y(w){return w._maxListeners===void 0?p.defaultMaxListeners:w._maxListeners}p.prototype.getMaxListeners=function(){return y(this)},p.prototype.emit=function(M){for(var D=[],O=1;O<arguments.length;O++)D.push(arguments[O]);var F=M==="error",k=this._events;if(k!==void 0)F=F&&k.error===void 0;else if(!F)return!1;if(F){var $;if(D.length>0&&($=D[0]),$ instanceof Error)throw $;var V=new Error("Unhandled error."+($?" ("+$.message+")":""));throw V.context=$,V}var N=k[M];if(N===void 0)return!1;if(typeof N=="function")u(N,this,D);else for(var B=N.length,G=T(N,B),O=0;O<B;++O)u(G[O],this,D);return!0};function x(w,M,D,O){var F,k,$;if(m(D),k=w._events,k===void 0?(k=w._events=Object.create(null),w._eventsCount=0):(k.newListener!==void 0&&(w.emit("newListener",M,D.listener?D.listener:D),k=w._events),$=k[M]),$===void 0)$=k[M]=D,++w._eventsCount;else if(typeof $=="function"?$=k[M]=O?[D,$]:[$,D]:O?$.unshift(D):$.push(D),F=y(w),F>0&&$.length>F&&!$.warned){$.warned=!0;var V=new Error("Possible EventEmitter memory leak detected. "+$.length+" "+String(M)+" listeners added. Use emitter.setMaxListeners() to increase limit");V.name="MaxListenersExceededWarning",V.emitter=w,V.type=M,V.count=$.length,d(V)}return w}p.prototype.addListener=function(M,D){return x(this,M,D,!1)},p.prototype.on=p.prototype.addListener,p.prototype.prependListener=function(M,D){return x(this,M,D,!0)};function _(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function E(w,M,D){var O={fired:!1,wrapFn:void 0,target:w,type:M,listener:D},F=_.bind(O);return F.listener=D,O.wrapFn=F,F}p.prototype.once=function(M,D){return m(D),this.on(M,E(this,M,D)),this},p.prototype.prependOnceListener=function(M,D){return m(D),this.prependListener(M,E(this,M,D)),this},p.prototype.removeListener=function(M,D){var O,F,k,$,V;if(m(D),F=this._events,F===void 0)return this;if(O=F[M],O===void 0)return this;if(O===D||O.listener===D)--this._eventsCount===0?this._events=Object.create(null):(delete F[M],F.removeListener&&this.emit("removeListener",M,O.listener||D));else if(typeof O!="function"){for(k=-1,$=O.length-1;$>=0;$--)if(O[$]===D||O[$].listener===D){V=O[$].listener,k=$;break}if(k<0)return this;k===0?O.shift():b(O,k),O.length===1&&(F[M]=O[0]),F.removeListener!==void 0&&this.emit("removeListener",M,V||D)}return this},p.prototype.off=p.prototype.removeListener,p.prototype.removeAllListeners=function(M){var D,O,F;if(O=this._events,O===void 0)return this;if(O.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):O[M]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete O[M]),this;if(arguments.length===0){var k=Object.keys(O),$;for(F=0;F<k.length;++F)$=k[F],$!=="removeListener"&&this.removeAllListeners($);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(D=O[M],typeof D=="function")this.removeListener(M,D);else if(D!==void 0)for(F=D.length-1;F>=0;F--)this.removeListener(M,D[F]);return this};function S(w,M,D){var O=w._events;if(O===void 0)return[];var F=O[M];return F===void 0?[]:typeof F=="function"?D?[F.listener||F]:[F]:D?C(F):T(F,F.length)}p.prototype.listeners=function(M){return S(this,M,!0)},p.prototype.rawListeners=function(M){return S(this,M,!1)},p.listenerCount=function(w,M){return typeof w.listenerCount=="function"?w.listenerCount(M):A.call(w,M)},p.prototype.listenerCount=A;function A(w){var M=this._events;if(M!==void 0){var D=M[w];if(typeof D=="function")return 1;if(D!==void 0)return D.length}return 0}p.prototype.eventNames=function(){return this._eventsCount>0?f(this._events):[]};function T(w,M){for(var D=new Array(M),O=0;O<M;++O)D[O]=w[O];return D}function b(w,M){for(;M+1<w.length;M++)w[M]=w[M+1];w.pop()}function C(w){for(var M=new Array(w.length),D=0;D<M.length;++D)M[D]=w[D].listener||w[D];return M}function L(w,M){return new Promise(function(D,O){function F($){w.removeListener(M,k),O($)}function k(){typeof w.removeListener=="function"&&w.removeListener("error",F),D([].slice.call(arguments))}I(w,M,k,{once:!0}),M!=="error"&&R(w,F,{once:!0})})}function R(w,M,D){typeof w.on=="function"&&I(w,"error",M,D)}function I(w,M,D,O){if(typeof w.on=="function")O.once?w.once(M,D):w.on(M,D);else if(typeof w.addEventListener=="function")w.addEventListener(M,function F(k){O.once&&w.removeEventListener(M,F),D(k)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof w)}},"./node_modules/webworkify-webpack/index.js":function(l,c,u){function f(_){var E={};function S(T){if(E[T])return E[T].exports;var b=E[T]={i:T,l:!1,exports:{}};return _[T].call(b.exports,b,b.exports,S),b.l=!0,b.exports}S.m=_,S.c=E,S.i=function(T){return T},S.d=function(T,b,C){S.o(T,b)||Object.defineProperty(T,b,{configurable:!1,enumerable:!0,get:C})},S.r=function(T){Object.defineProperty(T,"__esModule",{value:!0})},S.n=function(T){var b=T&&T.__esModule?function(){return T.default}:function(){return T};return S.d(b,"a",b),b},S.o=function(T,b){return Object.prototype.hasOwnProperty.call(T,b)},S.p="/",S.oe=function(T){throw console.error(T),T};var A=S(S.s=ENTRY_MODULE);return A.default||A}var d="[\\.|\\-|\\+|\\w|/|@]+",g="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+d+").*?\\)";function p(_){return(_+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function v(_){return!isNaN(1*_)}function m(_,E,S){var A={};A[S]=[];var T=E.toString(),b=T.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!b)return A;for(var C=b[1],L=new RegExp("(\\\\n|\\W)"+p(C)+g,"g"),R;R=L.exec(T);)R[3]!=="dll-reference"&&A[S].push(R[3]);for(L=new RegExp("\\("+p(C)+'\\("(dll-reference\\s('+d+'))"\\)\\)'+g,"g");R=L.exec(T);)_[R[2]]||(A[S].push(R[1]),_[R[2]]=u(R[1]).m),A[R[2]]=A[R[2]]||[],A[R[2]].push(R[4]);for(var I=Object.keys(A),w=0;w<I.length;w++)for(var M=0;M<A[I[w]].length;M++)v(A[I[w]][M])&&(A[I[w]][M]=1*A[I[w]][M]);return A}function y(_){var E=Object.keys(_);return E.reduce(function(S,A){return S||_[A].length>0},!1)}function x(_,E){for(var S={main:[E]},A={main:[]},T={main:{}};y(S);)for(var b=Object.keys(S),C=0;C<b.length;C++){var L=b[C],R=S[L],I=R.pop();if(T[L]=T[L]||{},!(T[L][I]||!_[L][I])){T[L][I]=!0,A[L]=A[L]||[],A[L].push(I);for(var w=m(_,_[L][I],L),M=Object.keys(w),D=0;D<M.length;D++)S[M[D]]=S[M[D]]||[],S[M[D]]=S[M[D]].concat(w[M[D]])}}return A}l.exports=function(_,E){E=E||{};var S={main:u.m},A=E.all?{main:Object.keys(S.main)}:x(S,_),T="";Object.keys(A).filter(function(I){return I!=="main"}).forEach(function(I){for(var w=0;A[I][w];)w++;A[I].push(w),S[I][w]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",T=T+"var "+I+" = ("+f.toString().replace("ENTRY_MODULE",JSON.stringify(w))+")({"+A[I].map(function(M){return""+JSON.stringify(M)+": "+S[I][M].toString()}).join(",")+`});
`}),T=T+"new (("+f.toString().replace("ENTRY_MODULE",JSON.stringify(_))+")({"+A.main.map(function(I){return""+JSON.stringify(I)+": "+S.main[I].toString()}).join(",")+"}))(self);";var b=new window.Blob([T],{type:"text/javascript"});if(E.bare)return b;var C=window.URL||window.webkitURL||window.mozURL||window.msURL,L=C.createObjectURL(b),R=new window.Worker(L);return R.objectURL=L,R}},"./src/config.js":function(l,c,u){u.r(c),u.d(c,{defaultConfig:function(){return f},createDefaultConfig:function(){return d}});var f={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function d(){return Object.assign({},f)}},"./src/core/features.js":function(l,c,u){u.r(c);var f=u("./src/io/io-controller.js"),d=u("./src/config.js"),g=function(){function p(){}return p.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},p.supportNetworkStreamIO=function(){var v=new f.default({},(0,d.createDefaultConfig)()),m=v.loaderType;return v.destroy(),m=="fetch-stream-loader"||m=="xhr-moz-chunked-loader"},p.getNetworkLoaderTypeName=function(){var v=new f.default({},(0,d.createDefaultConfig)()),m=v.loaderType;return v.destroy(),m},p.supportNativeMediaPlayback=function(v){p.videoElement==null&&(p.videoElement=window.document.createElement("video"));var m=p.videoElement.canPlayType(v);return m==="probably"||m=="maybe"},p.getFeatureList=function(){var v={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return v.mseFlvPlayback=p.supportMSEH264Playback(),v.networkStreamIO=p.supportNetworkStreamIO(),v.networkLoaderName=p.getNetworkLoaderTypeName(),v.mseLiveFlvPlayback=v.mseFlvPlayback&&v.networkStreamIO,v.nativeMP4H264Playback=p.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),v.nativeWebmVP8Playback=p.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),v.nativeWebmVP9Playback=p.supportNativeMediaPlayback('video/webm; codecs="vp9"'),v},p}();c.default=g},"./src/core/media-info.js":function(l,c,u){u.r(c);var f=function(){function d(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return d.prototype.isComplete=function(){var g=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,p=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&g&&p},d.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},d.prototype.getNearestKeyframe=function(g){if(this.keyframesIndex==null)return null;var p=this.keyframesIndex,v=this._search(p.times,g);return{index:v,milliseconds:p.times[v],fileposition:p.filepositions[v]}},d.prototype._search=function(g,p){var v=0,m=g.length-1,y=0,x=0,_=m;for(p<g[0]&&(v=0,x=_+1);x<=_;)if(y=x+Math.floor((_-x)/2),y===m||p>=g[y]&&p<g[y+1]){v=y;break}else g[y]<p?x=y+1:_=y-1;return v},d}();c.default=f},"./src/core/media-segment-info.js":function(l,c,u){u.r(c),u.d(c,{SampleInfo:function(){return f},MediaSegmentInfo:function(){return d},IDRSampleList:function(){return g},MediaSegmentInfoList:function(){return p}});var f=function(){function v(m,y,x,_,E){this.dts=m,this.pts=y,this.duration=x,this.originalDts=_,this.isSyncPoint=E,this.fileposition=null}return v}(),d=function(){function v(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return v.prototype.appendSyncPoint=function(m){m.isSyncPoint=!0,this.syncPoints.push(m)},v}(),g=function(){function v(){this._list=[]}return v.prototype.clear=function(){this._list=[]},v.prototype.appendArray=function(m){var y=this._list;m.length!==0&&(y.length>0&&m[0].originalDts<y[y.length-1].originalDts&&this.clear(),Array.prototype.push.apply(y,m))},v.prototype.getLastSyncPointBeforeDts=function(m){if(this._list.length==0)return null;var y=this._list,x=0,_=y.length-1,E=0,S=0,A=_;for(m<y[0].dts&&(x=0,S=A+1);S<=A;)if(E=S+Math.floor((A-S)/2),E===_||m>=y[E].dts&&m<y[E+1].dts){x=E;break}else y[E].dts<m?S=E+1:A=E-1;return this._list[x]},v}(),p=function(){function v(m){this._type=m,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(v.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),v.prototype.isEmpty=function(){return this._list.length===0},v.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},v.prototype._searchNearestSegmentBefore=function(m){var y=this._list;if(y.length===0)return-2;var x=y.length-1,_=0,E=0,S=x,A=0;if(m<y[0].originalBeginDts)return A=-1,A;for(;E<=S;)if(_=E+Math.floor((S-E)/2),_===x||m>y[_].lastSample.originalDts&&m<y[_+1].originalBeginDts){A=_;break}else y[_].originalBeginDts<m?E=_+1:S=_-1;return A},v.prototype._searchNearestSegmentAfter=function(m){return this._searchNearestSegmentBefore(m)+1},v.prototype.append=function(m){var y=this._list,x=m,_=this._lastAppendLocation,E=0;_!==-1&&_<y.length&&x.originalBeginDts>=y[_].lastSample.originalDts&&(_===y.length-1||_<y.length-1&&x.originalBeginDts<y[_+1].originalBeginDts)?E=_+1:y.length>0&&(E=this._searchNearestSegmentBefore(x.originalBeginDts)+1),this._lastAppendLocation=E,this._list.splice(E,0,x)},v.prototype.getLastSegmentBefore=function(m){var y=this._searchNearestSegmentBefore(m);return y>=0?this._list[y]:null},v.prototype.getLastSampleBefore=function(m){var y=this.getLastSegmentBefore(m);return y!=null?y.lastSample:null},v.prototype.getLastSyncPointBefore=function(m){for(var y=this._searchNearestSegmentBefore(m),x=this._list[y].syncPoints;x.length===0&&y>0;)y--,x=this._list[y].syncPoints;return x.length>0?x[x.length-1]:null},v}()},"./src/core/mse-controller.js":function(l,c,u){u.r(c);var f=u("./node_modules/events/events.js"),d=u.n(f),g=u("./src/utils/logger.js"),p=u("./src/utils/browser.js"),v=u("./src/core/mse-events.js"),m=u("./src/core/media-segment-info.js"),y=u("./src/utils/exception.js"),x=function(){function _(E){this.TAG="MSEController",this._config=E,this._emitter=new(d()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new m.IDRSampleList}return _.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},_.prototype.on=function(E,S){this._emitter.addListener(E,S)},_.prototype.off=function(E,S){this._emitter.removeListener(E,S)},_.prototype.attachMediaElement=function(E){if(this._mediaSource)throw new y.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var S=this._mediaSource=new window.MediaSource;S.addEventListener("sourceopen",this.e.onSourceOpen),S.addEventListener("sourceended",this.e.onSourceEnded),S.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=E,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),E.src=this._mediaSourceObjectURL},_.prototype.detachMediaElement=function(){if(this._mediaSource){var E=this._mediaSource;for(var S in this._sourceBuffers){var A=this._pendingSegments[S];A.splice(0,A.length),this._pendingSegments[S]=null,this._pendingRemoveRanges[S]=null,this._lastInitSegments[S]=null;var T=this._sourceBuffers[S];if(T){if(E.readyState!=="closed"){try{E.removeSourceBuffer(T)}catch(b){g.default.e(this.TAG,b.message)}T.removeEventListener("error",this.e.onSourceBufferError),T.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[S]=null,this._sourceBuffers[S]=null}}if(E.readyState==="open")try{E.endOfStream()}catch(b){g.default.e(this.TAG,b.message)}E.removeEventListener("sourceopen",this.e.onSourceOpen),E.removeEventListener("sourceended",this.e.onSourceEnded),E.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},_.prototype.appendInitSegment=function(E,S){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(E),this._pendingSegments[E.type].push(E);return}var A=E,T=""+A.container;A.codec&&A.codec.length>0&&(T+=";codecs="+A.codec);var b=!1;if(g.default.v(this.TAG,"Received Initialization Segment, mimeType: "+T),this._lastInitSegments[A.type]=A,T!==this._mimeTypes[A.type]){if(this._mimeTypes[A.type])g.default.v(this.TAG,"Notice: "+A.type+" mimeType changed, origin: "+this._mimeTypes[A.type]+", target: "+T);else{b=!0;try{var C=this._sourceBuffers[A.type]=this._mediaSource.addSourceBuffer(T);C.addEventListener("error",this.e.onSourceBufferError),C.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(L){g.default.e(this.TAG,L.message),this._emitter.emit(v.default.ERROR,{code:L.code,msg:L.message});return}}this._mimeTypes[A.type]=T}S||this._pendingSegments[A.type].push(A),b||this._sourceBuffers[A.type]&&!this._sourceBuffers[A.type].updating&&this._doAppendSegments(),p.default.safari&&A.container==="audio/mpeg"&&A.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=A.mediaDuration/1e3,this._updateMediaSourceDuration())},_.prototype.appendMediaSegment=function(E){var S=E;this._pendingSegments[S.type].push(S),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var A=this._sourceBuffers[S.type];A&&!A.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},_.prototype.seek=function(E){for(var S in this._sourceBuffers)if(this._sourceBuffers[S]){var A=this._sourceBuffers[S];if(this._mediaSource.readyState==="open")try{A.abort()}catch(I){g.default.e(this.TAG,I.message)}this._idrList.clear();var T=this._pendingSegments[S];if(T.splice(0,T.length),this._mediaSource.readyState!=="closed"){for(var b=0;b<A.buffered.length;b++){var C=A.buffered.start(b),L=A.buffered.end(b);this._pendingRemoveRanges[S].push({start:C,end:L})}if(A.updating||this._doRemoveRanges(),p.default.safari){var R=this._lastInitSegments[S];R&&(this._pendingSegments[S].push(R),A.updating||this._doAppendSegments())}}}},_.prototype.endOfStream=function(){var E=this._mediaSource,S=this._sourceBuffers;if(!E||E.readyState!=="open"){E&&E.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}S.video&&S.video.updating||S.audio&&S.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,E.endOfStream())},_.prototype.getNearestKeyframe=function(E){return this._idrList.getLastSyncPointBeforeDts(E)},_.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var E=this._mediaElement.currentTime;for(var S in this._sourceBuffers){var A=this._sourceBuffers[S];if(A){var T=A.buffered;if(T.length>=1&&E-T.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},_.prototype._doCleanupSourceBuffer=function(){var E=this._mediaElement.currentTime;for(var S in this._sourceBuffers){var A=this._sourceBuffers[S];if(A){for(var T=A.buffered,b=!1,C=0;C<T.length;C++){var L=T.start(C),R=T.end(C);if(L<=E&&E<R+3){if(E-L>=this._config.autoCleanupMaxBackwardDuration){b=!0;var I=E-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[S].push({start:L,end:I})}}else R<E&&(b=!0,this._pendingRemoveRanges[S].push({start:L,end:R}))}b&&!A.updating&&this._doRemoveRanges()}}},_.prototype._updateMediaSourceDuration=function(){var E=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(E.video&&E.video.updating||E.audio&&E.audio.updating)){var S=this._mediaSource.duration,A=this._pendingMediaDuration;A>0&&(isNaN(S)||A>S)&&(g.default.v(this.TAG,"Update MediaSource duration from "+S+" to "+A),this._mediaSource.duration=A),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},_.prototype._doRemoveRanges=function(){for(var E in this._pendingRemoveRanges)if(!(!this._sourceBuffers[E]||this._sourceBuffers[E].updating))for(var S=this._sourceBuffers[E],A=this._pendingRemoveRanges[E];A.length&&!S.updating;){var T=A.shift();S.remove(T.start,T.end)}},_.prototype._doAppendSegments=function(){var E=this._pendingSegments;for(var S in E)if(!(!this._sourceBuffers[S]||this._sourceBuffers[S].updating)&&E[S].length>0){var A=E[S].shift();if(A.timestampOffset){var T=this._sourceBuffers[S].timestampOffset,b=A.timestampOffset/1e3,C=Math.abs(T-b);C>.1&&(g.default.v(this.TAG,"Update MPEG audio timestampOffset from "+T+" to "+b),this._sourceBuffers[S].timestampOffset=b),delete A.timestampOffset}if(!A.data||A.data.byteLength===0)continue;try{this._sourceBuffers[S].appendBuffer(A.data),this._isBufferFull=!1,S==="video"&&A.hasOwnProperty("info")&&this._idrList.appendArray(A.info.syncPoints)}catch(L){this._pendingSegments[S].unshift(A),L.code===22?(this._isBufferFull||this._emitter.emit(v.default.BUFFER_FULL),this._isBufferFull=!0):(g.default.e(this.TAG,L.message),this._emitter.emit(v.default.ERROR,{code:L.code,msg:L.message}))}}},_.prototype._onSourceOpen=function(){if(g.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var E=this._pendingSourceBufferInit;E.length;){var S=E.shift();this.appendInitSegment(S,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(v.default.SOURCE_OPEN)},_.prototype._onSourceEnded=function(){g.default.v(this.TAG,"MediaSource onSourceEnded")},_.prototype._onSourceClose=function(){g.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},_.prototype._hasPendingSegments=function(){var E=this._pendingSegments;return E.video.length>0||E.audio.length>0},_.prototype._hasPendingRemoveRanges=function(){var E=this._pendingRemoveRanges;return E.video.length>0||E.audio.length>0},_.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(v.default.UPDATE_END)},_.prototype._onSourceBufferError=function(E){g.default.e(this.TAG,"SourceBuffer Error: "+E)},_}();c.default=x},"./src/core/mse-events.js":function(l,c,u){u.r(c);var f={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};c.default=f},"./src/core/transmuxer.js":function(l,c,u){u.r(c);var f=u("./node_modules/events/events.js"),d=u.n(f),g=u("./node_modules/webworkify-webpack/index.js"),p=u.n(g),v=u("./src/utils/logger.js"),m=u("./src/utils/logging-control.js"),y=u("./src/core/transmuxing-controller.js"),x=u("./src/core/transmuxing-events.js"),_=u("./src/core/media-info.js"),E=function(){function S(A,T){if(this.TAG="Transmuxer",this._emitter=new(d()),T.enableWorker&&typeof Worker<"u")try{this._worker=p()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[A,T]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},m.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:m.default.getConfig()})}catch{v.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new y.default(A,T)}else this._controller=new y.default(A,T);if(this._controller){var b=this._controller;b.on(x.default.IO_ERROR,this._onIOError.bind(this)),b.on(x.default.DEMUX_ERROR,this._onDemuxError.bind(this)),b.on(x.default.INIT_SEGMENT,this._onInitSegment.bind(this)),b.on(x.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),b.on(x.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),b.on(x.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),b.on(x.default.MEDIA_INFO,this._onMediaInfo.bind(this)),b.on(x.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),b.on(x.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),b.on(x.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),b.on(x.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return S.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),m.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},S.prototype.on=function(A,T){this._emitter.addListener(A,T)},S.prototype.off=function(A,T){this._emitter.removeListener(A,T)},S.prototype.hasWorker=function(){return this._worker!=null},S.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},S.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},S.prototype.seek=function(A){this._worker?this._worker.postMessage({cmd:"seek",param:A}):this._controller.seek(A)},S.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},S.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},S.prototype._onInitSegment=function(A,T){var b=this;Promise.resolve().then(function(){b._emitter.emit(x.default.INIT_SEGMENT,A,T)})},S.prototype._onMediaSegment=function(A,T){var b=this;Promise.resolve().then(function(){b._emitter.emit(x.default.MEDIA_SEGMENT,A,T)})},S.prototype._onLoadingComplete=function(){var A=this;Promise.resolve().then(function(){A._emitter.emit(x.default.LOADING_COMPLETE)})},S.prototype._onRecoveredEarlyEof=function(){var A=this;Promise.resolve().then(function(){A._emitter.emit(x.default.RECOVERED_EARLY_EOF)})},S.prototype._onMediaInfo=function(A){var T=this;Promise.resolve().then(function(){T._emitter.emit(x.default.MEDIA_INFO,A)})},S.prototype._onMetaDataArrived=function(A){var T=this;Promise.resolve().then(function(){T._emitter.emit(x.default.METADATA_ARRIVED,A)})},S.prototype._onScriptDataArrived=function(A){var T=this;Promise.resolve().then(function(){T._emitter.emit(x.default.SCRIPTDATA_ARRIVED,A)})},S.prototype._onStatisticsInfo=function(A){var T=this;Promise.resolve().then(function(){T._emitter.emit(x.default.STATISTICS_INFO,A)})},S.prototype._onIOError=function(A,T){var b=this;Promise.resolve().then(function(){b._emitter.emit(x.default.IO_ERROR,A,T)})},S.prototype._onDemuxError=function(A,T){var b=this;Promise.resolve().then(function(){b._emitter.emit(x.default.DEMUX_ERROR,A,T)})},S.prototype._onRecommendSeekpoint=function(A){var T=this;Promise.resolve().then(function(){T._emitter.emit(x.default.RECOMMEND_SEEKPOINT,A)})},S.prototype._onLoggingConfigChanged=function(A){this._worker&&this._worker.postMessage({cmd:"logging_config",param:A})},S.prototype._onWorkerMessage=function(A){var T=A.data,b=T.data;if(T.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(T.msg){case x.default.INIT_SEGMENT:case x.default.MEDIA_SEGMENT:this._emitter.emit(T.msg,b.type,b.data);break;case x.default.LOADING_COMPLETE:case x.default.RECOVERED_EARLY_EOF:this._emitter.emit(T.msg);break;case x.default.MEDIA_INFO:Object.setPrototypeOf(b,_.default.prototype),this._emitter.emit(T.msg,b);break;case x.default.METADATA_ARRIVED:case x.default.SCRIPTDATA_ARRIVED:case x.default.STATISTICS_INFO:this._emitter.emit(T.msg,b);break;case x.default.IO_ERROR:case x.default.DEMUX_ERROR:this._emitter.emit(T.msg,b.type,b.info);break;case x.default.RECOMMEND_SEEKPOINT:this._emitter.emit(T.msg,b);break;case"logcat_callback":v.default.emitter.emit("log",b.type,b.logcat);break}},S}();c.default=E},"./src/core/transmuxing-controller.js":function(l,c,u){u.r(c);var f=u("./node_modules/events/events.js"),d=u.n(f),g=u("./src/utils/logger.js"),p=u("./src/utils/browser.js"),v=u("./src/core/media-info.js"),m=u("./src/demux/flv-demuxer.js"),y=u("./src/remux/mp4-remuxer.js"),x=u("./src/demux/demux-errors.js"),_=u("./src/io/io-controller.js"),E=u("./src/core/transmuxing-events.js"),S=function(){function A(T,b){this.TAG="TransmuxingController",this._emitter=new(d()),this._config=b,T.segments||(T.segments=[{duration:T.duration,filesize:T.filesize,url:T.url}]),typeof T.cors!="boolean"&&(T.cors=!0),typeof T.withCredentials!="boolean"&&(T.withCredentials=!1),this._mediaDataSource=T,this._currentSegmentIndex=0;var C=0;this._mediaDataSource.segments.forEach(function(L){L.timestampBase=C,C+=L.duration,L.cors=T.cors,L.withCredentials=T.withCredentials,b.referrerPolicy&&(L.referrerPolicy=b.referrerPolicy)}),!isNaN(C)&&this._mediaDataSource.duration!==C&&(this._mediaDataSource.duration=C),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return A.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},A.prototype.on=function(T,b){this._emitter.addListener(T,b)},A.prototype.off=function(T,b){this._emitter.removeListener(T,b)},A.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},A.prototype._loadSegment=function(T,b){this._currentSegmentIndex=T;var C=this._mediaDataSource.segments[T],L=this._ioctl=new _.default(C,this._config,T);L.onError=this._onIOException.bind(this),L.onSeeked=this._onIOSeeked.bind(this),L.onComplete=this._onIOComplete.bind(this),L.onRedirect=this._onIORedirect.bind(this),L.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),b?this._demuxer.bindDataSource(this._ioctl):L.onDataArrival=this._onInitChunkArrival.bind(this),L.open(b)},A.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},A.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},A.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},A.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},A.prototype.seek=function(T){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var b=this._searchSegmentIndexContains(T);if(b===this._currentSegmentIndex){var C=this._mediaInfo.segments[b];if(C==null)this._pendingSeekTime=T;else{var L=C.getNearestKeyframe(T);this._remuxer.seek(L.milliseconds),this._ioctl.seek(L.fileposition),this._pendingResolveSeekPoint=L.milliseconds}}else{var R=this._mediaInfo.segments[b];if(R==null)this._pendingSeekTime=T,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(b);else{var L=R.getNearestKeyframe(T);this._internalAbort(),this._remuxer.seek(T),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[b].timestampBase,this._loadSegment(b,L.fileposition),this._pendingResolveSeekPoint=L.milliseconds,this._reportSegmentMediaInfo(b)}}this._enableStatisticsReporter()}},A.prototype._searchSegmentIndexContains=function(T){for(var b=this._mediaDataSource.segments,C=b.length-1,L=0;L<b.length;L++)if(T<b[L].timestampBase){C=L-1;break}return C},A.prototype._onInitChunkArrival=function(T,b){var C=this,L=null,R=0;if(b>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,R=this._demuxer.parseChunks(T,b);else if((L=m.default.probe(T)).match){this._demuxer=new m.default(L,this._config),this._remuxer||(this._remuxer=new y.default(this._config));var I=this._mediaDataSource;I.duration!=null&&!isNaN(I.duration)&&(this._demuxer.overridedDuration=I.duration),typeof I.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=I.hasAudio),typeof I.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=I.hasVideo),this._demuxer.timestampBase=I.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),R=this._demuxer.parseChunks(T,b)}else L=null,g.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){C._internalAbort()}),this._emitter.emit(E.default.DEMUX_ERROR,x.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),R=0;return R},A.prototype._onMediaInfo=function(T){var b=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},T),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,v.default.prototype));var C=Object.assign({},T);Object.setPrototypeOf(C,v.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=C,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var L=b._pendingSeekTime;b._pendingSeekTime=null,b.seek(L)})},A.prototype._onMetaDataArrived=function(T){this._emitter.emit(E.default.METADATA_ARRIVED,T)},A.prototype._onScriptDataArrived=function(T){this._emitter.emit(E.default.SCRIPTDATA_ARRIVED,T)},A.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},A.prototype._onIOComplete=function(T){var b=T,C=b+1;C<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(C)):(this._remuxer.flushStashedSamples(),this._emitter.emit(E.default.LOADING_COMPLETE),this._disableStatisticsReporter())},A.prototype._onIORedirect=function(T){var b=this._ioctl.extraData;this._mediaDataSource.segments[b].redirectedURL=T},A.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(E.default.RECOVERED_EARLY_EOF)},A.prototype._onIOException=function(T,b){g.default.e(this.TAG,"IOException: type = "+T+", code = "+b.code+", msg = "+b.msg),this._emitter.emit(E.default.IO_ERROR,T,b),this._disableStatisticsReporter()},A.prototype._onDemuxException=function(T,b){g.default.e(this.TAG,"DemuxException: type = "+T+", info = "+b),this._emitter.emit(E.default.DEMUX_ERROR,T,b)},A.prototype._onRemuxerInitSegmentArrival=function(T,b){this._emitter.emit(E.default.INIT_SEGMENT,T,b)},A.prototype._onRemuxerMediaSegmentArrival=function(T,b){if(this._pendingSeekTime==null&&(this._emitter.emit(E.default.MEDIA_SEGMENT,T,b),this._pendingResolveSeekPoint!=null&&T==="video")){var C=b.info.syncPoints,L=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,p.default.safari&&C.length>0&&C[0].originalDts===L&&(L=C[0].pts),this._emitter.emit(E.default.RECOMMEND_SEEKPOINT,L)}},A.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},A.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},A.prototype._reportSegmentMediaInfo=function(T){var b=this._mediaInfo.segments[T],C=Object.assign({},b);C.duration=this._mediaInfo.duration,C.segmentCount=this._mediaInfo.segmentCount,delete C.segments,delete C.keyframesIndex,this._emitter.emit(E.default.MEDIA_INFO,C)},A.prototype._reportStatisticsInfo=function(){var T={};T.url=this._ioctl.currentURL,T.hasRedirect=this._ioctl.hasRedirect,T.hasRedirect&&(T.redirectedURL=this._ioctl.currentRedirectedURL),T.speed=this._ioctl.currentSpeed,T.loaderType=this._ioctl.loaderType,T.currentSegmentIndex=this._currentSegmentIndex,T.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(E.default.STATISTICS_INFO,T)},A}();c.default=S},"./src/core/transmuxing-events.js":function(l,c,u){u.r(c);var f={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};c.default=f},"./src/core/transmuxing-worker.js":function(l,c,u){u.r(c);var f=u("./src/utils/logging-control.js"),d=u("./src/utils/polyfill.js"),g=u("./src/core/transmuxing-controller.js"),p=u("./src/core/transmuxing-events.js"),v=function(m){var y=null,x=M.bind(this);d.default.install(),m.addEventListener("message",function(D){switch(D.data.cmd){case"init":y=new g.default(D.data.param[0],D.data.param[1]),y.on(p.default.IO_ERROR,R.bind(this)),y.on(p.default.DEMUX_ERROR,I.bind(this)),y.on(p.default.INIT_SEGMENT,_.bind(this)),y.on(p.default.MEDIA_SEGMENT,E.bind(this)),y.on(p.default.LOADING_COMPLETE,S.bind(this)),y.on(p.default.RECOVERED_EARLY_EOF,A.bind(this)),y.on(p.default.MEDIA_INFO,T.bind(this)),y.on(p.default.METADATA_ARRIVED,b.bind(this)),y.on(p.default.SCRIPTDATA_ARRIVED,C.bind(this)),y.on(p.default.STATISTICS_INFO,L.bind(this)),y.on(p.default.RECOMMEND_SEEKPOINT,w.bind(this));break;case"destroy":y&&(y.destroy(),y=null),m.postMessage({msg:"destroyed"});break;case"start":y.start();break;case"stop":y.stop();break;case"seek":y.seek(D.data.param);break;case"pause":y.pause();break;case"resume":y.resume();break;case"logging_config":{var O=D.data.param;f.default.applyConfig(O),O.enableCallback===!0?f.default.addLogListener(x):f.default.removeLogListener(x);break}}});function _(D,O){var F={msg:p.default.INIT_SEGMENT,data:{type:D,data:O}};m.postMessage(F,[O.data])}function E(D,O){var F={msg:p.default.MEDIA_SEGMENT,data:{type:D,data:O}};m.postMessage(F,[O.data])}function S(){var D={msg:p.default.LOADING_COMPLETE};m.postMessage(D)}function A(){var D={msg:p.default.RECOVERED_EARLY_EOF};m.postMessage(D)}function T(D){var O={msg:p.default.MEDIA_INFO,data:D};m.postMessage(O)}function b(D){var O={msg:p.default.METADATA_ARRIVED,data:D};m.postMessage(O)}function C(D){var O={msg:p.default.SCRIPTDATA_ARRIVED,data:D};m.postMessage(O)}function L(D){var O={msg:p.default.STATISTICS_INFO,data:D};m.postMessage(O)}function R(D,O){m.postMessage({msg:p.default.IO_ERROR,data:{type:D,info:O}})}function I(D,O){m.postMessage({msg:p.default.DEMUX_ERROR,data:{type:D,info:O}})}function w(D){m.postMessage({msg:p.default.RECOMMEND_SEEKPOINT,data:D})}function M(D,O){m.postMessage({msg:"logcat_callback",data:{type:D,logcat:O}})}};c.default=v},"./src/demux/amf-parser.js":function(l,c,u){u.r(c);var f=u("./src/utils/logger.js"),d=u("./src/utils/utf8-conv.js"),g=u("./src/utils/exception.js"),p=function(){var m=new ArrayBuffer(2);return new DataView(m).setInt16(0,256,!0),new Int16Array(m)[0]===256}(),v=function(){function m(){}return m.parseScriptData=function(y,x,_){var E={};try{var S=m.parseValue(y,x,_),A=m.parseValue(y,x+S.size,_-S.size);E[S.data]=A.data}catch(T){f.default.e("AMF",T.toString())}return E},m.parseObject=function(y,x,_){if(_<3)throw new g.IllegalStateException("Data not enough when parse ScriptDataObject");var E=m.parseString(y,x,_),S=m.parseValue(y,x+E.size,_-E.size),A=S.objectEnd;return{data:{name:E.data,value:S.data},size:E.size+S.size,objectEnd:A}},m.parseVariable=function(y,x,_){return m.parseObject(y,x,_)},m.parseString=function(y,x,_){if(_<2)throw new g.IllegalStateException("Data not enough when parse String");var E=new DataView(y,x,_),S=E.getUint16(0,!p),A;return S>0?A=(0,d.default)(new Uint8Array(y,x+2,S)):A="",{data:A,size:2+S}},m.parseLongString=function(y,x,_){if(_<4)throw new g.IllegalStateException("Data not enough when parse LongString");var E=new DataView(y,x,_),S=E.getUint32(0,!p),A;return S>0?A=(0,d.default)(new Uint8Array(y,x+4,S)):A="",{data:A,size:4+S}},m.parseDate=function(y,x,_){if(_<10)throw new g.IllegalStateException("Data size invalid when parse Date");var E=new DataView(y,x,_),S=E.getFloat64(0,!p),A=E.getInt16(8,!p);return S+=A*60*1e3,{data:new Date(S),size:10}},m.parseValue=function(y,x,_){if(_<1)throw new g.IllegalStateException("Data not enough when parse Value");var E=new DataView(y,x,_),S=1,A=E.getUint8(0),T,b=!1;try{switch(A){case 0:T=E.getFloat64(1,!p),S+=8;break;case 1:{var C=E.getUint8(1);T=!!C,S+=1;break}case 2:{var L=m.parseString(y,x+1,_-1);T=L.data,S+=L.size;break}case 3:{T={};var R=0;for((E.getUint32(_-4,!p)&16777215)===9&&(R=3);S<_-4;){var I=m.parseObject(y,x+S,_-S-R);if(I.objectEnd)break;T[I.data.name]=I.data.value,S+=I.size}if(S<=_-3){var w=E.getUint32(S-1,!p)&16777215;w===9&&(S+=3)}break}case 8:{T={},S+=4;var R=0;for((E.getUint32(_-4,!p)&16777215)===9&&(R=3);S<_-8;){var M=m.parseVariable(y,x+S,_-S-R);if(M.objectEnd)break;T[M.data.name]=M.data.value,S+=M.size}if(S<=_-3){var w=E.getUint32(S-1,!p)&16777215;w===9&&(S+=3)}break}case 9:T=void 0,S=1,b=!0;break;case 10:{T=[];var D=E.getUint32(1,!p);S+=4;for(var O=0;O<D;O++){var F=m.parseValue(y,x+S,_-S);T.push(F.data),S+=F.size}break}case 11:{var k=m.parseDate(y,x+1,_-1);T=k.data,S+=k.size;break}case 12:{var $=m.parseString(y,x+1,_-1);T=$.data,S+=$.size;break}default:S=_,f.default.w("AMF","Unsupported AMF value type "+A)}}catch(V){f.default.e("AMF",V.toString())}return{data:T,size:S,objectEnd:b}},m}();c.default=v},"./src/demux/demux-errors.js":function(l,c,u){u.r(c);var f={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};c.default=f},"./src/demux/exp-golomb.js":function(l,c,u){u.r(c);var f=u("./src/utils/exception.js"),d=function(){function g(p){this.TAG="ExpGolomb",this._buffer=p,this._buffer_index=0,this._total_bytes=p.byteLength,this._total_bits=p.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return g.prototype.destroy=function(){this._buffer=null},g.prototype._fillCurrentWord=function(){var p=this._total_bytes-this._buffer_index;if(p<=0)throw new f.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var v=Math.min(4,p),m=new Uint8Array(4);m.set(this._buffer.subarray(this._buffer_index,this._buffer_index+v)),this._current_word=new DataView(m.buffer).getUint32(0,!1),this._buffer_index+=v,this._current_word_bits_left=v*8},g.prototype.readBits=function(p){if(p>32)throw new f.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(p<=this._current_word_bits_left){var v=this._current_word>>>32-p;return this._current_word<<=p,this._current_word_bits_left-=p,v}var m=this._current_word_bits_left?this._current_word:0;m=m>>>32-this._current_word_bits_left;var y=p-this._current_word_bits_left;this._fillCurrentWord();var x=Math.min(y,this._current_word_bits_left),_=this._current_word>>>32-x;return this._current_word<<=x,this._current_word_bits_left-=x,m=m<<x|_,m},g.prototype.readBool=function(){return this.readBits(1)===1},g.prototype.readByte=function(){return this.readBits(8)},g.prototype._skipLeadingZero=function(){var p;for(p=0;p<this._current_word_bits_left;p++)if(this._current_word&2147483648>>>p)return this._current_word<<=p,this._current_word_bits_left-=p,p;return this._fillCurrentWord(),p+this._skipLeadingZero()},g.prototype.readUEG=function(){var p=this._skipLeadingZero();return this.readBits(p+1)-1},g.prototype.readSEG=function(){var p=this.readUEG();return p&1?p+1>>>1:-1*(p>>>1)},g}();c.default=d},"./src/demux/flv-demuxer.js":function(l,c,u){u.r(c);var f=u("./src/utils/logger.js"),d=u("./src/demux/amf-parser.js"),g=u("./src/demux/sps-parser.js"),p=u("./src/demux/demux-errors.js"),v=u("./src/core/media-info.js"),m=u("./src/utils/exception.js");function y(_,E){return _[E]<<24|_[E+1]<<16|_[E+2]<<8|_[E+3]}var x=function(){function _(E,S){this.TAG="FLVDemuxer",this._config=S,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=E.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=E.hasAudioTrack,this._hasVideo=E.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new v.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var A=new ArrayBuffer(2);return new DataView(A).setInt16(0,256,!0),new Int16Array(A)[0]===256}()}return _.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},_.probe=function(E){var S=new Uint8Array(E),A={match:!1};if(S[0]!==70||S[1]!==76||S[2]!==86||S[3]!==1)return A;var T=(S[4]&4)>>>2!==0,b=(S[4]&1)!==0,C=y(S,5);return C<9?A:{match:!0,consumed:C,dataOffset:C,hasAudioTrack:T,hasVideoTrack:b}},_.prototype.bindDataSource=function(E){return E.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(_.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(E){this._onTrackMetadata=E},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(E){this._onMediaInfo=E},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(E){this._onMetaDataArrived=E},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(E){this._onScriptDataArrived=E},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onError",{get:function(){return this._onError},set:function(E){this._onError=E},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(E){this._onDataAvailable=E},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(E){this._timestampBase=E},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"overridedDuration",{get:function(){return this._duration},set:function(E){this._durationOverrided=!0,this._duration=E,this._mediaInfo.duration=E},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"overridedHasAudio",{set:function(E){this._hasAudioFlagOverrided=!0,this._hasAudio=E,this._mediaInfo.hasAudio=E},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"overridedHasVideo",{set:function(E){this._hasVideoFlagOverrided=!0,this._hasVideo=E,this._mediaInfo.hasVideo=E},enumerable:!1,configurable:!0}),_.prototype.resetMediaInfo=function(){this._mediaInfo=new v.default},_.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},_.prototype.parseChunks=function(E,S){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new m.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var A=0,T=this._littleEndian;if(S===0)if(E.byteLength>13){var b=_.probe(E);A=b.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,S+A!==this._dataOffset&&f.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var C=new DataView(E,A),L=C.getUint32(0,!T);L!==0&&f.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),A+=4}for(;A<E.byteLength;){this._dispatch=!0;var C=new DataView(E,A);if(A+11+4>E.byteLength)break;var R=C.getUint8(0),I=C.getUint32(0,!T)&16777215;if(A+11+I+4>E.byteLength)break;if(R!==8&&R!==9&&R!==18){f.default.w(this.TAG,"Unsupported tag type "+R+", skipped"),A+=11+I+4;continue}var w=C.getUint8(4),M=C.getUint8(5),D=C.getUint8(6),O=C.getUint8(7),F=D|M<<8|w<<16|O<<24,k=C.getUint32(7,!T)&16777215;k!==0&&f.default.w(this.TAG,"Meet tag which has StreamID != 0!");var $=A+11;switch(R){case 8:this._parseAudioData(E,$,I,F);break;case 9:this._parseVideoData(E,$,I,F,S+A);break;case 18:this._parseScriptData(E,$,I);break}var V=C.getUint32(11+I,!T);V!==11+I&&f.default.w(this.TAG,"Invalid PrevTagSize "+V),A+=11+I+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),A},_.prototype._parseScriptData=function(E,S,A){var T=d.default.parseScriptData(E,S,A);if(T.hasOwnProperty("onMetaData")){if(T.onMetaData==null||typeof T.onMetaData!="object"){f.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&f.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=T;var b=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},b)),typeof b.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=b.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof b.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=b.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof b.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=b.audiodatarate),typeof b.videodatarate=="number"&&(this._mediaInfo.videoDataRate=b.videodatarate),typeof b.width=="number"&&(this._mediaInfo.width=b.width),typeof b.height=="number"&&(this._mediaInfo.height=b.height),typeof b.duration=="number"){if(!this._durationOverrided){var C=Math.floor(b.duration*this._timescale);this._duration=C,this._mediaInfo.duration=C}}else this._mediaInfo.duration=0;if(typeof b.framerate=="number"){var L=Math.floor(b.framerate*1e3);if(L>0){var R=L/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=R,this._referenceFrameRate.fps_num=L,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=R}}if(typeof b.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var I=b.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(I),b.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=b,f.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(T).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},T))},_.prototype._parseKeyframesIndex=function(E){for(var S=[],A=[],T=1;T<E.times.length;T++){var b=this._timestampBase+Math.floor(E.times[T]*1e3);S.push(b),A.push(E.filepositions[T])}return{times:S,filepositions:A}},_.prototype._parseAudioData=function(E,S,A,T){if(A<=1){f.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var b=new DataView(E,S,A),C=b.getUint8(0),L=C>>>4;if(L!==2&&L!==10){this._onError(p.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+L);return}var R=0,I=(C&12)>>>2;if(I>=0&&I<=4)R=this._flvSoundRateTable[I];else{this._onError(p.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+I);return}var w=C&1,M=this._audioMetadata,D=this._audioTrack;if(M||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),M=this._audioMetadata={},M.type="audio",M.id=D.id,M.timescale=this._timescale,M.duration=this._duration,M.audioSampleRate=R,M.channelCount=w===0?1:2),L===10){var O=this._parseAACAudioData(E,S+1,A-1);if(O==null)return;if(O.packetType===0){M.config&&f.default.w(this.TAG,"Found another AudioSpecificConfig!");var F=O.data;M.audioSampleRate=F.samplingRate,M.channelCount=F.channelCount,M.codec=F.codec,M.originalCodec=F.originalCodec,M.config=F.config,M.refSampleDuration=1024/M.audioSampleRate*M.timescale,f.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",M);var k=this._mediaInfo;k.audioCodec=M.originalCodec,k.audioSampleRate=M.audioSampleRate,k.audioChannelCount=M.channelCount,k.hasVideo?k.videoCodec!=null&&(k.mimeType='video/x-flv; codecs="'+k.videoCodec+","+k.audioCodec+'"'):k.mimeType='video/x-flv; codecs="'+k.audioCodec+'"',k.isComplete()&&this._onMediaInfo(k)}else if(O.packetType===1){var $=this._timestampBase+T,V={unit:O.data,length:O.data.byteLength,dts:$,pts:$};D.samples.push(V),D.length+=O.data.length}else f.default.e(this.TAG,"Flv: Unsupported AAC data type "+O.packetType)}else if(L===2){if(!M.codec){var F=this._parseMP3AudioData(E,S+1,A-1,!0);if(F==null)return;M.audioSampleRate=F.samplingRate,M.channelCount=F.channelCount,M.codec=F.codec,M.originalCodec=F.originalCodec,M.refSampleDuration=1152/M.audioSampleRate*M.timescale,f.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",M);var k=this._mediaInfo;k.audioCodec=M.codec,k.audioSampleRate=M.audioSampleRate,k.audioChannelCount=M.channelCount,k.audioDataRate=F.bitRate,k.hasVideo?k.videoCodec!=null&&(k.mimeType='video/x-flv; codecs="'+k.videoCodec+","+k.audioCodec+'"'):k.mimeType='video/x-flv; codecs="'+k.audioCodec+'"',k.isComplete()&&this._onMediaInfo(k)}var N=this._parseMP3AudioData(E,S+1,A-1,!1);if(N==null)return;var $=this._timestampBase+T,B={unit:N,length:N.byteLength,dts:$,pts:$};D.samples.push(B),D.length+=N.length}}},_.prototype._parseAACAudioData=function(E,S,A){if(A<=1){f.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var T={},b=new Uint8Array(E,S,A);return T.packetType=b[0],b[0]===0?T.data=this._parseAACAudioSpecificConfig(E,S+1,A-1):T.data=b.subarray(1),T},_.prototype._parseAACAudioSpecificConfig=function(E,S,A){var T=new Uint8Array(E,S,A),b=null,C=0,L=0,R=0,I=null;if(C=L=T[0]>>>3,R=(T[0]&7)<<1|T[1]>>>7,R<0||R>=this._mpegSamplingRates.length){this._onError(p.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var w=this._mpegSamplingRates[R],M=(T[1]&120)>>>3;if(M<0||M>=8){this._onError(p.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}C===5&&(I=(T[1]&7)<<1|T[2]>>>7,(T[2]&124)>>>2);var D=self.navigator.userAgent.toLowerCase();return D.indexOf("firefox")!==-1?R>=6?(C=5,b=new Array(4),I=R-3):(C=2,b=new Array(2),I=R):D.indexOf("android")!==-1?(C=2,b=new Array(2),I=R):(C=5,I=R,b=new Array(4),R>=6?I=R-3:M===1&&(C=2,b=new Array(2),I=R)),b[0]=C<<3,b[0]|=(R&15)>>>1,b[1]=(R&15)<<7,b[1]|=(M&15)<<3,C===5&&(b[1]|=(I&15)>>>1,b[2]=(I&1)<<7,b[2]|=8,b[3]=0),{config:b,samplingRate:w,channelCount:M,codec:"mp4a.40."+C,originalCodec:"mp4a.40."+L}},_.prototype._parseMP3AudioData=function(E,S,A,T){if(A<4){f.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var b=new Uint8Array(E,S,A),C=null;if(T){if(b[0]!==255)return;var L=b[1]>>>3&3,R=(b[1]&6)>>1,I=(b[2]&240)>>>4,w=(b[2]&12)>>>2,M=b[3]>>>6&3,D=M!==3?2:1,O=0,F=0,k="mp3";switch(L){case 0:O=this._mpegAudioV25SampleRateTable[w];break;case 2:O=this._mpegAudioV20SampleRateTable[w];break;case 3:O=this._mpegAudioV10SampleRateTable[w];break}switch(R){case 1:I<this._mpegAudioL3BitRateTable.length&&(F=this._mpegAudioL3BitRateTable[I]);break;case 2:I<this._mpegAudioL2BitRateTable.length&&(F=this._mpegAudioL2BitRateTable[I]);break;case 3:I<this._mpegAudioL1BitRateTable.length&&(F=this._mpegAudioL1BitRateTable[I]);break}C={bitRate:F,samplingRate:O,channelCount:D,codec:k,originalCodec:k}}else C=b;return C},_.prototype._parseVideoData=function(E,S,A,T,b){if(A<=1){f.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var C=new Uint8Array(E,S,A)[0],L=(C&240)>>>4,R=C&15;if(R!==7){this._onError(p.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+R);return}this._parseAVCVideoPacket(E,S+1,A-1,T,b,L)}},_.prototype._parseAVCVideoPacket=function(E,S,A,T,b,C){if(A<4){f.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var L=this._littleEndian,R=new DataView(E,S,A),I=R.getUint8(0),w=R.getUint32(0,!L)&16777215,M=w<<8>>8;if(I===0)this._parseAVCDecoderConfigurationRecord(E,S+4,A-4);else if(I===1)this._parseAVCVideoData(E,S+4,A-4,T,b,C,M);else if(I!==2){this._onError(p.default.FORMAT_ERROR,"Flv: Invalid video packet type "+I);return}},_.prototype._parseAVCDecoderConfigurationRecord=function(E,S,A){if(A<7){f.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var T=this._videoMetadata,b=this._videoTrack,C=this._littleEndian,L=new DataView(E,S,A);T?typeof T.avcc<"u"&&f.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),T=this._videoMetadata={},T.type="video",T.id=b.id,T.timescale=this._timescale,T.duration=this._duration);var R=L.getUint8(0),I=L.getUint8(1);if(L.getUint8(2),L.getUint8(3),R!==1||I===0){this._onError(p.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(L.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(p.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var w=L.getUint8(5)&31;if(w===0){this._onError(p.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else w>1&&f.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+w);for(var M=6,D=0;D<w;D++){var O=L.getUint16(M,!C);if(M+=2,O!==0){var F=new Uint8Array(E,S+M,O);M+=O;var k=g.default.parseSPS(F);if(D===0){T.codecWidth=k.codec_size.width,T.codecHeight=k.codec_size.height,T.presentWidth=k.present_size.width,T.presentHeight=k.present_size.height,T.profile=k.profile_string,T.level=k.level_string,T.bitDepth=k.bit_depth,T.chromaFormat=k.chroma_format,T.sarRatio=k.sar_ratio,T.frameRate=k.frame_rate,(k.frame_rate.fixed===!1||k.frame_rate.fps_num===0||k.frame_rate.fps_den===0)&&(T.frameRate=this._referenceFrameRate);var $=T.frameRate.fps_den,V=T.frameRate.fps_num;T.refSampleDuration=T.timescale*($/V);for(var N=F.subarray(1,4),B="avc1.",G=0;G<3;G++){var z=N[G].toString(16);z.length<2&&(z="0"+z),B+=z}T.codec=B;var H=this._mediaInfo;H.width=T.codecWidth,H.height=T.codecHeight,H.fps=T.frameRate.fps,H.profile=T.profile,H.level=T.level,H.refFrames=k.ref_frames,H.chromaFormat=k.chroma_format_string,H.sarNum=T.sarRatio.width,H.sarDen=T.sarRatio.height,H.videoCodec=B,H.hasAudio?H.audioCodec!=null&&(H.mimeType='video/x-flv; codecs="'+H.videoCodec+","+H.audioCodec+'"'):H.mimeType='video/x-flv; codecs="'+H.videoCodec+'"',H.isComplete()&&this._onMediaInfo(H)}}}var W=L.getUint8(M);if(W===0){this._onError(p.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else W>1&&f.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+W);M++;for(var D=0;D<W;D++){var O=L.getUint16(M,!C);M+=2,O!==0&&(M+=O)}T.avcc=new Uint8Array(A),T.avcc.set(new Uint8Array(E,S,A),0),f.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",T)},_.prototype._parseAVCVideoData=function(E,S,A,T,b,C,L){for(var R=this._littleEndian,I=new DataView(E,S,A),w=[],M=0,D=0,O=this._naluLengthSize,F=this._timestampBase+T,k=C===1;D<A;){if(D+4>=A){f.default.w(this.TAG,"Malformed Nalu near timestamp "+F+", offset = "+D+", dataSize = "+A);break}var $=I.getUint32(D,!R);if(O===3&&($>>>=8),$>A-O){f.default.w(this.TAG,"Malformed Nalus near timestamp "+F+", NaluSize > DataSize!");return}var V=I.getUint8(D+O)&31;V===5&&(k=!0);var N=new Uint8Array(E,S+D,O+$),B={type:V,data:N};w.push(B),M+=N.byteLength,D+=O+$}if(w.length){var G=this._videoTrack,z={units:w,length:M,isKeyframe:k,dts:F,cts:L,pts:F+L};k&&(z.fileposition=b),G.samples.push(z),G.length+=M}},_}();c.default=x},"./src/demux/sps-parser.js":function(l,c,u){u.r(c);var f=u("./src/demux/exp-golomb.js"),d=function(){function g(){}return g._ebsp2rbsp=function(p){for(var v=p,m=v.byteLength,y=new Uint8Array(m),x=0,_=0;_<m;_++)_>=2&&v[_]===3&&v[_-1]===0&&v[_-2]===0||(y[x]=v[_],x++);return new Uint8Array(y.buffer,0,x)},g.parseSPS=function(p){var v=g._ebsp2rbsp(p),m=new f.default(v);m.readByte();var y=m.readByte();m.readByte();var x=m.readByte();m.readUEG();var _=g.getProfileString(y),E=g.getLevelString(x),S=1,A=420,T=[0,420,422,444],b=8;if((y===100||y===110||y===122||y===244||y===44||y===83||y===86||y===118||y===128||y===138||y===144)&&(S=m.readUEG(),S===3&&m.readBits(1),S<=3&&(A=T[S]),b=m.readUEG()+8,m.readUEG(),m.readBits(1),m.readBool()))for(var C=S!==3?8:12,L=0;L<C;L++)m.readBool()&&(L<6?g._skipScalingList(m,16):g._skipScalingList(m,64));m.readUEG();var R=m.readUEG();if(R===0)m.readUEG();else if(R===1){m.readBits(1),m.readSEG(),m.readSEG();for(var I=m.readUEG(),L=0;L<I;L++)m.readSEG()}var w=m.readUEG();m.readBits(1);var M=m.readUEG(),D=m.readUEG(),O=m.readBits(1);O===0&&m.readBits(1),m.readBits(1);var F=0,k=0,$=0,V=0,N=m.readBool();N&&(F=m.readUEG(),k=m.readUEG(),$=m.readUEG(),V=m.readUEG());var B=1,G=1,z=0,H=!0,W=0,Y=0,K=m.readBool();if(K){if(m.readBool()){var Z=m.readByte(),tt=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],et=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];Z>0&&Z<16?(B=tt[Z-1],G=et[Z-1]):Z===255&&(B=m.readByte()<<8|m.readByte(),G=m.readByte()<<8|m.readByte())}if(m.readBool()&&m.readBool(),m.readBool()&&(m.readBits(4),m.readBool()&&m.readBits(24)),m.readBool()&&(m.readUEG(),m.readUEG()),m.readBool()){var at=m.readBits(32),ot=m.readBits(32);H=m.readBool(),W=ot,Y=at*2,z=W/Y}}var nt=1;(B!==1||G!==1)&&(nt=B/G);var Q=0,st=0;if(S===0)Q=1,st=2-O;else{var dt=S===3?1:2,lt=S===1?2:1;Q=dt,st=lt*(2-O)}var ut=(M+1)*16,mt=(2-O)*((D+1)*16);ut-=(F+k)*Q,mt-=($+V)*st;var yt=Math.ceil(ut*nt);return m.destroy(),m=null,{profile_string:_,level_string:E,bit_depth:b,ref_frames:w,chroma_format:A,chroma_format_string:g.getChromaFormatString(A),frame_rate:{fixed:H,fps:z,fps_den:Y,fps_num:W},sar_ratio:{width:B,height:G},codec_size:{width:ut,height:mt},present_size:{width:yt,height:mt}}},g._skipScalingList=function(p,v){for(var m=8,y=8,x=0,_=0;_<v;_++)y!==0&&(x=p.readSEG(),y=(m+x+256)%256),m=y===0?m:y},g.getProfileString=function(p){switch(p){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},g.getLevelString=function(p){return(p/10).toFixed(1)},g.getChromaFormatString=function(p){switch(p){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},g}();c.default=d},"./src/flv.js":function(l,c,u){u.r(c);var f=u("./src/utils/polyfill.js"),d=u("./src/core/features.js"),g=u("./src/io/loader.js"),p=u("./src/player/flv-player.js"),v=u("./src/player/native-player.js"),m=u("./src/player/player-events.js"),y=u("./src/player/player-errors.js"),x=u("./src/utils/logging-control.js"),_=u("./src/utils/exception.js");f.default.install();function E(b,C){var L=b;if(L==null||typeof L!="object")throw new _.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!L.hasOwnProperty("type"))throw new _.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(L.type){case"flv":return new p.default(L,C);default:return new v.default(L,C)}}function S(){return d.default.supportMSEH264Playback()}function A(){return d.default.getFeatureList()}var T={};T.createPlayer=E,T.isSupported=S,T.getFeatureList=A,T.BaseLoader=g.BaseLoader,T.LoaderStatus=g.LoaderStatus,T.LoaderErrors=g.LoaderErrors,T.Events=m.default,T.ErrorTypes=y.ErrorTypes,T.ErrorDetails=y.ErrorDetails,T.FlvPlayer=p.default,T.NativePlayer=v.default,T.LoggingControl=x.default,Object.defineProperty(T,"version",{enumerable:!0,get:function(){return"1.6.2"}}),c.default=T},"./src/index.js":function(l,c,u){l.exports=u("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(l,c,u){u.r(c);var f=u("./src/utils/browser.js"),d=u("./src/io/loader.js"),g=u("./src/utils/exception.js"),p=function(){var m=function(y,x){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,E){_.__proto__=E}||function(_,E){for(var S in E)Object.prototype.hasOwnProperty.call(E,S)&&(_[S]=E[S])},m(y,x)};return function(y,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");m(y,x);function _(){this.constructor=y}y.prototype=x===null?Object.create(x):(_.prototype=x.prototype,new _)}}(),v=function(m){p(y,m);function y(x,_){var E=m.call(this,"fetch-stream-loader")||this;return E.TAG="FetchStreamLoader",E._seekHandler=x,E._config=_,E._needStash=!0,E._requestAbort=!1,E._contentLength=null,E._receivedLength=0,E}return y.isSupported=function(){try{var x=f.default.msedge&&f.default.version.minor>=15048,_=f.default.msedge?x:!0;return self.fetch&&self.ReadableStream&&_}catch{return!1}},y.prototype.destroy=function(){this.isWorking()&&this.abort(),m.prototype.destroy.call(this)},y.prototype.open=function(x,_){var E=this;this._dataSource=x,this._range=_;var S=x.url;this._config.reuseRedirectedURL&&x.redirectedURL!=null&&(S=x.redirectedURL);var A=this._seekHandler.getConfig(S,_),T=new self.Headers;if(typeof A.headers=="object"){var b=A.headers;for(var C in b)b.hasOwnProperty(C)&&T.append(C,b[C])}var L={method:"GET",headers:T,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var C in this._config.headers)T.append(C,this._config.headers[C]);x.cors===!1&&(L.mode="same-origin"),x.withCredentials&&(L.credentials="include"),x.referrerPolicy&&(L.referrerPolicy=x.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,L.signal=this._abortController.signal),this._status=d.LoaderStatus.kConnecting,self.fetch(A.url,L).then(function(R){if(E._requestAbort){E._status=d.LoaderStatus.kIdle,R.body.cancel();return}if(R.ok&&R.status>=200&&R.status<=299){if(R.url!==A.url&&E._onURLRedirect){var I=E._seekHandler.removeURLParameters(R.url);E._onURLRedirect(I)}var w=R.headers.get("Content-Length");return w!=null&&(E._contentLength=parseInt(w),E._contentLength!==0&&E._onContentLengthKnown&&E._onContentLengthKnown(E._contentLength)),E._pump.call(E,R.body.getReader())}else if(E._status=d.LoaderStatus.kError,E._onError)E._onError(d.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:R.status,msg:R.statusText});else throw new g.RuntimeException("FetchStreamLoader: Http code invalid, "+R.status+" "+R.statusText)}).catch(function(R){if(!(E._abortController&&E._abortController.signal.aborted))if(E._status=d.LoaderStatus.kError,E._onError)E._onError(d.LoaderErrors.EXCEPTION,{code:-1,msg:R.message});else throw R})},y.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==d.LoaderStatus.kBuffering||!f.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},y.prototype._pump=function(x){var _=this;return x.read().then(function(E){if(E.done)if(_._contentLength!==null&&_._receivedLength<_._contentLength){_._status=d.LoaderStatus.kError;var S=d.LoaderErrors.EARLY_EOF,A={code:-1,msg:"Fetch stream meet Early-EOF"};if(_._onError)_._onError(S,A);else throw new g.RuntimeException(A.msg)}else _._status=d.LoaderStatus.kComplete,_._onComplete&&_._onComplete(_._range.from,_._range.from+_._receivedLength-1);else{if(_._abortController&&_._abortController.signal.aborted){_._status=d.LoaderStatus.kComplete;return}else if(_._requestAbort===!0)return _._status=d.LoaderStatus.kComplete,x.cancel();_._status=d.LoaderStatus.kBuffering;var T=E.value.buffer,b=_._range.from+_._receivedLength;_._receivedLength+=T.byteLength,_._onDataArrival&&_._onDataArrival(T,b,_._receivedLength),_._pump(x)}}).catch(function(E){if(_._abortController&&_._abortController.signal.aborted){_._status=d.LoaderStatus.kComplete;return}if(!(E.code===11&&f.default.msedge)){_._status=d.LoaderStatus.kError;var S=0,A=null;if((E.code===19||E.message==="network error")&&(_._contentLength===null||_._contentLength!==null&&_._receivedLength<_._contentLength)?(S=d.LoaderErrors.EARLY_EOF,A={code:E.code,msg:"Fetch stream meet Early-EOF"}):(S=d.LoaderErrors.EXCEPTION,A={code:E.code,msg:E.message}),_._onError)_._onError(S,A);else throw new g.RuntimeException(A.msg)}})},y}(d.BaseLoader);c.default=v},"./src/io/io-controller.js":function(l,c,u){u.r(c);var f=u("./src/utils/logger.js"),d=u("./src/io/speed-sampler.js"),g=u("./src/io/loader.js"),p=u("./src/io/fetch-stream-loader.js"),v=u("./src/io/xhr-moz-chunked-loader.js"),m=u("./src/io/xhr-range-loader.js"),y=u("./src/io/websocket-loader.js"),x=u("./src/io/range-seek-handler.js"),_=u("./src/io/param-seek-handler.js"),E=u("./src/utils/exception.js"),S=function(){function A(T,b,C){this.TAG="IOController",this._config=b,this._extraData=C,this._stashInitialSize=1024*384,b.stashInitialSize!=null&&b.stashInitialSize>0&&(this._stashInitialSize=b.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,b.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=T,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(T.url),this._refTotalLength=T.filesize?T.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new d.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return A.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},A.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},A.prototype.isPaused=function(){return this._paused},Object.defineProperty(A.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"extraData",{get:function(){return this._extraData},set:function(T){this._extraData=T},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(T){this._onDataArrival=T},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(T){this._onSeeked=T},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onError",{get:function(){return this._onError},set:function(T){this._onError=T},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onComplete",{get:function(){return this._onComplete},set:function(T){this._onComplete=T},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(T){this._onRedirect=T},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(T){this._onRecoveredEarlyEof=T},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"currentSpeed",{get:function(){return this._loaderClass===m.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(A.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),A.prototype._selectSeekHandler=function(){var T=this._config;if(T.seekType==="range")this._seekHandler=new x.default(this._config.rangeLoadZeroStart);else if(T.seekType==="param"){var b=T.seekParamStart||"bstart",C=T.seekParamEnd||"bend";this._seekHandler=new _.default(b,C)}else if(T.seekType==="custom"){if(typeof T.customSeekHandler!="function")throw new E.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new T.customSeekHandler}else throw new E.InvalidArgumentException("Invalid seekType in config: "+T.seekType)},A.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=y.default;else if(p.default.isSupported())this._loaderClass=p.default;else if(v.default.isSupported())this._loaderClass=v.default;else if(m.default.isSupported())this._loaderClass=m.default;else throw new E.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},A.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},A.prototype.open=function(T){this._currentRange={from:0,to:-1},T&&(this._currentRange.from=T),this._speedSampler.reset(),T||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},A.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},A.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},A.prototype.resume=function(){if(this._paused){this._paused=!1;var T=this._resumeFrom;this._resumeFrom=0,this._internalSeek(T,!0)}},A.prototype.seek=function(T){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(T,!0)},A.prototype._internalSeek=function(T,b){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(b),this._loader.destroy(),this._loader=null;var C={from:T,to:-1};this._currentRange={from:C.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,C),this._onSeeked&&this._onSeeked()},A.prototype.updateUrl=function(T){if(!T||typeof T!="string"||T.length===0)throw new E.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=T},A.prototype._expandBuffer=function(T){for(var b=this._stashSize;b+1024*1024*1<T;)b*=2;if(b+=1024*1024*1,b!==this._bufferSize){var C=new ArrayBuffer(b);if(this._stashUsed>0){var L=new Uint8Array(this._stashBuffer,0,this._stashUsed),R=new Uint8Array(C,0,b);R.set(L,0)}this._stashBuffer=C,this._bufferSize=b}},A.prototype._normalizeSpeed=function(T){var b=this._speedNormalizeList,C=b.length-1,L=0,R=0,I=C;if(T<b[0])return b[0];for(;R<=I;){if(L=R+Math.floor((I-R)/2),L===C||T>=b[L]&&T<b[L+1])return b[L];b[L]<T?R=L+1:I=L-1}},A.prototype._adjustStashSize=function(T){var b=0;this._config.isLive||T<512?b=T:T>=512&&T<=1024?b=Math.floor(T*1.5):b=T*2,b>8192&&(b=8192);var C=b*1024+1024*1024*1;this._bufferSize<C&&this._expandBuffer(C),this._stashSize=b*1024},A.prototype._dispatchChunks=function(T,b){return this._currentRange.to=b+T.byteLength-1,this._onDataArrival(T,b)},A.prototype._onURLRedirect=function(T){this._redirectedURL=T,this._onRedirect&&this._onRedirect(T)},A.prototype._onContentLengthKnown=function(T){T&&this._fullRequestFlag&&(this._totalLength=T,this._fullRequestFlag=!1)},A.prototype._onLoaderChunkArrival=function(T,b,C){if(!this._onDataArrival)throw new E.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(T.byteLength);var L=this._speedSampler.lastSecondKBps;if(L!==0){var R=this._normalizeSpeed(L);this._speedNormalized!==R&&(this._speedNormalized=R,this._adjustStashSize(R))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=b),this._stashUsed+T.byteLength<=this._stashSize){var M=new Uint8Array(this._stashBuffer,0,this._stashSize);M.set(new Uint8Array(T),this._stashUsed),this._stashUsed+=T.byteLength}else{var M=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var O=this._stashBuffer.slice(0,this._stashUsed),I=this._dispatchChunks(O,this._stashByteStart);if(I<O.byteLength){if(I>0){var D=new Uint8Array(O,I);M.set(D,0),this._stashUsed=D.byteLength,this._stashByteStart+=I}}else this._stashUsed=0,this._stashByteStart+=I;this._stashUsed+T.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+T.byteLength),M=new Uint8Array(this._stashBuffer,0,this._bufferSize)),M.set(new Uint8Array(T),this._stashUsed),this._stashUsed+=T.byteLength}else{var I=this._dispatchChunks(T,b);if(I<T.byteLength){var w=T.byteLength-I;w>this._bufferSize&&(this._expandBuffer(w),M=new Uint8Array(this._stashBuffer,0,this._bufferSize)),M.set(new Uint8Array(T,I),0),this._stashUsed+=w,this._stashByteStart=b+I}}}else if(this._stashUsed===0){var I=this._dispatchChunks(T,b);if(I<T.byteLength){var w=T.byteLength-I;w>this._bufferSize&&this._expandBuffer(w);var M=new Uint8Array(this._stashBuffer,0,this._bufferSize);M.set(new Uint8Array(T,I),0),this._stashUsed+=w,this._stashByteStart=b+I}}else{this._stashUsed+T.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+T.byteLength);var M=new Uint8Array(this._stashBuffer,0,this._bufferSize);M.set(new Uint8Array(T),this._stashUsed),this._stashUsed+=T.byteLength;var I=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(I<this._stashUsed&&I>0){var D=new Uint8Array(this._stashBuffer,I);M.set(D,0)}this._stashUsed-=I,this._stashByteStart+=I}}},A.prototype._flushStashBuffer=function(T){if(this._stashUsed>0){var b=this._stashBuffer.slice(0,this._stashUsed),C=this._dispatchChunks(b,this._stashByteStart),L=b.byteLength-C;if(C<b.byteLength)if(T)f.default.w(this.TAG,L+" bytes unconsumed data remain when flush buffer, dropped");else{if(C>0){var R=new Uint8Array(this._stashBuffer,0,this._bufferSize),I=new Uint8Array(b,C);R.set(I,0),this._stashUsed=I.byteLength,this._stashByteStart+=C}return 0}return this._stashUsed=0,this._stashByteStart=0,L}return 0},A.prototype._onLoaderComplete=function(T,b){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},A.prototype._onLoaderError=function(T,b){switch(f.default.e(this.TAG,"Loader error, code = "+b.code+", msg = "+b.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,T=g.LoaderErrors.UNRECOVERABLE_EARLY_EOF),T){case g.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var C=this._currentRange.to+1;C<this._totalLength&&(f.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(C,!1));return}T=g.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case g.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case g.LoaderErrors.CONNECTING_TIMEOUT:case g.LoaderErrors.HTTP_STATUS_CODE_INVALID:case g.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(T,b);else throw new E.RuntimeException("IOException: "+b.msg)},A}();c.default=S},"./src/io/loader.js":function(l,c,u){u.r(c),u.d(c,{LoaderStatus:function(){return d},LoaderErrors:function(){return g},BaseLoader:function(){return p}});var f=u("./src/utils/exception.js"),d={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},g={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},p=function(){function v(m){this._type=m||"undefined",this._status=d.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return v.prototype.destroy=function(){this._status=d.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},v.prototype.isWorking=function(){return this._status===d.kConnecting||this._status===d.kBuffering},Object.defineProperty(v.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(m){this._onContentLengthKnown=m},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(m){this._onURLRedirect=m},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(m){this._onDataArrival=m},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onError",{get:function(){return this._onError},set:function(m){this._onError=m},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"onComplete",{get:function(){return this._onComplete},set:function(m){this._onComplete=m},enumerable:!1,configurable:!0}),v.prototype.open=function(m,y){throw new f.NotImplementedException("Unimplemented abstract function!")},v.prototype.abort=function(){throw new f.NotImplementedException("Unimplemented abstract function!")},v}()},"./src/io/param-seek-handler.js":function(l,c,u){u.r(c);var f=function(){function d(g,p){this._startName=g,this._endName=p}return d.prototype.getConfig=function(g,p){var v=g;if(p.from!==0||p.to!==-1){var m=!0;v.indexOf("?")===-1&&(v+="?",m=!1),m&&(v+="&"),v+=this._startName+"="+p.from.toString(),p.to!==-1&&(v+="&"+this._endName+"="+p.to.toString())}return{url:v,headers:{}}},d.prototype.removeURLParameters=function(g){var p=g.split("?")[0],v=void 0,m=g.indexOf("?");m!==-1&&(v=g.substring(m+1));var y="";if(v!=null&&v.length>0)for(var x=v.split("&"),_=0;_<x.length;_++){var E=x[_].split("="),S=_>0;E[0]!==this._startName&&E[0]!==this._endName&&(S&&(y+="&"),y+=x[_])}return y.length===0?p:p+"?"+y},d}();c.default=f},"./src/io/range-seek-handler.js":function(l,c,u){u.r(c);var f=function(){function d(g){this._zeroStart=g||!1}return d.prototype.getConfig=function(g,p){var v={};if(p.from!==0||p.to!==-1){var m=void 0;p.to!==-1?m="bytes="+p.from.toString()+"-"+p.to.toString():m="bytes="+p.from.toString()+"-",v.Range=m}else this._zeroStart&&(v.Range="bytes=0-");return{url:g,headers:v}},d.prototype.removeURLParameters=function(g){return g},d}();c.default=f},"./src/io/speed-sampler.js":function(l,c,u){u.r(c);var f=function(){function d(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return d.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},d.prototype.addBytes=function(g){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=g,this._totalBytes+=g):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=g,this._totalBytes+=g):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=g,this._totalBytes+=g,this._lastCheckpoint=this._now())},Object.defineProperty(d.prototype,"currentKBps",{get:function(){this.addBytes(0);var g=(this._now()-this._lastCheckpoint)/1e3;return g==0&&(g=1),this._intervalBytes/g/1024},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"averageKBps",{get:function(){var g=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/g/1024},enumerable:!1,configurable:!0}),d}();c.default=f},"./src/io/websocket-loader.js":function(l,c,u){u.r(c);var f=u("./src/io/loader.js"),d=u("./src/utils/exception.js"),g=function(){var v=function(m,y){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(x,_){x.__proto__=_}||function(x,_){for(var E in _)Object.prototype.hasOwnProperty.call(_,E)&&(x[E]=_[E])},v(m,y)};return function(m,y){if(typeof y!="function"&&y!==null)throw new TypeError("Class extends value "+String(y)+" is not a constructor or null");v(m,y);function x(){this.constructor=m}m.prototype=y===null?Object.create(y):(x.prototype=y.prototype,new x)}}(),p=function(v){g(m,v);function m(){var y=v.call(this,"websocket-loader")||this;return y.TAG="WebSocketLoader",y._needStash=!0,y._ws=null,y._requestAbort=!1,y._receivedLength=0,y}return m.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},m.prototype.destroy=function(){this._ws&&this.abort(),v.prototype.destroy.call(this)},m.prototype.open=function(y){try{var x=this._ws=new self.WebSocket(y.url);x.binaryType="arraybuffer",x.onopen=this._onWebSocketOpen.bind(this),x.onclose=this._onWebSocketClose.bind(this),x.onmessage=this._onWebSocketMessage.bind(this),x.onerror=this._onWebSocketError.bind(this),this._status=f.LoaderStatus.kConnecting}catch(E){this._status=f.LoaderStatus.kError;var _={code:E.code,msg:E.message};if(this._onError)this._onError(f.LoaderErrors.EXCEPTION,_);else throw new d.RuntimeException(_.msg)}},m.prototype.abort=function(){var y=this._ws;y&&(y.readyState===0||y.readyState===1)&&(this._requestAbort=!0,y.close()),this._ws=null,this._status=f.LoaderStatus.kComplete},m.prototype._onWebSocketOpen=function(y){this._status=f.LoaderStatus.kBuffering},m.prototype._onWebSocketClose=function(y){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=f.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},m.prototype._onWebSocketMessage=function(y){var x=this;if(y.data instanceof ArrayBuffer)this._dispatchArrayBuffer(y.data);else if(y.data instanceof Blob){var _=new FileReader;_.onload=function(){x._dispatchArrayBuffer(_.result)},_.readAsArrayBuffer(y.data)}else{this._status=f.LoaderStatus.kError;var E={code:-1,msg:"Unsupported WebSocket message type: "+y.data.constructor.name};if(this._onError)this._onError(f.LoaderErrors.EXCEPTION,E);else throw new d.RuntimeException(E.msg)}},m.prototype._dispatchArrayBuffer=function(y){var x=y,_=this._receivedLength;this._receivedLength+=x.byteLength,this._onDataArrival&&this._onDataArrival(x,_,this._receivedLength)},m.prototype._onWebSocketError=function(y){this._status=f.LoaderStatus.kError;var x={code:y.code,msg:y.message};if(this._onError)this._onError(f.LoaderErrors.EXCEPTION,x);else throw new d.RuntimeException(x.msg)},m}(f.BaseLoader);c.default=p},"./src/io/xhr-moz-chunked-loader.js":function(l,c,u){u.r(c);var f=u("./src/utils/logger.js"),d=u("./src/io/loader.js"),g=u("./src/utils/exception.js"),p=function(){var m=function(y,x){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,E){_.__proto__=E}||function(_,E){for(var S in E)Object.prototype.hasOwnProperty.call(E,S)&&(_[S]=E[S])},m(y,x)};return function(y,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");m(y,x);function _(){this.constructor=y}y.prototype=x===null?Object.create(x):(_.prototype=x.prototype,new _)}}(),v=function(m){p(y,m);function y(x,_){var E=m.call(this,"xhr-moz-chunked-loader")||this;return E.TAG="MozChunkedLoader",E._seekHandler=x,E._config=_,E._needStash=!0,E._xhr=null,E._requestAbort=!1,E._contentLength=null,E._receivedLength=0,E}return y.isSupported=function(){try{var x=new XMLHttpRequest;return x.open("GET","https://example.com",!0),x.responseType="moz-chunked-arraybuffer",x.responseType==="moz-chunked-arraybuffer"}catch(_){return f.default.w("MozChunkedLoader",_.message),!1}},y.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),m.prototype.destroy.call(this)},y.prototype.open=function(x,_){this._dataSource=x,this._range=_;var E=x.url;this._config.reuseRedirectedURL&&x.redirectedURL!=null&&(E=x.redirectedURL);var S=this._seekHandler.getConfig(E,_);this._requestURL=S.url;var A=this._xhr=new XMLHttpRequest;if(A.open("GET",S.url,!0),A.responseType="moz-chunked-arraybuffer",A.onreadystatechange=this._onReadyStateChange.bind(this),A.onprogress=this._onProgress.bind(this),A.onloadend=this._onLoadEnd.bind(this),A.onerror=this._onXhrError.bind(this),x.withCredentials&&(A.withCredentials=!0),typeof S.headers=="object"){var T=S.headers;for(var b in T)T.hasOwnProperty(b)&&A.setRequestHeader(b,T[b])}if(typeof this._config.headers=="object"){var T=this._config.headers;for(var b in T)T.hasOwnProperty(b)&&A.setRequestHeader(b,T[b])}this._status=d.LoaderStatus.kConnecting,A.send()},y.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=d.LoaderStatus.kComplete},y.prototype._onReadyStateChange=function(x){var _=x.target;if(_.readyState===2){if(_.responseURL!=null&&_.responseURL!==this._requestURL&&this._onURLRedirect){var E=this._seekHandler.removeURLParameters(_.responseURL);this._onURLRedirect(E)}if(_.status!==0&&(_.status<200||_.status>299))if(this._status=d.LoaderStatus.kError,this._onError)this._onError(d.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:_.status,msg:_.statusText});else throw new g.RuntimeException("MozChunkedLoader: Http code invalid, "+_.status+" "+_.statusText);else this._status=d.LoaderStatus.kBuffering}},y.prototype._onProgress=function(x){if(this._status!==d.LoaderStatus.kError){this._contentLength===null&&x.total!==null&&x.total!==0&&(this._contentLength=x.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var _=x.target.response,E=this._range.from+this._receivedLength;this._receivedLength+=_.byteLength,this._onDataArrival&&this._onDataArrival(_,E,this._receivedLength)}},y.prototype._onLoadEnd=function(x){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===d.LoaderStatus.kError)return;this._status=d.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},y.prototype._onXhrError=function(x){this._status=d.LoaderStatus.kError;var _=0,E=null;if(this._contentLength&&x.loaded<this._contentLength?(_=d.LoaderErrors.EARLY_EOF,E={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(_=d.LoaderErrors.EXCEPTION,E={code:-1,msg:x.constructor.name+" "+x.type}),this._onError)this._onError(_,E);else throw new g.RuntimeException(E.msg)},y}(d.BaseLoader);c.default=v},"./src/io/xhr-range-loader.js":function(l,c,u){u.r(c);var f=u("./src/utils/logger.js"),d=u("./src/io/speed-sampler.js"),g=u("./src/io/loader.js"),p=u("./src/utils/exception.js"),v=function(){var y=function(x,_){return y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,S){E.__proto__=S}||function(E,S){for(var A in S)Object.prototype.hasOwnProperty.call(S,A)&&(E[A]=S[A])},y(x,_)};return function(x,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");y(x,_);function E(){this.constructor=x}x.prototype=_===null?Object.create(_):(E.prototype=_.prototype,new E)}}(),m=function(y){v(x,y);function x(_,E){var S=y.call(this,"xhr-range-loader")||this;return S.TAG="RangeLoader",S._seekHandler=_,S._config=E,S._needStash=!1,S._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],S._currentChunkSizeKB=384,S._currentSpeedNormalized=0,S._zeroSpeedChunkCount=0,S._xhr=null,S._speedSampler=new d.default,S._requestAbort=!1,S._waitForTotalLength=!1,S._totalLengthReceived=!1,S._currentRequestURL=null,S._currentRedirectedURL=null,S._currentRequestRange=null,S._totalLength=null,S._contentLength=null,S._receivedLength=0,S._lastTimeLoaded=0,S}return x.isSupported=function(){try{var _=new XMLHttpRequest;return _.open("GET","https://example.com",!0),_.responseType="arraybuffer",_.responseType==="arraybuffer"}catch(E){return f.default.w("RangeLoader",E.message),!1}},x.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),y.prototype.destroy.call(this)},Object.defineProperty(x.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),x.prototype.open=function(_,E){this._dataSource=_,this._range=E,this._status=g.LoaderStatus.kConnecting;var S=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(S=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!S?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},x.prototype._openSubRange=function(){var _=this._currentChunkSizeKB*1024,E=this._range.from+this._receivedLength,S=E+_;this._contentLength!=null&&S-this._range.from>=this._contentLength&&(S=this._range.from+this._contentLength-1),this._currentRequestRange={from:E,to:S},this._internalOpen(this._dataSource,this._currentRequestRange)},x.prototype._internalOpen=function(_,E){this._lastTimeLoaded=0;var S=_.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?S=this._currentRedirectedURL:_.redirectedURL!=null&&(S=_.redirectedURL));var A=this._seekHandler.getConfig(S,E);this._currentRequestURL=A.url;var T=this._xhr=new XMLHttpRequest;if(T.open("GET",A.url,!0),T.responseType="arraybuffer",T.onreadystatechange=this._onReadyStateChange.bind(this),T.onprogress=this._onProgress.bind(this),T.onload=this._onLoad.bind(this),T.onerror=this._onXhrError.bind(this),_.withCredentials&&(T.withCredentials=!0),typeof A.headers=="object"){var b=A.headers;for(var C in b)b.hasOwnProperty(C)&&T.setRequestHeader(C,b[C])}if(typeof this._config.headers=="object"){var b=this._config.headers;for(var C in b)b.hasOwnProperty(C)&&T.setRequestHeader(C,b[C])}T.send()},x.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=g.LoaderStatus.kComplete},x.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},x.prototype._onReadyStateChange=function(_){var E=_.target;if(E.readyState===2){if(E.responseURL!=null){var S=this._seekHandler.removeURLParameters(E.responseURL);E.responseURL!==this._currentRequestURL&&S!==this._currentRedirectedURL&&(this._currentRedirectedURL=S,this._onURLRedirect&&this._onURLRedirect(S))}if(E.status>=200&&E.status<=299){if(this._waitForTotalLength)return;this._status=g.LoaderStatus.kBuffering}else if(this._status=g.LoaderStatus.kError,this._onError)this._onError(g.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:E.status,msg:E.statusText});else throw new p.RuntimeException("RangeLoader: Http code invalid, "+E.status+" "+E.statusText)}},x.prototype._onProgress=function(_){if(this._status!==g.LoaderStatus.kError){if(this._contentLength===null){var E=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,E=!0;var S=_.total;this._internalAbort(),S!=null&S!==0&&(this._totalLength=S)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,E){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var A=_.loaded-this._lastTimeLoaded;this._lastTimeLoaded=_.loaded,this._speedSampler.addBytes(A)}},x.prototype._normalizeSpeed=function(_){var E=this._chunkSizeKBList,S=E.length-1,A=0,T=0,b=S;if(_<E[0])return E[0];for(;T<=b;){if(A=T+Math.floor((b-T)/2),A===S||_>=E[A]&&_<E[A+1])return E[A];E[A]<_?T=A+1:b=A-1}},x.prototype._onLoad=function(_){if(this._status!==g.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var E=this._speedSampler.lastSecondKBps;if(E===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(E=this._speedSampler.currentKBps)),E!==0){var S=this._normalizeSpeed(E);this._currentSpeedNormalized!==S&&(this._currentSpeedNormalized=S,this._currentChunkSizeKB=S)}var A=_.target.response,T=this._range.from+this._receivedLength;this._receivedLength+=A.byteLength;var b=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():b=!0,this._onDataArrival&&this._onDataArrival(A,T,this._receivedLength),b&&(this._status=g.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},x.prototype._onXhrError=function(_){this._status=g.LoaderStatus.kError;var E=0,S=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(E=g.LoaderErrors.EARLY_EOF,S={code:-1,msg:"RangeLoader meet Early-Eof"}):(E=g.LoaderErrors.EXCEPTION,S={code:-1,msg:_.constructor.name+" "+_.type}),this._onError)this._onError(E,S);else throw new p.RuntimeException(S.msg)},x}(g.BaseLoader);c.default=m},"./src/player/flv-player.js":function(l,c,u){u.r(c);var f=u("./node_modules/events/events.js"),d=u.n(f),g=u("./src/utils/logger.js"),p=u("./src/utils/browser.js"),v=u("./src/player/player-events.js"),m=u("./src/core/transmuxer.js"),y=u("./src/core/transmuxing-events.js"),x=u("./src/core/mse-controller.js"),_=u("./src/core/mse-events.js"),E=u("./src/player/player-errors.js"),S=u("./src/config.js"),A=u("./src/utils/exception.js"),T=function(){function b(C,L){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(d()),this._config=(0,S.createDefaultConfig)(),typeof L=="object"&&Object.assign(this._config,L),C.type.toLowerCase()!=="flv")throw new A.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");C.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=C,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var R=p.default.chrome&&(p.default.version.major<50||p.default.version.major===50&&p.default.version.build<2661);this._alwaysSeekKeyframe=!!(R||p.default.msedge||p.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return b.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},b.prototype.on=function(C,L){var R=this;C===v.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){R._emitter.emit(v.default.MEDIA_INFO,R.mediaInfo)}):C===v.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){R._emitter.emit(v.default.STATISTICS_INFO,R.statisticsInfo)}),this._emitter.addListener(C,L)},b.prototype.off=function(C,L){this._emitter.removeListener(C,L)},b.prototype.attachMediaElement=function(C){var L=this;if(this._mediaElement=C,C.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),C.addEventListener("seeking",this.e.onvSeeking),C.addEventListener("canplay",this.e.onvCanPlay),C.addEventListener("stalled",this.e.onvStalled),C.addEventListener("progress",this.e.onvProgress),this._msectl=new x.default(this._config),this._msectl.on(_.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(_.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(_.default.SOURCE_OPEN,function(){L._mseSourceOpened=!0,L._hasPendingLoad&&(L._hasPendingLoad=!1,L.load())}),this._msectl.on(_.default.ERROR,function(R){L._emitter.emit(v.default.ERROR,E.ErrorTypes.MEDIA_ERROR,E.ErrorDetails.MEDIA_MSE_ERROR,R)}),this._msectl.attachMediaElement(C),this._pendingSeekTime!=null)try{C.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},b.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},b.prototype.load=function(){var C=this;if(!this._mediaElement)throw new A.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new A.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new m.default(this._mediaDataSource,this._config),this._transmuxer.on(y.default.INIT_SEGMENT,function(L,R){C._msectl.appendInitSegment(R)}),this._transmuxer.on(y.default.MEDIA_SEGMENT,function(L,R){if(C._msectl.appendMediaSegment(R),C._config.lazyLoad&&!C._config.isLive){var I=C._mediaElement.currentTime;R.info.endDts>=(I+C._config.lazyLoadMaxDuration)*1e3&&C._progressChecker==null&&(g.default.v(C.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),C._suspendTransmuxer())}}),this._transmuxer.on(y.default.LOADING_COMPLETE,function(){C._msectl.endOfStream(),C._emitter.emit(v.default.LOADING_COMPLETE)}),this._transmuxer.on(y.default.RECOVERED_EARLY_EOF,function(){C._emitter.emit(v.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(y.default.IO_ERROR,function(L,R){C._emitter.emit(v.default.ERROR,E.ErrorTypes.NETWORK_ERROR,L,R)}),this._transmuxer.on(y.default.DEMUX_ERROR,function(L,R){C._emitter.emit(v.default.ERROR,E.ErrorTypes.MEDIA_ERROR,L,{code:-1,msg:R})}),this._transmuxer.on(y.default.MEDIA_INFO,function(L){C._mediaInfo=L,C._emitter.emit(v.default.MEDIA_INFO,Object.assign({},L))}),this._transmuxer.on(y.default.METADATA_ARRIVED,function(L){C._emitter.emit(v.default.METADATA_ARRIVED,L)}),this._transmuxer.on(y.default.SCRIPTDATA_ARRIVED,function(L){C._emitter.emit(v.default.SCRIPTDATA_ARRIVED,L)}),this._transmuxer.on(y.default.STATISTICS_INFO,function(L){C._statisticsInfo=C._fillStatisticsInfo(L),C._emitter.emit(v.default.STATISTICS_INFO,Object.assign({},C._statisticsInfo))}),this._transmuxer.on(y.default.RECOMMEND_SEEKPOINT,function(L){C._mediaElement&&!C._config.accurateSeek&&(C._requestSetTime=!0,C._mediaElement.currentTime=L/1e3)}),this._transmuxer.open()}},b.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},b.prototype.play=function(){return this._mediaElement.play()},b.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(b.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(C){this._mediaElement.volume=C},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(C){this._mediaElement.muted=C},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(C){this._mediaElement?this._internalSeek(C):this._pendingSeekTime=C},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(b.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),b.prototype._fillStatisticsInfo=function(C){if(C.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return C;var L=!0,R=0,I=0;if(this._mediaElement.getVideoPlaybackQuality){var w=this._mediaElement.getVideoPlaybackQuality();R=w.totalVideoFrames,I=w.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(R=this._mediaElement.webkitDecodedFrameCount,I=this._mediaElement.webkitDroppedFrameCount):L=!1;return L&&(C.decodedFrames=R,C.droppedFrames=I),C},b.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var C=this._mediaElement.buffered,L=this._mediaElement.currentTime,R=0,I=0;I<C.length;I++){var w=C.start(I),M=C.end(I);if(w<=L&&L<M){R=M;break}}R>=L+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(g.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},b.prototype._onmseBufferFull=function(){g.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},b.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},b.prototype._checkProgressAndResume=function(){for(var C=this._mediaElement.currentTime,L=this._mediaElement.buffered,R=!1,I=0;I<L.length;I++){var w=L.start(I),M=L.end(I);if(C>=w&&C<M){C>=M-this._config.lazyLoadRecoverDuration&&(R=!0);break}}R&&(window.clearInterval(this._progressChecker),this._progressChecker=null,R&&(g.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},b.prototype._isTimepointBuffered=function(C){for(var L=this._mediaElement.buffered,R=0;R<L.length;R++){var I=L.start(R),w=L.end(R);if(C>=I&&C<w)return!0}return!1},b.prototype._internalSeek=function(C){var L=this._isTimepointBuffered(C),R=!1,I=0;if(C<1&&this._mediaElement.buffered.length>0){var w=this._mediaElement.buffered.start(0);(w<1&&C<w||p.default.safari)&&(R=!0,I=p.default.safari?.1:w)}if(R)this._requestSetTime=!0,this._mediaElement.currentTime=I;else if(L){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=C;else{var M=this._msectl.getNearestKeyframe(Math.floor(C*1e3));this._requestSetTime=!0,M!=null?this._mediaElement.currentTime=M.dts/1e3:this._mediaElement.currentTime=C}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(C),this._transmuxer.seek(Math.floor(C*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=C)},b.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var C=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(C)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(C),this._transmuxer.seek(Math.floor(C*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=C))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},b.prototype._checkAndResumeStuckPlayback=function(C){var L=this._mediaElement;if(C||!this._receivedCanPlay||L.readyState<2){var R=L.buffered;R.length>0&&L.currentTime<R.start(0)&&(g.default.w(this.TAG,"Playback seems stuck at "+L.currentTime+", seek to "+R.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=R.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},b.prototype._onvLoadedMetadata=function(C){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},b.prototype._onvSeeking=function(C){var L=this._mediaElement.currentTime,R=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(L<1&&R.length>0){var I=R.start(0);if(I<1&&L<I||p.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=p.default.safari?.1:I;return}}if(this._isTimepointBuffered(L)){if(this._alwaysSeekKeyframe){var w=this._msectl.getNearestKeyframe(Math.floor(L*1e3));w!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=w.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:L,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},b.prototype._onvCanPlay=function(C){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},b.prototype._onvStalled=function(C){this._checkAndResumeStuckPlayback(!0)},b.prototype._onvProgress=function(C){this._checkAndResumeStuckPlayback()},b}();c.default=T},"./src/player/native-player.js":function(l,c,u){u.r(c);var f=u("./node_modules/events/events.js"),d=u.n(f),g=u("./src/player/player-events.js"),p=u("./src/config.js"),v=u("./src/utils/exception.js"),m=function(){function y(x,_){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(d()),this._config=(0,p.createDefaultConfig)(),typeof _=="object"&&Object.assign(this._config,_),x.type.toLowerCase()==="flv")throw new v.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(x.hasOwnProperty("segments"))throw new v.InvalidArgumentException("NativePlayer("+x.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=x,this._mediaElement=null}return y.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},y.prototype.on=function(x,_){var E=this;x===g.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){E._emitter.emit(g.default.MEDIA_INFO,E.mediaInfo)}):x===g.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){E._emitter.emit(g.default.STATISTICS_INFO,E.statisticsInfo)}),this._emitter.addListener(x,_)},y.prototype.off=function(x,_){this._emitter.removeListener(x,_)},y.prototype.attachMediaElement=function(x){if(this._mediaElement=x,x.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{x.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},y.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},y.prototype.load=function(){if(!this._mediaElement)throw new v.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},y.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},y.prototype.play=function(){return this._mediaElement.play()},y.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(y.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(x){this._mediaElement.volume=x},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(x){this._mediaElement.muted=x},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(x){this._mediaElement?this._mediaElement.currentTime=x:this._pendingSeekTime=x},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"mediaInfo",{get:function(){var x=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",_={mimeType:x+this._mediaDataSource.type};return this._mediaElement&&(_.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(_.width=this._mediaElement.videoWidth,_.height=this._mediaElement.videoHeight)),_},enumerable:!1,configurable:!0}),Object.defineProperty(y.prototype,"statisticsInfo",{get:function(){var x={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return x;var _=!0,E=0,S=0;if(this._mediaElement.getVideoPlaybackQuality){var A=this._mediaElement.getVideoPlaybackQuality();E=A.totalVideoFrames,S=A.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(E=this._mediaElement.webkitDecodedFrameCount,S=this._mediaElement.webkitDroppedFrameCount):_=!1;return _&&(x.decodedFrames=E,x.droppedFrames=S),x},enumerable:!1,configurable:!0}),y.prototype._onvLoadedMetadata=function(x){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(g.default.MEDIA_INFO,this.mediaInfo)},y.prototype._reportStatisticsInfo=function(){this._emitter.emit(g.default.STATISTICS_INFO,this.statisticsInfo)},y}();c.default=m},"./src/player/player-errors.js":function(l,c,u){u.r(c),u.d(c,{ErrorTypes:function(){return g},ErrorDetails:function(){return p}});var f=u("./src/io/loader.js"),d=u("./src/demux/demux-errors.js"),g={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},p={NETWORK_EXCEPTION:f.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:f.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:f.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:f.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:d.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:d.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:d.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(l,c,u){u.r(c);var f={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};c.default=f},"./src/remux/aac-silent.js":function(l,c,u){u.r(c);var f=function(){function d(){}return d.getSilentFrame=function(g,p){if(g==="mp4a.40.2"){if(p===1)return new Uint8Array([0,200,0,128,35,128]);if(p===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(p===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(p===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(p===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(p===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(p===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(p===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(p===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},d}();c.default=f},"./src/remux/mp4-generator.js":function(l,c,u){u.r(c);var f=function(){function d(){}return d.init=function(){d.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var g in d.types)d.types.hasOwnProperty(g)&&(d.types[g]=[g.charCodeAt(0),g.charCodeAt(1),g.charCodeAt(2),g.charCodeAt(3)]);var p=d.constants={};p.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),p.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),p.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),p.STSC=p.STCO=p.STTS,p.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),p.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),p.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),p.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),p.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),p.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},d.box=function(g){for(var p=8,v=null,m=Array.prototype.slice.call(arguments,1),y=m.length,x=0;x<y;x++)p+=m[x].byteLength;v=new Uint8Array(p),v[0]=p>>>24&255,v[1]=p>>>16&255,v[2]=p>>>8&255,v[3]=p&255,v.set(g,4);for(var _=8,x=0;x<y;x++)v.set(m[x],_),_+=m[x].byteLength;return v},d.generateInitSegment=function(g){var p=d.box(d.types.ftyp,d.constants.FTYP),v=d.moov(g),m=new Uint8Array(p.byteLength+v.byteLength);return m.set(p,0),m.set(v,p.byteLength),m},d.moov=function(g){var p=d.mvhd(g.timescale,g.duration),v=d.trak(g),m=d.mvex(g);return d.box(d.types.moov,p,v,m)},d.mvhd=function(g,p){return d.box(d.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,g>>>24&255,g>>>16&255,g>>>8&255,g&255,p>>>24&255,p>>>16&255,p>>>8&255,p&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},d.trak=function(g){return d.box(d.types.trak,d.tkhd(g),d.mdia(g))},d.tkhd=function(g){var p=g.id,v=g.duration,m=g.presentWidth,y=g.presentHeight;return d.box(d.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,p>>>24&255,p>>>16&255,p>>>8&255,p&255,0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,v&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,m>>>8&255,m&255,0,0,y>>>8&255,y&255,0,0]))},d.mdia=function(g){return d.box(d.types.mdia,d.mdhd(g),d.hdlr(g),d.minf(g))},d.mdhd=function(g){var p=g.timescale,v=g.duration;return d.box(d.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,p>>>24&255,p>>>16&255,p>>>8&255,p&255,v>>>24&255,v>>>16&255,v>>>8&255,v&255,85,196,0,0]))},d.hdlr=function(g){var p=null;return g.type==="audio"?p=d.constants.HDLR_AUDIO:p=d.constants.HDLR_VIDEO,d.box(d.types.hdlr,p)},d.minf=function(g){var p=null;return g.type==="audio"?p=d.box(d.types.smhd,d.constants.SMHD):p=d.box(d.types.vmhd,d.constants.VMHD),d.box(d.types.minf,p,d.dinf(),d.stbl(g))},d.dinf=function(){var g=d.box(d.types.dinf,d.box(d.types.dref,d.constants.DREF));return g},d.stbl=function(g){var p=d.box(d.types.stbl,d.stsd(g),d.box(d.types.stts,d.constants.STTS),d.box(d.types.stsc,d.constants.STSC),d.box(d.types.stsz,d.constants.STSZ),d.box(d.types.stco,d.constants.STCO));return p},d.stsd=function(g){return g.type==="audio"?g.codec==="mp3"?d.box(d.types.stsd,d.constants.STSD_PREFIX,d.mp3(g)):d.box(d.types.stsd,d.constants.STSD_PREFIX,d.mp4a(g)):d.box(d.types.stsd,d.constants.STSD_PREFIX,d.avc1(g))},d.mp3=function(g){var p=g.channelCount,v=g.audioSampleRate,m=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,p,0,16,0,0,0,0,v>>>8&255,v&255,0,0]);return d.box(d.types[".mp3"],m)},d.mp4a=function(g){var p=g.channelCount,v=g.audioSampleRate,m=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,p,0,16,0,0,0,0,v>>>8&255,v&255,0,0]);return d.box(d.types.mp4a,m,d.esds(g))},d.esds=function(g){var p=g.config||[],v=p.length,m=new Uint8Array([0,0,0,0,3,23+v,0,1,0,4,15+v,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([v]).concat(p).concat([6,1,2]));return d.box(d.types.esds,m)},d.avc1=function(g){var p=g.avcc,v=g.codecWidth,m=g.codecHeight,y=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,v>>>8&255,v&255,m>>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return d.box(d.types.avc1,y,d.box(d.types.avcC,p))},d.mvex=function(g){return d.box(d.types.mvex,d.trex(g))},d.trex=function(g){var p=g.id,v=new Uint8Array([0,0,0,0,p>>>24&255,p>>>16&255,p>>>8&255,p&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return d.box(d.types.trex,v)},d.moof=function(g,p){return d.box(d.types.moof,d.mfhd(g.sequenceNumber),d.traf(g,p))},d.mfhd=function(g){var p=new Uint8Array([0,0,0,0,g>>>24&255,g>>>16&255,g>>>8&255,g&255]);return d.box(d.types.mfhd,p)},d.traf=function(g,p){var v=g.id,m=d.box(d.types.tfhd,new Uint8Array([0,0,0,0,v>>>24&255,v>>>16&255,v>>>8&255,v&255])),y=d.box(d.types.tfdt,new Uint8Array([0,0,0,0,p>>>24&255,p>>>16&255,p>>>8&255,p&255])),x=d.sdtp(g),_=d.trun(g,x.byteLength+16+16+8+16+8+8);return d.box(d.types.traf,m,y,_,x)},d.sdtp=function(g){for(var p=g.samples||[],v=p.length,m=new Uint8Array(4+v),y=0;y<v;y++){var x=p[y].flags;m[y+4]=x.isLeading<<6|x.dependsOn<<4|x.isDependedOn<<2|x.hasRedundancy}return d.box(d.types.sdtp,m)},d.trun=function(g,p){var v=g.samples||[],m=v.length,y=12+16*m,x=new Uint8Array(y);p+=8+y,x.set([0,0,15,1,m>>>24&255,m>>>16&255,m>>>8&255,m&255,p>>>24&255,p>>>16&255,p>>>8&255,p&255],0);for(var _=0;_<m;_++){var E=v[_].duration,S=v[_].size,A=v[_].flags,T=v[_].cts;x.set([E>>>24&255,E>>>16&255,E>>>8&255,E&255,S>>>24&255,S>>>16&255,S>>>8&255,S&255,A.isLeading<<2|A.dependsOn,A.isDependedOn<<6|A.hasRedundancy<<4|A.isNonSync,0,0,T>>>24&255,T>>>16&255,T>>>8&255,T&255],12+16*_)}return d.box(d.types.trun,x)},d.mdat=function(g){return d.box(d.types.mdat,g)},d}();f.init(),c.default=f},"./src/remux/mp4-remuxer.js":function(l,c,u){u.r(c);var f=u("./src/utils/logger.js"),d=u("./src/remux/mp4-generator.js"),g=u("./src/remux/aac-silent.js"),p=u("./src/utils/browser.js"),v=u("./src/core/media-segment-info.js"),m=u("./src/utils/exception.js"),y=function(){function x(_){this.TAG="MP4Remuxer",this._config=_,this._isLive=_.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new v.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new v.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(p.default.chrome&&(p.default.version.major<50||p.default.version.major===50&&p.default.version.build<2661)),this._fillSilentAfterSeek=p.default.msedge||p.default.msie,this._mp3UseMpegAudio=!p.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return x.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},x.prototype.bindDataSource=function(_){return _.onDataAvailable=this.remux.bind(this),_.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(x.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(_){this._onInitSegment=_},enumerable:!1,configurable:!0}),Object.defineProperty(x.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(_){this._onMediaSegment=_},enumerable:!1,configurable:!0}),x.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},x.prototype.seek=function(_){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},x.prototype.remux=function(_,E){if(!this._onMediaSegment)throw new m.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(_,E),this._remuxVideo(E),this._remuxAudio(_)},x.prototype._onTrackMetadataReceived=function(_,E){var S=null,A="mp4",T=E.codec;if(_==="audio")this._audioMeta=E,E.codec==="mp3"&&this._mp3UseMpegAudio?(A="mpeg",T="",S=new Uint8Array):S=d.default.generateInitSegment(E);else if(_==="video")this._videoMeta=E,S=d.default.generateInitSegment(E);else return;if(!this._onInitSegment)throw new m.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(_,{type:_,data:S.buffer,codec:T,container:_+"/"+A,mediaDuration:E.duration})},x.prototype._calculateDtsBase=function(_,E){this._dtsBaseInited||(_.samples&&_.samples.length&&(this._audioDtsBase=_.samples[0].dts),E.samples&&E.samples.length&&(this._videoDtsBase=E.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},x.prototype.flushStashedSamples=function(){var _=this._videoStashedLastSample,E=this._audioStashedLastSample,S={type:"video",id:1,sequenceNumber:0,samples:[],length:0};_!=null&&(S.samples.push(_),S.length=_.length);var A={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};E!=null&&(A.samples.push(E),A.length=E.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(S,!0),this._remuxAudio(A,!0)},x.prototype._remuxAudio=function(_,E){if(this._audioMeta!=null){var S=_,A=S.samples,T=void 0,b=-1,C=-1,L=this._audioMeta.refSampleDuration,R=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,I=this._dtsBaseInited&&this._audioNextDts===void 0,w=!1;if(!(!A||A.length===0)&&!(A.length===1&&!E)){var M=0,D=null,O=0;R?(M=0,O=S.length):(M=8,O=8+S.length);var F=null;if(A.length>1&&(F=A.pop(),O-=F.length),this._audioStashedLastSample!=null){var k=this._audioStashedLastSample;this._audioStashedLastSample=null,A.unshift(k),O+=k.length}F!=null&&(this._audioStashedLastSample=F);var $=A[0].dts-this._dtsBase;if(this._audioNextDts)T=$-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())T=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(w=!0);else{var V=this._audioSegmentInfoList.getLastSampleBefore($);if(V!=null){var N=$-(V.originalDts+V.duration);N<=3&&(N=0);var B=V.dts+V.duration+N;T=$-B}else T=0}if(w){var G=$-T,z=this._videoSegmentInfoList.getLastSegmentBefore($);if(z!=null&&z.beginDts<G){var H=g.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(H){var W=z.beginDts,Y=G-z.beginDts;f.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+W+", duration: "+Y),A.unshift({unit:H,dts:W,pts:W}),O+=H.byteLength}}else w=!1}for(var K=[],Z=0;Z<A.length;Z++){var k=A[Z],tt=k.unit,et=k.dts-this._dtsBase,W=et,at=!1,ot=null,nt=0;if(!(et<-.001)){if(this._audioMeta.codec!=="mp3"){var Q=et,st=3;if(this._audioNextDts&&(Q=this._audioNextDts),T=et-Q,T<=-st*L){f.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+et+" ms ,curRefDts: "+Q+" ms)  due to dtsCorrection: "+T+" ms overlap.");continue}else if(T>=st*L&&this._fillAudioTimestampGap&&!p.default.safari){at=!0;var dt=Math.floor(T/L);f.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+et+" ms, curRefDts: "+Q+" ms, ")+("dtsCorrection: "+Math.round(T)+" ms, generate: "+dt+" frames")),W=Math.floor(Q),nt=Math.floor(Q+L)-W;var H=g.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);H==null&&(f.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),H=tt),ot=[];for(var lt=0;lt<dt;lt++){Q=Q+L;var ut=Math.floor(Q),mt=Math.floor(Q+L)-ut,yt={dts:ut,pts:ut,cts:0,unit:H,size:H.byteLength,duration:mt,originalDts:et,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};ot.push(yt),O+=yt.size}this._audioNextDts=Q+L}else W=Math.floor(Q),nt=Math.floor(Q+L)-W,this._audioNextDts=Q+L}else{if(W=et-T,Z!==A.length-1){var xt=A[Z+1].dts-this._dtsBase-T;nt=xt-W}else if(F!=null){var xt=F.dts-this._dtsBase-T;nt=xt-W}else K.length>=1?nt=K[K.length-1].duration:nt=Math.floor(L);this._audioNextDts=W+nt}b===-1&&(b=W),K.push({dts:W,pts:W,cts:0,unit:k.unit,size:k.unit.byteLength,duration:nt,originalDts:et,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),at&&K.push.apply(K,ot)}}if(K.length===0){S.samples=[],S.length=0;return}R?D=new Uint8Array(O):(D=new Uint8Array(O),D[0]=O>>>24&255,D[1]=O>>>16&255,D[2]=O>>>8&255,D[3]=O&255,D.set(d.default.types.mdat,4));for(var Z=0;Z<K.length;Z++){var tt=K[Z].unit;D.set(tt,M),M+=tt.byteLength}var vt=K[K.length-1];C=vt.dts+vt.duration;var gt=new v.MediaSegmentInfo;gt.beginDts=b,gt.endDts=C,gt.beginPts=b,gt.endPts=C,gt.originalBeginDts=K[0].originalDts,gt.originalEndDts=vt.originalDts+vt.duration,gt.firstSample=new v.SampleInfo(K[0].dts,K[0].pts,K[0].duration,K[0].originalDts,!1),gt.lastSample=new v.SampleInfo(vt.dts,vt.pts,vt.duration,vt.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(gt),S.samples=K,S.sequenceNumber++;var Et=null;R?Et=new Uint8Array:Et=d.default.moof(S,b),S.samples=[],S.length=0;var St={type:"audio",data:this._mergeBoxes(Et,D).buffer,sampleCount:K.length,info:gt};R&&I&&(St.timestampOffset=b),this._onMediaSegment("audio",St)}}},x.prototype._remuxVideo=function(_,E){if(this._videoMeta!=null){var S=_,A=S.samples,T=void 0,b=-1,C=-1,L=-1,R=-1;if(!(!A||A.length===0)&&!(A.length===1&&!E)){var I=8,w=null,M=8+_.length,D=null;if(A.length>1&&(D=A.pop(),M-=D.length),this._videoStashedLastSample!=null){var O=this._videoStashedLastSample;this._videoStashedLastSample=null,A.unshift(O),M+=O.length}D!=null&&(this._videoStashedLastSample=D);var F=A[0].dts-this._dtsBase;if(this._videoNextDts)T=F-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())T=0;else{var k=this._videoSegmentInfoList.getLastSampleBefore(F);if(k!=null){var $=F-(k.originalDts+k.duration);$<=3&&($=0);var V=k.dts+k.duration+$;T=F-V}else T=0}for(var N=new v.MediaSegmentInfo,B=[],G=0;G<A.length;G++){var O=A[G],z=O.dts-this._dtsBase,H=O.isKeyframe,W=z-T,Y=O.cts,K=W+Y;b===-1&&(b=W,L=K);var Z=0;if(G!==A.length-1){var tt=A[G+1].dts-this._dtsBase-T;Z=tt-W}else if(D!=null){var tt=D.dts-this._dtsBase-T;Z=tt-W}else B.length>=1?Z=B[B.length-1].duration:Z=Math.floor(this._videoMeta.refSampleDuration);if(H){var et=new v.SampleInfo(W,K,Z,O.dts,!0);et.fileposition=O.fileposition,N.appendSyncPoint(et)}B.push({dts:W,pts:K,cts:Y,units:O.units,size:O.length,isKeyframe:H,duration:Z,originalDts:z,flags:{isLeading:0,dependsOn:H?2:1,isDependedOn:H?1:0,hasRedundancy:0,isNonSync:H?0:1}})}w=new Uint8Array(M),w[0]=M>>>24&255,w[1]=M>>>16&255,w[2]=M>>>8&255,w[3]=M&255,w.set(d.default.types.mdat,4);for(var G=0;G<B.length;G++)for(var at=B[G].units;at.length;){var ot=at.shift(),nt=ot.data;w.set(nt,I),I+=nt.byteLength}var Q=B[B.length-1];if(C=Q.dts+Q.duration,R=Q.pts+Q.duration,this._videoNextDts=C,N.beginDts=b,N.endDts=C,N.beginPts=L,N.endPts=R,N.originalBeginDts=B[0].originalDts,N.originalEndDts=Q.originalDts+Q.duration,N.firstSample=new v.SampleInfo(B[0].dts,B[0].pts,B[0].duration,B[0].originalDts,B[0].isKeyframe),N.lastSample=new v.SampleInfo(Q.dts,Q.pts,Q.duration,Q.originalDts,Q.isKeyframe),this._isLive||this._videoSegmentInfoList.append(N),S.samples=B,S.sequenceNumber++,this._forceFirstIDR){var st=B[0].flags;st.dependsOn=2,st.isNonSync=0}var dt=d.default.moof(S,b);S.samples=[],S.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(dt,w).buffer,sampleCount:B.length,info:N})}}},x.prototype._mergeBoxes=function(_,E){var S=new Uint8Array(_.byteLength+E.byteLength);return S.set(_,0),S.set(E,_.byteLength),S},x}();c.default=y},"./src/utils/browser.js":function(l,c,u){u.r(c);var f={};function d(){var g=self.navigator.userAgent.toLowerCase(),p=/(edge)\/([\w.]+)/.exec(g)||/(opr)[\/]([\w.]+)/.exec(g)||/(chrome)[ \/]([\w.]+)/.exec(g)||/(iemobile)[\/]([\w.]+)/.exec(g)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(g)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(g)||/(webkit)[ \/]([\w.]+)/.exec(g)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(g)||/(msie) ([\w.]+)/.exec(g)||g.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(g)||g.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(g)||[],v=/(ipad)/.exec(g)||/(ipod)/.exec(g)||/(windows phone)/.exec(g)||/(iphone)/.exec(g)||/(kindle)/.exec(g)||/(android)/.exec(g)||/(windows)/.exec(g)||/(mac)/.exec(g)||/(linux)/.exec(g)||/(cros)/.exec(g)||[],m={browser:p[5]||p[3]||p[1]||"",version:p[2]||p[4]||"0",majorVersion:p[4]||p[2]||"0",platform:v[0]||""},y={};if(m.browser){y[m.browser]=!0;var x=m.majorVersion.split(".");y.version={major:parseInt(m.majorVersion,10),string:m.version},x.length>1&&(y.version.minor=parseInt(x[1],10)),x.length>2&&(y.version.build=parseInt(x[2],10))}if(m.platform&&(y[m.platform]=!0),(y.chrome||y.opr||y.safari)&&(y.webkit=!0),y.rv||y.iemobile){y.rv&&delete y.rv;var _="msie";m.browser=_,y[_]=!0}if(y.edge){delete y.edge;var E="msedge";m.browser=E,y[E]=!0}if(y.opr){var S="opera";m.browser=S,y[S]=!0}if(y.safari&&y.android){var A="android";m.browser=A,y[A]=!0}y.name=m.browser,y.platform=m.platform;for(var T in f)f.hasOwnProperty(T)&&delete f[T];Object.assign(f,y)}d(),c.default=f},"./src/utils/exception.js":function(l,c,u){u.r(c),u.d(c,{RuntimeException:function(){return d},IllegalStateException:function(){return g},InvalidArgumentException:function(){return p},NotImplementedException:function(){return v}});var f=function(){var m=function(y,x){return m=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,E){_.__proto__=E}||function(_,E){for(var S in E)Object.prototype.hasOwnProperty.call(E,S)&&(_[S]=E[S])},m(y,x)};return function(y,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");m(y,x);function _(){this.constructor=y}y.prototype=x===null?Object.create(x):(_.prototype=x.prototype,new _)}}(),d=function(){function m(y){this._message=y}return Object.defineProperty(m.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),m.prototype.toString=function(){return this.name+": "+this.message},m}(),g=function(m){f(y,m);function y(x){return m.call(this,x)||this}return Object.defineProperty(y.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),y}(d),p=function(m){f(y,m);function y(x){return m.call(this,x)||this}return Object.defineProperty(y.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),y}(d),v=function(m){f(y,m);function y(x){return m.call(this,x)||this}return Object.defineProperty(y.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),y}(d)},"./src/utils/logger.js":function(l,c,u){u.r(c);var f=u("./node_modules/events/events.js"),d=u.n(f),g=function(){function p(){}return p.e=function(v,m){(!v||p.FORCE_GLOBAL_TAG)&&(v=p.GLOBAL_TAG);var y="["+v+"] > "+m;p.ENABLE_CALLBACK&&p.emitter.emit("log","error",y),p.ENABLE_ERROR&&(console.error?console.error(y):console.warn?console.warn(y):console.log(y))},p.i=function(v,m){(!v||p.FORCE_GLOBAL_TAG)&&(v=p.GLOBAL_TAG);var y="["+v+"] > "+m;p.ENABLE_CALLBACK&&p.emitter.emit("log","info",y),p.ENABLE_INFO&&(console.info?console.info(y):console.log(y))},p.w=function(v,m){(!v||p.FORCE_GLOBAL_TAG)&&(v=p.GLOBAL_TAG);var y="["+v+"] > "+m;p.ENABLE_CALLBACK&&p.emitter.emit("log","warn",y),p.ENABLE_WARN&&(console.warn?console.warn(y):console.log(y))},p.d=function(v,m){(!v||p.FORCE_GLOBAL_TAG)&&(v=p.GLOBAL_TAG);var y="["+v+"] > "+m;p.ENABLE_CALLBACK&&p.emitter.emit("log","debug",y),p.ENABLE_DEBUG&&(console.debug?console.debug(y):console.log(y))},p.v=function(v,m){(!v||p.FORCE_GLOBAL_TAG)&&(v=p.GLOBAL_TAG);var y="["+v+"] > "+m;p.ENABLE_CALLBACK&&p.emitter.emit("log","verbose",y),p.ENABLE_VERBOSE&&console.log(y)},p}();g.GLOBAL_TAG="flv.js",g.FORCE_GLOBAL_TAG=!1,g.ENABLE_ERROR=!0,g.ENABLE_INFO=!0,g.ENABLE_WARN=!0,g.ENABLE_DEBUG=!0,g.ENABLE_VERBOSE=!0,g.ENABLE_CALLBACK=!1,g.emitter=new(d()),c.default=g},"./src/utils/logging-control.js":function(l,c,u){u.r(c);var f=u("./node_modules/events/events.js"),d=u.n(f),g=u("./src/utils/logger.js"),p=function(){function v(){}return Object.defineProperty(v,"forceGlobalTag",{get:function(){return g.default.FORCE_GLOBAL_TAG},set:function(m){g.default.FORCE_GLOBAL_TAG=m,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"globalTag",{get:function(){return g.default.GLOBAL_TAG},set:function(m){g.default.GLOBAL_TAG=m,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableAll",{get:function(){return g.default.ENABLE_VERBOSE&&g.default.ENABLE_DEBUG&&g.default.ENABLE_INFO&&g.default.ENABLE_WARN&&g.default.ENABLE_ERROR},set:function(m){g.default.ENABLE_VERBOSE=m,g.default.ENABLE_DEBUG=m,g.default.ENABLE_INFO=m,g.default.ENABLE_WARN=m,g.default.ENABLE_ERROR=m,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableDebug",{get:function(){return g.default.ENABLE_DEBUG},set:function(m){g.default.ENABLE_DEBUG=m,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableVerbose",{get:function(){return g.default.ENABLE_VERBOSE},set:function(m){g.default.ENABLE_VERBOSE=m,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableInfo",{get:function(){return g.default.ENABLE_INFO},set:function(m){g.default.ENABLE_INFO=m,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableWarn",{get:function(){return g.default.ENABLE_WARN},set:function(m){g.default.ENABLE_WARN=m,v._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(v,"enableError",{get:function(){return g.default.ENABLE_ERROR},set:function(m){g.default.ENABLE_ERROR=m,v._notifyChange()},enumerable:!1,configurable:!0}),v.getConfig=function(){return{globalTag:g.default.GLOBAL_TAG,forceGlobalTag:g.default.FORCE_GLOBAL_TAG,enableVerbose:g.default.ENABLE_VERBOSE,enableDebug:g.default.ENABLE_DEBUG,enableInfo:g.default.ENABLE_INFO,enableWarn:g.default.ENABLE_WARN,enableError:g.default.ENABLE_ERROR,enableCallback:g.default.ENABLE_CALLBACK}},v.applyConfig=function(m){g.default.GLOBAL_TAG=m.globalTag,g.default.FORCE_GLOBAL_TAG=m.forceGlobalTag,g.default.ENABLE_VERBOSE=m.enableVerbose,g.default.ENABLE_DEBUG=m.enableDebug,g.default.ENABLE_INFO=m.enableInfo,g.default.ENABLE_WARN=m.enableWarn,g.default.ENABLE_ERROR=m.enableError,g.default.ENABLE_CALLBACK=m.enableCallback},v._notifyChange=function(){var m=v.emitter;if(m.listenerCount("change")>0){var y=v.getConfig();m.emit("change",y)}},v.registerListener=function(m){v.emitter.addListener("change",m)},v.removeListener=function(m){v.emitter.removeListener("change",m)},v.addLogListener=function(m){g.default.emitter.addListener("log",m),g.default.emitter.listenerCount("log")>0&&(g.default.ENABLE_CALLBACK=!0,v._notifyChange())},v.removeLogListener=function(m){g.default.emitter.removeListener("log",m),g.default.emitter.listenerCount("log")===0&&(g.default.ENABLE_CALLBACK=!1,v._notifyChange())},v}();p.emitter=new(d()),c.default=p},"./src/utils/polyfill.js":function(l,c,u){u.r(c);var f=function(){function d(){}return d.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(g,p){return g.__proto__=p,g},Object.assign=Object.assign||function(g){if(g==null)throw new TypeError("Cannot convert undefined or null to object");for(var p=Object(g),v=1;v<arguments.length;v++){var m=arguments[v];if(m!=null)for(var y in m)m.hasOwnProperty(y)&&(p[y]=m[y])}return p},typeof self.Promise!="function"&&u("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},d}();f.install(),c.default=f},"./src/utils/utf8-conv.js":function(l,c,u){u.r(c);function f(g,p,v){var m=g;if(p+v<m.length){for(;v--;)if((m[++p]&192)!==128)return!1;return!0}else return!1}function d(g){for(var p=[],v=g,m=0,y=g.length;m<y;){if(v[m]<128){p.push(String.fromCharCode(v[m])),++m;continue}else if(!(v[m]<192)){if(v[m]<224){if(f(v,m,1)){var x=(v[m]&31)<<6|v[m+1]&63;if(x>=128){p.push(String.fromCharCode(x&65535)),m+=2;continue}}}else if(v[m]<240){if(f(v,m,2)){var x=(v[m]&15)<<12|(v[m+1]&63)<<6|v[m+2]&63;if(x>=2048&&(x&63488)!==55296){p.push(String.fromCharCode(x&65535)),m+=3;continue}}}else if(v[m]<248&&f(v,m,3)){var x=(v[m]&7)<<18|(v[m+1]&63)<<12|(v[m+2]&63)<<6|v[m+3]&63;if(x>65536&&x<1114112){x-=65536,p.push(String.fromCharCode(x>>>10|55296)),p.push(String.fromCharCode(x&1023|56320)),m+=4;continue}}}p.push("�"),++m}return p.join("")}c.default=d}},n={};function o(l){var c=n[l];if(c!==void 0)return c.exports;var u=n[l]={exports:{}};return e[l].call(u.exports,u,u.exports,o),u.exports}o.m=e,function(){o.n=function(l){var c=l&&l.__esModule?function(){return l.default}:function(){return l};return o.d(c,{a:c}),c}}(),function(){o.d=function(l,c){for(var u in c)o.o(c,u)&&!o.o(l,u)&&Object.defineProperty(l,u,{enumerable:!0,get:c[u]})}}(),function(){o.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){o.o=function(l,c){return Object.prototype.hasOwnProperty.call(l,c)}}(),function(){o.r=function(l){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})}}();var s=o("./src/index.js");return s}()})})(flv);var flvExports=flv.exports;const FlvJs=getDefaultExportFromCjs$1(flvExports),FlvPlayerComponent=React.forwardRef((a,r)=>{const[e,n]=reactExports.useState({...a}),o=reactExports.useRef({}),s=reactExports.useRef(null),l=reactExports.useRef(null),{url:c}=e.style,u=()=>{l.current&&(l.current.pause(),l.current.unload(),l.current.detachMediaElement(),l.current.destroy(),l.current=null)};reactExports.useImperativeHandle(r,()=>({updateConfig:d=>n({...d}),setEventHandler:d=>o.current=d,destroy:()=>u()})),reactExports.useEffect(()=>{if(FlvJs.isSupported()){const d=FlvJs.createPlayer({type:"flv",url:c});d.attachMediaElement(s.current),d.load(),d.play(),l.current=d}return()=>u()},[c]);const f=()=>{"click"in o.current&&o.current.click()};return jsxRuntimeExports.jsx("video",{style:{height:"100%",width:"100%"},ref:s,controls:!0,onClick:f})});class FlvPlayerController extends AbstractDesignerController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,FlvPlayerComponent,e)}destroy(){var r;(r=this.instance)==null||r.destroy(),this.instance=null,this.config=null}getConfig(){return this.config}update(r,e){var n;this.config=ObjectUtil.merge(this.config,r),e=e||{reRender:!0},e.reRender&&((n=this.instance)==null||n.updateConfig(this.config))}registerEvent(){var e,n,o;const r=(n=(e=this.config)==null?void 0:e.base)==null?void 0:n.id;(o=this.instance)==null||o.setEventHandler({click:()=>BPExecutor.triggerComponentEvent(r,"click",this.config)})}}const __vite_glob_0_76=Object.freeze(Object.defineProperty({__proto__:null,FlvPlayerController},Symbol.toStringTag,{value:"Module"})),FlvPlayerImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN8AAACMCAIAAABzgesiAAAIzklEQVR4Xu2bzUsbaRzHBd9tE2uaOHmRgAgSKQ1scUFddlGwpJSqBwO7hJUKSmSJ0JJS1qK0ijh4yMmTJ0+ecvM0Ny/ePHnKyT9mn5l5XiejZkutv+D3w+9gn5l55knymefl90w7RgCgSkewAAAywE5AF9gJ6AI7AV1gJ6AL7AR0gZ2ALrAT0AV2ArrATkAX2AnoAjsBXWAnoAvsBHSBnYAusBPQBXYCusBOQBfYCegCOwFdYCegC+wEdIGdgC6wE9AFdgK6wE5AF9gJ6AI7AV1gJ6AL7AR0gZ2ALrAT0AV2ArrATkAX2AnoAjsBXWAnoAvsBHSBnYAusBPQBXYCusBOQBfYCegCOwFdYCegC+wEdIGdgC6wE9AFdgK6wE5AF9gJ6AI7AV1gJ6AL7AR0gZ2ALrAT0AV2tk4uk1tMT7AoZLLBY7QYK1tvawk3dlNjwYNtBOxsndXY9nXHIYur2CtRlp1JzfoehIc1OaNXoVGKVxu931icWX7Bi2rz5WZU096JqWUnsnJs/Tqn1Wby6rTfbafZ1DYEdrZOs52L8apfcls8XS6KGnQjZW3OsH+w4DRfawY/M1W64iV248nHeqL5AYCdD4D60m8K/vsNV0TJ9mkqUIlHZuFCXNIYmg4e1US87vh4lAkWyp/cjgYbEBYVu6la1k7593ncnS0spt843c3XGiHs/PNSL++vOHd9LXqIh6EdeKR2jkwcPxVX9ZdWbzkaWZjJTO56A+tJ9Jtf2IgW7eRETrPT8zU7481KWbhjrurh7rBThDptxFpv8GonZZnJeNkq1iNfrjvd9p+29JDwgJ33hGZn174/RAaCz+HutpMNyp/FOZ+P/fmcROtZL+ITN4y5++xepp2qea4B32nnOJN7a2jHKzlwElz3m9dhY6Xk5KZYA51E93ht3R9Pm6atxuS1LWhXO6OF4EGdFuzU7Dm8SBgL25y63Bd33unUNeLBDPshdqrOjA3ZYTfyYs+x7lx9z571iPYMTfEy9qTxOm/+KsjyeO00a8up8uzu4D4vf1KUCxrB3BmfHbrz0f9lZy6TE52iO9fU//Y6yNym7E179AHhQDbSq6bgdH29GCzVrBd5vV0j47bsOHs2bDFXHtHn0JGFW781ejxiO0eqQ3weed29vqWKZ4V/IQveQuKjaMC7meC88w47m4byQGw7UdmbyinseF7WI+2Ul3TtX0b+2nJFHN2MfeGFnV/qSbOXzRTEequVDpgSj9lOufi47vhWT4rC5HtR+FUV+mTmHT508kM32Gk7VoidM9Ls8NDtlFVV7KCdrPO29avYB1SP2Z3Rt7KpPg952tXOvk/O4EYwhl4v+ie2aGdYN6l6uN73VeNkbejsPGBj7mVsyrRT1ubdtMlOg/TrU7/NcTFBNGalt9g54iUHfqvFNi76Dvx7aSu8u6JzsybvR592tTM0ZG6oVTuzdlT0Q0+XPbNVLsnMg47vDvJpon47mcpx7VQrfS9FGmbn4vCK/yAdJ5Rzq4k1v/As0qKdinwm56bimaxNa/OweF1NjwaroMzjtlNfnntKKcPchJEgfyQynX40uv1l0/aVaI9rp5wn+J1uiJ3ZGrf587ElnVs4iviFO+ctjezhGDsFxq1lVXd8FRRpVzujS34i0IwxvvRu2U5NR5utRZSs2jqpHAv2mudRWT+Pq9ikttJfc7fXQ+ycrvd6JUxf5dw6nw90bpy0OrIzxrZifD5zarkfGnY+OD96VeSiDeWDc8owPcfE10l7DZFNdBLC6cgC3+NOL4u0ohch+0/eObzyNzkpUPc+73Gj76rKTjGFNTzWP7Kc43orMNhJgPuwU1tS9G5fyZ98WN+bma737ZxZE2JcZvaIV9SGp73Z6ngtKrT2I8xO2TFfPs/rewH+Hc8TY2pV9LzId9K7K3YyzE4peseXE+8Dws4H517sbBKFDbIfalo2WyJX6OZWdbYsc40yhJ3uMuhZ6SjxdiudFXkflb0qDFd4x+klemZS897a5d1J9Kus6mpwyfbXNNYLeUuVnBKJBZlUcrdeYedD8B127l9GmxJPZh4nZLElx2uTMDu1NDibG/SIlJOw0+jSDLKlxGaDTwaMJHk++be5n7nnDLtvnOhsBWcgL0+e+Cc3p1ph50/iO+y8IczLA9nswLa7pMlOcy0/UCrL+95qZz71uh6RF9qXsUkhX7Y0vHHF1bQvohUhmX059AdP5bqoNK3f1LxVFjsIzcks2PmTuC87tU2jw5BXlgS6nbnk8kWvtmcz8L7KtLA2+D+7P9fjbDheOhvg5zA7c5mX1fjK+YDYN3eDafe715TRorXkqEN2I1oosDnD83/Vyf2VE8vrRFVrWVNHVxNS6EN2ldvrh9u5U7cm2HT5+Nk/x4E9MLK0lZ3qBcrFzO1ZZfc9tNsiePnonDo6br5dodDtnEl80ExaKPlnpJeMlbuK/TNLzjtF9FZPfdsYyRVt7rt3EfOVHXEntfGqenKi88ZLKu4OgvbE9lT4yx/hdspQ71NTp63sfGCMkT3z7pyJ2LnjJH7RbS5Ya1ddpg2dB7yDlH1e36ez4H+3mKr3sUP29cBGLRV88PLJot9Pu+O4f1+3HneZz44W/f61b303LfIMZqp1M5Cv7VnTXnmhDexsnaJ4ydd7gXdsK17ckkKY5DOyJxYbBIzM7NHz2XKw2+asJkq1lHZykLFyomin9U3L+bLfBaYLJ/EpbVbaTOtjDjFgJ6AL7AR0gZ2ALrAT0AV2ArrATkAX2AnoAjsBXWAnoAvsBHSBnYAusBPQBXYCusBOQBfYCegCOwFdYCegC+wEdIGdgC6wE9AFdgK6wE5AF9gJ6AI7AV1gJ6AL7AR0gZ2ALrAT0AV2ArrATkAX2AnoAjsBXWAnoAvsBHSBnYAusBPQBXYCusBOQBfYCegCOwFdYCegC+wEdIGdgC6wE9AFdgK6wE5AF9gJ6AI7AV1gJ6AL7AR0gZ2ALrAT0AV2ArrATkAX2AnoAjsBXWAnoAvsBHSBnYAusBPQ5T/6cjKs6YnJ/gAAAABJRU5ErkJggg==",FlvPlayerConfig=({controller:a})=>{var o;const r=(o=a.getConfig())==null?void 0:o.style,e=s=>{const{dataFragment:l}=s;a.update(l)},n={type:"grid",key:"style",children:[{type:"input",label:"视频流地址",key:"url",value:r==null?void 0:r.url}]};return jsxRuntimeExports.jsx(LCGUI,{schema:n,onFieldChange:e})},BaseInfo$3=reactExports.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),AnimationConfig$2=reactExports.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),FilterConfig$3=reactExports.lazy(()=>__vitePreload(()=>import("./FilterConfig-NGULEsf_.js"),__vite__mapDeps([52,1,2,6,7,8,9,10,11,12,5,13,14,15,16,53])));class FlvPlayerDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"FLV视频流",compKey:"FlvPlayer",categorize:"media"}}getChartImg(){return FlvPlayerImg}getController(){return FlvPlayerController}getInitConfig(){return{base:{id:"",name:"FLV视频流",type:"FlvPlayer"},style:{url:""},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0}}}getMenuList(){return super.getMenuList().filter(r=>r.key!=="theme"&&r.key!=="data"&&r.key!=="mapping")}getMenuToConfigContentMap(){return{base:BaseInfo$3,style:FlvPlayerConfig,animation:AnimationConfig$2,filter:FilterConfig$3}}getEventList(){return super.getEventList().concat([{id:"click",name:"点击时"}])}}const __vite_glob_0_77=Object.freeze(Object.defineProperty({__proto__:null,default:FlvPlayerDefinition},Symbol.toStringTag,{value:"Module"})),FourAngleGlowBorder=reactExports.forwardRef((a,r)=>{const[e]=reactExports.useState({...a}),n=reactExports.useRef(null),o=reactExports.useRef({}),s=l=>{var c,u,f,d;(c=n.current)==null||c.style.setProperty("--fagb-length",`${l==null?void 0:l.length}px`),(u=n.current)==null||u.style.setProperty("--fagb-color",l.color),(f=n.current)==null||f.style.setProperty("--fagb-radius",`${l==null?void 0:l.radius}px`),(d=n.current)==null||d.style.setProperty("--fagb-width",`${l==null?void 0:l.width}px`)};return reactExports.useImperativeHandle(r,()=>({updateConfig:l=>s({...l}),setEventHandler:l=>o.current=l})),reactExports.useEffect(()=>{s(e.style)}),jsxRuntimeExports.jsxs("div",{className:"four-angle-glow",ref:n,children:[jsxRuntimeExports.jsx("span",{className:"angle angle-tl"}),jsxRuntimeExports.jsx("span",{className:"angle angle-tr"}),jsxRuntimeExports.jsx("span",{className:"angle angle-bl"}),jsxRuntimeExports.jsx("span",{className:"angle angle-br"})]})});class FourAngleGlowBorderController extends AbstractDesignerController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,FourAngleGlowBorder,e)}destroy(){this.instance=null,this.config=null}getConfig(){return this.config}update(r,e){var n;this.config=ObjectUtil.merge(this.config,r),e=e||{reRender:!0},e.reRender&&((n=this.instance)==null||n.updateConfig(this.config.style))}updateTheme(r){}registerEvent(){var e,n,o;const r=(n=(e=this.config)==null?void 0:e.base)==null?void 0:n.id;(o=this.instance)==null||o.setEventHandler({click:()=>BPExecutor.triggerComponentEvent(r,"click",this.config)})}}const __vite_glob_0_78=Object.freeze(Object.defineProperty({__proto__:null,FourAngleGlowBorderController},Symbol.toStringTag,{value:"Module"})),fourAngleGlowBorderImg="/light-chaser-app/assets/four-angle-glow-border-FLITQCMP.png",FourAngleGlowBorderConfig=({controller:a})=>{var o;const r=(o=a.getConfig())==null?void 0:o.style,e=s=>{const{dataFragment:l}=s;a.update(l)},n={key:"style",type:"grid",config:{columns:2},children:[{key:"width",type:"number-input",label:"宽度",value:r==null?void 0:r.width,config:{min:0,max:10}},{key:"length",type:"number-input",label:"长度",value:r==null?void 0:r.length,config:{min:0,max:100}},{key:"radius",type:"number-input",label:"圆角",value:r==null?void 0:r.radius,config:{min:0,max:100}},{key:"color",type:"color-picker",label:"颜色",value:r==null?void 0:r.color,config:{showText:!0}}]};return jsxRuntimeExports.jsx(LCGUI,{schema:n,onFieldChange:e})},BaseInfo$2=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),FilterConfig$2=React.lazy(()=>__vitePreload(()=>import("./FilterConfig-NGULEsf_.js"),__vite__mapDeps([52,1,2,6,7,8,9,10,11,12,5,13,14,15,16,53])));class FourAngleGlowBorderDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"四角辉光边框",compKey:"FourAngleGlowBorder",categorize:"ornament"}}getChartImg(){return fourAngleGlowBorderImg}getController(){return FourAngleGlowBorderController}getInitConfig(){return{base:{id:"",name:"基础色块",type:"BaseColorBlock"},style:{color:"#34e4ff",width:2,radius:4,length:10},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0}}}getMenuList(){return super.getMenuList().filter(r=>r.key!=="theme"&&r.key!=="data")}getMenuToConfigContentMap(){return{base:BaseInfo$2,style:FourAngleGlowBorderConfig,filter:FilterConfig$2}}getEventList(){return super.getEventList().concat([{id:"click",name:"点击时"}])}}const __vite_glob_0_79=Object.freeze(Object.defineProperty({__proto__:null,default:FourAngleGlowBorderDefinition},Symbol.toStringTag,{value:"Module"}));function getDefaultExportFromCjs(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var urlToolkit={exports:{}};(function(a,r){(function(e){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,o=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,l=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,c={buildAbsoluteURL:function(u,f,d){if(d=d||{},u=u.trim(),f=f.trim(),!f){if(!d.alwaysNormalize)return u;var g=c.parseURL(u);if(!g)throw new Error("Error trying to parse base URL.");return g.path=c.normalizePath(g.path),c.buildURLFromParts(g)}var p=c.parseURL(f);if(!p)throw new Error("Error trying to parse relative URL.");if(p.scheme)return d.alwaysNormalize?(p.path=c.normalizePath(p.path),c.buildURLFromParts(p)):f;var v=c.parseURL(u);if(!v)throw new Error("Error trying to parse base URL.");if(!v.netLoc&&v.path&&v.path[0]!=="/"){var m=o.exec(v.path);v.netLoc=m[1],v.path=m[2]}v.netLoc&&!v.path&&(v.path="/");var y={scheme:v.scheme,netLoc:p.netLoc,path:null,params:p.params,query:p.query,fragment:p.fragment};if(!p.netLoc&&(y.netLoc=v.netLoc,p.path[0]!=="/"))if(!p.path)y.path=v.path,p.params||(y.params=v.params,p.query||(y.query=v.query));else{var x=v.path,_=x.substring(0,x.lastIndexOf("/")+1)+p.path;y.path=c.normalizePath(_)}return y.path===null&&(y.path=d.alwaysNormalize?c.normalizePath(p.path):p.path),c.buildURLFromParts(y)},parseURL:function(u){var f=n.exec(u);return f?{scheme:f[1]||"",netLoc:f[2]||"",path:f[3]||"",params:f[4]||"",query:f[5]||"",fragment:f[6]||""}:null},normalizePath:function(u){for(u=u.split("").reverse().join("").replace(s,"");u.length!==(u=u.replace(l,"")).length;);return u.split("").reverse().join("")},buildURLFromParts:function(u){return u.scheme+u.netLoc+u.path+u.params+u.query+u.fragment}};a.exports=c})()})(urlToolkit);var urlToolkitExports=urlToolkit.exports;function ownKeys(a,r){var e=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);r&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable})),e.push.apply(e,n)}return e}function _objectSpread2(a){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?ownKeys(Object(e),!0).forEach(function(n){_defineProperty(a,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(e)):ownKeys(Object(e)).forEach(function(n){Object.defineProperty(a,n,Object.getOwnPropertyDescriptor(e,n))})}return a}function _toPrimitive(a,r){if(typeof a!="object"||!a)return a;var e=a[Symbol.toPrimitive];if(e!==void 0){var n=e.call(a,r||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(a)}function _toPropertyKey(a){var r=_toPrimitive(a,"string");return typeof r=="symbol"?r:String(r)}function _defineProperty(a,r,e){return r=_toPropertyKey(r),r in a?Object.defineProperty(a,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):a[r]=e,a}function _extends(){return _extends=Object.assign?Object.assign.bind():function(a){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n])}return a},_extends.apply(this,arguments)}const isFiniteNumber=Number.isFinite||function(a){return typeof a=="number"&&isFinite(a)},isSafeInteger=Number.isSafeInteger||function(a){return typeof a=="number"&&Math.abs(a)<=MAX_SAFE_INTEGER},MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991;let Events=function(a){return a.MEDIA_ATTACHING="hlsMediaAttaching",a.MEDIA_ATTACHED="hlsMediaAttached",a.MEDIA_DETACHING="hlsMediaDetaching",a.MEDIA_DETACHED="hlsMediaDetached",a.BUFFER_RESET="hlsBufferReset",a.BUFFER_CODECS="hlsBufferCodecs",a.BUFFER_CREATED="hlsBufferCreated",a.BUFFER_APPENDING="hlsBufferAppending",a.BUFFER_APPENDED="hlsBufferAppended",a.BUFFER_EOS="hlsBufferEos",a.BUFFER_FLUSHING="hlsBufferFlushing",a.BUFFER_FLUSHED="hlsBufferFlushed",a.MANIFEST_LOADING="hlsManifestLoading",a.MANIFEST_LOADED="hlsManifestLoaded",a.MANIFEST_PARSED="hlsManifestParsed",a.LEVEL_SWITCHING="hlsLevelSwitching",a.LEVEL_SWITCHED="hlsLevelSwitched",a.LEVEL_LOADING="hlsLevelLoading",a.LEVEL_LOADED="hlsLevelLoaded",a.LEVEL_UPDATED="hlsLevelUpdated",a.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",a.LEVELS_UPDATED="hlsLevelsUpdated",a.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",a.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",a.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",a.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",a.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",a.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",a.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",a.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",a.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",a.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",a.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",a.CUES_PARSED="hlsCuesParsed",a.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",a.INIT_PTS_FOUND="hlsInitPtsFound",a.FRAG_LOADING="hlsFragLoading",a.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",a.FRAG_LOADED="hlsFragLoaded",a.FRAG_DECRYPTED="hlsFragDecrypted",a.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",a.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",a.FRAG_PARSING_METADATA="hlsFragParsingMetadata",a.FRAG_PARSED="hlsFragParsed",a.FRAG_BUFFERED="hlsFragBuffered",a.FRAG_CHANGED="hlsFragChanged",a.FPS_DROP="hlsFpsDrop",a.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",a.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",a.ERROR="hlsError",a.DESTROYING="hlsDestroying",a.KEY_LOADING="hlsKeyLoading",a.KEY_LOADED="hlsKeyLoaded",a.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",a.BACK_BUFFER_REACHED="hlsBackBufferReached",a.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",a}({}),ErrorTypes=function(a){return a.NETWORK_ERROR="networkError",a.MEDIA_ERROR="mediaError",a.KEY_SYSTEM_ERROR="keySystemError",a.MUX_ERROR="muxError",a.OTHER_ERROR="otherError",a}({}),ErrorDetails=function(a){return a.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",a.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",a.KEY_SYSTEM_NO_SESSION="keySystemNoSession",a.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",a.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",a.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",a.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",a.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",a.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",a.MANIFEST_LOAD_ERROR="manifestLoadError",a.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",a.MANIFEST_PARSING_ERROR="manifestParsingError",a.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",a.LEVEL_EMPTY_ERROR="levelEmptyError",a.LEVEL_LOAD_ERROR="levelLoadError",a.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",a.LEVEL_PARSING_ERROR="levelParsingError",a.LEVEL_SWITCH_ERROR="levelSwitchError",a.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",a.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",a.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",a.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",a.FRAG_LOAD_ERROR="fragLoadError",a.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",a.FRAG_DECRYPT_ERROR="fragDecryptError",a.FRAG_PARSING_ERROR="fragParsingError",a.FRAG_GAP="fragGap",a.REMUX_ALLOC_ERROR="remuxAllocError",a.KEY_LOAD_ERROR="keyLoadError",a.KEY_LOAD_TIMEOUT="keyLoadTimeOut",a.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",a.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",a.BUFFER_APPEND_ERROR="bufferAppendError",a.BUFFER_APPENDING_ERROR="bufferAppendingError",a.BUFFER_STALLED_ERROR="bufferStalledError",a.BUFFER_FULL_ERROR="bufferFullError",a.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",a.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",a.INTERNAL_EXCEPTION="internalException",a.INTERNAL_ABORTED="aborted",a.UNKNOWN="unknown",a}({});const noop=function a(){},fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop};let exportedLogger=fakeLogger;function consolePrintFn(a){const r=self.console[a];return r?r.bind(self.console,`[${a}] >`):noop}function exportLoggerFunctions(a,...r){r.forEach(function(e){exportedLogger[e]=a[e]?a[e].bind(a):consolePrintFn(e)})}function enableLogs(a,r){if(typeof console=="object"&&a===!0||typeof a=="object"){exportLoggerFunctions(a,"debug","log","info","warn","error");try{exportedLogger.log(`Debug logs enabled for "${r}" in hls.js version 1.5.11`)}catch{exportedLogger=fakeLogger}}else exportedLogger=fakeLogger}const logger=exportedLogger,DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/(.+?)=(".*?"|.*?)(?:,|$)/g;class AttrList{constructor(r){typeof r=="string"&&(r=AttrList.parseAttrList(r)),_extends(this,r)}get clientAttrs(){return Object.keys(this).filter(r=>r.substring(0,2)==="X-")}decimalInteger(r){const e=parseInt(this[r],10);return e>Number.MAX_SAFE_INTEGER?1/0:e}hexadecimalInteger(r){if(this[r]){let e=(this[r]||"0x").slice(2);e=(e.length&1?"0":"")+e;const n=new Uint8Array(e.length/2);for(let o=0;o<e.length/2;o++)n[o]=parseInt(e.slice(o*2,o*2+2),16);return n}else return null}hexadecimalIntegerAsNumber(r){const e=parseInt(this[r],16);return e>Number.MAX_SAFE_INTEGER?1/0:e}decimalFloatingPoint(r){return parseFloat(this[r])}optionalFloat(r,e){const n=this[r];return n?parseFloat(n):e}enumeratedString(r){return this[r]}bool(r){return this[r]==="YES"}decimalResolution(r){const e=DECIMAL_RESOLUTION_REGEX.exec(this[r]);if(e!==null)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}}static parseAttrList(r){let e;const n={},o='"';for(ATTR_LIST_REGEX.lastIndex=0;(e=ATTR_LIST_REGEX.exec(r))!==null;){let s=e[2];s.indexOf(o)===0&&s.lastIndexOf(o)===s.length-1&&(s=s.slice(1,-1));const l=e[1].trim();n[l]=s}return n}}function isDateRangeCueAttribute(a){return a!=="ID"&&a!=="CLASS"&&a!=="START-DATE"&&a!=="DURATION"&&a!=="END-DATE"&&a!=="END-ON-NEXT"}function isSCTE35Attribute(a){return a==="SCTE35-OUT"||a==="SCTE35-IN"}class DateRange{constructor(r,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){const n=e.attr;for(const o in n)if(Object.prototype.hasOwnProperty.call(r,o)&&r[o]!==n[o]){logger.warn(`DATERANGE tag attribute: "${o}" does not match for tags with ID: "${r.ID}"`),this._badValueForSameId=o;break}r=_extends(new AttrList({}),n,r)}if(this.attr=r,this._startDate=new Date(r["START-DATE"]),"END-DATE"in this.attr){const n=new Date(this.attr["END-DATE"]);isFiniteNumber(n.getTime())&&(this._endDate=n)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const r=this.duration;return r!==null?new Date(this._startDate.getTime()+r*1e3):null}get duration(){if("DURATION"in this.attr){const r=this.attr.decimalFloatingPoint("DURATION");if(isFiniteNumber(r))return r}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&isFiniteNumber(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class LoadStats{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ElementaryStreamTypes={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class BaseSegment{constructor(r){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[ElementaryStreamTypes.AUDIO]:null,[ElementaryStreamTypes.VIDEO]:null,[ElementaryStreamTypes.AUDIOVIDEO]:null},this.baseurl=r}setByteRange(r,e){const n=r.split("@",2);let o;n.length===1?o=(e==null?void 0:e.byteRangeEndOffset)||0:o=parseInt(n[1]),this._byteRange=[o,parseInt(n[0])+o]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=urlToolkitExports.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(r){this._url=r}}class Fragment extends BaseSegment{constructor(r,e){super(e),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new LoadStats,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=r}get decryptdata(){const{levelkeys:r}=this;if(!r&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const e=this.levelkeys.identity;if(e)this._decryptdata=e.getDecryptData(this.sn);else{const n=Object.keys(this.levelkeys);if(n.length===1)return this._decryptdata=this.levelkeys[n[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!isFiniteNumber(this.programDateTime))return null;const r=isFiniteNumber(this.duration)?this.duration:0;return this.programDateTime+r*1e3}get encrypted(){var r;if((r=this._decryptdata)!=null&&r.encrypted)return!0;if(this.levelkeys){const e=Object.keys(this.levelkeys),n=e.length;if(n>1||n===1&&this.levelkeys[e[0]].encrypted)return!0}return!1}setKeyFormat(r){if(this.levelkeys){const e=this.levelkeys[r];e&&!this._decryptdata&&(this._decryptdata=e.getDecryptData(this.sn))}}abortRequests(){var r,e;(r=this.loader)==null||r.abort(),(e=this.keyLoader)==null||e.abort()}setElementaryStreamInfo(r,e,n,o,s,l=!1){const{elementaryStreams:c}=this,u=c[r];if(!u){c[r]={startPTS:e,endPTS:n,startDTS:o,endDTS:s,partial:l};return}u.startPTS=Math.min(u.startPTS,e),u.endPTS=Math.max(u.endPTS,n),u.startDTS=Math.min(u.startDTS,o),u.endDTS=Math.max(u.endDTS,s)}clearElementaryStreamInfo(){const{elementaryStreams:r}=this;r[ElementaryStreamTypes.AUDIO]=null,r[ElementaryStreamTypes.VIDEO]=null,r[ElementaryStreamTypes.AUDIOVIDEO]=null}}class Part extends BaseSegment{constructor(r,e,n,o,s){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new LoadStats,this.duration=r.decimalFloatingPoint("DURATION"),this.gap=r.bool("GAP"),this.independent=r.bool("INDEPENDENT"),this.relurl=r.enumeratedString("URI"),this.fragment=e,this.index=o;const l=r.enumeratedString("BYTERANGE");l&&this.setByteRange(l,s),s&&(this.fragOffset=s.fragOffset+s.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:r}=this;return!!(r.audio||r.video||r.audiovideo)}}const DEFAULT_TARGET_DURATION=10;class LevelDetails{constructor(r){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=r}reloaded(r){if(!r){this.advanced=!0,this.updated=!0;return}const e=this.lastPartSn-r.lastPartSn,n=this.lastPartIndex-r.lastPartIndex;this.updated=this.endSN!==r.endSN||!!n||!!e||!this.live,this.advanced=this.endSN>r.endSN||e>0||e===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(r.misses*.6):this.misses=r.misses+1,this.availabilityDelay=r.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?isFiniteNumber(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||DEFAULT_TARGET_DURATION}get drift(){const r=this.driftEndTime-this.driftStartTime;return r>0?(this.driftEnd-this.driftStart)*1e3/r:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var r;return(r=this.fragments)!=null&&r.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var r;return(r=this.partList)!=null&&r.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function base64Decode(a){return Uint8Array.from(atob(a),r=>r.charCodeAt(0))}function getKeyIdBytes(a){const r=strToUtf8array(a).subarray(0,16),e=new Uint8Array(16);return e.set(r,16-r.length),e}function changeEndianness(a){const r=function(n,o,s){const l=n[o];n[o]=n[s],n[s]=l};r(a,0,3),r(a,1,2),r(a,4,5),r(a,6,7)}function convertDataUriToArrayBytes(a){const r=a.split(":");let e=null;if(r[0]==="data"&&r.length===2){const n=r[1].split(";"),o=n[n.length-1].split(",");if(o.length===2){const s=o[0]==="base64",l=o[1];s?(n.splice(-1,1),e=base64Decode(l)):e=getKeyIdBytes(l)}}return e}function strToUtf8array(a){return Uint8Array.from(unescape(encodeURIComponent(a)),r=>r.charCodeAt(0))}const optionalSelf=typeof self<"u"?self:void 0;var KeySystems={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},KeySystemFormats={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function keySystemFormatToKeySystemDomain(a){switch(a){case KeySystemFormats.FAIRPLAY:return KeySystems.FAIRPLAY;case KeySystemFormats.PLAYREADY:return KeySystems.PLAYREADY;case KeySystemFormats.WIDEVINE:return KeySystems.WIDEVINE;case KeySystemFormats.CLEARKEY:return KeySystems.CLEARKEY}}var KeySystemIds={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function keySystemIdToKeySystemDomain(a){if(a===KeySystemIds.WIDEVINE)return KeySystems.WIDEVINE}function keySystemDomainToKeySystemFormat(a){switch(a){case KeySystems.FAIRPLAY:return KeySystemFormats.FAIRPLAY;case KeySystems.PLAYREADY:return KeySystemFormats.PLAYREADY;case KeySystems.WIDEVINE:return KeySystemFormats.WIDEVINE;case KeySystems.CLEARKEY:return KeySystemFormats.CLEARKEY}}function getKeySystemsForConfig(a){const{drmSystems:r,widevineLicenseUrl:e}=a,n=r?[KeySystems.FAIRPLAY,KeySystems.WIDEVINE,KeySystems.PLAYREADY,KeySystems.CLEARKEY].filter(o=>!!r[o]):[];return!n[KeySystems.WIDEVINE]&&e&&n.push(KeySystems.WIDEVINE),n}const requestMediaKeySystemAccess=function(a){return optionalSelf!=null&&(a=optionalSelf.navigator)!=null&&a.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function getSupportedMediaKeySystemConfigurations(a,r,e,n){let o;switch(a){case KeySystems.FAIRPLAY:o=["cenc","sinf"];break;case KeySystems.WIDEVINE:case KeySystems.PLAYREADY:o=["cenc"];break;case KeySystems.CLEARKEY:o=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${a}`)}return createMediaKeySystemConfigurations(o,r,e,n)}function createMediaKeySystemConfigurations(a,r,e,n){return[{initDataTypes:a,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:r.map(s=>({contentType:`audio/mp4; codecs="${s}"`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:e.map(s=>({contentType:`video/mp4; codecs="${s}"`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function sliceUint8(a,r,e){return Uint8Array.prototype.slice?a.slice(r,e):new Uint8Array(Array.prototype.slice.call(a,r,e))}const isHeader$2=(a,r)=>r+10<=a.length&&a[r]===73&&a[r+1]===68&&a[r+2]===51&&a[r+3]<255&&a[r+4]<255&&a[r+6]<128&&a[r+7]<128&&a[r+8]<128&&a[r+9]<128,isFooter=(a,r)=>r+10<=a.length&&a[r]===51&&a[r+1]===68&&a[r+2]===73&&a[r+3]<255&&a[r+4]<255&&a[r+6]<128&&a[r+7]<128&&a[r+8]<128&&a[r+9]<128,getID3Data=(a,r)=>{const e=r;let n=0;for(;isHeader$2(a,r);){n+=10;const o=readSize(a,r+6);n+=o,isFooter(a,r+10)&&(n+=10),r+=n}if(n>0)return a.subarray(e,e+n)},readSize=(a,r)=>{let e=0;return e=(a[r]&127)<<21,e|=(a[r+1]&127)<<14,e|=(a[r+2]&127)<<7,e|=a[r+3]&127,e},canParse$2=(a,r)=>isHeader$2(a,r)&&readSize(a,r+6)+10<=a.length-r,getTimeStamp=a=>{const r=getID3Frames(a);for(let e=0;e<r.length;e++){const n=r[e];if(isTimeStampFrame(n))return readTimeStamp(n)}},isTimeStampFrame=a=>a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp",getFrameData=a=>{const r=String.fromCharCode(a[0],a[1],a[2],a[3]),e=readSize(a,4),n=10;return{type:r,size:e,data:a.subarray(n,n+e)}},getID3Frames=a=>{let r=0;const e=[];for(;isHeader$2(a,r);){const n=readSize(a,r+6);r+=10;const o=r+n;for(;r+8<o;){const s=getFrameData(a.subarray(r)),l=decodeFrame(s);l&&e.push(l),r+=s.size+10}isFooter(a,r)&&(r+=10)}return e},decodeFrame=a=>a.type==="PRIV"?decodePrivFrame(a):a.type[0]==="W"?decodeURLFrame(a):decodeTextFrame(a),decodePrivFrame=a=>{if(a.size<2)return;const r=utf8ArrayToStr(a.data,!0),e=new Uint8Array(a.data.subarray(r.length+1));return{key:a.type,info:r,data:e.buffer}},decodeTextFrame=a=>{if(a.size<2)return;if(a.type==="TXXX"){let e=1;const n=utf8ArrayToStr(a.data.subarray(e),!0);e+=n.length+1;const o=utf8ArrayToStr(a.data.subarray(e));return{key:a.type,info:n,data:o}}const r=utf8ArrayToStr(a.data.subarray(1));return{key:a.type,data:r}},decodeURLFrame=a=>{if(a.type==="WXXX"){if(a.size<2)return;let e=1;const n=utf8ArrayToStr(a.data.subarray(e),!0);e+=n.length+1;const o=utf8ArrayToStr(a.data.subarray(e));return{key:a.type,info:n,data:o}}const r=utf8ArrayToStr(a.data);return{key:a.type,data:r}},readTimeStamp=a=>{if(a.data.byteLength===8){const r=new Uint8Array(a.data),e=r[3]&1;let n=(r[4]<<23)+(r[5]<<15)+(r[6]<<7)+r[7];return n/=45,e&&(n+=4772185884e-2),Math.round(n)}},utf8ArrayToStr=(a,r=!1)=>{const e=getTextDecoder();if(e){const f=e.decode(a);if(r){const d=f.indexOf("\0");return d!==-1?f.substring(0,d):f}return f.replace(/\0/g,"")}const n=a.length;let o,s,l,c="",u=0;for(;u<n;){if(o=a[u++],o===0&&r)return c;if(o===0||o===3)continue;switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:c+=String.fromCharCode(o);break;case 12:case 13:s=a[u++],c+=String.fromCharCode((o&31)<<6|s&63);break;case 14:s=a[u++],l=a[u++],c+=String.fromCharCode((o&15)<<12|(s&63)<<6|(l&63)<<0);break}}return c};let decoder;function getTextDecoder(){if(!navigator.userAgent.includes("PlayStation 4"))return!decoder&&typeof self.TextDecoder<"u"&&(decoder=new self.TextDecoder("utf-8")),decoder}const Hex={hexDump:function(a){let r="";for(let e=0;e<a.length;e++){let n=a[e].toString(16);n.length<2&&(n="0"+n),r+=n}return r}},UINT32_MAX$1=Math.pow(2,32)-1,push=[].push,RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4};function bin2str(a){return String.fromCharCode.apply(null,a)}function readUint16(a,r){const e=a[r]<<8|a[r+1];return e<0?65536+e:e}function readUint32(a,r){const e=readSint32(a,r);return e<0?4294967296+e:e}function readUint64(a,r){let e=readUint32(a,r);return e*=Math.pow(2,32),e+=readUint32(a,r+4),e}function readSint32(a,r){return a[r]<<24|a[r+1]<<16|a[r+2]<<8|a[r+3]}function writeUint32(a,r,e){a[r]=e>>24,a[r+1]=e>>16&255,a[r+2]=e>>8&255,a[r+3]=e&255}function hasMoofData(a){const r=a.byteLength;for(let e=0;e<r;){const n=readUint32(a,e);if(n>8&&a[e+4]===109&&a[e+5]===111&&a[e+6]===111&&a[e+7]===102)return!0;e=n>1?e+n:r}return!1}function findBox(a,r){const e=[];if(!r.length)return e;const n=a.byteLength;for(let o=0;o<n;){const s=readUint32(a,o),l=bin2str(a.subarray(o+4,o+8)),c=s>1?o+s:n;if(l===r[0])if(r.length===1)e.push(a.subarray(o+8,c));else{const u=findBox(a.subarray(o+8,c),r.slice(1));u.length&&push.apply(e,u)}o=c}return e}function parseSegmentIndex(a){const r=[],e=a[0];let n=8;const o=readUint32(a,n);n+=4;let s=0,l=0;e===0?(s=readUint32(a,n),l=readUint32(a,n+4),n+=8):(s=readUint64(a,n),l=readUint64(a,n+8),n+=16),n+=2;let c=a.length+l;const u=readUint16(a,n);n+=2;for(let f=0;f<u;f++){let d=n;const g=readUint32(a,d);d+=4;const p=g&2147483647;if((g&2147483648)>>>31===1)return logger.warn("SIDX has hierarchical references (not supported)"),null;const m=readUint32(a,d);d+=4,r.push({referenceSize:p,subsegmentDuration:m,info:{duration:m/o,start:c,end:c+p-1}}),c+=p,d+=4,n=d}return{earliestPresentationTime:s,timescale:o,version:e,referencesCount:u,references:r}}function parseInitSegment(a){const r=[],e=findBox(a,["moov","trak"]);for(let o=0;o<e.length;o++){const s=e[o],l=findBox(s,["tkhd"])[0];if(l){let c=l[0];const u=readUint32(l,c===0?12:20),f=findBox(s,["mdia","mdhd"])[0];if(f){c=f[0];const d=readUint32(f,c===0?12:20),g=findBox(s,["mdia","hdlr"])[0];if(g){const p=bin2str(g.subarray(8,12)),v={soun:ElementaryStreamTypes.AUDIO,vide:ElementaryStreamTypes.VIDEO}[p];if(v){const m=findBox(s,["mdia","minf","stbl","stsd"])[0],y=parseStsd(m);r[u]={timescale:d,type:v},r[v]=_objectSpread2({timescale:d,id:u},y)}}}}}return findBox(a,["moov","mvex","trex"]).forEach(o=>{const s=readUint32(o,4),l=r[s];l&&(l.default={duration:readUint32(o,12),flags:readUint32(o,20)})}),r}function parseStsd(a){const r=a.subarray(8),e=r.subarray(86),n=bin2str(r.subarray(4,8));let o=n;const s=n==="enca"||n==="encv";if(s){const c=findBox(r,[n])[0].subarray(n==="enca"?28:78);findBox(c,["sinf"]).forEach(f=>{const d=findBox(f,["schm"])[0];if(d){const g=bin2str(d.subarray(4,8));if(g==="cbcs"||g==="cenc"){const p=findBox(f,["frma"])[0];p&&(o=bin2str(p))}}})}switch(o){case"avc1":case"avc2":case"avc3":case"avc4":{const l=findBox(e,["avcC"])[0];o+="."+toHex(l[1])+toHex(l[2])+toHex(l[3]);break}case"mp4a":{const l=findBox(r,[n])[0],c=findBox(l.subarray(28),["esds"])[0];if(c&&c.length>12){let u=4;if(c[u++]!==3)break;u=skipBERInteger(c,u),u+=2;const f=c[u++];if(f&128&&(u+=2),f&64&&(u+=c[u++]),c[u++]!==4)break;u=skipBERInteger(c,u);const d=c[u++];if(d===64)o+="."+toHex(d);else break;if(u+=12,c[u++]!==5)break;u=skipBERInteger(c,u);const g=c[u++];let p=(g&248)>>3;p===31&&(p+=1+((g&7)<<3)+((c[u]&224)>>5)),o+="."+p}break}case"hvc1":case"hev1":{const l=findBox(e,["hvcC"])[0],c=l[1],u=["","A","B","C"][c>>6],f=c&31,d=readUint32(l,2),g=(c&32)>>5?"H":"L",p=l[12],v=l.subarray(6,12);o+="."+u+f,o+="."+d.toString(16).toUpperCase(),o+="."+g+p;let m="";for(let y=v.length;y--;){const x=v[y];(x||m)&&(m="."+x.toString(16).toUpperCase()+m)}o+=m;break}case"dvh1":case"dvhe":{const l=findBox(e,["dvcC"])[0],c=l[2]>>1&127,u=l[2]<<5&32|l[3]>>3&31;o+="."+addLeadingZero(c)+"."+addLeadingZero(u);break}case"vp09":{const l=findBox(e,["vpcC"])[0],c=l[4],u=l[5],f=l[6]>>4&15;o+="."+addLeadingZero(c)+"."+addLeadingZero(u)+"."+addLeadingZero(f);break}case"av01":{const l=findBox(e,["av1C"])[0],c=l[1]>>>5,u=l[1]&31,f=l[2]>>>7?"H":"M",d=(l[2]&64)>>6,g=(l[2]&32)>>5,p=c===2&&d?g?12:10:d?10:8,v=(l[2]&16)>>4,m=(l[2]&8)>>3,y=(l[2]&4)>>2,x=l[2]&3,_=1,E=1,S=1,A=0;o+="."+c+"."+addLeadingZero(u)+f+"."+addLeadingZero(p)+"."+v+"."+m+y+x+"."+addLeadingZero(_)+"."+addLeadingZero(E)+"."+addLeadingZero(S)+"."+A;break}}return{codec:o,encrypted:s}}function skipBERInteger(a,r){const e=r+5;for(;a[r++]&128&&r<e;);return r}function toHex(a){return("0"+a.toString(16).toUpperCase()).slice(-2)}function addLeadingZero(a){return(a<10?"0":"")+a}function patchEncyptionData(a,r){if(!a||!r)return a;const e=r.keyId;return e&&r.isCommonEncryption&&findBox(a,["moov","trak"]).forEach(o=>{const l=findBox(o,["mdia","minf","stbl","stsd"])[0].subarray(8);let c=findBox(l,["enca"]);const u=c.length>0;u||(c=findBox(l,["encv"])),c.forEach(f=>{const d=u?f.subarray(28):f.subarray(78);findBox(d,["sinf"]).forEach(p=>{const v=parseSinf(p);if(v){const m=v.subarray(8,24);m.some(y=>y!==0)||(logger.log(`[eme] Patching keyId in 'enc${u?"a":"v"}>sinf>>tenc' box: ${Hex.hexDump(m)} -> ${Hex.hexDump(e)}`),v.set(e,8))}})})}),a}function parseSinf(a){const r=findBox(a,["schm"])[0];if(r){const e=bin2str(r.subarray(4,8));if(e==="cbcs"||e==="cenc")return findBox(a,["schi","tenc"])[0]}return logger.error("[eme] missing 'schm' box"),null}function getStartDTS(a,r){return findBox(r,["moof","traf"]).reduce((e,n)=>{const o=findBox(n,["tfdt"])[0],s=o[0],l=findBox(n,["tfhd"]).reduce((c,u)=>{const f=readUint32(u,4),d=a[f];if(d){let g=readUint32(o,4);if(s===1){if(g===UINT32_MAX$1)return logger.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),c;g*=UINT32_MAX$1+1,g+=readUint32(o,8)}const p=d.timescale||9e4,v=g/p;if(isFiniteNumber(v)&&(c===null||v<c))return v}return c},null);return l!==null&&isFiniteNumber(l)&&(e===null||l<e)?l:e},null)}function getDuration(a,r){let e=0,n=0,o=0;const s=findBox(a,["moof","traf"]);for(let l=0;l<s.length;l++){const c=s[l],u=findBox(c,["tfhd"])[0],f=readUint32(u,4),d=r[f];if(!d)continue;const g=d.default,p=readUint32(u,0)|(g==null?void 0:g.flags);let v=g==null?void 0:g.duration;p&8&&(p&2?v=readUint32(u,12):v=readUint32(u,8));const m=d.timescale||9e4,y=findBox(c,["trun"]);for(let x=0;x<y.length;x++){if(e=computeRawDurationFromSamples(y[x]),!e&&v){const _=readUint32(y[x],4);e=v*_}d.type===ElementaryStreamTypes.VIDEO?n+=e/m:d.type===ElementaryStreamTypes.AUDIO&&(o+=e/m)}}if(n===0&&o===0){let l=1/0,c=0,u=0;const f=findBox(a,["sidx"]);for(let d=0;d<f.length;d++){const g=parseSegmentIndex(f[d]);if(g!=null&&g.references){l=Math.min(l,g.earliestPresentationTime/g.timescale);const p=g.references.reduce((v,m)=>v+m.info.duration||0,0);c=Math.max(c,p+g.earliestPresentationTime/g.timescale),u=c-l}}if(u&&isFiniteNumber(u))return u}return n||o}function computeRawDurationFromSamples(a){const r=readUint32(a,0);let e=8;r&1&&(e+=4),r&4&&(e+=4);let n=0;const o=readUint32(a,4);for(let s=0;s<o;s++){if(r&256){const l=readUint32(a,e);n+=l,e+=4}r&512&&(e+=4),r&1024&&(e+=4),r&2048&&(e+=4)}return n}function offsetStartDTS(a,r,e){findBox(r,["moof","traf"]).forEach(n=>{findBox(n,["tfhd"]).forEach(o=>{const s=readUint32(o,4),l=a[s];if(!l)return;const c=l.timescale||9e4;findBox(n,["tfdt"]).forEach(u=>{const f=u[0],d=e*c;if(d){let g=readUint32(u,4);if(f===0)g-=d,g=Math.max(g,0),writeUint32(u,4,g);else{g*=Math.pow(2,32),g+=readUint32(u,8),g-=d,g=Math.max(g,0);const p=Math.floor(g/(UINT32_MAX$1+1)),v=Math.floor(g%(UINT32_MAX$1+1));writeUint32(u,4,p),writeUint32(u,8,v)}}})})})}function segmentValidRange(a){const r={valid:null,remainder:null},e=findBox(a,["moof"]);if(e.length<2)return r.remainder=a,r;const n=e[e.length-1];return r.valid=sliceUint8(a,0,n.byteOffset-8),r.remainder=sliceUint8(a,n.byteOffset-8),r}function appendUint8Array(a,r){const e=new Uint8Array(a.length+r.length);return e.set(a),e.set(r,a.length),e}function parseSamples(a,r){const e=[],n=r.samples,o=r.timescale,s=r.id;let l=!1;return findBox(n,["moof"]).map(u=>{const f=u.byteOffset-8;findBox(u,["traf"]).map(g=>{const p=findBox(g,["tfdt"]).map(v=>{const m=v[0];let y=readUint32(v,4);return m===1&&(y*=Math.pow(2,32),y+=readUint32(v,8)),y/o})[0];return p!==void 0&&(a=p),findBox(g,["tfhd"]).map(v=>{const m=readUint32(v,4),y=readUint32(v,0)&16777215,x=(y&1)!==0,_=(y&2)!==0,E=(y&8)!==0;let S=0;const A=(y&16)!==0;let T=0;const b=(y&32)!==0;let C=8;m===s&&(x&&(C+=8),_&&(C+=4),E&&(S=readUint32(v,C),C+=4),A&&(T=readUint32(v,C),C+=4),b&&(C+=4),r.type==="video"&&(l=isHEVC(r.codec)),findBox(g,["trun"]).map(L=>{const R=L[0],I=readUint32(L,0)&16777215,w=(I&1)!==0;let M=0;const D=(I&4)!==0,O=(I&256)!==0;let F=0;const k=(I&512)!==0;let $=0;const V=(I&1024)!==0,N=(I&2048)!==0;let B=0;const G=readUint32(L,4);let z=8;w&&(M=readUint32(L,z),z+=4),D&&(z+=4);let H=M+f;for(let W=0;W<G;W++){if(O?(F=readUint32(L,z),z+=4):F=S,k?($=readUint32(L,z),z+=4):$=T,V&&(z+=4),N&&(R===0?B=readUint32(L,z):B=readSint32(L,z),z+=4),r.type===ElementaryStreamTypes.VIDEO){let Y=0;for(;Y<$;){const K=readUint32(n,H);if(H+=4,isSEIMessage(l,n[H])){const Z=n.subarray(H,H+K);parseSEIMessageFromNALu(Z,l?2:1,a+B/o,e)}H+=K,Y+=K+4}}a+=F/o}}))})})}),e}function isHEVC(a){if(!a)return!1;const r=a.indexOf("."),e=r<0?a:a.substring(0,r);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function isSEIMessage(a,r){if(a){const e=r>>1&63;return e===39||e===40}else return(r&31)===6}function parseSEIMessageFromNALu(a,r,e,n){const o=discardEPB(a);let s=0;s+=r;let l=0,c=0,u=0;for(;s<o.length;){l=0;do{if(s>=o.length)break;u=o[s++],l+=u}while(u===255);c=0;do{if(s>=o.length)break;u=o[s++],c+=u}while(u===255);const f=o.length-s;let d=s;if(c<f)s+=c;else if(c>f){logger.error(`Malformed SEI payload. ${c} is too small, only ${f} bytes left to parse.`);break}if(l===4){if(o[d++]===181){const p=readUint16(o,d);if(d+=2,p===49){const v=readUint32(o,d);if(d+=4,v===1195456820){const m=o[d++];if(m===3){const y=o[d++],x=31&y,_=64&y,E=_?2+x*3:0,S=new Uint8Array(E);if(_){S[0]=y;for(let A=1;A<E;A++)S[A]=o[d++]}n.push({type:m,payloadType:l,pts:e,bytes:S})}}}}}else if(l===5&&c>16){const g=[];for(let m=0;m<16;m++){const y=o[d++].toString(16);g.push(y.length==1?"0"+y:y),(m===3||m===5||m===7||m===9)&&g.push("-")}const p=c-16,v=new Uint8Array(p);for(let m=0;m<p;m++)v[m]=o[d++];n.push({payloadType:l,pts:e,uuid:g.join(""),userData:utf8ArrayToStr(v),userDataBytes:v})}}}function discardEPB(a){const r=a.byteLength,e=[];let n=1;for(;n<r-2;)a[n]===0&&a[n+1]===0&&a[n+2]===3?(e.push(n+2),n+=2):n++;if(e.length===0)return a;const o=r-e.length,s=new Uint8Array(o);let l=0;for(n=0;n<o;l++,n++)l===e[0]&&(l++,e.shift()),s[n]=a[l];return s}function parseEmsg(a){const r=a[0];let e="",n="",o=0,s=0,l=0,c=0,u=0,f=0;if(r===0){for(;bin2str(a.subarray(f,f+1))!=="\0";)e+=bin2str(a.subarray(f,f+1)),f+=1;for(e+=bin2str(a.subarray(f,f+1)),f+=1;bin2str(a.subarray(f,f+1))!=="\0";)n+=bin2str(a.subarray(f,f+1)),f+=1;n+=bin2str(a.subarray(f,f+1)),f+=1,o=readUint32(a,12),s=readUint32(a,16),c=readUint32(a,20),u=readUint32(a,24),f=28}else if(r===1){f+=4,o=readUint32(a,f),f+=4;const g=readUint32(a,f);f+=4;const p=readUint32(a,f);for(f+=4,l=2**32*g+p,isSafeInteger(l)||(l=Number.MAX_SAFE_INTEGER,logger.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),c=readUint32(a,f),f+=4,u=readUint32(a,f),f+=4;bin2str(a.subarray(f,f+1))!=="\0";)e+=bin2str(a.subarray(f,f+1)),f+=1;for(e+=bin2str(a.subarray(f,f+1)),f+=1;bin2str(a.subarray(f,f+1))!=="\0";)n+=bin2str(a.subarray(f,f+1)),f+=1;n+=bin2str(a.subarray(f,f+1)),f+=1}const d=a.subarray(f,a.byteLength);return{schemeIdUri:e,value:n,timeScale:o,presentationTime:l,presentationTimeDelta:s,eventDuration:c,id:u,payload:d}}function mp4Box(a,...r){const e=r.length;let n=8,o=e;for(;o--;)n+=r[o].byteLength;const s=new Uint8Array(n);for(s[0]=n>>24&255,s[1]=n>>16&255,s[2]=n>>8&255,s[3]=n&255,s.set(a,4),o=0,n=8;o<e;o++)s.set(r[o],n),n+=r[o].byteLength;return s}function mp4pssh(a,r,e){if(a.byteLength!==16)throw new RangeError("Invalid system id");let n,o;if(r){n=1,o=new Uint8Array(r.length*16);for(let c=0;c<r.length;c++){const u=r[c];if(u.byteLength!==16)throw new RangeError("Invalid key");o.set(u,c*16)}}else n=0,o=new Uint8Array;let s;n>0?(s=new Uint8Array(4),r.length>0&&new DataView(s.buffer).setUint32(0,r.length,!1)):s=new Uint8Array;const l=new Uint8Array(4);return e&&e.byteLength>0&&new DataView(l.buffer).setUint32(0,e.byteLength,!1),mp4Box([112,115,115,104],new Uint8Array([n,0,0,0]),a,s,o,l,e||new Uint8Array)}function parsePssh(a){if(!(a instanceof ArrayBuffer)||a.byteLength<32)return null;const r={version:0,systemId:"",kids:null,data:null},e=new DataView(a),n=e.getUint32(0);if(a.byteLength!==n&&n>44||e.getUint32(4)!==1886614376||(r.version=e.getUint32(8)>>>24,r.version>1))return null;r.systemId=Hex.hexDump(new Uint8Array(a,12,16));const s=e.getUint32(28);if(r.version===0){if(n-32<s)return null;r.data=new Uint8Array(a,32,s)}else if(r.version===1){r.kids=[];for(let l=0;l<s;l++)r.kids.push(new Uint8Array(a,32+l*16,16))}return r}let keyUriToKeyIdMap={};class LevelKey{static clearKeyUriToKeyIdMap(){keyUriToKeyIdMap={}}constructor(r,e,n,o=[1],s=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=r,this.uri=e,this.keyFormat=n,this.keyFormatVersions=o,this.iv=s,this.encrypted=r?r!=="NONE":!1,this.isCommonEncryption=this.encrypted&&r!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case KeySystemFormats.FAIRPLAY:case KeySystemFormats.WIDEVINE:case KeySystemFormats.PLAYREADY:case KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(r){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof r!="number"&&(this.method==="AES-128"&&!this.iv&&logger.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),r=0);const n=createInitializationVector(r);return new LevelKey(this.method,this.uri,"identity",this.keyFormatVersions,n)}const e=convertDataUriToArrayBytes(this.uri);if(e)switch(this.keyFormat){case KeySystemFormats.WIDEVINE:this.pssh=e,e.length>=22&&(this.keyId=e.subarray(e.length-22,e.length-6));break;case KeySystemFormats.PLAYREADY:{const n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=mp4pssh(n,null,e);const o=new Uint16Array(e.buffer,e.byteOffset,e.byteLength/2),s=String.fromCharCode.apply(null,Array.from(o)),l=s.substring(s.indexOf("<"),s.length),f=new DOMParser().parseFromString(l,"text/xml").getElementsByTagName("KID")[0];if(f){const d=f.childNodes[0]?f.childNodes[0].nodeValue:f.getAttribute("VALUE");if(d){const g=base64Decode(d).subarray(0,16);changeEndianness(g),this.keyId=g}}break}default:{let n=e.subarray(0,16);if(n.length!==16){const o=new Uint8Array(16);o.set(n,16-n.length),n=o}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){let n=keyUriToKeyIdMap[this.uri];if(!n){const o=Object.keys(keyUriToKeyIdMap).length%Number.MAX_SAFE_INTEGER;n=new Uint8Array(16),new DataView(n.buffer,12,4).setUint32(0,o),keyUriToKeyIdMap[this.uri]=n}this.keyId=n}return this}}function createInitializationVector(a){const r=new Uint8Array(16);for(let e=12;e<16;e++)r[e]=a>>8*(15-e)&255;return r}const VARIABLE_REPLACEMENT_REGEX=/\{\$([a-zA-Z0-9-_]+)\}/g;function hasVariableReferences(a){return VARIABLE_REPLACEMENT_REGEX.test(a)}function substituteVariablesInAttributes(a,r,e){if(a.variableList!==null||a.hasVariableRefs)for(let n=e.length;n--;){const o=e[n],s=r[o];s&&(r[o]=substituteVariables(a,s))}}function substituteVariables(a,r){if(a.variableList!==null||a.hasVariableRefs){const e=a.variableList;return r.replace(VARIABLE_REPLACEMENT_REGEX,n=>{const o=n.substring(2,n.length-1),s=e==null?void 0:e[o];return s===void 0?(a.playlistParsingError||(a.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${o}"`)),n):s})}return r}function addVariableDefinition(a,r,e){let n=a.variableList;n||(a.variableList=n={});let o,s;if("QUERYPARAM"in r){o=r.QUERYPARAM;try{const l=new self.URL(e).searchParams;if(l.has(o))s=l.get(o);else throw new Error(`"${o}" does not match any query parameter in URI: "${e}"`)}catch(l){a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${l.message}`))}}else o=r.NAME,s=r.VALUE;o in n?a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${o}"`)):n[o]=s||""}function importVariableDefinition(a,r,e){const n=r.IMPORT;if(e&&n in e){let o=a.variableList;o||(a.variableList=o={}),o[n]=e[n]}else a.playlistParsingError||(a.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}function getMediaSource(a=!0){return typeof self>"u"?void 0:(a||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function isManagedMediaSource(a){return typeof self<"u"&&a===self.ManagedMediaSource}const sampleEntryCodesISO={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function isCodecType(a,r){const e=sampleEntryCodesISO[r];return!!e&&!!e[a.slice(0,4)]}function areCodecsMediaSourceSupported(a,r,e=!0){return!a.split(",").some(n=>!isCodecMediaSourceSupported(n,r,e))}function isCodecMediaSourceSupported(a,r,e=!0){var n;const o=getMediaSource(e);return(n=o==null?void 0:o.isTypeSupported(mimeTypeForCodec(a,r)))!=null?n:!1}function mimeTypeForCodec(a,r){return`${r}/mp4;codecs="${a}"`}function videoCodecPreferenceValue(a){if(a){const r=a.substring(0,4);return sampleEntryCodesISO.video[r]}return 2}function codecsSetSelectionPreferenceValue(a){return a.split(",").reduce((r,e)=>{const n=sampleEntryCodesISO.video[e];return n?(n*2+r)/(r?3:2):(sampleEntryCodesISO.audio[e]+r)/(r?2:1)},0)}const CODEC_COMPATIBLE_NAMES={};function getCodecCompatibleNameLower(a,r=!0){if(CODEC_COMPATIBLE_NAMES[a])return CODEC_COMPATIBLE_NAMES[a];const e={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[a];for(let n=0;n<e.length;n++)if(isCodecMediaSourceSupported(e[n],"audio",r))return CODEC_COMPATIBLE_NAMES[a]=e[n],e[n];return a}const AUDIO_CODEC_REGEXP=/flac|opus/i;function getCodecCompatibleName(a,r=!0){return a.replace(AUDIO_CODEC_REGEXP,e=>getCodecCompatibleNameLower(e.toLowerCase(),r))}function pickMostCompleteCodecName(a,r){return a&&a!=="mp4a"?a:r&&r.split(",")[0]}function convertAVC1ToAVCOTI(a){const r=a.split(".");if(r.length>2){let e=r.shift()+".";return e+=parseInt(r.shift()).toString(16),e+=("000"+parseInt(r.shift()).toString(16)).slice(-4),e}return a}const MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,IS_MEDIA_PLAYLIST=/^#EXT(?:INF|-X-TARGETDURATION):/m,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),LEVEL_PLAYLIST_REGEX_SLOW=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class M3U8Parser{static findGroup(r,e){for(let n=0;n<r.length;n++){const o=r[n];if(o.id===e)return o}}static resolve(r,e){return urlToolkitExports.buildAbsoluteURL(e,r,{alwaysNormalize:!0})}static isMediaPlaylist(r){return IS_MEDIA_PLAYLIST.test(r)}static parseMasterPlaylist(r,e){const n=hasVariableReferences(r),o={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},s=[];MASTER_PLAYLIST_REGEX.lastIndex=0;let l;for(;(l=MASTER_PLAYLIST_REGEX.exec(r))!=null;)if(l[1]){var c;const f=new AttrList(l[1]);substituteVariablesInAttributes(o,f,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const d=substituteVariables(o,l[2]),g={attrs:f,bitrate:f.decimalInteger("BANDWIDTH")||f.decimalInteger("AVERAGE-BANDWIDTH"),name:f.NAME,url:M3U8Parser.resolve(d,e)},p=f.decimalResolution("RESOLUTION");p&&(g.width=p.width,g.height=p.height),setCodecs(f.CODECS,g),(c=g.unknownCodecs)!=null&&c.length||s.push(g),o.levels.push(g)}else if(l[3]){const f=l[3],d=l[4];switch(f){case"SESSION-DATA":{const g=new AttrList(d);substituteVariablesInAttributes(o,g,["DATA-ID","LANGUAGE","VALUE","URI"]);const p=g["DATA-ID"];p&&(o.sessionData===null&&(o.sessionData={}),o.sessionData[p]=g);break}case"SESSION-KEY":{const g=parseKey(d,e,o);g.encrypted&&g.isSupported()?(o.sessionKeys===null&&(o.sessionKeys=[]),o.sessionKeys.push(g)):logger.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${d}"`);break}case"DEFINE":{{const g=new AttrList(d);substituteVariablesInAttributes(o,g,["NAME","VALUE","QUERYPARAM"]),addVariableDefinition(o,g,e)}break}case"CONTENT-STEERING":{const g=new AttrList(d);substituteVariablesInAttributes(o,g,["SERVER-URI","PATHWAY-ID"]),o.contentSteering={uri:M3U8Parser.resolve(g["SERVER-URI"],e),pathwayId:g["PATHWAY-ID"]||"."};break}case"START":{o.startTimeOffset=parseStartTimeOffset(d);break}}}const u=s.length>0&&s.length<o.levels.length;return o.levels=u?s:o.levels,o.levels.length===0&&(o.playlistParsingError=new Error("no levels found in manifest")),o}static parseMasterPlaylistMedia(r,e,n){let o;const s={},l=n.levels,c={AUDIO:l.map(f=>({id:f.attrs.AUDIO,audioCodec:f.audioCodec})),SUBTITLES:l.map(f=>({id:f.attrs.SUBTITLES,textCodec:f.textCodec})),"CLOSED-CAPTIONS":[]};let u=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;(o=MASTER_PLAYLIST_MEDIA_REGEX.exec(r))!==null;){const f=new AttrList(o[1]),d=f.TYPE;if(d){const g=c[d],p=s[d]||[];s[d]=p,substituteVariablesInAttributes(n,f,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const v=f.LANGUAGE,m=f["ASSOC-LANGUAGE"],y=f.CHANNELS,x=f.CHARACTERISTICS,_=f["INSTREAM-ID"],E={attrs:f,bitrate:0,id:u++,groupId:f["GROUP-ID"]||"",name:f.NAME||v||"",type:d,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:v,url:f.URI?M3U8Parser.resolve(f.URI,e):""};if(m&&(E.assocLang=m),y&&(E.channels=y),x&&(E.characteristics=x),_&&(E.instreamId=_),g!=null&&g.length){const S=M3U8Parser.findGroup(g,E.groupId)||g[0];assignCodec(E,S,"audioCodec"),assignCodec(E,S,"textCodec")}p.push(E)}}return s}static parseLevelPlaylist(r,e,n,o,s,l){const c=new LevelDetails(e),u=c.fragments;let f=null,d=0,g=0,p=0,v=0,m=null,y=new Fragment(o,e),x,_,E,S=-1,A=!1,T=null;for(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0,c.m3u8=r,c.hasVariableRefs=hasVariableReferences(r);(x=LEVEL_PLAYLIST_REGEX_FAST.exec(r))!==null;){A&&(A=!1,y=new Fragment(o,e),y.start=p,y.sn=d,y.cc=v,y.level=n,f&&(y.initSegment=f,y.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null,T&&(y.setByteRange(T),T=null)));const R=x[1];if(R){y.duration=parseFloat(R);const I=(" "+x[2]).slice(1);y.title=I||null,y.tagList.push(I?["INF",R,I]:["INF",R])}else if(x[3]){if(isFiniteNumber(y.duration)){y.start=p,E&&setFragLevelKeys(y,E,c),y.sn=d,y.level=n,y.cc=v,u.push(y);const I=(" "+x[3]).slice(1);y.relurl=substituteVariables(c,I),assignProgramDateTime(y,m),m=y,p+=y.duration,d++,g=0,A=!0}}else if(x[4]){const I=(" "+x[4]).slice(1);m?y.setByteRange(I,m):y.setByteRange(I)}else if(x[5])y.rawProgramDateTime=(" "+x[5]).slice(1),y.tagList.push(["PROGRAM-DATE-TIME",y.rawProgramDateTime]),S===-1&&(S=u.length);else{if(x=x[0].match(LEVEL_PLAYLIST_REGEX_SLOW),!x){logger.warn("No matches on slow regex match for level playlist!");continue}for(_=1;_<x.length&&!(typeof x[_]<"u");_++);const I=(" "+x[_]).slice(1),w=(" "+x[_+1]).slice(1),M=x[_+2]?(" "+x[_+2]).slice(1):"";switch(I){case"PLAYLIST-TYPE":c.type=w.toUpperCase();break;case"MEDIA-SEQUENCE":d=c.startSN=parseInt(w);break;case"SKIP":{const D=new AttrList(w);substituteVariablesInAttributes(c,D,["RECENTLY-REMOVED-DATERANGES"]);const O=D.decimalInteger("SKIPPED-SEGMENTS");if(isFiniteNumber(O)){c.skippedSegments=O;for(let k=O;k--;)u.unshift(null);d+=O}const F=D.enumeratedString("RECENTLY-REMOVED-DATERANGES");F&&(c.recentlyRemovedDateranges=F.split("	"));break}case"TARGETDURATION":c.targetduration=Math.max(parseInt(w),1);break;case"VERSION":c.version=parseInt(w);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":c.live=!1;break;case"#":(w||M)&&y.tagList.push(M?[w,M]:[w]);break;case"DISCONTINUITY":v++,y.tagList.push(["DIS"]);break;case"GAP":y.gap=!0,y.tagList.push([I]);break;case"BITRATE":y.tagList.push([I,w]);break;case"DATERANGE":{const D=new AttrList(w);substituteVariablesInAttributes(c,D,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),substituteVariablesInAttributes(c,D,D.clientAttrs);const O=new DateRange(D,c.dateRanges[D.ID]);O.isValid||c.skippedSegments?c.dateRanges[O.id]=O:logger.warn(`Ignoring invalid DATERANGE tag: "${w}"`),y.tagList.push(["EXT-X-DATERANGE",w]);break}case"DEFINE":{{const D=new AttrList(w);substituteVariablesInAttributes(c,D,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in D?importVariableDefinition(c,D,l):addVariableDefinition(c,D,e)}break}case"DISCONTINUITY-SEQUENCE":v=parseInt(w);break;case"KEY":{const D=parseKey(w,e,c);if(D.isSupported()){if(D.method==="NONE"){E=void 0;break}E||(E={}),E[D.keyFormat]&&(E=_extends({},E)),E[D.keyFormat]=D}else logger.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${w}"`);break}case"START":c.startTimeOffset=parseStartTimeOffset(w);break;case"MAP":{const D=new AttrList(w);if(substituteVariablesInAttributes(c,D,["BYTERANGE","URI"]),y.duration){const O=new Fragment(o,e);setInitSegment(O,D,n,E),f=O,y.initSegment=f,f.rawProgramDateTime&&!y.rawProgramDateTime&&(y.rawProgramDateTime=f.rawProgramDateTime)}else{const O=y.byteRangeEndOffset;if(O){const F=y.byteRangeStartOffset;T=`${O-F}@${F}`}else T=null;setInitSegment(y,D,n,E),f=y,A=!0}break}case"SERVER-CONTROL":{const D=new AttrList(w);c.canBlockReload=D.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=D.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&D.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=D.optionalFloat("PART-HOLD-BACK",0),c.holdBack=D.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const D=new AttrList(w);c.partTarget=D.decimalFloatingPoint("PART-TARGET");break}case"PART":{let D=c.partList;D||(D=c.partList=[]);const O=g>0?D[D.length-1]:void 0,F=g++,k=new AttrList(w);substituteVariablesInAttributes(c,k,["BYTERANGE","URI"]);const $=new Part(k,y,e,F,O);D.push($),y.duration+=$.duration;break}case"PRELOAD-HINT":{const D=new AttrList(w);substituteVariablesInAttributes(c,D,["URI"]),c.preloadHint=D;break}case"RENDITION-REPORT":{const D=new AttrList(w);substituteVariablesInAttributes(c,D,["URI"]),c.renditionReports=c.renditionReports||[],c.renditionReports.push(D);break}default:logger.warn(`line parsed but not handled: ${x}`);break}}}m&&!m.relurl?(u.pop(),p-=m.duration,c.partList&&(c.fragmentHint=m)):c.partList&&(assignProgramDateTime(y,m),y.cc=v,c.fragmentHint=y,E&&setFragLevelKeys(y,E,c));const b=u.length,C=u[0],L=u[b-1];if(p+=c.skippedSegments*c.targetduration,p>0&&b&&L){c.averagetargetduration=p/b;const R=L.sn;c.endSN=R!=="initSegment"?R:0,c.live||(L.endList=!0),C&&(c.startCC=C.cc)}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(p+=c.fragmentHint.duration),c.totalduration=p,c.endCC=v,S>0&&backfillProgramDateTimes(u,S),c}}function parseKey(a,r,e){var n,o;const s=new AttrList(a);substituteVariablesInAttributes(e,s,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const l=(n=s.METHOD)!=null?n:"",c=s.URI,u=s.hexadecimalInteger("IV"),f=s.KEYFORMATVERSIONS,d=(o=s.KEYFORMAT)!=null?o:"identity";c&&s.IV&&!u&&logger.error(`Invalid IV: ${s.IV}`);const g=c?M3U8Parser.resolve(c,r):"",p=(f||"1").split("/").map(Number).filter(Number.isFinite);return new LevelKey(l,g,d,p,u)}function parseStartTimeOffset(a){const e=new AttrList(a).decimalFloatingPoint("TIME-OFFSET");return isFiniteNumber(e)?e:null}function setCodecs(a,r){let e=(a||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const o=e.filter(s=>isCodecType(s,n));o.length&&(r[`${n}Codec`]=o.join(","),e=e.filter(s=>o.indexOf(s)===-1))}),r.unknownCodecs=e}function assignCodec(a,r,e){const n=r[e];n&&(a[e]=n)}function backfillProgramDateTimes(a,r){let e=a[r];for(let n=r;n--;){const o=a[n];if(!o)return;o.programDateTime=e.programDateTime-o.duration*1e3,e=o}}function assignProgramDateTime(a,r){a.rawProgramDateTime?a.programDateTime=Date.parse(a.rawProgramDateTime):r!=null&&r.programDateTime&&(a.programDateTime=r.endProgramDateTime),isFiniteNumber(a.programDateTime)||(a.programDateTime=null,a.rawProgramDateTime=null)}function setInitSegment(a,r,e,n){a.relurl=r.URI,r.BYTERANGE&&a.setByteRange(r.BYTERANGE),a.level=e,a.sn="initSegment",n&&(a.levelkeys=n),a.initSegment=null}function setFragLevelKeys(a,r,e){a.levelkeys=r;const{encryptedFragments:n}=e;(!n.length||n[n.length-1].levelkeys!==r)&&Object.keys(r).some(o=>r[o].isCommonEncryption)&&n.push(a)}var PlaylistContextType={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},PlaylistLevelType={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function mapContextToLevelType(a){const{type:r}=a;switch(r){case PlaylistContextType.AUDIO_TRACK:return PlaylistLevelType.AUDIO;case PlaylistContextType.SUBTITLE_TRACK:return PlaylistLevelType.SUBTITLE;default:return PlaylistLevelType.MAIN}}function getResponseUrl(a,r){let e=a.url;return(e===void 0||e.indexOf("data:")===0)&&(e=r.url),e}class PlaylistLoader{constructor(r){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=r,this.registerListeners()}startLoad(r){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:r}=this;r.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.on(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:r}=this;r.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.off(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(r){const e=this.hls.config,n=e.pLoader,o=e.loader,s=n||o,l=new s(e);return this.loaders[r.type]=l,l}getInternalLoader(r){return this.loaders[r.type]}resetInternalLoader(r){this.loaders[r]&&delete this.loaders[r]}destroyInternalLoaders(){for(const r in this.loaders){const e=this.loaders[r];e&&e.destroy(),this.resetInternalLoader(r)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(r,e){const{url:n}=e;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:PlaylistContextType.MANIFEST,url:n,deliveryDirectives:null})}onLevelLoading(r,e){const{id:n,level:o,pathwayId:s,url:l,deliveryDirectives:c}=e;this.load({id:n,level:o,pathwayId:s,responseType:"text",type:PlaylistContextType.LEVEL,url:l,deliveryDirectives:c})}onAudioTrackLoading(r,e){const{id:n,groupId:o,url:s,deliveryDirectives:l}=e;this.load({id:n,groupId:o,level:null,responseType:"text",type:PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:l})}onSubtitleTrackLoading(r,e){const{id:n,groupId:o,url:s,deliveryDirectives:l}=e;this.load({id:n,groupId:o,level:null,responseType:"text",type:PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:l})}load(r){var e;const n=this.hls.config;let o=this.getInternalLoader(r);if(o){const f=o.context;if(f&&f.url===r.url&&f.level===r.level){logger.trace("[playlist-loader]: playlist request ongoing");return}logger.log(`[playlist-loader]: aborting previous loader for type: ${r.type}`),o.abort()}let s;if(r.type===PlaylistContextType.MANIFEST?s=n.manifestLoadPolicy.default:s=_extends({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),o=this.createInternalLoader(r),isFiniteNumber((e=r.deliveryDirectives)==null?void 0:e.part)){let f;if(r.type===PlaylistContextType.LEVEL&&r.level!==null?f=this.hls.levels[r.level].details:r.type===PlaylistContextType.AUDIO_TRACK&&r.id!==null?f=this.hls.audioTracks[r.id].details:r.type===PlaylistContextType.SUBTITLE_TRACK&&r.id!==null&&(f=this.hls.subtitleTracks[r.id].details),f){const d=f.partTarget,g=f.targetduration;if(d&&g){const p=Math.max(d*3,g*.8)*1e3;s=_extends({},s,{maxTimeToFirstByteMs:Math.min(p,s.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(p,s.maxTimeToFirstByteMs)})}}}const l=s.errorRetry||s.timeoutRetry||{},c={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},u={onSuccess:(f,d,g,p)=>{const v=this.getInternalLoader(g);this.resetInternalLoader(g.type);const m=f.data;if(m.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(f,g,new Error("no EXTM3U delimiter"),p||null,d);return}d.parsing.start=performance.now(),M3U8Parser.isMediaPlaylist(m)?this.handleTrackOrLevelPlaylist(f,d,g,p||null,v):this.handleMasterPlaylist(f,d,g,p)},onError:(f,d,g,p)=>{this.handleNetworkError(d,g,!1,f,p)},onTimeout:(f,d,g)=>{this.handleNetworkError(d,g,!0,void 0,f)}};o.load(r,c,u)}handleMasterPlaylist(r,e,n,o){const s=this.hls,l=r.data,c=getResponseUrl(r,n),u=M3U8Parser.parseMasterPlaylist(l,c);if(u.playlistParsingError){this.handleManifestParsingError(r,n,u.playlistParsingError,o,e);return}const{contentSteering:f,levels:d,sessionData:g,sessionKeys:p,startTimeOffset:v,variableList:m}=u;this.variableList=m;const{AUDIO:y=[],SUBTITLES:x,"CLOSED-CAPTIONS":_}=M3U8Parser.parseMasterPlaylistMedia(l,c,u);y.length&&!y.some(S=>!S.url)&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),y.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new AttrList({}),bitrate:0,url:""})),s.trigger(Events.MANIFEST_LOADED,{levels:d,audioTracks:y,subtitles:x,captions:_,contentSteering:f,url:c,stats:e,networkDetails:o,sessionData:g,sessionKeys:p,startTimeOffset:v,variableList:m})}handleTrackOrLevelPlaylist(r,e,n,o,s){const l=this.hls,{id:c,level:u,type:f}=n,d=getResponseUrl(r,n),g=0,p=isFiniteNumber(u)?u:isFiniteNumber(c)?c:0,v=mapContextToLevelType(n),m=M3U8Parser.parseLevelPlaylist(r.data,d,p,v,g,this.variableList);if(f===PlaylistContextType.MANIFEST){const y={attrs:new AttrList({}),bitrate:0,details:m,name:"",url:d};l.trigger(Events.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:d,stats:e,networkDetails:o,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}e.parsing.end=performance.now(),n.levelDetails=m,this.handlePlaylistLoaded(m,r,e,n,o,s)}handleManifestParsingError(r,e,n,o,s){this.hls.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.MANIFEST_PARSING_ERROR,fatal:e.type===PlaylistContextType.MANIFEST,url:r.url,err:n,error:n,reason:n.message,response:r,context:e,networkDetails:o,stats:s})}handleNetworkError(r,e,n=!1,o,s){let l=`A network ${n?"timeout":"error"+(o?" (status "+o.code+")":"")} occurred while loading ${r.type}`;r.type===PlaylistContextType.LEVEL?l+=`: ${r.level} id: ${r.id}`:(r.type===PlaylistContextType.AUDIO_TRACK||r.type===PlaylistContextType.SUBTITLE_TRACK)&&(l+=` id: ${r.id} group-id: "${r.groupId}"`);const c=new Error(l);logger.warn(`[playlist-loader]: ${l}`);let u=ErrorDetails.UNKNOWN,f=!1;const d=this.getInternalLoader(r);switch(r.type){case PlaylistContextType.MANIFEST:u=n?ErrorDetails.MANIFEST_LOAD_TIMEOUT:ErrorDetails.MANIFEST_LOAD_ERROR,f=!0;break;case PlaylistContextType.LEVEL:u=n?ErrorDetails.LEVEL_LOAD_TIMEOUT:ErrorDetails.LEVEL_LOAD_ERROR,f=!1;break;case PlaylistContextType.AUDIO_TRACK:u=n?ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,f=!1;break;case PlaylistContextType.SUBTITLE_TRACK:u=n?ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:ErrorDetails.SUBTITLE_LOAD_ERROR,f=!1;break}d&&this.resetInternalLoader(r.type);const g={type:ErrorTypes.NETWORK_ERROR,details:u,fatal:f,url:r.url,loader:d,context:r,error:c,networkDetails:e,stats:s};if(o){const p=(e==null?void 0:e.url)||r.url;g.response=_objectSpread2({url:p,data:void 0},o)}this.hls.trigger(Events.ERROR,g)}handlePlaylistLoaded(r,e,n,o,s,l){const c=this.hls,{type:u,level:f,id:d,groupId:g,deliveryDirectives:p}=o,v=getResponseUrl(e,o),m=mapContextToLevelType(o),y=typeof o.level=="number"&&m===PlaylistLevelType.MAIN?f:void 0;if(!r.fragments.length){const _=new Error("No Segments found in Playlist");c.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:v,error:_,reason:_.message,response:e,context:o,level:y,parent:m,networkDetails:s,stats:n});return}r.targetduration||(r.playlistParsingError=new Error("Missing Target Duration"));const x=r.playlistParsingError;if(x){c.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_PARSING_ERROR,fatal:!1,url:v,error:x,reason:x.message,response:e,context:o,level:y,parent:m,networkDetails:s,stats:n});return}switch(r.live&&l&&(l.getCacheAge&&(r.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(r.ageHeader))&&(r.ageHeader=0)),u){case PlaylistContextType.MANIFEST:case PlaylistContextType.LEVEL:c.trigger(Events.LEVEL_LOADED,{details:r,level:y||0,id:d||0,stats:n,networkDetails:s,deliveryDirectives:p});break;case PlaylistContextType.AUDIO_TRACK:c.trigger(Events.AUDIO_TRACK_LOADED,{details:r,id:d||0,groupId:g||"",stats:n,networkDetails:s,deliveryDirectives:p});break;case PlaylistContextType.SUBTITLE_TRACK:c.trigger(Events.SUBTITLE_TRACK_LOADED,{details:r,id:d||0,groupId:g||"",stats:n,networkDetails:s,deliveryDirectives:p});break}}}function sendAddTrackEvent(a,r){let e;try{e=new Event("addtrack")}catch{e=document.createEvent("Event"),e.initEvent("addtrack",!1,!1)}e.track=a,r.dispatchEvent(e)}function addCueToTrack(a,r){const e=a.mode;if(e==="disabled"&&(a.mode="hidden"),a.cues&&!a.cues.getCueById(r.id))try{if(a.addCue(r),!a.cues.getCueById(r.id))throw new Error(`addCue is failed for: ${r}`)}catch(n){logger.debug(`[texttrack-utils]: ${n}`);try{const o=new self.TextTrackCue(r.startTime,r.endTime,r.text);o.id=r.id,a.addCue(o)}catch(o){logger.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${o}`)}}e==="disabled"&&(a.mode=e)}function clearCurrentCues(a){const r=a.mode;if(r==="disabled"&&(a.mode="hidden"),a.cues)for(let e=a.cues.length;e--;)a.removeCue(a.cues[e]);r==="disabled"&&(a.mode=r)}function removeCuesInRange(a,r,e,n){const o=a.mode;if(o==="disabled"&&(a.mode="hidden"),a.cues&&a.cues.length>0){const s=getCuesInRange(a.cues,r,e);for(let l=0;l<s.length;l++)(!n||n(s[l]))&&a.removeCue(s[l])}o==="disabled"&&(a.mode=o)}function getFirstCueIndexAfterTime(a,r){if(r<a[0].startTime)return 0;const e=a.length-1;if(r>a[e].endTime)return-1;let n=0,o=e;for(;n<=o;){const s=Math.floor((o+n)/2);if(r<a[s].startTime)o=s-1;else if(r>a[s].startTime&&n<e)n=s+1;else return s}return a[n].startTime-r<r-a[o].startTime?n:o}function getCuesInRange(a,r,e){const n=[],o=getFirstCueIndexAfterTime(a,r);if(o>-1)for(let s=o,l=a.length;s<l;s++){const c=a[s];if(c.startTime>=r&&c.endTime<=e)n.push(c);else if(c.startTime>e)return n}return n}function filterSubtitleTracks(a){const r=[];for(let e=0;e<a.length;e++){const n=a[e];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&r.push(a[e])}return r}var MetadataSchema={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const MIN_CUE_DURATION=.25;function getCueClass(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function createCueWithDataFields(a,r,e,n,o){let s=new a(r,e,"");try{s.value=n,o&&(s.type=o)}catch{s=new a(r,e,JSON.stringify(o?_objectSpread2({type:o},n):n))}return s}const MAX_CUE_ENDTIME=(()=>{const a=getCueClass();try{a&&new a(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function dateRangeDateToTimelineSeconds(a,r){return a.getTime()/1e3-r}function hexToArrayBuffer(a){return Uint8Array.from(a.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class ID3TrackController{constructor(r){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=r,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:r}=this;r.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:r}=this;r.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),r.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(r,e){this.media=e.media}onMediaDetaching(){this.id3Track&&(clearCurrentCues(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(r){const e=this.getID3Track(r.textTracks);return e.mode="hidden",e}getID3Track(r){if(this.media){for(let e=0;e<r.length;e++){const n=r[e];if(n.kind==="metadata"&&n.label==="id3")return sendAddTrackEvent(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(r,e){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:o}}}=this;if(!n&&!o)return;const{samples:s}=e;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=getCueClass();if(l)for(let c=0;c<s.length;c++){const u=s[c].type;if(u===MetadataSchema.emsg&&!n||!o)continue;const f=getID3Frames(s[c].data);if(f){const d=s[c].pts;let g=d+s[c].duration;g>MAX_CUE_ENDTIME&&(g=MAX_CUE_ENDTIME),g-d<=0&&(g=d+MIN_CUE_DURATION);for(let v=0;v<f.length;v++){const m=f[v];if(!isTimeStampFrame(m)){this.updateId3CueEnds(d,u);const y=createCueWithDataFields(l,d,g,m,u);y&&this.id3Track.addCue(y)}}}}}updateId3CueEnds(r,e){var n;const o=(n=this.id3Track)==null?void 0:n.cues;if(o)for(let s=o.length;s--;){const l=o[s];l.type===e&&l.startTime<r&&l.endTime===MAX_CUE_ENDTIME&&(l.endTime=r)}}onBufferFlushing(r,{startOffset:e,endOffset:n,type:o}){const{id3Track:s,hls:l}=this;if(!l)return;const{config:{enableEmsgMetadataCues:c,enableID3MetadataCues:u}}=l;if(s&&(c||u)){let f;o==="audio"?f=d=>d.type===MetadataSchema.audioId3&&u:o==="video"?f=d=>d.type===MetadataSchema.emsg&&c:f=d=>d.type===MetadataSchema.audioId3&&u||d.type===MetadataSchema.emsg&&c,removeCuesInRange(s,e,n,f)}}onLevelUpdated(r,{details:e}){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:n,id3Track:o}=this,{dateRanges:s}=e,l=Object.keys(s);if(o){const d=Object.keys(n).filter(g=>!l.includes(g));for(let g=d.length;g--;){const p=d[g];Object.keys(n[p].cues).forEach(v=>{o.removeCue(n[p].cues[v])}),delete n[p]}}const c=e.fragments[e.fragments.length-1];if(l.length===0||!isFiniteNumber(c==null?void 0:c.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const u=c.programDateTime/1e3-c.start,f=getCueClass();for(let d=0;d<l.length;d++){const g=l[d],p=s[g],v=dateRangeDateToTimelineSeconds(p.startDate,u),m=n[g],y=(m==null?void 0:m.cues)||{};let x=(m==null?void 0:m.durationKnown)||!1,_=MAX_CUE_ENDTIME;const E=p.endDate;if(E)_=dateRangeDateToTimelineSeconds(E,u),x=!0;else if(p.endOnNext&&!x){const A=l.reduce((T,b)=>{if(b!==p.id){const C=s[b];if(C.class===p.class&&C.startDate>p.startDate&&(!T||p.startDate<T.startDate))return C}return T},null);A&&(_=dateRangeDateToTimelineSeconds(A.startDate,u),x=!0)}const S=Object.keys(p.attr);for(let A=0;A<S.length;A++){const T=S[A];if(!isDateRangeCueAttribute(T))continue;const b=y[T];if(b)x&&!m.durationKnown&&(b.endTime=_);else if(f){let C=p.attr[T];isSCTE35Attribute(T)&&(C=hexToArrayBuffer(C));const L=createCueWithDataFields(f,v,_,{key:T,data:C},MetadataSchema.dateRange);L&&(L.id=g,this.id3Track.addCue(L),y[T]=L)}}n[g]={cues:y,dateRange:p,durationKnown:x}}}}class LatencyController{constructor(r){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=r,this.config=r.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:r,levelDetails:e}=this;return r.liveMaxLatencyDuration!==void 0?r.liveMaxLatencyDuration:e?r.liveMaxLatencyDurationCount*e.targetduration:0}get targetLatency(){const{levelDetails:r}=this;if(r===null)return null;const{holdBack:e,partHoldBack:n,targetduration:o}=r,{liveSyncDuration:s,liveSyncDurationCount:l,lowLatencyMode:c}=this.config,u=this.hls.userConfig;let f=c&&n||e;(u.liveSyncDuration||u.liveSyncDurationCount||f===0)&&(f=s!==void 0?s:l*o);const d=o,g=1;return f+Math.min(this.stallCount*g,d)}get liveSyncPosition(){const r=this.estimateLiveEdge(),e=this.targetLatency,n=this.levelDetails;if(r===null||e===null||n===null)return null;const o=n.edge,s=r-e-this.edgeStalled,l=o-n.totalduration,c=o-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(l,s),c)}get drift(){const{levelDetails:r}=this;return r===null?1:r.drift}get edgeStalled(){const{levelDetails:r}=this;if(r===null)return 0;const e=(this.config.lowLatencyMode&&r.partTarget||r.targetduration)*3;return Math.max(r.age-e,0)}get forwardBufferLength(){const{media:r,levelDetails:e}=this;if(!r||!e)return 0;const n=r.buffered.length;return(n?r.buffered.end(n-1):e.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Events.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Events.ERROR,this.onError,this)}onMediaAttached(r,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(r,{details:e}){this.levelDetails=e,e.advanced&&this.timeupdate(),!e.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(r,e){var n;e.details===ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,(n=this.levelDetails)!=null&&n.live&&logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:r,levelDetails:e}=this;if(!r||!e)return;this.currentTime=r.currentTime;const n=this.computeLatency();if(n===null)return;this._latency=n;const{lowLatencyMode:o,maxLiveSyncPlaybackRate:s}=this.config;if(!o||s===1||!e.live)return;const l=this.targetLatency;if(l===null)return;const c=n-l,u=Math.min(this.maxLatency,l+e.targetduration);if(c<u&&c>.05&&this.forwardBufferLength>1){const d=Math.min(2,Math.max(1,s)),g=Math.round(2/(1+Math.exp(-.75*c-this.edgeStalled))*20)/20;r.playbackRate=Math.min(d,Math.max(1,g))}else r.playbackRate!==1&&r.playbackRate!==0&&(r.playbackRate=1)}estimateLiveEdge(){const{levelDetails:r}=this;return r===null?null:r.edge+r.age}computeLatency(){const r=this.estimateLiveEdge();return r===null?null:r-this.currentTime}}const HdcpLevels=["NONE","TYPE-0","TYPE-1",null];function isHdcpLevel(a){return HdcpLevels.indexOf(a)>-1}const VideoRangeValues=["SDR","PQ","HLG"];function isVideoRange(a){return!!a&&VideoRangeValues.indexOf(a)>-1}var HlsSkip={No:"",Yes:"YES",v2:"v2"};function getSkipValue(a){const{canSkipUntil:r,canSkipDateRanges:e,age:n}=a,o=n<r/2;return r&&o?e?HlsSkip.v2:HlsSkip.Yes:HlsSkip.No}class HlsUrlParameters{constructor(r,e,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=r,this.part=e,this.skip=n}addDirectives(r){const e=new self.URL(r);return this.msn!==void 0&&e.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.href}}class Level{constructor(r){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[r.url],this._attrs=[r.attrs],this.bitrate=r.bitrate,r.details&&(this.details=r.details),this.id=r.id||0,this.name=r.name,this.width=r.width||0,this.height=r.height||0,this.frameRate=r.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=r.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=r.audioCodec,this.videoCodec=r.videoCodec,this.codecSet=[r.videoCodec,r.audioCodec].filter(e=>!!e).map(e=>e.substring(0,4)).join(","),this.addGroupId("audio",r.attrs.AUDIO),this.addGroupId("text",r.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(r){return hasGroup(this._audioGroups,r)}hasSubtitleGroup(r){return hasGroup(this._subtitleGroups,r)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(r,e){if(e){if(r==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(e)===-1&&n.push(e)}else if(r==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(e)===-1&&n.push(e)}}}get urlId(){return 0}set urlId(r){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var r;return(r=this.audioGroups)==null?void 0:r[0]}get textGroupId(){var r;return(r=this.subtitleGroups)==null?void 0:r[0]}addFallback(){}}function hasGroup(a,r){return!r||!a?!1:a.indexOf(r)!==-1}function updateFromToPTS(a,r){const e=r.startPTS;if(isFiniteNumber(e)){let n=0,o;r.sn>a.sn?(n=e-a.start,o=a):(n=a.start-e,o=r),o.duration!==n&&(o.duration=n)}else r.sn>a.sn?a.cc===r.cc&&a.minEndPTS?r.start=a.start+(a.minEndPTS-a.start):r.start=a.start+a.duration:r.start=Math.max(a.start-r.duration,0)}function updateFragPTSDTS(a,r,e,n,o,s){n-e<=0&&(logger.warn("Fragment should have a positive duration",r),n=e+r.duration,s=o+r.duration);let c=e,u=n;const f=r.startPTS,d=r.endPTS;if(isFiniteNumber(f)){const x=Math.abs(f-e);isFiniteNumber(r.deltaPTS)?r.deltaPTS=Math.max(x,r.deltaPTS):r.deltaPTS=x,c=Math.max(e,f),e=Math.min(e,f),o=Math.min(o,r.startDTS),u=Math.min(n,d),n=Math.max(n,d),s=Math.max(s,r.endDTS)}const g=e-r.start;r.start!==0&&(r.start=e),r.duration=n-r.start,r.startPTS=e,r.maxStartPTS=c,r.startDTS=o,r.endPTS=n,r.minEndPTS=u,r.endDTS=s;const p=r.sn;if(!a||p<a.startSN||p>a.endSN)return 0;let v;const m=p-a.startSN,y=a.fragments;for(y[m]=r,v=m;v>0;v--)updateFromToPTS(y[v],y[v-1]);for(v=m;v<y.length-1;v++)updateFromToPTS(y[v],y[v+1]);return a.fragmentHint&&updateFromToPTS(y[y.length-1],a.fragmentHint),a.PTSKnown=a.alignedSliding=!0,g}function mergeDetails(a,r){let e=null;const n=a.fragments;for(let u=n.length-1;u>=0;u--){const f=n[u].initSegment;if(f){e=f;break}}a.fragmentHint&&delete a.fragmentHint.endPTS;let o=0,s;if(mapFragmentIntersection(a,r,(u,f)=>{u.relurl&&(o=u.cc-f.cc),isFiniteNumber(u.startPTS)&&isFiniteNumber(u.endPTS)&&(f.start=f.startPTS=u.startPTS,f.startDTS=u.startDTS,f.maxStartPTS=u.maxStartPTS,f.endPTS=u.endPTS,f.endDTS=u.endDTS,f.minEndPTS=u.minEndPTS,f.duration=u.endPTS-u.startPTS,f.duration&&(s=f),r.PTSKnown=r.alignedSliding=!0),f.elementaryStreams=u.elementaryStreams,f.loader=u.loader,f.stats=u.stats,u.initSegment&&(f.initSegment=u.initSegment,e=u.initSegment)}),e&&(r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments).forEach(f=>{var d;f&&(!f.initSegment||f.initSegment.relurl===((d=e)==null?void 0:d.relurl))&&(f.initSegment=e)}),r.skippedSegments)if(r.deltaUpdateFailed=r.fragments.some(u=>!u),r.deltaUpdateFailed){logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=r.skippedSegments;u--;)r.fragments.shift();r.startSN=r.fragments[0].sn,r.startCC=r.fragments[0].cc}else r.canSkipDateRanges&&(r.dateRanges=mergeDateRanges(a.dateRanges,r.dateRanges,r.recentlyRemovedDateranges));const l=r.fragments;if(o){logger.warn("discontinuity sliding from playlist, take drift into account");for(let u=0;u<l.length;u++)l[u].cc+=o}r.skippedSegments&&(r.startCC=r.fragments[0].cc),mapPartIntersection(a.partList,r.partList,(u,f)=>{f.elementaryStreams=u.elementaryStreams,f.stats=u.stats}),s?updateFragPTSDTS(r,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):adjustSliding(a,r),l.length&&(r.totalduration=r.edge-l[0].start),r.driftStartTime=a.driftStartTime,r.driftStart=a.driftStart;const c=r.advancedDateTime;if(r.advanced&&c){const u=r.edge;r.driftStart||(r.driftStartTime=c,r.driftStart=u),r.driftEndTime=c,r.driftEnd=u}else r.driftEndTime=a.driftEndTime,r.driftEnd=a.driftEnd,r.advancedDateTime=a.advancedDateTime}function mergeDateRanges(a,r,e){const n=_extends({},a);return e&&e.forEach(o=>{delete n[o]}),Object.keys(r).forEach(o=>{const s=new DateRange(r[o].attr,n[o]);s.isValid?n[o]=s:logger.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(r[o].attr)}"`)}),n}function mapPartIntersection(a,r,e){if(a&&r){let n=0;for(let o=0,s=a.length;o<=s;o++){const l=a[o],c=r[o+n];l&&c&&l.index===c.index&&l.fragment.sn===c.fragment.sn?e(l,c):n--}}}function mapFragmentIntersection(a,r,e){const n=r.skippedSegments,o=Math.max(a.startSN,r.startSN)-r.startSN,s=(a.fragmentHint?1:0)+(n?r.endSN:Math.min(a.endSN,r.endSN))-r.startSN,l=r.startSN-a.startSN,c=r.fragmentHint?r.fragments.concat(r.fragmentHint):r.fragments,u=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments;for(let f=o;f<=s;f++){const d=u[l+f];let g=c[f];n&&!g&&f<n&&(g=r.fragments[f]=d),d&&g&&e(d,g)}}function adjustSliding(a,r){const e=r.startSN+r.skippedSegments-a.startSN,n=a.fragments;e<0||e>=n.length||addSliding(r,n[e].start)}function addSliding(a,r){if(r){const e=a.fragments;for(let n=a.skippedSegments;n<e.length;n++)e[n].start+=r;a.fragmentHint&&(a.fragmentHint.start+=r)}}function computeReloadInterval(a,r=1/0){let e=1e3*a.targetduration;if(a.updated){const n=a.fragments,o=4;if(n.length&&e*o>r){const s=n[n.length-1].duration*1e3;s<e&&(e=s)}}else e/=2;return Math.round(e)}function getFragmentWithSN(a,r,e){if(!(a!=null&&a.details))return null;const n=a.details;let o=n.fragments[r-n.startSN];return o||(o=n.fragmentHint,o&&o.sn===r)?o:r<n.startSN&&e&&e.sn===r?e:null}function getPartWith(a,r,e){var n;return a!=null&&a.details?findPart((n=a.details)==null?void 0:n.partList,r,e):null}function findPart(a,r,e){if(a)for(let n=a.length;n--;){const o=a[n];if(o.index===e&&o.fragment.sn===r)return o}return null}function reassignFragmentLevelIndexes(a){a.forEach((r,e)=>{const{details:n}=r;n!=null&&n.fragments&&n.fragments.forEach(o=>{o.level=e})})}function isTimeoutError(a){switch(a.details){case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_TIMEOUT:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function getRetryConfig(a,r){const e=isTimeoutError(r);return a.default[`${e?"timeout":"error"}Retry`]}function getRetryDelay(a,r){const e=a.backoff==="linear"?1:Math.pow(2,r);return Math.min(e*a.retryDelayMs,a.maxRetryDelayMs)}function getLoaderConfigWithoutReties(a){return _objectSpread2(_objectSpread2({},a),{errorRetry:null,timeoutRetry:null})}function shouldRetry(a,r,e,n){if(!a)return!1;const o=n==null?void 0:n.code,s=r<a.maxNumRetry&&(retryForHttpStatus(o)||!!e);return a.shouldRetry?a.shouldRetry(a,r,e,n,s):s}function retryForHttpStatus(a){return a===0&&navigator.onLine===!1||!!a&&(a<400||a>499)}const BinarySearch={search:function(a,r){let e=0,n=a.length-1,o=null,s=null;for(;e<=n;){o=(e+n)/2|0,s=a[o];const l=r(s);if(l>0)e=o+1;else if(l<0)n=o-1;else return s}return null}};function findFragmentByPDT(a,r,e){if(r===null||!Array.isArray(a)||!a.length||!isFiniteNumber(r))return null;const n=a[0].programDateTime;if(r<(n||0))return null;const o=a[a.length-1].endProgramDateTime;if(r>=(o||0))return null;e=e||0;for(let s=0;s<a.length;++s){const l=a[s];if(pdtWithinToleranceTest(r,e,l))return l}return null}function findFragmentByPTS(a,r,e=0,n=0,o=.005){let s=null;if(a){s=r[a.sn-r[0].sn+1]||null;const c=a.endDTS-e;c>0&&c<15e-7&&(e+=15e-7)}else e===0&&r[0].start===0&&(s=r[0]);if(s&&((!a||a.level===s.level)&&fragmentWithinToleranceTest(e,n,s)===0||fragmentWithinFastStartSwitch(s,a,Math.min(o,n))))return s;const l=BinarySearch.search(r,fragmentWithinToleranceTest.bind(null,e,n));return l&&(l!==a||!s)?l:s}function fragmentWithinFastStartSwitch(a,r,e){if(r&&r.start===0&&r.level<a.level&&(r.endPTS||0)>0){const n=r.tagList.reduce((o,s)=>(s[0]==="INF"&&(o+=parseFloat(s[1])),o),e);return a.start<=n}return!1}function fragmentWithinToleranceTest(a=0,r=0,e){if(e.start<=a&&e.start+e.duration>a)return 0;const n=Math.min(r,e.duration+(e.deltaPTS?e.deltaPTS:0));return e.start+e.duration-n<=a?1:e.start-n>a&&e.start?-1:0}function pdtWithinToleranceTest(a,r,e){const n=Math.min(r,e.duration+(e.deltaPTS?e.deltaPTS:0))*1e3;return(e.endProgramDateTime||0)-n>a}function findFragWithCC(a,r){return BinarySearch.search(a,e=>e.cc<r?1:e.cc>r?-1:0)}var NetworkErrorAction={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ErrorActionFlags={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class ErrorController{constructor(r){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=r,this.log=logger.log.bind(logger,"[info]:"),this.warn=logger.warn.bind(logger,"[warning]:"),this.error=logger.error.bind(logger,"[error]:"),this.registerListeners()}registerListeners(){const r=this.hls;r.on(Events.ERROR,this.onError,this),r.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const r=this.hls;r&&(r.off(Events.ERROR,this.onError,this),r.off(Events.ERROR,this.onErrorOut,this),r.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(r){}stopLoad(){this.playlistError=0}getVariantLevelIndex(r){return(r==null?void 0:r.type)===PlaylistLevelType.MAIN?r.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(r,e){var n,o;if(e.fatal)return;const s=this.hls,l=e.context;switch(e.details){case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:e.errorAction=this.getFragRetryOrSwitchAction(e);return;case ErrorDetails.FRAG_PARSING_ERROR:if((n=e.frag)!=null&&n.gap){e.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_DECRYPT_ERROR:{e.errorAction=this.getFragRetryOrSwitchAction(e),e.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox;return}case ErrorDetails.LEVEL_EMPTY_ERROR:case ErrorDetails.LEVEL_PARSING_ERROR:{var c,u;const f=e.parent===PlaylistLevelType.MAIN?e.level:s.loadLevel;e.details===ErrorDetails.LEVEL_EMPTY_ERROR&&((c=e.context)!=null&&(u=c.levelDetails)!=null&&u.live)?e.errorAction=this.getPlaylistRetryOrSwitchAction(e,f):(e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,f))}return;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:typeof(l==null?void 0:l.level)=="number"&&(e.errorAction=this.getPlaylistRetryOrSwitchAction(e,l.level));return;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.SUBTITLE_LOAD_ERROR:case ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:if(l){const f=s.levels[s.loadLevel];if(f&&(l.type===PlaylistContextType.AUDIO_TRACK&&f.hasAudioGroup(l.groupId)||l.type===PlaylistContextType.SUBTITLE_TRACK&&f.hasSubtitleGroup(l.groupId))){e.errorAction=this.getPlaylistRetryOrSwitchAction(e,s.loadLevel),e.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox,e.errorAction.flags=ErrorActionFlags.MoveAllAlternatesMatchingHost;return}}return;case ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const f=s.levels[s.loadLevel],d=f==null?void 0:f.attrs["HDCP-LEVEL"];d?e.errorAction={action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHDCP,hdcpLevel:d}:this.keySystemError(e)}return;case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.REMUX_ALLOC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:e.errorAction=this.getLevelSwitchAction(e,(o=e.level)!=null?o:s.loadLevel);return;case ErrorDetails.INTERNAL_EXCEPTION:case ErrorDetails.BUFFER_APPENDING_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:case ErrorDetails.LEVEL_SWITCH_ERROR:case ErrorDetails.BUFFER_STALLED_ERROR:case ErrorDetails.BUFFER_SEEK_OVER_HOLE:case ErrorDetails.BUFFER_NUDGE_ON_STALL:e.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}e.type===ErrorTypes.KEY_SYSTEM_ERROR&&this.keySystemError(e)}keySystemError(r){const e=this.getVariantLevelIndex(r.frag);r.levelRetry=!1,r.errorAction=this.getLevelSwitchAction(r,e)}getPlaylistRetryOrSwitchAction(r,e){const n=this.hls,o=getRetryConfig(n.config.playlistLoadPolicy,r),s=this.playlistError++;if(shouldRetry(o,s,isTimeoutError(r),r.response))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:o,retryCount:s};const c=this.getLevelSwitchAction(r,e);return o&&(c.retryConfig=o,c.retryCount=s),c}getFragRetryOrSwitchAction(r){const e=this.hls,n=this.getVariantLevelIndex(r.frag),o=e.levels[n],{fragLoadPolicy:s,keyLoadPolicy:l}=e.config,c=getRetryConfig(r.details.startsWith("key")?l:s,r),u=e.levels.reduce((d,g)=>d+g.fragmentError,0);if(o&&(r.details!==ErrorDetails.FRAG_GAP&&o.fragmentError++,shouldRetry(c,u,isTimeoutError(r),r.response)))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:c,retryCount:u};const f=this.getLevelSwitchAction(r,n);return c&&(f.retryConfig=c,f.retryCount=u),f}getLevelSwitchAction(r,e){const n=this.hls;e==null&&(e=n.loadLevel);const o=this.hls.levels[e];if(o){var s,l;const f=r.details;o.loadError++,f===ErrorDetails.BUFFER_APPEND_ERROR&&o.fragmentError++;let d=-1;const{levels:g,loadLevel:p,minAutoLevel:v,maxAutoLevel:m}=n;n.autoLevelEnabled||(n.loadLevel=-1);const y=(s=r.frag)==null?void 0:s.type,_=(y===PlaylistLevelType.AUDIO&&f===ErrorDetails.FRAG_PARSING_ERROR||r.sourceBufferName==="audio"&&(f===ErrorDetails.BUFFER_ADD_CODEC_ERROR||f===ErrorDetails.BUFFER_APPEND_ERROR))&&g.some(({audioCodec:b})=>o.audioCodec!==b),S=r.sourceBufferName==="video"&&(f===ErrorDetails.BUFFER_ADD_CODEC_ERROR||f===ErrorDetails.BUFFER_APPEND_ERROR)&&g.some(({codecSet:b,audioCodec:C})=>o.codecSet!==b&&o.audioCodec===C),{type:A,groupId:T}=(l=r.context)!=null?l:{};for(let b=g.length;b--;){const C=(b+p)%g.length;if(C!==p&&C>=v&&C<=m&&g[C].loadError===0){var c,u;const L=g[C];if(f===ErrorDetails.FRAG_GAP&&y===PlaylistLevelType.MAIN&&r.frag){const R=g[C].details;if(R){const I=findFragmentByPTS(r.frag,R.fragments,r.frag.start);if(I!=null&&I.gap)continue}}else{if(A===PlaylistContextType.AUDIO_TRACK&&L.hasAudioGroup(T)||A===PlaylistContextType.SUBTITLE_TRACK&&L.hasSubtitleGroup(T))continue;if(y===PlaylistLevelType.AUDIO&&(c=o.audioGroups)!=null&&c.some(R=>L.hasAudioGroup(R))||y===PlaylistLevelType.SUBTITLE&&(u=o.subtitleGroups)!=null&&u.some(R=>L.hasSubtitleGroup(R))||_&&o.audioCodec===L.audioCodec||!_&&o.audioCodec!==L.audioCodec||S&&o.codecSet===L.codecSet)continue}d=C;break}}if(d>-1&&n.loadLevel!==d)return r.levelRetry=!0,this.playlistError=0,{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.None,nextAutoLevel:d}}return{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHost}}onErrorOut(r,e){var n;switch((n=e.errorAction)==null?void 0:n.action){case NetworkErrorAction.DoNothing:break;case NetworkErrorAction.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(e),!e.errorAction.resolved&&e.details!==ErrorDetails.FRAG_GAP?e.fatal=!0:/MediaSource readyState: ended/.test(e.error.message)&&(this.warn(`MediaSource ended after "${e.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(e.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(r){const e=this.hls,n=r.errorAction;if(!n)return;const{flags:o,hdcpLevel:s,nextAutoLevel:l}=n;switch(o){case ErrorActionFlags.None:this.switchLevel(r,l);break;case ErrorActionFlags.MoveAllAlternatesMatchingHDCP:s&&(e.maxHdcpLevel=HdcpLevels[HdcpLevels.indexOf(s)-1],n.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${e.maxHdcpLevel}" or lower`);break}n.resolved||this.switchLevel(r,l)}switchLevel(r,e){e!==void 0&&r.errorAction&&(this.warn(`switching to level ${e} after ${r.details}`),this.hls.nextAutoLevel=e,r.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class BasePlaylistController{constructor(r,e){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=logger.log.bind(logger,`${e}:`),this.warn=logger.warn.bind(logger,`${e}:`),this.hls=r}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(r,e,n){const o=e==null?void 0:e.renditionReports;if(o){let s=-1;for(let l=0;l<o.length;l++){const c=o[l];let u;try{u=new self.URL(c.URI,e.url).href}catch(f){logger.warn(`Could not construct new URL for Rendition Report: ${f}`),u=c.URI||""}if(u===r){s=l;break}else u===r.substring(0,u.length)&&(s=l)}if(s!==-1){const l=o[s],c=parseInt(l["LAST-MSN"])||(e==null?void 0:e.lastPartSn);let u=parseInt(l["LAST-PART"])||(e==null?void 0:e.lastPartIndex);if(this.hls.config.lowLatencyMode){const d=Math.min(e.age-e.partTarget,e.targetduration);u>=0&&d>e.partTarget&&(u+=1)}const f=n&&getSkipValue(n);return new HlsUrlParameters(c,u>=0?u:void 0,f)}}}loadPlaylist(r){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(r){return this.canLoad&&!!r&&!!r.url&&(!r.details||r.details.live)}shouldReloadPlaylist(r){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(r)}playlistLoaded(r,e,n){const{details:o,stats:s}=e,l=self.performance.now(),c=s.loading.first?Math.max(0,l-s.loading.first):0;if(o.advancedDateTime=Date.now()-c,o.live||n!=null&&n.live){if(o.reloaded(n),n&&this.log(`live playlist ${r} ${o.advanced?"REFRESHED "+o.lastPartSn+"-"+o.lastPartIndex:o.updated?"UPDATED":"MISSED"}`),n&&o.fragments.length>0&&mergeDetails(n,o),!this.canLoad||!o.live)return;let u,f,d;if(o.canBlockReload&&o.endSN&&o.advanced){const x=this.hls.config.lowLatencyMode,_=o.lastPartSn,E=o.endSN,S=o.lastPartIndex,A=S!==-1,T=_===E,b=x?0:S;A?(f=T?E+1:_,d=T?b:S+1):f=E+1;const C=o.age,L=C+o.ageHeader;let R=Math.min(L-o.partTarget,o.targetduration*1.5);if(R>0){if(n&&R>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${R} with playlist age: ${o.age}`),R=0;else{const I=Math.floor(R/o.targetduration);if(f+=I,d!==void 0){const w=Math.round(R%o.targetduration/o.partTarget);d+=w}this.log(`CDN Tune-in age: ${o.ageHeader}s last advanced ${C.toFixed(2)}s goal: ${R} skip sn ${I} to part ${d}`)}o.tuneInGoal=R}if(u=this.getDeliveryDirectives(o,e.deliveryDirectives,f,d),x||!T){this.loadPlaylist(u);return}}else(o.canBlockReload||o.canSkipUntil)&&(u=this.getDeliveryDirectives(o,e.deliveryDirectives,f,d));const g=this.hls.mainForwardBufferInfo,p=g?g.end-g.len:0,v=(o.edge-p)*1e3,m=computeReloadInterval(o,v);o.updated&&l>this.requestScheduled+m&&(this.requestScheduled=s.loading.start),f!==void 0&&o.canBlockReload?this.requestScheduled=s.loading.first+m-(o.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+m<l?this.requestScheduled=l:this.requestScheduled-l<=0&&(this.requestScheduled+=m);let y=this.requestScheduled-l;y=Math.max(0,y),this.log(`reload live playlist ${r} in ${Math.round(y)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(u),y)}else this.clearTimer()}getDeliveryDirectives(r,e,n,o){let s=getSkipValue(r);return e!=null&&e.skip&&r.deltaUpdateFailed&&(n=e.msn,o=e.part,s=HlsSkip.No),new HlsUrlParameters(n,o,s)}checkRetry(r){const e=r.details,n=isTimeoutError(r),o=r.errorAction,{action:s,retryCount:l=0,retryConfig:c}=o||{},u=!!o&&!!c&&(s===NetworkErrorAction.RetryRequest||!o.resolved&&s===NetworkErrorAction.SendAlternateToPenaltyBox);if(u){var f;if(this.requestScheduled=-1,l>=c.maxNumRetry)return!1;if(n&&(f=r.context)!=null&&f.deliveryDirectives)this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${e}" without delivery-directives`),this.loadPlaylist();else{const d=getRetryDelay(c,l);this.timer=self.setTimeout(()=>this.loadPlaylist(),d),this.warn(`Retrying playlist loading ${l+1}/${c.maxNumRetry} after "${e}" in ${d}ms`)}r.levelRetry=!0,o.resolved=!0}return u}}class EWMA{constructor(r,e=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=r,this.alpha_=r?Math.exp(Math.log(.5)/r):0,this.estimate_=e,this.totalWeight_=n}sample(r,e){const n=Math.pow(this.alpha_,r);this.estimate_=e*(1-n)+n*this.estimate_,this.totalWeight_+=r}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const r=1-Math.pow(this.alpha_,this.totalWeight_);if(r)return this.estimate_/r}return this.estimate_}}class EwmaBandWidthEstimator{constructor(r,e,n,o=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new EWMA(r),this.fast_=new EWMA(e),this.defaultTTFB_=o,this.ttfb_=new EWMA(r)}update(r,e){const{slow_:n,fast_:o,ttfb_:s}=this;n.halfLife!==r&&(this.slow_=new EWMA(r,n.getEstimate(),n.getTotalWeight())),o.halfLife!==e&&(this.fast_=new EWMA(e,o.getEstimate(),o.getTotalWeight())),s.halfLife!==r&&(this.ttfb_=new EWMA(r,s.getEstimate(),s.getTotalWeight()))}sample(r,e){r=Math.max(r,this.minDelayMs_);const n=8*e,o=r/1e3,s=n/o;this.fast_.sample(o,s),this.slow_.sample(o,s)}sampleTTFB(r){const e=r/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(e,2)/2);this.ttfb_.sample(n,Math.max(r,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const SUPPORTED_INFO_DEFAULT={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},SUPPORTED_INFO_CACHE={};function requiresMediaCapabilitiesDecodingInfo(a,r,e,n,o,s){const l=a.audioCodec?a.audioGroups:null,c=s==null?void 0:s.audioCodec,u=s==null?void 0:s.channels,f=u?parseInt(u):c?1/0:2;let d=null;if(l!=null&&l.length)try{l.length===1&&l[0]?d=r.groups[l[0]].channels:d=l.reduce((g,p)=>{if(p){const v=r.groups[p];if(!v)throw new Error(`Audio track group ${p} not found`);Object.keys(v.channels).forEach(m=>{g[m]=(g[m]||0)+v.channels[m]})}return g},{2:0})}catch{return!0}return a.videoCodec!==void 0&&(a.width>1920&&a.height>1088||a.height>1920&&a.width>1088||a.frameRate>Math.max(n,30)||a.videoRange!=="SDR"&&a.videoRange!==e||a.bitrate>Math.max(o,8e6))||!!d&&isFiniteNumber(f)&&Object.keys(d).some(g=>parseInt(g)>f)}function getMediaDecodingInfoPromise(a,r,e){const n=a.videoCodec,o=a.audioCodec;if(!n||!o||!e)return Promise.resolve(SUPPORTED_INFO_DEFAULT);const s={width:a.width,height:a.height,bitrate:Math.ceil(Math.max(a.bitrate*.9,a.averageBitrate)),framerate:a.frameRate||30},l=a.videoRange;l!=="SDR"&&(s.transferFunction=l.toLowerCase());const c=n.split(",").map(u=>({type:"media-source",video:_objectSpread2(_objectSpread2({},s),{},{contentType:mimeTypeForCodec(u,"video")})}));return o&&a.audioGroups&&a.audioGroups.forEach(u=>{var f;u&&((f=r.groups[u])==null||f.tracks.forEach(d=>{if(d.groupId===u){const g=d.channels||"",p=parseFloat(g);isFiniteNumber(p)&&p>2&&c.push.apply(c,o.split(",").map(v=>({type:"media-source",audio:{contentType:mimeTypeForCodec(v,"audio"),channels:""+p}})))}}))}),Promise.all(c.map(u=>{const f=getMediaDecodingInfoKey(u);return SUPPORTED_INFO_CACHE[f]||(SUPPORTED_INFO_CACHE[f]=e.decodingInfo(u))})).then(u=>({supported:!u.some(f=>!f.supported),configurations:c,decodingInfoResults:u})).catch(u=>({supported:!1,configurations:c,decodingInfoResults:[],error:u}))}function getMediaDecodingInfoKey(a){const{audio:r,video:e}=a,n=e||r;if(n){const o=n.contentType.split('"')[1];if(e)return`r${e.height}x${e.width}f${Math.ceil(e.framerate)}${e.transferFunction||"sd"}_${o}_${Math.ceil(e.bitrate/1e5)}`;if(r)return`c${r.channels}${r.spatialRendering?"s":"n"}_${o}`}return""}function isHdrSupported(){if(typeof matchMedia=="function"){const a=matchMedia("(dynamic-range: high)"),r=matchMedia("bad query");if(a.media!==r.media)return a.matches===!0}return!1}function getVideoSelectionOptions(a,r){let e=!1,n=[];return a&&(e=a!=="SDR",n=[a]),r&&(n=r.allowedVideoRanges||VideoRangeValues.slice(0),e=r.preferHDR!==void 0?r.preferHDR:isHdrSupported(),e?n=n.filter(o=>o!=="SDR"):n=["SDR"]),{preferHDR:e,allowedVideoRanges:n}}function getStartCodecTier(a,r,e,n,o){const s=Object.keys(a),l=n==null?void 0:n.channels,c=n==null?void 0:n.audioCodec,u=l&&parseInt(l)===2;let f=!0,d=!1,g=1/0,p=1/0,v=1/0,m=0,y=[];const{preferHDR:x,allowedVideoRanges:_}=getVideoSelectionOptions(r,o);for(let T=s.length;T--;){const b=a[s[T]];f=b.channels[2]>0,g=Math.min(g,b.minHeight),p=Math.min(p,b.minFramerate),v=Math.min(v,b.minBitrate);const C=_.filter(L=>b.videoRanges[L]>0);C.length>0&&(d=!0,y=C)}g=isFiniteNumber(g)?g:0,p=isFiniteNumber(p)?p:0;const E=Math.max(1080,g),S=Math.max(30,p);return v=isFiniteNumber(v)?v:e,e=Math.max(v,e),d||(r=void 0,y=[]),{codecSet:s.reduce((T,b)=>{const C=a[b];if(b===T)return T;if(C.minBitrate>e)return logStartCodecCandidateIgnored(b,`min bitrate of ${C.minBitrate} > current estimate of ${e}`),T;if(!C.hasDefaultAudio)return logStartCodecCandidateIgnored(b,"no renditions with default or auto-select sound found"),T;if(c&&b.indexOf(c.substring(0,4))%5!==0)return logStartCodecCandidateIgnored(b,`audio codec preference "${c}" not found`),T;if(l&&!u){if(!C.channels[l])return logStartCodecCandidateIgnored(b,`no renditions with ${l} channel sound found (channels options: ${Object.keys(C.channels)})`),T}else if((!c||u)&&f&&C.channels[2]===0)return logStartCodecCandidateIgnored(b,"no renditions with stereo sound found"),T;return C.minHeight>E?(logStartCodecCandidateIgnored(b,`min resolution of ${C.minHeight} > maximum of ${E}`),T):C.minFramerate>S?(logStartCodecCandidateIgnored(b,`min framerate of ${C.minFramerate} > maximum of ${S}`),T):y.some(L=>C.videoRanges[L]>0)?C.maxScore<m?(logStartCodecCandidateIgnored(b,`max score of ${C.maxScore} < selected max of ${m}`),T):T&&(codecsSetSelectionPreferenceValue(b)>=codecsSetSelectionPreferenceValue(T)||C.fragmentError>a[T].fragmentError)?T:(m=C.maxScore,b):(logStartCodecCandidateIgnored(b,`no variants with VIDEO-RANGE of ${JSON.stringify(y)} found`),T)},void 0),videoRanges:y,preferHDR:x,minFramerate:p,minBitrate:v}}function logStartCodecCandidateIgnored(a,r){logger.log(`[abr] start candidates with "${a}" ignored because ${r}`)}function getAudioTracksByGroup(a){return a.reduce((r,e)=>{let n=r.groups[e.groupId];n||(n=r.groups[e.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(e);const o=e.channels||"2";return n.channels[o]=(n.channels[o]||0)+1,n.hasDefault=n.hasDefault||e.default,n.hasAutoSelect=n.hasAutoSelect||e.autoselect,n.hasDefault&&(r.hasDefaultAudio=!0),n.hasAutoSelect&&(r.hasAutoSelectAudio=!0),r},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function getCodecTiers(a,r,e,n){return a.slice(e,n+1).reduce((o,s)=>{if(!s.codecSet)return o;const l=s.audioGroups;let c=o[s.codecSet];c||(o[s.codecSet]=c={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!l,fragmentError:0}),c.minBitrate=Math.min(c.minBitrate,s.bitrate);const u=Math.min(s.height,s.width);return c.minHeight=Math.min(c.minHeight,u),c.minFramerate=Math.min(c.minFramerate,s.frameRate),c.maxScore=Math.max(c.maxScore,s.score),c.fragmentError+=s.fragmentError,c.videoRanges[s.videoRange]=(c.videoRanges[s.videoRange]||0)+1,l&&l.forEach(f=>{if(!f)return;const d=r.groups[f];d&&(c.hasDefaultAudio=c.hasDefaultAudio||r.hasDefaultAudio?d.hasDefault:d.hasAutoSelect||!r.hasDefaultAudio&&!r.hasAutoSelectAudio,Object.keys(d.channels).forEach(g=>{c.channels[g]=(c.channels[g]||0)+d.channels[g]}))}),o},{})}function findMatchingOption(a,r,e){if("attrs"in a){const n=r.indexOf(a);if(n!==-1)return n}for(let n=0;n<r.length;n++){const o=r[n];if(matchesOption(a,o,e))return n}return-1}function matchesOption(a,r,e){const{groupId:n,name:o,lang:s,assocLang:l,characteristics:c,default:u}=a,f=a.forced;return(n===void 0||r.groupId===n)&&(o===void 0||r.name===o)&&(s===void 0||r.lang===s)&&(s===void 0||r.assocLang===l)&&(u===void 0||r.default===u)&&(f===void 0||r.forced===f)&&(c===void 0||characteristicsMatch(c,r.characteristics))&&(e===void 0||e(a,r))}function characteristicsMatch(a,r=""){const e=a.split(","),n=r.split(",");return e.length===n.length&&!e.some(o=>n.indexOf(o)===-1)}function audioMatchPredicate(a,r){const{audioCodec:e,channels:n}=a;return(e===void 0||(r.audioCodec||"").substring(0,4)===e.substring(0,4))&&(n===void 0||n===(r.channels||"2"))}function findClosestLevelWithAudioGroup(a,r,e,n,o){const s=r[n],c=r.reduce((p,v,m)=>{const y=v.uri;return(p[y]||(p[y]=[])).push(m),p},{})[s.uri];c.length>1&&(n=Math.max.apply(Math,c));const u=s.videoRange,f=s.frameRate,d=s.codecSet.substring(0,4),g=searchDownAndUpList(r,n,p=>{if(p.videoRange!==u||p.frameRate!==f||p.codecSet.substring(0,4)!==d)return!1;const v=p.audioGroups,m=e.filter(y=>!v||v.indexOf(y.groupId)!==-1);return findMatchingOption(a,m,o)>-1});return g>-1?g:searchDownAndUpList(r,n,p=>{const v=p.audioGroups,m=e.filter(y=>!v||v.indexOf(y.groupId)!==-1);return findMatchingOption(a,m,o)>-1})}function searchDownAndUpList(a,r,e){for(let n=r;n;n--)if(e(a[n]))return n;for(let n=r+1;n<a.length;n++)if(e(a[n]))return n;return-1}class AbrController{constructor(r){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:e,partCurrent:n,hls:o}=this,{autoLevelEnabled:s,media:l}=o;if(!e||!l)return;const c=performance.now(),u=n?n.stats:e.stats,f=n?n.duration:e.duration,d=c-u.loading.start,g=o.minAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||e.level<=g){this.clearTimer(),this._nextAutoLevel=-1;return}if(!s||l.paused||!l.playbackRate||!l.readyState)return;const p=o.mainForwardBufferInfo;if(p===null)return;const v=this.bwEstimator.getEstimateTTFB(),m=Math.abs(l.playbackRate);if(d<=Math.max(v,1e3*(f/(m*2))))return;const y=p.len/m,x=u.loading.first?u.loading.first-u.loading.start:-1,_=u.loaded&&x>-1,E=this.getBwEstimate(),S=o.levels,A=S[e.level],T=u.total||Math.max(u.loaded,Math.round(f*A.averageBitrate/8));let b=_?d-x:d;b<1&&_&&(b=Math.min(d,u.loaded*8/E));const C=_?u.loaded*1e3/b:0,L=C?(T-u.loaded)/C:T*8/E+v/1e3;if(L<=y)return;const R=C?C*8:E;let I=Number.POSITIVE_INFINITY,w;for(w=e.level-1;w>g;w--){const D=S[w].maxBitrate;if(I=this.getTimeToLoadFrag(v/1e3,R,f*D,!S[w].details),I<y)break}if(I>=L||I>f*10)return;o.nextLoadLevel=o.nextAutoLevel=w,_?this.bwEstimator.sample(d-Math.min(v,x),u.loaded):this.bwEstimator.sampleTTFB(d);const M=S[w].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>M&&this.resetEstimator(M),this.clearTimer(),logger.warn(`[abr] Fragment ${e.sn}${n?" part "+n.index:""} of level ${e.level} is loading too slowly;
      Time to underbuffer: ${y.toFixed(3)} s
      Estimated load time for current fragment: ${L.toFixed(3)} s
      Estimated load time for down switch fragment: ${I.toFixed(3)} s
      TTFB estimate: ${x|0} ms
      Current BW estimate: ${isFiniteNumber(E)?E|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${w} @ ${M|0} bps`),o.trigger(Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:n,stats:u})},this.hls=r,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(r){r&&(logger.log(`setting initial bwe to ${r}`),this.hls.config.abrEwmaDefaultEstimate=r),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const r=this.hls.config;return new EwmaBandWidthEstimator(r.abrEwmaSlowVoD,r.abrEwmaFastVoD,r.abrEwmaDefaultEstimate)}registerListeners(){const{hls:r}=this;r.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(Events.FRAG_LOADING,this.onFragLoading,this),r.on(Events.FRAG_LOADED,this.onFragLoaded,this),r.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),r.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),r.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:r}=this;r&&(r.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(Events.FRAG_LOADING,this.onFragLoading,this),r.off(Events.FRAG_LOADED,this.onFragLoaded,this),r.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),r.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),r.off(Events.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(r,e){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(r,e){const n=e.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var o;this.fragCurrent=n,this.partCurrent=(o=e.part)!=null?o:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(r,e){this.clearTimer()}onError(r,e){if(!e.fatal)switch(e.details){case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case ErrorDetails.FRAG_LOAD_TIMEOUT:{const n=e.frag,{fragCurrent:o,partCurrent:s}=this;if(n&&o&&n.sn===o.sn&&n.level===o.level){const l=performance.now(),c=s?s.stats:n.stats,u=l-c.loading.start,f=c.loading.first?c.loading.first-c.loading.start:-1;if(c.loaded&&f>-1){const g=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(u-Math.min(g,f),c.loaded)}else this.bwEstimator.sampleTTFB(u)}break}}}getTimeToLoadFrag(r,e,n,o){const s=r+n/e,l=o?this.lastLevelLoadSec:0;return s+l}onLevelLoaded(r,e){const n=this.hls.config,{loading:o}=e.stats,s=o.end-o.start;isFiniteNumber(s)&&(this.lastLevelLoadSec=s/1e3),e.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)}onFragLoaded(r,{frag:e,part:n}){const o=n?n.stats:e.stats;if(e.type===PlaylistLevelType.MAIN&&this.bwEstimator.sampleTTFB(o.loading.first-o.loading.start),!this.ignoreFragment(e)){if(this.clearTimer(),e.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const s=n?n.duration:e.duration,l=this.hls.levels[e.level],c=(l.loaded?l.loaded.bytes:0)+o.loaded,u=(l.loaded?l.loaded.duration:0)+s;l.loaded={bytes:c,duration:u},l.realBitrate=Math.round(8*c/u)}if(e.bitrateTest){const s={stats:o,frag:e,part:n,id:e.type};this.onFragBuffered(Events.FRAG_BUFFERED,s),e.bitrateTest=!1}else this.lastLoadedFragLevel=e.level}}onFragBuffered(r,e){const{frag:n,part:o}=e,s=o!=null&&o.stats.loaded?o.stats:n.stats;if(s.aborted||this.ignoreFragment(n))return;const l=s.parsing.end-s.loading.start-Math.min(s.loading.first-s.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(l,s.loaded),s.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}ignoreFragment(r){return r.type!==PlaylistLevelType.MAIN||r.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:r,minAutoLevel:e}=this.hls,n=this.getBwEstimate(),o=this.hls.config.maxStarvationDelay,s=this.findBestLevel(n,e,r,0,o,1,1);if(s>-1)return s;const l=this.hls.firstLevel,c=Math.min(Math.max(l,e),r);return logger.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${l} clamped to ${c}`),c}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const r=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),o=this.lastLoadedFragLevel>-1;if(r!==-1&&(!n||!o||this.nextAutoLevelKey===this.getAutoLevelKey()))return r;const s=n&&o?this.getNextABRAutoLevel():this.firstAutoLevel;if(r!==-1){const l=this.hls.levels;if(l.length>Math.max(r,s)&&l[r].loadError<=l[s].loadError)return r}return this._nextAutoLevel=s,this.nextAutoLevelKey=this.getAutoLevelKey(),s}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:r,partCurrent:e,hls:n}=this,{maxAutoLevel:o,config:s,minAutoLevel:l}=n,c=e?e.duration:r?r.duration:0,u=this.getBwEstimate(),f=this.getStarvationDelay();let d=s.abrBandWidthFactor,g=s.abrBandWidthUpFactor;if(f){const x=this.findBestLevel(u,l,o,f,0,d,g);if(x>=0)return x}let p=c?Math.min(c,s.maxStarvationDelay):s.maxStarvationDelay;if(!f){const x=this.bitrateTestDelay;x&&(p=(c?Math.min(c,s.maxLoadingDelay):s.maxLoadingDelay)-x,logger.info(`[abr] bitrate test took ${Math.round(1e3*x)}ms, set first fragment max fetchDuration to ${Math.round(1e3*p)} ms`),d=g=1)}const v=this.findBestLevel(u,l,o,f,p,d,g);if(logger.info(`[abr] ${f?"rebuffering expected":"buffer is empty"}, optimal quality level ${v}`),v>-1)return v;const m=n.levels[l],y=n.levels[n.loadLevel];return(m==null?void 0:m.bitrate)<(y==null?void 0:y.bitrate)?l:n.loadLevel}getStarvationDelay(){const r=this.hls,e=r.media;if(!e)return 1/0;const n=e&&e.playbackRate!==0?Math.abs(e.playbackRate):1,o=r.mainForwardBufferInfo;return(o?o.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(r,e,n,o,s,l,c){var u;const f=o+s,d=this.lastLoadedFragLevel,g=d===-1?this.hls.firstLevel:d,{fragCurrent:p,partCurrent:v}=this,{levels:m,allAudioTracks:y,loadLevel:x,config:_}=this.hls;if(m.length===1)return 0;const E=m[g],S=!!(E!=null&&(u=E.details)!=null&&u.live),A=x===-1||d===-1;let T,b="SDR",C=(E==null?void 0:E.frameRate)||0;const{audioPreference:L,videoPreference:R}=_,I=this.audioTracksByGroup||(this.audioTracksByGroup=getAudioTracksByGroup(y));if(A){if(this.firstSelection!==-1)return this.firstSelection;const F=this.codecTiers||(this.codecTiers=getCodecTiers(m,I,e,n)),k=getStartCodecTier(F,b,r,L,R),{codecSet:$,videoRanges:V,minFramerate:N,minBitrate:B,preferHDR:G}=k;T=$,b=G?V[V.length-1]:V[0],C=N,r=Math.max(r,B),logger.log(`[abr] picked start tier ${JSON.stringify(k)}`)}else T=E==null?void 0:E.codecSet,b=E==null?void 0:E.videoRange;const w=v?v.duration:p?p.duration:0,M=this.bwEstimator.getEstimateTTFB()/1e3,D=[];for(let F=n;F>=e;F--){var O;const k=m[F],$=F>g;if(!k)continue;if(_.useMediaCapabilities&&!k.supportedResult&&!k.supportedPromise){const W=navigator.mediaCapabilities;typeof(W==null?void 0:W.decodingInfo)=="function"&&requiresMediaCapabilitiesDecodingInfo(k,I,b,C,r,L)?(k.supportedPromise=getMediaDecodingInfoPromise(k,I,W),k.supportedPromise.then(Y=>{if(!this.hls)return;k.supportedResult=Y;const K=this.hls.levels,Z=K.indexOf(k);Y.error?logger.warn(`[abr] MediaCapabilities decodingInfo error: "${Y.error}" for level ${Z} ${JSON.stringify(Y)}`):Y.supported||(logger.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${Z} ${JSON.stringify(Y)}`),Z>-1&&K.length>1&&(logger.log(`[abr] Removing unsupported level ${Z}`),this.hls.removeLevel(Z)))})):k.supportedResult=SUPPORTED_INFO_DEFAULT}if(T&&k.codecSet!==T||b&&k.videoRange!==b||$&&C>k.frameRate||!$&&C>0&&C<k.frameRate||k.supportedResult&&!((O=k.supportedResult.decodingInfoResults)!=null&&O[0].smooth)){D.push(F);continue}const V=k.details,N=(v?V==null?void 0:V.partTarget:V==null?void 0:V.averagetargetduration)||w;let B;$?B=c*r:B=l*r;const G=w&&o>=w*2&&s===0?m[F].averageBitrate:m[F].maxBitrate,z=this.getTimeToLoadFrag(M,B,G*N,V===void 0);if(B>=G&&(F===d||k.loadError===0&&k.fragmentError===0)&&(z<=M||!isFiniteNumber(z)||S&&!this.bitrateTestDelay||z<f)){const W=this.forcedAutoLevel;return F!==x&&(W===-1||W!==x)&&(D.length&&logger.trace(`[abr] Skipped level(s) ${D.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${m[D[0]].codecs}" ${m[D[0]].videoRange}; not compatible with "${E.codecs}" ${b}`),logger.info(`[abr] switch candidate:${g}->${F} adjustedbw(${Math.round(B)})-bitrate=${Math.round(B-G)} ttfb:${M.toFixed(1)} avgDuration:${N.toFixed(1)} maxFetchDuration:${f.toFixed(1)} fetchDuration:${z.toFixed(1)} firstSelection:${A} codecSet:${T} videoRange:${b} hls.loadLevel:${x}`)),A&&(this.firstSelection=F),F}}return-1}set nextAutoLevel(r){const{maxAutoLevel:e,minAutoLevel:n}=this.hls,o=Math.min(Math.max(r,n),e);this._nextAutoLevel!==o&&(this.nextAutoLevelKey="",this._nextAutoLevel=o)}}class TaskLoop{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(r){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,r),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class FragmentTracker{constructor(r){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=r,this._registerListeners()}_registerListeners(){const{hls:r}=this;r.on(Events.BUFFER_APPENDED,this.onBufferAppended,this),r.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),r.on(Events.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:r}=this;r.off(Events.BUFFER_APPENDED,this.onBufferAppended,this),r.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),r.off(Events.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(r,e){const n=this.activePartLists[e];if(n)for(let o=n.length;o--;){const s=n[o];if(!s)break;const l=s.end;if(s.start<=r&&l!==null&&r<=l)return s}return this.getBufferedFrag(r,e)}getBufferedFrag(r,e){const{fragments:n}=this,o=Object.keys(n);for(let s=o.length;s--;){const l=n[o[s]];if((l==null?void 0:l.body.type)===e&&l.buffered){const c=l.body;if(c.start<=r&&r<=c.end)return c}}return null}detectEvictedFragments(r,e,n,o){this.timeRanges&&(this.timeRanges[r]=e);const s=(o==null?void 0:o.fragment.sn)||-1;Object.keys(this.fragments).forEach(l=>{const c=this.fragments[l];if(!c||s>=c.body.sn)return;if(!c.buffered&&!c.loaded){c.body.type===n&&this.removeFragment(c.body);return}const u=c.range[r];u&&u.time.some(f=>{const d=!this.isTimeBuffered(f.startPTS,f.endPTS,e);return d&&this.removeFragment(c.body),d})})}detectPartialFragments(r){const e=this.timeRanges,{frag:n,part:o}=r;if(!e||n.sn==="initSegment")return;const s=getFragmentKey(n),l=this.fragments[s];if(!l||l.buffered&&n.gap)return;const c=!n.relurl;Object.keys(e).forEach(u=>{const f=n.elementaryStreams[u];if(!f)return;const d=e[u],g=c||f.partial===!0;l.range[u]=this.getBufferedTimes(n,o,g,d)}),l.loaded=null,Object.keys(l.range).length?(l.buffered=!0,(l.body.endList=n.endList||l.body.endList)&&(this.endListFragments[l.body.type]=l),isPartial(l)||this.removeParts(n.sn-1,n.type)):this.removeFragment(l.body)}removeParts(r,e){const n=this.activePartLists[e];n&&(this.activePartLists[e]=n.filter(o=>o.fragment.sn>=r))}fragBuffered(r,e){const n=getFragmentKey(r);let o=this.fragments[n];!o&&e&&(o=this.fragments[n]={body:r,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},r.gap&&(this.hasGaps=!0)),o&&(o.loaded=null,o.buffered=!0)}getBufferedTimes(r,e,n,o){const s={time:[],partial:n},l=r.start,c=r.end,u=r.minEndPTS||c,f=r.maxStartPTS||l;for(let d=0;d<o.length;d++){const g=o.start(d)-this.bufferPadding,p=o.end(d)+this.bufferPadding;if(f>=g&&u<=p){s.time.push({startPTS:Math.max(l,o.start(d)),endPTS:Math.min(c,o.end(d))});break}else if(l<p&&c>g){const v=Math.max(l,o.start(d)),m=Math.min(c,o.end(d));m>v&&(s.partial=!0,s.time.push({startPTS:v,endPTS:m}))}else if(c<=g)break}return s}getPartialFragment(r){let e=null,n,o,s,l=0;const{bufferPadding:c,fragments:u}=this;return Object.keys(u).forEach(f=>{const d=u[f];d&&isPartial(d)&&(o=d.body.start-c,s=d.body.end+c,r>=o&&r<=s&&(n=Math.min(r-o,s-r),l<=n&&(e=d.body,l=n)))}),e}isEndListAppended(r){const e=this.endListFragments[r];return e!==void 0&&(e.buffered||isPartial(e))}getState(r){const e=getFragmentKey(r),n=this.fragments[e];return n?n.buffered?isPartial(n)?FragmentState.PARTIAL:FragmentState.OK:FragmentState.APPENDING:FragmentState.NOT_LOADED}isTimeBuffered(r,e,n){let o,s;for(let l=0;l<n.length;l++){if(o=n.start(l)-this.bufferPadding,s=n.end(l)+this.bufferPadding,r>=o&&e<=s)return!0;if(e<=o)return!1}return!1}onFragLoaded(r,e){const{frag:n,part:o}=e;if(n.sn==="initSegment"||n.bitrateTest)return;const s=o?null:e,l=getFragmentKey(n);this.fragments[l]={body:n,appendedPTS:null,loaded:s,buffered:!1,range:Object.create(null)}}onBufferAppended(r,e){const{frag:n,part:o,timeRanges:s}=e;if(n.sn==="initSegment")return;const l=n.type;if(o){let c=this.activePartLists[l];c||(this.activePartLists[l]=c=[]),c.push(o)}this.timeRanges=s,Object.keys(s).forEach(c=>{const u=s[c];this.detectEvictedFragments(c,u,l,o)})}onFragBuffered(r,e){this.detectPartialFragments(e)}hasFragment(r){const e=getFragmentKey(r);return!!this.fragments[e]}hasParts(r){var e;return!!((e=this.activePartLists[r])!=null&&e.length)}removeFragmentsInRange(r,e,n,o,s){o&&!this.hasGaps||Object.keys(this.fragments).forEach(l=>{const c=this.fragments[l];if(!c)return;const u=c.body;u.type!==n||o&&!u.gap||u.start<e&&u.end>r&&(c.buffered||s)&&this.removeFragment(u)})}removeFragment(r){const e=getFragmentKey(r);r.stats.loaded=0,r.clearElementaryStreamInfo();const n=this.activePartLists[r.type];if(n){const o=r.sn;this.activePartLists[r.type]=n.filter(s=>s.fragment.sn!==o)}delete this.fragments[e],r.endList&&delete this.endListFragments[r.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function isPartial(a){var r,e,n;return a.buffered&&(a.body.gap||((r=a.range.video)==null?void 0:r.partial)||((e=a.range.audio)==null?void 0:e.partial)||((n=a.range.audiovideo)==null?void 0:n.partial))}function getFragmentKey(a){return`${a.type}_${a.level}_${a.sn}`}const noopBuffered={length:0,start:()=>0,end:()=>0};class BufferHelper{static isBuffered(r,e){try{if(r){const n=BufferHelper.getBuffered(r);for(let o=0;o<n.length;o++)if(e>=n.start(o)&&e<=n.end(o))return!0}}catch{}return!1}static bufferInfo(r,e,n){try{if(r){const o=BufferHelper.getBuffered(r),s=[];let l;for(l=0;l<o.length;l++)s.push({start:o.start(l),end:o.end(l)});return this.bufferedInfo(s,e,n)}}catch{}return{len:0,start:e,end:e,nextStart:void 0}}static bufferedInfo(r,e,n){e=Math.max(0,e),r.sort(function(f,d){const g=f.start-d.start;return g||d.end-f.end});let o=[];if(n)for(let f=0;f<r.length;f++){const d=o.length;if(d){const g=o[d-1].end;r[f].start-g<n?r[f].end>g&&(o[d-1].end=r[f].end):o.push(r[f])}else o.push(r[f])}else o=r;let s=0,l,c=e,u=e;for(let f=0;f<o.length;f++){const d=o[f].start,g=o[f].end;if(e+n>=d&&e<g)c=d,u=g,s=u-e;else if(e+n<d){l=d;break}}return{len:s,start:c||0,end:u||0,nextStart:l}}static getBuffered(r){try{return r.buffered}catch(e){return logger.log("failed to get media.buffered",e),noopBuffered}}}class ChunkMetadata{constructor(r,e,n,o=0,s=-1,l=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=getNewPerformanceTiming(),this.buffering={audio:getNewPerformanceTiming(),video:getNewPerformanceTiming(),audiovideo:getNewPerformanceTiming()},this.level=r,this.sn=e,this.id=n,this.size=o,this.part=s,this.partial=l}}function getNewPerformanceTiming(){return{start:0,executeStart:0,executeEnd:0,end:0}}function findFirstFragWithCC(a,r){for(let n=0,o=a.length;n<o;n++){var e;if(((e=a[n])==null?void 0:e.cc)===r)return a[n]}return null}function shouldAlignOnDiscontinuities(a,r,e){return!!(r&&(e.endCC>e.startCC||a&&a.cc<e.startCC))}function findDiscontinuousReferenceFrag(a,r){const e=a.fragments,n=r.fragments;if(!n.length||!e.length){logger.log("No fragments to align");return}const o=findFirstFragWithCC(e,n[0].cc);if(!o||o&&!o.startPTS){logger.log("No frag in previous level to align on");return}return o}function adjustFragmentStart(a,r){if(a){const e=a.start+r;a.start=a.startPTS=e,a.endPTS=e+a.duration}}function adjustSlidingStart(a,r){const e=r.fragments;for(let n=0,o=e.length;n<o;n++)adjustFragmentStart(e[n],a);r.fragmentHint&&adjustFragmentStart(r.fragmentHint,a),r.alignedSliding=!0}function alignStream(a,r,e){r&&(alignDiscontinuities(a,e,r),!e.alignedSliding&&r&&alignMediaPlaylistByPDT(e,r),!e.alignedSliding&&r&&!e.skippedSegments&&adjustSliding(r,e))}function alignDiscontinuities(a,r,e){if(shouldAlignOnDiscontinuities(a,e,r)){const n=findDiscontinuousReferenceFrag(e,r);n&&isFiniteNumber(n.start)&&(logger.log(`Adjusting PTS using last level due to CC increase within current level ${r.url}`),adjustSlidingStart(n.start,r))}}function alignMediaPlaylistByPDT(a,r){if(!a.hasProgramDateTime||!r.hasProgramDateTime)return;const e=a.fragments,n=r.fragments;if(!e.length||!n.length)return;let o,s;const l=Math.min(r.endCC,a.endCC);r.startCC<l&&a.startCC<l&&(o=findFirstFragWithCC(n,l),s=findFirstFragWithCC(e,l)),(!o||!s)&&(o=n[Math.floor(n.length/2)],s=findFirstFragWithCC(e,o.cc)||e[Math.floor(e.length/2)]);const c=o.programDateTime,u=s.programDateTime;if(!c||!u)return;const f=(u-c)/1e3-(s.start-o.start);adjustSlidingStart(f,a)}const MIN_CHUNK_SIZE=Math.pow(2,17);class FragmentLoader{constructor(r){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=r}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(r,e){const n=r.url;if(!n)return Promise.reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const o=this.config,s=o.fLoader,l=o.loader;return new Promise((c,u)=>{if(this.loader&&this.loader.destroy(),r.gap)if(r.tagList.some(v=>v[0]==="GAP")){u(createGapLoadError(r));return}else r.gap=!1;const f=this.loader=r.loader=s?new s(o):new l(o),d=createLoaderContext(r),g=getLoaderConfigWithoutReties(o.fragLoadPolicy.default),p={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:r.sn==="initSegment"?1/0:MIN_CHUNK_SIZE};r.stats=f.stats,f.load(d,p,{onSuccess:(v,m,y,x)=>{this.resetLoader(r,f);let _=v.data;y.resetIV&&r.decryptdata&&(r.decryptdata.iv=new Uint8Array(_.slice(0,16)),_=_.slice(16)),c({frag:r,part:null,payload:_,networkDetails:x})},onError:(v,m,y,x)=>{this.resetLoader(r,f),u(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,response:_objectSpread2({url:n,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:y,stats:x}))},onAbort:(v,m,y)=>{this.resetLoader(r,f),u(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:r,error:new Error("Aborted"),networkDetails:y,stats:v}))},onTimeout:(v,m,y)=>{this.resetLoader(r,f),u(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:y,stats:v}))},onProgress:(v,m,y,x)=>{e&&e({frag:r,part:null,payload:y,networkDetails:x})}})})}loadPart(r,e,n){this.abort();const o=this.config,s=o.fLoader,l=o.loader;return new Promise((c,u)=>{if(this.loader&&this.loader.destroy(),r.gap||e.gap){u(createGapLoadError(r,e));return}const f=this.loader=r.loader=s?new s(o):new l(o),d=createLoaderContext(r,e),g=getLoaderConfigWithoutReties(o.fragLoadPolicy.default),p={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:MIN_CHUNK_SIZE};e.stats=f.stats,f.load(d,p,{onSuccess:(v,m,y,x)=>{this.resetLoader(r,f),this.updateStatsFromPart(r,e);const _={frag:r,part:e,payload:v.data,networkDetails:x};n(_),c(_)},onError:(v,m,y,x)=>{this.resetLoader(r,f),u(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,part:e,response:_objectSpread2({url:d.url,data:void 0},v),error:new Error(`HTTP Error ${v.code} ${v.text}`),networkDetails:y,stats:x}))},onAbort:(v,m,y)=>{r.stats.aborted=e.stats.aborted,this.resetLoader(r,f),u(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:r,part:e,error:new Error("Aborted"),networkDetails:y,stats:v}))},onTimeout:(v,m,y)=>{this.resetLoader(r,f),u(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,part:e,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:y,stats:v}))}})})}updateStatsFromPart(r,e){const n=r.stats,o=e.stats,s=o.total;if(n.loaded+=o.loaded,s){const u=Math.round(r.duration/e.duration),f=Math.min(Math.round(n.loaded/s),u),g=(u-f)*Math.round(n.loaded/f);n.total=n.loaded+g}else n.total=Math.max(n.loaded,n.total);const l=n.loading,c=o.loading;l.start?l.first+=c.first-c.start:(l.start=c.start,l.first=c.first),l.end=c.end}resetLoader(r,e){r.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()}}function createLoaderContext(a,r=null){const e=r||a,n={frag:a,part:r,responseType:"arraybuffer",url:e.url,headers:{},rangeStart:0,rangeEnd:0},o=e.byteRangeStartOffset,s=e.byteRangeEndOffset;if(isFiniteNumber(o)&&isFiniteNumber(s)){var l;let c=o,u=s;if(a.sn==="initSegment"&&((l=a.decryptdata)==null?void 0:l.method)==="AES-128"){const f=s-o;f%16&&(u=s+(16-f%16)),o!==0&&(n.resetIV=!0,c=o-16)}n.rangeStart=c,n.rangeEnd=u}return n}function createGapLoadError(a,r){const e=new Error(`GAP ${a.gap?"tag":"attribute"} found`),n={type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_GAP,fatal:!1,frag:a,error:e,networkDetails:null};return r&&(n.part=r),(r||a).stats.aborted=!0,new LoadError(n)}class LoadError extends Error{constructor(r){super(r.error.message),this.data=void 0,this.data=r}}class AESCrypto{constructor(r,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=r,this.aesIV=e}decrypt(r,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,r)}}class FastAESKey{constructor(r,e){this.subtle=void 0,this.key=void 0,this.subtle=r,this.key=e}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function removePadding(a){const r=a.byteLength,e=r&&new DataView(a.buffer).getUint8(r-1);return e?sliceUint8(a,0,r-e):a}class AESDecryptor{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(r){const e=new DataView(r),n=new Uint32Array(4);for(let o=0;o<4;o++)n[o]=e.getUint32(o*4);return n}initTable(){const r=this.sBox,e=this.invSBox,n=this.subMix,o=n[0],s=n[1],l=n[2],c=n[3],u=this.invSubMix,f=u[0],d=u[1],g=u[2],p=u[3],v=new Uint32Array(256);let m=0,y=0,x=0;for(x=0;x<256;x++)x<128?v[x]=x<<1:v[x]=x<<1^283;for(x=0;x<256;x++){let _=y^y<<1^y<<2^y<<3^y<<4;_=_>>>8^_&255^99,r[m]=_,e[_]=m;const E=v[m],S=v[E],A=v[S];let T=v[_]*257^_*16843008;o[m]=T<<24|T>>>8,s[m]=T<<16|T>>>16,l[m]=T<<8|T>>>24,c[m]=T,T=A*16843009^S*65537^E*257^m*16843008,f[_]=T<<24|T>>>8,d[_]=T<<16|T>>>16,g[_]=T<<8|T>>>24,p[_]=T,m?(m=E^v[v[v[A^E]]],y^=v[v[y]]):m=y=1}}expandKey(r){const e=this.uint8ArrayToUint32Array_(r);let n=!0,o=0;for(;o<e.length&&n;)n=e[o]===this.key[o],o++;if(n)return;this.key=e;const s=this.keySize=e.length;if(s!==4&&s!==6&&s!==8)throw new Error("Invalid aes key size="+s);const l=this.ksRows=(s+6+1)*4;let c,u;const f=this.keySchedule=new Uint32Array(l),d=this.invKeySchedule=new Uint32Array(l),g=this.sBox,p=this.rcon,v=this.invSubMix,m=v[0],y=v[1],x=v[2],_=v[3];let E,S;for(c=0;c<l;c++){if(c<s){E=f[c]=e[c];continue}S=E,c%s===0?(S=S<<8|S>>>24,S=g[S>>>24]<<24|g[S>>>16&255]<<16|g[S>>>8&255]<<8|g[S&255],S^=p[c/s|0]<<24):s>6&&c%s===4&&(S=g[S>>>24]<<24|g[S>>>16&255]<<16|g[S>>>8&255]<<8|g[S&255]),f[c]=E=(f[c-s]^S)>>>0}for(u=0;u<l;u++)c=l-u,u&3?S=f[c]:S=f[c-4],u<4||c<=4?d[u]=S:d[u]=m[g[S>>>24]]^y[g[S>>>16&255]]^x[g[S>>>8&255]]^_[g[S&255]],d[u]=d[u]>>>0}networkToHostOrderSwap(r){return r<<24|(r&65280)<<8|(r&16711680)>>8|r>>>24}decrypt(r,e,n){const o=this.keySize+6,s=this.invKeySchedule,l=this.invSBox,c=this.invSubMix,u=c[0],f=c[1],d=c[2],g=c[3],p=this.uint8ArrayToUint32Array_(n);let v=p[0],m=p[1],y=p[2],x=p[3];const _=new Int32Array(r),E=new Int32Array(_.length);let S,A,T,b,C,L,R,I,w,M,D,O,F,k;const $=this.networkToHostOrderSwap;for(;e<_.length;){for(w=$(_[e]),M=$(_[e+1]),D=$(_[e+2]),O=$(_[e+3]),C=w^s[0],L=O^s[1],R=D^s[2],I=M^s[3],F=4,k=1;k<o;k++)S=u[C>>>24]^f[L>>16&255]^d[R>>8&255]^g[I&255]^s[F],A=u[L>>>24]^f[R>>16&255]^d[I>>8&255]^g[C&255]^s[F+1],T=u[R>>>24]^f[I>>16&255]^d[C>>8&255]^g[L&255]^s[F+2],b=u[I>>>24]^f[C>>16&255]^d[L>>8&255]^g[R&255]^s[F+3],C=S,L=A,R=T,I=b,F=F+4;S=l[C>>>24]<<24^l[L>>16&255]<<16^l[R>>8&255]<<8^l[I&255]^s[F],A=l[L>>>24]<<24^l[R>>16&255]<<16^l[I>>8&255]<<8^l[C&255]^s[F+1],T=l[R>>>24]<<24^l[I>>16&255]<<16^l[C>>8&255]<<8^l[L&255]^s[F+2],b=l[I>>>24]<<24^l[C>>16&255]<<16^l[L>>8&255]<<8^l[R&255]^s[F+3],E[e]=$(S^v),E[e+1]=$(b^m),E[e+2]=$(T^y),E[e+3]=$(A^x),v=w,m=M,y=D,x=O,e=e+4}return E.buffer}}const CHUNK_SIZE=16;class Decrypter{constructor(r,{removePKCS7Padding:e=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=r.enableSoftwareAES,this.removePKCS7Padding=e,e)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:r,remainderData:e}=this;if(!r||e)return this.reset(),null;const n=new Uint8Array(r);return this.reset(),this.removePKCS7Padding?removePadding(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(r,e,n){return this.useSoftware?new Promise((o,s)=>{this.softwareDecrypt(new Uint8Array(r),e,n);const l=this.flush();l?o(l.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(r),e,n)}softwareDecrypt(r,e,n){const{currentIV:o,currentResult:s,remainderData:l}=this;this.logOnce("JS AES decrypt"),l&&(r=appendUint8Array(l,r),this.remainderData=null);const c=this.getValidChunk(r);if(!c.length)return null;o&&(n=o);let u=this.softwareDecrypter;u||(u=this.softwareDecrypter=new AESDecryptor),u.expandKey(e);const f=s;return this.currentResult=u.decrypt(c.buffer,0,n),this.currentIV=sliceUint8(c,-16).buffer,f||null}webCryptoDecrypt(r,e,n){if(this.key!==e||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(r,e,n));this.key=e,this.fastAesKey=new FastAESKey(this.subtle,e)}return this.fastAesKey.expandKey().then(o=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new AESCrypto(this.subtle,new Uint8Array(n)).decrypt(r.buffer,o)):Promise.reject(new Error("web crypto not initialized"))).catch(o=>(logger.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${o.name}: ${o.message}`),this.onWebCryptoError(r,e,n)))}onWebCryptoError(r,e,n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(r,e,n);const o=this.flush();if(o)return o.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(r){let e=r;const n=r.length-r.length%CHUNK_SIZE;return n!==r.length&&(e=sliceUint8(r,0,n),this.remainderData=sliceUint8(r,n)),e}logOnce(r){this.logEnabled&&(logger.log(`[decrypter]: ${r}`),this.logEnabled=!1)}}const TimeRanges={toString:function(a){let r="";const e=a.length;for(let n=0;n<e;n++)r+=`[${a.start(n).toFixed(3)}-${a.end(n).toFixed(3)}]`;return r}},State={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class BaseStreamController extends TaskLoop{constructor(r,e,n,o,s){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=State.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=s,this.logPrefix=o,this.log=logger.log.bind(logger,`${o}:`),this.warn=logger.warn.bind(logger,`${o}:`),this.hls=r,this.fragmentLoader=new FragmentLoader(r.config),this.keyLoader=n,this.fragmentTracker=e,this.config=r.config,this.decrypter=new Decrypter(r.config),r.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(r){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const r=this.fragCurrent;r!=null&&r.loader&&(r.abortRequests(),this.fragmentTracker.removeFragment(r)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=State.STOPPED}_streamEnded(r,e){if(e.live||r.nextStart||!r.end||!this.media)return!1;const n=e.partList;if(n!=null&&n.length){const s=n[n.length-1];return BufferHelper.isBuffered(this.media,s.start+s.duration/2)}const o=e.fragments[e.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(o)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var r;return(r=this.levelLastLoaded)==null?void 0:r.details}}onMediaAttached(r,e){const n=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);const o=this.config;this.levels&&o.autoStartLoad&&this.state===State.STOPPED&&this.startLoad(o.startPosition)}onMediaDetaching(){const r=this.media;r!=null&&r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),r&&this.onvseeking&&this.onvended&&(r.removeEventListener("seeking",this.onvseeking),r.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:r,fragCurrent:e,media:n,mediaBuffer:o,state:s}=this,l=n?n.currentTime:0,c=BufferHelper.bufferInfo(o||n,l,r.maxBufferHole);if(this.log(`media seeking to ${isFiniteNumber(l)?l.toFixed(3):l}, state: ${s}`),this.state===State.ENDED)this.resetLoadingState();else if(e){const u=r.maxFragLookUpTolerance,f=e.start-u,d=e.start+e.duration+u;if(!c.len||d<c.start||f>c.end){const g=l>d;(l<f||g)&&(g&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}n&&(this.fragmentTracker.removeFragmentsInRange(l,1/0,this.playlistType,!0),this.lastCurrentTime=l),!this.loadedmetadata&&!c.len&&(this.nextLoadPosition=this.startPosition=l),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(r,e){this.startTimeOffset=e.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=State.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(r,e,n){this._loadFragForPlayback(r,e,n)}_loadFragForPlayback(r,e,n){const o=s=>{if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${s.part?" p: "+s.part.index:""} of level ${r.level} was dropped during download.`),this.fragmentTracker.removeFragment(r);return}r.stats.chunkCount++,this._handleFragmentLoadProgress(s)};this._doFragLoad(r,e,n,o).then(s=>{if(!s)return;const l=this.state;if(this.fragContextChanged(r)){(l===State.FRAG_LOADING||!this.fragCurrent&&l===State.PARSING)&&(this.fragmentTracker.removeFragment(r),this.state=State.IDLE);return}"payload"in s&&(this.log(`Loaded fragment ${r.sn} of level ${r.level}`),this.hls.trigger(Events.FRAG_LOADED,s)),this._handleFragmentLoadComplete(s)}).catch(s=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(`Frag error: ${(s==null?void 0:s.message)||s}`),this.resetFragmentLoading(r))})}clearTrackerIfNeeded(r){var e;const{fragmentTracker:n}=this;if(n.getState(r)===FragmentState.APPENDING){const s=r.type,l=this.getFwdBufferInfo(this.mediaBuffer,s),c=Math.max(r.duration,l?l.len:this.config.maxBufferLength),u=this.backtrackFragment;((u?r.sn-u.sn:0)===1||this.reduceMaxBufferLength(c))&&n.removeFragment(r)}else((e=this.mediaBuffer)==null?void 0:e.buffered.length)===0?n.removeAllFragments():n.hasParts(r.type)&&(n.detectPartialFragments({frag:r,part:null,stats:r.stats,id:r.type}),n.getState(r)===FragmentState.PARTIAL&&n.removeFragment(r))}checkLiveUpdate(r){if(r.updated&&!r.live){const e=r.fragments[r.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type})}r.fragments[0]||(r.deltaUpdateFailed=!0)}flushMainBuffer(r,e,n=null){if(!(r-e))return;const o={startOffset:r,endOffset:e,type:n};this.hls.trigger(Events.BUFFER_FLUSHING,o)}_loadInitSegment(r,e){this._doFragLoad(r,e).then(n=>{if(!n||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:o}=this,{payload:s}=n,l=r.decryptdata;if(s&&s.byteLength>0&&l!=null&&l.key&&l.iv&&l.method==="AES-128"){const c=self.performance.now();return this.decrypter.decrypt(new Uint8Array(s),l.key.buffer,l.iv.buffer).catch(u=>{throw o.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:r}),u}).then(u=>{const f=self.performance.now();return o.trigger(Events.FRAG_DECRYPTED,{frag:r,payload:u,stats:{tstart:c,tdecrypt:f}}),n.payload=u,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(n),this.resetFragmentLoading(r))})}completeInitSegmentLoad(r){const{levels:e}=this;if(!e)throw new Error("init load aborted, missing levels");const n=r.frag.stats;this.state=State.IDLE,r.frag.data=new Uint8Array(r.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}fragContextChanged(r){const{fragCurrent:e}=this;return!r||!e||r.sn!==e.sn||r.level!==e.level}fragBufferedComplete(r,e){var n,o,s,l;const c=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${r.type} sn: ${r.sn}${e?" part: "+e.index:""} of ${this.playlistType===PlaylistLevelType.MAIN?"level":"track"} ${r.level} (frag:[${((n=r.startPTS)!=null?n:NaN).toFixed(3)}-${((o=r.endPTS)!=null?o:NaN).toFixed(3)}] > buffer:${c?TimeRanges.toString(BufferHelper.getBuffered(c)):"(detached)"})`),r.sn!=="initSegment"){var u;if(r.type!==PlaylistLevelType.SUBTITLE){const d=r.elementaryStreams;if(!Object.keys(d).some(g=>!!d[g])){this.state=State.IDLE;return}}const f=(u=this.levels)==null?void 0:u[r.level];f!=null&&f.fragmentError&&(this.log(`Resetting level fragment error count of ${f.fragmentError} on frag buffered`),f.fragmentError=0)}this.state=State.IDLE,c&&(!this.loadedmetadata&&r.type==PlaylistLevelType.MAIN&&c.buffered.length&&((s=this.fragCurrent)==null?void 0:s.sn)===((l=this.fragPrevious)==null?void 0:l.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(r){const{transmuxer:e}=this;if(!e)return;const{frag:n,part:o,partsLoaded:s}=r,l=!s||s.length===0||s.some(u=>!u),c=new ChunkMetadata(n.level,n.sn,n.stats.chunkCount+1,0,o?o.index:-1,!l);e.flush(c)}_handleFragmentLoadProgress(r){}_doFragLoad(r,e,n=null,o){var s;const l=e==null?void 0:e.details;if(!this.levels||!l)throw new Error(`frag load aborted, missing level${l?"":" detail"}s`);let c=null;if(r.encrypted&&!((s=r.decryptdata)!=null&&s.key)?(this.log(`Loading key for ${r.sn} of [${l.startSN}-${l.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${r.level}`),this.state=State.KEY_LOADING,this.fragCurrent=r,c=this.keyLoader.load(r).then(d=>{if(!this.fragContextChanged(d.frag))return this.hls.trigger(Events.KEY_LOADED,d),this.state===State.KEY_LOADING&&(this.state=State.IDLE),d}),this.hls.trigger(Events.KEY_LOADING,{frag:r}),this.fragCurrent===null&&(c=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!r.encrypted&&l.encryptedFragments.length&&this.keyLoader.loadClear(r,l.encryptedFragments),n=Math.max(r.start,n||0),this.config.lowLatencyMode&&r.sn!=="initSegment"){const d=l.partList;if(d&&o){n>r.end&&l.fragmentHint&&(r=l.fragmentHint);const g=this.getNextPart(d,r,n);if(g>-1){const p=d[g];this.log(`Loading part sn: ${r.sn} p: ${p.index} cc: ${r.cc} of playlist [${l.startSN}-${l.endSN}] parts [0-${g}-${d.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${r.level}, target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=p.start+p.duration,this.state=State.FRAG_LOADING;let v;return c?v=c.then(m=>!m||this.fragContextChanged(m.frag)?null:this.doFragPartsLoad(r,p,e,o)).catch(m=>this.handleFragLoadError(m)):v=this.doFragPartsLoad(r,p,e,o).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(Events.FRAG_LOADING,{frag:r,part:p,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):v}else if(!r.url||this.loadedEndOfParts(d,n))return Promise.resolve(null)}}this.log(`Loading fragment ${r.sn} cc: ${r.cc} ${l?"of ["+l.startSN+"-"+l.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${r.level}, target: ${parseFloat(n.toFixed(3))}`),isFiniteNumber(r.sn)&&!this.bitrateTest&&(this.nextLoadPosition=r.start+r.duration),this.state=State.FRAG_LOADING;const u=this.config.progressive;let f;return u&&c?f=c.then(d=>!d||this.fragContextChanged(d==null?void 0:d.frag)?null:this.fragmentLoader.load(r,o)).catch(d=>this.handleFragLoadError(d)):f=Promise.all([this.fragmentLoader.load(r,u?o:void 0),c]).then(([d])=>(!u&&d&&o&&o(d),d)).catch(d=>this.handleFragLoadError(d)),this.hls.trigger(Events.FRAG_LOADING,{frag:r,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):f}doFragPartsLoad(r,e,n,o){return new Promise((s,l)=>{var c;const u=[],f=(c=n.details)==null?void 0:c.partList,d=g=>{this.fragmentLoader.loadPart(r,g,o).then(p=>{u[g.index]=p;const v=p.part;this.hls.trigger(Events.FRAG_LOADED,p);const m=getPartWith(n,r.sn,g.index+1)||findPart(f,r.sn,g.index+1);if(m)d(m);else return s({frag:r,part:v,partsLoaded:u})}).catch(l)};d(e)})}handleFragLoadError(r){if("data"in r){const e=r.data;r.data&&e.details===ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(Events.ERROR,e)}else this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,err:r,error:r,fatal:!0});return null}_handleTransmuxerFlush(r){const e=this.getCurrentContext(r);if(!e||this.state!==State.PARSING){!this.fragCurrent&&this.state!==State.STOPPED&&this.state!==State.ERROR&&(this.state=State.IDLE);return}const{frag:n,part:o,level:s}=e,l=self.performance.now();n.stats.parsing.end=l,o&&(o.stats.parsing.end=l),this.updateLevelTiming(n,o,s,r.partial)}getCurrentContext(r){const{levels:e,fragCurrent:n}=this,{level:o,sn:s,part:l}=r;if(!(e!=null&&e[o]))return this.warn(`Levels object was unset while buffering fragment ${s} of level ${o}. The current chunk will not be buffered.`),null;const c=e[o],u=l>-1?getPartWith(c,s,l):null,f=u?u.fragment:getFragmentWithSN(c,s,n);return f?(n&&n!==f&&(f.stats=n.stats),{frag:f,part:u,level:c}):null}bufferFragmentData(r,e,n,o,s){var l;if(!r||this.state!==State.PARSING)return;const{data1:c,data2:u}=r;let f=c;if(c&&u&&(f=appendUint8Array(c,u)),!((l=f)!=null&&l.length))return;const d={type:r.type,frag:e,part:n,chunkMeta:o,parent:e.type,data:f};if(this.hls.trigger(Events.BUFFER_APPENDING,d),r.dropped&&r.independent&&!n){if(s)return;this.flushBufferGap(e)}}flushBufferGap(r){const e=this.media;if(!e)return;if(!BufferHelper.isBuffered(e,e.currentTime)){this.flushMainBuffer(0,r.start);return}const n=e.currentTime,o=BufferHelper.bufferInfo(e,n,0),s=r.duration,l=Math.min(this.config.maxFragLookUpTolerance*2,s*.25),c=Math.max(Math.min(r.start-l,o.end-l),n+l);r.start-c>l&&this.flushMainBuffer(c,r.start)}getFwdBufferInfo(r,e){const n=this.getLoadPosition();return isFiniteNumber(n)?this.getFwdBufferInfoAtPos(r,n,e):null}getFwdBufferInfoAtPos(r,e,n){const{config:{maxBufferHole:o}}=this,s=BufferHelper.bufferInfo(r,e,o);if(s.len===0&&s.nextStart!==void 0){const l=this.fragmentTracker.getBufferedFrag(e,n);if(l&&s.nextStart<l.end)return BufferHelper.bufferInfo(r,e,Math.max(s.nextStart,o))}return s}getMaxBufferLength(r){const{config:e}=this;let n;return r?n=Math.max(8*e.maxBufferSize/r,e.maxBufferLength):n=e.maxBufferLength,Math.min(n,e.maxMaxBufferLength)}reduceMaxBufferLength(r){const e=this.config,n=r||e.maxBufferLength,o=e.maxMaxBufferLength/2;return o>=n?(e.maxMaxBufferLength=o,this.warn(`Reduce max buffer length to ${o}s`),!0):!1}getAppendedFrag(r,e=PlaylistLevelType.MAIN){const n=this.fragmentTracker.getAppendedFrag(r,PlaylistLevelType.MAIN);return n&&"fragment"in n?n.fragment:n}getNextFragment(r,e){const n=e.fragments,o=n.length;if(!o)return null;const{config:s}=this,l=n[0].start;let c;if(e.live){const u=s.initialLiveManifestSize;if(o<u)return this.warn(`Not enough fragments to start playback (have: ${o}, need: ${u})`),null;(!e.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||r<l)&&(c=this.getInitialLiveFragment(e,n),this.startPosition=this.nextLoadPosition=c?this.hls.liveSyncPosition||c.start:r)}else r<=l&&(c=n[0]);if(!c){const u=s.lowLatencyMode?e.partEnd:e.fragmentEnd;c=this.getFragmentAtPosition(r,u,e)}return this.mapToInitFragWhenRequired(c)}isLoopLoading(r,e){const n=this.fragmentTracker.getState(r);return(n===FragmentState.OK||n===FragmentState.PARTIAL&&!!r.gap)&&this.nextLoadPosition>e}getNextFragmentLoopLoading(r,e,n,o,s){const l=r.gap,c=this.getNextFragment(this.nextLoadPosition,e);if(c===null)return c;if(r=c,l&&r&&!r.gap&&n.nextStart){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,o);if(u!==null&&n.len+u.len>=s)return this.log(`buffer full after gaps in "${o}" playlist starting at sn: ${r.sn}`),null}return r}mapToInitFragWhenRequired(r){return r!=null&&r.initSegment&&!(r!=null&&r.initSegment.data)&&!this.bitrateTest?r.initSegment:r}getNextPart(r,e,n){let o=-1,s=!1,l=!0;for(let c=0,u=r.length;c<u;c++){const f=r[c];if(l=l&&!f.independent,o>-1&&n<f.start)break;const d=f.loaded;d?o=-1:(s||f.independent||l)&&f.fragment===e&&(o=c),s=d}return o}loadedEndOfParts(r,e){const n=r[r.length-1];return n&&e>n.start&&n.loaded}getInitialLiveFragment(r,e){const n=this.fragPrevious;let o=null;if(n){if(r.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),o=findFragmentByPDT(e,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!o){const s=n.sn+1;if(s>=r.startSN&&s<=r.endSN){const l=e[s-r.startSN];n.cc===l.cc&&(o=l,this.log(`Live playlist, switching playlist, load frag with next SN: ${o.sn}`))}o||(o=findFragWithCC(e,n.cc),o&&this.log(`Live playlist, switching playlist, load frag with same CC: ${o.sn}`))}}else{const s=this.hls.liveSyncPosition;s!==null&&(o=this.getFragmentAtPosition(s,this.bitrateTest?r.fragmentEnd:r.edge,r))}return o}getFragmentAtPosition(r,e,n){const{config:o}=this;let{fragPrevious:s}=this,{fragments:l,endSN:c}=n;const{fragmentHint:u}=n,{maxFragLookUpTolerance:f}=o,d=n.partList,g=!!(o.lowLatencyMode&&d!=null&&d.length&&u);g&&u&&!this.bitrateTest&&(l=l.concat(u),c=u.sn);let p;if(r<e){const v=r>e-f?0:f;p=findFragmentByPTS(s,l,r,v)}else p=l[l.length-1];if(p){const v=p.sn-n.startSN,m=this.fragmentTracker.getState(p);if((m===FragmentState.OK||m===FragmentState.PARTIAL&&p.gap)&&(s=p),s&&p.sn===s.sn&&(!g||d[0].fragment.sn>p.sn)&&s&&p.level===s.level){const x=l[v+1];p.sn<c&&this.fragmentTracker.getState(x)!==FragmentState.OK?p=x:p=null}}return p}synchronizeToLiveEdge(r){const{config:e,media:n}=this;if(!n)return;const o=this.hls.liveSyncPosition,s=n.currentTime,l=r.fragments[0].start,c=r.edge,u=s>=l-e.maxFragLookUpTolerance&&s<=c;if(o!==null&&n.duration>o&&(s<o||!u)){const f=e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*r.targetduration;(!u&&n.readyState<4||s<c-f)&&(this.loadedmetadata||(this.nextLoadPosition=o),n.readyState&&(this.warn(`Playback: ${s.toFixed(3)} is located too far from the end of live sliding playlist: ${c}, reset currentTime to : ${o.toFixed(3)}`),n.currentTime=o))}}alignPlaylists(r,e,n){const o=r.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;const s=r.fragments[0].start,l=!e,c=r.alignedSliding&&isFiniteNumber(s);if(l||!c&&!s){const{fragPrevious:u}=this;alignStream(u,n,r);const f=r.fragments[0].start;return this.log(`Live playlist sliding: ${f.toFixed(2)} start-sn: ${e?e.startSN:"na"}->${r.startSN} prev-sn: ${u?u.sn:"na"} fragments: ${o}`),f}return s}waitForCdnTuneIn(r){return r.live&&r.canBlockReload&&r.partTarget&&r.tuneInGoal>Math.max(r.partHoldBack,r.partTarget*3)}setStartPosition(r,e){let n=this.startPosition;if(n<e&&(n=-1),n===-1||this.lastCurrentTime===-1){const o=this.startTimeOffset!==null,s=o?this.startTimeOffset:r.startTimeOffset;s!==null&&isFiniteNumber(s)?(n=e+s,s<0&&(n+=r.totalduration),n=Math.min(Math.max(e,n),e+r.totalduration),this.log(`Start time offset ${s} found in ${o?"multivariant":"media"} playlist, adjust startPosition to ${n}`),this.startPosition=n):r.live?n=this.hls.liveSyncPosition||e:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n}getLoadPosition(){const{media:r}=this;let e=0;return this.loadedmetadata&&r?e=r.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e}handleFragLoadAborted(r,e){this.transmuxer&&r.sn!=="initSegment"&&r.stats.aborted&&(this.warn(`Fragment ${r.sn}${e?" part "+e.index:""} of level ${r.level} was aborted`),this.resetFragmentLoading(r))}resetFragmentLoading(r){(!this.fragCurrent||!this.fragContextChanged(r)&&this.state!==State.FRAG_LOADING_WAITING_RETRY)&&(this.state=State.IDLE)}onFragmentOrKeyLoadError(r,e){if(e.chunkMeta&&!e.frag){const d=this.getCurrentContext(e.chunkMeta);d&&(e.frag=d.frag)}const n=e.frag;if(!n||n.type!==r||!this.levels)return;if(this.fragContextChanged(n)){var o;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(o=this.fragCurrent)==null?void 0:o.url}`);return}const s=e.details===ErrorDetails.FRAG_GAP;s&&this.fragmentTracker.fragBuffered(n,!0);const l=e.errorAction,{action:c,retryCount:u=0,retryConfig:f}=l||{};if(l&&c===NetworkErrorAction.RetryRequest&&f){this.resetStartWhenNotLoaded(this.levelLastLoaded);const d=getRetryDelay(f,u);this.warn(`Fragment ${n.sn} of ${r} ${n.level} errored with ${e.details}, retrying loading ${u+1}/${f.maxNumRetry} in ${d}ms`),l.resolved=!0,this.retryDate=self.performance.now()+d,this.state=State.FRAG_LOADING_WAITING_RETRY}else if(f&&l)if(this.resetFragmentErrors(r),u<f.maxNumRetry)!s&&c!==NetworkErrorAction.RemoveAlternatePermanently&&(l.resolved=!0);else{logger.warn(`${e.details} reached or exceeded max retry (${u})`);return}else(l==null?void 0:l.action)===NetworkErrorAction.SendAlternateToPenaltyBox?this.state=State.WAITING_LEVEL:this.state=State.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(r){if(this.state===State.PARSING||this.state===State.PARSED){const e=r.parent,n=this.getFwdBufferInfo(this.mediaBuffer,e),o=n&&n.len>.5;o&&this.reduceMaxBufferLength(n.len);const s=!o;return s&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${e} buffer`),r.frag&&(this.fragmentTracker.removeFragment(r.frag),this.nextLoadPosition=r.frag.start),this.resetLoadingState(),s}return!1}resetFragmentErrors(r){r===PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==State.STOPPED&&(this.state=State.IDLE)}afterBufferFlushed(r,e,n){if(!r)return;const o=BufferHelper.getBuffered(r);this.fragmentTracker.detectEvictedFragments(e,o,n),this.state===State.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=State.IDLE}resetStartWhenNotLoaded(r){if(!this.loadedmetadata){this.startFragRequested=!1;const e=r?r.details:null;e!=null&&e.live?(this.startPosition=-1,this.setStartPosition(e,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(r){this.warn(`The loading context changed while buffering fragment ${r.sn} of level ${r.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(r=0){this.fragmentTracker.removeFragmentsInRange(r,1/0,this.playlistType,!1,!0)}updateLevelTiming(r,e,n,o){var s;const l=n.details;if(!l){this.warn("level.details undefined");return}if(!Object.keys(r.elementaryStreams).reduce((u,f)=>{const d=r.elementaryStreams[f];if(d){const g=d.endPTS-d.startPTS;if(g<=0)return this.warn(`Could not parse fragment ${r.sn} ${f} duration reliably (${g})`),u||!1;const p=o?0:updateFragPTSDTS(l,r,d.startPTS,d.endPTS,d.startDTS,d.endDTS);return this.hls.trigger(Events.LEVEL_PTS_UPDATED,{details:l,level:n,drift:p,type:f,frag:r,start:d.startPTS,end:d.endPTS}),!0}return u},!1)&&((s=this.transmuxer)==null?void 0:s.error)===null){const u=new Error(`Found no media in fragment ${r.sn} of level ${r.level} resetting transmuxer to fallback to playlist timing`);if(n.fragmentError===0&&(n.fragmentError++,r.gap=!0,this.fragmentTracker.removeFragment(r),this.fragmentTracker.fragBuffered(r,!0)),this.warn(u.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:r,reason:`Found no media in msn ${r.sn} of level "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=State.PARSED,this.hls.trigger(Events.FRAG_PARSED,{frag:r,part:e})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(r){r.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(r){const e=this._state;e!==r&&(this._state=r,this.log(`${e}->${r}`))}get state(){return this._state}}class ChunkCache{constructor(){this.chunks=[],this.dataLength=0}push(r){this.chunks.push(r),this.dataLength+=r.length}flush(){const{chunks:r,dataLength:e}=this;let n;if(r.length)r.length===1?n=r[0]:n=concatUint8Arrays(r,e);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function concatUint8Arrays(a,r){const e=new Uint8Array(r);let n=0;for(let o=0;o<a.length;o++){const s=a[o];e.set(s,n),n+=s.length}return e}function hasUMDWorker(){return typeof __HLS_WORKER_BUNDLE__=="function"}function injectWorker(){const a=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),r=self.URL.createObjectURL(a);return{worker:new self.Worker(r),objectURL:r}}function loadWorker(a){const r=new self.URL(a,self.location.href).href;return{worker:new self.Worker(r),scriptURL:r}}function dummyTrack(a="",r=9e4){return{type:a,id:-1,pid:-1,inputTimeScale:r,sequenceNumber:-1,samples:[],dropped:0}}class BaseAudioDemuxer{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(r,e,n,o){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(r){this.initPTS=r,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(r,e){return!1}appendFrame(r,e,n){}demux(r,e){this.cachedData&&(r=appendUint8Array(this.cachedData,r),this.cachedData=null);let n=getID3Data(r,0),o=n?n.length:0,s;const l=this._audioTrack,c=this._id3Track,u=n?getTimeStamp(n):void 0,f=r.length;for((this.basePTS===null||this.frameIndex===0&&isFiniteNumber(u))&&(this.basePTS=initPTSFn(u,e,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});o<f;){if(this.canParse(r,o)){const d=this.appendFrame(l,r,o);d?(this.frameIndex++,this.lastPTS=d.sample.pts,o+=d.length,s=o):o=f}else canParse$2(r,o)?(n=getID3Data(r,o),c.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),o+=n.length,s=o):o++;if(o===f&&s!==f){const d=sliceUint8(r,s);this.cachedData?this.cachedData=appendUint8Array(this.cachedData,d):this.cachedData=d}}return{audioTrack:l,videoTrack:dummyTrack(),id3Track:c,textTrack:dummyTrack()}}demuxSampleAes(r,e,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(r){const e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:dummyTrack(),id3Track:this._id3Track,textTrack:dummyTrack()}}destroy(){}}const initPTSFn=(a,r,e)=>{if(isFiniteNumber(a))return a*90;const n=e?e.baseTime*9e4/e.timescale:0;return r*9e4+n};function getAudioConfig(a,r,e,n){let o,s,l,c;const u=navigator.userAgent.toLowerCase(),f=n,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];o=((r[e+2]&192)>>>6)+1;const g=(r[e+2]&60)>>>2;if(g>d.length-1){const p=new Error(`invalid ADTS sampling index:${g}`);a.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,error:p,reason:p.message});return}return l=(r[e+2]&1)<<2,l|=(r[e+3]&192)>>>6,logger.log(`manifest codec:${n}, ADTS type:${o}, samplingIndex:${g}`),/firefox/i.test(u)?g>=6?(o=5,c=new Array(4),s=g-3):(o=2,c=new Array(2),s=g):u.indexOf("android")!==-1?(o=2,c=new Array(2),s=g):(o=5,c=new Array(4),n&&(n.indexOf("mp4a.40.29")!==-1||n.indexOf("mp4a.40.5")!==-1)||!n&&g>=6?s=g-3:((n&&n.indexOf("mp4a.40.2")!==-1&&(g>=6&&l===1||/vivaldi/i.test(u))||!n&&l===1)&&(o=2,c=new Array(2)),s=g)),c[0]=o<<3,c[0]|=(g&14)>>1,c[1]|=(g&1)<<7,c[1]|=l<<3,o===5&&(c[1]|=(s&14)>>1,c[2]=(s&1)<<7,c[2]|=8,c[3]=0),{config:c,samplerate:d[g],channelCount:l,codec:"mp4a.40."+o,manifestCodec:f}}function isHeaderPattern$1(a,r){return a[r]===255&&(a[r+1]&246)===240}function getHeaderLength(a,r){return a[r+1]&1?7:9}function getFullFrameLength(a,r){return(a[r+3]&3)<<11|a[r+4]<<3|(a[r+5]&224)>>>5}function canGetFrameLength(a,r){return r+5<a.length}function isHeader$1(a,r){return r+1<a.length&&isHeaderPattern$1(a,r)}function canParse$1(a,r){return canGetFrameLength(a,r)&&isHeaderPattern$1(a,r)&&getFullFrameLength(a,r)<=a.length-r}function probe$1(a,r){if(isHeader$1(a,r)){const e=getHeaderLength(a,r);if(r+e>=a.length)return!1;const n=getFullFrameLength(a,r);if(n<=e)return!1;const o=r+n;return o===a.length||isHeader$1(a,o)}return!1}function initTrackConfig(a,r,e,n,o){if(!a.samplerate){const s=getAudioConfig(r,e,n,o);if(!s)return;a.config=s.config,a.samplerate=s.samplerate,a.channelCount=s.channelCount,a.codec=s.codec,a.manifestCodec=s.manifestCodec,logger.log(`parsed codec:${a.codec}, rate:${s.samplerate}, channels:${s.channelCount}`)}}function getFrameDuration(a){return 1024*9e4/a}function parseFrameHeader(a,r){const e=getHeaderLength(a,r);if(r+e<=a.length){const n=getFullFrameLength(a,r)-e;if(n>0)return{headerLength:e,frameLength:n}}}function appendFrame$2(a,r,e,n,o){const s=getFrameDuration(a.samplerate),l=n+o*s,c=parseFrameHeader(r,e);let u;if(c){const{frameLength:g,headerLength:p}=c,v=p+g,m=Math.max(0,e+v-r.length);m?(u=new Uint8Array(v-p),u.set(r.subarray(e+p,r.length),0)):u=r.subarray(e+p,e+v);const y={unit:u,pts:l};return m||a.samples.push(y),{sample:y,length:v,missing:m}}const f=r.length-e;return u=new Uint8Array(f),u.set(r.subarray(e,r.length),0),{sample:{unit:u,pts:l},length:f,missing:-1}}let chromeVersion$1=null;const BitratesMap=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot=[0,1,1,4];function appendFrame$1(a,r,e,n,o){if(e+24>r.length)return;const s=parseHeader(r,e);if(s&&e+s.frameLength<=r.length){const l=s.samplesPerFrame*9e4/s.sampleRate,c=n+o*l,u={unit:r.subarray(e,e+s.frameLength),pts:c,dts:c};return a.config=[],a.channelCount=s.channelCount,a.samplerate=s.sampleRate,a.samples.push(u),{sample:u,length:s.frameLength,missing:0}}}function parseHeader(a,r){const e=a[r+1]>>3&3,n=a[r+1]>>1&3,o=a[r+2]>>4&15,s=a[r+2]>>2&3;if(e!==1&&o!==0&&o!==15&&s!==3){const l=a[r+2]>>1&1,c=a[r+3]>>6,u=e===3?3-n:n===3?3:4,f=BitratesMap[u*14+o-1]*1e3,g=SamplingRateMap[(e===3?0:e===2?1:2)*3+s],p=c===3?1:2,v=SamplesCoefficients[e][n],m=BytesInSlot[n],y=v*8*m,x=Math.floor(v*f/g+l)*m;if(chromeVersion$1===null){const S=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion$1=S?parseInt(S[1]):0}return!!chromeVersion$1&&chromeVersion$1<=87&&n===2&&f>=224e3&&c===0&&(a[r+3]=a[r+3]|128),{sampleRate:g,channelCount:p,frameLength:x,samplesPerFrame:y}}}function isHeaderPattern(a,r){return a[r]===255&&(a[r+1]&224)===224&&(a[r+1]&6)!==0}function isHeader(a,r){return r+1<a.length&&isHeaderPattern(a,r)}function canParse(a,r){return isHeaderPattern(a,r)&&4<=a.length-r}function probe(a,r){if(r+1<a.length&&isHeaderPattern(a,r)){const n=parseHeader(a,r);let o=4;n!=null&&n.frameLength&&(o=n.frameLength);const s=r+o;return s===a.length||isHeader(a,s)}return!1}class AACDemuxer extends BaseAudioDemuxer{constructor(r,e){super(),this.observer=void 0,this.config=void 0,this.observer=r,this.config=e}resetInitSegment(r,e,n,o){super.resetInitSegment(r,e,n,o),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:e,duration:o,inputTimeScale:9e4,dropped:0}}static probe(r){if(!r)return!1;const e=getID3Data(r,0);let n=(e==null?void 0:e.length)||0;if(probe(r,n))return!1;for(let o=r.length;n<o;n++)if(probe$1(r,n))return logger.log("ADTS sync word found !"),!0;return!1}canParse(r,e){return canParse$1(r,e)}appendFrame(r,e,n){initTrackConfig(r,this.observer,e,n,r.manifestCodec);const o=appendFrame$2(r,e,n,this.basePTS,this.frameIndex);if(o&&o.missing===0)return o}}const emsgSchemePattern=/\/emsg[-/]ID3/i;class MP4Demuxer{constructor(r,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}resetTimeStamp(){}resetInitSegment(r,e,n,o){const s=this.videoTrack=dummyTrack("video",1),l=this.audioTrack=dummyTrack("audio",1),c=this.txtTrack=dummyTrack("text",1);if(this.id3Track=dummyTrack("id3",1),this.timeOffset=0,!(r!=null&&r.byteLength))return;const u=parseInitSegment(r);if(u.video){const{id:f,timescale:d,codec:g}=u.video;s.id=f,s.timescale=c.timescale=d,s.codec=g}if(u.audio){const{id:f,timescale:d,codec:g}=u.audio;l.id=f,l.timescale=d,l.codec=g}c.id=RemuxerTrackIdConfig.text,s.sampleDuration=0,s.duration=l.duration=o}resetContiguity(){this.remainderData=null}static probe(r){return hasMoofData(r)}demux(r,e){this.timeOffset=e;let n=r;const o=this.videoTrack,s=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=appendUint8Array(this.remainderData,r));const c=segmentValidRange(n);this.remainderData=c.remainder,o.samples=c.valid||new Uint8Array}else o.samples=n;const l=this.extractID3Track(o,e);return s.samples=parseSamples(e,o),{videoTrack:o,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}}flush(){const r=this.timeOffset,e=this.videoTrack,n=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;const o=this.extractID3Track(e,this.timeOffset);return n.samples=parseSamples(r,e),{videoTrack:e,audioTrack:dummyTrack(),id3Track:o,textTrack:dummyTrack()}}extractID3Track(r,e){const n=this.id3Track;if(r.samples.length){const o=findBox(r.samples,["emsg"]);o&&o.forEach(s=>{const l=parseEmsg(s);if(emsgSchemePattern.test(l.schemeIdUri)){const c=isFiniteNumber(l.presentationTime)?l.presentationTime/l.timeScale:e+l.presentationTimeDelta/l.timeScale;let u=l.eventDuration===4294967295?Number.POSITIVE_INFINITY:l.eventDuration/l.timeScale;u<=.001&&(u=Number.POSITIVE_INFINITY);const f=l.payload;n.samples.push({data:f,len:f.byteLength,dts:c,pts:c,type:MetadataSchema.emsg,duration:u})}})}return n}demuxSampleAes(r,e,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const getAudioBSID=(a,r)=>{let e=0,n=5;r+=n;const o=new Uint32Array(1),s=new Uint32Array(1),l=new Uint8Array(1);for(;n>0;){l[0]=a[r];const c=Math.min(n,8),u=8-c;s[0]=4278190080>>>24+u<<u,o[0]=(l[0]&s[0])>>u,e=e?e<<c|o[0]:o[0],r+=1,n-=c}return e};class AC3Demuxer extends BaseAudioDemuxer{constructor(r){super(),this.observer=void 0,this.observer=r}resetInitSegment(r,e,n,o){super.resetInitSegment(r,e,n,o),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:e,duration:o,inputTimeScale:9e4,dropped:0}}canParse(r,e){return e+64<r.length}appendFrame(r,e,n){const o=appendFrame(r,e,n,this.basePTS,this.frameIndex);if(o!==-1)return{sample:r.samples[r.samples.length-1],length:o,missing:0}}static probe(r){if(!r)return!1;const e=getID3Data(r,0);if(!e)return!1;const n=e.length;return r[n]===11&&r[n+1]===119&&getTimeStamp(e)!==void 0&&getAudioBSID(r,n)<16}}function appendFrame(a,r,e,n,o){if(e+8>r.length||r[e]!==11||r[e+1]!==119)return-1;const s=r[e+4]>>6;if(s>=3)return-1;const c=[48e3,44100,32e3][s],u=r[e+4]&63,d=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][u*3+s]*2;if(e+d>r.length)return-1;const g=r[e+6]>>5;let p=0;g===2?p+=2:(g&1&&g!==1&&(p+=2),g&4&&(p+=2));const v=(r[e+6]<<8|r[e+7])>>12-p&1,y=[2,1,2,3,3,4,4,5][g]+v,x=r[e+5]>>3,_=r[e+5]&7,E=new Uint8Array([s<<6|x<<1|_>>2,(_&3)<<6|g<<3|v<<2|u>>4,u<<4&224]),S=1536/c*9e4,A=n+o*S,T=r.subarray(e,e+d);return a.config=E,a.channelCount=y,a.samplerate=c,a.samples.push({unit:T,pts:A}),d}class BaseVideoParser{constructor(){this.VideoSample=null}createVideoSample(r,e,n,o){return{key:r,frame:!1,pts:e,dts:n,units:[],debug:o,length:0}}getLastNalUnit(r){var e;let n=this.VideoSample,o;if((!n||n.units.length===0)&&(n=r[r.length-1]),(e=n)!=null&&e.units){const s=n.units;o=s[s.length-1]}return o}pushAccessUnit(r,e){if(r.units.length&&r.frame){if(r.pts===void 0){const n=e.samples,o=n.length;if(o){const s=n[o-1];r.pts=s.pts,r.dts=s.dts}else{e.dropped++;return}}e.samples.push(r)}r.debug.length&&logger.log(r.pts+"/"+r.dts+":"+r.debug)}}class ExpGolomb{constructor(r){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=r,this.bytesAvailable=r.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const r=this.data,e=this.bytesAvailable,n=r.byteLength-e,o=new Uint8Array(4),s=Math.min(4,e);if(s===0)throw new Error("no bytes available");o.set(r.subarray(n,n+s)),this.word=new DataView(o.buffer).getUint32(0),this.bitsAvailable=s*8,this.bytesAvailable-=s}skipBits(r){let e;r=Math.min(r,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>r?(this.word<<=r,this.bitsAvailable-=r):(r-=this.bitsAvailable,e=r>>3,r-=e<<3,this.bytesAvailable-=e,this.loadWord(),this.word<<=r,this.bitsAvailable-=r)}readBits(r){let e=Math.min(this.bitsAvailable,r);const n=this.word>>>32-e;if(r>32&&logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0)this.word<<=e;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return e=r-e,e>0&&this.bitsAvailable?n<<e|this.readBits(e):n}skipLZ(){let r;for(r=0;r<this.bitsAvailable;++r)if(this.word&2147483648>>>r)return this.word<<=r,this.bitsAvailable-=r,r;return this.loadWord(),r+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const r=this.skipLZ();return this.readBits(r+1)-1}readEG(){const r=this.readUEG();return 1&r?1+r>>>1:-1*(r>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(r){let e=8,n=8,o;for(let s=0;s<r;s++)n!==0&&(o=this.readEG(),n=(e+o+256)%256),e=n===0?e:n}readSPS(){let r=0,e=0,n=0,o=0,s,l,c;const u=this.readUByte.bind(this),f=this.readBits.bind(this),d=this.readUEG.bind(this),g=this.readBoolean.bind(this),p=this.skipBits.bind(this),v=this.skipEG.bind(this),m=this.skipUEG.bind(this),y=this.skipScalingList.bind(this);u();const x=u();if(f(5),p(3),u(),m(),x===100||x===110||x===122||x===244||x===44||x===83||x===86||x===118||x===128){const b=d();if(b===3&&p(1),m(),m(),p(1),g())for(l=b!==3?8:12,c=0;c<l;c++)g()&&(c<6?y(16):y(64))}m();const _=d();if(_===0)d();else if(_===1)for(p(1),v(),v(),s=d(),c=0;c<s;c++)v();m(),p(1);const E=d(),S=d(),A=f(1);A===0&&p(1),p(1),g()&&(r=d(),e=d(),n=d(),o=d());let T=[1,1];if(g()&&g())switch(u()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:{T=[u()<<8|u(),u()<<8|u()];break}}return{width:Math.ceil((E+1)*16-r*2-e*2),height:(2-A)*(S+1)*16-(A?2:4)*(n+o),pixelRatio:T}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class AvcVideoParser extends BaseVideoParser{parseAVCPES(r,e,n,o,s){const l=this.parseAVCNALu(r,n.data);let c=this.VideoSample,u,f=!1;n.data=null,c&&l.length&&!r.audFound&&(this.pushAccessUnit(c,r),c=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts,"")),l.forEach(d=>{var g;switch(d.type){case 1:{let y=!1;u=!0;const x=d.data;if(f&&x.length>4){const _=new ExpGolomb(x).readSliceType();(_===2||_===4||_===7||_===9)&&(y=!0)}if(y){var p;(p=c)!=null&&p.frame&&!c.key&&(this.pushAccessUnit(c,r),c=this.VideoSample=null)}c||(c=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts,"")),c.frame=!0,c.key=y;break}case 5:u=!0,(g=c)!=null&&g.frame&&!c.key&&(this.pushAccessUnit(c,r),c=this.VideoSample=null),c||(c=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts,"")),c.key=!0,c.frame=!0;break;case 6:{u=!0,parseSEIMessageFromNALu(d.data,1,n.pts,e.samples);break}case 7:{var v,m;u=!0,f=!0;const y=d.data,_=new ExpGolomb(y).readSPS();if(!r.sps||r.width!==_.width||r.height!==_.height||((v=r.pixelRatio)==null?void 0:v[0])!==_.pixelRatio[0]||((m=r.pixelRatio)==null?void 0:m[1])!==_.pixelRatio[1]){r.width=_.width,r.height=_.height,r.pixelRatio=_.pixelRatio,r.sps=[y],r.duration=s;const E=y.subarray(1,4);let S="avc1.";for(let A=0;A<3;A++){let T=E[A].toString(16);T.length<2&&(T="0"+T),S+=T}r.codec=S}break}case 8:u=!0,r.pps=[d.data];break;case 9:u=!0,r.audFound=!0,c&&this.pushAccessUnit(c,r),c=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts,"");break;case 12:u=!0;break;default:u=!1,c&&(c.debug+="unknown NAL "+d.type+" ");break}c&&u&&c.units.push(d)}),o&&c&&(this.pushAccessUnit(c,r),this.VideoSample=null)}parseAVCNALu(r,e){const n=e.byteLength;let o=r.naluState||0;const s=o,l=[];let c=0,u,f,d,g=-1,p=0;for(o===-1&&(g=0,p=e[0]&31,o=0,c=1);c<n;){if(u=e[c++],!o){o=u?0:1;continue}if(o===1){o=u?0:2;continue}if(!u)o=3;else if(u===1){if(f=c-o-1,g>=0){const v={data:e.subarray(g,f),type:p};l.push(v)}else{const v=this.getLastNalUnit(r.samples);v&&(s&&c<=4-s&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-s)),f>0&&(v.data=appendUint8Array(v.data,e.subarray(0,f)),v.state=0))}c<n?(d=e[c]&31,g=c,p=d,o=0):o=-1}else o=0}if(g>=0&&o>=0){const v={data:e.subarray(g,n),type:p,state:o};l.push(v)}if(l.length===0){const v=this.getLastNalUnit(r.samples);v&&(v.data=appendUint8Array(v.data,e))}return r.naluState=o,l}}class SampleAesDecrypter{constructor(r,e,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new Decrypter(e,{removePKCS7Padding:!1})}decryptBuffer(r){return this.decrypter.decrypt(r,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(r,e,n){const o=r[e].unit;if(o.length<=16)return;const s=o.subarray(16,o.length-o.length%16),l=s.buffer.slice(s.byteOffset,s.byteOffset+s.length);this.decryptBuffer(l).then(c=>{const u=new Uint8Array(c);o.set(u,16),this.decrypter.isSync()||this.decryptAacSamples(r,e+1,n)})}decryptAacSamples(r,e,n){for(;;e++){if(e>=r.length){n();return}if(!(r[e].unit.length<32)&&(this.decryptAacSample(r,e,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(r){const e=Math.floor((r.length-48)/160)*16+16,n=new Int8Array(e);let o=0;for(let s=32;s<r.length-16;s+=160,o+=16)n.set(r.subarray(s,s+16),o);return n}getAvcDecryptedUnit(r,e){const n=new Uint8Array(e);let o=0;for(let s=32;s<r.length-16;s+=160,o+=16)r.set(n.subarray(o,o+16),s);return r}decryptAvcSample(r,e,n,o,s){const l=discardEPB(s.data),c=this.getAvcEncryptedData(l);this.decryptBuffer(c.buffer).then(u=>{s.data=this.getAvcDecryptedUnit(l,u),this.decrypter.isSync()||this.decryptAvcSamples(r,e,n+1,o)})}decryptAvcSamples(r,e,n,o){if(r instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,n=0){if(e>=r.length){o();return}const s=r[e].units;for(;!(n>=s.length);n++){const l=s[n];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(r,e,n,o,l),!this.decrypter.isSync()))return}}}}const PACKET_LENGTH=188;class TSDemuxer{constructor(r,e,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=r,this.config=e,this.typeSupported=n,this.videoParser=new AvcVideoParser}static probe(r){const e=TSDemuxer.syncOffset(r);return e>0&&logger.warn(`MPEG2-TS detected but first sync word found @ offset ${e}`),e!==-1}static syncOffset(r){const e=r.length;let n=Math.min(PACKET_LENGTH*5,e-PACKET_LENGTH)+1,o=0;for(;o<n;){let s=!1,l=-1,c=0;for(let u=o;u<e;u+=PACKET_LENGTH)if(r[u]===71&&(e-u===PACKET_LENGTH||r[u+PACKET_LENGTH]===71)){if(c++,l===-1&&(l=u,l!==0&&(n=Math.min(l+PACKET_LENGTH*99,r.length-PACKET_LENGTH)+1)),s||(s=parsePID(r,u)===0),s&&c>1&&(l===0&&c>2||u+PACKET_LENGTH>n))return l}else{if(c)return-1;break}o++}return-1}static createTrack(r,e){return{container:r==="video"||r==="audio"?"video/mp2t":void 0,type:r,id:RemuxerTrackIdConfig[r],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:r==="audio"?e:void 0}}resetInitSegment(r,e,n,o){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=TSDemuxer.createTrack("video"),this._audioTrack=TSDemuxer.createTrack("audio",o),this._id3Track=TSDemuxer.createTrack("id3"),this._txtTrack=TSDemuxer.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=e,this.videoCodec=n,this._duration=o}resetTimeStamp(){}resetContiguity(){const{_audioTrack:r,_videoTrack:e,_id3Track:n}=this;r&&(r.pesData=null),e&&(e.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(r,e,n=!1,o=!1){n||(this.sampleAes=null);let s;const l=this._videoTrack,c=this._audioTrack,u=this._id3Track,f=this._txtTrack;let d=l.pid,g=l.pesData,p=c.pid,v=u.pid,m=c.pesData,y=u.pesData,x=null,_=this.pmtParsed,E=this._pmtId,S=r.length;if(this.remainderData&&(r=appendUint8Array(this.remainderData,r),S=r.length,this.remainderData=null),S<PACKET_LENGTH&&!o)return this.remainderData=r,{audioTrack:c,videoTrack:l,id3Track:u,textTrack:f};const A=Math.max(0,TSDemuxer.syncOffset(r));S-=(S-A)%PACKET_LENGTH,S<r.byteLength&&!o&&(this.remainderData=new Uint8Array(r.buffer,S,r.buffer.byteLength-S));let T=0;for(let C=A;C<S;C+=PACKET_LENGTH)if(r[C]===71){const L=!!(r[C+1]&64),R=parsePID(r,C),I=(r[C+3]&48)>>4;let w;if(I>1){if(w=C+5+r[C+4],w===C+PACKET_LENGTH)continue}else w=C+4;switch(R){case d:L&&(g&&(s=parsePES(g))&&this.videoParser.parseAVCPES(l,f,s,!1,this._duration),g={data:[],size:0}),g&&(g.data.push(r.subarray(w,C+PACKET_LENGTH)),g.size+=C+PACKET_LENGTH-w);break;case p:if(L){if(m&&(s=parsePES(m)))switch(c.segmentCodec){case"aac":this.parseAACPES(c,s);break;case"mp3":this.parseMPEGPES(c,s);break;case"ac3":this.parseAC3PES(c,s);break}m={data:[],size:0}}m&&(m.data.push(r.subarray(w,C+PACKET_LENGTH)),m.size+=C+PACKET_LENGTH-w);break;case v:L&&(y&&(s=parsePES(y))&&this.parseID3PES(u,s),y={data:[],size:0}),y&&(y.data.push(r.subarray(w,C+PACKET_LENGTH)),y.size+=C+PACKET_LENGTH-w);break;case 0:L&&(w+=r[w]+1),E=this._pmtId=parsePAT(r,w);break;case E:{L&&(w+=r[w]+1);const M=parsePMT(r,w,this.typeSupported,n,this.observer);d=M.videoPid,d>0&&(l.pid=d,l.segmentCodec=M.segmentVideoCodec),p=M.audioPid,p>0&&(c.pid=p,c.segmentCodec=M.segmentAudioCodec),v=M.id3Pid,v>0&&(u.pid=v),x!==null&&!_&&(logger.warn(`MPEG-TS PMT found at ${C} after unknown PID '${x}'. Backtracking to sync byte @${A} to parse all TS packets.`),x=null,C=A-188),_=this.pmtParsed=!0;break}case 17:case 8191:break;default:x=R;break}}else T++;T>0&&emitParsingError(this.observer,new Error(`Found ${T} TS packet/s that do not start with 0x47`)),l.pesData=g,c.pesData=m,u.pesData=y;const b={audioTrack:c,videoTrack:l,id3Track:u,textTrack:f};return o&&this.extractRemainingSamples(b),b}flush(){const{remainderData:r}=this;this.remainderData=null;let e;return r?e=this.demux(r,-1,!1,!0):e={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e}extractRemainingSamples(r){const{audioTrack:e,videoTrack:n,id3Track:o,textTrack:s}=r,l=n.pesData,c=e.pesData,u=o.pesData;let f;if(l&&(f=parsePES(l))?(this.videoParser.parseAVCPES(n,s,f,!0,this._duration),n.pesData=null):n.pesData=l,c&&(f=parsePES(c))){switch(e.segmentCodec){case"aac":this.parseAACPES(e,f);break;case"mp3":this.parseMPEGPES(e,f);break;case"ac3":this.parseAC3PES(e,f);break}e.pesData=null}else c!=null&&c.size&&logger.log("last AAC PES packet truncated,might overlap between fragments"),e.pesData=c;u&&(f=parsePES(u))?(this.parseID3PES(o,f),o.pesData=null):o.pesData=u}demuxSampleAes(r,e,n){const o=this.demux(r,n,!0,!this.config.progressive),s=this.sampleAes=new SampleAesDecrypter(this.observer,this.config,e);return this.decrypt(o,s)}decrypt(r,e){return new Promise(n=>{const{audioTrack:o,videoTrack:s}=r;o.samples&&o.segmentCodec==="aac"?e.decryptAacSamples(o.samples,0,()=>{s.samples?e.decryptAvcSamples(s.samples,0,0,()=>{n(r)}):n(r)}):s.samples&&e.decryptAvcSamples(s.samples,0,0,()=>{n(r)})})}destroy(){this._duration=0}parseAACPES(r,e){let n=0;const o=this.aacOverFlow;let s=e.data;if(o){this.aacOverFlow=null;const g=o.missing,p=o.sample.unit.byteLength;if(g===-1)s=appendUint8Array(o.sample.unit,s);else{const v=p-g;o.sample.unit.set(s.subarray(0,g),v),r.samples.push(o.sample),n=o.missing}}let l,c;for(l=n,c=s.length;l<c-1&&!isHeader$1(s,l);l++);if(l!==n){let g;const p=l<c-1;if(p?g=`AAC PES did not start with ADTS header,offset:${l}`:g="No ADTS header found in AAC PES",emitParsingError(this.observer,new Error(g),p),!p)return}initTrackConfig(r,this.observer,s,l,this.audioCodec);let u;if(e.pts!==void 0)u=e.pts;else if(o){const g=getFrameDuration(r.samplerate);u=o.sample.pts+g}else{logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let f=0,d;for(;l<c;)if(d=appendFrame$2(r,s,l,u,f),l+=d.length,d.missing){this.aacOverFlow=d;break}else for(f++;l<c-1&&!isHeader$1(s,l);l++);}parseMPEGPES(r,e){const n=e.data,o=n.length;let s=0,l=0;const c=e.pts;if(c===void 0){logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<o;)if(isHeader(n,l)){const u=appendFrame$1(r,n,l,c,s);if(u)l+=u.length,s++;else break}else l++}parseAC3PES(r,e){{const n=e.data,o=e.pts;if(o===void 0){logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const s=n.length;let l=0,c=0,u;for(;c<s&&(u=appendFrame(r,n,c,o,l++))>0;)c+=u}}parseID3PES(r,e){if(e.pts===void 0){logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=_extends({},e,{type:this._videoTrack?MetadataSchema.emsg:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});r.samples.push(n)}}function parsePID(a,r){return((a[r+1]&31)<<8)+a[r+2]}function parsePAT(a,r){return(a[r+10]&31)<<8|a[r+11]}function parsePMT(a,r,e,n,o){const s={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},l=(a[r+1]&15)<<8|a[r+2],c=r+3+l-4,u=(a[r+10]&15)<<8|a[r+11];for(r+=12+u;r<c;){const f=parsePID(a,r),d=(a[r+3]&15)<<8|a[r+4];switch(a[r]){case 207:if(!n){logEncryptedSamplesFoundInUnencryptedStream("ADTS AAC");break}case 15:s.audioPid===-1&&(s.audioPid=f);break;case 21:s.id3Pid===-1&&(s.id3Pid=f);break;case 219:if(!n){logEncryptedSamplesFoundInUnencryptedStream("H.264");break}case 27:s.videoPid===-1&&(s.videoPid=f,s.segmentVideoCodec="avc");break;case 3:case 4:!e.mpeg&&!e.mp3?logger.log("MPEG audio found, not supported in this browser"):s.audioPid===-1&&(s.audioPid=f,s.segmentAudioCodec="mp3");break;case 193:if(!n){logEncryptedSamplesFoundInUnencryptedStream("AC-3");break}case 129:e.ac3?s.audioPid===-1&&(s.audioPid=f,s.segmentAudioCodec="ac3"):logger.log("AC-3 audio found, not supported in this browser");break;case 6:if(s.audioPid===-1&&d>0){let g=r+5,p=d;for(;p>2;){switch(a[g]){case 106:e.ac3!==!0?logger.log("AC-3 audio found, not supported in this browser for now"):(s.audioPid=f,s.segmentAudioCodec="ac3");break}const m=a[g+1]+2;g+=m,p-=m}}break;case 194:case 135:return emitParsingError(o,new Error("Unsupported EC-3 in M2TS found")),s;case 36:return emitParsingError(o,new Error("Unsupported HEVC in M2TS found")),s}r+=d+5}return s}function emitParsingError(a,r,e){logger.warn(`parsing error: ${r.message}`),a.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,levelRetry:e,error:r,reason:r.message})}function logEncryptedSamplesFoundInUnencryptedStream(a){logger.log(`${a} with AES-128-CBC encryption found in unencrypted stream`)}function parsePES(a){let r=0,e,n,o,s,l;const c=a.data;if(!a||a.size===0)return null;for(;c[0].length<19&&c.length>1;)c[0]=appendUint8Array(c[0],c[1]),c.splice(1,1);if(e=c[0],(e[0]<<16)+(e[1]<<8)+e[2]===1){if(n=(e[4]<<8)+e[5],n&&n>a.size-6)return null;const f=e[7];f&192&&(s=(e[9]&14)*536870912+(e[10]&255)*4194304+(e[11]&254)*16384+(e[12]&255)*128+(e[13]&254)/2,f&64?(l=(e[14]&14)*536870912+(e[15]&255)*4194304+(e[16]&254)*16384+(e[17]&255)*128+(e[18]&254)/2,s-l>60*9e4&&(logger.warn(`${Math.round((s-l)/9e4)}s delta between PTS and DTS, align them`),s=l)):l=s),o=e[8];let d=o+9;if(a.size<=d)return null;a.size-=d;const g=new Uint8Array(a.size);for(let p=0,v=c.length;p<v;p++){e=c[p];let m=e.byteLength;if(d)if(d>m){d-=m;continue}else e=e.subarray(d),m-=d,d=0;g.set(e,r),r+=m}return n&&(n-=o+3),{data:g,pts:s,dts:l,len:n}}return null}class MP3Demuxer extends BaseAudioDemuxer{resetInitSegment(r,e,n,o){super.resetInitSegment(r,e,n,o),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:e,duration:o,inputTimeScale:9e4,dropped:0}}static probe(r){if(!r)return!1;const e=getID3Data(r,0);let n=(e==null?void 0:e.length)||0;if(e&&r[n]===11&&r[n+1]===119&&getTimeStamp(e)!==void 0&&getAudioBSID(r,n)<=16)return!1;for(let o=r.length;n<o;n++)if(probe(r,n))return logger.log("MPEG Audio sync word found !"),!0;return!1}canParse(r,e){return canParse(r,e)}appendFrame(r,e,n){if(this.basePTS!==null)return appendFrame$1(r,e,n,this.basePTS,this.frameIndex)}}class AAC{static getSilentFrame(r,e){switch(r){case"mp4a.40.2":if(e===1)return new Uint8Array([0,200,0,128,35,128]);if(e===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(e===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(e===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(e===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(e===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(e===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(e===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const UINT32_MAX=Math.pow(2,32)-1;class MP4{static init(){MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let r;for(r in MP4.types)MP4.types.hasOwnProperty(r)&&(MP4.types[r]=[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3)]);const e=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:e,audio:n};const o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=s,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const l=new Uint8Array([105,115,111,109]),c=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,l,u,l,c),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,o))}static box(r,...e){let n=8,o=e.length;const s=o;for(;o--;)n+=e[o].byteLength;const l=new Uint8Array(n);for(l[0]=n>>24&255,l[1]=n>>16&255,l[2]=n>>8&255,l[3]=n&255,l.set(r,4),o=0,n=8;o<s;o++)l.set(e[o],n),n+=e[o].byteLength;return l}static hdlr(r){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[r])}static mdat(r){return MP4.box(MP4.types.mdat,r)}static mdhd(r,e){e*=r;const n=Math.floor(e/(UINT32_MAX+1)),o=Math.floor(e%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,r&255,n>>24,n>>16&255,n>>8&255,n&255,o>>24,o>>16&255,o>>8&255,o&255,85,196,0,0]))}static mdia(r){return MP4.box(MP4.types.mdia,MP4.mdhd(r.timescale,r.duration),MP4.hdlr(r.type),MP4.minf(r))}static mfhd(r){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255]))}static minf(r){return r.type==="audio"?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(r)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(r))}static moof(r,e,n){return MP4.box(MP4.types.moof,MP4.mfhd(r),MP4.traf(n,e))}static moov(r){let e=r.length;const n=[];for(;e--;)n[e]=MP4.trak(r[e]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(r[0].timescale,r[0].duration)].concat(n).concat(MP4.mvex(r)))}static mvex(r){let e=r.length;const n=[];for(;e--;)n[e]=MP4.trex(r[e]);return MP4.box.apply(null,[MP4.types.mvex,...n])}static mvhd(r,e){e*=r;const n=Math.floor(e/(UINT32_MAX+1)),o=Math.floor(e%(UINT32_MAX+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,r&255,n>>24,n>>16&255,n>>8&255,n&255,o>>24,o>>16&255,o>>8&255,o&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,s)}static sdtp(r){const e=r.samples||[],n=new Uint8Array(4+e.length);let o,s;for(o=0;o<e.length;o++)s=e[o].flags,n[o+4]=s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy;return MP4.box(MP4.types.sdtp,n)}static stbl(r){return MP4.box(MP4.types.stbl,MP4.stsd(r),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))}static avc1(r){let e=[],n=[],o,s,l;for(o=0;o<r.sps.length;o++)s=r.sps[o],l=s.byteLength,e.push(l>>>8&255),e.push(l&255),e=e.concat(Array.prototype.slice.call(s));for(o=0;o<r.pps.length;o++)s=r.pps[o],l=s.byteLength,n.push(l>>>8&255),n.push(l&255),n=n.concat(Array.prototype.slice.call(s));const c=MP4.box(MP4.types.avcC,new Uint8Array([1,e[3],e[4],e[5],255,224|r.sps.length].concat(e).concat([r.pps.length]).concat(n))),u=r.width,f=r.height,d=r.pixelRatio[0],g=r.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,g>>24,g>>16&255,g>>8&255,g&255])))}static esds(r){const e=r.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(r.config).concat([6,1,2]))}static audioStsd(r){const e=r.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r.channelCount,0,16,0,0,0,0,e>>8&255,e&255,0,0])}static mp4a(r){return MP4.box(MP4.types.mp4a,MP4.audioStsd(r),MP4.box(MP4.types.esds,MP4.esds(r)))}static mp3(r){return MP4.box(MP4.types[".mp3"],MP4.audioStsd(r))}static ac3(r){return MP4.box(MP4.types["ac-3"],MP4.audioStsd(r),MP4.box(MP4.types.dac3,r.config))}static stsd(r){return r.type==="audio"?r.segmentCodec==="mp3"&&r.codec==="mp3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(r)):r.segmentCodec==="ac3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.ac3(r)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(r)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(r))}static tkhd(r){const e=r.id,n=r.duration*r.timescale,o=r.width,s=r.height,l=Math.floor(n/(UINT32_MAX+1)),c=Math.floor(n%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,c>>24,c>>16&255,c>>8&255,c&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,o&255,0,0,s>>8&255,s&255,0,0]))}static traf(r,e){const n=MP4.sdtp(r),o=r.id,s=Math.floor(e/(UINT32_MAX+1)),l=Math.floor(e%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,s&255,l>>24,l>>16&255,l>>8&255,l&255])),MP4.trun(r,n.length+16+20+8+16+8+8),n)}static trak(r){return r.duration=r.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(r),MP4.mdia(r))}static trex(r){const e=r.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(r,e){const n=r.samples||[],o=n.length,s=12+16*o,l=new Uint8Array(s);let c,u,f,d,g,p;for(e+=8+s,l.set([r.type==="video"?1:0,0,15,1,o>>>24&255,o>>>16&255,o>>>8&255,o&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255],0),c=0;c<o;c++)u=n[c],f=u.duration,d=u.size,g=u.flags,p=u.cts,l.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,g.isLeading<<2|g.dependsOn,g.isDependedOn<<6|g.hasRedundancy<<4|g.paddingValue<<1|g.isNonSync,g.degradPrio&61440,g.degradPrio&15,p>>>24&255,p>>>16&255,p>>>8&255,p&255],12+16*c);return MP4.box(MP4.types.trun,l)}static initSegment(r){MP4.types||MP4.init();const e=MP4.moov(r);return appendUint8Array(MP4.FTYP,e)}}MP4.types=void 0;MP4.HDLR_TYPES=void 0;MP4.STTS=void 0;MP4.STSC=void 0;MP4.STCO=void 0;MP4.STSZ=void 0;MP4.VMHD=void 0;MP4.SMHD=void 0;MP4.STSD=void 0;MP4.FTYP=void 0;MP4.DINF=void 0;const MPEG_TS_CLOCK_FREQ_HZ=9e4;function toTimescaleFromBase(a,r,e=1,n=!1){const o=a*r*e;return n?Math.round(o):o}function toTimescaleFromScale(a,r,e=1,n=!1){return toTimescaleFromBase(a,r,1/e,n)}function toMsFromMpegTsClock(a,r=!1){return toTimescaleFromBase(a,1e3,1/MPEG_TS_CLOCK_FREQ_HZ,r)}function toMpegTsClockFromTimescale(a,r=1){return toTimescaleFromBase(a,MPEG_TS_CLOCK_FREQ_HZ,1/r)}const MAX_SILENT_FRAME_DURATION=10*1e3,AAC_SAMPLES_PER_FRAME=1024,MPEG_AUDIO_SAMPLE_PER_FRAME=1152,AC3_SAMPLES_PER_FRAME=1536;let chromeVersion=null,safariWebkitVersion=null;class MP4Remuxer{constructor(r,e,n,o=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=r,this.config=e,this.typeSupported=n,this.ISGenerated=!1,chromeVersion===null){const l=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion=l?parseInt(l[1]):0}if(safariWebkitVersion===null){const s=navigator.userAgent.match(/Safari\/(\d+)/i);safariWebkitVersion=s?parseInt(s[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(r){logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=r}resetNextTimestamp(){logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(r){let e=!1;const n=r.reduce((o,s)=>{const l=s.pts-o;return l<-4294967296?(e=!0,normalizePts(o,s.pts)):l>0?o:s.pts},r[0].pts);return e&&logger.debug("PTS rollover detected"),n}remux(r,e,n,o,s,l,c,u){let f,d,g,p,v,m,y=s,x=s;const _=r.pid>-1,E=e.pid>-1,S=e.samples.length,A=r.samples.length>0,T=c&&S>0||S>1;if((!_||A)&&(!E||T)||this.ISGenerated||c){if(this.ISGenerated){var C,L,R,I;const O=this.videoTrackConfig;O&&(e.width!==O.width||e.height!==O.height||((C=e.pixelRatio)==null?void 0:C[0])!==((L=O.pixelRatio)==null?void 0:L[0])||((R=e.pixelRatio)==null?void 0:R[1])!==((I=O.pixelRatio)==null?void 0:I[1]))&&this.resetInitSegment()}else g=this.generateIS(r,e,s,l);const w=this.isVideoContiguous;let M=-1,D;if(T&&(M=findKeyframeIndex(e.samples),!w&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,M>0){logger.warn(`[mp4-remuxer]: Dropped ${M} out of ${S} video samples due to a missing keyframe`);const O=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(M),e.dropped+=M,x+=(e.samples[0].pts-O)/e.inputTimeScale,D=x}else M===-1&&(logger.warn(`[mp4-remuxer]: No keyframe found out of ${S} video samples`),m=!1);if(this.ISGenerated){if(A&&T){const O=this.getVideoStartPts(e.samples),k=(normalizePts(r.samples[0].pts,O)-O)/e.inputTimeScale;y+=Math.max(0,k),x+=Math.max(0,-k)}if(A){if(r.samplerate||(logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),g=this.generateIS(r,e,s,l)),d=this.remuxAudio(r,y,this.isAudioContiguous,l,E||T||u===PlaylistLevelType.AUDIO?x:void 0),T){const O=d?d.endPTS-d.startPTS:0;e.inputTimeScale||(logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),g=this.generateIS(r,e,s,l)),f=this.remuxVideo(e,x,w,O)}}else T&&(f=this.remuxVideo(e,x,w,0));f&&(f.firstKeyFrame=M,f.independent=M!==-1,f.firstKeyFramePTS=D)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(v=flushTextTrackMetadataCueSamples(n,s,this._initPTS,this._initDTS)),o.samples.length&&(p=flushTextTrackUserdataCueSamples(o,s,this._initPTS))),{audio:d,video:f,initSegment:g,independent:m,text:p,id3:v}}generateIS(r,e,n,o){const s=r.samples,l=e.samples,c=this.typeSupported,u={},f=this._initPTS;let d=!f||o,g="audio/mp4",p,v,m;if(d&&(p=v=1/0),r.config&&s.length){switch(r.timescale=r.samplerate,r.segmentCodec){case"mp3":c.mpeg?(g="audio/mpeg",r.codec=""):c.mp3&&(r.codec="mp3");break;case"ac3":r.codec="ac-3";break}u.audio={id:"audio",container:g,codec:r.codec,initSegment:r.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):MP4.initSegment([r]),metadata:{channelCount:r.channelCount}},d&&(m=r.inputTimeScale,!f||m!==f.timescale?p=v=s[0].pts-Math.round(m*n):d=!1)}if(e.sps&&e.pps&&l.length){if(e.timescale=e.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:MP4.initSegment([e]),metadata:{width:e.width,height:e.height}},d)if(m=e.inputTimeScale,!f||m!==f.timescale){const y=this.getVideoStartPts(l),x=Math.round(m*n);v=Math.min(v,normalizePts(l[0].dts,y)-x),p=Math.min(p,y-x)}else d=!1;this.videoTrackConfig={width:e.width,height:e.height,pixelRatio:e.pixelRatio}}if(Object.keys(u).length)return this.ISGenerated=!0,d?(this._initPTS={baseTime:p,timescale:m},this._initDTS={baseTime:v,timescale:m}):p=m=void 0,{tracks:u,initPTS:p,timescale:m}}remuxVideo(r,e,n,o){const s=r.inputTimeScale,l=r.samples,c=[],u=l.length,f=this._initPTS;let d=this.nextAvcDts,g=8,p=this.videoSampleDuration,v,m,y=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY,_=!1;if(!n||d===null){const N=e*s,B=l[0].pts-normalizePts(l[0].dts,l[0].pts);chromeVersion&&d!==null&&Math.abs(N-B-d)<15e3?n=!0:d=N-B}const E=f.baseTime*s/f.timescale;for(let N=0;N<u;N++){const B=l[N];B.pts=normalizePts(B.pts-E,d),B.dts=normalizePts(B.dts-E,d),B.dts<l[N>0?N-1:N].dts&&(_=!0)}_&&l.sort(function(N,B){const G=N.dts-B.dts,z=N.pts-B.pts;return G||z}),v=l[0].dts,m=l[l.length-1].dts;const S=m-v,A=S?Math.round(S/(u-1)):p||r.inputTimeScale/30;if(n){const N=v-d,B=N>A,G=N<-1;if((B||G)&&(B?logger.warn(`AVC: ${toMsFromMpegTsClock(N,!0)} ms (${N}dts) hole between fragments detected at ${e.toFixed(3)}`):logger.warn(`AVC: ${toMsFromMpegTsClock(-N,!0)} ms (${N}dts) overlapping between fragments detected at ${e.toFixed(3)}`),!G||d>=l[0].pts||chromeVersion)){v=d;const z=l[0].pts-N;if(B)l[0].dts=v,l[0].pts=z;else for(let H=0;H<l.length&&!(l[H].dts>z);H++)l[H].dts-=N,l[H].pts-=N;logger.log(`Video: Initial PTS/DTS adjusted: ${toMsFromMpegTsClock(z,!0)}/${toMsFromMpegTsClock(v,!0)}, delta: ${toMsFromMpegTsClock(N,!0)} ms`)}}v=Math.max(0,v);let T=0,b=0,C=v;for(let N=0;N<u;N++){const B=l[N],G=B.units,z=G.length;let H=0;for(let W=0;W<z;W++)H+=G[W].data.length;b+=H,T+=z,B.length=H,B.dts<C?(B.dts=C,C+=A/4|0||1):C=B.dts,y=Math.min(B.pts,y),x=Math.max(B.pts,x)}m=l[u-1].dts;const L=b+4*T+8;let R;try{R=new Uint8Array(L)}catch(N){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:N,bytes:L,reason:`fail allocating video mdat ${L}`});return}const I=new DataView(R.buffer);I.setUint32(0,L),R.set(MP4.types.mdat,4);let w=!1,M=Number.POSITIVE_INFINITY,D=Number.POSITIVE_INFINITY,O=Number.NEGATIVE_INFINITY,F=Number.NEGATIVE_INFINITY;for(let N=0;N<u;N++){const B=l[N],G=B.units;let z=0;for(let Y=0,K=G.length;Y<K;Y++){const Z=G[Y],tt=Z.data,et=Z.data.byteLength;I.setUint32(g,et),g+=4,R.set(tt,g),g+=et,z+=4+et}let H;if(N<u-1)p=l[N+1].dts-B.dts,H=l[N+1].pts-B.pts;else{const Y=this.config,K=N>0?B.dts-l[N-1].dts:A;if(H=N>0?B.pts-l[N-1].pts:A,Y.stretchShortVideoTrack&&this.nextAudioPts!==null){const Z=Math.floor(Y.maxBufferHole*s),tt=(o?y+o*s:this.nextAudioPts)-B.pts;tt>Z?(p=tt-K,p<0?p=K:w=!0,logger.log(`[mp4-remuxer]: It is approximately ${tt/90} ms to the next segment; using duration ${p/90} ms for the last video frame.`)):p=K}else p=K}const W=Math.round(B.pts-B.dts);M=Math.min(M,p),O=Math.max(O,p),D=Math.min(D,H),F=Math.max(F,H),c.push(new Mp4Sample(B.key,p,z,W))}if(c.length){if(chromeVersion){if(chromeVersion<70){const N=c[0].flags;N.dependsOn=2,N.isNonSync=0}}else if(safariWebkitVersion&&F-D<O-M&&A/O<.025&&c[0].cts===0){logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let N=v;for(let B=0,G=c.length;B<G;B++){const z=N+c[B].duration,H=N+c[B].cts;if(B<G-1){const W=z+c[B+1].cts;c[B].duration=W-H}else c[B].duration=B?c[B-1].duration:A;c[B].cts=0,N=z}}}p=w||!p?A:p,this.nextAvcDts=d=m+p,this.videoSampleDuration=p,this.isVideoContiguous=!0;const k=MP4.moof(r.sequenceNumber++,v,_extends({},r,{samples:c})),$="video",V={data1:k,data2:R,startPTS:y/s,endPTS:(x+p)/s,startDTS:v/s,endDTS:d/s,type:$,hasAudio:!1,hasVideo:!0,nb:c.length,dropped:r.dropped};return r.samples=[],r.dropped=0,V}getSamplesPerFrame(r){switch(r.segmentCodec){case"mp3":return MPEG_AUDIO_SAMPLE_PER_FRAME;case"ac3":return AC3_SAMPLES_PER_FRAME;default:return AAC_SAMPLES_PER_FRAME}}remuxAudio(r,e,n,o,s){const l=r.inputTimeScale,c=r.samplerate?r.samplerate:l,u=l/c,f=this.getSamplesPerFrame(r),d=f*u,g=this._initPTS,p=r.segmentCodec==="mp3"&&this.typeSupported.mpeg,v=[],m=s!==void 0;let y=r.samples,x=p?0:8,_=this.nextAudioPts||-1;const E=e*l,S=g.baseTime*l/g.timescale;if(this.isAudioContiguous=n=n||y.length&&_>0&&(o&&Math.abs(E-_)<9e3||Math.abs(normalizePts(y[0].pts-S,E)-_)<20*d),y.forEach(function(k){k.pts=normalizePts(k.pts-S,E)}),!n||_<0){if(y=y.filter(k=>k.pts>=0),!y.length)return;s===0?_=0:o&&!m?_=Math.max(0,E):_=y[0].pts}if(r.segmentCodec==="aac"){const k=this.config.maxAudioFramesDrift;for(let $=0,V=_;$<y.length;$++){const N=y[$],B=N.pts,G=B-V,z=Math.abs(1e3*G/l);if(G<=-k*d&&m)$===0&&(logger.warn(`Audio frame @ ${(B/l).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*G/l)} ms.`),this.nextAudioPts=_=V=B);else if(G>=k*d&&z<MAX_SILENT_FRAME_DURATION&&m){let H=Math.round(G/d);V=B-H*d,V<0&&(H--,V+=d),$===0&&(this.nextAudioPts=_=V),logger.warn(`[mp4-remuxer]: Injecting ${H} audio frame @ ${(V/l).toFixed(3)}s due to ${Math.round(1e3*G/l)} ms gap.`);for(let W=0;W<H;W++){const Y=Math.max(V,0);let K=AAC.getSilentFrame(r.manifestCodec||r.codec,r.channelCount);K||(logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),K=N.unit.subarray()),y.splice($,0,{unit:K,pts:Y}),V+=d,$++}}N.pts=V,V+=d}}let A=null,T=null,b,C=0,L=y.length;for(;L--;)C+=y[L].unit.byteLength;for(let k=0,$=y.length;k<$;k++){const V=y[k],N=V.unit;let B=V.pts;if(T!==null){const z=v[k-1];z.duration=Math.round((B-T)/u)}else if(n&&r.segmentCodec==="aac"&&(B=_),A=B,C>0){C+=x;try{b=new Uint8Array(C)}catch(z){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:z,bytes:C,reason:`fail allocating audio mdat ${C}`});return}p||(new DataView(b.buffer).setUint32(0,C),b.set(MP4.types.mdat,4))}else return;b.set(N,x);const G=N.byteLength;x+=G,v.push(new Mp4Sample(!0,f,G,0)),T=B}const R=v.length;if(!R)return;const I=v[v.length-1];this.nextAudioPts=_=T+u*I.duration;const w=p?new Uint8Array(0):MP4.moof(r.sequenceNumber++,A/u,_extends({},r,{samples:v}));r.samples=[];const M=A/l,D=_/l,F={data1:w,data2:b,startPTS:M,endPTS:D,startDTS:M,endDTS:D,type:"audio",hasAudio:!0,hasVideo:!1,nb:R};return this.isAudioContiguous=!0,F}remuxEmptyAudio(r,e,n,o){const s=r.inputTimeScale,l=r.samplerate?r.samplerate:s,c=s/l,u=this.nextAudioPts,f=this._initDTS,d=f.baseTime*9e4/f.timescale,g=(u!==null?u:o.startDTS*s)+d,p=o.endDTS*s+d,v=c*AAC_SAMPLES_PER_FRAME,m=Math.ceil((p-g)/v),y=AAC.getSilentFrame(r.manifestCodec||r.codec,r.channelCount);if(logger.warn("[mp4-remuxer]: remux empty Audio"),!y){logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const x=[];for(let _=0;_<m;_++){const E=g+_*v;x.push({unit:y,pts:E,dts:E})}return r.samples=x,this.remuxAudio(r,e,n,!1)}}function normalizePts(a,r){let e;if(r===null)return a;for(r<a?e=-8589934592:e=8589934592;Math.abs(a-r)>4294967296;)a+=e;return a}function findKeyframeIndex(a){for(let r=0;r<a.length;r++)if(a[r].key)return r;return-1}function flushTextTrackMetadataCueSamples(a,r,e,n){const o=a.samples.length;if(!o)return;const s=a.inputTimeScale;for(let c=0;c<o;c++){const u=a.samples[c];u.pts=normalizePts(u.pts-e.baseTime*s/e.timescale,r*s)/s,u.dts=normalizePts(u.dts-n.baseTime*s/n.timescale,r*s)/s}const l=a.samples;return a.samples=[],{samples:l}}function flushTextTrackUserdataCueSamples(a,r,e){const n=a.samples.length;if(!n)return;const o=a.inputTimeScale;for(let l=0;l<n;l++){const c=a.samples[l];c.pts=normalizePts(c.pts-e.baseTime*o/e.timescale,r*o)/o}a.samples.sort((l,c)=>l.pts-c.pts);const s=a.samples;return a.samples=[],{samples:s}}class Mp4Sample{constructor(r,e,n,o){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=n,this.cts=o,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:r?2:1,isNonSync:r?0:1}}}class PassThroughRemuxer{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(r){this.initPTS=r,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(r,e,n,o){this.audioCodec=e,this.videoCodec=n,this.generateInitSegment(patchEncyptionData(r,o)),this.emitInitSegment=!0}generateInitSegment(r){let{audioCodec:e,videoCodec:n}=this;if(!(r!=null&&r.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const o=this.initData=parseInitSegment(r);o.audio&&(e=getParsedTrackCodec(o.audio,ElementaryStreamTypes.AUDIO)),o.video&&(n=getParsedTrackCodec(o.video,ElementaryStreamTypes.VIDEO));const s={};o.audio&&o.video?s.audiovideo={container:"video/mp4",codec:e+","+n,initSegment:r,id:"main"}:o.audio?s.audio={container:"audio/mp4",codec:e,initSegment:r,id:"audio"}:o.video?s.video={container:"video/mp4",codec:n,initSegment:r,id:"main"}:logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=s}remux(r,e,n,o,s,l){var c,u;let{initPTS:f,lastEndTime:d}=this;const g={audio:void 0,video:void 0,text:o,id3:n,initSegment:void 0};isFiniteNumber(d)||(d=this.lastEndTime=s||0);const p=e.samples;if(!(p!=null&&p.length))return g;const v={initPTS:void 0,timescale:1};let m=this.initData;if((c=m)!=null&&c.length||(this.generateInitSegment(p),m=this.initData),!((u=m)!=null&&u.length))return logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),g;this.emitInitSegment&&(v.tracks=this.initTracks,this.emitInitSegment=!1);const y=getDuration(p,m),x=getStartDTS(m,p),_=x===null?s:x;(isInvalidInitPts(f,_,s,y)||v.timescale!==f.timescale&&l)&&(v.initPTS=_-s,f&&f.timescale===1&&logger.warn(`Adjusting initPTS by ${v.initPTS-f.baseTime}`),this.initPTS=f={baseTime:v.initPTS,timescale:1});const E=r?_-f.baseTime/f.timescale:d,S=E+y;offsetStartDTS(m,p,f.baseTime/f.timescale),y>0?this.lastEndTime=S:(logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const A=!!m.audio,T=!!m.video;let b="";A&&(b+="audio"),T&&(b+="video");const C={data1:p,startPTS:E,startDTS:E,endPTS:S,endDTS:S,type:b,hasAudio:A,hasVideo:T,nb:1,dropped:0};return g.audio=C.type==="audio"?C:void 0,g.video=C.type!=="audio"?C:void 0,g.initSegment=v,g.id3=flushTextTrackMetadataCueSamples(n,s,f,f),o.samples.length&&(g.text=flushTextTrackUserdataCueSamples(o,s,f)),g}}function isInvalidInitPts(a,r,e,n){if(a===null)return!0;const o=Math.max(n,1),s=r-a.baseTime/a.timescale;return Math.abs(s-e)>o}function getParsedTrackCodec(a,r){const e=a==null?void 0:a.codec;if(e&&e.length>4)return e;if(r===ElementaryStreamTypes.AUDIO){if(e==="ec-3"||e==="ac-3"||e==="alac")return e;if(e==="fLaC"||e==="Opus")return getCodecCompatibleName(e,!1);const n="mp4a.40.5";return logger.info(`Parsed audio codec "${e}" or audio object type not handled. Using "${n}"`),n}return logger.warn(`Unhandled video codec "${e}"`),e==="hvc1"||e==="hev1"?"hvc1.1.6.L120.90":e==="av01"?"av01.0.04M.08":"avc1.42e01e"}let now;try{now=self.performance.now.bind(self.performance)}catch(a){logger.debug("Unable to use Performance API on this environment"),now=optionalSelf==null?void 0:optionalSelf.Date.now}const muxConfig=[{demux:MP4Demuxer,remux:PassThroughRemuxer},{demux:TSDemuxer,remux:MP4Remuxer},{demux:AACDemuxer,remux:MP4Remuxer},{demux:MP3Demuxer,remux:MP4Remuxer}];muxConfig.splice(2,0,{demux:AC3Demuxer,remux:MP4Remuxer});class Transmuxer{constructor(r,e,n,o,s){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=r,this.typeSupported=e,this.config=n,this.vendor=o,this.id=s}configure(r){this.transmuxConfig=r,this.decrypter&&this.decrypter.reset()}push(r,e,n,o){const s=n.transmuxing;s.executeStart=now();let l=new Uint8Array(r);const{currentTransmuxState:c,transmuxConfig:u}=this;o&&(this.currentTransmuxState=o);const{contiguous:f,discontinuity:d,trackSwitch:g,accurateTimeOffset:p,timeOffset:v,initSegmentChange:m}=o||c,{audioCodec:y,videoCodec:x,defaultInitPts:_,duration:E,initSegmentData:S}=u,A=getEncryptionType(l,e);if(A&&A.method==="AES-128"){const L=this.getDecrypter();if(L.isSync()){let R=L.softwareDecrypt(l,A.key.buffer,A.iv.buffer);if(n.part>-1&&(R=L.flush()),!R)return s.executeEnd=now(),emptyResult(n);l=new Uint8Array(R)}else return this.decryptionPromise=L.webCryptoDecrypt(l,A.key.buffer,A.iv.buffer).then(R=>{const I=this.push(R,null,n);return this.decryptionPromise=null,I}),this.decryptionPromise}const T=this.needsProbing(d,g);if(T){const L=this.configureTransmuxer(l);if(L)return logger.warn(`[transmuxer] ${L.message}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:L,reason:L.message}),s.executeEnd=now(),emptyResult(n)}(d||g||m||T)&&this.resetInitSegment(S,y,x,E,e),(d||m||T)&&this.resetInitialTimestamp(_),f||this.resetContiguity();const b=this.transmux(l,A,v,p,n),C=this.currentTransmuxState;return C.contiguous=!0,C.discontinuity=!1,C.trackSwitch=!1,s.executeEnd=now(),b}flush(r){const e=r.transmuxing;e.executeStart=now();const{decrypter:n,currentTransmuxState:o,decryptionPromise:s}=this;if(s)return s.then(()=>this.flush(r));const l=[],{timeOffset:c}=o;if(n){const g=n.flush();g&&l.push(this.push(g,null,r))}const{demuxer:u,remuxer:f}=this;if(!u||!f)return e.executeEnd=now(),[emptyResult(r)];const d=u.flush(c);return isPromise(d)?d.then(g=>(this.flushRemux(l,g,r),l)):(this.flushRemux(l,d,r),l)}flushRemux(r,e,n){const{audioTrack:o,videoTrack:s,id3Track:l,textTrack:c}=e,{accurateTimeOffset:u,timeOffset:f}=this.currentTransmuxState;logger.log(`[transmuxer.ts]: Flushed fragment ${n.sn}${n.part>-1?" p: "+n.part:""} of level ${n.level}`);const d=this.remuxer.remux(o,s,l,c,f,u,!0,this.id);r.push({remuxResult:d,chunkMeta:n}),n.transmuxing.executeEnd=now()}resetInitialTimestamp(r){const{demuxer:e,remuxer:n}=this;!e||!n||(e.resetTimeStamp(r),n.resetTimeStamp(r))}resetContiguity(){const{demuxer:r,remuxer:e}=this;!r||!e||(r.resetContiguity(),e.resetNextTimestamp())}resetInitSegment(r,e,n,o,s){const{demuxer:l,remuxer:c}=this;!l||!c||(l.resetInitSegment(r,e,n,o),c.resetInitSegment(r,e,n,s))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(r,e,n,o,s){let l;return e&&e.method==="SAMPLE-AES"?l=this.transmuxSampleAes(r,e,n,o,s):l=this.transmuxUnencrypted(r,n,o,s),l}transmuxUnencrypted(r,e,n,o){const{audioTrack:s,videoTrack:l,id3Track:c,textTrack:u}=this.demuxer.demux(r,e,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(s,l,c,u,e,n,!1,this.id),chunkMeta:o}}transmuxSampleAes(r,e,n,o,s){return this.demuxer.demuxSampleAes(r,e,n).then(l=>({remuxResult:this.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,n,o,!1,this.id),chunkMeta:s}))}configureTransmuxer(r){const{config:e,observer:n,typeSupported:o,vendor:s}=this;let l;for(let p=0,v=muxConfig.length;p<v;p++){var c;if((c=muxConfig[p].demux)!=null&&c.probe(r)){l=muxConfig[p];break}}if(!l)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,f=this.remuxer,d=l.remux,g=l.demux;(!f||!(f instanceof d))&&(this.remuxer=new d(n,e,o,s)),(!u||!(u instanceof g))&&(this.demuxer=new g(n,e,o),this.probe=g.probe)}needsProbing(r,e){return!this.demuxer||!this.remuxer||r||e}getDecrypter(){let r=this.decrypter;return r||(r=this.decrypter=new Decrypter(this.config)),r}}function getEncryptionType(a,r){let e=null;return a.byteLength>0&&(r==null?void 0:r.key)!=null&&r.iv!==null&&r.method!=null&&(e=r),e}const emptyResult=a=>({remuxResult:{},chunkMeta:a});function isPromise(a){return"then"in a&&a.then instanceof Function}class TransmuxConfig{constructor(r,e,n,o,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=r,this.videoCodec=e,this.initSegmentData=n,this.duration=o,this.defaultInitPts=s||null}}class TransmuxState{constructor(r,e,n,o,s,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=r,this.contiguous=e,this.accurateTimeOffset=n,this.trackSwitch=o,this.timeOffset=s,this.initSegmentChange=l}}var eventemitter3={exports:{}};(function(a){var r=Object.prototype.hasOwnProperty,e="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(e=!1));function o(u,f,d){this.fn=u,this.context=f,this.once=d||!1}function s(u,f,d,g,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var v=new o(d,g||u,p),m=e?e+f:f;return u._events[m]?u._events[m].fn?u._events[m]=[u._events[m],v]:u._events[m].push(v):(u._events[m]=v,u._eventsCount++),u}function l(u,f){--u._eventsCount===0?u._events=new n:delete u._events[f]}function c(){this._events=new n,this._eventsCount=0}c.prototype.eventNames=function(){var f=[],d,g;if(this._eventsCount===0)return f;for(g in d=this._events)r.call(d,g)&&f.push(e?g.slice(1):g);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(d)):f},c.prototype.listeners=function(f){var d=e?e+f:f,g=this._events[d];if(!g)return[];if(g.fn)return[g.fn];for(var p=0,v=g.length,m=new Array(v);p<v;p++)m[p]=g[p].fn;return m},c.prototype.listenerCount=function(f){var d=e?e+f:f,g=this._events[d];return g?g.fn?1:g.length:0},c.prototype.emit=function(f,d,g,p,v,m){var y=e?e+f:f;if(!this._events[y])return!1;var x=this._events[y],_=arguments.length,E,S;if(x.fn){switch(x.once&&this.removeListener(f,x.fn,void 0,!0),_){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,d),!0;case 3:return x.fn.call(x.context,d,g),!0;case 4:return x.fn.call(x.context,d,g,p),!0;case 5:return x.fn.call(x.context,d,g,p,v),!0;case 6:return x.fn.call(x.context,d,g,p,v,m),!0}for(S=1,E=new Array(_-1);S<_;S++)E[S-1]=arguments[S];x.fn.apply(x.context,E)}else{var A=x.length,T;for(S=0;S<A;S++)switch(x[S].once&&this.removeListener(f,x[S].fn,void 0,!0),_){case 1:x[S].fn.call(x[S].context);break;case 2:x[S].fn.call(x[S].context,d);break;case 3:x[S].fn.call(x[S].context,d,g);break;case 4:x[S].fn.call(x[S].context,d,g,p);break;default:if(!E)for(T=1,E=new Array(_-1);T<_;T++)E[T-1]=arguments[T];x[S].fn.apply(x[S].context,E)}}return!0},c.prototype.on=function(f,d,g){return s(this,f,d,g,!1)},c.prototype.once=function(f,d,g){return s(this,f,d,g,!0)},c.prototype.removeListener=function(f,d,g,p){var v=e?e+f:f;if(!this._events[v])return this;if(!d)return l(this,v),this;var m=this._events[v];if(m.fn)m.fn===d&&(!p||m.once)&&(!g||m.context===g)&&l(this,v);else{for(var y=0,x=[],_=m.length;y<_;y++)(m[y].fn!==d||p&&!m[y].once||g&&m[y].context!==g)&&x.push(m[y]);x.length?this._events[v]=x.length===1?x[0]:x:l(this,v)}return this},c.prototype.removeAllListeners=function(f){var d;return f?(d=e?e+f:f,this._events[d]&&l(this,d)):(this._events=new n,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=e,c.EventEmitter=c,a.exports=c})(eventemitter3);var eventemitter3Exports=eventemitter3.exports,EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);class TransmuxerInterface{constructor(r,e,n,o){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const s=r.config;this.hls=r,this.id=e,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=n,this.onFlush=o;const l=(f,d)=>{d=d||{},d.frag=this.frag,d.id=this.id,f===Events.ERROR&&(this.error=d.error),this.hls.trigger(f,d)};this.observer=new EventEmitter,this.observer.on(Events.FRAG_DECRYPTED,l),this.observer.on(Events.ERROR,l);const c=getMediaSource(s.preferManagedMediaSource)||{isTypeSupported:()=>!1},u={mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:c.isTypeSupported('audio/mp4; codecs="ac-3"')};if(this.useWorker&&typeof Worker<"u"&&(s.workerPath||hasUMDWorker())){try{s.workerPath?(logger.log(`loading Web Worker ${s.workerPath} for "${e}"`),this.workerContext=loadWorker(s.workerPath)):(logger.log(`injecting Web Worker for "${e}"`),this.workerContext=injectWorker()),this.onwmsg=g=>this.onWorkerMessage(g);const{worker:d}=this.workerContext;d.addEventListener("message",this.onwmsg),d.onerror=g=>{const p=new Error(`${g.message}  (${g.filename}:${g.lineno})`);s.enableWorker=!1,logger.warn(`Error in "${e}" Web Worker, fallback to inline`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:p})},d.postMessage({cmd:"init",typeSupported:u,vendor:"",id:e,config:JSON.stringify(s)})}catch(d){logger.warn(`Error setting up "${e}" Web Worker, fallback to inline`,d),this.resetWorker(),this.error=null,this.transmuxer=new Transmuxer(this.observer,u,s,"",e)}return}this.transmuxer=new Transmuxer(this.observer,u,s,"",e)}resetWorker(){if(this.workerContext){const{worker:r,objectURL:e}=this.workerContext;e&&self.URL.revokeObjectURL(e),r.removeEventListener("message",this.onwmsg),r.onerror=null,r.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}const r=this.observer;r&&r.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(r,e,n,o,s,l,c,u,f,d){var g,p;f.transmuxing.start=self.performance.now();const{transmuxer:v}=this,m=l?l.start:s.start,y=s.decryptdata,x=this.frag,_=!(x&&s.cc===x.cc),E=!(x&&f.level===x.level),S=x?f.sn-x.sn:-1,A=this.part?f.part-this.part.index:-1,T=S===0&&f.id>1&&f.id===(x==null?void 0:x.stats.chunkCount),b=!E&&(S===1||S===0&&(A===1||T&&A<=0)),C=self.performance.now();(E||S||s.stats.parsing.start===0)&&(s.stats.parsing.start=C),l&&(A||!b)&&(l.stats.parsing.start=C);const L=!(x&&((g=s.initSegment)==null?void 0:g.url)===((p=x.initSegment)==null?void 0:p.url)),R=new TransmuxState(_,b,u,E,m,L);if(!b||_||L){logger.log(`[transmuxer-interface, ${s.type}]: Starting new transmux session for sn: ${f.sn} p: ${f.part} level: ${f.level} id: ${f.id}
        discontinuity: ${_}
        trackSwitch: ${E}
        contiguous: ${b}
        accurateTimeOffset: ${u}
        timeOffset: ${m}
        initSegmentChange: ${L}`);const I=new TransmuxConfig(n,o,e,c,d);this.configureTransmuxer(I)}if(this.frag=s,this.part=l,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:r,decryptdata:y,chunkMeta:f,state:R},r instanceof ArrayBuffer?[r]:[]);else if(v){const I=v.push(r,y,f,R);isPromise(I)?(v.async=!0,I.then(w=>{this.handleTransmuxComplete(w)}).catch(w=>{this.transmuxerError(w,f,"transmuxer-interface push error")})):(v.async=!1,this.handleTransmuxComplete(I))}}flush(r){r.transmuxing.start=self.performance.now();const{transmuxer:e}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:r});else if(e){let n=e.flush(r);isPromise(n)||e.async?(isPromise(n)||(n=Promise.resolve(n)),n.then(s=>{this.handleFlushResult(s,r)}).catch(s=>{this.transmuxerError(s,r,"transmuxer-interface flush error")})):this.handleFlushResult(n,r)}}transmuxerError(r,e,n){this.hls&&(this.error=r,this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:e,frag:this.frag||void 0,fatal:!1,error:r,err:r,reason:n}))}handleFlushResult(r,e){r.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(e)}onWorkerMessage(r){const e=r.data;if(!(e!=null&&e.event)){logger.warn(`worker message received with no ${e?"event name":"data"}`);return}const n=this.hls;if(this.hls)switch(e.event){case"init":{var o;const s=(o=this.workerContext)==null?void 0:o.objectURL;s&&self.URL.revokeObjectURL(s);break}case"transmuxComplete":{this.handleTransmuxComplete(e.data);break}case"flush":{this.onFlush(e.data);break}case"workerLog":logger[e.data.logType]&&logger[e.data.logType](e.data.message);break;default:{e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,n.trigger(e.event,e.data);break}}}configureTransmuxer(r){const{transmuxer:e}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:r}):e&&e.configure(r)}handleTransmuxComplete(r){r.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(r)}}function subtitleOptionsIdentical(a,r){if(a.length!==r.length)return!1;for(let e=0;e<a.length;e++)if(!mediaAttributesIdentical(a[e].attrs,r[e].attrs))return!1;return!0}function mediaAttributesIdentical(a,r,e){const n=a["STABLE-RENDITION-ID"];return n&&!e?n===r["STABLE-RENDITION-ID"]:!(e||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(o=>a[o]!==r[o])}function subtitleTrackMatchesTextTrack(a,r){return r.label.toLowerCase()===a.name.toLowerCase()&&(!r.language||r.language.toLowerCase()===(a.lang||"").toLowerCase())}const TICK_INTERVAL$2=100;class AudioStreamController extends BaseStreamController{constructor(r,e,n){super(r,e,n,"[audio-stream-controller]",PlaylistLevelType.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:r}=this;r.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(Events.ERROR,this.onError,this),r.on(Events.BUFFER_RESET,this.onBufferReset,this),r.on(Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:r}=this;r.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(Events.ERROR,this.onError,this),r.off(Events.BUFFER_RESET,this.onBufferReset,this),r.off(Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(r,{frag:e,id:n,initPTS:o,timescale:s}){if(n==="main"){const l=e.cc;this.initPTS[e.cc]={baseTime:o,timescale:s},this.log(`InitPTS for cc: ${l} found from main: ${o}`),this.videoTrackCC=l,this.state===State.WAITING_INIT_PTS&&this.tick()}}startLoad(r){if(!this.levels){this.startPosition=r,this.state=State.STOPPED;return}const e=this.lastCurrentTime;this.stopLoad(),this.setInterval(TICK_INTERVAL$2),e>0&&r===-1?(this.log(`Override startPosition with lastCurrentTime @${e.toFixed(3)}`),r=e,this.state=State.IDLE):(this.loadedmetadata=!1,this.state=State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}doTick(){switch(this.state){case State.IDLE:this.doTickIdle();break;case State.WAITING_TRACK:{var r;const{levels:n,trackId:o}=this,s=n==null||(r=n[o])==null?void 0:r.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=State.WAITING_INIT_PTS}break}case State.FRAG_LOADING_WAITING_RETRY:{var e;const n=performance.now(),o=this.retryDate;if(!o||n>=o||(e=this.media)!=null&&e.seeking){const{levels:s,trackId:l}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((s==null?void 0:s[l])||null),this.state=State.IDLE}break}case State.WAITING_INIT_PTS:{const n=this.waitingData;if(n){const{frag:o,part:s,cache:l,complete:c}=n;if(this.initPTS[o.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=State.FRAG_LOADING;const u=l.flush(),f={frag:o,part:s,payload:u,networkDetails:null};this._handleFragmentLoadProgress(f),c&&super._handleFragmentLoadComplete(f)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${o.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const u=this.getLoadPosition(),f=BufferHelper.bufferInfo(this.mediaBuffer,u,this.config.maxBufferHole);fragmentWithinToleranceTest(f.end,this.config.maxFragLookUpTolerance,o)<0&&(this.log(`Waiting fragment cc (${o.cc}) @ ${o.start} cancelled because another fragment at ${f.end} is needed`),this.clearWaitingFragment())}}else this.state=State.IDLE}}this.onTickEnd()}clearWaitingFragment(){const r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=State.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:r}=this;r!=null&&r.readyState&&(this.lastCurrentTime=r.currentTime)}doTickIdle(){const{hls:r,levels:e,media:n,trackId:o}=this,s=r.config;if(!n&&(this.startFragRequested||!s.startFragPrefetch)||!(e!=null&&e[o]))return;const l=e[o],c=l.details;if(!c||c.live&&this.levelLastLoaded!==l||this.waitForCdnTuneIn(c)){this.state=State.WAITING_TRACK;return}const u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,ElementaryStreamTypes.AUDIO,PlaylistLevelType.AUDIO));const f=this.getFwdBufferInfo(u,PlaylistLevelType.AUDIO);if(f===null)return;const{bufferedTrack:d,switchingTrack:g}=this;if(!g&&this._streamEnded(f,c)){r.trigger(Events.BUFFER_EOS,{type:"audio"}),this.state=State.ENDED;return}const p=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,PlaylistLevelType.MAIN),v=f.len,m=this.getMaxBufferLength(p==null?void 0:p.len),y=c.fragments,x=y[0].start;let _=this.flushing?this.getLoadPosition():f.end;if(g&&n){const T=this.getLoadPosition();d&&!mediaAttributesIdentical(g.attrs,d.attrs)&&(_=T),c.PTSKnown&&T<x&&(f.end>x||f.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=x+.05)}if(v>=m&&!g&&_<y[y.length-1].start)return;let E=this.getNextFragment(_,c),S=!1;if(E&&this.isLoopLoading(E,_)&&(S=!!E.gap,E=this.getNextFragmentLoopLoading(E,c,f,PlaylistLevelType.MAIN,m)),!E){this.bufferFlushed=!0;return}const A=p&&E.start>p.end+c.targetduration;if(A||!(p!=null&&p.len)&&f.len){const T=this.getAppendedFrag(E.start,PlaylistLevelType.MAIN);if(T===null||(S||(S=!!T.gap||!!A&&p.len===0),A&&!S||S&&f.nextStart&&f.nextStart<T.end))return}this.loadFragment(E,l,_)}getMaxBufferLength(r){const e=super.getMaxBufferLength();return r?Math.min(Math.max(e,r),this.config.maxMaxBufferLength):e}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(r,{audioTracks:e}){this.resetTransmuxer(),this.levels=e.map(n=>new Level(n))}onAudioTrackSwitching(r,e){const n=!!e.url;this.trackId=e.id;const{fragCurrent:o}=this;o&&(o.abortRequests(),this.removeUnbufferedFrags(o.start)),this.resetLoadingState(),n?this.setInterval(TICK_INTERVAL$2):this.resetTransmuxer(),n?(this.switchingTrack=e,this.state=State.IDLE,this.flushAudioIfNeeded(e)):(this.switchingTrack=null,this.bufferedTrack=e,this.state=State.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(r,e){this.mainDetails=e.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(r,e){var n;if(this.mainDetails==null){this.cachedTrackLoadedData=e;return}const{levels:o}=this,{details:s,id:l}=e;if(!o){this.warn(`Audio tracks were reset while loading level ${l}`);return}this.log(`Audio track ${l} loaded [${s.startSN},${s.endSN}]${s.lastPartSn?`[part-${s.lastPartSn}-${s.lastPartIndex}]`:""},duration:${s.totalduration}`);const c=o[l];let u=0;if(s.live||(n=c.details)!=null&&n.live){this.checkLiveUpdate(s);const d=this.mainDetails;if(s.deltaUpdateFailed||!d)return;if(!c.details&&s.hasProgramDateTime&&d.hasProgramDateTime)alignMediaPlaylistByPDT(s,d),u=s.fragments[0].start;else{var f;u=this.alignPlaylists(s,c.details,(f=this.levelLastLoaded)==null?void 0:f.details)}}c.details=s,this.levelLastLoaded=c,!this.startFragRequested&&(this.mainDetails||!s.live)&&this.setStartPosition(this.mainDetails||s,u),this.state===State.WAITING_TRACK&&!this.waitForCdnTuneIn(s)&&(this.state=State.IDLE),this.tick()}_handleFragmentLoadProgress(r){var e;const{frag:n,part:o,payload:s}=r,{config:l,trackId:c,levels:u}=this;if(!u){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const f=u[c];if(!f){this.warn("Audio track is undefined on fragment load progress");return}const d=f.details;if(!d){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const g=l.defaultAudioCodec||f.audioCodec||"mp4a.40.2";let p=this.transmuxer;p||(p=this.transmuxer=new TransmuxerInterface(this.hls,PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const v=this.initPTS[n.cc],m=(e=n.initSegment)==null?void 0:e.data;if(v!==void 0){const x=o?o.index:-1,_=x!==-1,E=new ChunkMetadata(n.level,n.sn,n.stats.chunkCount,s.byteLength,x,_);p.push(s,m,g,"",n,o,d.totalduration,!1,E,v)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${d.startSN} ,${d.endSN}],track ${c}`);const{cache:y}=this.waitingData=this.waitingData||{frag:n,part:o,cache:new ChunkCache,complete:!1};y.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=State.WAITING_INIT_PTS}}_handleFragmentLoadComplete(r){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(r)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(r,e){const n=e.tracks.audio;n&&(this.mediaBuffer=n.buffer||null),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer||null)}onFragBuffered(r,e){const{frag:n,part:o}=e;if(n.type!==PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&n.type===PlaylistLevelType.MAIN){const s=this.videoBuffer||this.media;s&&BufferHelper.getBuffered(s).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${o?" p: "+o.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(n.sn!=="initSegment"){this.fragPrevious=n;const s=this.switchingTrack;s&&(this.bufferedTrack=s,this.switchingTrack=null,this.hls.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},s)))}this.fragBufferedComplete(n,o)}onError(r,e){var n;if(e.fatal){this.state=State.ERROR;return}switch(e.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.AUDIO,e);break;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===State.WAITING_TRACK&&((n=e.context)==null?void 0:n.type)===PlaylistContextType.AUDIO_TRACK&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!e.parent||e.parent!=="audio")return;if(e.details===ErrorDetails.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(e)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}onBufferFlushing(r,{type:e}){e!==ElementaryStreamTypes.VIDEO&&(this.flushing=!0)}onBufferFlushed(r,{type:e}){if(e!==ElementaryStreamTypes.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===State.ENDED&&(this.state=State.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,e,PlaylistLevelType.AUDIO),this.tick())}}_handleTransmuxComplete(r){var e;const n="audio",{hls:o}=this,{remuxResult:s,chunkMeta:l}=r,c=this.getCurrentContext(l);if(!c){this.resetWhenMissingContext(l);return}const{frag:u,part:f,level:d}=c,{details:g}=d,{audio:p,text:v,id3:m,initSegment:y}=s;if(this.fragContextChanged(u)||!g){this.fragmentTracker.removeFragment(u);return}if(this.state=State.PARSING,this.switchingTrack&&p&&this.completeAudioSwitch(this.switchingTrack),y!=null&&y.tracks){const x=u.initSegment||u;this._bufferInitSegment(d,y.tracks,x,l),o.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:x,id:n,tracks:y.tracks})}if(p){const{startPTS:x,endPTS:_,startDTS:E,endDTS:S}=p;f&&(f.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:x,endPTS:_,startDTS:E,endDTS:S}),u.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,x,_,E,S),this.bufferFragmentData(p,u,f,l)}if(m!=null&&(e=m.samples)!=null&&e.length){const x=_extends({id:n,frag:u,details:g},m);o.trigger(Events.FRAG_PARSING_METADATA,x)}if(v){const x=_extends({id:n,frag:u,details:g},v);o.trigger(Events.FRAG_PARSING_USERDATA,x)}}_bufferInitSegment(r,e,n,o){if(this.state!==State.PARSING)return;e.video&&delete e.video;const s=e.audio;if(!s)return;s.id="audio";const l=r.audioCodec;this.log(`Init audio buffer, container:${s.container}, codecs[level/parsed]=[${l}/${s.codec}]`),l&&l.split(",").length===1&&(s.levelCodec=l),this.hls.trigger(Events.BUFFER_CODECS,e);const c=s.initSegment;if(c!=null&&c.byteLength){const u={type:"audio",frag:n,part:null,chunkMeta:o,parent:n.type,data:c};this.hls.trigger(Events.BUFFER_APPENDING,u)}this.tickImmediate()}loadFragment(r,e,n){const o=this.fragmentTracker.getState(r);if(this.fragCurrent=r,this.switchingTrack||o===FragmentState.NOT_LOADED||o===FragmentState.PARTIAL){var s;if(r.sn==="initSegment")this._loadInitSegment(r,e);else if((s=e.details)!=null&&s.live&&!this.initPTS[r.cc]){this.log(`Waiting for video PTS in continuity counter ${r.cc} of live stream before loading audio fragment ${r.sn} of level ${this.trackId}`),this.state=State.WAITING_INIT_PTS;const l=this.mainDetails;l&&l.fragments[0].start!==e.details.fragments[0].start&&alignMediaPlaylistByPDT(e.details,l)}else this.startFragRequested=!0,super.loadFragment(r,e,n)}else this.clearTrackerIfNeeded(r)}flushAudioIfNeeded(r){const{media:e,bufferedTrack:n}=this,o=n==null?void 0:n.attrs,s=r.attrs;e&&o&&(o.CHANNELS!==s.CHANNELS||n.name!==r.name||n.lang!==r.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(r){const{hls:e}=this;this.flushAudioIfNeeded(r),this.bufferedTrack=r,this.switchingTrack=null,e.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},r))}}class AudioTrackController extends BasePlaylistController{constructor(r){super(r,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:r}=this;r.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:r}=this;r.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(Events.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(r,e){this.tracks=e.audioTracks||[]}onAudioTrackLoaded(r,e){const{id:n,groupId:o,details:s}=e,l=this.tracksInGroup[n];if(!l||l.groupId!==o){this.warn(`Audio track with id:${n} and group:${o} not found in active group ${l==null?void 0:l.groupId}`);return}const c=l.details;l.details=e.details,this.log(`Audio track ${n} "${l.name}" lang:${l.lang} group:${o} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,e,c)}onLevelLoading(r,e){this.switchLevel(e.level)}onLevelSwitching(r,e){this.switchLevel(e.level)}switchLevel(r){const e=this.hls.levels[r];if(!e)return;const n=e.audioGroups||null,o=this.groupIds;let s=this.currentTrack;if(!n||(o==null?void 0:o.length)!==(n==null?void 0:n.length)||n!=null&&n.some(c=>(o==null?void 0:o.indexOf(c))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const c=this.tracks.filter(p=>!n||n.indexOf(p.groupId)!==-1);if(c.length)this.selectDefaultTrack&&!c.some(p=>p.default)&&(this.selectDefaultTrack=!1),c.forEach((p,v)=>{p.id=v});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=c;const u=this.hls.config.audioPreference;if(!s&&u){const p=findMatchingOption(u,c,audioMatchPredicate);if(p>-1)s=c[p];else{const v=findMatchingOption(u,this.tracks);s=this.tracks[v]}}let f=this.findTrackId(s);f===-1&&s&&(f=this.findTrackId(null));const d={audioTracks:c};this.log(`Updating audio tracks, ${c.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger(Events.AUDIO_TRACKS_UPDATED,d);const g=this.trackId;if(f!==-1&&g===-1)this.setAudioTrack(f);else if(c.length&&g===-1){var l;const p=new Error(`No audio track selected for current audio group-ID(s): ${(l=this.groupIds)==null?void 0:l.join(",")} track count: ${c.length}`);this.warn(p.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:p})}}else this.shouldReloadPlaylist(s)&&this.setAudioTrack(this.trackId)}onError(r,e){e.fatal||!e.context||e.context.type===PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(e.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(e))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(r){this.selectDefaultTrack=!1,this.setAudioTrack(r)}setAudioOption(r){const e=this.hls;if(e.config.audioPreference=r,r){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const o=this.currentTrack;if(o&&matchesOption(r,o,audioMatchPredicate))return o;const s=findMatchingOption(r,this.tracksInGroup,audioMatchPredicate);if(s>-1){const l=this.tracksInGroup[s];return this.setAudioTrack(s),l}else if(o){let l=e.loadLevel;l===-1&&(l=e.firstAutoLevel);const c=findClosestLevelWithAudioGroup(r,e.levels,n,l,audioMatchPredicate);if(c===-1)return null;e.nextLoadLevel=c}if(r.channels||r.audioCodec){const l=findMatchingOption(r,n);if(l>-1)return n[l]}}}return null}setAudioTrack(r){const e=this.tracksInGroup;if(r<0||r>=e.length){this.warn(`Invalid audio track id: ${r}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const n=this.currentTrack,o=e[r],s=o.details&&!o.details.live;if(r===this.trackId&&o===n&&s||(this.log(`Switching to audio-track ${r} "${o.name}" lang:${o.lang} group:${o.groupId} channels:${o.channels}`),this.trackId=r,this.currentTrack=o,this.hls.trigger(Events.AUDIO_TRACK_SWITCHING,_objectSpread2({},o)),s))return;const l=this.switchParams(o.url,n==null?void 0:n.details,o.details);this.loadPlaylist(l)}findTrackId(r){const e=this.tracksInGroup;for(let n=0;n<e.length;n++){const o=e[n];if(!(this.selectDefaultTrack&&!o.default)&&(!r||matchesOption(r,o,audioMatchPredicate)))return n}if(r){const{name:n,lang:o,assocLang:s,characteristics:l,audioCodec:c,channels:u}=r;for(let f=0;f<e.length;f++){const d=e[f];if(matchesOption({name:n,lang:o,assocLang:s,characteristics:l,audioCodec:c,channels:u},d,audioMatchPredicate))return f}for(let f=0;f<e.length;f++){const d=e[f];if(mediaAttributesIdentical(r.attrs,d.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return f}for(let f=0;f<e.length;f++){const d=e[f];if(mediaAttributesIdentical(r.attrs,d.attrs,["LANGUAGE"]))return f}}return-1}loadPlaylist(r){const e=this.currentTrack;if(this.shouldLoadPlaylist(e)&&e){super.loadPlaylist();const n=e.id,o=e.groupId;let s=e.url;if(r)try{s=r.addDirectives(s)}catch(l){this.warn(`Could not construct new URL with HLS Delivery Directives: ${l}`)}this.log(`loading audio-track playlist ${n} "${e.name}" lang:${e.lang} group:${o}`),this.clearTimer(),this.hls.trigger(Events.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:o,deliveryDirectives:r||null})}}}const TICK_INTERVAL$1=500;class SubtitleStreamController extends BaseStreamController{constructor(r,e,n){super(r,e,n,"[subtitle-stream-controller]",PlaylistLevelType.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:r}=this;r.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(Events.ERROR,this.onError,this),r.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:r}=this;r.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(Events.ERROR,this.onError,this),r.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(r){this.stopLoad(),this.state=State.IDLE,this.setInterval(TICK_INTERVAL$1),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(r,e){this.mainDetails=e.details}onSubtitleFragProcessed(r,e){const{frag:n,success:o}=e;if(this.fragPrevious=n,this.state=State.IDLE,!o)return;const s=this.tracksBuffered[this.currentTrackId];if(!s)return;let l;const c=n.start;for(let f=0;f<s.length;f++)if(c>=s[f].start&&c<=s[f].end){l=s[f];break}const u=n.start+n.duration;l?l.end=u:(l={start:c,end:u},s.push(l)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null)}onBufferFlushing(r,e){const{startOffset:n,endOffset:o}=e;if(n===0&&o!==Number.POSITIVE_INFINITY){const s=o-1;if(s<=0)return;e.endOffsetSubtitles=Math.max(0,s),this.tracksBuffered.forEach(l=>{for(let c=0;c<l.length;){if(l[c].end<=s){l.shift();continue}else if(l[c].start<s)l[c].start=s;else break;c++}}),this.fragmentTracker.removeFragmentsInRange(n,s,PlaylistLevelType.SUBTITLE)}}onFragBuffered(r,e){if(!this.loadedmetadata&&e.frag.type===PlaylistLevelType.MAIN){var n;(n=this.media)!=null&&n.buffered.length&&(this.loadedmetadata=!0)}}onError(r,e){const n=e.frag;(n==null?void 0:n.type)===PlaylistLevelType.SUBTITLE&&(e.details===ErrorDetails.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==State.STOPPED&&(this.state=State.IDLE))}onSubtitleTracksUpdated(r,{subtitleTracks:e}){if(this.levels&&subtitleOptionsIdentical(this.levels,e)){this.levels=e.map(n=>new Level(n));return}this.tracksBuffered=[],this.levels=e.map(n=>{const o=new Level(n);return this.tracksBuffered[o.id]=[],o}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,PlaylistLevelType.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(r,e){var n;if(this.currentTrackId=e.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const o=this.levels[this.currentTrackId];o!=null&&o.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,o&&this.setInterval(TICK_INTERVAL$1)}onSubtitleTrackLoaded(r,e){var n;const{currentTrackId:o,levels:s}=this,{details:l,id:c}=e;if(!s){this.warn(`Subtitle tracks were reset while loading level ${c}`);return}const u=s[c];if(c>=s.length||!u)return;this.log(`Subtitle track ${c} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let f=0;if(l.live||(n=u.details)!=null&&n.live){const g=this.mainDetails;if(l.deltaUpdateFailed||!g)return;const p=g.fragments[0];if(!u.details)l.hasProgramDateTime&&g.hasProgramDateTime?(alignMediaPlaylistByPDT(l,g),f=l.fragments[0].start):p&&(f=p.start,addSliding(l,f));else{var d;f=this.alignPlaylists(l,u.details,(d=this.levelLastLoaded)==null?void 0:d.details),f===0&&p&&(f=p.start,addSliding(l,f))}}u.details=l,this.levelLastLoaded=u,c===o&&(!this.startFragRequested&&(this.mainDetails||!l.live)&&this.setStartPosition(this.mainDetails||l,f),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===State.IDLE&&(findFragmentByPTS(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),u.details=void 0)))}_handleFragmentLoadComplete(r){const{frag:e,payload:n}=r,o=e.decryptdata,s=this.hls;if(!this.fragContextChanged(e)&&n&&n.byteLength>0&&o!=null&&o.key&&o.iv&&o.method==="AES-128"){const l=performance.now();this.decrypter.decrypt(new Uint8Array(n),o.key.buffer,o.iv.buffer).catch(c=>{throw s.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:e}),c}).then(c=>{const u=performance.now();s.trigger(Events.FRAG_DECRYPTED,{frag:e,payload:c,stats:{tstart:l,tdecrypt:u}})}).catch(c=>{this.warn(`${c.name}: ${c.message}`),this.state=State.IDLE})}}doTick(){if(!this.media){this.state=State.IDLE;return}if(this.state===State.IDLE){const{currentTrackId:r,levels:e}=this,n=e==null?void 0:e[r];if(!n||!e.length||!n.details)return;const{config:o}=this,s=this.getLoadPosition(),l=BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s,o.maxBufferHole),{end:c,len:u}=l,f=this.getFwdBufferInfo(this.media,PlaylistLevelType.MAIN),d=n.details,g=this.getMaxBufferLength(f==null?void 0:f.len)+d.levelTargetDuration;if(u>g)return;const p=d.fragments,v=p.length,m=d.edge;let y=null;const x=this.fragPrevious;if(c<m){const _=o.maxFragLookUpTolerance,E=c>m-_?0:_;y=findFragmentByPTS(x,p,Math.max(p[0].start,c),E),!y&&x&&x.start<p[0].start&&(y=p[0])}else y=p[v-1];if(!y)return;if(y=this.mapToInitFragWhenRequired(y),y.sn!=="initSegment"){const _=y.sn-d.startSN,E=p[_-1];E&&E.cc===y.cc&&this.fragmentTracker.getState(E)===FragmentState.NOT_LOADED&&(y=E)}this.fragmentTracker.getState(y)===FragmentState.NOT_LOADED&&this.loadFragment(y,n,c)}}getMaxBufferLength(r){const e=super.getMaxBufferLength();return r?Math.max(e,r):e}loadFragment(r,e,n){this.fragCurrent=r,r.sn==="initSegment"?this._loadInitSegment(r,e):(this.startFragRequested=!0,super.loadFragment(r,e,n))}get mediaBufferTimeRanges(){return new BufferableInstance(this.tracksBuffered[this.currentTrackId]||[])}}class BufferableInstance{constructor(r){this.buffered=void 0;const e=(n,o,s)=>{if(o=o>>>0,o>s-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${o}) is greater than the maximum bound (${s})`);return r[o][n]};this.buffered={get length(){return r.length},end(n){return e("end",n,r.length)},start(n){return e("start",n,r.length)}}}}class SubtitleTrackController extends BasePlaylistController{constructor(r){super(r,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let e=null;const n=filterSubtitleTracks(this.media.textTracks);for(let s=0;s<n.length;s++)if(n[s].mode==="hidden")e=n[s];else if(n[s].mode==="showing"){e=n[s];break}const o=this.findTrackForTextTrack(e);this.subtitleTrack!==o&&this.setSubtitleTrack(o)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(r){this._subtitleDisplay=r,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:r}=this;r.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:r}=this;r.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),r.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(Events.ERROR,this.onError,this)}onMediaAttached(r,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(r){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,r)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),filterSubtitleTracks(this.media.textTracks).forEach(e=>{clearCurrentCues(e)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(r,e){this.tracks=e.subtitleTracks}onSubtitleTrackLoaded(r,e){const{id:n,groupId:o,details:s}=e,l=this.tracksInGroup[n];if(!l||l.groupId!==o){this.warn(`Subtitle track with id:${n} and group:${o} not found in active group ${l==null?void 0:l.groupId}`);return}const c=l.details;l.details=e.details,this.log(`Subtitle track ${n} "${l.name}" lang:${l.lang} group:${o} loaded [${s.startSN}-${s.endSN}]`),n===this.trackId&&this.playlistLoaded(n,e,c)}onLevelLoading(r,e){this.switchLevel(e.level)}onLevelSwitching(r,e){this.switchLevel(e.level)}switchLevel(r){const e=this.hls.levels[r];if(!e)return;const n=e.subtitleGroups||null,o=this.groupIds;let s=this.currentTrack;if(!n||(o==null?void 0:o.length)!==(n==null?void 0:n.length)||n!=null&&n.some(l=>(o==null?void 0:o.indexOf(l))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(d=>!n||n.indexOf(d.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(d=>d.default)&&(this.selectDefaultTrack=!1),l.forEach((d,g)=>{d.id=g});else if(!s&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const c=this.hls.config.subtitlePreference;if(!s&&c){this.selectDefaultTrack=!1;const d=findMatchingOption(c,l);if(d>-1)s=l[d];else{const g=findMatchingOption(c,this.tracks);s=this.tracks[g]}}let u=this.findTrackId(s);u===-1&&s&&(u=this.findTrackId(null));const f={subtitleTracks:l};this.log(`Updating subtitle tracks, ${l.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger(Events.SUBTITLE_TRACKS_UPDATED,f),u!==-1&&this.trackId===-1&&this.setSubtitleTrack(u)}else this.shouldReloadPlaylist(s)&&this.setSubtitleTrack(this.trackId)}findTrackId(r){const e=this.tracksInGroup,n=this.selectDefaultTrack;for(let o=0;o<e.length;o++){const s=e[o];if(!(n&&!s.default||!n&&!r)&&(!r||matchesOption(s,r)))return o}if(r){for(let o=0;o<e.length;o++){const s=e[o];if(mediaAttributesIdentical(r.attrs,s.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return o}for(let o=0;o<e.length;o++){const s=e[o];if(mediaAttributesIdentical(r.attrs,s.attrs,["LANGUAGE"]))return o}}return-1}findTrackForTextTrack(r){if(r){const e=this.tracksInGroup;for(let n=0;n<e.length;n++){const o=e[n];if(subtitleTrackMatchesTextTrack(o,r))return n}}return-1}onError(r,e){e.fatal||!e.context||e.context.type===PlaylistContextType.SUBTITLE_TRACK&&e.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(e.context.groupId)!==-1)&&this.checkRetry(e)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(r){this.selectDefaultTrack=!1,this.setSubtitleTrack(r)}setSubtitleOption(r){if(this.hls.config.subtitlePreference=r,r){const e=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,e.length){const n=this.currentTrack;if(n&&matchesOption(r,n))return n;const o=findMatchingOption(r,this.tracksInGroup);if(o>-1){const s=this.tracksInGroup[o];return this.setSubtitleTrack(o),s}else{if(n)return null;{const s=findMatchingOption(r,e);if(s>-1)return e[s]}}}}return null}loadPlaylist(r){super.loadPlaylist();const e=this.currentTrack;if(this.shouldLoadPlaylist(e)&&e){const n=e.id,o=e.groupId;let s=e.url;if(r)try{s=r.addDirectives(s)}catch(l){this.warn(`Could not construct new URL with HLS Delivery Directives: ${l}`)}this.log(`Loading subtitle playlist for id ${n}`),this.hls.trigger(Events.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:o,deliveryDirectives:r||null})}}toggleTrackModes(){const{media:r}=this;if(!r)return;const e=filterSubtitleTracks(r.textTracks),n=this.currentTrack;let o;if(n&&(o=e.filter(s=>subtitleTrackMatchesTextTrack(n,s))[0],o||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(e).forEach(s=>{s.mode!=="disabled"&&s!==o&&(s.mode="disabled")}),o){const s=this.subtitleDisplay?"showing":"hidden";o.mode!==s&&(o.mode=s)}}setSubtitleTrack(r){const e=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=r;return}if(r<-1||r>=e.length||!isFiniteNumber(r)){this.warn(`Invalid subtitle track id: ${r}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const n=this.currentTrack,o=e[r]||null;if(this.trackId=r,this.currentTrack=o,this.toggleTrackModes(),!o){this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:r});return}const s=!!o.details&&!o.details.live;if(r===this.trackId&&o===n&&s)return;this.log(`Switching to subtitle-track ${r}`+(o?` "${o.name}" lang:${o.lang} group:${o.groupId}`:""));const{id:l,groupId:c="",name:u,type:f,url:d}=o;this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:l,groupId:c,name:u,type:f,url:d});const g=this.switchParams(o.url,n==null?void 0:n.details,o.details);this.loadPlaylist(g)}}class BufferOperationQueue{constructor(r){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=r}append(r,e,n){const o=this.queues[e];o.push(r),o.length===1&&!n&&this.executeNext(e)}insertAbort(r,e){this.queues[e].unshift(r),this.executeNext(e)}appendBlocker(r){let e;const n=new Promise(s=>{e=s}),o={execute:e,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(o,r),n}executeNext(r){const e=this.queues[r];if(e.length){const n=e[0];try{n.execute()}catch(o){logger.warn(`[buffer-operation-queue]: Exception executing "${r}" SourceBuffer operation: ${o}`),n.onError(o);const s=this.buffers[r];s!=null&&s.updating||this.shiftAndExecuteNext(r)}}}shiftAndExecuteNext(r){this.queues[r].shift(),this.executeNext(r)}current(r){return this.queues[r][0]}}const VIDEO_CODEC_PROFILE_REPLACE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class BufferController{constructor(r){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=n=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:n,mediaSource:o}=this;this.log("Media source opened"),n&&(n.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(Events.MEDIA_ATTACHED,{media:n,mediaSource:o})),o&&o.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:o}=this;n!==o&&logger.error(`Media element src was set while attaching MediaSource (${o} > ${n})`)},this.hls=r;const e="[buffer-controller]";this.appendSource=isManagedMediaSource(getMediaSource(r.config.preferManagedMediaSource)),this.log=logger.log.bind(logger,e),this.warn=logger.warn.bind(logger,e),this.error=logger.error.bind(logger,e),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:r}=this;r.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(Events.BUFFER_RESET,this.onBufferReset,this),r.on(Events.BUFFER_APPENDING,this.onBufferAppending,this),r.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),r.on(Events.BUFFER_EOS,this.onBufferEos,this),r.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(Events.FRAG_PARSED,this.onFragParsed,this),r.on(Events.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:r}=this;r.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(Events.BUFFER_RESET,this.onBufferReset,this),r.off(Events.BUFFER_APPENDING,this.onBufferAppending,this),r.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),r.off(Events.BUFFER_EOS,this.onBufferEos,this),r.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(Events.FRAG_PARSED,this.onFragParsed,this),r.off(Events.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new BufferOperationQueue(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(r,e){let n=2;(e.audio&&!e.video||!e.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(r,e){const n=this.media=e.media,o=getMediaSource(this.appendSource);if(n&&o){var s;const l=this.mediaSource=new o;this.log(`created media source: ${(s=l.constructor)==null?void 0:s.name}`),l.addEventListener("sourceopen",this._onMediaSourceOpen),l.addEventListener("sourceended",this._onMediaSourceEnded),l.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(l.addEventListener("startstreaming",this._onStartStreaming),l.addEventListener("endstreaming",this._onEndStreaming));const c=this._objectUrl=self.URL.createObjectURL(l);if(this.appendSource)try{n.removeAttribute("src");const u=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||u&&l instanceof u,removeSourceChildren(n),addSource(n,c),n.load()}catch{n.src=c}else n.src=c;n.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:r,mediaSource:e,_objectUrl:n}=this;if(e){if(this.log("media source detaching"),e.readyState==="open")try{e.endOfStream()}catch(o){this.warn(`onMediaDetaching: ${o.message} while calling endOfStream`)}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.removeEventListener("startstreaming",this._onStartStreaming),e.removeEventListener("endstreaming",this._onEndStreaming)),r&&(r.removeEventListener("emptied",this._onMediaEmptied),n&&self.URL.revokeObjectURL(n),this.mediaSrc===n?(r.removeAttribute("src"),this.appendSource&&removeSourceChildren(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(Events.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(r=>{this.resetBuffer(r)}),this._initSourceBuffer()}resetBuffer(r){const e=this.sourceBuffer[r];try{if(e){var n;this.removeBufferListeners(r),this.sourceBuffer[r]=void 0,(n=this.mediaSource)!=null&&n.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(e)}}catch(o){this.warn(`onBufferReset ${r}`,o)}}onBufferCodecs(r,e){const n=this.getSourceBufferTypes().length,o=Object.keys(e);if(o.forEach(l=>{if(n){const u=this.tracks[l];if(u&&typeof u.buffer.changeType=="function"){var c;const{id:f,codec:d,levelCodec:g,container:p,metadata:v}=e[l],m=pickMostCompleteCodecName(u.codec,u.levelCodec),y=m==null?void 0:m.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");let x=pickMostCompleteCodecName(d,g);const _=(c=x)==null?void 0:c.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");if(x&&y!==_){l.slice(0,5)==="audio"&&(x=getCodecCompatibleName(x,this.appendSource));const E=`${p};codecs=${x}`;this.appendChangeType(l,E),this.log(`switching codec ${m} to ${x}`),this.tracks[l]={buffer:u.buffer,codec:d,container:p,levelCodec:g,metadata:v,id:f}}}}else this.pendingTracks[l]=e[l]}),n)return;const s=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==s&&(this.log(`${s} bufferCodec event(s) expected ${o.join(",")}`),this.bufferCodecEventsExpected=s),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(r,e){const{operationQueue:n}=this,o={execute:()=>{const s=this.sourceBuffer[r];s&&(this.log(`changing ${r} sourceBuffer type to ${e}`),s.changeType(e)),n.shiftAndExecuteNext(r)},onStart:()=>{},onComplete:()=>{},onError:s=>{this.warn(`Failed to change ${r} SourceBuffer type`,s)}};n.append(o,r,!!this.pendingTracks[r])}onBufferAppending(r,e){const{hls:n,operationQueue:o,tracks:s}=this,{data:l,type:c,frag:u,part:f,chunkMeta:d}=e,g=d.buffering[c],p=self.performance.now();g.start=p;const v=u.stats.buffering,m=f?f.stats.buffering:null;v.start===0&&(v.start=p),m&&m.start===0&&(m.start=p);const y=s.audio;let x=!1;c==="audio"&&(y==null?void 0:y.container)==="audio/mpeg"&&(x=!this.lastMpegAudioChunk||d.id===1||this.lastMpegAudioChunk.sn!==d.sn,this.lastMpegAudioChunk=d);const _=u.start,E={execute:()=>{if(g.executeStart=self.performance.now(),x){const S=this.sourceBuffer[c];if(S){const A=_-S.timestampOffset;Math.abs(A)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${_} (delta: ${A}) sn: ${u.sn})`),S.timestampOffset=_)}}this.appendExecutor(l,c)},onStart:()=>{},onComplete:()=>{const S=self.performance.now();g.executeEnd=g.end=S,v.first===0&&(v.first=S),m&&m.first===0&&(m.first=S);const{sourceBuffer:A}=this,T={};for(const b in A)T[b]=BufferHelper.getBuffered(A[b]);this.appendErrors[c]=0,c==="audio"||c==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(Events.BUFFER_APPENDED,{type:c,frag:u,part:f,chunkMeta:d,parent:u.type,timeRanges:T})},onError:S=>{const A={type:ErrorTypes.MEDIA_ERROR,parent:u.type,details:ErrorDetails.BUFFER_APPEND_ERROR,sourceBufferName:c,frag:u,part:f,chunkMeta:d,error:S,err:S,fatal:!1};if(S.code===DOMException.QUOTA_EXCEEDED_ERR)A.details=ErrorDetails.BUFFER_FULL_ERROR;else{const T=++this.appendErrors[c];A.details=ErrorDetails.BUFFER_APPEND_ERROR,this.warn(`Failed ${T}/${n.config.appendErrorMaxRetry} times to append segment in "${c}" sourceBuffer`),T>=n.config.appendErrorMaxRetry&&(A.fatal=!0)}n.trigger(Events.ERROR,A)}};o.append(E,c,!!this.pendingTracks[c])}onBufferFlushing(r,e){const{operationQueue:n}=this,o=s=>({execute:this.removeExecutor.bind(this,s,e.startOffset,e.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(Events.BUFFER_FLUSHED,{type:s})},onError:l=>{this.warn(`Failed to remove from ${s} SourceBuffer`,l)}});e.type?n.append(o(e.type),e.type):this.getSourceBufferTypes().forEach(s=>{n.append(o(s),s)})}onFragParsed(r,e){const{frag:n,part:o}=e,s=[],l=o?o.elementaryStreams:n.elementaryStreams;l[ElementaryStreamTypes.AUDIOVIDEO]?s.push("audiovideo"):(l[ElementaryStreamTypes.AUDIO]&&s.push("audio"),l[ElementaryStreamTypes.VIDEO]&&s.push("video"));const c=()=>{const u=self.performance.now();n.stats.buffering.end=u,o&&(o.stats.buffering.end=u);const f=o?o.stats:n.stats;this.hls.trigger(Events.FRAG_BUFFERED,{frag:n,part:o,stats:f,id:n.type})};s.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(c,s)}onFragChanged(r,e){this.trimBuffers()}onBufferEos(r,e){this.getSourceBufferTypes().reduce((o,s)=>{const l=this.sourceBuffer[s];return l&&(!e.type||e.type===s)&&(l.ending=!0,l.ended||(l.ended=!0,this.log(`${s} sourceBuffer now EOS`))),o&&!!(!l||l.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(s=>{const l=this.sourceBuffer[s];l&&(l.ending=!1)});const{mediaSource:o}=this;if(!o||o.readyState!=="open"){o&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${o.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),o.endOfStream()}))}onLevelUpdated(r,{details:e}){e.fragments.length&&(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:r,details:e,media:n}=this;if(!n||e===null||!this.getSourceBufferTypes().length)return;const s=r.config,l=n.currentTime,c=e.levelTargetDuration,u=e.live&&s.liveBackBufferLength!==null?s.liveBackBufferLength:s.backBufferLength;if(isFiniteNumber(u)&&u>0){const f=Math.max(u,c),d=Math.floor(l/c)*c-f;this.flushBackBuffer(l,c,d)}if(isFiniteNumber(s.frontBufferFlushThreshold)&&s.frontBufferFlushThreshold>0){const f=Math.max(s.maxBufferLength,s.frontBufferFlushThreshold),d=Math.max(f,c),g=Math.floor(l/c)*c+d;this.flushFrontBuffer(l,c,g)}}flushBackBuffer(r,e,n){const{details:o,sourceBuffer:s}=this;this.getSourceBufferTypes().forEach(c=>{const u=s[c];if(u){const f=BufferHelper.getBuffered(u);if(f.length>0&&n>f.start(0)){if(this.hls.trigger(Events.BACK_BUFFER_REACHED,{bufferEnd:n}),o!=null&&o.live)this.hls.trigger(Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(u.ended&&f.end(f.length-1)-r<e*2){this.log(`Cannot flush ${c} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:c})}}})}flushFrontBuffer(r,e,n){const{sourceBuffer:o}=this;this.getSourceBufferTypes().forEach(l=>{const c=o[l];if(c){const u=BufferHelper.getBuffered(c),f=u.length;if(f<2)return;const d=u.start(f-1),g=u.end(f-1);if(n>d||r>=d&&r<=g)return;if(c.ended&&r-g<2*e){this.log(`Cannot flush ${l} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:d,endOffset:1/0,type:l})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:r,hls:e,media:n,mediaSource:o}=this,s=r.fragments[0].start+r.totalduration,l=n.duration,c=isFiniteNumber(o.duration)?o.duration:0;r.live&&e.config.liveDurationInfinity?(o.duration=1/0,this.updateSeekableRange(r)):(s>c&&s>l||!isFiniteNumber(l))&&(this.log(`Updating Media Source duration to ${s.toFixed(3)}`),o.duration=s)}updateSeekableRange(r){const e=this.mediaSource,n=r.fragments;if(n.length&&r.live&&e!=null&&e.setLiveSeekableRange){const s=Math.max(0,n[0].start),l=Math.max(s,s+r.totalduration);this.log(`Media Source duration is set to ${e.duration}. Setting seekable range to ${s}-${l}.`),e.setLiveSeekableRange(s,l)}}checkPendingTracks(){const{bufferCodecEventsExpected:r,operationQueue:e,pendingTracks:n}=this,o=Object.keys(n).length;if(o&&(!r||o===2||"audiovideo"in n)){this.createSourceBuffers(n),this.pendingTracks={};const s=this.getSourceBufferTypes();if(s.length)this.hls.trigger(Events.BUFFER_CREATED,{tracks:this.tracks}),s.forEach(l=>{e.executeNext(l)});else{const l=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:l,reason:l.message})}}}createSourceBuffers(r){const{sourceBuffer:e,mediaSource:n}=this;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(const s in r)if(!e[s]){var o;const l=r[s];if(!l)throw Error(`source buffer exists for track ${s}, however track does not`);let c=((o=l.levelCodec)==null?void 0:o.indexOf(","))===-1?l.levelCodec:l.codec;c&&s.slice(0,5)==="audio"&&(c=getCodecCompatibleName(c,this.appendSource));const u=`${l.container};codecs=${c}`;this.log(`creating sourceBuffer(${u})`);try{const f=e[s]=n.addSourceBuffer(u),d=s;this.addBufferListener(d,"updatestart",this._onSBUpdateStart),this.addBufferListener(d,"updateend",this._onSBUpdateEnd),this.addBufferListener(d,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(d,"bufferedchange",(g,p)=>{const v=p.removedRanges;v!=null&&v.length&&this.hls.trigger(Events.BUFFER_FLUSHED,{type:s})}),this.tracks[s]={buffer:f,codec:c,container:l.container,levelCodec:l.levelCodec,metadata:l.metadata,id:l.id}}catch(f){this.error(`error while trying to add sourceBuffer: ${f.message}`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,sourceBufferName:s,mimeType:u})}}}get mediaSrc(){var r;const e=((r=this.media)==null?void 0:r.firstChild)||this.media;return e==null?void 0:e.src}_onSBUpdateStart(r){const{operationQueue:e}=this;e.current(r).onStart()}_onSBUpdateEnd(r){var e;if(((e=this.mediaSource)==null?void 0:e.readyState)==="closed"){this.resetBuffer(r);return}const{operationQueue:n}=this;n.current(r).onComplete(),n.shiftAndExecuteNext(r)}_onSBUpdateError(r,e){var n;const o=new Error(`${r} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${o}`,e),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_APPENDING_ERROR,sourceBufferName:r,error:o,fatal:!1});const s=this.operationQueue.current(r);s&&s.onError(o)}removeExecutor(r,e,n){const{media:o,mediaSource:s,operationQueue:l,sourceBuffer:c}=this,u=c[r];if(!o||!s||!u){this.warn(`Attempting to remove from the ${r} SourceBuffer, but it does not exist`),l.shiftAndExecuteNext(r);return}const f=isFiniteNumber(o.duration)?o.duration:1/0,d=isFiniteNumber(s.duration)?s.duration:1/0,g=Math.max(0,e),p=Math.min(n,f,d);p>g&&(!u.ending||u.ended)?(u.ended=!1,this.log(`Removing [${g},${p}] from the ${r} SourceBuffer`),u.remove(g,p)):l.shiftAndExecuteNext(r)}appendExecutor(r,e){const n=this.sourceBuffer[e];if(!n){if(!this.pendingTracks[e])throw new Error(`Attempting to append to the ${e} SourceBuffer, but it does not exist`);return}n.ended=!1,n.appendBuffer(r)}blockBuffers(r,e=this.getSourceBufferTypes()){if(!e.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(r);return}const{operationQueue:n}=this,o=e.map(s=>n.appendBlocker(s));Promise.all(o).then(()=>{r(),e.forEach(s=>{const l=this.sourceBuffer[s];l!=null&&l.updating||n.shiftAndExecuteNext(s)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(r,e,n){const o=this.sourceBuffer[r];if(!o)return;const s=n.bind(this,r);this.listeners[r].push({event:e,listener:s}),o.addEventListener(e,s)}removeBufferListeners(r){const e=this.sourceBuffer[r];e&&this.listeners[r].forEach(n=>{e.removeEventListener(n.event,n.listener)})}}function removeSourceChildren(a){const r=a.querySelectorAll("source");[].slice.call(r).forEach(e=>{a.removeChild(e)})}function addSource(a,r){const e=self.document.createElement("source");e.type="video/mp4",e.src=r,a.appendChild(e)}const specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=a=>String.fromCharCode(specialCea608CharsCodes[a]||a),NR_ROWS=15,NR_COLS=100,rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class CaptionsLogger{constructor(){this.time=null,this.verboseLevel=0}log(r,e){if(this.verboseLevel>=r){const n=typeof e=="function"?e():e;logger.log(`${this.time} [${r}] ${n}`)}}}const numArrayToHexArray=function a(r){const e=[];for(let n=0;n<r.length;n++)e.push(r[n].toString(16));return e};class PenState{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(r){const e=["foreground","underline","italics","background","flash"];for(let n=0;n<e.length;n++){const o=e[n];r.hasOwnProperty(o)&&(this[o]=r[o])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(r){return this.foreground===r.foreground&&this.underline===r.underline&&this.italics===r.italics&&this.background===r.background&&this.flash===r.flash}copy(r){this.foreground=r.foreground,this.underline=r.underline,this.italics=r.italics,this.background=r.background,this.flash=r.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class StyledUnicodeChar{constructor(){this.uchar=" ",this.penState=new PenState}reset(){this.uchar=" ",this.penState.reset()}setChar(r,e){this.uchar=r,this.penState.copy(e)}setPenState(r){this.penState.copy(r)}equals(r){return this.uchar===r.uchar&&this.penState.equals(r.penState)}copy(r){this.uchar=r.uchar,this.penState.copy(r.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Row{constructor(r){this.chars=[],this.pos=0,this.currPenState=new PenState,this.cueStartTime=null,this.logger=void 0;for(let e=0;e<NR_COLS;e++)this.chars.push(new StyledUnicodeChar);this.logger=r}equals(r){for(let e=0;e<NR_COLS;e++)if(!this.chars[e].equals(r.chars[e]))return!1;return!0}copy(r){for(let e=0;e<NR_COLS;e++)this.chars[e].copy(r.chars[e])}isEmpty(){let r=!0;for(let e=0;e<NR_COLS;e++)if(!this.chars[e].isEmpty()){r=!1;break}return r}setCursor(r){this.pos!==r&&(this.pos=r),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>NR_COLS&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=NR_COLS)}moveCursor(r){const e=this.pos+r;if(r>1)for(let n=this.pos+1;n<e+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(e)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(r){r>=144&&this.backSpace();const e=getCharForByte(r);if(this.pos>=NR_COLS){this.logger.log(0,()=>"Cannot insert "+r.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1)}clearFromPos(r){let e;for(e=r;e<NR_COLS;e++)this.chars[e].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const r=[];let e=!0;for(let n=0;n<NR_COLS;n++){const o=this.chars[n].uchar;o!==" "&&(e=!1),r.push(o)}return e?"":r.join("")}setPenStyles(r){this.currPenState.setStyles(r),this.chars[this.pos].setPenState(this.currPenState)}}class CaptionScreen{constructor(r){this.rows=[],this.currRow=NR_ROWS-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let e=0;e<NR_ROWS;e++)this.rows.push(new Row(r));this.logger=r}reset(){for(let r=0;r<NR_ROWS;r++)this.rows[r].clear();this.currRow=NR_ROWS-1}equals(r){let e=!0;for(let n=0;n<NR_ROWS;n++)if(!this.rows[n].equals(r.rows[n])){e=!1;break}return e}copy(r){for(let e=0;e<NR_ROWS;e++)this.rows[e].copy(r.rows[e])}isEmpty(){let r=!0;for(let e=0;e<NR_ROWS;e++)if(!this.rows[e].isEmpty()){r=!1;break}return r}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(r){this.rows[this.currRow].insertChar(r)}setPen(r){this.rows[this.currRow].setPenStyles(r)}moveCursor(r){this.rows[this.currRow].moveCursor(r)}setCursor(r){this.logger.log(2,"setCursor: "+r),this.rows[this.currRow].setCursor(r)}setPAC(r){this.logger.log(2,()=>"pacData = "+JSON.stringify(r));let e=r.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(let c=0;c<NR_ROWS;c++)this.rows[c].clear();const s=this.currRow+1-this.nrRollUpRows,l=this.lastOutputScreen;if(l){const c=l.rows[s].cueStartTime,u=this.logger.time;if(c!==null&&u!==null&&c<u)for(let f=0;f<this.nrRollUpRows;f++)this.rows[e-this.nrRollUpRows+f+1].copy(l.rows[s+f])}}this.currRow=e;const n=this.rows[this.currRow];if(r.indent!==null){const s=r.indent,l=Math.max(s-1,0);n.setCursor(r.indent),r.color=n.chars[l].penState.foreground}const o={foreground:r.color,underline:r.underline,italics:r.italics,background:"black",flash:!1};this.setPen(o)}setBkgData(r){this.logger.log(2,()=>"bkgData = "+JSON.stringify(r)),this.backSpace(),this.setPen(r),this.insertChar(32)}setRollUpRows(r){this.nrRollUpRows=r}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const r=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(r,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(2,"Rolling up")}getDisplayText(r){r=r||!1;const e=[];let n="",o=-1;for(let s=0;s<NR_ROWS;s++){const l=this.rows[s].getTextString();l&&(o=s+1,r?e.push("Row "+o+": '"+l+"'"):e.push(l.trim()))}return e.length>0&&(r?n="["+e.join(" | ")+"]":n=e.join(`
`)),n}getTextAndFormat(){return this.rows}}class Cea608Channel{constructor(r,e,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=r,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(n),this.nonDisplayedMemory=new CaptionScreen(n),this.lastOutputScreen=new CaptionScreen(n),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(r){this.outputFilter=r}setPAC(r){this.writeScreen.setPAC(r)}setBkgData(r){this.writeScreen.setBkgData(r)}setMode(r){r!==this.mode&&(this.mode=r,this.logger.log(2,()=>"MODE="+r),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=r)}insertChars(r){for(let n=0;n<r.length;n++)this.writeScreen.insertChar(r[n]);const e=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>e+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(r){this.logger.log(2,"RU("+r+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(r)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const r=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=r,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(r){this.logger.log(2,"TO("+r+") - Tab Offset"),this.writeScreen.moveCursor(r)}ccMIDROW(r){const e={flash:!1};if(e.underline=r%2===1,e.italics=r>=46,e.italics)e.foreground="white";else{const n=Math.floor(r/2)-16,o=["white","green","blue","cyan","red","yellow","magenta"];e.foreground=o[n]}this.logger.log(2,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)}outputDataUpdate(r=!1){const e=this.logger.time;e!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=e:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),r&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(r){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,r,this.displayedMemory),this.cueStartTime=r))}}class Cea608Parser{constructor(r,e,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=createCmdHistory(),this.logger=void 0;const o=this.logger=new CaptionsLogger;this.channels=[null,new Cea608Channel(r,e,o),new Cea608Channel(r+1,n,o)]}getHandler(r){return this.channels[r].getHandler()}setHandler(r,e){this.channels[r].setHandler(e)}addData(r,e){this.logger.time=r;for(let n=0;n<e.length;n+=2){const o=e[n]&127,s=e[n+1]&127;let l=!1,c=null;if(o===0&&s===0)continue;this.logger.log(3,()=>"["+numArrayToHexArray([e[n],e[n+1]])+"] -> ("+numArrayToHexArray([o,s])+")");const u=this.cmdHistory;if(o>=16&&o<=31){if(hasCmdRepeated(o,s,u)){setLastCmd(null,null,u),this.logger.log(3,()=>"Repeated command ("+numArrayToHexArray([o,s])+") is dropped");continue}setLastCmd(o,s,this.cmdHistory),l=this.parseCmd(o,s),l||(l=this.parseMidrow(o,s)),l||(l=this.parsePAC(o,s)),l||(l=this.parseBackgroundAttributes(o,s))}else setLastCmd(null,null,u);if(!l&&(c=this.parseChars(o,s),c)){const d=this.currentChannel;d&&d>0?this.channels[d].insertChars(c):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!l&&!c&&this.logger.log(2,()=>"Couldn't parse cleaned data "+numArrayToHexArray([o,s])+" orig: "+numArrayToHexArray([e[n],e[n+1]]))}}parseCmd(r,e){const n=(r===20||r===28||r===21||r===29)&&e>=32&&e<=47,o=(r===23||r===31)&&e>=33&&e<=35;if(!(n||o))return!1;const s=r===20||r===21||r===23?1:2,l=this.channels[s];return r===20||r===21||r===28||r===29?e===32?l.ccRCL():e===33?l.ccBS():e===34?l.ccAOF():e===35?l.ccAON():e===36?l.ccDER():e===37?l.ccRU(2):e===38?l.ccRU(3):e===39?l.ccRU(4):e===40?l.ccFON():e===41?l.ccRDC():e===42?l.ccTR():e===43?l.ccRTD():e===44?l.ccEDM():e===45?l.ccCR():e===46?l.ccENM():e===47&&l.ccEOC():l.ccTO(e-32),this.currentChannel=s,!0}parseMidrow(r,e){let n=0;if((r===17||r===25)&&e>=32&&e<=47){if(r===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const o=this.channels[n];return o?(o.ccMIDROW(e),this.logger.log(3,()=>"MIDROW ("+numArrayToHexArray([r,e])+")"),!0):!1}return!1}parsePAC(r,e){let n;const o=(r>=17&&r<=23||r>=25&&r<=31)&&e>=64&&e<=127,s=(r===16||r===24)&&e>=64&&e<=95;if(!(o||s))return!1;const l=r<=23?1:2;e>=64&&e<=95?n=l===1?rowsLowCh1[r]:rowsLowCh2[r]:n=l===1?rowsHighCh1[r]:rowsHighCh2[r];const c=this.channels[l];return c?(c.setPAC(this.interpretPAC(n,e)),this.currentChannel=l,!0):!1}interpretPAC(r,e){let n;const o={color:null,italics:!1,indent:null,underline:!1,row:r};return e>95?n=e-96:n=e-64,o.underline=(n&1)===1,n<=13?o.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(o.italics=!0,o.color="white"):o.indent=Math.floor((n-16)/2)*4,o}parseChars(r,e){let n,o=null,s=null;if(r>=25?(n=2,s=r-8):(n=1,s=r),s>=17&&s<=19){let l;s===17?l=e+80:s===18?l=e+112:l=e+144,this.logger.log(2,()=>"Special char '"+getCharForByte(l)+"' in channel "+n),o=[l]}else r>=32&&r<=127&&(o=e===0?[r]:[r,e]);return o&&this.logger.log(3,()=>"Char codes =  "+numArrayToHexArray(o).join(",")),o}parseBackgroundAttributes(r,e){const n=(r===16||r===24)&&e>=32&&e<=47,o=(r===23||r===31)&&e>=45&&e<=47;if(!(n||o))return!1;let s;const l={};r===16||r===24?(s=Math.floor((e-32)/2),l.background=backgroundColors[s],e%2===1&&(l.background=l.background+"_semi")):e===45?l.background="transparent":(l.foreground="black",e===47&&(l.underline=!0));const c=r<=23?1:2;return this.channels[c].setBkgData(l),!0}reset(){for(let r=0;r<Object.keys(this.channels).length;r++){const e=this.channels[r];e&&e.reset()}setLastCmd(null,null,this.cmdHistory)}cueSplitAtTime(r){for(let e=0;e<this.channels.length;e++){const n=this.channels[e];n&&n.cueSplitAtTime(r)}}}function setLastCmd(a,r,e){e.a=a,e.b=r}function hasCmdRepeated(a,r,e){return e.a===a&&e.b===r}function createCmdHistory(){return{a:null,b:null}}class OutputFilter{constructor(r,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=r,this.trackName=e}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(r,e,n){(this.startTime===null||this.startTime>r)&&(this.startTime=r),this.endTime=e,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var VTTCue=function(){if(optionalSelf!=null&&optionalSelf.VTTCue)return self.VTTCue;const a=["","lr","rl"],r=["start","middle","end","left","right"];function e(c,u){if(typeof u!="string"||!Array.isArray(c))return!1;const f=u.toLowerCase();return~c.indexOf(f)?f:!1}function n(c){return e(a,c)}function o(c){return e(r,c)}function s(c,...u){let f=1;for(;f<arguments.length;f++){const d=arguments[f];for(const g in d)c[g]=d[g]}return c}function l(c,u,f){const d=this,g={enumerable:!0};d.hasBeenReset=!1;let p="",v=!1,m=c,y=u,x=f,_=null,E="",S=!0,A="auto",T="start",b=50,C="middle",L=50,R="middle";Object.defineProperty(d,"id",s({},g,{get:function(){return p},set:function(I){p=""+I}})),Object.defineProperty(d,"pauseOnExit",s({},g,{get:function(){return v},set:function(I){v=!!I}})),Object.defineProperty(d,"startTime",s({},g,{get:function(){return m},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");m=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"endTime",s({},g,{get:function(){return y},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");y=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"text",s({},g,{get:function(){return x},set:function(I){x=""+I,this.hasBeenReset=!0}})),Object.defineProperty(d,"region",s({},g,{get:function(){return _},set:function(I){_=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"vertical",s({},g,{get:function(){return E},set:function(I){const w=n(I);if(w===!1)throw new SyntaxError("An invalid or illegal string was specified.");E=w,this.hasBeenReset=!0}})),Object.defineProperty(d,"snapToLines",s({},g,{get:function(){return S},set:function(I){S=!!I,this.hasBeenReset=!0}})),Object.defineProperty(d,"line",s({},g,{get:function(){return A},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");A=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"lineAlign",s({},g,{get:function(){return T},set:function(I){const w=o(I);if(!w)throw new SyntaxError("An invalid or illegal string was specified.");T=w,this.hasBeenReset=!0}})),Object.defineProperty(d,"position",s({},g,{get:function(){return b},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");b=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"positionAlign",s({},g,{get:function(){return C},set:function(I){const w=o(I);if(!w)throw new SyntaxError("An invalid or illegal string was specified.");C=w,this.hasBeenReset=!0}})),Object.defineProperty(d,"size",s({},g,{get:function(){return L},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");L=I,this.hasBeenReset=!0}})),Object.defineProperty(d,"align",s({},g,{get:function(){return R},set:function(I){const w=o(I);if(!w)throw new SyntaxError("An invalid or illegal string was specified.");R=w,this.hasBeenReset=!0}})),d.displayState=void 0}return l.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},l}();class StringDecoder{decode(r,e){if(!r)return"";if(typeof r!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(r))}}function parseTimeStamp(a){function r(n,o,s,l){return(n|0)*3600+(o|0)*60+(s|0)+parseFloat(l||0)}const e=a.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return e?parseFloat(e[2])>59?r(e[2],e[3],0,e[4]):r(e[1],e[2],e[3],e[4]):null}class Settings{constructor(){this.values=Object.create(null)}set(r,e){!this.get(r)&&e!==""&&(this.values[r]=e)}get(r,e,n){return n?this.has(r)?this.values[r]:e[n]:this.has(r)?this.values[r]:e}has(r){return r in this.values}alt(r,e,n){for(let o=0;o<n.length;++o)if(e===n[o]){this.set(r,e);break}}integer(r,e){/^-?\d+$/.test(e)&&this.set(r,parseInt(e,10))}percent(r,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){const n=parseFloat(e);if(n>=0&&n<=100)return this.set(r,n),!0}return!1}}function parseOptions(a,r,e,n){const o=n?a.split(n):[a];for(const s in o){if(typeof o[s]!="string")continue;const l=o[s].split(e);if(l.length!==2)continue;const c=l[0],u=l[1];r(c,u)}}const defaults=new VTTCue(0,0,""),center=defaults.align==="middle"?"middle":"center";function parseCue(a,r,e){const n=a;function o(){const c=parseTimeStamp(a);if(c===null)throw new Error("Malformed timestamp: "+n);return a=a.replace(/^[^\sa-zA-Z-]+/,""),c}function s(c,u){const f=new Settings;parseOptions(c,function(p,v){let m;switch(p){case"region":for(let y=e.length-1;y>=0;y--)if(e[y].id===v){f.set(p,e[y].region);break}break;case"vertical":f.alt(p,v,["rl","lr"]);break;case"line":m=v.split(","),f.integer(p,m[0]),f.percent(p,m[0])&&f.set("snapToLines",!1),f.alt(p,m[0],["auto"]),m.length===2&&f.alt("lineAlign",m[1],["start",center,"end"]);break;case"position":m=v.split(","),f.percent(p,m[0]),m.length===2&&f.alt("positionAlign",m[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":f.percent(p,v);break;case"align":f.alt(p,v,["start",center,"end","left","right"]);break}},/:/,/\s/),u.region=f.get("region",null),u.vertical=f.get("vertical","");let d=f.get("line","auto");d==="auto"&&defaults.line===-1&&(d=-1),u.line=d,u.lineAlign=f.get("lineAlign","start"),u.snapToLines=f.get("snapToLines",!0),u.size=f.get("size",100),u.align=f.get("align",center);let g=f.get("position","auto");g==="auto"&&defaults.position===50&&(g=u.align==="start"||u.align==="left"?0:u.align==="end"||u.align==="right"?100:50),u.position=g}function l(){a=a.replace(/^\s+/,"")}if(l(),r.startTime=o(),l(),a.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);a=a.slice(3),l(),r.endTime=o(),l(),s(a,r)}function fixLineBreaks(a){return a.replace(/<br(?: \/)?>/gi,`
`)}class VTTParser{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(r){const e=this;r&&(e.buffer+=e.decoder.decode(r,{stream:!0}));function n(){let s=e.buffer,l=0;for(s=fixLineBreaks(s);l<s.length&&s[l]!=="\r"&&s[l]!==`
`;)++l;const c=s.slice(0,l);return s[l]==="\r"&&++l,s[l]===`
`&&++l,e.buffer=s.slice(l),c}function o(s){parseOptions(s,function(l,c){},/:/)}try{let s="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;s=n();const c=s.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(c!=null&&c[0]))throw new Error("Malformed WebVTT signature.");e.state="HEADER"}let l=!1;for(;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(l?l=!1:s=n(),e.state){case"HEADER":/:/.test(s)?o(s):s||(e.state="ID");continue;case"NOTE":s||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(s)){e.state="NOTE";break}if(!s)continue;if(e.cue=new VTTCue(0,0,""),e.state="CUE",s.indexOf("-->")===-1){e.cue.id=s;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{parseCue(s,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{const c=s.indexOf("-->")!==-1;if(!s||c&&(l=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=s}continue;case"BADCUE":s||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const r=this;try{if((r.cue||r.state==="HEADER")&&(r.buffer+=`

`,r.parse()),r.state==="INITIAL"||r.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){r.onparsingerror&&r.onparsingerror(e)}return r.onflush&&r.onflush(),this}}const LINEBREAKS=/\r\n|\n\r|\n|\r/g,startsWith=function a(r,e,n=0){return r.slice(n,n+e.length)===e},cueString2millis=function a(r){let e=parseInt(r.slice(-3));const n=parseInt(r.slice(-6,-4)),o=parseInt(r.slice(-9,-7)),s=r.length>9?parseInt(r.substring(0,r.indexOf(":"))):0;if(!isFiniteNumber(e)||!isFiniteNumber(n)||!isFiniteNumber(o)||!isFiniteNumber(s))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${r}`);return e+=1e3*n,e+=60*1e3*o,e+=60*60*1e3*s,e},hash=function a(r){let e=5381,n=r.length;for(;n;)e=e*33^r.charCodeAt(--n);return(e>>>0).toString()};function generateCueId(a,r,e){return hash(a.toString())+hash(r.toString())+hash(e)}const calculateOffset=function a(r,e,n){let o=r[e],s=r[o.prevCC];if(!s||!s.new&&o.new){r.ccOffset=r.presentationOffset=o.start,o.new=!1;return}for(;(l=s)!=null&&l.new;){var l;r.ccOffset+=o.start-s.start,o.new=!1,o=s,s=r[o.prevCC]}r.presentationOffset=n};function parseWebVTT(a,r,e,n,o,s,l){const c=new VTTParser,u=utf8ArrayToStr(new Uint8Array(a)).trim().replace(LINEBREAKS,`
`).split(`
`),f=[],d=r?toMpegTsClockFromTimescale(r.baseTime,r.timescale):0;let g="00:00.000",p=0,v=0,m,y=!0;c.oncue=function(x){const _=e[n];let E=e.ccOffset;const S=(p-d)/9e4;if(_!=null&&_.new&&(v!==void 0?E=e.ccOffset=_.start:calculateOffset(e,n,S)),S){if(!r){m=new Error("Missing initPTS for VTT MPEGTS");return}E=S-e.presentationOffset}const A=x.endTime-x.startTime,T=normalizePts((x.startTime+E-v)*9e4,o*9e4)/9e4;x.startTime=Math.max(T,0),x.endTime=Math.max(T+A,0);const b=x.text.trim();x.text=decodeURIComponent(encodeURIComponent(b)),x.id||(x.id=generateCueId(x.startTime,x.endTime,b)),x.endTime>0&&f.push(x)},c.onparsingerror=function(x){m=x},c.onflush=function(){if(m){l(m);return}s(f)},u.forEach(x=>{if(y)if(startsWith(x,"X-TIMESTAMP-MAP=")){y=!1,x.slice(16).split(",").forEach(_=>{startsWith(_,"LOCAL:")?g=_.slice(6):startsWith(_,"MPEGTS:")&&(p=parseInt(_.slice(7)))});try{v=cueString2millis(g)/1e3}catch(_){m=_}return}else x===""&&(y=!1);c.parse(x+`
`)}),c.flush()}const IMSC1_CODEC="stpp.ttml.im1t",HMSF_REGEX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,TIME_UNIT_REGEX=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,textAlignToLineAlign={left:"start",center:"center",right:"end",start:"start",end:"end"};function parseIMSC1(a,r,e,n){const o=findBox(new Uint8Array(a),["mdat"]);if(o.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const s=o.map(c=>utf8ArrayToStr(c)),l=toTimescaleFromScale(r.baseTime,1,r.timescale);try{s.forEach(c=>e(parseTTML(c,l)))}catch(c){n(c)}}function parseTTML(a,r){const o=new DOMParser().parseFromString(a,"text/xml").getElementsByTagName("tt")[0];if(!o)throw new Error("Invalid ttml");const s={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},l=Object.keys(s).reduce((g,p)=>(g[p]=o.getAttribute(`ttp:${p}`)||s[p],g),{}),c=o.getAttribute("xml:space")!=="preserve",u=collectionToDictionary(getElementCollection(o,"styling","style")),f=collectionToDictionary(getElementCollection(o,"layout","region")),d=getElementCollection(o,"body","[begin]");return[].map.call(d,g=>{const p=getTextContent(g,c);if(!p||!g.hasAttribute("begin"))return null;const v=parseTtmlTime(g.getAttribute("begin"),l),m=parseTtmlTime(g.getAttribute("dur"),l);let y=parseTtmlTime(g.getAttribute("end"),l);if(v===null)throw timestampParsingError(g);if(y===null){if(m===null)throw timestampParsingError(g);y=v+m}const x=new VTTCue(v-r,y-r,p);x.id=generateCueId(x.startTime,x.endTime,x.text);const _=f[g.getAttribute("region")],E=u[g.getAttribute("style")],S=getTtmlStyles(_,E,u),{textAlign:A}=S;if(A){const T=textAlignToLineAlign[A];T&&(x.lineAlign=T),x.align=A}return _extends(x,S),x}).filter(g=>g!==null)}function getElementCollection(a,r,e){const n=a.getElementsByTagName(r)[0];return n?[].slice.call(n.querySelectorAll(e)):[]}function collectionToDictionary(a){return a.reduce((r,e)=>{const n=e.getAttribute("xml:id");return n&&(r[n]=e),r},{})}function getTextContent(a,r){return[].slice.call(a.childNodes).reduce((e,n,o)=>{var s;return n.nodeName==="br"&&o?e+`
`:(s=n.childNodes)!=null&&s.length?getTextContent(n,r):r?e+n.textContent.trim().replace(/\s+/g," "):e+n.textContent},"")}function getTtmlStyles(a,r,e){const n="http://www.w3.org/ns/ttml#styling";let o=null;const s=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],l=a!=null&&a.hasAttribute("style")?a.getAttribute("style"):null;return l&&e.hasOwnProperty(l)&&(o=e[l]),s.reduce((c,u)=>{const f=getAttributeNS(r,n,u)||getAttributeNS(a,n,u)||getAttributeNS(o,n,u);return f&&(c[u]=f),c},{})}function getAttributeNS(a,r,e){return a&&a.hasAttributeNS(r,e)?a.getAttributeNS(r,e):null}function timestampParsingError(a){return new Error(`Could not parse ttml timestamp ${a}`)}function parseTtmlTime(a,r){if(!a)return null;let e=parseTimeStamp(a);return e===null&&(HMSF_REGEX.test(a)?e=parseHoursMinutesSecondsFrames(a,r):TIME_UNIT_REGEX.test(a)&&(e=parseTimeUnits(a,r))),e}function parseHoursMinutesSecondsFrames(a,r){const e=HMSF_REGEX.exec(a),n=(e[4]|0)+(e[5]|0)/r.subFrameRate;return(e[1]|0)*3600+(e[2]|0)*60+(e[3]|0)+n/r.frameRate}function parseTimeUnits(a,r){const e=TIME_UNIT_REGEX.exec(a),n=Number(e[1]);switch(e[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/r.frameRate;case"t":return n/r.tickRate}return n}class TimelineController{constructor(r){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this.captionsProperties=void 0,this.hls=r,this.config=r.config,this.Cues=r.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},r.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(Events.FRAG_LOADING,this.onFragLoading,this),r.on(Events.FRAG_LOADED,this.onFragLoaded,this),r.on(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.on(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),r.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:r}=this;r.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(Events.FRAG_LOADING,this.onFragLoading,this),r.off(Events.FRAG_LOADED,this.onFragLoaded,this),r.off(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.off(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),r.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const r=new OutputFilter(this,"textTrack1"),e=new OutputFilter(this,"textTrack2"),n=new OutputFilter(this,"textTrack3"),o=new OutputFilter(this,"textTrack4");this.cea608Parser1=new Cea608Parser(1,r,e),this.cea608Parser2=new Cea608Parser(3,n,o)}}addCues(r,e,n,o,s){let l=!1;for(let c=s.length;c--;){const u=s[c],f=intersection(u[0],u[1],e,n);if(f>=0&&(u[0]=Math.min(u[0],e),u[1]=Math.max(u[1],n),l=!0,f/(n-e)>.5))return}if(l||s.push([e,n]),this.config.renderTextTracksNatively){const c=this.captionsTracks[r];this.Cues.newCue(c,e,n,o)}else{const c=this.Cues.newCue(null,e,n,o);this.hls.trigger(Events.CUES_PARSED,{type:"captions",cues:c,track:r})}}onInitPtsFound(r,{frag:e,id:n,initPTS:o,timescale:s}){const{unparsedVttFrags:l}=this;n==="main"&&(this.initPTS[e.cc]={baseTime:o,timescale:s}),l.length&&(this.unparsedVttFrags=[],l.forEach(c=>{this.onFragLoaded(Events.FRAG_LOADED,c)}))}getExistingTrack(r,e){const{media:n}=this;if(n)for(let o=0;o<n.textTracks.length;o++){const s=n.textTracks[o];if(canReuseVttTextTrack(s,{name:r,lang:e,attrs:{}}))return s}return null}createCaptionsTrack(r){this.config.renderTextTracksNatively?this.createNativeTrack(r):this.createNonNativeTrack(r)}createNativeTrack(r){if(this.captionsTracks[r])return;const{captionsProperties:e,captionsTracks:n,media:o}=this,{label:s,languageCode:l}=e[r],c=this.getExistingTrack(s,l);if(c)n[r]=c,clearCurrentCues(n[r]),sendAddTrackEvent(n[r],o);else{const u=this.createTextTrack("captions",s,l);u&&(u[r]=!0,n[r]=u)}}createNonNativeTrack(r){if(this.nonNativeCaptionsTracks[r])return;const e=this.captionsProperties[r];if(!e)return;const n=e.label,o={_id:r,label:n,kind:"captions",default:e.media?!!e.media.default:!1,closedCaptions:e.media};this.nonNativeCaptionsTracks[r]=o,this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[o]})}createTextTrack(r,e,n){const o=this.media;if(o)return o.addTextTrack(r,e,n)}onMediaAttaching(r,e){this.media=e.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:r}=this;Object.keys(r).forEach(e=>{clearCurrentCues(r[e]),delete r[e]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:r}=this;if(!r)return;const e=r.textTracks;if(e)for(let n=0;n<e.length;n++)clearCurrentCues(e[n])}onSubtitleTracksUpdated(r,e){const n=e.subtitleTracks||[],o=n.some(s=>s.textCodec===IMSC1_CODEC);if(this.config.enableWebVTT||o&&this.config.enableIMSC1){if(subtitleOptionsIdentical(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const l=this.media,c=l?filterSubtitleTracks(l.textTracks):null;if(this.tracks.forEach((u,f)=>{let d;if(c){let g=null;for(let p=0;p<c.length;p++)if(c[p]&&canReuseVttTextTrack(c[p],u)){g=c[p],c[p]=null;break}g&&(d=g)}if(d)clearCurrentCues(d);else{const g=captionsOrSubtitlesFromCharacteristics(u);d=this.createTextTrack(g,u.name,u.lang),d&&(d.mode="disabled")}d&&this.textTracks.push(d)}),c!=null&&c.length){const u=c.filter(f=>f!==null).map(f=>f.label);u.length&&logger.warn(`Media element contains unused subtitle tracks: ${u.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const l=this.tracks.map(c=>({label:c.name,kind:c.type.toLowerCase(),default:c.default,subtitleTrack:c}));this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}}onManifestLoaded(r,e){this.config.enableCEA708Captions&&e.captions&&e.captions.forEach(n=>{const o=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!o)return;const s=`textTrack${o[1]}`,l=this.captionsProperties[s];l&&(l.label=n.name,n.lang&&(l.languageCode=n.lang),l.media=n)})}closedCaptionsForLevel(r){const e=this.hls.levels[r.level];return e==null?void 0:e.attrs["CLOSED-CAPTIONS"]}onFragLoading(r,e){if(this.enabled&&e.frag.type===PlaylistLevelType.MAIN){var n,o;const{cea608Parser1:s,cea608Parser2:l,lastSn:c}=this,{cc:u,sn:f}=e.frag,d=(n=(o=e.part)==null?void 0:o.index)!=null?n:-1;s&&l&&(f!==c+1||f===c&&d!==this.lastPartIndex+1||u!==this.lastCc)&&(s.reset(),l.reset()),this.lastCc=u,this.lastSn=f,this.lastPartIndex=d}}onFragLoaded(r,e){const{frag:n,payload:o}=e;if(n.type===PlaylistLevelType.SUBTITLE)if(o.byteLength){const s=n.decryptdata,l="stats"in e;if(s==null||!s.encrypted||l){const c=this.tracks[n.level],u=this.vttCCs;u[n.cc]||(u[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),c&&c.textCodec===IMSC1_CODEC?this._parseIMSC1(n,o):this._parseVTTs(e)}}else this.hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(r,e){const n=this.hls;parseIMSC1(e,this.initPTS[r.cc],o=>{this._appendCues(o,r.level),n.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},o=>{logger.log(`Failed to parse IMSC1: ${o}`),n.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:o})})}_parseVTTs(r){var e;const{frag:n,payload:o}=r,{initPTS:s,unparsedVttFrags:l}=this,c=s.length-1;if(!s[n.cc]&&c===-1){l.push(r);return}const u=this.hls,f=(e=n.initSegment)!=null&&e.data?appendUint8Array(n.initSegment.data,new Uint8Array(o)):o;parseWebVTT(f,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,d=>{this._appendCues(d,n.level),u.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},d=>{const g=d.message==="Missing initPTS for VTT MPEGTS";g?l.push(r):this._fallbackToIMSC1(n,o),logger.log(`Failed to parse VTT cue: ${d}`),!(g&&c>n.cc)&&u.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:d})})}_fallbackToIMSC1(r,e){const n=this.tracks[r.level];n.textCodec||parseIMSC1(e,this.initPTS[r.cc],()=>{n.textCodec=IMSC1_CODEC,this._parseIMSC1(r,e)},()=>{n.textCodec="wvtt"})}_appendCues(r,e){const n=this.hls;if(this.config.renderTextTracksNatively){const o=this.textTracks[e];if(!o||o.mode==="disabled")return;r.forEach(s=>addCueToTrack(o,s))}else{const o=this.tracks[e];if(!o)return;const s=o.default?"default":"subtitles"+e;n.trigger(Events.CUES_PARSED,{type:"subtitles",cues:r,track:s})}}onFragDecrypted(r,e){const{frag:n}=e;n.type===PlaylistLevelType.SUBTITLE&&this.onFragLoaded(Events.FRAG_LOADED,e)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(r,e){this.initCea608Parsers();const{cea608Parser1:n,cea608Parser2:o}=this;if(!this.enabled||!n||!o)return;const{frag:s,samples:l}=e;if(!(s.type===PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let c=0;c<l.length;c++){const u=l[c].bytes;if(u){const f=this.extractCea608Data(u);n.addData(l[c].pts,f[0]),o.addData(l[c].pts,f[1])}}}onBufferFlushing(r,{startOffset:e,endOffset:n,endOffsetSubtitles:o,type:s}){const{media:l}=this;if(!(!l||l.currentTime<n)){if(!s||s==="video"){const{captionsTracks:c}=this;Object.keys(c).forEach(u=>removeCuesInRange(c[u],e,n))}if(this.config.renderTextTracksNatively&&e===0&&o!==void 0){const{textTracks:c}=this;Object.keys(c).forEach(u=>removeCuesInRange(c[u],e,o))}}}extractCea608Data(r){const e=[[],[]],n=r[0]&31;let o=2;for(let s=0;s<n;s++){const l=r[o++],c=127&r[o++],u=127&r[o++];if(c===0&&u===0)continue;if((4&l)!==0){const d=3&l;(d===0||d===1)&&(e[d].push(c),e[d].push(u))}}return e}}function captionsOrSubtitlesFromCharacteristics(a){return a.characteristics&&/transcribes-spoken-dialog/gi.test(a.characteristics)&&/describes-music-and-sound/gi.test(a.characteristics)?"captions":"subtitles"}function canReuseVttTextTrack(a,r){return!!a&&a.kind===captionsOrSubtitlesFromCharacteristics(r)&&subtitleTrackMatchesTextTrack(r,a)}function intersection(a,r,e,n){return Math.min(r,n)-Math.max(a,e)}function newVTTCCs(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class CapLevelController{constructor(r){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=r,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(r){this.streamController=r}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:r}=this;r.on(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),r.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:r}=this;r.off(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),r.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),r.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(r,e){const n=this.hls.levels[e.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(r,e){this.media=e.media instanceof HTMLVideoElement?e.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(r,e){const n=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,n.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onLevelsUpdated(r,e){this.timer&&isFiniteNumber(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(r,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const r=this.hls.levels;if(r.length){const e=this.hls,n=this.getMaxLevel(r.length-1);n!==this.autoLevelCapping&&logger.log(`Setting autoLevelCapping to ${n}: ${r[n].height}p@${r[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),e.autoLevelCapping=n,e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}}getMaxLevel(r){const e=this.hls.levels;if(!e.length)return-1;const n=e.filter((o,s)=>this.isLevelAllowed(o)&&s<=r);return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const r=this.media,e={width:0,height:0};if(r){const n=r.getBoundingClientRect();e.width=n.width,e.height=n.height,!e.width&&!e.height&&(e.width=n.right-n.left||r.width||0,e.height=n.bottom-n.top||r.height||0)}return this.clientRect=e,e}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let r=1;if(!this.hls.config.ignoreDevicePixelRatio)try{r=self.devicePixelRatio}catch{}return r}isLevelAllowed(r){return!this.restrictedLevels.some(n=>r.bitrate===n.bitrate&&r.width===n.width&&r.height===n.height)}static getMaxLevelByMediaSize(r,e,n){if(!(r!=null&&r.length))return-1;const o=(c,u)=>u?c.width!==u.width||c.height!==u.height:!0;let s=r.length-1;const l=Math.max(e,n);for(let c=0;c<r.length;c+=1){const u=r[c];if((u.width>=l||u.height>=l)&&o(u,r[c+1])){s=c;break}}return s}}class FPSController{constructor(r){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=r,this.registerListeners()}setStreamController(r){this.streamController=r}registerListeners(){this.hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(r,e){const n=this.hls.config;if(n.capLevelOnFPSDrop){const o=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=o,o&&typeof o.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}checkFPS(r,e,n){const o=performance.now();if(e){if(this.lastTime){const s=o-this.lastTime,l=n-this.lastDroppedFrames,c=e-this.lastDecodedFrames,u=1e3*l/s,f=this.hls;if(f.trigger(Events.FPS_DROP,{currentDropped:l,currentDecoded:c,totalDroppedFrames:n}),u>0&&l>f.config.fpsDroppedMonitoringThreshold*c){let d=f.currentLevel;logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(f.autoLevelCapping===-1||f.autoLevelCapping>=d)&&(d=d-1,f.trigger(Events.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:f.currentLevel}),f.autoLevelCapping=d,this.streamController.nextLevelSwitch())}}this.lastTime=o,this.lastDroppedFrames=n,this.lastDecodedFrames=e}}checkFPSInterval(){const r=this.media;if(r)if(this.isVideoPlaybackQualityAvailable){const e=r.getVideoPlaybackQuality();this.checkFPS(r,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(r,r.webkitDecodedFrameCount,r.webkitDroppedFrameCount)}}const LOGGER_PREFIX="[eme]";class EMEController{constructor(r){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=EMEController.CDMCleanupPromise?[EMEController.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=logger.debug.bind(logger,LOGGER_PREFIX),this.log=logger.log.bind(logger,LOGGER_PREFIX),this.warn=logger.warn.bind(logger,LOGGER_PREFIX),this.error=logger.error.bind(logger,LOGGER_PREFIX),this.hls=r,this.config=r.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const r=this.config;r.requestMediaKeySystemAccessFunc=null,r.licenseXhrSetup=r.licenseResponseCallback=void 0,r.drmSystems=r.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(r){const{drmSystems:e,widevineLicenseUrl:n}=this.config,o=e[r];if(o)return o.licenseUrl;if(r===KeySystems.WIDEVINE&&n)return n;throw new Error(`no license server URL configured for key-system "${r}"`)}getServerCertificateUrl(r){const{drmSystems:e}=this.config,n=e[r];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${r}"]`)}attemptKeySystemAccess(r){const e=this.hls.levels,n=(l,c,u)=>!!l&&u.indexOf(l)===c,o=e.map(l=>l.audioCodec).filter(n),s=e.map(l=>l.videoCodec).filter(n);return o.length+s.length===0&&s.push("avc1.42e01e"),new Promise((l,c)=>{const u=f=>{const d=f.shift();this.getMediaKeysPromise(d,o,s).then(g=>l({keySystem:d,mediaKeys:g})).catch(g=>{f.length?u(f):g instanceof EMEKeyError?c(g):c(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:g,fatal:!0},g.message))})};u(r)})}requestMediaKeySystemAccess(r,e){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let o=`Configured requestMediaKeySystemAccess is not a function ${n}`;return requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(o=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(o))}return n(r,e)}getMediaKeysPromise(r,e,n){const o=getSupportedMediaKeySystemConfigurations(r,e,n,this.config.drmSystemOptions),s=this.keySystemAccessPromises[r];let l=s==null?void 0:s.keySystemAccess;if(!l){this.log(`Requesting encrypted media "${r}" key-system access with config: ${JSON.stringify(o)}`),l=this.requestMediaKeySystemAccess(r,o);const c=this.keySystemAccessPromises[r]={keySystemAccess:l};return l.catch(u=>{this.log(`Failed to obtain access to key-system "${r}": ${u}`)}),l.then(u=>{this.log(`Access for key-system "${u.keySystem}" obtained`);const f=this.fetchServerCertificate(r);return this.log(`Create media-keys for "${r}"`),c.mediaKeys=u.createMediaKeys().then(d=>(this.log(`Media-keys created for "${r}"`),f.then(g=>g?this.setMediaKeysServerCertificate(d,r,g):d))),c.mediaKeys.catch(d=>{this.error(`Failed to create media-keys for "${r}"}: ${d}`)}),c.mediaKeys})}return l.then(()=>s.mediaKeys)}createMediaKeySessionContext({decryptdata:r,keySystem:e,mediaKeys:n}){this.log(`Creating key-system session "${e}" keyId: ${Hex.hexDump(r.keyId||[])}`);const o=n.createSession(),s={decryptdata:r,keySystem:e,mediaKeys:n,mediaKeysSession:o,keyStatus:"status-pending"};return this.mediaKeySessions.push(s),s}renewKeySession(r){const e=r.decryptdata;if(e.pssh){const n=this.createMediaKeySessionContext(r),o=this.getKeyIdString(e),s="cenc";this.keyIdToKeySessionPromise[o]=this.generateRequestWithPreferredKeySession(n,s,e.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(r)}getKeyIdString(r){if(!r)throw new Error("Could not read keyId of undefined decryptdata");if(r.keyId===null)throw new Error("keyId is null");return Hex.hexDump(r.keyId)}updateKeySession(r,e){var n;const o=r.mediaKeysSession;return this.log(`Updating key-session "${o.sessionId}" for keyID ${Hex.hexDump(((n=r.decryptdata)==null?void 0:n.keyId)||[])}
      } (data length: ${e&&e.byteLength})`),o.update(e)}selectKeySystemFormat(r){const e=Object.keys(r.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${r.sn} ${r.type}: ${r.level}) key formats ${e.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(e)),this.keyFormatPromise}getKeyFormatPromise(r){return new Promise((e,n)=>{const o=getKeySystemsForConfig(this.config),s=r.map(keySystemFormatToKeySystemDomain).filter(l=>!!l&&o.indexOf(l)!==-1);return this.getKeySystemSelectionPromise(s).then(({keySystem:l})=>{const c=keySystemDomainToKeySystemFormat(l);c?e(c):n(new Error(`Unable to find format for key-system "${l}"`))}).catch(n)})}loadKey(r){const e=r.keyInfo.decryptdata,n=this.getKeyIdString(e),o=`(keyId: ${n} format: "${e.keyFormat}" method: ${e.method} uri: ${e.uri})`;this.log(`Starting session for key ${o}`);let s=this.keyIdToKeySessionPromise[n];return s||(s=this.keyIdToKeySessionPromise[n]=this.getKeySystemForKeyPromise(e).then(({keySystem:l,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${r.frag.sn} ${r.frag.type}: ${r.frag.level} using key ${o}`),this.attemptSetMediaKeys(l,c).then(()=>{this.throwIfDestroyed();const u=this.createMediaKeySessionContext({keySystem:l,mediaKeys:c,decryptdata:e}),f="cenc";return this.generateRequestWithPreferredKeySession(u,f,e.pssh,"playlist-key")}))),s.catch(l=>this.handleError(l))),s}throwIfDestroyed(r="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(r){this.hls&&(this.error(r.message),r instanceof EMEKeyError?this.hls.trigger(Events.ERROR,r.data):this.hls.trigger(Events.ERROR,{type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_KEYS,error:r,fatal:!0}))}getKeySystemForKeyPromise(r){const e=this.getKeyIdString(r),n=this.keyIdToKeySessionPromise[e];if(!n){const o=keySystemFormatToKeySystemDomain(r.keyFormat),s=o?[o]:getKeySystemsForConfig(this.config);return this.attemptKeySystemAccess(s)}return n}getKeySystemSelectionPromise(r){if(r.length||(r=getKeySystemsForConfig(this.config)),r.length===0)throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(r)}_onMediaEncrypted(r){const{initDataType:e,initData:n}=r;if(this.debug(`"${r.type}" event: init data type: "${e}"`),n===null)return;let o,s;if(e==="sinf"&&this.config.drmSystems[KeySystems.FAIRPLAY]){const d=bin2str(new Uint8Array(n));try{const g=base64Decode(JSON.parse(d).sinf),p=parseSinf(new Uint8Array(g));if(!p)return;o=p.subarray(8,24),s=KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const d=parsePssh(n);if(d===null)return;d.version===0&&d.systemId===KeySystemIds.WIDEVINE&&d.data&&(o=d.data.subarray(8,24)),s=keySystemIdToKeySystemDomain(d.systemId)}if(!s||!o)return;const l=Hex.hexDump(o),{keyIdToKeySessionPromise:c,mediaKeySessions:u}=this;let f=c[l];for(let d=0;d<u.length;d++){const g=u[d],p=g.decryptdata;if(p.pssh||!p.keyId)continue;const v=Hex.hexDump(p.keyId);if(l===v||p.uri.replace(/-/g,"").indexOf(l)!==-1){f=c[v],delete c[v],p.pssh=new Uint8Array(n),p.keyId=o,f=c[l]=f.then(()=>this.generateRequestWithPreferredKeySession(g,e,n,"encrypted-event-key-match"));break}}f||(f=c[l]=this.getKeySystemSelectionPromise([s]).then(({keySystem:d,mediaKeys:g})=>{var p;this.throwIfDestroyed();const v=new LevelKey("ISO-23001-7",l,(p=keySystemDomainToKeySystemFormat(d))!=null?p:"");return v.pssh=new Uint8Array(n),v.keyId=o,this.attemptSetMediaKeys(d,g).then(()=>{this.throwIfDestroyed();const m=this.createMediaKeySessionContext({decryptdata:v,keySystem:d,mediaKeys:g});return this.generateRequestWithPreferredKeySession(m,e,n,"encrypted-event-no-match")})})),f.catch(d=>this.handleError(d))}_onWaitingForKey(r){this.log(`"${r.type}" event`)}attemptSetMediaKeys(r,e){const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${r}"`);const o=Promise.all(n).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(e)});return this.setMediaKeysQueue.push(o),o.then(()=>{this.log(`Media-keys set for "${r}"`),n.push(o),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(s=>n.indexOf(s)===-1)})}generateRequestWithPreferredKeySession(r,e,n,o){var s,l;const c=(s=this.config.drmSystems)==null||(l=s[r.keySystem])==null?void 0:l.generateRequest;if(c)try{const m=c.call(this.hls,e,n,r);if(!m)throw new Error("Invalid response from configured generateRequest filter");e=m.initDataType,n=r.decryptdata.pssh=m.initData?new Uint8Array(m.initData):null}catch(m){var u;if(this.warn(m.message),(u=this.hls)!=null&&u.config.debug)throw m}if(n===null)return this.log(`Skipping key-session request for "${o}" (no initData)`),Promise.resolve(r);const f=this.getKeyIdString(r.decryptdata);this.log(`Generating key-session request for "${o}": ${f} (init data type: ${e} length: ${n?n.byteLength:null})`);const d=new EventEmitter,g=r._onmessage=m=>{const y=r.mediaKeysSession;if(!y){d.emit("error",new Error("invalid state"));return}const{messageType:x,message:_}=m;this.log(`"${x}" message event for session "${y.sessionId}" message size: ${_.byteLength}`),x==="license-request"||x==="license-renewal"?this.renewLicense(r,_).catch(E=>{this.handleError(E),d.emit("error",E)}):x==="license-release"?r.keySystem===KeySystems.FAIRPLAY&&(this.updateKeySession(r,strToUtf8array("acknowledged")),this.removeSession(r)):this.warn(`unhandled media key message type "${x}"`)},p=r._onkeystatuseschange=m=>{if(!r.mediaKeysSession){d.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(r);const x=r.keyStatus;d.emit("keyStatus",x),x==="expired"&&(this.warn(`${r.keySystem} expired for key ${f}`),this.renewKeySession(r))};r.mediaKeysSession.addEventListener("message",g),r.mediaKeysSession.addEventListener("keystatuseschange",p);const v=new Promise((m,y)=>{d.on("error",y),d.on("keyStatus",x=>{x.startsWith("usable")?m():x==="output-restricted"?y(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):x==="internal-error"?y(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${x}"`)):x==="expired"?y(new Error("key expired while generating request")):this.warn(`unhandled key status change "${x}"`)})});return r.mediaKeysSession.generateRequest(e,n).then(()=>{var m;this.log(`Request generated for key-session "${(m=r.mediaKeysSession)==null?void 0:m.sessionId}" keyId: ${f}`)}).catch(m=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_SESSION,error:m,fatal:!1},`Error generating key-session request: ${m}`)}).then(()=>v).catch(m=>{throw d.removeAllListeners(),this.removeSession(r),m}).then(()=>(d.removeAllListeners(),r))}onKeyStatusChange(r){r.mediaKeysSession.keyStatuses.forEach((e,n)=>{this.log(`key status change "${e}" for keyStatuses keyId: ${Hex.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))} session keyId: ${Hex.hexDump(new Uint8Array(r.decryptdata.keyId||[]))} uri: ${r.decryptdata.uri}`),r.keyStatus=e})}fetchServerCertificate(r){const e=this.config,n=e.loader,o=new n(e),s=this.getServerCertificateUrl(r);return s?(this.log(`Fetching server certificate for "${r}"`),new Promise((l,c)=>{const u={responseType:"arraybuffer",url:s},f=e.certLoadPolicy.default,d={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(p,v,m,y)=>{l(p.data)},onError:(p,v,m,y)=>{c(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:_objectSpread2({url:u.url,data:void 0},p)},`"${r}" certificate request failed (${s}). Status: ${p.code} (${p.text})`))},onTimeout:(p,v,m)=>{c(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:m,response:{url:u.url,data:void 0}},`"${r}" certificate request timed out (${s})`))},onAbort:(p,v,m)=>{c(new Error("aborted"))}};o.load(u,d,g)})):Promise.resolve()}setMediaKeysServerCertificate(r,e,n){return new Promise((o,s)=>{r.setServerCertificate(n).then(l=>{this.log(`setServerCertificate ${l?"success":"not supported by CDM"} (${n==null?void 0:n.byteLength}) on "${e}"`),o(r)}).catch(l=>{s(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})}renewLicense(r,e){return this.requestLicense(r,new Uint8Array(e)).then(n=>this.updateKeySession(r,new Uint8Array(n)).catch(o=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:o,fatal:!0},o.message)}))}unpackPlayReadyKeyMessage(r,e){const n=String.fromCharCode.apply(null,new Uint16Array(e.buffer));if(!n.includes("PlayReadyKeyMessage"))return r.setRequestHeader("Content-Type","text/xml; charset=utf-8"),e;const o=new DOMParser().parseFromString(n,"application/xml"),s=o.querySelectorAll("HttpHeader");if(s.length>0){let d;for(let g=0,p=s.length;g<p;g++){var l,c;d=s[g];const v=(l=d.querySelector("name"))==null?void 0:l.textContent,m=(c=d.querySelector("value"))==null?void 0:c.textContent;v&&m&&r.setRequestHeader(v,m)}}const u=o.querySelector("Challenge"),f=u==null?void 0:u.textContent;if(!f)throw new Error("Cannot find <Challenge> in key message");return strToUtf8array(atob(f))}setupLicenseXHR(r,e,n,o){const s=this.config.licenseXhrSetup;return s?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return s.call(this.hls,r,e,n,o)}).catch(l=>{if(!n.decryptdata)throw l;return r.open("POST",e,!0),s.call(this.hls,r,e,n,o)}).then(l=>(r.readyState||r.open("POST",e,!0),{xhr:r,licenseChallenge:l||o})):(r.open("POST",e,!0),Promise.resolve({xhr:r,licenseChallenge:o}))}requestLicense(r,e){const n=this.config.keyLoadPolicy.default;return new Promise((o,s)=>{const l=this.getLicenseServerUrl(r.keySystem);this.log(`Sending license request to URL: ${l}`);const c=new XMLHttpRequest;c.responseType="arraybuffer",c.onreadystatechange=()=>{if(!this.hls||!r.mediaKeysSession)return s(new Error("invalid state"));if(c.readyState===4)if(c.status===200){this._requestLicenseFailureCount=0;let u=c.response;this.log(`License received ${u instanceof ArrayBuffer?u.byteLength:u}`);const f=this.config.licenseResponseCallback;if(f)try{u=f.call(this.hls,c,l,r)}catch(d){this.error(d)}o(u)}else{const u=n.errorRetry,f=u?u.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>f||c.status>=400&&c.status<500)s(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:c,response:{url:l,data:void 0,code:c.status,text:c.statusText}},`License Request XHR failed (${l}). Status: ${c.status} (${c.statusText})`));else{const d=f-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${d} attempts left`),this.requestLicense(r,e).then(o,s)}}},r.licenseXhr&&r.licenseXhr.readyState!==XMLHttpRequest.DONE&&r.licenseXhr.abort(),r.licenseXhr=c,this.setupLicenseXHR(c,l,r,e).then(({xhr:u,licenseChallenge:f})=>{r.keySystem==KeySystems.PLAYREADY&&(f=this.unpackPlayReadyKeyMessage(u,f)),u.send(f)})})}onMediaAttached(r,e){if(!this.config.emeEnabled)return;const n=e.media;this.media=n,n.addEventListener("encrypted",this.onMediaEncrypted),n.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const r=this.media,e=this.mediaKeySessions;r&&(r.removeEventListener("encrypted",this.onMediaEncrypted),r.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},LevelKey.clearKeyUriToKeyIdMap();const n=e.length;EMEController.CDMCleanupPromise=Promise.all(e.map(o=>this.removeSession(o)).concat(r==null?void 0:r.setMediaKeys(null).catch(o=>{this.log(`Could not clear media keys: ${o}`)}))).then(()=>{n&&(this.log("finished closing key sessions and clearing media keys"),e.length=0)}).catch(o=>{this.log(`Could not close sessions and clear media keys: ${o}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(r,{sessionKeys:e}){if(!(!e||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=e.reduce((o,s)=>(o.indexOf(s.keyFormat)===-1&&o.push(s.keyFormat),o),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(r){const{mediaKeysSession:e,licenseXhr:n}=r;if(e){this.log(`Remove licenses and keys and close session ${e.sessionId}`),r._onmessage&&(e.removeEventListener("message",r._onmessage),r._onmessage=void 0),r._onkeystatuseschange&&(e.removeEventListener("keystatuseschange",r._onkeystatuseschange),r._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),r.mediaKeysSession=r.decryptdata=r.licenseXhr=void 0;const o=this.mediaKeySessions.indexOf(r);return o>-1&&this.mediaKeySessions.splice(o,1),e.remove().catch(s=>{this.log(`Could not remove session: ${s}`)}).then(()=>e.close()).catch(s=>{this.log(`Could not close session: ${s}`)})}}}EMEController.CDMCleanupPromise=void 0;class EMEKeyError extends Error{constructor(r,e){super(e),this.data=void 0,r.error||(r.error=new Error(e)),this.data=r,r.err=r.error}}var CmObjectType;(function(a){a.MANIFEST="m",a.AUDIO="a",a.VIDEO="v",a.MUXED="av",a.INIT="i",a.CAPTION="c",a.TIMED_TEXT="tt",a.KEY="k",a.OTHER="o"})(CmObjectType||(CmObjectType={}));var CmStreamingFormat;(function(a){a.DASH="d",a.HLS="h",a.SMOOTH="s",a.OTHER="o"})(CmStreamingFormat||(CmStreamingFormat={}));var CmcdHeaderField;(function(a){a.OBJECT="CMCD-Object",a.REQUEST="CMCD-Request",a.SESSION="CMCD-Session",a.STATUS="CMCD-Status"})(CmcdHeaderField||(CmcdHeaderField={}));const CmcdHeaderMap={[CmcdHeaderField.OBJECT]:["br","d","ot","tb"],[CmcdHeaderField.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[CmcdHeaderField.SESSION]:["cid","pr","sf","sid","st","v"],[CmcdHeaderField.STATUS]:["bs","rtp"]};class SfItem{constructor(r,e){this.value=void 0,this.params=void 0,Array.isArray(r)&&(r=r.map(n=>n instanceof SfItem?n:new SfItem(n))),this.value=r,this.params=e}}class SfToken{constructor(r){this.description=void 0,this.description=r}}const DICT="Dict";function format(a){return Array.isArray(a)?JSON.stringify(a):a instanceof Map?"Map{}":a instanceof Set?"Set{}":typeof a=="object"?JSON.stringify(a):String(a)}function throwError(a,r,e,n){return new Error(`failed to ${a} "${format(r)}" as ${e}`,{cause:n})}const BARE_ITEM="Bare Item",BOOLEAN="Boolean",BYTES="Byte Sequence",DECIMAL="Decimal",INTEGER="Integer";function isInvalidInt(a){return a<-999999999999999||999999999999999<a}const STRING_REGEX=/[\x00-\x1f\x7f]+/,TOKEN="Token",KEY="Key";function serializeError(a,r,e){return throwError("serialize",a,r,e)}function serializeBoolean(a){if(typeof a!="boolean")throw serializeError(a,BOOLEAN);return a?"?1":"?0"}function base64encode(a){return btoa(String.fromCharCode(...a))}function serializeByteSequence(a){if(ArrayBuffer.isView(a)===!1)throw serializeError(a,BYTES);return`:${base64encode(a)}:`}function serializeInteger(a){if(isInvalidInt(a))throw serializeError(a,INTEGER);return a.toString()}function serializeDate(a){return`@${serializeInteger(a.getTime()/1e3)}`}function roundToEven(a,r){if(a<0)return-roundToEven(-a,r);const e=Math.pow(10,r);if(Math.abs(a*e%1-.5)<Number.EPSILON){const o=Math.floor(a*e);return(o%2===0?o:o+1)/e}else return Math.round(a*e)/e}function serializeDecimal(a){const r=roundToEven(a,3);if(Math.floor(Math.abs(r)).toString().length>12)throw serializeError(a,DECIMAL);const e=r.toString();return e.includes(".")?e:`${e}.0`}const STRING="String";function serializeString(a){if(STRING_REGEX.test(a))throw serializeError(a,STRING);return`"${a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function symbolToStr(a){return a.description||a.toString().slice(7,-1)}function serializeToken(a){const r=symbolToStr(a);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(r)===!1)throw serializeError(r,TOKEN);return r}function serializeBareItem(a){switch(typeof a){case"number":if(!isFiniteNumber(a))throw serializeError(a,BARE_ITEM);return Number.isInteger(a)?serializeInteger(a):serializeDecimal(a);case"string":return serializeString(a);case"symbol":return serializeToken(a);case"boolean":return serializeBoolean(a);case"object":if(a instanceof Date)return serializeDate(a);if(a instanceof Uint8Array)return serializeByteSequence(a);if(a instanceof SfToken)return serializeToken(a);default:throw serializeError(a,BARE_ITEM)}}function serializeKey(a){if(/^[a-z*][a-z0-9\-_.*]*$/.test(a)===!1)throw serializeError(a,KEY);return a}function serializeParams(a){return a==null?"":Object.entries(a).map(([r,e])=>e===!0?`;${serializeKey(r)}`:`;${serializeKey(r)}=${serializeBareItem(e)}`).join("")}function serializeItem(a){return a instanceof SfItem?`${serializeBareItem(a.value)}${serializeParams(a.params)}`:serializeBareItem(a)}function serializeInnerList(a){return`(${a.value.map(serializeItem).join(" ")})${serializeParams(a.params)}`}function serializeDict(a,r={whitespace:!0}){if(typeof a!="object")throw serializeError(a,DICT);const e=a instanceof Map?a.entries():Object.entries(a),n=r!=null&&r.whitespace?" ":"";return Array.from(e).map(([o,s])=>{s instanceof SfItem||(s=new SfItem(s));let l=serializeKey(o);return s.value===!0?l+=serializeParams(s.params):(l+="=",Array.isArray(s.value)?l+=serializeInnerList(s):l+=serializeItem(s)),l}).join(`,${n}`)}function encodeSfDict(a,r){return serializeDict(a,r)}const isTokenField=a=>a==="ot"||a==="sf"||a==="st",isValid=a=>typeof a=="number"?isFiniteNumber(a):a!=null&&a!==""&&a!==!1;function urlToRelativePath(a,r){const e=new URL(a),n=new URL(r);if(e.origin!==n.origin)return a;const o=e.pathname.split("/").slice(1),s=n.pathname.split("/").slice(1,-1);for(;o[0]===s[0];)o.shift(),s.shift();for(;s.length;)s.shift(),o.unshift("..");return o.join("/")}function uuid(){try{return crypto.randomUUID()}catch{try{const r=URL.createObjectURL(new Blob),e=r.toString();return URL.revokeObjectURL(r),e.slice(e.lastIndexOf("/")+1)}catch{let e=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,o=>{const s=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(o=="x"?s:s&3|8).toString(16)})}}}const toRounded=a=>Math.round(a),toUrlSafe=(a,r)=>(r!=null&&r.baseUrl&&(a=urlToRelativePath(a,r.baseUrl)),encodeURIComponent(a)),toHundred=a=>toRounded(a/100)*100,CmcdFormatters={br:toRounded,d:toRounded,bl:toHundred,dl:toHundred,mtp:toHundred,nor:toUrlSafe,rtp:toHundred,tb:toRounded};function processCmcd(a,r){const e={};if(a==null||typeof a!="object")return e;const n=Object.keys(a).sort(),o=_extends({},CmcdFormatters,r==null?void 0:r.formatters),s=r==null?void 0:r.filter;return n.forEach(l=>{if(s!=null&&s(l))return;let c=a[l];const u=o[l];u&&(c=u(c,r)),!(l==="v"&&c===1)&&(l=="pr"&&c===1||isValid(c)&&(isTokenField(l)&&typeof c=="string"&&(c=new SfToken(c)),e[l]=c))}),e}function encodeCmcd(a,r={}){return a?encodeSfDict(processCmcd(a,r),_extends({whitespace:!1},r)):""}function toCmcdHeaders(a,r={}){if(!a)return{};const e=Object.entries(a),n=Object.entries(CmcdHeaderMap).concat(Object.entries((r==null?void 0:r.customHeaderMap)||{})),o=e.reduce((s,l)=>{var c,u;const[f,d]=l,g=((c=n.find(p=>p[1].includes(f)))==null?void 0:c[0])||CmcdHeaderField.REQUEST;return(u=s[g])!=null||(s[g]={}),s[g][f]=d,s},{});return Object.entries(o).reduce((s,[l,c])=>(s[l]=encodeCmcd(c,r),s),{})}function appendCmcdHeaders(a,r,e){return _extends(a,toCmcdHeaders(r,e))}const CMCD_PARAM="CMCD";function toCmcdQuery(a,r={}){if(!a)return"";const e=encodeCmcd(a,r);return`${CMCD_PARAM}=${encodeURIComponent(e)}`}const REGEX=/CMCD=[^&#]+/;function appendCmcdQuery(a,r,e){const n=toCmcdQuery(r,e);if(!n)return a;if(REGEX.test(a))return a.replace(REGEX,n);const o=a.includes("?")?"&":"?";return`${a}${o}${n}`}class CMCDController{constructor(r){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=o=>{try{this.apply(o,{ot:CmObjectType.MANIFEST,su:!this.initialized})}catch(s){logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=o=>{try{const s=o.frag,l=this.hls.levels[s.level],c=this.getObjectType(s),u={d:s.duration*1e3,ot:c};(c===CmObjectType.VIDEO||c===CmObjectType.AUDIO||c==CmObjectType.MUXED)&&(u.br=l.bitrate/1e3,u.tb=this.getTopBandwidth(c)/1e3,u.bl=this.getBufferLength(c)),this.apply(o,u)}catch(s){logger.warn("Could not generate segment CMCD data.",s)}},this.hls=r;const e=this.config=r.config,{cmcd:n}=e;n!=null&&(e.pLoader=this.createPlaylistLoader(),e.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||uuid(),this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const r=this.hls;r.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),r.on(Events.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const r=this.hls;r.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),r.off(Events.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(r,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(r,e){var n,o;this.audioBuffer=(n=e.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(o=e.tracks.video)==null?void 0:o.buffer}createData(){var r;return{v:1,sf:CmStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(r=this.media)==null?void 0:r.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(r,e={}){_extends(e,this.createData());const n=e.ot===CmObjectType.INIT||e.ot===CmObjectType.VIDEO||e.ot===CmObjectType.MUXED;this.starved&&n&&(e.bs=!0,e.su=!0,this.starved=!1),e.su==null&&(e.su=this.buffering);const{includeKeys:o}=this;o&&(e=Object.keys(e).reduce((s,l)=>(o.includes(l)&&(s[l]=e[l]),s),{})),this.useHeaders?(r.headers||(r.headers={}),appendCmcdHeaders(r.headers,e)):r.url=appendCmcdQuery(r.url,e)}getObjectType(r){const{type:e}=r;if(e==="subtitle")return CmObjectType.TIMED_TEXT;if(r.sn==="initSegment")return CmObjectType.INIT;if(e==="audio")return CmObjectType.AUDIO;if(e==="main")return this.hls.audioTracks.length?CmObjectType.VIDEO:CmObjectType.MUXED}getTopBandwidth(r){let e=0,n;const o=this.hls;if(r===CmObjectType.AUDIO)n=o.audioTracks;else{const s=o.maxAutoLevel,l=s>-1?s+1:o.levels.length;n=o.levels.slice(0,l)}for(const s of n)s.bitrate>e&&(e=s.bitrate);return e>0?e:NaN}getBufferLength(r){const e=this.hls.media,n=r===CmObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!e?NaN:BufferHelper.bufferInfo(n,e.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:r}=this.config,e=this.applyPlaylistData,n=r||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,l,c){e(s),this.loader.load(s,l,c)}}}createFragmentLoader(){const{fLoader:r}=this.config,e=this.applyFragmentData,n=r||this.config.loader;return class{constructor(s){this.loader=void 0,this.loader=new n(s)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(s,l,c){e(s),this.loader.load(s,l,c)}}}}const PATHWAY_PENALTY_DURATION_MS=3e5;class ContentSteeringController{constructor(r){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=r,this.log=logger.log.bind(logger,"[content-steering]:"),this.registerListeners()}registerListeners(){const r=this.hls;r.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(Events.ERROR,this.onError,this)}unregisterListeners(){const r=this.hls;r&&(r.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(Events.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const r=this.timeToLoad*1e3-(performance.now()-this.updated);if(r>0){this.scheduleRefresh(this.uri,r);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(r){const e=this.levels;e&&(this.levels=e.filter(n=>n!==r))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(r,e){const{contentSteering:n}=e;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(r,e){this.audioTracks=e.audioTracks,this.subtitleTracks=e.subtitleTracks}onError(r,e){const{errorAction:n}=e;if((n==null?void 0:n.action)===NetworkErrorAction.SendAlternateToPenaltyBox&&n.flags===ErrorActionFlags.MoveAllAlternatesMatchingHost){const o=this.levels;let s=this.pathwayPriority,l=this.pathwayId;if(e.context){const{groupId:c,pathwayId:u,type:f}=e.context;c&&o?l=this.getPathwayForGroupId(c,f,l):u&&(l=u)}l in this.penalizedPathways||(this.penalizedPathways[l]=performance.now()),!s&&o&&(s=o.reduce((c,u)=>(c.indexOf(u.pathwayId)===-1&&c.push(u.pathwayId),c),[])),s&&s.length>1&&(this.updatePathwayPriority(s),n.resolved=this.pathwayId!==l),n.resolved||logger.warn(`Could not resolve ${e.details} ("${e.error.message}") with content-steering for Pathway: ${l} levels: ${o&&o.length} priorities: ${JSON.stringify(s)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(r){this.levels=r;let e=this.getLevelsForPathway(this.pathwayId);if(e.length===0){const n=r[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),e=this.getLevelsForPathway(n),this.pathwayId=n}return e.length!==r.length?(this.log(`Found ${e.length}/${r.length} levels in Pathway "${this.pathwayId}"`),e):r}getLevelsForPathway(r){return this.levels===null?[]:this.levels.filter(e=>r===e.pathwayId)}updatePathwayPriority(r){this.pathwayPriority=r;let e;const n=this.penalizedPathways,o=performance.now();Object.keys(n).forEach(s=>{o-n[s]>PATHWAY_PENALTY_DURATION_MS&&delete n[s]});for(let s=0;s<r.length;s++){const l=r[s];if(l in n)continue;if(l===this.pathwayId)return;const c=this.hls.nextLoadLevel,u=this.hls.levels[c];if(e=this.getLevelsForPathway(l),e.length>0){this.log(`Setting Pathway to "${l}"`),this.pathwayId=l,reassignFragmentLevelIndexes(e),this.hls.trigger(Events.LEVELS_UPDATED,{levels:e});const f=this.hls.levels[c];u&&f&&this.levels&&(f.attrs["STABLE-VARIANT-ID"]!==u.attrs["STABLE-VARIANT-ID"]&&f.bitrate!==u.bitrate&&this.log(`Unstable Pathways change from bitrate ${u.bitrate} to ${f.bitrate}`),this.hls.nextLoadLevel=c);break}}}getPathwayForGroupId(r,e,n){const o=this.getLevelsForPathway(n).concat(this.levels||[]);for(let s=0;s<o.length;s++)if(e===PlaylistContextType.AUDIO_TRACK&&o[s].hasAudioGroup(r)||e===PlaylistContextType.SUBTITLE_TRACK&&o[s].hasSubtitleGroup(r))return o[s].pathwayId;return n}clonePathways(r){const e=this.levels;if(!e)return;const n={},o={};r.forEach(s=>{const{ID:l,"BASE-ID":c,"URI-REPLACEMENT":u}=s;if(e.some(d=>d.pathwayId===l))return;const f=this.getLevelsForPathway(c).map(d=>{const g=new AttrList(d.attrs);g["PATHWAY-ID"]=l;const p=g.AUDIO&&`${g.AUDIO}_clone_${l}`,v=g.SUBTITLES&&`${g.SUBTITLES}_clone_${l}`;p&&(n[g.AUDIO]=p,g.AUDIO=p),v&&(o[g.SUBTITLES]=v,g.SUBTITLES=v);const m=performUriReplacement(d.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",u),y=new Level({attrs:g,audioCodec:d.audioCodec,bitrate:d.bitrate,height:d.height,name:d.name,url:m,videoCodec:d.videoCodec,width:d.width});if(d.audioGroups)for(let x=1;x<d.audioGroups.length;x++)y.addGroupId("audio",`${d.audioGroups[x]}_clone_${l}`);if(d.subtitleGroups)for(let x=1;x<d.subtitleGroups.length;x++)y.addGroupId("text",`${d.subtitleGroups[x]}_clone_${l}`);return y});e.push(...f),cloneRenditionGroups(this.audioTracks,n,u,l),cloneRenditionGroups(this.subtitleTracks,o,u,l)})}loadSteeringManifest(r){const e=this.hls.config,n=e.loader;this.loader&&this.loader.destroy(),this.loader=new n(e);let o;try{o=new self.URL(r)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${r}`);return}if(o.protocol!=="data:"){const d=(this.hls.bandwidthEstimate||e.abrEwmaDefaultEstimate)|0;o.searchParams.set("_HLS_pathway",this.pathwayId),o.searchParams.set("_HLS_throughput",""+d)}const s={responseType:"json",url:o.href},l=e.steeringManifestLoadPolicy.default,c=l.errorRetry||l.timeoutRetry||{},u={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:c.maxNumRetry||0,retryDelay:c.retryDelayMs||0,maxRetryDelay:c.maxRetryDelayMs||0},f={onSuccess:(d,g,p,v)=>{this.log(`Loaded steering manifest: "${o}"`);const m=d.data;if(m.VERSION!==1){this.log(`Steering VERSION ${m.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=m.TTL;const{"RELOAD-URI":y,"PATHWAY-CLONES":x,"PATHWAY-PRIORITY":_}=m;if(y)try{this.uri=new self.URL(y,o).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${y}`);return}this.scheduleRefresh(this.uri||p.url),x&&this.clonePathways(x);const E={steeringManifest:m,url:o.toString()};this.hls.trigger(Events.STEERING_MANIFEST_LOADED,E),_&&this.updatePathwayPriority(_)},onError:(d,g,p,v)=>{if(this.log(`Error loading steering manifest: ${d.code} ${d.text} (${g.url})`),this.stopLoad(),d.code===410){this.enabled=!1,this.log(`Steering manifest ${g.url} no longer available`);return}let m=this.timeToLoad*1e3;if(d.code===429){const y=this.loader;if(typeof(y==null?void 0:y.getResponseHeader)=="function"){const x=y.getResponseHeader("Retry-After");x&&(m=parseFloat(x)*1e3)}this.log(`Steering manifest ${g.url} rate limited`);return}this.scheduleRefresh(this.uri||g.url,m)},onTimeout:(d,g,p)=>{this.log(`Timeout loading steering manifest (${g.url})`),this.scheduleRefresh(this.uri||g.url)}};this.log(`Requesting steering manifest: ${o}`),this.loader.load(s,u,f)}scheduleRefresh(r,e=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const o=(n=this.hls)==null?void 0:n.media;if(o&&!o.ended){this.loadSteeringManifest(r);return}this.scheduleRefresh(r,this.timeToLoad*1e3)},e)}}function cloneRenditionGroups(a,r,e,n){a&&Object.keys(r).forEach(o=>{const s=a.filter(l=>l.groupId===o).map(l=>{const c=_extends({},l);return c.details=void 0,c.attrs=new AttrList(c.attrs),c.url=c.attrs.URI=performUriReplacement(l.url,l.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",e),c.groupId=c.attrs["GROUP-ID"]=r[o],c.attrs["PATHWAY-ID"]=n,c});a.push(...s)})}function performUriReplacement(a,r,e,n){const{HOST:o,PARAMS:s,[e]:l}=n;let c;r&&(c=l==null?void 0:l[r],c&&(a=c));const u=new self.URL(a);return o&&!c&&(u.host=o),s&&Object.keys(s).sort().forEach(f=>{f&&u.searchParams.set(f,s[f])}),u.href}const AGE_HEADER_LINE_REGEX=/^age:\s*[\d.]+\s*$/im;class XhrLoader{constructor(r){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=r&&r.xhrSetup||null,this.stats=new LoadStats,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const r=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),r&&(r.onreadystatechange=null,r.onprogress=null,r.readyState!==4&&(this.stats.aborted=!0,r.abort()))}abort(){var r;this.abortInternal(),(r=this.callbacks)!=null&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(r,e,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=r,this.config=e,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:r,context:e}=this;if(!r||!e)return;const n=this.loader=new self.XMLHttpRequest,o=this.stats;o.loading.first=0,o.loaded=0,o.aborted=!1;const s=this.xhrSetup;s?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return s(n,e.url)}).catch(l=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",e.url,!0),s(n,e.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,e,r)}).catch(l=>{this.callbacks.onError({code:n.status,text:l.message},e,n,o)}):this.openAndSendXhr(n,e,r)}openAndSendXhr(r,e,n){r.readyState||r.open("GET",e.url,!0);const o=e.headers,{maxTimeToFirstByteMs:s,maxLoadTimeMs:l}=n.loadPolicy;if(o)for(const c in o)r.setRequestHeader(c,o[c]);e.rangeEnd&&r.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),r.onreadystatechange=this.readystatechange.bind(this),r.onprogress=this.loadprogress.bind(this),r.responseType=e.responseType,self.clearTimeout(this.requestTimeout),n.timeout=s&&isFiniteNumber(s)?s:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),r.send()}readystatechange(){const{context:r,loader:e,stats:n}=this;if(!r||!e)return;const o=e.readyState,s=this.config;if(!n.aborted&&o>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),s.timeout!==s.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),s.timeout=s.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),o===4)){self.clearTimeout(this.requestTimeout),e.onreadystatechange=null,e.onprogress=null;const l=e.status,c=e.responseType!=="text";if(l>=200&&l<300&&(c&&e.response||e.responseText!==null)){n.loading.end=Math.max(self.performance.now(),n.loading.first);const u=c?e.response:e.responseText,f=e.responseType==="arraybuffer"?u.byteLength:u.length;if(n.loaded=n.total=f,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first),!this.callbacks)return;const d=this.callbacks.onProgress;if(d&&d(n,r,u,e),!this.callbacks)return;const g={url:e.responseURL,data:u,code:l};this.callbacks.onSuccess(g,n,r,e)}else{const u=s.loadPolicy.errorRetry,f=n.retry,d={url:r.url,data:void 0,code:l};shouldRetry(u,f,!1,d)?this.retry(u):(logger.error(`${l} while loading ${r.url}`),this.callbacks.onError({code:l,text:e.statusText},r,e,n))}}}loadtimeout(){if(!this.config)return;const r=this.config.loadPolicy.timeoutRetry,e=this.stats.retry;if(shouldRetry(r,e,!0))this.retry(r);else{var n;logger.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const o=this.callbacks;o&&(this.abortInternal(),o.onTimeout(this.stats,this.context,this.loader))}}retry(r){const{context:e,stats:n}=this;this.retryDelay=getRetryDelay(r,n.retry),n.retry++,logger.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${e==null?void 0:e.url}, retrying ${n.retry}/${r.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(r){const e=this.stats;e.loaded=r.loaded,r.lengthComputable&&(e.total=r.total)}getCacheAge(){let r=null;if(this.loader&&AGE_HEADER_LINE_REGEX.test(this.loader.getAllResponseHeaders())){const e=this.loader.getResponseHeader("age");r=e?parseFloat(e):null}return r}getResponseHeader(r){return this.loader&&new RegExp(`^${r}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(r):null}}function fetchSupported(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const BYTERANGE=/(\d+)-(\d+)\/(\d+)/;class FetchLoader{constructor(r){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=r.fetchSetup||getRequest,this.controller=new self.AbortController,this.stats=new LoadStats}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var r;this.abortInternal(),(r=this.callbacks)!=null&&r.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(r,e,n){const o=this.stats;if(o.loading.start)throw new Error("Loader can only be used once.");o.loading.start=self.performance.now();const s=getRequestParameters(r,this.controller.signal),l=n.onProgress,c=r.responseType==="arraybuffer",u=c?"byteLength":"length",{maxTimeToFirstByteMs:f,maxLoadTimeMs:d}=e.loadPolicy;this.context=r,this.config=e,this.callbacks=n,this.request=this.fetchSetup(r,s),self.clearTimeout(this.requestTimeout),e.timeout=f&&isFiniteNumber(f)?f:d,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(o,r,this.response)},e.timeout),self.fetch(this.request).then(g=>{this.response=this.loader=g;const p=Math.max(self.performance.now(),o.loading.start);if(self.clearTimeout(this.requestTimeout),e.timeout=d,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),n.onTimeout(o,r,this.response)},d-(p-o.loading.start)),!g.ok){const{status:v,statusText:m}=g;throw new FetchError(m||"fetch, bad network response",v,g)}return o.loading.first=p,o.total=getContentLength(g.headers)||o.total,l&&isFiniteNumber(e.highWaterMark)?this.loadProgressively(g,o,r,e.highWaterMark,l):c?g.arrayBuffer():r.responseType==="json"?g.json():g.text()}).then(g=>{const p=this.response;if(!p)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),o.loading.end=Math.max(self.performance.now(),o.loading.first);const v=g[u];v&&(o.loaded=o.total=v);const m={url:p.url,data:g,code:p.status};l&&!isFiniteNumber(e.highWaterMark)&&l(o,r,g,p),n.onSuccess(m,o,r,p)}).catch(g=>{if(self.clearTimeout(this.requestTimeout),o.aborted)return;const p=g&&g.code||0,v=g?g.message:null;n.onError({code:p,text:v},r,g?g.details:null,o)})}getCacheAge(){let r=null;if(this.response){const e=this.response.headers.get("age");r=e?parseFloat(e):null}return r}getResponseHeader(r){return this.response?this.response.headers.get(r):null}loadProgressively(r,e,n,o=0,s){const l=new ChunkCache,c=r.body.getReader(),u=()=>c.read().then(f=>{if(f.done)return l.dataLength&&s(e,n,l.flush(),r),Promise.resolve(new ArrayBuffer(0));const d=f.value,g=d.length;return e.loaded+=g,g<o||l.dataLength?(l.push(d),l.dataLength>=o&&s(e,n,l.flush(),r)):s(e,n,d,r),u()}).catch(()=>Promise.reject());return u()}}function getRequestParameters(a,r){const e={method:"GET",mode:"cors",credentials:"same-origin",signal:r,headers:new self.Headers(_extends({},a.headers))};return a.rangeEnd&&e.headers.set("Range","bytes="+a.rangeStart+"-"+String(a.rangeEnd-1)),e}function getByteRangeLength(a){const r=BYTERANGE.exec(a);if(r)return parseInt(r[2])-parseInt(r[1])+1}function getContentLength(a){const r=a.get("Content-Range");if(r){const n=getByteRangeLength(r);if(isFiniteNumber(n))return n}const e=a.get("Content-Length");if(e)return parseInt(e)}function getRequest(a,r){return new self.Request(a.url,r)}class FetchError extends Error{constructor(r,e,n){super(r),this.code=void 0,this.details=void 0,this.code=e,this.details=n}}const WHITESPACE_CHAR=/\s/,Cues={newCue(a,r,e,n){const o=[];let s,l,c,u,f;const d=self.VTTCue||self.TextTrackCue;for(let p=0;p<n.rows.length;p++)if(s=n.rows[p],c=!0,u=0,f="",!s.isEmpty()){var g;for(let y=0;y<s.chars.length;y++)WHITESPACE_CHAR.test(s.chars[y].uchar)&&c?u++:(f+=s.chars[y].uchar,c=!1);s.cueStartTime=r,r===e&&(e+=1e-4),u>=16?u--:u++;const v=fixLineBreaks(f.trim()),m=generateCueId(r,e,v);a!=null&&(g=a.cues)!=null&&g.getCueById(m)||(l=new d(r,e,v),l.id=m,l.line=p+1,l.align="left",l.position=10+Math.min(80,Math.floor(u*8/32)*10),o.push(l))}return a&&o.length&&(o.sort((p,v)=>p.line==="auto"||v.line==="auto"?0:p.line>8&&v.line>8?v.line-p.line:p.line-v.line),o.forEach(p=>addCueToTrack(a,p))),o}},defaultLoadPolicy={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},hlsDefaultConfig=_objectSpread2(_objectSpread2({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:XhrLoader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:AbrController,bufferController:BufferController,capLevelController:CapLevelController,errorController:ErrorController,fpsController:FPSController,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:defaultLoadPolicy},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},timelineConfig()),{},{subtitleStreamController:SubtitleStreamController,subtitleTrackController:SubtitleTrackController,timelineController:TimelineController,audioStreamController:AudioStreamController,audioTrackController:AudioTrackController,emeController:EMEController,cmcdController:CMCDController,contentSteeringController:ContentSteeringController});function timelineConfig(){return{cueHandler:Cues,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mergeConfig(a,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const e=deepCpy(a),n=["manifest","level","frag"],o=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return n.forEach(s=>{const l=`${s==="level"?"playlist":s}LoadPolicy`,c=r[l]===void 0,u=[];o.forEach(f=>{const d=`${s}Loading${f}`,g=r[d];if(g!==void 0&&c){u.push(d);const p=e[l].default;switch(r[l]={default:p},f){case"TimeOut":p.maxLoadTimeMs=g,p.maxTimeToFirstByteMs=g;break;case"MaxRetry":p.errorRetry.maxNumRetry=g,p.timeoutRetry.maxNumRetry=g;break;case"RetryDelay":p.errorRetry.retryDelayMs=g,p.timeoutRetry.retryDelayMs=g;break;case"MaxRetryTimeout":p.errorRetry.maxRetryDelayMs=g,p.timeoutRetry.maxRetryDelayMs=g;break}}}),u.length&&logger.warn(`hls.js config: "${u.join('", "')}" setting(s) are deprecated, use "${l}": ${JSON.stringify(r[l])}`)}),_objectSpread2(_objectSpread2({},e),r)}function deepCpy(a){return a&&typeof a=="object"?Array.isArray(a)?a.map(deepCpy):Object.keys(a).reduce((r,e)=>(r[e]=deepCpy(a[e]),r),{}):a}function enableStreamingMode(a){const r=a.loader;r!==FetchLoader&&r!==XhrLoader?(logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1):fetchSupported()&&(a.loader=FetchLoader,a.progressive=!0,a.enableSoftwareAES=!0,logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}let chromeOrFirefox;class LevelController extends BasePlaylistController{constructor(r,e){super(r,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=e,this._registerListeners()}_registerListeners(){const{hls:r}=this;r.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),r.on(Events.ERROR,this.onError,this)}_unregisterListeners(){const{hls:r}=this;r.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),r.off(Events.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(r,e){this.resetLevels()}onManifestLoaded(r,e){const n=this.hls.config.preferManagedMediaSource,o=[],s={},l={};let c=!1,u=!1,f=!1;e.levels.forEach(d=>{var g,p;const v=d.attrs;let{audioCodec:m,videoCodec:y}=d;((g=m)==null?void 0:g.indexOf("mp4a.40.34"))!==-1&&(chromeOrFirefox||(chromeOrFirefox=/chrome|firefox/i.test(navigator.userAgent)),chromeOrFirefox&&(d.audioCodec=m=void 0)),m&&(d.audioCodec=m=getCodecCompatibleName(m,n)),((p=y)==null?void 0:p.indexOf("avc1"))===0&&(y=d.videoCodec=convertAVC1ToAVCOTI(y));const{width:x,height:_,unknownCodecs:E}=d;if(c||(c=!!(x&&_)),u||(u=!!y),f||(f=!!m),E!=null&&E.length||m&&!areCodecsMediaSourceSupported(m,"audio",n)||y&&!areCodecsMediaSourceSupported(y,"video",n))return;const{CODECS:S,"FRAME-RATE":A,"HDCP-LEVEL":T,"PATHWAY-ID":b,RESOLUTION:C,"VIDEO-RANGE":L}=v,I=`${`${b||"."}-`}${d.bitrate}-${C}-${A}-${S}-${L}-${T}`;if(s[I])if(s[I].uri!==d.url&&!d.attrs["PATHWAY-ID"]){const w=l[I]+=1;d.attrs["PATHWAY-ID"]=new Array(w+1).join(".");const M=new Level(d);s[I]=M,o.push(M)}else s[I].addGroupId("audio",v.AUDIO),s[I].addGroupId("text",v.SUBTITLES);else{const w=new Level(d);s[I]=w,l[I]=1,o.push(w)}}),this.filterAndSortMediaOptions(o,e,c,u,f)}filterAndSortMediaOptions(r,e,n,o,s){let l=[],c=[],u=r;if((n||o)&&s&&(u=u.filter(({videoCodec:m,videoRange:y,width:x,height:_})=>(!!m||!!(x&&_))&&isVideoRange(y))),u.length===0){Promise.resolve().then(()=>{if(this.hls){e.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(e.levels[0].attrs)}`);const m=new Error("no level with compatible codecs found in manifest");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,error:m,reason:m.message})}});return}if(e.audioTracks){const{preferManagedMediaSource:m}=this.hls.config;l=e.audioTracks.filter(y=>!y.audioCodec||areCodecsMediaSourceSupported(y.audioCodec,"audio",m)),assignTrackIdsByGroup(l)}e.subtitles&&(c=e.subtitles,assignTrackIdsByGroup(c));const f=u.slice(0);u.sort((m,y)=>{if(m.attrs["HDCP-LEVEL"]!==y.attrs["HDCP-LEVEL"])return(m.attrs["HDCP-LEVEL"]||"")>(y.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&m.height!==y.height)return m.height-y.height;if(m.frameRate!==y.frameRate)return m.frameRate-y.frameRate;if(m.videoRange!==y.videoRange)return VideoRangeValues.indexOf(m.videoRange)-VideoRangeValues.indexOf(y.videoRange);if(m.videoCodec!==y.videoCodec){const x=videoCodecPreferenceValue(m.videoCodec),_=videoCodecPreferenceValue(y.videoCodec);if(x!==_)return _-x}if(m.uri===y.uri&&m.codecSet!==y.codecSet){const x=codecsSetSelectionPreferenceValue(m.codecSet),_=codecsSetSelectionPreferenceValue(y.codecSet);if(x!==_)return _-x}return m.averageBitrate!==y.averageBitrate?m.averageBitrate-y.averageBitrate:0});let d=f[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==f.length)){for(let m=0;m<f.length;m++)if(f[m].pathwayId===u[0].pathwayId){d=f[m];break}}this._levels=u;for(let m=0;m<u.length;m++)if(u[m]===d){var g;this._firstLevel=m;const y=d.bitrate,x=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${u.length} level(s) found, first bitrate: ${y}`),((g=this.hls.userConfig)==null?void 0:g.abrEwmaDefaultEstimate)===void 0){const _=Math.min(y,this.hls.config.abrEwmaDefaultEstimateMax);_>x&&x===hlsDefaultConfig.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=_)}break}const p=s&&!o,v={levels:u,audioTracks:l,subtitleTracks:c,sessionData:e.sessionData,sessionKeys:e.sessionKeys,firstLevel:this._firstLevel,stats:e.stats,audio:s,video:o,altAudio:!p&&l.some(m=>!!m.url)};this.hls.trigger(Events.MANIFEST_PARSED,v),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(r){const e=this._levels;if(e.length===0)return;if(r<0||r>=e.length){const d=new Error("invalid level idx"),g=r<0;if(this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.LEVEL_SWITCH_ERROR,level:r,fatal:g,error:d,reason:d.message}),g)return;r=Math.min(r,e.length-1)}const n=this.currentLevelIndex,o=this.currentLevel,s=o?o.attrs["PATHWAY-ID"]:void 0,l=e[r],c=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=r,this.currentLevel=l,n===r&&l.details&&o&&s===c)return;this.log(`Switching to level ${r} (${l.height?l.height+"p ":""}${l.videoRange?l.videoRange+" ":""}${l.codecSet?l.codecSet+" ":""}@${l.bitrate})${c?" with Pathway "+c:""} from level ${n}${s?" with Pathway "+s:""}`);const u={level:r,attrs:l.attrs,details:l.details,bitrate:l.bitrate,averageBitrate:l.averageBitrate,maxBitrate:l.maxBitrate,realBitrate:l.realBitrate,width:l.width,height:l.height,codecSet:l.codecSet,audioCodec:l.audioCodec,videoCodec:l.videoCodec,audioGroups:l.audioGroups,subtitleGroups:l.subtitleGroups,loaded:l.loaded,loadError:l.loadError,fragmentError:l.fragmentError,name:l.name,id:l.id,uri:l.uri,url:l.url,urlId:0,audioGroupIds:l.audioGroupIds,textGroupIds:l.textGroupIds};this.hls.trigger(Events.LEVEL_SWITCHING,u);const f=l.details;if(!f||f.live){const d=this.switchParams(l.uri,o==null?void 0:o.details,f);this.loadPlaylist(d)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(r){this.manualLevelIndex=r,this._startLevel===void 0&&(this._startLevel=r),r!==-1&&(this.level=r)}get firstLevel(){return this._firstLevel}set firstLevel(r){this._firstLevel=r}get startLevel(){if(this._startLevel===void 0){const r=this.hls.config.startLevel;return r!==void 0?r:this.hls.firstAutoLevel}return this._startLevel}set startLevel(r){this._startLevel=r}onError(r,e){e.fatal||!e.context||e.context.type===PlaylistContextType.LEVEL&&e.context.level===this.level&&this.checkRetry(e)}onFragBuffered(r,{frag:e}){if(e!==void 0&&e.type===PlaylistLevelType.MAIN){const n=e.elementaryStreams;if(!Object.keys(n).some(s=>!!n[s]))return;const o=this._levels[e.level];o!=null&&o.loadError&&(this.log(`Resetting level error count of ${o.loadError} on frag buffered`),o.loadError=0)}}onLevelLoaded(r,e){var n;const{level:o,details:s}=e,l=this._levels[o];if(!l){var c;this.warn(`Invalid level index ${o}`),(c=e.deliveryDirectives)!=null&&c.skip&&(s.deltaUpdateFailed=!0);return}o===this.currentLevelIndex?(l.fragmentError===0&&(l.loadError=0),this.playlistLoaded(o,e,l.details)):(n=e.deliveryDirectives)!=null&&n.skip&&(s.deltaUpdateFailed=!0)}loadPlaylist(r){super.loadPlaylist();const e=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){let o=n.uri;if(r)try{o=r.addDirectives(o)}catch(l){this.warn(`Could not construct new URL with HLS Delivery Directives: ${l}`)}const s=n.attrs["PATHWAY-ID"];this.log(`Loading level index ${e}${(r==null?void 0:r.msn)!==void 0?" at sn "+r.msn+" part "+r.part:""} with${s?" Pathway "+s:""} ${o}`),this.clearTimer(),this.hls.trigger(Events.LEVEL_LOADING,{url:o,level:e,pathwayId:n.attrs["PATHWAY-ID"],id:0,deliveryDirectives:r||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(r){this.level=r,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=r)}removeLevel(r){var e;const n=this._levels.filter((o,s)=>s!==r?!0:(this.steering&&this.steering.removeLevel(o),o===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,o.details&&o.details.fragments.forEach(l=>l.level=-1)),!1));reassignFragmentLevelIndexes(n),this._levels=n,this.currentLevelIndex>-1&&(e=this.currentLevel)!=null&&e.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(Events.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(r,{levels:e}){this._levels=e}checkMaxAutoUpdated(){const{autoLevelCapping:r,maxAutoLevel:e,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==e&&(this._maxAutoLevel=e,this.hls.trigger(Events.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:r,levels:this.levels,maxAutoLevel:e,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function assignTrackIdsByGroup(a){const r={};a.forEach(e=>{const n=e.groupId||"";e.id=r[n]=r[n]||0,r[n]++})}class KeyLoader{constructor(r){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=r}abort(r){for(const n in this.keyUriToKeyInfo){const o=this.keyUriToKeyInfo[n].loader;if(o){var e;if(r&&r!==((e=o.context)==null?void 0:e.frag.type))return;o.abort()}}}detach(){for(const r in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[r];(e.mediaKeySessionContext||e.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[r]}}destroy(){this.detach();for(const r in this.keyUriToKeyInfo){const e=this.keyUriToKeyInfo[r].loader;e&&e.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(r,e=ErrorDetails.KEY_LOAD_ERROR,n,o,s){return new LoadError({type:ErrorTypes.NETWORK_ERROR,details:e,fatal:!1,frag:r,response:s,error:n,networkDetails:o})}loadClear(r,e){if(this.emeController&&this.config.emeEnabled){const{sn:n,cc:o}=r;for(let s=0;s<e.length;s++){const l=e[s];if(o<=l.cc&&(n==="initSegment"||l.sn==="initSegment"||n<l.sn)){this.emeController.selectKeySystemFormat(l).then(c=>{l.setKeyFormat(c)});break}}}}load(r){return!r.decryptdata&&r.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(r).then(e=>this.loadInternal(r,e)):this.loadInternal(r)}loadInternal(r,e){var n,o;e&&r.setKeyFormat(e);const s=r.decryptdata;if(!s){const f=new Error(e?`Expected frag.decryptdata to be defined after setting format ${e}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(r,ErrorDetails.KEY_LOAD_ERROR,f))}const l=s.uri;if(!l)return Promise.reject(this.createKeyLoadError(r,ErrorDetails.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${l}"`)));let c=this.keyUriToKeyInfo[l];if((n=c)!=null&&n.decryptdata.key)return s.key=c.decryptdata.key,Promise.resolve({frag:r,keyInfo:c});if((o=c)!=null&&o.keyLoadPromise){var u;switch((u=c.mediaKeySessionContext)==null?void 0:u.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return c.keyLoadPromise.then(f=>(s.key=f.keyInfo.decryptdata.key,{frag:r,keyInfo:c}))}}switch(c=this.keyUriToKeyInfo[l]={decryptdata:s,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},s.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return s.keyFormat==="identity"?this.loadKeyHTTP(c,r):this.loadKeyEME(c,r);case"AES-128":return this.loadKeyHTTP(c,r);default:return Promise.reject(this.createKeyLoadError(r,ErrorDetails.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${s.method}"`)))}}loadKeyEME(r,e){const n={frag:e,keyInfo:r};if(this.emeController&&this.config.emeEnabled){const o=this.emeController.loadKey(n);if(o)return(r.keyLoadPromise=o.then(s=>(r.mediaKeySessionContext=s,n))).catch(s=>{throw r.keyLoadPromise=null,s})}return Promise.resolve(n)}loadKeyHTTP(r,e){const n=this.config,o=n.loader,s=new o(n);return e.keyLoader=r.loader=s,r.keyLoadPromise=new Promise((l,c)=>{const u={keyInfo:r,frag:e,responseType:"arraybuffer",url:r.decryptdata.uri},f=n.keyLoadPolicy.default,d={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(p,v,m,y)=>{const{frag:x,keyInfo:_,url:E}=m;if(!x.decryptdata||_!==this.keyUriToKeyInfo[E])return c(this.createKeyLoadError(x,ErrorDetails.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),y));_.decryptdata.key=x.decryptdata.key=new Uint8Array(p.data),x.keyLoader=null,_.loader=null,l({frag:x,keyInfo:_})},onError:(p,v,m,y)=>{this.resetLoader(v),c(this.createKeyLoadError(e,ErrorDetails.KEY_LOAD_ERROR,new Error(`HTTP Error ${p.code} loading key ${p.text}`),m,_objectSpread2({url:u.url,data:void 0},p)))},onTimeout:(p,v,m)=>{this.resetLoader(v),c(this.createKeyLoadError(e,ErrorDetails.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),m))},onAbort:(p,v,m)=>{this.resetLoader(v),c(this.createKeyLoadError(e,ErrorDetails.INTERNAL_ABORTED,new Error("key loading aborted"),m))}};s.load(u,d,g)})}resetLoader(r){const{frag:e,keyInfo:n,url:o}=r,s=n.loader;e.keyLoader===s&&(e.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[o],s&&s.destroy()}}function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer}function isMSESupported(){if(!getMediaSource())return!1;const r=getSourceBuffer();return!r||r.prototype&&typeof r.prototype.appendBuffer=="function"&&typeof r.prototype.remove=="function"}function isSupported(){if(!isMSESupported())return!1;const a=getMediaSource();return typeof(a==null?void 0:a.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(r=>a.isTypeSupported(mimeTypeForCodec(r,"video")))||["mp4a.40.2","fLaC"].some(r=>a.isTypeSupported(mimeTypeForCodec(r,"audio"))))}function changeTypeSupported(){var a;const r=getSourceBuffer();return typeof(r==null||(a=r.prototype)==null?void 0:a.changeType)=="function"}const STALL_MINIMUM_DURATION_MS=250,MAX_START_GAP_JUMP=2,SKIP_BUFFER_HOLE_STEP_SECONDS=.1,SKIP_BUFFER_RANGE_START=.05;class GapController{constructor(r,e,n,o){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=r,this.media=e,this.fragmentTracker=n,this.hls=o}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(r,e){const{config:n,media:o,stalled:s}=this;if(o===null)return;const{currentTime:l,seeking:c}=o,u=this.seeking&&!c,f=!this.seeking&&c;if(this.seeking=c,l!==r){if(this.moved=!0,c||(this.nudgeRetry=0),s!==null){if(this.stallReported){const x=self.performance.now()-s;logger.warn(`playback not stuck anymore @${l}, after ${Math.round(x)}ms`),this.stallReported=!1}this.stalled=null}return}if(f||u){this.stalled=null;return}if(o.paused&&!c||o.ended||o.playbackRate===0||!BufferHelper.getBuffered(o).length){this.nudgeRetry=0;return}const d=BufferHelper.bufferInfo(o,l,0),g=d.nextStart||0;if(c){const x=d.len>MAX_START_GAP_JUMP,_=!g||e&&e.start<=l||g-l>MAX_START_GAP_JUMP&&!this.fragmentTracker.getPartialFragment(l);if(x||_)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var p;if(!(d.len>0)&&!g)return;const _=Math.max(g,d.start||0)-l,E=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,A=(E==null||(p=E.details)==null?void 0:p.live)?E.details.targetduration*2:MAX_START_GAP_JUMP,T=this.fragmentTracker.getPartialFragment(l);if(_>0&&(_<=A||T)){o.paused||this._trySkipBufferHole(T);return}}const v=self.performance.now();if(s===null){this.stalled=v;return}const m=v-s;if(!c&&m>=STALL_MINIMUM_DURATION_MS&&(this._reportStall(d),!this.media))return;const y=BufferHelper.bufferInfo(o,l,n.maxBufferHole);this._tryFixBufferStall(y,m)}_tryFixBufferStall(r,e){const{config:n,fragmentTracker:o,media:s}=this;if(s===null)return;const l=s.currentTime,c=o.getPartialFragment(l);c&&(this._trySkipBufferHole(c)||!this.media)||(r.len>n.maxBufferHole||r.nextStart&&r.nextStart-l<n.maxBufferHole)&&e>n.highBufferWatchdogPeriod*1e3&&(logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(r){const{hls:e,media:n,stallReported:o}=this;if(!o&&n){this.stallReported=!0;const s=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${JSON.stringify(r)})`);logger.warn(s.message),e.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,error:s,buffer:r.len})}}_trySkipBufferHole(r){const{config:e,hls:n,media:o}=this;if(o===null)return 0;const s=o.currentTime,l=BufferHelper.bufferInfo(o,s,0),c=s<l.start?l.start:l.nextStart;if(c){const u=l.len<=e.maxBufferHole,f=l.len>0&&l.len<1&&o.readyState<3,d=c-s;if(d>0&&(u||f)){if(d>e.maxBufferHole){const{fragmentTracker:p}=this;let v=!1;if(s===0){const m=p.getAppendedFrag(0,PlaylistLevelType.MAIN);m&&c<m.end&&(v=!0)}if(!v){const m=r||p.getAppendedFrag(s,PlaylistLevelType.MAIN);if(m){let y=!1,x=m.end;for(;x<c;){const _=p.getPartialFragment(x);if(_)x+=_.duration;else{y=!0;break}}if(y)return 0}}}const g=Math.max(c+SKIP_BUFFER_RANGE_START,s+SKIP_BUFFER_HOLE_STEP_SECONDS);if(logger.warn(`skipping hole, adjusting currentTime from ${s} to ${g}`),this.moved=!0,this.stalled=null,o.currentTime=g,r&&!r.gap){const p=new Error(`fragment loaded with buffer holes, seeking from ${s} to ${g}`);n.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:r})}return g}}return 0}_tryNudgeBuffer(){const{config:r,hls:e,media:n,nudgeRetry:o}=this;if(n===null)return;const s=n.currentTime;if(this.nudgeRetry++,o<r.nudgeMaxRetry){const l=s+(o+1)*r.nudgeOffset,c=new Error(`Nudging 'currentTime' from ${s} to ${l}`);logger.warn(c.message),n.currentTime=l,e.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_NUDGE_ON_STALL,error:c,fatal:!1})}else{const l=new Error(`Playhead still not moving while enough data buffered @${s} after ${r.nudgeMaxRetry} nudges`);logger.error(l.message),e.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,error:l,fatal:!0})}}}const TICK_INTERVAL=100;class StreamController extends BaseStreamController{constructor(r,e,n){super(r,e,n,"[stream-controller]",PlaylistLevelType.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:r}=this;r.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(Events.ERROR,this.onError,this),r.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:r}=this;r.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(Events.ERROR,this.onError,this),r.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(r){if(this.levels){const{lastCurrentTime:e,hls:n}=this;if(this.stopLoad(),this.setInterval(TICK_INTERVAL),this.level=-1,!this.startFragRequested){let o=n.startLevel;o===-1&&(n.config.testBandwidth&&this.levels.length>1?(o=0,this.bitrateTest=!0):o=n.firstAutoLevel),n.nextLoadLevel=o,this.level=n.loadLevel,this.loadedmetadata=!1}e>0&&r===-1&&(this.log(`Override startPosition with lastCurrentTime @${e.toFixed(3)}`),r=e),this.state=State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=State.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case State.WAITING_LEVEL:{const{levels:e,level:n}=this,o=e==null?void 0:e[n],s=o==null?void 0:o.details;if(s&&(!s.live||this.levelLastLoaded===o)){if(this.waitForCdnTuneIn(s))break;this.state=State.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=State.IDLE;break}break}case State.FRAG_LOADING_WAITING_RETRY:{var r;const e=self.performance.now(),n=this.retryDate;if(!n||e>=n||(r=this.media)!=null&&r.seeking){const{levels:o,level:s}=this,l=o==null?void 0:o[s];this.resetStartWhenNotLoaded(l||null),this.state=State.IDLE}}break}this.state===State.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:r,levelLastLoaded:e,levels:n,media:o}=this;if(e===null||!o&&(this.startFragRequested||!r.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const s=r.nextLoadLevel;if(!(n!=null&&n[s]))return;const l=n[s],c=this.getMainFwdBufferInfo();if(c===null)return;const u=this.getLevelDetails();if(u&&this._streamEnded(c,u)){const y={};this.altAudio&&(y.type="video"),this.hls.trigger(Events.BUFFER_EOS,y),this.state=State.ENDED;return}r.loadLevel!==s&&r.manualLevel===-1&&this.log(`Adapting to level ${s} from level ${this.level}`),this.level=r.nextLoadLevel=s;const f=l.details;if(!f||this.state===State.WAITING_LEVEL||f.live&&this.levelLastLoaded!==l){this.level=s,this.state=State.WAITING_LEVEL;return}const d=c.len,g=this.getMaxBufferLength(l.maxBitrate);if(d>=g)return;this.backtrackFragment&&this.backtrackFragment.start>c.end&&(this.backtrackFragment=null);const p=this.backtrackFragment?this.backtrackFragment.start:c.end;let v=this.getNextFragment(p,f);if(this.couldBacktrack&&!this.fragPrevious&&v&&v.sn!=="initSegment"&&this.fragmentTracker.getState(v)!==FragmentState.OK){var m;const x=((m=this.backtrackFragment)!=null?m:v).sn-f.startSN,_=f.fragments[x-1];_&&v.cc===_.cc&&(v=_,this.fragmentTracker.removeFragment(_))}else this.backtrackFragment&&c.len&&(this.backtrackFragment=null);if(v&&this.isLoopLoading(v,p)){if(!v.gap){const x=this.audioOnly&&!this.altAudio?ElementaryStreamTypes.AUDIO:ElementaryStreamTypes.VIDEO,_=(x===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;_&&this.afterBufferFlushed(_,x,PlaylistLevelType.MAIN)}v=this.getNextFragmentLoopLoading(v,f,c,PlaylistLevelType.MAIN,g)}v&&(v.initSegment&&!v.initSegment.data&&!this.bitrateTest&&(v=v.initSegment),this.loadFragment(v,l,p))}loadFragment(r,e,n){const o=this.fragmentTracker.getState(r);this.fragCurrent=r,o===FragmentState.NOT_LOADED||o===FragmentState.PARTIAL?r.sn==="initSegment"?this._loadInitSegment(r,e):this.bitrateTest?(this.log(`Fragment ${r.sn} of level ${r.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(r,e)):(this.startFragRequested=!0,super.loadFragment(r,e,n)):this.clearTrackerIfNeeded(r)}getBufferedFrag(r){return this.fragmentTracker.getBufferedFrag(r,PlaylistLevelType.MAIN)}followingBufferedFrag(r){return r?this.getBufferedFrag(r.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:r,media:e}=this;if(e!=null&&e.readyState){let n;const o=this.getAppendedFrag(e.currentTime);o&&o.start>1&&this.flushMainBuffer(0,o.start-1);const s=this.getLevelDetails();if(s!=null&&s.live){const c=this.getMainFwdBufferInfo();if(!c||c.len<s.targetduration*2)return}if(!e.paused&&r){const c=this.hls.nextLoadLevel,u=r[c],f=this.fragLastKbps;f&&this.fragCurrent?n=this.fragCurrent.duration*u.maxBitrate/(1e3*f)+1:n=0}else n=0;const l=this.getBufferedFrag(e.currentTime+n);if(l){const c=this.followingBufferedFrag(l);if(c){this.abortCurrentFrag();const u=c.maxStartPTS?c.maxStartPTS:c.start,f=c.duration,d=Math.max(l.end,u+Math.min(Math.max(f-this.config.maxFragLookUpTolerance,f*(this.couldBacktrack?.5:.125)),f*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(d,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const r=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,r&&(r.abortRequests(),this.fragmentTracker.removeFragment(r)),this.state){case State.KEY_LOADING:case State.FRAG_LOADING:case State.FRAG_LOADING_WAITING_RETRY:case State.PARSING:case State.PARSED:this.state=State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(r,e){super.flushMainBuffer(r,e,this.altAudio?"video":null)}onMediaAttached(r,e){super.onMediaAttached(r,e);const n=e.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new GapController(this.config,n,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:r}=this;r&&this.onvplaying&&this.onvseeked&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const r=this.media,e=r?r.currentTime:null;isFiniteNumber(e)&&this.log(`Media seeked to ${e.toFixed(3)}`);const n=this.getMainFwdBufferInfo();if(n===null||n.len===0){this.warn(`Main forward buffer length on "seeked" event ${n?n.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(r,e){let n=!1,o=!1;e.levels.forEach(s=>{const l=s.audioCodec;l&&(n=n||l.indexOf("mp4a.40.2")!==-1,o=o||l.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=n&&o&&!changeTypeSupported(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1}onLevelLoading(r,e){const{levels:n}=this;if(!n||this.state!==State.IDLE)return;const o=n[e.level];(!o.details||o.details.live&&this.levelLastLoaded!==o||this.waitForCdnTuneIn(o.details))&&(this.state=State.WAITING_LEVEL)}onLevelLoaded(r,e){var n;const{levels:o}=this,s=e.level,l=e.details,c=l.totalduration;if(!o){this.warn(`Levels were reset while loading level ${s}`);return}this.log(`Level ${s} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""}, cc [${l.startCC}, ${l.endCC}] duration:${c}`);const u=o[s],f=this.fragCurrent;f&&(this.state===State.FRAG_LOADING||this.state===State.FRAG_LOADING_WAITING_RETRY)&&f.level!==e.level&&f.loader&&this.abortCurrentFrag();let d=0;if(l.live||(n=u.details)!=null&&n.live){var g;if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;d=this.alignPlaylists(l,u.details,(g=this.levelLastLoaded)==null?void 0:g.details)}if(u.details=l,this.levelLastLoaded=u,this.hls.trigger(Events.LEVEL_UPDATED,{details:l,level:s}),this.state===State.WAITING_LEVEL){if(this.waitForCdnTuneIn(l))return;this.state=State.IDLE}this.startFragRequested?l.live&&this.synchronizeToLiveEdge(l):this.setStartPosition(l,d),this.tick()}_handleFragmentLoadProgress(r){var e;const{frag:n,part:o,payload:s}=r,{levels:l}=this;if(!l){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const c=l[n.level],u=c.details;if(!u){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const f=c.videoCodec,d=u.PTSKnown||!u.live,g=(e=n.initSegment)==null?void 0:e.data,p=this._getAudioCodec(c),v=this.transmuxer=this.transmuxer||new TransmuxerInterface(this.hls,PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=o?o.index:-1,y=m!==-1,x=new ChunkMetadata(n.level,n.sn,n.stats.chunkCount,s.byteLength,m,y),_=this.initPTS[n.cc];v.push(s,g,p,f,n,o,u.totalduration,d,x,_)}onAudioTrackSwitching(r,e){const n=this.altAudio;if(!!!e.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const l=this.fragCurrent;l&&(this.log("Switching to main audio track, cancel main fragment load"),l.abortRequests(),this.fragmentTracker.removeFragment(l)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const s=this.hls;n&&(s.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),s.trigger(Events.AUDIO_TRACK_SWITCHED,e)}}onAudioTrackSwitched(r,e){const n=e.id,o=!!this.hls.audioTracks[n].url;if(o){const s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=o,this.tick()}onBufferCreated(r,e){const n=e.tracks;let o,s,l=!1;for(const c in n){const u=n[c];if(u.id==="main"){if(s=c,o=u,c==="video"){const f=n[c];f&&(this.videoBuffer=f.buffer)}}else l=!0}l&&o?(this.log(`Alternate track found, use ${s}.buffered to schedule main fragment loading`),this.mediaBuffer=o.buffer):this.mediaBuffer=this.media}onFragBuffered(r,e){const{frag:n,part:o}=e;if(n&&n.type!==PlaylistLevelType.MAIN)return;if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${o?" p: "+o.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===State.PARSED&&(this.state=State.IDLE);return}const s=o?o.stats:n.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),n.sn!=="initSegment"&&(this.fragPrevious=n),this.fragBufferedComplete(n,o)}onError(r,e){var n;if(e.fatal){this.state=State.ERROR;return}switch(e.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.MAIN,e);break;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!e.levelRetry&&this.state===State.WAITING_LEVEL&&((n=e.context)==null?void 0:n.type)===PlaylistContextType.LEVEL&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!e.parent||e.parent!=="main")return;if(e.details===ErrorDetails.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(e)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(e);break}}checkBuffer(){const{media:r,gapController:e}=this;if(!(!r||!e||!r.readyState)){if(this.loadedmetadata||!BufferHelper.getBuffered(r).length){const n=this.state!==State.IDLE?this.fragCurrent:null;e.poll(this.lastCurrentTime,n)}this.lastCurrentTime=r.currentTime}}onFragLoadEmergencyAborted(){this.state=State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(r,{type:e}){if(e!==ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){const n=(e===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,e,PlaylistLevelType.MAIN),this.tick()}}onLevelsUpdated(r,e){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=e.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:r}=this;if(!r)return;const e=r.currentTime;let n=this.startPosition;if(n>=0&&e<n){if(r.seeking){this.log(`could not seek to ${n}, already seeking at ${e}`);return}const o=BufferHelper.getBuffered(r),l=(o.length?o.start(0):0)-n;l>0&&(l<this.config.maxBufferHole||l<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${l} to match buffer start`),n+=l,this.startPosition=n),this.log(`seek to target start position ${n} from current time ${e}`),r.currentTime=n}}_getAudioCodec(r){let e=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e.indexOf("mp4a.40.5")!==-1?e="mp4a.40.2":e="mp4a.40.5"),e}_loadBitrateTestFrag(r,e){r.bitrateTest=!0,this._doFragLoad(r,e).then(n=>{const{hls:o}=this;if(!n||this.fragContextChanged(r))return;e.fragmentError=0,this.state=State.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const s=r.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),o.trigger(Events.FRAG_LOADED,n),r.bitrateTest=!1})}_handleTransmuxComplete(r){var e;const n="main",{hls:o}=this,{remuxResult:s,chunkMeta:l}=r,c=this.getCurrentContext(l);if(!c){this.resetWhenMissingContext(l);return}const{frag:u,part:f,level:d}=c,{video:g,text:p,id3:v,initSegment:m}=s,{details:y}=d,x=this.altAudio?void 0:s.audio;if(this.fragContextChanged(u)){this.fragmentTracker.removeFragment(u);return}if(this.state=State.PARSING,m){if(m!=null&&m.tracks){const S=u.initSegment||u;this._bufferInitSegment(d,m.tracks,S,l),o.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:n,tracks:m.tracks})}const _=m.initPTS,E=m.timescale;isFiniteNumber(_)&&(this.initPTS[u.cc]={baseTime:_,timescale:E},o.trigger(Events.INIT_PTS_FOUND,{frag:u,id:n,initPTS:_,timescale:E}))}if(g&&y&&u.sn!=="initSegment"){const _=y.fragments[u.sn-1-y.startSN],E=u.sn===y.startSN,S=!_||u.cc>_.cc;if(s.independent!==!1){const{startPTS:A,endPTS:T,startDTS:b,endDTS:C}=g;if(f)f.elementaryStreams[g.type]={startPTS:A,endPTS:T,startDTS:b,endDTS:C};else if(g.firstKeyFrame&&g.independent&&l.id===1&&!S&&(this.couldBacktrack=!0),g.dropped&&g.independent){const L=this.getMainFwdBufferInfo(),R=(L?L.end:this.getLoadPosition())+this.config.maxBufferHole,I=g.firstKeyFramePTS?g.firstKeyFramePTS:A;if(!E&&R<I-this.config.maxBufferHole&&!S){this.backtrack(u);return}else S&&(u.gap=!0);u.setElementaryStreamInfo(g.type,u.start,T,u.start,C,!0)}else E&&A>MAX_START_GAP_JUMP&&(u.gap=!0);u.setElementaryStreamInfo(g.type,A,T,b,C),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(g,u,f,l,E||S)}else if(E||S)u.gap=!0;else{this.backtrack(u);return}}if(x){const{startPTS:_,endPTS:E,startDTS:S,endDTS:A}=x;f&&(f.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:_,endPTS:E,startDTS:S,endDTS:A}),u.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,_,E,S,A),this.bufferFragmentData(x,u,f,l)}if(y&&v!=null&&(e=v.samples)!=null&&e.length){const _={id:n,frag:u,details:y,samples:v.samples};o.trigger(Events.FRAG_PARSING_METADATA,_)}if(y&&p){const _={id:n,frag:u,details:y,samples:p.samples};o.trigger(Events.FRAG_PARSING_USERDATA,_)}}_bufferInitSegment(r,e,n,o){if(this.state!==State.PARSING)return;this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&delete e.audio;const{audio:s,video:l,audiovideo:c}=e;if(s){let u=r.audioCodec;const f=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const d=s.metadata;d&&"channelCount"in d&&(d.channelCount||1)!==1&&f.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&f.indexOf("android")!==-1&&s.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),r.audioCodec&&r.audioCodec!==u&&this.log(`Swapping manifest audio codec "${r.audioCodec}" for "${u}"`),s.levelCodec=u,s.id="main",this.log(`Init audio buffer, container:${s.container}, codecs[selected/level/parsed]=[${u||""}/${r.audioCodec||""}/${s.codec}]`)}l&&(l.levelCodec=r.videoCodec,l.id="main",this.log(`Init video buffer, container:${l.container}, codecs[level/parsed]=[${r.videoCodec||""}/${l.codec}]`)),c&&this.log(`Init audiovideo buffer, container:${c.container}, codecs[level/parsed]=[${r.codecs}/${c.codec}]`),this.hls.trigger(Events.BUFFER_CODECS,e),Object.keys(e).forEach(u=>{const d=e[u].initSegment;d!=null&&d.byteLength&&this.hls.trigger(Events.BUFFER_APPENDING,{type:u,data:d,frag:n,part:null,chunkMeta:o,parent:n.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,PlaylistLevelType.MAIN)}backtrack(r){this.couldBacktrack=!0,this.backtrackFragment=r,this.resetTransmuxer(),this.flushBufferGap(r),this.fragmentTracker.removeFragment(r),this.fragPrevious=null,this.nextLoadPosition=r.start,this.state=State.IDLE}checkFragmentChanged(){const r=this.media;let e=null;if(r&&r.readyState>1&&r.seeking===!1){const n=r.currentTime;if(BufferHelper.isBuffered(r,n)?e=this.getAppendedFrag(n):BufferHelper.isBuffered(r,n+.1)&&(e=this.getAppendedFrag(n+.1)),e){this.backtrackFragment=null;const o=this.fragPlaying,s=e.level;(!o||e.sn!==o.sn||o.level!==s)&&(this.fragPlaying=e,this.hls.trigger(Events.FRAG_CHANGED,{frag:e}),(!o||o.level!==s)&&this.hls.trigger(Events.LEVEL_SWITCHED,{level:s}))}}}get nextLevel(){const r=this.nextBufferedFrag;return r?r.level:-1}get currentFrag(){const r=this.media;return r?this.fragPlaying||this.getAppendedFrag(r.currentTime):null}get currentProgramDateTime(){const r=this.media;if(r){const e=r.currentTime,n=this.currentFrag;if(n&&isFiniteNumber(e)&&isFiniteNumber(n.programDateTime)){const o=n.programDateTime+(e-n.start)*1e3;return new Date(o)}}return null}get currentLevel(){const r=this.currentFrag;return r?r.level:-1}get nextBufferedFrag(){const r=this.currentFrag;return r?this.followingBufferedFrag(r):null}get forceStartLoad(){return this._forceStartLoad}}class Hls{static get version(){return"1.5.11"}static isMSESupported(){return isMSESupported()}static isSupported(){return isSupported()}static getMediaSource(){return getMediaSource()}static get Events(){return Events}static get ErrorTypes(){return ErrorTypes}static get ErrorDetails(){return ErrorDetails}static get DefaultConfig(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig}static set DefaultConfig(r){Hls.defaultConfig=r}constructor(r={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new EventEmitter,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,enableLogs(r.debug||!1,"Hls instance");const e=this.config=mergeConfig(Hls.DefaultConfig,r);this.userConfig=r,e.progressive&&enableStreamingMode(e);const{abrController:n,bufferController:o,capLevelController:s,errorController:l,fpsController:c}=e,u=new l(this),f=this.abrController=new n(this),d=this.bufferController=new o(this),g=this.capLevelController=new s(this),p=new c(this),v=new PlaylistLoader(this),m=new ID3TrackController(this),y=e.contentSteeringController,x=y?new y(this):null,_=this.levelController=new LevelController(this,x),E=new FragmentTracker(this),S=new KeyLoader(this.config),A=this.streamController=new StreamController(this,E,S);g.setStreamController(A),p.setStreamController(A);const T=[v,_,A];x&&T.splice(1,0,x),this.networkControllers=T;const b=[f,d,g,p,m,E];this.audioTrackController=this.createController(e.audioTrackController,T);const C=e.audioStreamController;C&&T.push(new C(this,E,S)),this.subtitleTrackController=this.createController(e.subtitleTrackController,T);const L=e.subtitleStreamController;L&&T.push(new L(this,E,S)),this.createController(e.timelineController,b),S.emeController=this.emeController=this.createController(e.emeController,b),this.cmcdController=this.createController(e.cmcdController,b),this.latencyController=this.createController(LatencyController,b),this.coreComponents=b,T.push(u);const R=u.onErrorOut;typeof R=="function"&&this.on(Events.ERROR,R,u)}createController(r,e){if(r){const n=new r(this);return e&&e.push(n),n}return null}on(r,e,n=this){this._emitter.on(r,e,n)}once(r,e,n=this){this._emitter.once(r,e,n)}removeAllListeners(r){this._emitter.removeAllListeners(r)}off(r,e,n=this,o){this._emitter.off(r,e,n,o)}listeners(r){return this._emitter.listeners(r)}emit(r,e,n){return this._emitter.emit(r,e,n)}trigger(r,e){if(this.config.debug)return this.emit(r,r,e);try{return this.emit(r,r,e)}catch(n){if(logger.error("An internal error happened while handling event "+r+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const o=r===Events.ERROR;this.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:o,event:r,error:n}),this.triggeringException=!1}}return!1}listenerCount(r){return this._emitter.listenerCount(r)}destroy(){logger.log("destroy"),this.trigger(Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(e=>e.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(e=>e.destroy()),this.coreComponents.length=0;const r=this.config;r.xhrSetup=r.fetchSetup=void 0,this.userConfig=null}attachMedia(r){logger.log("attachMedia"),this._media=r,this.trigger(Events.MEDIA_ATTACHING,{media:r})}detachMedia(){logger.log("detachMedia"),this.trigger(Events.MEDIA_DETACHING,void 0),this._media=null}loadSource(r){this.stopLoad();const e=this.media,n=this.url,o=this.url=urlToolkitExports.buildAbsoluteURL(self.location.href,r,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,logger.log(`loadSource:${o}`),e&&n&&(n!==o||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(e)),this.trigger(Events.MANIFEST_LOADING,{url:r})}startLoad(r=-1){logger.log(`startLoad(${r})`),this.started=!0,this.networkControllers.forEach(e=>{e.startLoad(r)})}stopLoad(){logger.log("stopLoad"),this.started=!1,this.networkControllers.forEach(r=>{r.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(r=>{"fragmentLoader"in r&&r.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(r=>{"fragmentLoader"in r&&r.stopLoad()})}swapAudioCodec(){logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){logger.log("recoverMediaError");const r=this._media;this.detachMedia(),r&&this.attachMedia(r)}removeLevel(r){this.levelController.removeLevel(r)}get levels(){const r=this.levelController.levels;return r||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(r){logger.log(`set currentLevel:${r}`),this.levelController.manualLevel=r,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(r){logger.log(`set nextLevel:${r}`),this.levelController.manualLevel=r,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(r){logger.log(`set loadLevel:${r}`),this.levelController.manualLevel=r}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(r){this.levelController.nextLoadLevel=r}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(r){logger.log(`set firstLevel:${r}`),this.levelController.firstLevel=r}get startLevel(){const r=this.levelController.startLevel;return r===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:r}set startLevel(r){logger.log(`set startLevel:${r}`),r!==-1&&(r=Math.max(r,this.minAutoLevel)),this.levelController.startLevel=r}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(r){const e=!!r;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:r}=this.abrController;return r?r.getEstimate():NaN}set bandwidthEstimate(r){this.abrController.resetEstimator(r)}get ttfbEstimate(){const{bwEstimator:r}=this.abrController;return r?r.getEstimateTTFB():NaN}set autoLevelCapping(r){this._autoLevelCapping!==r&&(logger.log(`set autoLevelCapping:${r}`),this._autoLevelCapping=r,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(r){isHdcpLevel(r)&&this._maxHdcpLevel!==r&&(this._maxHdcpLevel=r,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:r,config:{minAutoBitrate:e}}=this;if(!r)return 0;const n=r.length;for(let o=0;o<n;o++)if(r[o].maxBitrate>=e)return o;return 0}get maxAutoLevel(){const{levels:r,autoLevelCapping:e,maxHdcpLevel:n}=this;let o;if(e===-1&&r!=null&&r.length?o=r.length-1:o=e,n)for(let s=o;s--;){const l=r[s].attrs["HDCP-LEVEL"];if(l&&l<=n)return s}return o}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(r){this.abrController.nextAutoLevel=r}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(r){var e;return(e=this.audioTrackController)==null?void 0:e.setAudioOption(r)}setSubtitleOption(r){var e;return(e=this.subtitleTrackController)==null||e.setSubtitleOption(r),null}get allAudioTracks(){const r=this.audioTrackController;return r?r.allAudioTracks:[]}get audioTracks(){const r=this.audioTrackController;return r?r.audioTracks:[]}get audioTrack(){const r=this.audioTrackController;return r?r.audioTrack:-1}set audioTrack(r){const e=this.audioTrackController;e&&(e.audioTrack=r)}get allSubtitleTracks(){const r=this.subtitleTrackController;return r?r.allSubtitleTracks:[]}get subtitleTracks(){const r=this.subtitleTrackController;return r?r.subtitleTracks:[]}get subtitleTrack(){const r=this.subtitleTrackController;return r?r.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(r){const e=this.subtitleTrackController;e&&(e.subtitleTrack=r)}get subtitleDisplay(){const r=this.subtitleTrackController;return r?r.subtitleDisplay:!1}set subtitleDisplay(r){const e=this.subtitleTrackController;e&&(e.subtitleDisplay=r)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(r){this.config.lowLatencyMode=r}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Hls.defaultConfig=void 0;const HlsPlayerComponent=React.forwardRef((a,r)=>{const[e,n]=reactExports.useState({...a}),o=reactExports.useRef({}),s=reactExports.useRef(null),l=reactExports.useRef(null),{url:c}=e.style,u=()=>{var d;l.current&&((d=l.current)==null||d.destroy(),l.current=null)};reactExports.useImperativeHandle(r,()=>({updateConfig:d=>n({...d}),setEventHandler:d=>o.current=d,destroy:()=>u()})),reactExports.useEffect(()=>{if(Hls.isSupported()){const d=new Hls;d.loadSource(c),d.attachMedia(s.current),d.on(Hls.Events.MANIFEST_PARSED,()=>{s.current.play()}),l.current=d}else s.current.canPlayType("application/vnd.apple.mpegurl")&&(s.current.src=c,s.current.addEventListener("loadedmetadata",()=>{s.current.play()}));return()=>u()},[c]);const f=()=>{"click"in o.current&&o.current.click()};return jsxRuntimeExports.jsx("video",{style:{height:"100%",width:"100%"},ref:s,controls:!0,onClick:f})});class HlsPlayerController extends AbstractDesignerController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,HlsPlayerComponent,e)}destroy(){var r;(r=this.instance)==null||r.destroy(),this.instance=null,this.config=null}getConfig(){return this.config}update(r,e){var n;this.config=ObjectUtil.merge(this.config,r),e=e||{reRender:!0},e.reRender&&((n=this.instance)==null||n.updateConfig(this.config))}registerEvent(){var e,n,o;const r=(n=(e=this.config)==null?void 0:e.base)==null?void 0:n.id;(o=this.instance)==null||o.setEventHandler({click:()=>BPExecutor.triggerComponentEvent(r,"click",this.config)})}}const __vite_glob_0_80=Object.freeze(Object.defineProperty({__proto__:null,HlsPlayerController},Symbol.toStringTag,{value:"Module"})),HlsPlayerImg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN8AAACMCAIAAABzgesiAAAIk0lEQVR4Xu2aT0gbWRzHC/6r2iQmJpn8GQIK0rAoLS50CV2UikW3uNDSxVS6RFbYFKotW6pFsTTUm1dv3nLLMTdvueWYm8fccvSWW27ZefP+zGRm4mrdrb9Zvh9+h+TNzJs3zGfe/zs6AFS540wAgAywE9AFdgK6wE5AF9gJ6AI7AV1gJ6AL7AR0gZ2ALrAT0AV2ArrATkAX2AnoAjsBXWAnoAvsBHSBnYAusBPQBXYCusBOQBfYCegCOwFdYCegC+wEdIGdgC6wE9AFdgK6wE5AF9gJ6AI7AV1gJ6AL7AR0gZ2ALrAT0AV2ArrATkAX2AnoAjsBXWAnoAvsBHSBnYAusBPQBXYCusBOQBfYCegCOwFdYCegC+wEdIGdgC6wE9AFdgK6wE5AF9gJ6AI7AV1gJ6AL7AR0gZ2ALrDzuhxHt5ohIzYqKeeha7Gazu6kjLifdx65Efnkk2psxYiTmxWPBLDzulSCX7t3jNirJ3nCbDW4b6Z4RqkTWDtSF6fny6Y65eS0I5/yxEFnpH8Enh+KLBbPR983I0vH6SmVq52jyB6/dTPuPOQ/fGfnTnzDrLq2mtFHzmN6thLmFdvWWUKmJX4V54eXduznulhNLdQmtts2J9qBQj0+76jbnHYmX7adRjriU10VJrnOT25HHjryOYp8cl1oi9F1qfhyUyUOf2hFHxdYBWzFaVjk04r2pO+kpnOyFL7Bd3aquqEbXHYe0x/WR8Wbs2qOeNH1gt1kjiY/OIUQUWrGM+Y5U9yDM2HVp4Y2s6pbwnWDa702qDNthfGws9Q1v4Tz+H1xYfLFhcjwqZdbj2r39rsDsnjBoiXr5XHZ41MFdhrk1TlGDHwRdedQif0d+qMszrJVWirure1Ydi7bClCsWLXs5Xa6ztE2eUorNi2T3EwfaS8agQ+dYOF8xFUqz+j/+HSBncabPgvIVzj26thKz+STK41oTlZa8yrznld+UzuNOpjVjoW+/deSUaoTmUE/ctpmh5+vPqfU04boAqlH8BuwU9d/asjqpyUa8X8isSFUCC3mbmrnVfqvpabGr5+rBY0h0cpJ0uxUKNLLzWF+5mEzPiNTZ6rBzzzxXLvac1EDdtqvMqRxHvTAGG7zt77fSNj7nf9kZ+q56FB6xuieEldONs2sysLLx7GK2h383A5sVFKZfGrp/K7ZCbnztTOxuGvv+yZ+E3cc3jy1PYBv8LOdzlHITurnxrfYmakExdvtDhy0wq6aqZe8tiUqzsCzgn4dOz17ripsdsoLixWnndOnke32sCwtq3fn6mOurLziah8eMXxs56VxHTv1XGK9rUbBPIyx0XixHn/g0DSXeirbUB77jZjdzidNns8Qq6tcdtpILfFOYSOeFSkejb7bTsFq+sfyZOFi9F0tad3lsjC+uthsTxa+AHZyVhNrzbEv7ny64y/VVbnUs1aPmizawaJlp2q7x14eetoppaxPFqSLC3yOthXY41XyVezsxRi/sxn+qjaf7/vbn/jYzrvvxTS7FW/aQy4hrmYnJ5e+f6yt1UPv23w6yYxOaCHHGvTf24MixYy9Nm/Eh3gflNmZj22L36EF3cvOXPyNmXKgatx2ZJ03953A9nXqTtGZYV0L1Z1gD9jvtz/xsZ3/2qjIk2w1eCguHNgyOpF64rXoboooNsIH5o9PzSivoh7Xxq0TDMl2edVlW/I+EZe8qSaknYFtnm0r/PrKdmZr9/gJB2xY1tdI2Pnd+V52Gjq+klM8fNJn4Xyo1A4tyhWgYkWskW434mzJuyDqRRFeoxA5gjHafTWWErF9pnyNLFtWedtplEReldZhJyG+m505daGQIJNPs+VEq2Kzn+waVwk72baPheNU9s90RteftvhRo93n20HC7+Sz/JJPPm+Za1StiU058bTfiGzyhatzMd9poswWTySXCVhnF3beKt9u50ixZrazPaH9YJySj73tDn1sRtbKCd6fe3AS27hQA6DxF7u2e7jt7BktDYgOq7DTPt8kNyidpsy58fSimKcc+Ci3O+m2KXQu1iu3WDvRv8RRs3erp58J6e1TWrDzVvh2Oz2DZTJr7y+6wrnQ0mtnZkfbuFCjpeFiJSpu52GnxdSuti7tL7Uj83KlMVsOyZ1KRpXJf4y9FjYL1Lor356SOQmL9c+LaBZ23jL/gZ2P6+N8sOKKkXd1TS0MCmx2zpQnbNNbI1tVQyN1u7HNs9hKLShtM0ubS8+eRAsXcmmHqRlaNMfdzNfWiEwf2aqkZypqWDa414zJWSFVUw68rabnqiFZAPZX97bTbDTOIlsXYbOu9RG+szOXljvNPLbfZvJy3ch85ZwZ15KSLWQmRraH2pKt0V866bMh0mantX2kc2/9lMlhLlc6JvZZlFjF5hgJGc7F58xbTFmLVUaMb4is2LyB+mz48FzfVTv9jK6qNTxSy+t2O53LSF4DNdr4zs5bx96yswnOgYPW5CP7klJBe9EclxvwBj93Rt83Jx+bX4vcbsL6uEtyrzuDdXy5rzHH6tTUYbTYYT2HN1X291HjLr/7Z97fYFNUg3vnWlZ+SHO1gLWX/ij61rzW6HIcGMWoqU3QfgF2Xhdriwb7N11gg/GrsqutlBNei/jGgOmyFZ0H1Wi/jf0ztlbifwfsBHSBnYAusBPQBXYCusBOQBfYCegCOwFdYCegC+wEdIGdgC6wE9AFdgK6wE5AF9gJ6AI7AV1gJ6AL7AR0gZ2ALrAT0AV2ArrATkAX2AnoAjsBXWAnoAvsBHSBnYAusBPQBXYCusBOQBfYCegCOwFdYCegC+wEdIGdgC6wE9AFdgK6wE5AF9gJ6AI7AV1gJ6AL7AR0gZ2ALrAT0AV2ArrATkAX2AnoAjsBXWAnoAvsBHSBnYAusBPQBXYCusBOQBfYCegCOwFdYCegC+wEdIGdgC6wE9AFdgK6wE5Al78Bnj0nAJGdal8AAAAASUVORK5CYII=",HlsPlayerConfig=({controller:a})=>{var o;const r=(o=a.getConfig())==null?void 0:o.style,e=s=>{const{dataFragment:l}=s;a.update(l)},n={type:"grid",key:"style",children:[{type:"input",label:"视频流地址",key:"url",value:r==null?void 0:r.url}]};return jsxRuntimeExports.jsx(LCGUI,{schema:n,onFieldChange:e})},BaseInfo$1=reactExports.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),AnimationConfig$1=reactExports.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),FilterConfig$1=reactExports.lazy(()=>__vitePreload(()=>import("./FilterConfig-NGULEsf_.js"),__vite__mapDeps([52,1,2,6,7,8,9,10,11,12,5,13,14,15,16,53])));class HlsPlayerDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"HLS视频流",compKey:"HlsPlayer",categorize:"media"}}getChartImg(){return HlsPlayerImg}getController(){return HlsPlayerController}getInitConfig(){return{base:{id:"",name:"HLS视频流",type:"HlsPlayer"},style:{url:"https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8"},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0}}}getMenuList(){return super.getMenuList().filter(r=>r.key!=="theme"&&r.key!=="data"&&r.key!=="mapping")}getMenuToConfigContentMap(){return{base:BaseInfo$1,style:HlsPlayerConfig,animation:AnimationConfig$1,filter:FilterConfig$1}}getEventList(){return super.getEventList().concat([{id:"click",name:"点击时"}])}}const __vite_glob_0_81=Object.freeze(Object.defineProperty({__proto__:null,default:HlsPlayerDefinition},Symbol.toStringTag,{value:"Module"})),TextScrollerComponent=React.forwardRef((a,r)=>{var d;const[e,n]=reactExports.useState({...a}),{speed:o,...s}=e.style,l=reactExports.useRef({}),c=reactExports.useRef(null),u=reactExports.useRef(null),f=reactExports.useRef(null);return reactExports.useImperativeHandle(r,()=>({updateConfig:g=>n({...g}),setEventHandler:g=>l.current=g})),reactExports.useEffect(()=>{u.current&&(f.current=new ResizeObserver(lodashExports.debounce(g=>{for(const p of g){const{width:v}=p.contentRect;u.current.style.setProperty("--container-width",`${v}px`)}},100)),f.current.observe(u.current))},[]),reactExports.useEffect(()=>{var g;(g=u.current)==null||g.style.setProperty("--speed",`${o||5}s`)},[e]),jsxRuntimeExports.jsx("div",{className:"text-scroller-container",ref:u,children:jsxRuntimeExports.jsx("div",{className:"text-scroller",style:{...s},ref:c,children:(d=e==null?void 0:e.data)==null?void 0:d.staticData})})});class TextScrollerController extends AbstractDesignerController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,TextScrollerComponent,e)}destroy(){this.instance=null,this.config=null}getConfig(){return this.config}changeData(r){var e;this.config.data.staticData=r,(e=this.instance)==null||e.updateConfig(this.config)}update(r,e){var n;this.config=ObjectUtil.merge(this.config,r),e=e||{reRender:!0},e.reRender&&((n=this.instance)==null||n.updateConfig(this.config))}updateTheme(r){}registerEvent(){var e,n,o;const r=(n=(e=this.config)==null?void 0:e.base)==null?void 0:n.id;(o=this.instance)==null||o.setEventHandler({click:()=>BPExecutor.triggerComponentEvent(r,"click",this.config)})}}const __vite_glob_0_82=Object.freeze(Object.defineProperty({__proto__:null,TextScrollerController},Symbol.toStringTag,{value:"Module"})),textScrollerImg="/light-chaser-app/assets/text-scroller-MwbHljh7.png",TextScrollerConfig=({controller:a})=>{var o;const r=(o=a.getConfig())==null?void 0:o.style,e=s=>{const{dataFragment:l}=s;a.update(l)},n={key:"style",type:"grid",config:{columns:2},children:[{key:"speed",type:"number-input",label:"速度",value:r.speed,config:{min:1}},{key:"fontSize",type:"number-input",label:"字号",value:r.fontSize,config:{min:1,max:100}},{key:"fontWeight",type:"number-input",label:"加粗",value:r.fontWeight,config:{min:100,max:900,step:100}},{key:"color",type:"color-picker",label:"颜色",value:r==null?void 0:r.color,config:{showText:!0}},{key:"fontFamily",type:"select",label:"字体",value:r.fontFamily,config:{options:[{label:"钉钉进步体",value:"DingTalk JinBuTi"},{label:"抖音美好体",value:"DouyinSansBold"},{label:"优设标题黑",value:"优设标题黑"},{label:"庞门正道标题",value:"庞门正道标题体免费版"}]}}]};return jsxRuntimeExports.jsx(LCGUI,{schema:n,onFieldChange:e})};class TextScrollerDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"文字弹幕",compKey:"TextScroller",categorize:"info",subCategorize:"text",width:320,height:26}}getChartImg(){return textScrollerImg}getController(){return TextScrollerController}getInitConfig(){return{base:{id:"",name:"文字弹幕",type:"TextScroller"},style:{speed:10,fontSize:16,fontWeight:500,color:"#fff",fontFamily:"Arial"},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0},data:{sourceType:"static",staticData:"文字弹幕"}}}getMenuList(){return super.getMenuList().filter(r=>r.key!=="theme")}getMenuToConfigContentMap(){const r=super.getMenuToConfigContentMap();return r.style=TextScrollerConfig,r}getEventList(){return super.getEventList().concat([{id:"click",name:"点击时"}])}}const __vite_glob_0_83=Object.freeze(Object.defineProperty({__proto__:null,default:TextScrollerDefinition},Symbol.toStringTag,{value:"Module"}));class AbstractScaleObserver{}const ft=class ft{static doScale(r,e){ft.xScale=r,ft.yScale=e,ft.observers.forEach(n=>n.doScale(r,e))}static add(r){ft.observers.push(r),(ft.xScale!==1||ft.yScale!==1)&&r.doScale(ft.xScale,ft.yScale)}};U(ft,"xScale",1),U(ft,"yScale",1),U(ft,"observers",[]);let ScaleAction=ft;class AMapScaleObserver extends AbstractScaleObserver{constructor(e){super();U(this,"mapDom",null);U(this,"observer",null);this.mapDom=e,this.mapDom.style.transformOrigin="0 0",ScaleAction.add(this)}doScale(e,n){this.mapDom.style.transform=`scale(${1/e},${1/n})`,this.observer=new ResizeObserver((o,s)=>{o.forEach(l=>{const{width:c,height:u}=l.contentRect;this.mapDom.style.width=c*e+"px",this.mapDom.style.height=u*n+"px"})}),this.observer.observe(this.mapDom.parentElement)}destroy(){this.observer&&this.observer.disconnect()}}const __vite_glob_0_86=Object.freeze(Object.defineProperty({__proto__:null,default:AMapScaleObserver},Symbol.toStringTag,{value:"Module"}));var dist={exports:{}};(function(a,r){(function(e,n){a.exports=n()})(commonjsGlobal,function(){function e(g){var p=[];return g.AMapUI&&p.push(n(g.AMapUI)),g.Loca&&p.push(o(g.Loca)),Promise.all(p)}function n(g){return new Promise(function(p,v){var m=[];if(g.plugins)for(var y=0;y<g.plugins.length;y+=1)l.AMapUI.plugins.indexOf(g.plugins[y])==-1&&m.push(g.plugins[y]);if(c.AMapUI===s.failed)v("前次请求 AMapUI 失败");else if(c.AMapUI===s.notload){c.AMapUI=s.loading,l.AMapUI.version=g.version||l.AMapUI.version,y=l.AMapUI.version;var x=document.body||document.head,_=document.createElement("script");_.type="text/javascript",_.src="https://webapi.amap.com/ui/"+y+"/main.js",_.onerror=function(E){c.AMapUI=s.failed,v("请求 AMapUI 失败")},_.onload=function(){if(c.AMapUI=s.loaded,m.length)window.AMapUI.loadUI(m,function(){for(var E=0,S=m.length;E<S;E++){var A=m[E].split("/").slice(-1)[0];window.AMapUI[A]=arguments[E]}for(p();u.AMapUI.length;)u.AMapUI.splice(0,1)[0]()});else for(p();u.AMapUI.length;)u.AMapUI.splice(0,1)[0]()},x.appendChild(_)}else c.AMapUI===s.loaded?g.version&&g.version!==l.AMapUI.version?v("不允许多个版本 AMapUI 混用"):m.length?window.AMapUI.loadUI(m,function(){for(var E=0,S=m.length;E<S;E++){var A=m[E].split("/").slice(-1)[0];window.AMapUI[A]=arguments[E]}p()}):p():g.version&&g.version!==l.AMapUI.version?v("不允许多个版本 AMapUI 混用"):u.AMapUI.push(function(E){E?v(E):m.length?window.AMapUI.loadUI(m,function(){for(var S=0,A=m.length;S<A;S++){var T=m[S].split("/").slice(-1)[0];window.AMapUI[T]=arguments[S]}p()}):p()})})}function o(g){return new Promise(function(p,v){if(c.Loca===s.failed)v("前次请求 Loca 失败");else if(c.Loca===s.notload){c.Loca=s.loading,l.Loca.version=g.version||l.Loca.version;var m=l.Loca.version,y=l.AMap.version.startsWith("2"),x=m.startsWith("2");if(y&&!x||!y&&x)v("JSAPI 与 Loca 版本不对应！！");else{y=l.key,x=document.body||document.head;var _=document.createElement("script");_.type="text/javascript",_.src="https://webapi.amap.com/loca?v="+m+"&key="+y,_.onerror=function(E){c.Loca=s.failed,v("请求 AMapUI 失败")},_.onload=function(){for(c.Loca=s.loaded,p();u.Loca.length;)u.Loca.splice(0,1)[0]()},x.appendChild(_)}}else c.Loca===s.loaded?g.version&&g.version!==l.Loca.version?v("不允许多个版本 Loca 混用"):p():g.version&&g.version!==l.Loca.version?v("不允许多个版本 Loca 混用"):u.Loca.push(function(E){E?v(E):v()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var s;(function(g){g.notload="notload",g.loading="loading",g.loaded="loaded",g.failed="failed"})(s||(s={}));var l={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},c={AMap:s.notload,AMapUI:s.notload,Loca:s.notload},u={AMap:[],AMapUI:[],Loca:[]},f=[],d=function(g){typeof g=="function"&&(c.AMap===s.loaded?g(window.AMap):f.push(g))};return{load:function(g){return new Promise(function(p,v){if(c.AMap==s.failed)v("");else if(c.AMap==s.notload){var m=g.key,y=g.version,x=g.plugins;m?(window.AMap&&location.host!=="lbs.amap.com"&&v("禁止多种API加载方式混用"),l.key=m,l.AMap.version=y||l.AMap.version,l.AMap.plugins=x||l.AMap.plugins,c.AMap=s.loading,y=document.body||document.head,window.___onAPILoaded=function(E){if(delete window.___onAPILoaded,E)c.AMap=s.failed,v(E);else for(c.AMap=s.loaded,e(g).then(function(){p(window.AMap)}).catch(v);f.length;)f.splice(0,1)[0]()},x=document.createElement("script"),x.type="text/javascript",x.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+l.AMap.version+"&key="+m+"&plugin="+l.AMap.plugins.join(","),x.onerror=function(E){c.AMap=s.failed,v(E)},y.appendChild(x)):v("请填写key")}else if(c.AMap==s.loaded)if(g.key&&g.key!==l.key)v("多个不一致的 key");else if(g.version&&g.version!==l.AMap.version)v("不允许多个版本 JSAPI 混用");else{if(m=[],g.plugins)for(y=0;y<g.plugins.length;y+=1)l.AMap.plugins.indexOf(g.plugins[y])==-1&&m.push(g.plugins[y]);m.length?window.AMap.plugin(m,function(){e(g).then(function(){p(window.AMap)}).catch(v)}):e(g).then(function(){p(window.AMap)}).catch(v)}else if(g.key&&g.key!==l.key)v("多个不一致的 key");else if(g.version&&g.version!==l.AMap.version)v("不允许多个版本 JSAPI 混用");else{var _=[];if(g.plugins)for(y=0;y<g.plugins.length;y+=1)l.AMap.plugins.indexOf(g.plugins[y])==-1&&_.push(g.plugins[y]);d(function(){_.length?window.AMap.plugin(_,function(){e(g).then(function(){p(window.AMap)}).catch(v)}):e(g).then(function(){p(window.AMap)}).catch(v)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,l={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},c={AMap:s.notload,AMapUI:s.notload,Loca:s.notload},u={AMap:[],AMapUI:[],Loca:[]}}}})})(dist);var distExports=dist.exports;const AMapLoader=getDefaultExportFromCjs$1(distExports);class MapLoader{constructor(){U(this,"loadPromise",null)}async load(r,e,n){var o;return window.AMap?window.AMap:((!e||e==="")&&((o=globalMessage.messageApi)==null||o.info("缺少安全密钥")),window._AMapSecurityConfig={securityJsCode:e},this.loadPromise?this.loadPromise:(this.loadPromise=new Promise(s=>{AMapLoader.load({key:r,version:"2.0",plugins:["AMap.Scale"],Loca:{version:"2.0.0"}}).then(l=>{var c;l?(window.AMap=l,window.AMap_Key=r,window.AMap_securityJsCode=e,s(l)):((c=globalMessage.messageApi)==null||c.error("地图加载失败..."),this.loadPromise=null,s(null))}).catch(l=>{this.loadPromise=null,s(null)})}),this.loadPromise))}}const mapLoader=new MapLoader,__vite_glob_0_87=Object.freeze(Object.defineProperty({__proto__:null,default:mapLoader},Symbol.toStringTag,{value:"Module"})),AMapComponent=React.forwardRef((props,ref)=>{var a,r;const[config,setConfig]=reactExports.useState({...props}),mapContainerRef=reactExports.useRef(null),mapRef=reactExports.useRef(),eventHandlerMap=reactExports.useRef({});return reactExports.useImperativeHandle(ref,()=>({updateConfig:e=>setConfig({...e}),setEventHandler:e=>eventHandlerMap.current=e,map:mapRef})),reactExports.useEffect(()=>{new AMapScaleObserver(mapContainerRef.current)},[]),reactExports.useEffect(()=>{const{key,securityJsCode}=config.style;mapLoader.load(key,securityJsCode).then(AMap=>{var e,n;if(!AMap)return;const code=(e=config.style)==null?void 0:e.customCode,fun=eval(`(${code})`);typeof fun=="function"?mapRef.current=fun(mapContainerRef.current,AMap,eventHandlerMap):(n=globalMessage.messageApi)==null||n.error("自定义代码错误,请检查")})},[config]),jsxRuntimeExports.jsx("div",{className:"a-map",ref:mapContainerRef,children:(a=config.style)!=null&&a.key&&((r=config.style)!=null&&r.securityJsCode)?void 0:jsxRuntimeExports.jsx("div",{className:"no-key-message",style:{display:"flex",alignItems:"center"},children:"请配置Key和密钥"})})});class AMapController extends AbstractDesignerController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,AMapComponent,e),this.registerEvent(),window.AMap&&(window.AMap_Key&&(this.config.style.key=window.AMap_Key),window.AMap_securityJsCode&&(this.config.style.securityJsCode=window.AMap_securityJsCode))}destroy(){this.instance=null,this.config=null}getConfig(){return this.config}update(r,e){var n;this.config=ObjectUtil.merge(this.config,r),e=e||{reRender:!0},e.reRender&&((n=this.instance)==null||n.updateConfig(this.config))}registerEvent(){var e,n,o;const r=(n=(e=this.config)==null?void 0:e.base)==null?void 0:n.id;(o=this.instance)==null||o.setEventHandler({click:()=>BPExecutor.triggerComponentEvent(r,"click",this.config)})}}const __vite_glob_0_84=Object.freeze(Object.defineProperty({__proto__:null,AMapController},Symbol.toStringTag,{value:"Module"})),aMapImage="/light-chaser-app/assets/a-map-IlIujPqK.png",AMapConfig=({controller:a})=>{var s;const r=(s=a.getConfig())==null?void 0:s.style,e=reactExports.useRef((r==null?void 0:r.customCode)||`function(container, AMap) {







}`),n=l=>{const{id:c,data:u,dataFragment:f}=l;if(c==="customCode"){e.current=u;return}c==="refreshMap"?a.update({style:{customCode:e.current}}):a.update(f)},o={key:"style",type:"grid",children:[{type:"input",label:"KEY",key:"key",value:r==null?void 0:r.key},{type:"input",label:"密钥",key:"securityJsCode",value:r==null?void 0:r.securityJsCode,config:{type:"password"}},{type:"card-panel",config:{contentStyle:{padding:0}},children:[{id:"customCode",type:"code-editor",value:e.current,config:{language:"javascript",height:600}}]},{type:"button",id:"refreshMap",config:{children:"刷新地图",style:{width:"100%"}}}]};return jsxRuntimeExports.jsx(LCGUI,{schema:o,onFieldChange:n})},BaseInfo=React.lazy(()=>__vitePreload(()=>import("./BaseInfo-nVB-2MjL.js"),__vite__mapDeps([47,1,2,48,13,5,6,7,8,9,10,11,12,14,15,16,49]))),ThemeConfig=React.lazy(()=>__vitePreload(()=>import("./ThemeConfig-HmpA86mM.js"),__vite__mapDeps([17,1,2,18,13,19,20,21,22,23,8,24,25,10,12,26,27,28,9,29,30,31,32,33,34,11,35,36,37,5,6,7,38,39,40,41,42,43,44,45,46,14,15,16]))),AnimationConfig=React.lazy(()=>__vitePreload(()=>import("./AnimationConfig-jP6EnKIm.js"),__vite__mapDeps([0,1,2,3]))),FilterConfig=React.lazy(()=>__vitePreload(()=>import("./FilterConfig-NGULEsf_.js"),__vite__mapDeps([52,1,2,6,7,8,9,10,11,12,5,13,14,15,16,53])));class AMapDefinition extends AbstractDesignerDefinition{getBaseInfo(){return{compName:"自定义高德地图",compKey:"AMap",categorize:"map"}}getChartImg(){return aMapImage}getController(){return AMapController}getInitConfig(){return{base:{id:"",name:"自定义高德地图",type:"AMap"},style:{key:"",securityJsCode:"",customCode:`function(container, AMap, bpTriggers) {
    let map = new AMap.Map(container, {
        zoom: 11.43,
        center: [120.2446746826172, 30.199146446037616],
        pitch: 55,
        rotation: 20,
        showLabel: true,
        viewMode: '3D',
        mapStyle: 'amap://styles/dark',
    });
    return map;
}`},filter:{enable:!1,blur:0,brightness:1,contrast:1,opacity:1,saturate:1,hueRotate:0}}}getMenuList(){return super.getMenuList().filter(r=>r.key!=="theme"&&r.key!=="data")}getMenuToConfigContentMap(){return{base:BaseInfo,style:AMapConfig,animation:AnimationConfig,theme:ThemeConfig,filter:FilterConfig}}getEventList(){return super.getEventList().concat([{id:"click",name:"点击时"}])}}const __vite_glob_0_85=Object.freeze(Object.defineProperty({__proto__:null,default:AMapDefinition},Symbol.toStringTag,{value:"Module"})),__vite_glob_0_88=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),componentCategorize=[{key:"all",name:"所有",icon:AllApplication},{key:"chart",name:"图表",icon:PieThree},{key:"info",name:"信息",icon:Text$2},{key:"map",name:"地图",icon:MapDraw},{key:"ornament",name:"装饰",icon:Platte},{key:"model",name:"模型",icon:Cube},{key:"media",name:"媒体",icon:Monitor},{key:"web",name:"web元素",icon:Browser},{key:"other",name:"其他",icon:Other}],componentSubCategorize=[{key:"all",name:"所有"},{key:"bar",name:"条形图",parentKey:"chart"},{key:"column",name:"柱状图",parentKey:"chart"},{key:"line",name:"折线图",parentKey:"chart"},{key:"pie",name:"饼图",parentKey:"chart"},{key:"scatter",name:"散点图",parentKey:"chart"},{key:"wordCloud",name:"词云图",parentKey:"chart"},{key:"area",name:"面积图",parentKey:"chart"},{key:"radar",name:"雷达图",parentKey:"chart"},{key:"funnel",name:"漏斗图",parentKey:"chart"},{key:"progress",name:"进度图",parentKey:"chart"},{key:"rose",name:"玫瑰图",parentKey:"chart"},{key:"radial",name:"玉珏图",parentKey:"chart"}];class AbstractDesignerLoader{constructor(){U(this,"definitionMap",{});U(this,"convertMap",{})}load(r,e){this.scanComponents(),this.initProject(r,e)}scanComponents(){var e;const r=Object.assign({"../../comps/antd-common/AntdBaseDesignerController.ts":__vite_glob_0_0,"../../comps/antd-common/AntdCommonDefinition.ts":__vite_glob_0_1,"../../comps/antd-common/AntdCommonUtil.ts":__vite_glob_0_2,"../../comps/antd-common/area/AbstractAreaDefinition.ts":__vite_glob_0_3,"../../comps/antd-common/area/AntdCommonAreaController.ts":__vite_glob_0_4,"../../comps/antd-common/bar/AbstractBarDefinition.ts":__vite_glob_0_5,"../../comps/antd-common/bar/AntdCommonBarController.ts":__vite_glob_0_6,"../../comps/antd-common/column/AbstractColumnDefinition.ts":__vite_glob_0_7,"../../comps/antd-common/column/AntdCommonColumnController.ts":__vite_glob_0_8,"../../comps/antd-common/line/AbstractLineDefinition.ts":__vite_glob_0_9,"../../comps/antd-common/line/AntdCommonLineController.ts":__vite_glob_0_10,"../../comps/antd-common/rose/AbstractRoseDefinition.ts":__vite_glob_0_11,"../../comps/antd-common/rose/AntdCommonRoseController.ts":__vite_glob_0_12,"../../comps/antd-common/scatter/AbstractScatterDefinition.ts":__vite_glob_0_13,"../../comps/antd-common/scatter/AntdCommonScatterController.ts":__vite_glob_0_14,"../../comps/antd-common/types.ts":__vite_glob_0_15,"../../comps/antd/area-base/AntdBaseAreaDefinition.ts":__vite_glob_0_16,"../../comps/antd/area-percent/AntdPercentAreaDefinition.ts":__vite_glob_0_17,"../../comps/antd/area-stack/AntdStackAreaDefinition.ts":__vite_glob_0_18,"../../comps/antd/bar-base/AntdBaseBarDefinition.ts":__vite_glob_0_19,"../../comps/antd/bar-group/AntdGroupBarDefinition.ts":__vite_glob_0_20,"../../comps/antd/bar-percent/AntdPercentBarDefinition.ts":__vite_glob_0_21,"../../comps/antd/bar-range/AntdRangeBarDefinition.ts":__vite_glob_0_22,"../../comps/antd/bar-stack/AntdStackBarDefinition.ts":__vite_glob_0_23,"../../comps/antd/column-base/AntdBaseColumnDefinition.ts":__vite_glob_0_24,"../../comps/antd/column-group/AntdGroupColumnDefinition.ts":__vite_glob_0_25,"../../comps/antd/column-percent/AntdPercentColumnDefinition.ts":__vite_glob_0_26,"../../comps/antd/column-range/AntdRangeColumnDefinition.ts":__vite_glob_0_27,"../../comps/antd/column-stack/AntdStackColumnDefinition.ts":__vite_glob_0_28,"../../comps/antd/g2plot-custom/G2PlotCustomController.ts":__vite_glob_0_29,"../../comps/antd/g2plot-custom/G2PlotCustomDefinition.ts":__vite_glob_0_30,"../../comps/antd/gauge/AntdGaugeController.ts":__vite_glob_0_31,"../../comps/antd/gauge/AntdGaugeDefinition.ts":__vite_glob_0_32,"../../comps/antd/line-base/AntdBaseLineDefinition.ts":__vite_glob_0_33,"../../comps/antd/line-multi/AntdMultiLineDefinition.ts":__vite_glob_0_34,"../../comps/antd/line-step/AntdStepLineDefinition.ts":__vite_glob_0_35,"../../comps/antd/liquid/AntdLiquidController.ts":__vite_glob_0_36,"../../comps/antd/liquid/AntdLiquidDefinition.ts":__vite_glob_0_37,"../../comps/antd/pie/AntdPieController.ts":__vite_glob_0_38,"../../comps/antd/pie/AntdPieDefinition.ts":__vite_glob_0_39,"../../comps/antd/radar/AntdRadarController.ts":__vite_glob_0_40,"../../comps/antd/radar/AntdRadarDefinition.ts":__vite_glob_0_41,"../../comps/antd/radial-bar-base/AntdBaseRadialBarController.ts":__vite_glob_0_42,"../../comps/antd/radial-bar-base/AntdBaseRadialBarDefinition.ts":__vite_glob_0_43,"../../comps/antd/ring-progress/AntdRingProgressController.ts":__vite_glob_0_44,"../../comps/antd/ring-progress/AntdRingProgressDefinition.ts":__vite_glob_0_45,"../../comps/antd/rose-base/AntdBaseRoseDefinition.ts":__vite_glob_0_46,"../../comps/antd/rose-group/AntdGroupRoseDefinition.ts":__vite_glob_0_47,"../../comps/antd/rose-stack/AntdStackRoseDefinition.ts":__vite_glob_0_48,"../../comps/antd/scatter-bubble/AntdScatterBubbleDefinition.ts":__vite_glob_0_49,"../../comps/antd/scatter-point/AntdScatterPointDefinition.ts":__vite_glob_0_50,"../../comps/antd/word-cloud/AntdWordCloudController.ts":__vite_glob_0_51,"../../comps/antd/word-cloud/AntdWordCloudDefinition.ts":__vite_glob_0_52,"../../comps/common-component/CommonTypes.ts":__vite_glob_0_53,"../../comps/common-component/base-info/BaseInfoStore.ts":__vite_glob_0_54,"../../comps/group-layer/GroupLayerController.ts":__vite_glob_0_55,"../../comps/group-layer/GroupLayerDefinition.ts":__vite_glob_0_56,"../../comps/lc/base-color-block/BaseColorBlockController.ts":__vite_glob_0_57,"../../comps/lc/base-color-block/BaseColorBlockDefinition.ts":__vite_glob_0_58,"../../comps/lc/base-iframe/BaseIframeController.ts":__vite_glob_0_59,"../../comps/lc/base-iframe/BaseIframeDefinition.ts":__vite_glob_0_60,"../../comps/lc/base-image/BaseImageController.ts":__vite_glob_0_61,"../../comps/lc/base-image/BaseImageConvert.ts":__vite_glob_0_62,"../../comps/lc/base-image/BaseImageDefinition.ts":__vite_glob_0_63,"../../comps/lc/base-table/BaseTableController.ts":__vite_glob_0_64,"../../comps/lc/base-table/BaseTableDefinition.ts":__vite_glob_0_65,"../../comps/lc/base-text/BaseTextController.ts":__vite_glob_0_66,"../../comps/lc/base-text/BaseTextDefinition.ts":__vite_glob_0_67,"../../comps/lc/base-video/BaseVideoController.ts":__vite_glob_0_68,"../../comps/lc/base-video/BaseVideoDefinition.ts":__vite_glob_0_69,"../../comps/lc/carousel/CarouselController.ts":__vite_glob_0_70,"../../comps/lc/carousel/CarouselDefinition.ts":__vite_glob_0_71,"../../comps/lc/date-time/DateTimeController.ts":__vite_glob_0_72,"../../comps/lc/date-time/DateTimeDefinition.ts":__vite_glob_0_73,"../../comps/lc/digital-flipper/DigitalFlipperController.ts":__vite_glob_0_74,"../../comps/lc/digital-flipper/DigitalFlipperDefinition.ts":__vite_glob_0_75,"../../comps/lc/flv-player/FlvPlayerController.ts":__vite_glob_0_76,"../../comps/lc/flv-player/FlvPlayerDefinition.ts":__vite_glob_0_77,"../../comps/lc/four-angle-glow-border/FourAngleGlowBorderController.ts":__vite_glob_0_78,"../../comps/lc/four-angle-glow-border/FourAngleGlowBorderDefinition.ts":__vite_glob_0_79,"../../comps/lc/hls-player/HlsPlayerController.ts":__vite_glob_0_80,"../../comps/lc/hls-player/HlsPlayerDefinition.ts":__vite_glob_0_81,"../../comps/lc/text-scroller/TextScrollerController.ts":__vite_glob_0_82,"../../comps/lc/text-scroller/TextScrollerDefinition.ts":__vite_glob_0_83,"../../comps/map/AMapController.ts":__vite_glob_0_84,"../../comps/map/AMapDefinition.ts":__vite_glob_0_85,"../../comps/map/AMapScaleObserver.ts":__vite_glob_0_86,"../../comps/map/MapLoader.ts":__vite_glob_0_87,"../../comps/map/a-map.d.ts":__vite_glob_0_88});for(const n of Object.keys(r)){const o=(e=r[n])==null?void 0:e.default;if(o&&AbstractDefinition.isPrototypeOf(o)){const s=new o;if(typeof s.getBaseInfo=="function"){const l=s.getBaseInfo().compKey;l&&(this.definitionMap[l]=s)}if(typeof s.getCategorize=="function"){const l=s.getCategorize();if(l)if(l.icon)componentCategorize.push(l);else{console.error("自定义组件的分类必须指定icon");continue}}if(typeof s.getSubCategorize=="function"){const l=s.getSubCategorize();if(l)if(l.parentKey)componentCategorize.push(l);else{console.error("自定义组件的子类型必须指定parentKey");continue}}}else if(o&&AbstractConvert.isPrototypeOf(o)){const s=new o,l=s.getKey();this.convertMap[l]=s}}}}class EditorDesignerLoader extends AbstractDesignerLoader{initProject(r,e){const{init:n,setLoaded:o}=designerManager$1;operatorMap[e].getProjectData(r).then(s=>{var l,c;s?(n(s,DesignerMode.EDIT),o(!0)):(c=(l=globalMessage)==null?void 0:l.messageApi)==null||c.error("项目不存在")})}}const editorDesignerLoader=new EditorDesignerLoader,editorDesignerLoader$1=editorDesignerLoader,EditorDesignerLoader$1=Object.freeze(Object.defineProperty({__proto__:null,default:editorDesignerLoader$1},Symbol.toStringTag,{value:"Module"}));class BPLayerNodeController extends AbstractBPNodeController{async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,BPNode,e)}execute(r,e,n){const{nodeId:o,apId:s,anchorType:l}=r;if(l===AnchorPointType.INPUT){const{compController:c,layerConfigs:u}=layerManager,f=c[o];if(!f)return;const{type:d}=u[o],{definitionMap:g}=viewDesignerLoader$1;if(!g)return;const v=g[d].getActionList().find(m=>m.id===s);if(!v)return;v.handler(f,n)}}getConfig(){return this.config}update(r,e){}getNodeInfo(r){const{layerConfigs:e}=layerManager,n=e[r],{definitionMap:o}=editorDesignerLoader$1,s=o[n.type].getEventList().map(c=>({id:r+":"+c.id+":"+AnchorPointType.OUTPUT,name:c.name,type:AnchorPointType.OUTPUT})),l=o[n.type].getActionList().map(c=>({id:r+":"+c.id+":"+AnchorPointType.INPUT,name:c.name,type:AnchorPointType.INPUT}));return{id:r,name:n.name,icon:"CodeSandboxOutlined",type:"layer-node",titleBgColor:"#247057",input:l,output:s}}getConfigComponent(){return null}}const MonacoEditor$1=React.lazy(()=>__vitePreload(()=>import("./MonacoEditor-AmRPsGTx.js").then(a=>a.a),__vite__mapDeps([67,1,2,68]))),ConditionNodeConfig=a=>{const{controller:r}=a,n=(r==null?void 0:r.getConfig()).handler||`function handler(data) { 
 
 }`,o=lodashExports.debounce(s=>{s&&(r==null||r.update({handler:s}))},500);return jsxRuntimeExports.jsx("div",{className:"condition-node-config",children:jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(Loading,{}),children:jsxRuntimeExports.jsx(MonacoEditor$1,{value:n,onChange:o,height:400,language:"javascript"})})})};class BPConditionNodeController extends AbstractBPNodeController{constructor(){super(...arguments);U(this,"handler",null)}async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,BPNode,e)}execute(executeInfo,executor,params){var r;const{nodeId,anchorType}=executeInfo;if(anchorType===1)return;if(!this.handler){if(!((r=this.config)!=null&&r.handler))return;try{this.handler=eval(`(${this.config.handler})`)}catch(e){console.error("解析条件函数错误，请检查你写条件判断函数");return}}const result=this.handler(params);if(result){const e=nodeId+":satisfy:"+AnchorPointType.OUTPUT;executor.execute(e,executor,params)}else{const e=nodeId+":unSatisfy:"+AnchorPointType.OUTPUT;executor.execute(e,executor,params)}}getConfig(){return this.config}update(r,e){this.config=ObjectUtil.merge(this.config,r)}getNodeInfo(r){return{id:r,name:"条件判断",titleBgColor:"#247ba6",type:"condition-node",icon:"BranchesOutlined",input:[{id:r+":judge:"+AnchorPointType.INPUT,name:"判断",type:AnchorPointType.INPUT}],output:[{id:r+":satisfy:"+AnchorPointType.OUTPUT,name:"满足",type:AnchorPointType.OUTPUT},{id:r+":unSatisfy:"+AnchorPointType.OUTPUT,name:"不满足",type:AnchorPointType.OUTPUT}]}}getConfigComponent(){return ConditionNodeConfig}}const MonacoEditor=reactExports.lazy(()=>__vitePreload(()=>import("./MonacoEditor-AmRPsGTx.js").then(a=>a.a),__vite__mapDeps([67,1,2,68]))),LogicalProcessNodeConfig=a=>{const{controller:r}=a,n=(r==null?void 0:r.getConfig()).handler||`function handle(data) { 
 
 }`,o=lodashExports.debounce(s=>{s&&(r==null||r.update({handler:s}))},500);return jsxRuntimeExports.jsx("div",{className:"logical-process-node-config",children:jsxRuntimeExports.jsx(reactExports.Suspense,{fallback:jsxRuntimeExports.jsx(Loading,{}),children:jsxRuntimeExports.jsx(MonacoEditor,{value:n,onChange:o,height:400,language:"javascript"})})})};class BPLogicalProcessNodeController extends AbstractBPNodeController{constructor(){super(...arguments);U(this,"handler",null)}async create(r,e){this.config=e,this.container=r,this.instance=await ComponentUtil.createAndRender(r,BPNode,e)}execute(executeInfo,executor,params){var r;const{nodeId}=executeInfo;if(!this.handler){if(!((r=this.config)!=null&&r.handler))return;try{this.handler=eval(`(${this.config.handler})`)}catch(e){console.error("解析条件函数错误，请检查你写条件判断函数");return}}const newParams=this.handler(params)||params,apId=nodeId+":afterExecute:"+AnchorPointType.OUTPUT;executor.execute(apId,executor,newParams)}getConfig(){return this.config}update(r,e){this.config=ObjectUtil.merge(this.config,r)}getNodeInfo(r){return{id:r,name:"逻辑处理",titleBgColor:"#a62469",type:"logical-process-node",icon:"FunctionOutlined",input:[{id:r+":execute:"+AnchorPointType.INPUT,name:"执行",type:AnchorPointType.INPUT}],output:[{id:r+":afterExecute:"+AnchorPointType.OUTPUT,name:"执行后",type:AnchorPointType.OUTPUT}]}}getConfigComponent(){return LogicalProcessNodeConfig}}const bpNodeControllerMap=new Map;bpNodeControllerMap.set("layer-node",BPLayerNodeController);bpNodeControllerMap.set("condition-node",BPConditionNodeController);bpNodeControllerMap.set("logical-process-node",BPLogicalProcessNodeController);class BPLeftStore{constructor(){U(this,"activeMenu","layer");U(this,"usedLayerNodes",{});U(this,"searchValue","");U(this,"setSearchValue",r=>this.searchValue=r);U(this,"setActiveMenu",r=>this.activeMenu=r);U(this,"setUsedLayerNodes",(r,e)=>this.usedLayerNodes[r]=e);U(this,"initUsedLayerNodes",r=>this.usedLayerNodes=r);makeObservable(this,{activeMenu:observable,setActiveMenu:action,usedLayerNodes:observable,setUsedLayerNodes:action,searchValue:observable,setSearchValue:action})}}const bpLeftStore=new BPLeftStore;class BluePrintManager extends AbstractManager{constructor(){super();U(this,"bpAPMap",{});U(this,"bpLines",{});U(this,"bpAPLineMap",{});U(this,"bpNodeLayoutMap",{});U(this,"bpNodeControllerInsMap",{});U(this,"bpNodeConfigMap",{});U(this,"selectedNodes",[]);U(this,"selectedLines",[]);U(this,"bpMovableRef",null);U(this,"bpSelectRef",null);U(this,"upCtx",null);U(this,"downCtx",null);U(this,"nodeContainerRef",null);U(this,"bpDragContentRef",null);U(this,"canvasOffset",{x:320,y:50});U(this,"canvasTranslate",{x:0,y:0});U(this,"canvasScale",1);U(this,"setBpDragContentRef",e=>this.bpDragContentRef=e);U(this,"getAllNodeConfig",()=>{if(!this.bpNodeLayoutMap)return{};const e=Object.keys(this.bpNodeLayoutMap);if(Object.keys(this.bpNodeControllerInsMap).length>0){const n={};return e.forEach(o=>{n[o]=this.bpNodeControllerInsMap[o].getConfig()}),n}else return this.bpNodeConfigMap});U(this,"addBPNodeLayout",e=>{this.bpNodeLayoutMap[e.id]=e});U(this,"updBpNodeLayout",e=>{const n=this.bpNodeLayoutMap[e.id];n&&ObjectUtil.merge(n,e)});U(this,"setSelectedLines",e=>{this.selectedLines=e});U(this,"addAPLineMap",(e,n)=>{this.bpAPLineMap[e]||(this.bpAPLineMap[e]=[]),this.bpAPLineMap[e].push(n)});U(this,"delAPLineMap",(e,n)=>{if(this.bpAPLineMap[e]){const o=this.bpAPLineMap[e].indexOf(n);o!==-1&&this.bpAPLineMap[e].splice(o,1),this.bpAPLineMap[e].length===0&&delete this.bpAPLineMap[e]}});U(this,"delAPMap",(e,n)=>{if(this.bpAPMap[e]){const o=this.bpAPMap[e].indexOf(n);o!==-1&&this.bpAPMap[e].splice(o,1),this.bpAPMap[e].length===0&&delete this.bpAPMap[e]}});U(this,"updLinePos",e=>{const n=this.bpLines[e.id];n&&(n.startPoint=e.startPoint,n.endPoint=e.endPoint)});U(this,"addAPMap",(e,n)=>{this.bpAPMap[e]||(this.bpAPMap[e]=[]),this.bpAPMap[e].push(n)});U(this,"addLine",e=>{this.bpLines[e.id]=e});U(this,"setCanvasScale",e=>{this.canvasScale=e});U(this,"setCanvasTranslate",e=>{e&&(this.canvasTranslate=e)});U(this,"setSelectedNodes",e=>{this.selectedNodes=e});U(this,"setBpMovableRef",e=>{this.bpMovableRef=e});U(this,"setBpSelectRef",e=>{this.bpSelectRef=e});U(this,"setUpCtx",e=>{this.upCtx=e});U(this,"setDownCtx",e=>{this.downCtx=e});U(this,"setNodeContainerRef",e=>{this.nodeContainerRef=e});U(this,"delNode",e=>{!e||e.length===0||(e.forEach(n=>{let o=this.bpNodeControllerInsMap[n];if(!o){const s=Object.values(this.bpNodeLayoutMap);Object.keys(this.bpNodeControllerInsMap).length===0&&s.length!==0&&s.forEach(l=>{const c=bpNodeControllerMap.get(l.type),u=this.bpNodeConfigMap[l.id];c&&(this.bpNodeControllerInsMap[l.id]=new c(u))}),o=this.bpNodeControllerInsMap[n]}if(o){const s=o.getConfig();[...s.input,...s.output].forEach(c=>{const{id:u}=c;if(u in this.bpAPMap&&delete this.bpAPMap[u],u in this.bpAPLineMap){const f=this.bpAPLineMap[u];this.delLine([...f]),delete this.bpAPLineMap[u]}})}delete this.bpNodeConfigMap[n],delete this.bpNodeLayoutMap[n],delete this.bpNodeControllerInsMap[n]}),this.setSelectedNodes([]))});U(this,"delLine",e=>{!e||e.length===0||(e.forEach(n=>{const o=this.bpLines[n];o&&this.delAPMap(o.startAnchorId,o.endAnchorId),delete this.bpLines[n],this.delAPLineMap(o.startAnchorId,n),this.delAPLineMap(o.endAnchorId,n)}),this.setSelectedLines([]))});makeObservable(this,{selectedNodes:observable,bpNodeLayoutMap:observable,canvasScale:observable,setSelectedNodes:action,addBPNodeLayout:action,updBpNodeLayout:action,setCanvasScale:action})}init(e,n){runInAction(()=>{if(this.bpAPMap=e.bpAPMap||{},this.bpLines=e.bpLines||{},this.bpAPLineMap=e.bpAPLineMap||{},this.bpNodeConfigMap=e.bpNodeConfigMap||{},n===DesignerMode.EDIT){this.bpNodeLayoutMap=e.bpNodeLayoutMap||{};const{initUsedLayerNodes:o}=bpLeftStore,s={};Object.keys((e==null?void 0:e.bpNodeLayoutMap)||{}).forEach(l=>{s[l]=!0}),o(s)}else{const o={};Object.values(e==null?void 0:e.bpNodeLayoutMap).forEach(s=>{const{type:l,id:c}=s,u=bpNodeControllerMap.get(l),f=e==null?void 0:e.bpNodeConfigMap[c];o[c]=new u(f)}),this.bpNodeControllerInsMap=o}})}getData(){return{bpAPMap:this.bpAPMap,bpLines:this.bpLines,bpAPLineMap:this.bpAPLineMap,bpNodeConfigMap:this.getAllNodeConfig(),bpNodeLayoutMap:this.bpNodeLayoutMap}}destroy(){this.bpAPMap={},this.bpLines={},this.bpAPLineMap={},this.bpNodeLayoutMap={},this.bpNodeControllerInsMap={},this.bpNodeConfigMap={}}}const bluePrintManager=new BluePrintManager,bluePrintManager$1=bluePrintManager;class FilterManager extends AbstractManager{constructor(){super();U(this,"filters",{});U(this,"editFilter",{id:"",name:"",func:""});U(this,"visible",!1);U(this,"setEditFilter",e=>this.editFilter=e);U(this,"setVisibility",e=>{this.visible=e,e||(this.editFilter={id:"",name:"",func:""})});U(this,"addFilter",e=>{e.id=IdGenerate.generateId(),this.filters[e.id]=e});U(this,"delFilter",e=>delete this.filters[e]);U(this,"updateFilter",e=>this.filters[e.id]=e);makeObservable(this,{filters:observable,visible:observable,addFilter:action,delFilter:action,updateFilter:action,setVisibility:action})}init(e){this.filters=e.filters||{}}getData(){return{filters:toJS(this.filters)}}destroy(){this.filters={}}}const filterManager=new FilterManager;class DesignerManager extends AbstractManager{constructor(){super();U(this,"loaded",!1);U(this,"setLoaded",e=>this.loaded=e);makeObservable(this,{loaded:observable,setLoaded:action})}destroy(){canvasHdStore.destroy(),layerManager.destroy(),themeHdStore.destroy(),bluePrintManager$1.destroy()}getData(){return{canvasManager:canvasHdStore.getData(),themeManager:themeHdStore.getData(),layerManager:layerManager.getData(),bluePrintManager:bluePrintManager$1.getData(),filterManager:filterManager.getData()}}init(e,n){e.canvasManager&&canvasHdStore.init(e.canvasManager),e.themeManager&&themeHdStore.init(e.themeManager),e.layerManager&&layerManager.init(e.layerManager),e.bluePrintManager&&bluePrintManager$1.init(e.bluePrintManager,n),e.filterManager&&filterManager.init(e.filterManager)}}const designerManager=new DesignerManager,designerManager$1=designerManager;class ViewDesignerLoader extends AbstractDesignerLoader{initProject(r,e){operatorMap[e].getProjectData(r).then(n=>{var o,s;n?(designerManager$1.init(n,DesignerMode.VIEW),designerManager$1.setLoaded(!0)):(s=(o=globalMessage)==null?void 0:o.messageApi)==null||s.error("项目不存在")})}}const viewDesignerLoader=new ViewDesignerLoader,viewDesignerLoader$1=viewDesignerLoader,ViewDesignerLoader$1=Object.freeze(Object.defineProperty({__proto__:null,default:viewDesignerLoader$1},Symbol.toStringTag,{value:"Module"}));export{withMethods as $,calculateBoundSize as A,isArray as B,getDist$1 as C,convertMatrixtoCSS as D,calculate as E,convertPositionMatrix as F,isObject as G,getKeys as H,decamelize as I,convertUnitSize as J,isNumber as K,ignoreDimension as L,invert as M,createIdentityMatrix as N,OperateType as O,multiply as P,ref as Q,addClass as R,ScaleAction as S,requestAnimationFrame$1 as T,DragScroll$1 as U,splitSpace as V,parse as W,refs as X,ChildrenDiffer$1 as Y,prefixCSS as Z,find as _,designerLeftStore as a,DesignerSelectable$2 as a$,fromTranslation as a0,dot as a1,createRotateMatrix as a2,getOrigin as a3,rotate as a4,diff as a5,multiplies as a6,createOriginMatrix as a7,toMat as a8,isNode as a9,between as aA,bluePrintManager$1 as aB,AbstractManager as aC,LayerUtil as aD,historyOperator as aE,themeHdStore as aF,bpLeftStore as aG,Theme$1 as aH,baseInfoStore as aI,BPExecutor as aJ,GroupLayerController as aK,AntdLegend as aL,AntdCartesianCoordinateSys as aM,LCGUI as aN,AntdCommonUtil as aO,AlignLeftTwo as aP,AlignHorizontalCenterTwo as aQ,AlignRightTwo as aR,AlignTopTwo as aS,AlignVerticalCenterTwo as aT,AlignBottomTwo as aU,Base64Util as aV,LCGUIUtil as aW,findLast as aX,AnchorPointType as aY,Selecto$1 as aZ,bpNodeControllerMap as a_,isFunction as aa,isWindow as ab,calculateMatrixDist as ac,counter as ad,removeClass as ae,splitBracket as af,splitComma as ag,getMinMaxs as ah,splitUnit as ai,EventEmitter$2 as aj,cancelAnimationFrame$1 as ak,fitPoints as al,getOverlapSize as am,getAreaSize as an,isInside as ao,diff$1 as ap,getWindow as aq,createScaleMatrix as ar,TINY_NUM as as,getDocumentBody as at,getDocumentElement as au,isUndefined as av,Gesto as aw,average as ax,getIntersectionPointsByConstants as ay,convertCSStoMatrix as az,editorDesignerLoader$1 as b,EditorDesignerLoader$1 as b0,ViewDesignerLoader$1 as b1,canvasHdStore as c,designerManager$1 as d,eventOperateStore as e,componentCategorize as f,componentSubCategorize as g,filterManager as h,historyRecordOperateProxy as i,layerListStore$1 as j,createWarpMatrix as k,layerManager as l,minus as m,findIndex as n,hasClass as o,prefixNames as p,getRad$1 as q,rightStore as r,styled as s,throttle as t,plus as u,viewDesignerLoader$1 as v,throttleArray as w,isString as x,parseMat as y,convertDimension as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/AnimationConfig-jP6EnKIm.js","assets/index-Duc4ZoM_.js","assets/index-q1ysIsKE.css","assets/AnimationConfig-PWl4scXB.css","assets/AntdAreaCommonConfig-W73kWJpq.js","assets/mobxreact.esm-AXuQb6fD.js","assets/LocalOperator-t4oOcFvM.js","assets/GlobalMessage-I0KrOayq.js","assets/MainRouter-l7Z1Z1jr.js","assets/render-8hUH_M6B.js","assets/AntdIcon-jwWmiLqW.js","assets/InfoCircleFilled-JfnNzh3b.js","assets/useZIndex-c7eQO3Zz.js","assets/index-AfMii643.js","assets/FetchUtil-5ZwtxN_0.js","assets/Data-_fslVRGK.js","assets/index--SWnmJ5Q.js","assets/ThemeConfig-HmpA86mM.js","assets/Dialog-vSMHMWDI.js","assets/Dialog-IKScJss1.css","assets/ThemeEditor-2NmMzzG7.js","assets/ColorPicker-pyjWXEAx.js","assets/UIContainer-fqZbFePv.js","assets/index-KGsAQAl1.js","assets/zoom-1qZDylxx.js","assets/Compact-BtIEhQqw.js","assets/Help-Q6DYu7mz.js","assets/UIContainer-2wM5o6qv.css","assets/PurePanel-ruJ4o-iR.js","assets/omit-zfc2TTl_.js","assets/index-tOmn1sxg.js","assets/pickAttrs-UI4Ho79H.js","assets/Overflow-2V5ntg0K.js","assets/button-cD7Pe9UH.js","assets/EyeOutlined-R3RbAP4C.js","assets/index-foMHq-FM.js","assets/collapse-aS6vX33V.js","assets/ColorPicker-V9ASUd98.css","assets/CardPanel-GnLi4EHp.js","assets/CardPanel-CjUkb6la.css","assets/Input-Fu5_43az.js","assets/Input-ulYyAdl_.css","assets/Grid-qWvRWUZo.js","assets/Grid-p4FjUlc6.css","assets/Button-Tm3IfQtm.js","assets/Button-Vi-JaWc8.css","assets/ThemeEditor-G8RSs6OM.css","assets/BaseInfo-nVB-2MjL.js","assets/Info-kImE1q_J.js","assets/BaseInfo-7tXTZcyW.css","assets/DataConfig-11-GlHR8.js","assets/DataConfig-iLgGRWZV.css","assets/FilterConfig-NGULEsf_.js","assets/FilterConfig-BDlFlVfy.css","assets/AntdBarCommonConfig-9BKZvCwA.js","assets/AntdColumnCommonConfig-0rl6HQTY.js","assets/AntdLineCommonConfig-0syqEiE0.js","assets/AntdRoseCommonConfig-r6NfKbkY.js","assets/AntdScatterCommonConfig-paCNXN1Q.js","assets/AntdBaseAreaConfig-ESg51AhN.js","assets/G2PlotCustomConfig-9wv-7wkT.js","assets/AntdGaugeConfig-z_m7t2CT.js","assets/Accordion-Kjxp7g3P.js","assets/Switch-Xw0MHp-o.js","assets/Switch-mqJvRLec.css","assets/Right-5BVu1toC.js","assets/Accordion-SU6xlX8W.css","assets/MonacoEditor-AmRPsGTx.js","assets/MonacoEditor-yJ9UOCHw.css","assets/ColorsPicker-Kr5YMVnt.js","assets/ColorsPicker-c8SWPfcB.css","assets/Radio-kbTZ0tv0.js","assets/Radio-ekMN6XOn.css","assets/Select-wGR39UQA.js","assets/Select-fufuxCpP.css","assets/Slider-EMpULmm8.js","assets/Slider-hCeLJ3DQ.css","assets/ImageUpload-HUfmpvv0.js","assets/Plus-WQxU0q_G.js","assets/fade-CRG4MrDV.js","assets/useForceUpdate-rXHM3SwU.js","assets/ImageUpload-9kseRzbI.css","assets/ColorMode-EbPIiyM4.js","assets/ColorMode-USBQvw06.css","assets/TextOnly-OJHDw4sQ.js","assets/TextArea-xY6JAMVn.js","assets/TextArea-3VS8BRdk.css","assets/GroupButton-XoXQi5qk.js","assets/GroupButton-uBxL6PXe.css","assets/NumberInput-WrPaUvHm.js","assets/NumberInput-A_zfvH9I.css","assets/ControlGroup-7bzhDJ_v.js","assets/Down-X5z7RGv2.js","assets/ControlGroup-MmoPSQBL.css","assets/CheckBox-Ja7rXRna.js","assets/CheckBox-yhXu1IIj.css","assets/AntdLiquidConfig-nizAhSti.js","assets/AntdPieStyleConfig-dVrl03af.js","assets/AntdRadarStyleConfig-Ou7aatmw.js","assets/AntdBaseRadialBarStyleConfig-u5wJSNkr.js","assets/AntdRingProgressConfig-n38fmxqG.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}