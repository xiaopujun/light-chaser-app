import{r as p,j as r}from"./index-BGb4Vr6r.js";import{H as L,f as A,U as x}from"./Input-D61RPOug.js";import{o as y}from"./NumberInput-DcrVVkIB.js";import{i as R,e as I,l as S,b as B}from"./ViewDesignerLoader-DXeK7jRJ.js";import{D as E}from"./DragAddProvider-CGIp7MQw.js";import{P as M}from"./DesignerPage-OfuQDMAc.js";import{C as H}from"./ThemeEditor-CmU8Vhay.js";import"./GlobalMessage-w_89I4zt.js";import"./MainRouter-B1R3Zt_D.js";import"./render-B6yvyxXw.js";import"./asyncToGenerator-DBB230pG.js";import"./pickAttrs-CSoaMUvc.js";import"./useZIndex-D0JyUzw0.js";import"./index-BB2N-NZK.js";import"./zoom-BTqsuETn.js";import"./Compact-DzzDZMuf.js";import"./index-DOwexXEl.js";import"./button-gJeP7DM-.js";import"./FetchUtil-BqQLSZ8D.js";import"./Overflow-BbLqOhED.js";import"./index-DoQ1r5wX.js";import"./mobxreact.esm-DyjwGLY0.js";import"./index-K8tTczQM.js";import"./Data-Bn-QghVN.js";import"./collapse-BbEVqHco.js";import"./CheckBox-DCpT0jJf.js";import"./FontGlobal-iqvzwRTQ.js";import"./PreviewOpen-C5YtI9Jz.js";import"./System-BCu1OiEq.js";import"./Info-DVVj4iJw.js";function pe(){const[j,v]=p.useState([]),g=p.useRef(null),b=e=>{var t,a;if(e.target.classList.contains("droppable-element")){const i=e.target;(t=e.dataTransfer)==null||t.setData("imageUrl",i.getAttribute("data-url")),(a=e.dataTransfer)==null||a.setData("imageHash",i.getAttribute("data-hash"))}},D=e=>{e.preventDefault()},N=e=>{var n,d;e.preventDefault();const t=(n=e.dataTransfer)==null?void 0:n.getData("imageUrl"),a=(d=e.dataTransfer)==null?void 0:d.getData("imageHash");if(!t)return;const{scale:i,dsContentRef:o}=I,s=o==null?void 0:o.getBoundingClientRect(),c=(e.clientX-((s==null?void 0:s.x)||0))/i,m=(e.clientY-((s==null?void 0:s.y)||0))/i;T("BaseImage",[c,m],t,a)},T=(e,t=[0,0],a,i)=>{const{elemConfigs:o}=S;let{setAddRecordCompId:s}=I;const{definitionMap:c}=B,m=c[e],{compName:n,width:d=320,height:C=200}=m.getBaseInfo(),f=A.generateId(),h={name:n,type:e,x:Math.round(t[0]),y:Math.round(t[1]),id:f,lock:!1,hide:!1,width:d,height:C};s(h.id),R.doAdd(h);const l=m.getInitConfig();l.style.type="local",l.style.localUrl=a,l.style.hash=i,o[f]=l},u=()=>{const{saveType:e,id:t}=x.parseUrlParams();y[e].getImageSourceList(t).then(a=>{v(a)})};p.useEffect(()=>(u(),g.current=new E(document.getElementById("image-source-list"),document.getElementById("designer-ds-content"),b,D,N),()=>{var e;return(e=g.current)==null?void 0:e.destroy()}),[]);const U=e=>{const{saveType:t}=x.parseUrlParams();y[t].delImageSource(e).then(a=>{a&&u()})};return r.jsx("div",{className:"image-source",children:r.jsx("div",{className:"image-source-list",id:"image-source-list",children:j.map((e,t)=>r.jsxs("div",{className:"image-source-item droppable-element",draggable:!0,"data-url":e.url,"data-hash":e.hash,children:[r.jsxs("div",{className:"image-source-item-header",children:[r.jsx("div",{className:"isi-title",children:e.name||"无名称信息"}),r.jsx("div",{className:"isi-operate",children:r.jsx(M,{title:"确认删除吗?",icon:r.jsx(L,{style:{color:"red",position:"relative",top:3,marginRight:2}}),description:"可能会导致已经使用的图片组件失效!",onConfirm:()=>U(e.id),okText:"是",cancelText:"否",children:r.jsx(H,{})})})]}),r.jsx("div",{className:"image-source-item-body",children:r.jsx("div",{className:"item-bg-image",style:{backgroundImage:`url(${e.url})`}})})]},t))})})}export{pe as default};
