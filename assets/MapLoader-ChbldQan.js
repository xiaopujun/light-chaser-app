var y=Object.defineProperty;var P=(A,c,d)=>c in A?y(A,c,{enumerable:!0,configurable:!0,writable:!0,value:d}):A[c]=d;var I=(A,c,d)=>(P(A,typeof c!="symbol"?c+"":c,d),d);import{c as x,g as _}from"./index-OsS9UfkW.js";import{g as h}from"./GlobalMessage-FQtvcjbG.js";import"./MainRouter-Z3gK7D7G.js";import"./useZIndex-g2cfol2D.js";var U={exports:{}};(function(A,c){(function(d,v){A.exports=v()})(x,function(){function d(o){var t=[];return o.AMapUI&&t.push(v(o.AMapUI)),o.Loca&&t.push(g(o.Loca)),Promise.all(t)}function v(o){return new Promise(function(t,i){var p=[];if(o.plugins)for(var a=0;a<o.plugins.length;a+=1)e.AMapUI.plugins.indexOf(o.plugins[a])==-1&&p.push(o.plugins[a]);if(u.AMapUI===n.failed)i("前次请求 AMapUI 失败");else if(u.AMapUI===n.notload){u.AMapUI=n.loading,e.AMapUI.version=o.version||e.AMapUI.version,a=e.AMapUI.version;var r=document.body||document.head,l=document.createElement("script");l.type="text/javascript",l.src="https://webapi.amap.com/ui/"+a+"/main.js",l.onerror=function(s){u.AMapUI=n.failed,i("请求 AMapUI 失败")},l.onload=function(){if(u.AMapUI=n.loaded,p.length)window.AMapUI.loadUI(p,function(){for(var s=0,M=p.length;s<M;s++){var w=p[s].split("/").slice(-1)[0];window.AMapUI[w]=arguments[s]}for(t();f.AMapUI.length;)f.AMapUI.splice(0,1)[0]()});else for(t();f.AMapUI.length;)f.AMapUI.splice(0,1)[0]()},r.appendChild(l)}else u.AMapUI===n.loaded?o.version&&o.version!==e.AMapUI.version?i("不允许多个版本 AMapUI 混用"):p.length?window.AMapUI.loadUI(p,function(){for(var s=0,M=p.length;s<M;s++){var w=p[s].split("/").slice(-1)[0];window.AMapUI[w]=arguments[s]}t()}):t():o.version&&o.version!==e.AMapUI.version?i("不允许多个版本 AMapUI 混用"):f.AMapUI.push(function(s){s?i(s):p.length?window.AMapUI.loadUI(p,function(){for(var M=0,w=p.length;M<w;M++){var L=p[M].split("/").slice(-1)[0];window.AMapUI[L]=arguments[M]}t()}):t()})})}function g(o){return new Promise(function(t,i){if(u.Loca===n.failed)i("前次请求 Loca 失败");else if(u.Loca===n.notload){u.Loca=n.loading,e.Loca.version=o.version||e.Loca.version;var p=e.Loca.version,a=e.AMap.version.startsWith("2"),r=p.startsWith("2");if(a&&!r||!a&&r)i("JSAPI 与 Loca 版本不对应！！");else{a=e.key,r=document.body||document.head;var l=document.createElement("script");l.type="text/javascript",l.src="https://webapi.amap.com/loca?v="+p+"&key="+a,l.onerror=function(s){u.Loca=n.failed,i("请求 AMapUI 失败")},l.onload=function(){for(u.Loca=n.loaded,t();f.Loca.length;)f.Loca.splice(0,1)[0]()},r.appendChild(l)}}else u.Loca===n.loaded?o.version&&o.version!==e.Loca.version?i("不允许多个版本 Loca 混用"):t():o.version&&o.version!==e.Loca.version?i("不允许多个版本 Loca 混用"):f.Loca.push(function(s){s?i(s):i()})})}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var n;(function(o){o.notload="notload",o.loading="loading",o.loaded="loaded",o.failed="failed"})(n||(n={}));var e={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},u={AMap:n.notload,AMapUI:n.notload,Loca:n.notload},f={AMap:[],AMapUI:[],Loca:[]},m=[],b=function(o){typeof o=="function"&&(u.AMap===n.loaded?o(window.AMap):m.push(o))};return{load:function(o){return new Promise(function(t,i){if(u.AMap==n.failed)i("");else if(u.AMap==n.notload){var p=o.key,a=o.version,r=o.plugins;p?(window.AMap&&location.host!=="lbs.amap.com"&&i("禁止多种API加载方式混用"),e.key=p,e.AMap.version=a||e.AMap.version,e.AMap.plugins=r||e.AMap.plugins,u.AMap=n.loading,a=document.body||document.head,window.___onAPILoaded=function(s){if(delete window.___onAPILoaded,s)u.AMap=n.failed,i(s);else for(u.AMap=n.loaded,d(o).then(function(){t(window.AMap)}).catch(i);m.length;)m.splice(0,1)[0]()},r=document.createElement("script"),r.type="text/javascript",r.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+e.AMap.version+"&key="+p+"&plugin="+e.AMap.plugins.join(","),r.onerror=function(s){u.AMap=n.failed,i(s)},a.appendChild(r)):i("请填写key")}else if(u.AMap==n.loaded)if(o.key&&o.key!==e.key)i("多个不一致的 key");else if(o.version&&o.version!==e.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(p=[],o.plugins)for(a=0;a<o.plugins.length;a+=1)e.AMap.plugins.indexOf(o.plugins[a])==-1&&p.push(o.plugins[a]);p.length?window.AMap.plugin(p,function(){d(o).then(function(){t(window.AMap)}).catch(i)}):d(o).then(function(){t(window.AMap)}).catch(i)}else if(o.key&&o.key!==e.key)i("多个不一致的 key");else if(o.version&&o.version!==e.AMap.version)i("不允许多个版本 JSAPI 混用");else{var l=[];if(o.plugins)for(a=0;a<o.plugins.length;a+=1)e.AMap.plugins.indexOf(o.plugins[a])==-1&&l.push(o.plugins[a]);b(function(){l.length?window.AMap.plugin(l,function(){d(o).then(function(){t(window.AMap)}).catch(i)}):d(o).then(function(){t(window.AMap)}).catch(i)})}})},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,e={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},u={AMap:n.notload,AMapUI:n.notload,Loca:n.notload},f={AMap:[],AMapUI:[],Loca:[]}}}})})(U);var j=U.exports;const k=_(j);class E{constructor(){I(this,"loadPromise",null)}async load(c,d,v){var g;return window.AMap?window.AMap:((!d||d==="")&&((g=h.messageApi)==null||g.info("缺少安全密钥")),window._AMapSecurityConfig={securityJsCode:d},this.loadPromise?this.loadPromise:(this.loadPromise=new Promise(n=>{k.load({key:c,version:"2.0",plugins:["AMap.Scale"],Loca:{version:"2.0.0"}}).then(e=>{var u;e?(window.AMap=e,window.AMap_Key=c,window.AMap_securityJsCode=d,n(e)):((u=h.messageApi)==null||u.error("地图加载失败..."),this.loadPromise=null,n(null))}).catch(e=>{this.loadPromise=null,n(null)})}),this.loadPromise))}}const q=new E;export{q as default};
