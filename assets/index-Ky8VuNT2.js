var qt=Object.defineProperty;var Zt=(I,c,u)=>c in I?qt(I,c,{enumerable:!0,configurable:!0,writable:!0,value:u}):I[c]=u;var Je=(I,c,u)=>(Zt(I,typeof c!="symbol"?c+"":c,u),u);import{c as fe,g as er,_ as tr}from"./index-CIZzpp4t.js";import{l as Ke,O as rr,F as J}from"./FetchUtil-FMEOVjjY.js";import{g as q}from"./GlobalMessage-b_IUatJJ.js";class ne{static parseUrlParams(){const c=new URLSearchParams(window.location.hash.split("?")[1]),u={};for(const[v,g]of c)u[v]=g;return u}}var Se=(I=>(I.LOCAL="0",I.SERVER="1",I))(Se||{}),Qe=(I=>(I.EDIT="0",I.VIEW="1",I))(Qe||{}),nr=(I=>(I.DRAFT="0",I.PUBLISH="1",I.SEALED="2",I))(nr||{});function le(I){throw new Error('Could not dynamically require "'+I+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Xe={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(I,c){(function(u){I.exports=u()})(function(){return function u(v,g,b){function y(x,P){if(!g[x]){if(!v[x]){var h=typeof le=="function"&&le;if(!P&&h)return h(x,!0);if(_)return _(x,!0);var w=new Error("Cannot find module '"+x+"'");throw w.code="MODULE_NOT_FOUND",w}var B=g[x]={exports:{}};v[x][0].call(B.exports,function(U){var V=v[x][1][U];return y(V||U)},B,B.exports,u,v,g,b)}return g[x].exports}for(var _=typeof le=="function"&&le,R=0;R<b.length;R++)y(b[R]);return y}({1:[function(u,v,g){(function(b){var y=b.MutationObserver||b.WebKitMutationObserver,_;if(y){var R=0,x=new y(U),P=b.document.createTextNode("");x.observe(P,{characterData:!0}),_=function(){P.data=R=++R%2}}else if(!b.setImmediate&&typeof b.MessageChannel<"u"){var h=new b.MessageChannel;h.port1.onmessage=U,_=function(){h.port2.postMessage(0)}}else"document"in b&&"onreadystatechange"in b.document.createElement("script")?_=function(){var F=b.document.createElement("script");F.onreadystatechange=function(){U(),F.onreadystatechange=null,F.parentNode.removeChild(F),F=null},b.document.documentElement.appendChild(F)}:_=function(){setTimeout(U,0)};var w,B=[];function U(){w=!0;for(var F,K,M=B.length;M;){for(K=B,B=[],F=-1;++F<M;)K[F]();M=B.length}w=!1}v.exports=V;function V(F){B.push(F)===1&&!w&&_()}}).call(this,typeof fe<"u"?fe:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(u,v,g){var b=u(1);function y(){}var _={},R=["REJECTED"],x=["FULFILLED"],P=["PENDING"];v.exports=h;function h(m){if(typeof m!="function")throw new TypeError("resolver must be a function");this.state=P,this.queue=[],this.outcome=void 0,m!==y&&V(this,m)}h.prototype.catch=function(m){return this.then(null,m)},h.prototype.then=function(m,A){if(typeof m!="function"&&this.state===x||typeof A!="function"&&this.state===R)return this;var S=new this.constructor(y);if(this.state!==P){var N=this.state===x?m:A;B(S,N,this.outcome)}else this.queue.push(new w(S,m,A));return S};function w(m,A,S){this.promise=m,typeof A=="function"&&(this.onFulfilled=A,this.callFulfilled=this.otherCallFulfilled),typeof S=="function"&&(this.onRejected=S,this.callRejected=this.otherCallRejected)}w.prototype.callFulfilled=function(m){_.resolve(this.promise,m)},w.prototype.otherCallFulfilled=function(m){B(this.promise,this.onFulfilled,m)},w.prototype.callRejected=function(m){_.reject(this.promise,m)},w.prototype.otherCallRejected=function(m){B(this.promise,this.onRejected,m)};function B(m,A,S){b(function(){var N;try{N=A(S)}catch(j){return _.reject(m,j)}N===m?_.reject(m,new TypeError("Cannot resolve promise with itself")):_.resolve(m,N)})}_.resolve=function(m,A){var S=F(U,A);if(S.status==="error")return _.reject(m,S.value);var N=S.value;if(N)V(m,N);else{m.state=x,m.outcome=A;for(var j=-1,Y=m.queue.length;++j<Y;)m.queue[j].callFulfilled(A)}return m},_.reject=function(m,A){m.state=R,m.outcome=A;for(var S=-1,N=m.queue.length;++S<N;)m.queue[S].callRejected(A);return m};function U(m){var A=m&&m.then;if(m&&(typeof m=="object"||typeof m=="function")&&typeof A=="function")return function(){A.apply(m,arguments)}}function V(m,A){var S=!1;function N(z){S||(S=!0,_.reject(m,z))}function j(z){S||(S=!0,_.resolve(m,z))}function Y(){A(j,N)}var $=F(Y);$.status==="error"&&N($.value)}function F(m,A){var S={};try{S.value=m(A),S.status="success"}catch(N){S.status="error",S.value=N}return S}h.resolve=K;function K(m){return m instanceof this?m:_.resolve(new this(y),m)}h.reject=M;function M(m){var A=new this(y);return _.reject(A,m)}h.all=de;function de(m){var A=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=m.length,N=!1;if(!S)return this.resolve([]);for(var j=new Array(S),Y=0,$=-1,z=new this(y);++$<S;)G(m[$],$);return z;function G(ae,se){A.resolve(ae).then(ve,function(ee){N||(N=!0,_.reject(z,ee))});function ve(ee){j[se]=ee,++Y===S&&!N&&(N=!0,_.resolve(z,j))}}}h.race=Z;function Z(m){var A=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var S=m.length,N=!1;if(!S)return this.resolve([]);for(var j=-1,Y=new this(y);++j<S;)$(m[j]);return Y;function $(z){A.resolve(z).then(function(G){N||(N=!0,_.resolve(Y,G))},function(G){N||(N=!0,_.reject(Y,G))})}}},{1:1}],3:[function(u,v,g){(function(b){typeof b.Promise!="function"&&(b.Promise=u(2))}).call(this,typeof fe<"u"?fe:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(u,v,g){var b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function y(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var R=_();function x(){try{if(!R||!R.open)return!1;var e=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),r=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!e||r)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function P(e,r){e=e||[],r=r||{};try{return new Blob(e,r)}catch(n){if(n.name!=="TypeError")throw n;for(var t=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,a=new t,o=0;o<e.length;o+=1)a.append(e[o]);return a.getBlob(r.type)}}typeof Promise>"u"&&u(3);var h=Promise;function w(e,r){r&&e.then(function(t){r(null,t)},function(t){r(t)})}function B(e,r,t){typeof r=="function"&&e.then(r),typeof t=="function"&&e.catch(t)}function U(e){return typeof e!="string"&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function V(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var F="local-forage-detect-blob-support",K=void 0,M={},de=Object.prototype.toString,Z="readonly",m="readwrite";function A(e){for(var r=e.length,t=new ArrayBuffer(r),a=new Uint8Array(t),o=0;o<r;o++)a[o]=e.charCodeAt(o);return t}function S(e){return new h(function(r){var t=e.transaction(F,m),a=P([""]);t.objectStore(F).put(a,"key"),t.onabort=function(o){o.preventDefault(),o.stopPropagation(),r(!1)},t.oncomplete=function(){var o=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);r(n||!o||parseInt(o[1],10)>=43)}}).catch(function(){return!1})}function N(e){return typeof K=="boolean"?h.resolve(K):S(e).then(function(r){return K=r,K})}function j(e){var r=M[e.name],t={};t.promise=new h(function(a,o){t.resolve=a,t.reject=o}),r.deferredOperations.push(t),r.dbReady?r.dbReady=r.dbReady.then(function(){return t.promise}):r.dbReady=t.promise}function Y(e){var r=M[e.name],t=r.deferredOperations.pop();if(t)return t.resolve(),t.promise}function $(e,r){var t=M[e.name],a=t.deferredOperations.pop();if(a)return a.reject(r),a.promise}function z(e,r){return new h(function(t,a){if(M[e.name]=M[e.name]||Ae(),e.db)if(r)j(e),e.db.close();else return t(e.db);var o=[e.name];r&&o.push(e.version);var n=R.open.apply(R,o);r&&(n.onupgradeneeded=function(i){var s=n.result;try{s.createObjectStore(e.storeName),i.oldVersion<=1&&s.createObjectStore(F)}catch(f){if(f.name==="ConstraintError")console.warn('The database "'+e.name+'" has been upgraded from version '+i.oldVersion+" to version "+i.newVersion+', but the storage "'+e.storeName+'" already exists.');else throw f}}),n.onerror=function(i){i.preventDefault(),a(n.error)},n.onsuccess=function(){var i=n.result;i.onversionchange=function(s){s.target.close()},t(i),Y(e)}})}function G(e){return z(e,!1)}function ae(e){return z(e,!0)}function se(e,r){if(!e.db)return!0;var t=!e.db.objectStoreNames.contains(e.storeName),a=e.version<e.db.version,o=e.version>e.db.version;if(a&&(e.version!==r&&console.warn('The database "'+e.name+`" can't be downgraded from version `+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||t){if(t){var n=e.db.version+1;n>e.version&&(e.version=n)}return!0}return!1}function ve(e){return new h(function(r,t){var a=new FileReader;a.onerror=t,a.onloadend=function(o){var n=btoa(o.target.result||"");r({__local_forage_encoded_blob:!0,data:n,type:e.type})},a.readAsBinaryString(e)})}function ee(e){var r=A(atob(e.data));return P([r],{type:e.type})}function Re(e){return e&&e.__local_forage_encoded_blob}function Ze(e){var r=this,t=r._initReady().then(function(){var a=M[r._dbInfo.name];if(a&&a.dbReady)return a.dbReady});return B(t,e,e),t}function et(e){j(e);for(var r=M[e.name],t=r.forages,a=0;a<t.length;a++){var o=t[a];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,G(e).then(function(n){return e.db=n,se(e)?ae(e):n}).then(function(n){e.db=r.db=n;for(var i=0;i<t.length;i++)t[i]._dbInfo.db=n}).catch(function(n){throw $(e,n),n})}function Q(e,r,t,a){a===void 0&&(a=1);try{var o=e.db.transaction(e.storeName,r);t(null,o)}catch(n){if(a>0&&(!e.db||n.name==="InvalidStateError"||n.name==="NotFoundError"))return h.resolve().then(function(){if(!e.db||n.name==="NotFoundError"&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),ae(e)}).then(function(){return et(e).then(function(){Q(e,r,t,a-1)})}).catch(t);t(n)}}function Ae(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function tt(e){var r=this,t={db:null};if(e)for(var a in e)t[a]=e[a];var o=M[t.name];o||(o=Ae(),M[t.name]=o),o.forages.push(r),r._initReady||(r._initReady=r.ready,r.ready=Ze);var n=[];function i(){return h.resolve()}for(var s=0;s<o.forages.length;s++){var f=o.forages[s];f!==r&&n.push(f._initReady().catch(i))}var l=o.forages.slice(0);return h.all(n).then(function(){return t.db=o.db,G(t)}).then(function(d){return t.db=d,se(t,r._defaultConfig.version)?ae(t):d}).then(function(d){t.db=o.db=d,r._dbInfo=t;for(var p=0;p<l.length;p++){var E=l[p];E!==r&&(E._dbInfo.db=t.db,E._dbInfo.version=t.version)}})}function rt(e,r){var t=this;e=U(e);var a=new h(function(o,n){t.ready().then(function(){Q(t._dbInfo,Z,function(i,s){if(i)return n(i);try{var f=s.objectStore(t._dbInfo.storeName),l=f.get(e);l.onsuccess=function(){var d=l.result;d===void 0&&(d=null),Re(d)&&(d=ee(d)),o(d)},l.onerror=function(){n(l.error)}}catch(d){n(d)}})}).catch(n)});return w(a,r),a}function nt(e,r){var t=this,a=new h(function(o,n){t.ready().then(function(){Q(t._dbInfo,Z,function(i,s){if(i)return n(i);try{var f=s.objectStore(t._dbInfo.storeName),l=f.openCursor(),d=1;l.onsuccess=function(){var p=l.result;if(p){var E=p.value;Re(E)&&(E=ee(E));var D=e(E,p.key,d++);D!==void 0?o(D):p.continue()}else o()},l.onerror=function(){n(l.error)}}catch(p){n(p)}})}).catch(n)});return w(a,r),a}function at(e,r,t){var a=this;e=U(e);var o=new h(function(n,i){var s;a.ready().then(function(){return s=a._dbInfo,de.call(r)==="[object Blob]"?N(s.db).then(function(f){return f?r:ve(r)}):r}).then(function(f){Q(a._dbInfo,m,function(l,d){if(l)return i(l);try{var p=d.objectStore(a._dbInfo.storeName);f===null&&(f=void 0);var E=p.put(f,e);d.oncomplete=function(){f===void 0&&(f=null),n(f)},d.onabort=d.onerror=function(){var D=E.error?E.error:E.transaction.error;i(D)}}catch(D){i(D)}})}).catch(i)});return w(o,t),o}function ot(e,r){var t=this;e=U(e);var a=new h(function(o,n){t.ready().then(function(){Q(t._dbInfo,m,function(i,s){if(i)return n(i);try{var f=s.objectStore(t._dbInfo.storeName),l=f.delete(e);s.oncomplete=function(){o()},s.onerror=function(){n(l.error)},s.onabort=function(){var d=l.error?l.error:l.transaction.error;n(d)}}catch(d){n(d)}})}).catch(n)});return w(a,r),a}function it(e){var r=this,t=new h(function(a,o){r.ready().then(function(){Q(r._dbInfo,m,function(n,i){if(n)return o(n);try{var s=i.objectStore(r._dbInfo.storeName),f=s.clear();i.oncomplete=function(){a()},i.onabort=i.onerror=function(){var l=f.error?f.error:f.transaction.error;o(l)}}catch(l){o(l)}})}).catch(o)});return w(t,e),t}function st(e){var r=this,t=new h(function(a,o){r.ready().then(function(){Q(r._dbInfo,Z,function(n,i){if(n)return o(n);try{var s=i.objectStore(r._dbInfo.storeName),f=s.count();f.onsuccess=function(){a(f.result)},f.onerror=function(){o(f.error)}}catch(l){o(l)}})}).catch(o)});return w(t,e),t}function ct(e,r){var t=this,a=new h(function(o,n){if(e<0){o(null);return}t.ready().then(function(){Q(t._dbInfo,Z,function(i,s){if(i)return n(i);try{var f=s.objectStore(t._dbInfo.storeName),l=!1,d=f.openKeyCursor();d.onsuccess=function(){var p=d.result;if(!p){o(null);return}e===0||l?o(p.key):(l=!0,p.advance(e))},d.onerror=function(){n(d.error)}}catch(p){n(p)}})}).catch(n)});return w(a,r),a}function ut(e){var r=this,t=new h(function(a,o){r.ready().then(function(){Q(r._dbInfo,Z,function(n,i){if(n)return o(n);try{var s=i.objectStore(r._dbInfo.storeName),f=s.openKeyCursor(),l=[];f.onsuccess=function(){var d=f.result;if(!d){a(l);return}l.push(d.key),d.continue()},f.onerror=function(){o(f.error)}}catch(d){o(d)}})}).catch(o)});return w(t,e),t}function ft(e,r){r=V.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var a=this,o;if(!e.name)o=h.reject("Invalid arguments");else{var n=e.name===t.name&&a._dbInfo.db,i=n?h.resolve(a._dbInfo.db):G(e).then(function(s){var f=M[e.name],l=f.forages;f.db=s;for(var d=0;d<l.length;d++)l[d]._dbInfo.db=s;return s});e.storeName?o=i.then(function(s){if(s.objectStoreNames.contains(e.storeName)){var f=s.version+1;j(e);var l=M[e.name],d=l.forages;s.close();for(var p=0;p<d.length;p++){var E=d[p];E._dbInfo.db=null,E._dbInfo.version=f}var D=new h(function(T,O){var L=R.open(e.name,f);L.onerror=function(W){var ie=L.result;ie.close(),O(W)},L.onupgradeneeded=function(){var W=L.result;W.deleteObjectStore(e.storeName)},L.onsuccess=function(){var W=L.result;W.close(),T(W)}});return D.then(function(T){l.db=T;for(var O=0;O<d.length;O++){var L=d[O];L._dbInfo.db=T,Y(L._dbInfo)}}).catch(function(T){throw($(e,T)||h.resolve()).catch(function(){}),T})}}):o=i.then(function(s){j(e);var f=M[e.name],l=f.forages;s.close();for(var d=0;d<l.length;d++){var p=l[d];p._dbInfo.db=null}var E=new h(function(D,T){var O=R.deleteDatabase(e.name);O.onerror=function(){var L=O.result;L&&L.close(),T(O.error)},O.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},O.onsuccess=function(){var L=O.result;L&&L.close(),D(L)}});return E.then(function(D){f.db=D;for(var T=0;T<l.length;T++){var O=l[T];Y(O._dbInfo)}}).catch(function(D){throw($(e,D)||h.resolve()).catch(function(){}),D})})}return w(o,r),o}var lt={_driver:"asyncStorage",_initStorage:tt,_support:x(),iterate:nt,getItem:rt,setItem:at,removeItem:ot,clear:it,length:st,key:ct,keys:ut,dropInstance:ft};function dt(){return typeof openDatabase=="function"}var X="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vt="~~local_forage_type~",De=/^~~local_forage_type~([^~]+)~/,ce="__lfsc__:",he=ce.length,me="arbf",ge="blob",Pe="si08",Te="ui08",xe="uic8",Ce="si16",Ne="si32",Le="ur16",Be="ui32",Oe="fl32",Ue="fl64",Fe=he+me.length,Me=Object.prototype.toString;function je(e){var r=e.length*.75,t=e.length,a,o=0,n,i,s,f;e[e.length-1]==="="&&(r--,e[e.length-2]==="="&&r--);var l=new ArrayBuffer(r),d=new Uint8Array(l);for(a=0;a<t;a+=4)n=X.indexOf(e[a]),i=X.indexOf(e[a+1]),s=X.indexOf(e[a+2]),f=X.indexOf(e[a+3]),d[o++]=n<<2|i>>4,d[o++]=(i&15)<<4|s>>2,d[o++]=(s&3)<<6|f&63;return l}function pe(e){var r=new Uint8Array(e),t="",a;for(a=0;a<r.length;a+=3)t+=X[r[a]>>2],t+=X[(r[a]&3)<<4|r[a+1]>>4],t+=X[(r[a+1]&15)<<2|r[a+2]>>6],t+=X[r[a+2]&63];return r.length%3===2?t=t.substring(0,t.length-1)+"=":r.length%3===1&&(t=t.substring(0,t.length-2)+"=="),t}function ht(e,r){var t="";if(e&&(t=Me.call(e)),e&&(t==="[object ArrayBuffer]"||e.buffer&&Me.call(e.buffer)==="[object ArrayBuffer]")){var a,o=ce;e instanceof ArrayBuffer?(a=e,o+=me):(a=e.buffer,t==="[object Int8Array]"?o+=Pe:t==="[object Uint8Array]"?o+=Te:t==="[object Uint8ClampedArray]"?o+=xe:t==="[object Int16Array]"?o+=Ce:t==="[object Uint16Array]"?o+=Le:t==="[object Int32Array]"?o+=Ne:t==="[object Uint32Array]"?o+=Be:t==="[object Float32Array]"?o+=Oe:t==="[object Float64Array]"?o+=Ue:r(new Error("Failed to get type for BinaryArray"))),r(o+pe(a))}else if(t==="[object Blob]"){var n=new FileReader;n.onload=function(){var i=vt+e.type+"~"+pe(this.result);r(ce+ge+i)},n.readAsArrayBuffer(e)}else try{r(JSON.stringify(e))}catch(i){console.error("Couldn't convert value into a JSON string: ",e),r(null,i)}}function mt(e){if(e.substring(0,he)!==ce)return JSON.parse(e);var r=e.substring(Fe),t=e.substring(he,Fe),a;if(t===ge&&De.test(r)){var o=r.match(De);a=o[1],r=r.substring(o[0].length)}var n=je(r);switch(t){case me:return n;case ge:return P([n],{type:a});case Pe:return new Int8Array(n);case Te:return new Uint8Array(n);case xe:return new Uint8ClampedArray(n);case Ce:return new Int16Array(n);case Le:return new Uint16Array(n);case Ne:return new Int32Array(n);case Be:return new Uint32Array(n);case Oe:return new Float32Array(n);case Ue:return new Float64Array(n);default:throw new Error("Unkown type: "+t)}}var ye={serialize:ht,deserialize:mt,stringToBuffer:je,bufferToString:pe};function Ye(e,r,t,a){e.executeSql("CREATE TABLE IF NOT EXISTS "+r.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],t,a)}function gt(e){var r=this,t={db:null};if(e)for(var a in e)t[a]=typeof e[a]!="string"?e[a].toString():e[a];var o=new h(function(n,i){try{t.db=openDatabase(t.name,String(t.version),t.description,t.size)}catch(s){return i(s)}t.db.transaction(function(s){Ye(s,t,function(){r._dbInfo=t,n()},function(f,l){i(l)})},i)});return t.serializer=ye,o}function k(e,r,t,a,o,n){e.executeSql(t,a,o,function(i,s){s.code===s.SYNTAX_ERR?i.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[r.storeName],function(f,l){l.rows.length?n(f,s):Ye(f,r,function(){f.executeSql(t,a,o,n)},n)},n):n(i,s)},n)}function pt(e,r){var t=this;e=U(e);var a=new h(function(o,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){k(s,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],function(f,l){var d=l.rows.length?l.rows.item(0).value:null;d&&(d=i.serializer.deserialize(d)),o(d)},function(f,l){n(l)})})}).catch(n)});return w(a,r),a}function yt(e,r){var t=this,a=new h(function(o,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){k(s,i,"SELECT * FROM "+i.storeName,[],function(f,l){for(var d=l.rows,p=d.length,E=0;E<p;E++){var D=d.item(E),T=D.value;if(T&&(T=i.serializer.deserialize(T)),T=e(T,D.key,E+1),T!==void 0){o(T);return}}o()},function(f,l){n(l)})})}).catch(n)});return w(a,r),a}function $e(e,r,t,a){var o=this;e=U(e);var n=new h(function(i,s){o.ready().then(function(){r===void 0&&(r=null);var f=r,l=o._dbInfo;l.serializer.serialize(r,function(d,p){p?s(p):l.db.transaction(function(E){k(E,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[e,d],function(){i(f)},function(D,T){s(T)})},function(E){if(E.code===E.QUOTA_ERR){if(a>0){i($e.apply(o,[e,f,t,a-1]));return}s(E)}})})}).catch(s)});return w(n,t),n}function bt(e,r,t){return $e.apply(this,[e,r,t,1])}function _t(e,r){var t=this;e=U(e);var a=new h(function(o,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){k(s,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],function(){o()},function(f,l){n(l)})})}).catch(n)});return w(a,r),a}function wt(e){var r=this,t=new h(function(a,o){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(i){k(i,n,"DELETE FROM "+n.storeName,[],function(){a()},function(s,f){o(f)})})}).catch(o)});return w(t,e),t}function It(e){var r=this,t=new h(function(a,o){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(i){k(i,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],function(s,f){var l=f.rows.item(0).c;a(l)},function(s,f){o(f)})})}).catch(o)});return w(t,e),t}function Et(e,r){var t=this,a=new h(function(o,n){t.ready().then(function(){var i=t._dbInfo;i.db.transaction(function(s){k(s,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(f,l){var d=l.rows.length?l.rows.item(0).key:null;o(d)},function(f,l){n(l)})})}).catch(n)});return w(a,r),a}function St(e){var r=this,t=new h(function(a,o){r.ready().then(function(){var n=r._dbInfo;n.db.transaction(function(i){k(i,n,"SELECT key FROM "+n.storeName,[],function(s,f){for(var l=[],d=0;d<f.rows.length;d++)l.push(f.rows.item(d).key);a(l)},function(s,f){o(f)})})}).catch(o)});return w(t,e),t}function Rt(e){return new h(function(r,t){e.transaction(function(a){a.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(o,n){for(var i=[],s=0;s<n.rows.length;s++)i.push(n.rows.item(s).name);r({db:e,storeNames:i})},function(o,n){t(n)})},function(a){t(a)})})}function At(e,r){r=V.apply(this,arguments);var t=this.config();e=typeof e!="function"&&e||{},e.name||(e.name=e.name||t.name,e.storeName=e.storeName||t.storeName);var a=this,o;return e.name?o=new h(function(n){var i;e.name===t.name?i=a._dbInfo.db:i=openDatabase(e.name,"","",0),e.storeName?n({db:i,storeNames:[e.storeName]}):n(Rt(i))}).then(function(n){return new h(function(i,s){n.db.transaction(function(f){function l(D){return new h(function(T,O){f.executeSql("DROP TABLE IF EXISTS "+D,[],function(){T()},function(L,W){O(W)})})}for(var d=[],p=0,E=n.storeNames.length;p<E;p++)d.push(l(n.storeNames[p]));h.all(d).then(function(){i()}).catch(function(D){s(D)})},function(f){s(f)})})}):o=h.reject("Invalid arguments"),w(o,r),o}var Dt={_driver:"webSQLStorage",_initStorage:gt,_support:dt(),iterate:yt,getItem:pt,setItem:bt,removeItem:_t,clear:wt,length:It,key:Et,keys:St,dropInstance:At};function Pt(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function ze(e,r){var t=e.name+"/";return e.storeName!==r.storeName&&(t+=e.storeName+"/"),t}function Tt(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch{return!0}}function xt(){return!Tt()||localStorage.length>0}function Ct(e){var r=this,t={};if(e)for(var a in e)t[a]=e[a];return t.keyPrefix=ze(e,r._defaultConfig),xt()?(r._dbInfo=t,t.serializer=ye,h.resolve()):h.reject()}function Nt(e){var r=this,t=r.ready().then(function(){for(var a=r._dbInfo.keyPrefix,o=localStorage.length-1;o>=0;o--){var n=localStorage.key(o);n.indexOf(a)===0&&localStorage.removeItem(n)}});return w(t,e),t}function Lt(e,r){var t=this;e=U(e);var a=t.ready().then(function(){var o=t._dbInfo,n=localStorage.getItem(o.keyPrefix+e);return n&&(n=o.serializer.deserialize(n)),n});return w(a,r),a}function Bt(e,r){var t=this,a=t.ready().then(function(){for(var o=t._dbInfo,n=o.keyPrefix,i=n.length,s=localStorage.length,f=1,l=0;l<s;l++){var d=localStorage.key(l);if(d.indexOf(n)===0){var p=localStorage.getItem(d);if(p&&(p=o.serializer.deserialize(p)),p=e(p,d.substring(i),f++),p!==void 0)return p}}});return w(a,r),a}function Ot(e,r){var t=this,a=t.ready().then(function(){var o=t._dbInfo,n;try{n=localStorage.key(e)}catch{n=null}return n&&(n=n.substring(o.keyPrefix.length)),n});return w(a,r),a}function Ut(e){var r=this,t=r.ready().then(function(){for(var a=r._dbInfo,o=localStorage.length,n=[],i=0;i<o;i++){var s=localStorage.key(i);s.indexOf(a.keyPrefix)===0&&n.push(s.substring(a.keyPrefix.length))}return n});return w(t,e),t}function Ft(e){var r=this,t=r.keys().then(function(a){return a.length});return w(t,e),t}function Mt(e,r){var t=this;e=U(e);var a=t.ready().then(function(){var o=t._dbInfo;localStorage.removeItem(o.keyPrefix+e)});return w(a,r),a}function jt(e,r,t){var a=this;e=U(e);var o=a.ready().then(function(){r===void 0&&(r=null);var n=r;return new h(function(i,s){var f=a._dbInfo;f.serializer.serialize(r,function(l,d){if(d)s(d);else try{localStorage.setItem(f.keyPrefix+e,l),i(n)}catch(p){(p.name==="QuotaExceededError"||p.name==="NS_ERROR_DOM_QUOTA_REACHED")&&s(p),s(p)}})})});return w(o,t),o}function Yt(e,r){if(r=V.apply(this,arguments),e=typeof e!="function"&&e||{},!e.name){var t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}var a=this,o;return e.name?o=new h(function(n){e.storeName?n(ze(e,a._defaultConfig)):n(e.name+"/")}).then(function(n){for(var i=localStorage.length-1;i>=0;i--){var s=localStorage.key(i);s.indexOf(n)===0&&localStorage.removeItem(s)}}):o=h.reject("Invalid arguments"),w(o,r),o}var $t={_driver:"localStorageWrapper",_initStorage:Ct,_support:Pt(),iterate:Bt,getItem:Lt,setItem:jt,removeItem:Mt,clear:Nt,length:Ft,key:Ot,keys:Ut,dropInstance:Yt},zt=function(r,t){return r===t||typeof r=="number"&&typeof t=="number"&&isNaN(r)&&isNaN(t)},Wt=function(r,t){for(var a=r.length,o=0;o<a;){if(zt(r[o],t))return!0;o++}return!1},We=Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},oe={},Ve={},te={INDEXEDDB:lt,WEBSQL:Dt,LOCALSTORAGE:$t},Vt=[te.INDEXEDDB._driver,te.WEBSQL._driver,te.LOCALSTORAGE._driver],ue=["dropInstance"],be=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(ue),Ht={description:"",driver:Vt.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Jt(e,r){e[r]=function(){var t=arguments;return e.ready().then(function(){return e[r].apply(e,t)})}}function _e(){for(var e=1;e<arguments.length;e++){var r=arguments[e];if(r)for(var t in r)r.hasOwnProperty(t)&&(We(r[t])?arguments[0][t]=r[t].slice():arguments[0][t]=r[t])}return arguments[0]}var Kt=function(){function e(r){y(this,e);for(var t in te)if(te.hasOwnProperty(t)){var a=te[t],o=a._driver;this[t]=o,oe[o]||this.defineDriver(a)}this._defaultConfig=_e({},Ht),this._config=_e({},this._defaultConfig,r),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(t){if((typeof t>"u"?"undefined":b(t))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var a in t){if(a==="storeName"&&(t[a]=t[a].replace(/\W/g,"_")),a==="version"&&typeof t[a]!="number")return new Error("Database version must be a number.");this._config[a]=t[a]}return"driver"in t&&t.driver?this.setDriver(this._config.driver):!0}else return typeof t=="string"?this._config[t]:this._config},e.prototype.defineDriver=function(t,a,o){var n=new h(function(i,s){try{var f=t._driver,l=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!t._driver){s(l);return}for(var d=be.concat("_initStorage"),p=0,E=d.length;p<E;p++){var D=d[p],T=!Wt(ue,D);if((T||t[D])&&typeof t[D]!="function"){s(l);return}}var O=function(){for(var ie=function(Xt){return function(){var kt=new Error("Method "+Xt+" is not implemented by the current driver"),He=h.reject(kt);return w(He,arguments[arguments.length-1]),He}},we=0,Qt=ue.length;we<Qt;we++){var Ie=ue[we];t[Ie]||(t[Ie]=ie(Ie))}};O();var L=function(ie){oe[f]&&console.info("Redefining LocalForage driver: "+f),oe[f]=t,Ve[f]=ie,i()};"_support"in t?t._support&&typeof t._support=="function"?t._support().then(L,s):L(!!t._support):L(!0)}catch(W){s(W)}});return B(n,a,o),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(t,a,o){var n=oe[t]?h.resolve(oe[t]):h.reject(new Error("Driver not found."));return B(n,a,o),n},e.prototype.getSerializer=function(t){var a=h.resolve(ye);return B(a,t),a},e.prototype.ready=function(t){var a=this,o=a._driverSet.then(function(){return a._ready===null&&(a._ready=a._initDriver()),a._ready});return B(o,t,t),o},e.prototype.setDriver=function(t,a,o){var n=this;We(t)||(t=[t]);var i=this._getSupportedDrivers(t);function s(){n._config.driver=n.driver()}function f(p){return n._extend(p),s(),n._ready=n._initStorage(n._config),n._ready}function l(p){return function(){var E=0;function D(){for(;E<p.length;){var T=p[E];return E++,n._dbInfo=null,n._ready=null,n.getDriver(T).then(f).catch(D)}s();var O=new Error("No available storage method found.");return n._driverSet=h.reject(O),n._driverSet}return D()}}var d=this._driverSet!==null?this._driverSet.catch(function(){return h.resolve()}):h.resolve();return this._driverSet=d.then(function(){var p=i[0];return n._dbInfo=null,n._ready=null,n.getDriver(p).then(function(E){n._driver=E._driver,s(),n._wrapLibraryMethodsWithReady(),n._initDriver=l(i)})}).catch(function(){s();var p=new Error("No available storage method found.");return n._driverSet=h.reject(p),n._driverSet}),B(this._driverSet,a,o),this._driverSet},e.prototype.supports=function(t){return!!Ve[t]},e.prototype._extend=function(t){_e(this,t)},e.prototype._getSupportedDrivers=function(t){for(var a=[],o=0,n=t.length;o<n;o++){var i=t[o];this.supports(i)&&a.push(i)}return a},e.prototype._wrapLibraryMethodsWithReady=function(){for(var t=0,a=be.length;t<a;t++)Jt(this,be[t])},e.prototype.createInstance=function(t){return new e(t)},e}(),Gt=new Kt;v.exports=Gt},{3:3}]},{},[4])(4)})})(Xe);var ar=Xe.exports;const C=er(ar);class ke{}let or=I=>crypto.getRandomValues(new Uint8Array(I)),ir=(I,c,u)=>{let v=(2<<Math.log(I.length-1)/Math.LN2)-1,g=-~(1.6*v*c/I.length);return(b=c)=>{let y="";for(;;){let _=u(g),R=g;for(;R--;)if(y+=I[_[R]&v]||"",y.length===b)return y}}},sr=(I,c=21)=>ir(I,c,or);class Ge{static generateId(){return sr("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",10)()}}class cr{static async getFileHash(c){const u=await c.arrayBuffer(),v=await crypto.subtle.digest("SHA-256",u);return Array.from(new Uint8Array(v)).map(g=>g.toString(16).padStart(2,"0")).join("").substring(0,16)}static async blobToBase64(c){return new Promise(async(u,v)=>{try{const b=await(await fetch(c)).blob(),y=new FileReader;y.onloadend=()=>{u(y.result)},y.onerror=()=>{v("Failed to convert Blob to Base64")},y.readAsDataURL(b)}catch{return u(!1)}})}static async base64ToBlob(c){return new Promise(async(u,v)=>{try{const g=await fetch(c);if(g.ok){const b=await g.blob();u(URL.createObjectURL(b))}else u(!1)}catch{u(!1)}})}}class qe{constructor(){Je(this,"cachePool",new Map)}addCache(c,u){this.cachePool.set(c,u)}getCache(c){return this.cachePool.get(c)||null}removeCache(c){this.cachePool.delete(c)}clearCache(){this.cachePool.clear()}isExistCache(c){return this.cachePool.has(c)}getCachePool(){return this.cachePool}}class ur extends qe{getAllImageCache(){return Array.from(this.getCachePool().values())||[]}}const re=new ur;class fr extends qe{getAllCoverCache(){return Array.from(this.getCachePool().values())||[]}clearCoverCache(){this.getAllCoverCache().forEach(c=>{URL.revokeObjectURL(c)})}}const lr=new fr,H="light_chaser_project_list",Ee="image_source_",dr="cover_",vr=async I=>(await tr(()=>import("./LayerManager-9_OZ_v7l.js").then(u=>u.aP),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]))).default;class hr extends ke{async createProject(c){c.id=Ge.generateId();const u=c.dataJson,v=await C.getItem(H)||[];return c.dataJson=void 0,v.push(c),await C.setItem(H,v),await C.setItem(c.id,u),Promise.resolve(c.id)}async updateProject(c){var y,_;c=Ke.cloneDeep(c);const u=c.dataJson;delete c.dataJson;const v=await C.getItem(H)||[],g=v.findIndex(R=>R.id===c.id);if(g===-1){(y=q.messageApi)==null||y.error("项目不存在");return}const b=v[g];c=rr.merge(b,c),v[g]=c,await C.setItem(H,v),u&&await C.setItem(c.id,u),(_=q.messageApi)==null||_.success("保存成功")}async deleteProject(c){const u=await C.getItem(H)||[],v=u.findIndex(b=>b.id===c);if(v===-1)return!1;const g=u[v];return g.cover&&await C.removeItem(g.cover),u.splice(v,1),await C.setItem(H,u),await C.removeItem(c),!0}async getProjectData(c){var b;const u=await C.getItem(c);if(!u)return null;const v=await C.getItem(Ee+c)||[];for(const y of v){const _=await C.getItem(y);if(_){const{blob:R,name:x}=_,P=URL.createObjectURL(R);re.addCache(y,{url:P,name:x,hash:y,id:y})}}const g=JSON.parse(u);if(g&&g.layerManager){const{elemConfigs:y}=g.layerManager;if(y){const _=((b=ne.parseUrlParams())==null?void 0:b.mode)||Qe.EDIT;vr().then(async R=>{const{convertMap:x}=R.getLoader(_);for(const P of Object.values(y)){const{type:h}=P==null?void 0:P.base;h&&x[h]&&await x[h].convertBack(P)}})}}return g}async getProjectInfoPageList(c){const{current:u,size:v,searchValue:g}=c;let b=await C.getItem(H)||[];g&&(b=b.filter(P=>{var h;return(h=P.name)==null?void 0:h.includes(g)}));for(const P of b){const{cover:h}=P;if(h){const w=await C.getItem(h);w?(P.cover=URL.createObjectURL(w),lr.addCache(P.id,P.cover)):P.cover=void 0}}const y=(u-1)*v,_=y+v,R=b.length,x=b.slice(y,_);return{total:R,records:x,current:u,size:v}}async copyProject(c,u){const v=await C.getItem(H)||[],g=v.findIndex(R=>R.id===c);if(g===-1)return"";const b=v[g],y=Ke.cloneDeep(b);y.id=Ge.generateId(),y.name=u||y.name,y.createTime=new Date().getTime()+"",y.updateTime=new Date().getTime()+"",v.push(y),await C.setItem(H,v);const _=await C.getItem(c);return _&&await C.setItem(y.id,_),y.id}async uploadImage(c){return new Promise(u=>{let v=null;cr.getFileHash(c).then(g=>{var b;if(re.isExistCache(g))v=(b=re.getCache(g))==null?void 0:b.url,u(v&&v!==""?{url:v,hash:g}:!1);else{const y=new FileReader;y.onload=async _=>{const R=new Blob([_.target.result],{type:c.type});C.setItem(g,{name:c.name,blob:R});const{id:x}=ne.parseUrlParams(),P=Ee+x,h=await C.getItem(P)||[];h.push(g),C.setItem(P,h),v=URL.createObjectURL(R),re.addCache(g,{url:v,name:c.name,hash:g,id:g}),u({url:v,hash:g})},y.readAsArrayBuffer(c)}})})}async getImageSourceList(c){return new Promise(u=>{u(re.getAllImageCache())})}async delImageSource(c){await C.removeItem(c);const{id:u}=ne.parseUrlParams(),v=Ee+u,g=await C.getItem(v)||[],b=g.findIndex(y=>y===c);if(b!==-1)g.splice(b,1),await C.setItem(v,g);else return!1;return re.removeCache(c),!0}async uploadCover(c){const u=new FileReader,{id:v}=ne.parseUrlParams(),g=dr+v;u.onload=async R=>{const x=new Blob([R.target.result],{type:c.type});await C.setItem(g,x)},u.readAsArrayBuffer(c);const b=await C.getItem(H)||[],y=b.findIndex(R=>R.id===v);if(y===-1)return!1;const _=b[y];return _.cover=g,await C.setItem(H,b),!0}}class mr extends ke{async createProject(c){const u=await J.post("/api/project/create",c);return u.code===200?u.data:""}async copyProject(c){const u=await J.get(`/api/project/copy/${c}`);return u.code===200?u.data:""}async deleteProject(c){return(await J.get(`/api/project/del/${c}`)).code===200}async getProjectData(c){var v;const u=await J.get(`/api/project/getProjectData/${c}`);return u.code===200?JSON.parse(u.data):((v=q.messageApi)==null||v.error(u.msg),null)}async getProjectInfoPageList(c){var v;const u=await J.post("/api/project/pageList",c);return u.code===200?u.data:(u.msg="服务器链接失败",(v=q.messageApi)==null||v.error(u.msg),{records:[],total:0,current:1,size:10})}async updateProject(c){var v,g;const u=await J.post("/api/project/update",c);u.code===200?(v=q.messageApi)==null||v.success("保存成功"):(g=q.messageApi)==null||g.error(u.msg)}async uploadImage(c){const{id:u}=ne.parseUrlParams(),v=new FormData;v.append("file",c),v.append("projectId",u),v.append("type","1");const g=await J.post("/api/file/upload",v);return g.code===200?{url:g.data}:!1}async getImageSourceList(c){var v;const u=await J.get(`/api/file/getList/${c}`);return u.code===200?u.data:((v=q.messageApi)==null||v.error(u.msg),[])}async delImageSource(c){var v;const u=await J.get(`/api/file/del/${c}`);return u.code===200?!0:((v=q.messageApi)==null||v.error(u.msg),!1)}async uploadCover(c){const{id:u}=ne.parseUrlParams(),v=new FormData;return v.append("file",c),v.append("id",u),(await J.post("/api/project/cover",v)).code===200}}const wr={[Se.LOCAL]:new hr,[Se.SERVER]:new mr};export{Qe as D,cr as F,Ge as I,nr as P,Se as S,ne as U,re as i,lr as l,wr as o};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/LayerManager-9_OZ_v7l.js","assets/mobxreact.esm-QmaNsbsC.js","assets/index-CIZzpp4t.js","assets/index-IyM4ICh1.css","assets/FetchUtil-FMEOVjjY.js","assets/index-PQsxm07c.js","assets/GlobalMessage-b_IUatJJ.js","assets/MainRouter-LJqlNU58.js","assets/useZIndex-C48Dwtsu.js","assets/LayerManager-V988xSA9.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}