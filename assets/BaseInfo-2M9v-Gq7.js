var x=Object.defineProperty;var C=(d,o,e)=>o in d?x(d,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[o]=e;var h=(d,o,e)=>(C(d,typeof o!="symbol"?o+"":o,e),e);import{r as R,j as n}from"./index-uVTr4DkP.js";import{aC as y,aN as k,e as r,c as g,aO as q,aP as w,aQ as L,aR as I,aS as j,aT as S,r as T,l as p,aH as b,i as z}from"./LayerManager-4wFtoUMN.js";import{L as M}from"./LCGUI-Ssa8gIoP.js";import{I as A}from"./Info-C4FehWbX.js";import"./UIContainer-QclyxjV1.js";import"./index-M4LYRhyC.js";import"./MainRouter-g_j_Is0t.js";import"./useZIndex-GVasLPt8.js";import"./FetchUtil-Ivd_z0Im.js";import"./LocalOperator-7SvlDKB4.js";import"./GlobalMessage-JdhJioSt.js";import"./Data-UXmzX42n.js";import"./Accordion-NfD7KWQm.js";import"./Switch-QMPoZeAy.js";import"./Right-qoStPUum.js";import"./Radio-sQVTRydY.js";import"./index-kdYyXKyi.js";class Z extends R.Component{constructor(e){super(e);h(this,"init",()=>{var s;const{activeElem:e}=T,{layerConfigs:t}=p,i=t[e.id];if(i)if(i.type==="group"){const a=y.findAllChildLayer([i.id]).filter(c=>t[c].type!=="group"),l=this.calculateGroupRect(a);this.state={...i,...l}}else{const a=(s=k.definitionMap[i.type])==null?void 0:s.getBaseInfo();this.state={...i,version:a==null?void 0:a.version}}});h(this,"calculateGroupRect",e=>{const{layerConfigs:t}=p;let i=1/0,s=1/0,a=-1/0,l=-1/0;return e.forEach(c=>{const{x:m=0,y:u=0,width:f=0,height:v=0}=t[c];i=Math.min(i,m),s=Math.min(s,u),a=Math.max(a,m+f),l=Math.max(l,u+v)}),{x:i,y:s,width:a-i,height:l-s}});h(this,"changeName",e=>{const{controller:t}=this.props;t.update({base:{name:e}},{reRender:!1});const{updateLayer:i}=p;i&&i([{id:this.state.id,name:e}]);const{layerInstances:s}=z,a=s[this.state.id];a&&a.setState({name:e})});h(this,"handleMap",{name:this.changeName,width:e=>{var t;return(t=r.movableRef)==null?void 0:t.request("resizable",{offsetWidth:e,direction:[1,1]},!0)},height:e=>{var t;return(t=r.movableRef)==null?void 0:t.request("resizable",{offsetHeight:e,direction:[1,1]},!0)},posX:e=>{var t;return(t=r.movableRef)==null?void 0:t.request("draggable",{x:e},!0)},posY:e=>{var t;return(t=r.movableRef)==null?void 0:t.request("draggable",{y:e},!0)},align:e=>this.handleMap[e](),left:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{x:0},!0)},horizontally:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{x:g.canvasConfig.width/2-this.state.width/2},!0)},right:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{x:g.canvasConfig.width-this.state.width},!0)},top:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{y:0},!0)},vertically:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{y:g.canvasConfig.height/2-this.state.height/2},!0)},bottom:()=>{var e;return(e=r.movableRef)==null?void 0:e.request("draggable",{y:g.canvasConfig.height-this.state.height},!0)}});h(this,"onFieldChange",e=>{const{id:t,data:i}=e,{targetIds:s,setTargetIds:a}=r;if(!s.includes(this.state.id)){const{type:c}=this.state;if(c==="group"){const{layerConfigs:m}=p,u=y.findAllChildLayer([this.state.id]).filter(f=>m[f].type!=="group");a(u)}else a([this.state.id])}const l=setTimeout(()=>{this.handleMap[t](i),clearTimeout(l)},1)});h(this,"buildSchema",()=>{const{name:e,width:t,height:i,x:s,y:a}=this.state;return{type:"grid",config:{columns:2},children:[{id:"name",key:"name",label:"名称",type:"input",value:e,config:{containerStyle:{gridColumn:"1/3"}}},{type:"grid",label:"尺寸",config:{columns:2,containerStyle:{gridColumn:"1/3"}},children:[{id:"width",key:"width",type:"number-input",label:"宽度",value:t,reRender:!0},{id:"height",key:"height",type:"number-input",label:"高度",value:i,reRender:!0}]},{type:"grid",label:"位置",config:{columns:2,containerStyle:{gridColumn:"1/3"}},children:[{id:"posX",key:"posX",type:"number-input",label:"X轴",reRender:!0,value:s},{id:"posY",key:"posY",type:"number-input",label:"Y轴",reRender:!0,value:a}]},{id:"align",label:"对齐",type:"group-button",config:{containerStyle:{gridColumn:"1/3"},items:[{value:"left",content:n.jsx(q,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"horizontally",content:n.jsx(w,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"right",content:n.jsx(L,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"top",content:n.jsx(I,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"vertically",content:n.jsx(j,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})},{value:"bottom",content:n.jsx(S,{theme:"filled",size:"16",strokeWidth:2,strokeLinecap:"square"})}]}}]}});this.init()}componentDidMount(){const{setBaseConfigRef:e}=b;e&&e(this)}componentWillUnmount(){const{setBaseConfigRef:e}=b;e&&e(null)}render(){const{type:e,version:t}=this.state,i=this.buildSchema();return n.jsxs("div",{className:"base-info-config",children:[n.jsx("div",{className:"version-info",children:n.jsxs("span",{children:[n.jsx(A,{})," ",e," | ",t?`版本: ${t}`:"无版本信息"]})}),n.jsx(M,{schema:i,onFieldChange:this.onFieldChange})]})}}export{Z as default};
