import{r,j as P}from"./index-3GqucBfC.js";import{ba as F,bj as $,bk as H,bl as K,bh as X,n as q,U as w,q as B,e as D,l as Y,bi as Q}from"./LayerManager-Id64Dr7s.js";import{D as G}from"./DragAddProvider-_IIQLnDx.js";import{E as R}from"./GlobalMessage-uqw5jbrt.js";import{Y as J,C as T,v as Z,c as k}from"./MainRouter-5S0GgxtQ.js";import{u as ee}from"./AntdIcon-OHmKKYpl.js";import{K as te}from"./useZIndex-9IcJXe4E.js";import{o as ne}from"./omit-snSLv_vL.js";import{c as oe}from"./Compact-PqrPY0tm.js";import{B as L,c as V}from"./button-bA6D7oLy.js";import{g as re}from"./AntdIcon-BYoPKEuB.js";import{Q as ae}from"./Button-BktP6eFA.js";import{M as se}from"./DesignerPage-GLP8CQSv.js";import"./render-IWbIHfGq.js";import"./Overflow-blYa_Cc8.js";import"./LayerBuilder-VxvHNdV4.js";import"./PlusOutlined-8k7LlG5P.js";import"./PlusOutlined-VdblB-UP.js";import"./NumberInput-M4LWcmYS.js";import"./Select-xkl2cP13.js";function _(e){return!!(e&&e.then)}const le=e=>{const{type:o,children:i,prefixCls:n,buttonProps:s,close:y,autoFocus:h,emitEvent:u,isSilent:g,quitOnNullishReturnValue:t,actionFn:a}=e,l=r.useRef(!1),d=r.useRef(null),[O,f]=J(!1),b=function(){y==null||y.apply(void 0,arguments)};r.useEffect(()=>{let c=null;return h&&(c=setTimeout(()=>{var p;(p=d.current)===null||p===void 0||p.focus()})),()=>{c&&clearTimeout(c)}},[]);const v=c=>{_(c)&&(f(!0),c.then(function(){f(!1,!0),b.apply(void 0,arguments),l.current=!1},p=>{if(f(!1,!0),l.current=!1,!(g!=null&&g()))return Promise.reject(p)}))},x=c=>{if(l.current)return;if(l.current=!0,!a){b();return}let p;if(u){if(p=a(c),t&&!_(p)){l.current=!1,b(c);return}}else if(a.length)p=a(y),l.current=!1;else if(p=a(),!p){b();return}v(p)};return r.createElement(L,Object.assign({},V(o),{onClick:x,loading:O,prefixCls:n},s,{ref:d}),i)},ie=le,ce=e=>{const{componentCls:o,iconCls:i,antCls:n,zIndexPopup:s,colorText:y,colorWarning:h,marginXXS:u,marginXS:g,fontSize:t,fontWeightStrong:a,colorTextHeading:l}=e;return{[o]:{zIndex:s,[`&${n}-popover`]:{fontSize:t},[`${o}-message`]:{marginBottom:g,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${o}-message-icon ${i}`]:{color:h,fontSize:t,lineHeight:1,marginInlineEnd:g},[`${o}-title`]:{fontWeight:a,color:l,"&:only-child":{fontWeight:"normal"}},[`${o}-description`]:{marginTop:u,color:y}},[`${o}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:g}}}}},me=e=>{const{zIndexPopupBase:o}=e;return{zIndexPopup:o+60}},z=re("Popconfirm",e=>ce(e),me,{resetStyle:!1});var ue=function(e,o){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(i[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)o.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]]);return i};const A=e=>{const{prefixCls:o,okButtonProps:i,cancelButtonProps:n,title:s,description:y,cancelText:h,okText:u,okType:g="primary",icon:t=r.createElement(R,null),showCancel:a=!0,close:l,onConfirm:d,onCancel:O,onPopupClick:f}=e,{getPrefixCls:b}=r.useContext(T),[v]=F("Popconfirm",Z.Popconfirm),x=$(s),c=$(y);return r.createElement("div",{className:`${o}-inner-content`,onClick:f},r.createElement("div",{className:`${o}-message`},t&&r.createElement("span",{className:`${o}-message-icon`},t),r.createElement("div",{className:`${o}-message-text`},x&&r.createElement("div",{className:k(`${o}-title`)},x),c&&r.createElement("div",{className:`${o}-description`},c))),r.createElement("div",{className:`${o}-buttons`},a&&r.createElement(L,Object.assign({onClick:O,size:"small"},n),h??(v==null?void 0:v.cancelText)),r.createElement(ie,{buttonProps:Object.assign(Object.assign({size:"small"},V(g)),i),actionFn:d,close:l,prefixCls:b("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},u??(v==null?void 0:v.okText))))},de=e=>{const{prefixCls:o,placement:i,className:n,style:s}=e,y=ue(e,["prefixCls","placement","className","style"]),{getPrefixCls:h}=r.useContext(T),u=h("popconfirm",o),[g]=z(u);return g(r.createElement(H,{placement:i,className:k(u,n),style:s,content:r.createElement(A,Object.assign({prefixCls:u},y))}))},fe=de;var pe=function(e,o){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(i[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(e);s<n.length;s++)o.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]]);return i};const U=r.forwardRef((e,o)=>{var i,n;const{prefixCls:s,placement:y="top",trigger:h="click",okType:u="primary",icon:g=r.createElement(R,null),children:t,overlayClassName:a,onOpenChange:l,onVisibleChange:d}=e,O=pe(e,["prefixCls","placement","trigger","okType","icon","children","overlayClassName","onOpenChange","onVisibleChange"]),{getPrefixCls:f}=r.useContext(T),[b,v]=ee(!1,{value:(i=e.open)!==null&&i!==void 0?i:e.visible,defaultValue:(n=e.defaultOpen)!==null&&n!==void 0?n:e.defaultVisible}),x=(m,C)=>{v(m,!0),d==null||d(m),l==null||l(m,C)},c=m=>{x(!1,m)},p=m=>{var C;return(C=e.onConfirm)===null||C===void 0?void 0:C.call(void 0,m)},j=m=>{var C;x(!1,m),(C=e.onCancel)===null||C===void 0||C.call(void 0,m)},I=m=>{m.keyCode===te.ESC&&b&&x(!1,m)},E=m=>{const{disabled:C=!1}=e;C||x(m)},S=f("popconfirm",s),M=k(S,a),[W]=z(S);return W(r.createElement(K,Object.assign({},ne(O,["title"]),{trigger:h,placement:y,onOpenChange:E,open:b,ref:o,overlayClassName:M,content:r.createElement(A,Object.assign({okType:u,icon:g},e,{prefixCls:S,close:c,onConfirm:p,onCancel:j})),"data-popover-inject":!0}),oe(t,{onKeyDown:m=>{var C,N;r.isValidElement(t)&&((N=t==null?void 0:(C=t.props).onKeyDown)===null||N===void 0||N.call(C,m)),I(m)}})))});U._InternalPanelDoNotUseOrYouWillBeFired=fe;const ge=U;function Re(){const[e,o]=r.useState([]),i=r.useRef(null),n=t=>{var a,l;if(t.target.classList.contains("droppable-element")){const d=t.target;(a=t.dataTransfer)==null||a.setData("imageUrl",d.getAttribute("data-url")),(l=t.dataTransfer)==null||l.setData("imageHash",d.getAttribute("data-hash"))}},s=t=>{t.preventDefault()},y=t=>{var x,c;t.preventDefault();const a=(x=t.dataTransfer)==null?void 0:x.getData("imageUrl"),l=(c=t.dataTransfer)==null?void 0:c.getData("imageHash");if(!a)return;const{scale:d,dsContentRef:O}=D,f=O==null?void 0:O.getBoundingClientRect(),b=(t.clientX-((f==null?void 0:f.x)||0))/d,v=(t.clientY-((f==null?void 0:f.y)||0))/d;h("BaseImage",[b,v],a,l)},h=(t,a=[0,0],l,d)=>{const{elemConfigs:O}=Y;let{setAddRecordCompId:f}=D;const{definitionMap:b}=Q,v=b[t],{compName:x,width:c=320,height:p=200}=v.getBaseInfo(),j=X.generateId(),I={name:x,type:t,x:Math.round(a[0]),y:Math.round(a[1]),id:j,lock:!1,hide:!1,width:c,height:p};f(I.id),q.doAdd(I);const E=v.getInitConfig();E.style.type="local",E.style.localUrl=l,E.style.hash=d,O[j]=E},u=()=>{const{saveType:t,id:a}=w.parseUrlParams();B[t].getImageSourceList(a).then(l=>{o(l)})};r.useEffect(()=>(u(),i.current=new G(document.getElementById("image-source-list"),document.getElementById("designer-ds-content"),n,s,y),()=>{var t;return(t=i.current)==null?void 0:t.destroy()}),[]);const g=t=>{const{saveType:a}=w.parseUrlParams();B[a].delImageSource(t).then(l=>{l&&u()})};return P.jsx("div",{className:"image-source",children:P.jsx("div",{className:"image-source-list",id:"image-source-list",children:e.map((t,a)=>P.jsxs("div",{className:"image-source-item droppable-element",draggable:!0,"data-url":t.url,"data-hash":t.hash,children:[P.jsxs("div",{className:"image-source-item-header",children:[P.jsx("div",{className:"isi-title",children:t.name||"无名称信息"}),P.jsx("div",{className:"isi-operate",children:P.jsx(ge,{title:"确认删除吗?",icon:P.jsx(ae,{style:{color:"red"}}),description:"可能会导致已经使用的图片组件失效!",onConfirm:()=>g(t.id),okText:"是",cancelText:"否",children:P.jsx(se,{})})})]}),P.jsx("div",{className:"image-source-item-body",children:P.jsx("div",{className:"item-bg-image",style:{backgroundImage:`url(${t.url})`}})})]},a))})})}export{Re as default};
